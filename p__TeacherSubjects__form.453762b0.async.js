(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(bt,Ae,i){},"5Syx":function(bt,Ae,i){"use strict";i.d(Ae,"c",function(){return et}),i.d(Ae,"b",function(){return Ue}),i.d(Ae,"a",function(){return ot});var b=i("OaEy"),$e=i("2fM7"),se=i("g9YV"),M=i("wCAj"),ve=i("14J3"),j=i("BMrR"),nt=i("BoS7"),s=i("Sdc0"),qe=i("jrin"),de=i("k1fw"),je=i("DYRE"),ge=i("zeV3"),Ye=i("+BJd"),Ge=i("mr32"),te=i("oBTY"),ye=i("tJVT"),we=i("q1tI"),st=i.n(we),mt=i("nhC9"),Le=i("LDJE"),h=i("9kvl"),R=i("nz6D"),Ne=i("sWYD"),rt=i("mGZj"),ut=i("Vpfc"),le=i("+L6B"),W=i("2/Rp"),w=i("qLMh"),E=i("9og8"),z=i("4KAj"),_e=i("w/VK"),y=i("nKUr"),Ce=function(Te){var Me=Te.course_id,be=Te.stat,me=be===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":be,oe=Object(we.useState)(!1),Ie=Object(ye.a)(oe,2),Oe=Ie[0],G=Ie[1],ze=Object(we.useCallback)(function(Ee){return Object(E.a)(Object(w.a)().mark(function pe(){var X,Y;return Object(w.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return G(!0),D.prev=1,D.next=4,Object(_e.a)(Ee,{stat:me});case 4:X=D.sent,X instanceof Blob&&(Y=document.createElement("a"),Y.href=window.URL.createObjectURL(X),Y.download="finished_topics_".concat(Me,".xlsx"),document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)),D.next=11;break;case 8:D.prev=8,D.t0=D.catch(1),console.error(D.t0);case 11:return D.prev=11,G(!1),D.finish(11);case 14:case"end":return D.stop()}},pe,null,[[1,8,11,14]])}))},[me]);return Object(y.jsxs)(W.a,{type:"primary",loading:Oe,onClick:ze(Me),children:[Object(y.jsx)(z.a,{})," ",Object(y.jsx)(h.a,{id:"export"})]})},tt=function(Te){return Te.topicable.content.contents?Object.values(Te.topicable.content.contents)[0].library:"H5P"},et=function(Te){var Me=Te.course_id,be=Te.topics,me=Te.stats,oe=Object(we.useState)(!1),Ie=Object(ye.a)(oe,2),Oe=Ie[0],G=Ie[1],ze=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(X){return Object(y.jsx)(ut.a,{type:"App\\Models\\User",type_id:X})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"}].concat(Object(te.a)(be.map(function(pe){var X,Y=(X=pe.topicable_type)===null||X===void 0?void 0:X.split("\\").pop();return Y==="H5P"&&(Y=tt(pe)),{render:function(D){var N=0,I=0;switch(D&&(D.started_at&&D.finished_at?N=1:D.started_at&&(N=2),I=D.seconds/60),N){case 1:return Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(Ge.a,{color:"success",children:"F"}),Oe&&Object(y.jsxs)("small",{children:[I.toFixed(2),"m"]})]});case 2:return Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(Ge.a,{color:"blue",children:"S"}),Oe&&Object(y.jsxs)("small",{children:[I.toFixed(2),"m"]})]});case 0:default:return Object(y.jsx)(st.a.Fragment,{children:Object(y.jsx)(Ge.a,{color:"error",children:"N"})})}},title:Object(y.jsxs)("small",{children:[Object(y.jsx)(Ge.a,{children:Y})," ",pe.title]}),dataIndex:pe.id}})))},[be,Oe]),Ee=Object(we.useMemo)(function(){return me.map(function(pe){return be.reduce(function(X,Y){var ee=pe.topics.find(function(D){return D.id===Y.id});return Object(de.a)(Object(de.a)({},X),{},Object(qe.a)({},Number(Y.id),ee!=null?ee:0))},{email:pe.email,id:pe.id})})},[me,be]);return Object(y.jsx)(M.a,{title:function(){return Object(y.jsxs)(j.a,{justify:"space-between",align:"middle",children:[Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(h.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(y.jsx)(Ge.a,{color:"success",children:"F"}),Object(y.jsx)(h.a,{id:"Started",defaultMessage:"Started:"})," ",Object(y.jsx)(Ge.a,{color:"blue",children:"S"}),Object(y.jsx)(h.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(y.jsx)(Ge.a,{color:"error",children:"N"}),Object(y.jsx)(h.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(y.jsx)(s.a,{checked:Oe,onChange:function(Y){return G(Y)}})]}),Object(y.jsx)(Ce,{course_id:Me})]})},columns:ze,dataSource:Ee,size:"small",scroll:{x:1500},components:{table:function(X){return Object(y.jsx)(R.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(y.jsx)("table",Object(de.a)({},X))})}}})},Ue=function(Te){var Me=Te.stats,be=Te.attempts,me=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(Oe){return Object(y.jsx)(ut.a,{type:"App\\Models\\User",type_id:Oe})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"},{title:Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(y.jsx)(h.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Oe){return Oe?Object(Ne.a)(new Date(Oe),rt.a):""}}]},[]),oe=Object(we.useMemo)(function(){return Me.map(function(Ie){var Oe=Ie.id,G=Ie.email,ze=Ie.finished_at,Ee=be==null?void 0:be.find(function(X){return X.id===Oe}),pe=Array.isArray(Ee==null?void 0:Ee.attempts)?Ee==null?void 0:Ee.attempts.length:0;return{id:Oe,email:G,finished_at:ze,attempt:pe}})},[Me]);return Object(y.jsx)(M.a,{title:function(){return Object(y.jsx)(ge.b,{children:Object(y.jsx)(h.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:me,dataSource:oe,size:"small",scroll:{x:500}})},ot=function(Te){var Me=Te.stats,be=Object(we.useState)(null),me=Object(ye.a)(be,2),oe=me[0],Ie=me[1],Oe=Object(we.useState)(null),G=Object(ye.a)(Oe,2),ze=G[0],Ee=G[1],pe=Object(h.l)(),X=Object(we.useMemo)(function(){return Me.flatMap(function(ee){return Object.values(ee.attempts).flatMap(function(D){var N=D.dates,I=D.attempt,U=Object.values(N).flatMap(function(L){var P=L.date,V=L.seconds_total;return{date:P,attempt:I,seconds_total:V,email:ee.email}});return U})})},[Me]),Y={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(y.jsx)(mt.a,{title:Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(h.a,{id:"course.interactions_time_in_days"}),Object(y.jsx)($e.a,{showSearch:!0,value:oe,onChange:function(D){Ie(D),Ee(null)},placeholder:Object(y.jsx)(h.a,{id:"select_person",defaultMessage:"Select a person"}),children:Me.map(function(ee){var D=ee.id,N=ee.email;return Object(y.jsx)($e.a.Option,{value:N,children:N},D)})}),Object(y.jsx)($e.a,{value:ze,onChange:function(D){return Ee(D)},disabled:oe===null,placeholder:Object(y.jsx)(h.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(te.a)(new Set(X.filter(function(ee){var D=ee.email;return D===oe}).map(function(ee){var D=ee.attempt;return D}))).map(function(ee){return Object(y.jsxs)($e.a.Option,{value:ee,children:[Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"})," ",ee]},ee)})})]}),colSpan:12,layout:"center",children:Object(y.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(y.jsx)(Le.a,Object(de.a)(Object(de.a)({},Y),{},{tooltip:{title:"".concat(pe.formatMessage({id:"attempt"})),formatter:function(D){var N=Math.floor(+D.seconds_total/60),I=+D.seconds_total>60?+D.seconds_total-N*60:0;return{name:D.attempt,value:"".concat(N,"m ").concat(I,"s")}}},data:X.filter(function(ee){var D=ee.email;return D===oe}).filter(function(ee){var D=ee.attempt;return Number.isInteger(ze)?D===ze:!0})}))})})}},olry:function(bt,Ae,i){"use strict";i.r(Ae);var b=i("k1fw"),$e=i("+L6B"),se=i("2/Rp"),M=i("T2oS"),ve=i("W9HT"),j=i("q1tI"),nt=i.n(j),s=i("9kvl"),qe=i("55Ip"),de=i("Ty5D"),je=i("nhC9"),ge=i("tMyG"),Ye=i("my69"),Ge=i("huej"),te=i("mJ0o"),ye=i("EhlZ"),we=i("P2fV"),st=i("NJEC"),mt=i("5Dmo"),Le=i("3S7+"),h=i("qLMh"),R=i("9og8"),Ne=i("sWYD"),rt=i("G3dp"),ut=i("lbgm"),le=i("/MfK"),W=i("Qiat"),w=i("mGZj");function E(u,n){return z.apply(this,arguments)}function z(){return z=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"GET",useCache:!1,params:n},a||{})));case 1:case"end":return t.stop()}},u)})),z.apply(this,arguments)}function _e(u,n){return y.apply(this,arguments)}function y(){return y=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),y.apply(this,arguments)}function Ce(u,n,a){return tt.apply(this,arguments)}function tt(){return tt=Object(R.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"PUT",data:a,useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),tt.apply(this,arguments)}function et(u,n){return Ue.apply(this,arguments)}function Ue(){return Ue=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Ue.apply(this,arguments)}function ot(u,n){return Xe.apply(this,arguments)}function Xe(){return Xe=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),Xe.apply(this,arguments)}function Te(u,n,a,r){return Me.apply(this,arguments)}function Me(){return Me=Object(R.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return l.stop()}},u)})),Me.apply(this,arguments)}function be(u,n,a){return me.apply(this,arguments)}function me(){return me=Object(R.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"DELETE"},r||{})));case 1:case"end":return c.stop()}},u)})),me.apply(this,arguments)}var oe=i("Vpfc"),Ie=i("giR+"),Oe=i("fyUT"),G=i("tJVT"),ze=i("14J3"),Ee=i("BMrR"),pe=i("jCWc"),X=i("kPKH"),Y=i("VMEa"),ee=i("Qurx"),D=i("lR9U"),N=i("/y+f"),I=i("2qtc"),U=i("kLXV"),L=i("DYRE"),P=i("zeV3"),V=i("XCrF"),k=i("1GRj"),Z=i("jrin"),ae=i("oBTY"),Dr=i("OaEy"),ft=i("2fM7"),aa=i("+YFz"),ra=i("DBJ/"),e=i("nKUr"),ct,na=function(n){var a=n.type,r=n.onDataConverted,t=n.groupSelectDisabled,c=Object(te.b)(),l=c.semester_subject_id,o=c.teacherSubjectData,m=Object(j.useState)(null),S=Object(G.a)(m,2),p=S[0],g=S[1],v=Object(j.useMemo)(function(){var x;return((x=o==null?void 0:o.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{label:C,value:T}})},[]),d={type:a,group_id:p,semester_subject_id:l},f=Object(j.useCallback)(function(x){if(x.success){var O=x.data.results.filter(function(T){var C=T.user_id;return C!==null});if(!O.length)return;r({exam_results:O,group_id:x.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Y.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(ft.a,{disabled:t,value:p,onChange:function(O){return g(O)},options:v,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(ra.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(O){return!O.fileList.length&&r(void 0)},maxFiles:1,data:d,disabled:!p})]})},sa=function(n){var a=n.onDataConverted,r=Object(te.b)(),t=r.teacherSubjectData,c=r.groupUsers,l=Object(j.useState)(null),o=Object(G.a)(l,2),m=o[0],S=o[1],p=Object(j.useMemo)(function(){var v;return((v=t==null?void 0:t.groups)!==null&&v!==void 0?v:[]).map(function(d){var f=d.id,x=d.name;return{label:x,value:f}})},[]),g=Object(j.useCallback)(function(v){var d;S(v);var f=(d=c.byId)===null||d===void 0?void 0:d[v];if(!!f){var x=f.users.reduce(function(O,T){var C=T.id,_=T.email,B=T.first_name,K=T.last_name,ce=T.academic_teacher_id;return ce!==null?O:[].concat(Object(ae.a)(O),[{email:_,first_name:B,last_name:K,user_id:C,result:0}])},[]);a({group_id:v,exam_results:x})}},[c.byId]);return Object(e.jsx)(ft.a,{value:m,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},vt=(ct={},Object(Z.a)(ct,N.c.TestPortal,["/teacher-examples/testPortal.png"]),Object(Z.a)(ct,N.c.TeamsForms,["/teacher-examples/teamsForms.png"]),Object(Z.a)(ct,N.c.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),Object(Z.a)(ct,N.c.Manual,[]),ct),ua=function(n){var a=n.images,r=Object(j.useState)(!1),t=Object(G.a)(r,2),c=t[0],l=t[1],o=Object(j.useCallback)(function(){return l(!0)},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"see_file_example_image"}),children:Object(e.jsx)(se.a,{onClick:o,icon:Object(e.jsx)(aa.a,{})})}),Object(e.jsx)(k.a.PreviewGroup,{preview:{visible:c,onVisibleChange:l},children:a.map(function(m){return Object(e.jsx)(k.a,{style:{display:"none"},src:m},m)})})]})},ca=function(n){var a,r=n.type,t=n.onOk,c=n.onCancel,l=n.okDisabled,o=(a=vt==null?void 0:vt[r])!==null&&a!==void 0?a:vt[N.c.Manual];return Object(e.jsxs)(P.b,{style:{width:"100%",justifyContent:o.length?"space-between":"flex-end"},children:[!!o.length&&Object(e.jsx)(ua,{images:o}),Object(e.jsxs)(P.b,{children:[Object(e.jsx)(se.a,{onClick:c,children:Object(e.jsx)(s.a,{id:"cancel"})}),Object(e.jsx)(se.a,{type:"primary",disabled:l,onClick:t,children:Object(e.jsx)(s.a,{id:"ok"})})]})]})},ia=[N.c.TeamsLecture,N.c.TestPortal,N.c.TeamsForms],da=function(n){var a=n.open,r=n.closeModal,t=n.onSuccess,c=n.type,l=Object(te.b)(),o=l.teacherSubjectData,m=l.fetchGroupUsers,S=Object(j.useState)(),p=Object(G.a)(S,2),g=p[0],v=p[1];return Object(j.useEffect)(function(){if(c===N.c.Manual&&a){var d;o==null||(d=o.groups)===null||d===void 0||d.forEach(function(f){var x=f.id;return m(x)})}},[c,a]),Object(e.jsxs)(U.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:r,footer:Object(e.jsx)(ca,{type:c,onOk:function(){g&&t(g)},onCancel:r,okDisabled:!g}),children:[ia.includes(c)&&Object(e.jsx)(na,{type:c,onDataConverted:v,groupSelectDisabled:!!g}),c===N.c.Manual&&Object(e.jsx)(sa,{onDataConverted:v})]})},la=function(n){var a=n.onSelect;return Object(e.jsxs)(Ee.a,{gutter:[16,16],children:[Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(se.a,{type:"primary",onClick:function(){return a(N.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(se.a,{type:"primary",onClick:function(){return a(N.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(se.a,{type:"primary",onClick:function(){return a(N.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(se.a,{type:"primary",onClick:function(){return a(N.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},oa=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ja=function(n){var a,r=n.exam_id,t=Y.a.useForm(),c=Object(G.a)(t,1),l=c[0],o=Object(j.useState)(),m=Object(G.a)(o,2),S=m[0],p=m[1],g=Object(j.useState)(),v=Object(G.a)(g,2),d=v[0],f=v[1],x=Object(j.useState)(!1),O=Object(G.a)(x,2),T=O[0],C=O[1],_=Object(te.b)(),B=_.semester_subject_id,K=_.getGroupById,ce=Object(j.useMemo)(function(){var A;return((A=d==null?void 0:d.exam_results)!==null&&A!==void 0?A:[]).map(function($){var F=$.user_id;return F})},[d==null?void 0:d.exam_results]);Object(j.useEffect)(function(){var A=Number(r);r==="new"&&(p(void 0),f(void 0),l.resetFields()),r!=="new"&&!Number.isNaN(A)&&(C(!0),et(A).then(function($){if($.success){var F=$.data,H=F.type,Pe=F.results,ke=F.title,ne=F.weight,ue=F.passed_at,J=F.group_id;p(H),f({group_id:J,exam_results:Pe}),l.setFieldsValue({title:ke,weight:ne,passed_at:ue})}}).finally(function(){return C(!1)}))},[r]);var Fe=Object(j.useCallback)(function(){p(void 0),f(void 0)},[]);return T?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[S&&Object(e.jsx)(da,{open:Boolean(S&&!d),type:S,closeModal:Fe,onSuccess:f}),Object(e.jsxs)(Y.a,{form:l,submitter:S===void 0||!d?!1:void 0,onFinish:function(){var A=Object(R.a)(Object(h.a)().mark(function $(F){var H,Pe,ke,ne,ue,J,xe,Be,Se,He;return Object(h.a)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(Pe=d==null||(H=d.exam_results)===null||H===void 0?void 0:H.every(function(Q){var q=Q.result;return typeof q=="number"&&q>=0&&q<=100}),!(d&&Pe&&typeof B=="number")){ie.next=17;break}if(ke=F.title,ne=F.passed_at,ue=F.weight,J=Number(r),xe=d.exam_results,Be=d.group_id,Se={type:S,semester_subject_id:B,title:ke,passed_at:ne,weight:ue,group_id:Be,results:xe},!Number.isNaN(J)){ie.next=12;break}return ie.next=9,_e(Se);case 9:ie.t0=ie.sent,ie.next=15;break;case 12:return ie.next=14,Ce(J,Se);case 14:ie.t0=ie.sent;case 15:He=ie.t0,He.success&&s.f.push("/teacher/subjects/".concat(B,"/exams"));case 17:return ie.abrupt("return",!0);case 18:case"end":return ie.stop()}},$)}));return function($){return A.apply(this,arguments)}}(),onReset:Fe,children:[Object(e.jsxs)(Y.a.Group,{children:[Object(e.jsx)(ee.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(D.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(Y.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Oe.a,{})})]}),S&&d&&Object(e.jsx)(W.a,{rowKey:"user_id",headerTitle:(a=K(d.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:ce,onValuesChange:function($,F){return f({group_id:d.group_id,exam_results:F})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:d.exam_results,columns:oa}),!d&&Object(e.jsx)(la,{onSelect:p})]})]})},ba=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],ma=function(n){var a=n.exam_id,r=Object(j.useState)(""),t=Object(G.a)(r,2),c=t[0],l=t[1];return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(R.a)(Object(h.a)().mark(function o(){var m;return Object(h.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,et(a);case 2:if(m=p.sent,!m.success){p.next=6;break}return l(m.data.title),p.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},o)})),columns:ba})},fa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,a){return a.passed_at&&Object(Ne.a)(new Date(a.passed_at),w.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,a){return a.created_at&&Object(Ne.a)(new Date(a.created_at),w.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,a){return Object(e.jsx)(oe.a,{type:"Students",type_id:a.group_id},a.group_id)}}],va=function(){var n,a,r=Object(j.useRef)(),t=Object(te.b)(),c=t.semester_subject_id,l=Object(de.k)(),o=Object(j.useMemo)(function(){var p,g,v;return{exam_id:(p=(g=l.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(v=l.query)===null||v===void 0?void 0:v.results}},[(n=l.query)===null||n===void 0?void 0:n.exam_id,(a=l.query)===null||a===void 0?void 0:a.results]),m=o.exam_id,S=o.results;return S!==null&&!Number.isNaN(Number(S))?Object(e.jsx)(ma,{exam_id:Number(S)}):m!==null?Object(e.jsx)(ja,{exam_id:m}):Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var p=Object(R.a)(Object(h.a)().mark(function g(v,d){var f,x,O,T;return Object(h.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=v.current,x=v.pageSize,c!==null){_.next=3;break}return _.abrupt("return",{data:[],total:0,success:!1});case 3:return O=d&&Object.entries(d)[0],_.next=6,E({per_page:x,page:f,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:O&&O[0],order:O&&(O[1]==="ascend"?"ASC":"DESC")});case 6:if(T=_.sent,!T.success){_.next=9;break}return _.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return _.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return _.stop()}},g)}));return function(g,v){return p.apply(this,arguments)}}(),columns:[].concat(fa,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,v){return[Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?exam_id=").concat(v.id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(se.a,{type:"primary",icon:Object(e.jsx)(rt.a,{})})})},"edit"),Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?results=").concat(v.id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(se.a,{icon:Object(e.jsx)(ut.a,{})})})},"results"),Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(R.a)(Object(h.a)().mark(function d(){var f;return Object(h.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,ot(v.id);case 2:f=O.sent,f.success&&r.current&&r.current.reload();case 4:case"end":return O.stop()}},d)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(se.a,{type:"primary",icon:Object(e.jsx)(le.a,{}),danger:!0})})},"delete")]}}])})},ht=i("o0Ox"),$r=i("miYZ"),it=i("tsqr"),Oa=i("4KAj");function pa(u,n){return gt.apply(this,arguments)}function gt(){return gt=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),gt.apply(this,arguments)}var ha=function(n){var a=n.student_id,r=Object(j.useState)(!1),t=Object(G.a)(r,2),c=t[0],l=t[1],o=Object(j.useCallback)(Object(R.a)(Object(h.a)().mark(function m(){var S;return Object(h.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l(!0),g.next=3,pa({user_id:a});case 3:if(S=g.sent,S.success){g.next=8;break}return it.b.error(S.message),l(!1),g.abrupt("return");case 8:window.open(S.data.web_url,"_blank","noopener noreferrer"),l(!1);case 10:case"end":return g.stop()}},m)})),[]);return Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(se.a,{loading:c,type:"primary",icon:Object(e.jsx)(Oa.a,{}),onClick:o})})},ga=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],xa=function(n){return n.map(function(a){var r=a.id,t=a.name;return{label:t,value:r}})},Sa=function(n){return n.reduce(function(a,r){var t,c=r==null||(t=r.users)===null||t===void 0?void 0:t.reduce(function(l,o){return o.academic_teacher_id!==null?l:[].concat(Object(ae.a)(l),[{group_id:r.id,group_name:r.name,user_id:o.id,first_name:o.first_name,last_name:o.last_name,email:o.email}])},[]);return[].concat(Object(ae.a)(a),Object(ae.a)(c))},[])},ya=function(){var n=Object(te.b)(),a=n.teacherSubjectData,r=Object(j.useMemo)(function(){var t;return xa((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(R.a)(Object(h.a)().mark(function c(l){var o,m,S,p,g,v,d,f,x;return Object(h.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return o=l.groups,m=l.first_name,S=m===void 0?"":m,p=l.last_name,g=p===void 0?"":p,v=l.email,d=v===void 0?"":v,T.next=3,Object(ht.a)({parent_id:a==null?void 0:a.group_id,"id[]":o});case 3:if(f=T.sent,f.success){T.next=6;break}return T.abrupt("return",{data:[],total:0,success:!1});case 6:return x=Sa(f.data).filter(function(C){return C.first_name.toLowerCase().includes(S.toLowerCase())&&C.last_name.toLowerCase().includes(g.toLowerCase())&&C.email.toLowerCase().includes(d.toLowerCase())}),T.abrupt("return",{data:x,total:x.length,success:!0});case 8:case"end":return T.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(ga,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,l){return[Object(e.jsx)(ha,{student_id:l.user_id},"teamsChat")]}}])})};function xt(u,n){return St.apply(this,arguments)}function St(){return St=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),St.apply(this,arguments)}function _a(u,n,a,r){return yt.apply(this,arguments)}function yt(){return yt=Object(R.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(b.a)({data:{attendances:[{user_id:a,value:r}]},method:"POST"},t||{})));case 1:case"end":return l.stop()}},u)})),yt.apply(this,arguments)}var Pr=i("sRBo"),Ut=i("kaz8");function Ca(u){var n,a,r=u===null?N.a.ABSENT:u,t=(n={},Object(Z.a)(n,N.a.PRESENT,{ch1:!0,ch2:!1}),Object(Z.a)(n,N.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(Z.a)(n,N.a.ABSENT,{ch1:!1,ch2:!1}),Object(Z.a)(n,N.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),n);return(a=t[r])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function Ta(u){var n,a=u.ch1,r=u.ch2,t="".concat(a,"_").concat(r),c={true_false:N.a.PRESENT,true_true:N.a.PRESENT_NOT_EXERCISING,false_false:N.a.ABSENT,false_true:N.a.EXCUSED_ABSENCE};return(n=c[t])!==null&&n!==void 0?n:N.a.ABSENT}var Ea=function(n){var a=n.groupAttendanceScheduleId,r=n.studentId,t=n.attendance,c=n.onSuccess,l=Object(j.useState)(Ca(t)),o=Object(G.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(j.useRef)(!0),x=Object(j.useCallback)(function(C){d(!0),_a(a,r,Ta(C)).then(function(_){_.success&&(c==null||c())}).finally(function(){return d(!1)})},[]),O=Object(j.useCallback)(function(C){return S(C.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),T=Object(j.useCallback)(function(C){return S(function(_){return Object(b.a)(Object(b.a)({},_),{},{ch2:C.target.checked})})},[]);return Object(j.useEffect)(function(){if(f.current){f.current=!1;return}x(m)},[m,x]),Object(e.jsxs)(P.b,{children:[Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Ut.a,{disabled:v,checked:m.ch1,onChange:O})}),Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Ut.a,{disabled:v,checked:m.ch2,onChange:T})})]})},_t=Ea,Ga=function(){var n=Object(te.b)(),a=n.teacherSubjectData,r=Object(j.useState)([]),t=Object(G.a)(r,2),c=t[0],l=t[1],o=Object(j.useState)(""),m=Object(G.a)(o,2),S=m[0],p=m[1],g=Object(s.l)(),v=Object(j.useRef)(),d=Object(j.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{value:T,label:C}})},[a==null?void 0:a.groups]),f=Object(j.useMemo)(function(){var x;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:d,defaultValue:d==null||(x=d[0])===null||x===void 0?void 0:x.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ae.a)(c))},[d,c]);return Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(S,")"),request:function(){var x=Object(R.a)(Object(h.a)().mark(function O(T){var C,_,B,K,ce,Fe,A,$,F,H,Pe;return Object(h.a)().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return _=T.group_id,B=_===void 0?d==null||(C=d[0])===null||C===void 0?void 0:C.value:_,K=T.full_name,ce=K===void 0?"":K,ne.next=3,Promise.all([Object(ht.b)(B),xt(B)]);case 3:if(Fe=ne.sent,A=Object(G.a)(Fe,2),$=A[0],F=A[1],H=d.find(function(ue){var J=ue.value;return J===B}),!(!$.success||!F.success||!H)){ne.next=10;break}return ne.abrupt("return",{data:[],total:0,success:!1});case 10:if(F.data.length){ne.next=13;break}return it.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),ne.abrupt("return",{data:[],total:0,success:!1});case 13:return p(H.label),l(F.data.reduce(function(ue,J){return[].concat(Object(ae.a)(ue),[{title:String(Object(Ne.a)(new Date(J.date_from),w.c)),dataIndex:String(J.date_from),hideInSearch:!0,width:100,align:"center",render:function(Be,Se){return Object(e.jsx)(_t,{groupAttendanceScheduleId:J.id,attendance:Se["".concat(J==null?void 0:J.date_from)],studentId:Se.id})}}])},[])),Pe=$.data.users.reduce(function(ue,J){var xe=J.id,Be=J.academic_teacher_id,Se=J.first_name,He=J.last_name,Qe="".concat(He," ").concat(Se);if(Be!==null||!Qe.toLowerCase().includes(ce.toLowerCase()))return ue;var ie=F.data.reduce(function(Q,q){var re=q.attendances.find(function(fe){return fe.user_id===xe});return re?Object(b.a)(Object(b.a)({},Q),{},Object(Z.a)({},"".concat(q.date_from),re.value)):Q},{});return[].concat(Object(ae.a)(ue),[Object(b.a)({id:xe,full_name:Qe},ie)])},[]).sort(function(ue,J){return ue.full_name.localeCompare(J.full_name)}),ne.abrupt("return",{data:Pe,total:Pe.length,success:!0});case 17:case"end":return ne.stop()}},O)}));return function(O){return x.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{onChange:function(){var O;return(O=v.current)===null||O===void 0?void 0:O.reload()}},scroll:{x:1500},actionRef:v,rowKey:"id"})},Ar=i("tU7J"),Je=i("wFql"),wr=i("/zsF"),Ct=i("PArb"),Ma=i("Hn4i"),Ia=i("bRQS");function Tt(u,n,a){return Et.apply(this,arguments)}function Et(){return Et=Object(R.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),Et.apply(this,arguments)}function Fa(u,n,a,r){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(R.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"POST",data:r},t||{})));case 1:case"end":return l.stop()}},u)})),Gt.apply(this,arguments)}function Bt(u,n){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(b.a)({method:"GET",params:{"groups[]":n},useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Mt.apply(this,arguments)}function Da(u,n,a){return It.apply(this,arguments)}function It(){return It=Object(R.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(a),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),It.apply(this,arguments)}function Kt(u){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(R.a)(Object(h.a)().mark(function u(n){return Object(h.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},u)})),Ft.apply(this,arguments)}function Wt(u,n){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Dt.apply(this,arguments)}function Vt(u,n){return $t.apply(this,arguments)}function $t(){return $t=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(b.a)({method:"POST",data:n},a||{})));case 1:case"end":return t.stop()}},u)})),$t.apply(this,arguments)}function kt(u,n,a){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(R.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"PATCH",data:a},r||{})));case 1:case"end":return c.stop()}},u)})),Pt.apply(this,arguments)}function Ht(u,n){return At.apply(this,arguments)}function At(){return At=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),At.apply(this,arguments)}var $a=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Pa=function(n){var a=n.subjectTutorGradeScale,r=n.onFormSubmit,t=Object(j.useState)([]),c=Object(G.a)(t,2),l=c[0],o=c[1],m=Object(j.useRef)(),S=Y.a.useForm(),p=Object(G.a)(S,1),g=p[0];return Object(j.useEffect)(function(){var v,d=((v=a.scale)!==null&&v!==void 0?v:[]).map(function(f,x){return Object(b.a)(Object(b.a)({},f),{},{id:String((x+1)*100)})});g.setFieldValue("table",d)},[]),Object(e.jsx)(Y.a,{form:g,onFinish:r,submitter:{render:function(d,f){var x=Object(G.a)(f,2),O=x[1];return[O]}},children:Object(e.jsx)(Ma.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat($a,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(d,f){return Object(e.jsx)(se.a,{type:"primary",onClick:function(){var O;return(O=m.current)===null||O===void 0?void 0:O.startEditable(f.id)},icon:Object(e.jsx)(rt.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:l,saveText:Object(e.jsx)(se.a,{type:"primary",icon:Object(e.jsx)(Ia.a,{})}),onChange:o,actionRender:function(d,f,x){return[x.save]}}})})},Aa=function(){var n,a,r=Object(s.m)("@@initialState"),t=r.initialState,c=Object(te.b)(),l=c.semester_subject_id,o=c.tutors,m=Object(j.useState)(),S=Object(G.a)(m,2),p=S[0],g=S[1],v=Object(j.useState)(!1),d=Object(G.a)(v,2),f=d[0],x=d[1],O=Object(j.useState)(null),T=Object(G.a)(O,2),C=T[0],_=T[1],B=Object(j.useMemo)(function(){return!!o.data.find(function(A){var $,F=A.id;return F===(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)})},[o.data,t==null||(n=t.currentUser)===null||n===void 0?void 0:n.id]),K=Object(j.useMemo)(function(){return o.data.map(function(A){var $=A.id,F=A.first_name,H=A.last_name;return{label:"".concat(F," ").concat(H),value:$}})},[o.data]),ce=Object(j.useCallback)(function(){l===null||C===null||(x(!0),g(void 0),Tt(l,C).then(function(A){A.success&&g(A.data)}).finally(function(){x(!1)}))},[l,C]),Fe=Object(j.useCallback)(function(A,$){return function(){var F=Object(R.a)(Object(h.a)().mark(function H(Pe){var ke,ne;return Object(h.a)().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(!(l===null||C===null)){J.next=2;break}return J.abrupt("return");case 2:return ke=A.reduce(function(xe,Be){return Be.s_subject_scale_form_id===$?[].concat(Object(ae.a)(xe),[{s_subject_scale_form_id:$,scale:Pe.table.map(function(Se){var He=Se.name,Qe=Se.grade,ie=Se.grade_value;return{name:He,grade:Qe,grade_value:ie}})}]):[].concat(Object(ae.a)(xe),[Be])},[]),J.next=5,Fa(l,C,{grade_scale:ke});case 5:ne=J.sent,ne.success&&ce();case 7:case"end":return J.stop()}},H)}));return function(H){return F.apply(this,arguments)}}()},[C,l]);return Object(j.useEffect)(function(){var A,$;if(!B||!(t!=null&&(A=t.currentUser)!==null&&A!==void 0&&A.id)){var F;if((F=o.data)!==null&&F!==void 0&&F[0]){var H;_((H=o.data)===null||H===void 0?void 0:H[0].id)}return}_(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,B]),Object(j.useEffect)(function(){ce()},[ce]),o.loading?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Y.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(ft.a,{disabled:B,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:K,value:C,onChange:function($){return _($)}})}),Object(e.jsx)(Ct.a,{}),f&&!p&&Object(e.jsx)(ve.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(A,$){var F;return Object(e.jsxs)(nt.a.Fragment,{children:[$>0&&Object(e.jsx)(Ct.a,{}),Object(e.jsx)(Pa,{subjectTutorGradeScale:A,onFormSubmit:Fe((F=p.grade_scale)!==null&&F!==void 0?F:[],A.s_subject_scale_form_id)})]},A.s_subject_scale_form_id)}):Object(e.jsx)(Je.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Rr=i("qbNl"),wa=i("JBPa"),Lr=i("Awhp"),Ra=i("KrTs"),La=i("wd/R"),Ze=i.n(La);function Na(u,n){return wt.apply(this,arguments)}function wt(){return wt=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(b.a)({params:n,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),wt.apply(this,arguments)}var Nr=i("5R/X"),Ua=function(){var n=Object(j.useState)(null),a=Object(G.a)(n,2),r=a[0],t=a[1],c=Object(j.useState)([]),l=Object(G.a)(c,2),o=l[0],m=l[1],S=Object(te.b)(),p=S.semester_subject_id,g=Ze()(),v=Object(j.useMemo)(function(){return o.map(function(_){return{id:_.id,title:"".concat(_.group.name," (").concat(_.term_status.name,")"),start:Ze()(_.date_from).toDate(),end:Ze()(_.date_to).toDate(),tutor_name:"".concat(_.tutor.first_name," ").concat(_.tutor.last_name),tutor_email:_.tutor.email,semester:_.semester.name,group:_.group.name,subject:_.subject.name,ms_teams_join_url:_.ms_teams_join_url}})},[o]),d=Object(j.useCallback)(function(_,B){Na({semester_subject_id:p,date_form:_.toDate(),date_to:B.toDate()}).then(function(K){K.success&&m(K.data)})},[p]),f=Object(j.useCallback)(function(_){t(_)},[]),x=Object(j.useCallback)(function(){t(null)},[]),O=Object(j.useCallback)(function(_){return _.isSame(g,"day")?"warning":_.isAfter(g,"day")?"success":"error"},[]),T=Object(j.useCallback)(function(_){var B=v.filter(function(K){return Ze()(K.start).isSame(_,"day")});return Object(e.jsx)("ul",{className:"events",children:B.map(function(K){return Object(e.jsx)("li",{onClick:function(){return f(K)},children:Object(e.jsx)(Ra.a,{status:O(Ze()(K.start)),text:K.title})},K.id)})})},[o]),C=Object(j.useCallback)(function(_,B){var K=Ze()(_).startOf(B).subtract(1,"month"),ce=Ze()(_).endOf(B).add(1,"month");d(K,ce)},[]);return Object(j.useEffect)(function(){var _=Ze()().startOf("month"),B=Ze()().endOf("month");d(_,B)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(wa.a,{dateCellRender:T,onPanelChange:C}),Object(e.jsxs)(U.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:x,footer:null,children:[Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&Ze()(r.start).format(w.b)]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&Ze()(r.end).format(w.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(Je.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(se.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},zt=i("yj/a"),Jt=i("5Syx"),Ot=i("PpiC"),Rt=i("H6aw"),Ba=i("p3I6"),Ka=["results"],Yt=function(n,a){return n.reduce(function(r,t){var c=t.results,l=Object(Ot.a)(t,Ka),o=c.find(function(m){return m.user_id===a});return o?[].concat(Object(ae.a)(r),[Object(b.a)(Object(b.a)({},l),{},{result:o})]):r},[])},Xt=function(n,a){var r,t=n.reduce(function(d,f){var x=f.result,O=f.weight;return[d[0]+x.result*O,d[1]+O]},[0,0]),c=Object(G.a)(t,2),l=c[0],o=c[1],m=Number.isNaN(l/o)?0:l/o,S=a.sort(function(d,f){return d.grade_value-f.grade_value}).reduce(function(d,f){return[].concat(Object(ae.a)(d),[Object(b.a)(Object(b.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(S.every(function(d){var f=d.isWeightedAverageGreater;return f})){var p,g;return(p=(g=S.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var v=S.findIndex(function(d){var f=d.isWeightedAverageGreater;return!f});return v<0?"":(r=S[v-1])===null||r===void 0?void 0:r.name},Zt=function(n,a){var r;return(r=a.find(function(t){return t.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},Wa=["attendances"];function Va(u){return function(a){u(function(r){return Object(b.a)(Object(b.a)({},r),{},{loading:a})})}}function Qt(u,n){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(R.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n(!0),t.prev=1,t.abrupt("return",a());case 3:return t.prev=3,n(!1),t.finish(3);case 6:case"end":return t.stop()}},u,null,[[1,,3,6]])})),Lt.apply(this,arguments)}function ka(u,n){var a=Object(j.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(Va(c),[]),o=Object(j.useCallback)(Object(R.a)(Object(h.a)().mark(function S(){var p;return Object(h.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Da(u,n);case 2:if(p=v.sent,p.success){v.next=5;break}return v.abrupt("return",p);case 5:return c(function(d){return Object(b.a)(Object(b.a)({},d),{},{data:p.data})}),v.abrupt("return",p);case 7:case"end":return v.stop()}},S)})),[n,u]),m=Object(j.useCallback)(function(S){return Qt(l,function(){return Ht(S).then(o)})},[o]);return Object(j.useEffect)(function(){Qt(l,o)},[o]),{finalGrades:t,deleteFinalGrade:m}}function Ha(){var u=Object(j.useState)({loading:!1}),n=Object(G.a)(u,2),a=n[0],r=n[1];return Object(j.useEffect)(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!0})}),Kt().then(function(t){t.success&&r(function(c){return Object(b.a)(Object(b.a)({},c),{},{data:t.data})})}).finally(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function za(u){var n=Object(j.useState)({loading:!1}),a=Object(G.a)(n,2),r=a[0],t=a[1];return Object(j.useEffect)(function(){u!==void 0&&(t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!0})}),Wt(u).then(function(c){c.success&&t(function(l){return Object(b.a)(Object(b.a)({},l),{},{data:c.data})})}).finally(function(){t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!1})})}))},[u]),{subjectGradeScales:r}}function Ja(u,n,a){var r=Object(j.useState)({loading:!1}),t=Object(G.a)(r,2),c=t[0],l=t[1];return Object(j.useEffect)(function(){typeof u!="number"||typeof n!="number"||typeof a!="number"||(l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),Tt(u,n).then(function(o){o.success&&l(function(m){var S,p;return Object(b.a)(Object(b.a)({},m),{},{data:(S=Zt(a,(p=o.data.grade_scale)!==null&&p!==void 0?p:[]))===null||S===void 0?void 0:S.map(function(g,v){return Object(b.a)(Object(b.a)({},g),{},{id:v})})})})}).finally(function(){l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})}))},[u,n]),{tutorGradeScales:c}}function Ya(u,n){var a=Object(j.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),xt(u).then(function(o){if(o.success){var m=o.data.reduce(function(S,p){var g=p.attendances,v=Object(Ot.a)(p,Wa),d=g.find(function(f){return f.user_id===n});return d?[].concat(Object(ae.a)(S),[Object(b.a)(Object(b.a)({},v),{},{attendance:d})]):S},[]);c(function(S){return Object(b.a)(Object(b.a)({},S),{},{data:m})})}}).finally(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})})},[u,n]);return Object(j.useEffect)(function(){l()},[l]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:l}}function Xa(u,n){var a=Object(j.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1];return Object(j.useEffect)(function(){!n||(c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!0})}),E({student_id:u,semester_subject_id:n}).then(function(l){if(l.success){var o=Yt(l.data,u);c(function(m){return Object(b.a)(Object(b.a)({},m),{},{data:o})})}}).finally(function(){c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!1})})}))},[u,n]),{studentExams:t}}function Za(u,n){var a=Object(j.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1],l=Object(j.useState)({loading:!1}),o=Object(G.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)({loading:!1}),g=Object(G.a)(p,2),v=g[0],d=g[1];return Object(j.useEffect)(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Object(Rt.e)({group_id:u}).then(function(f){f.success&&c(function(x){return Object(b.a)(Object(b.a)({},x),{},{data:f.data})})}).finally(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})})},[u]),Object(j.useEffect)(function(){!t.data||(d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Rt.n)(Number(x))})).then(function(f){f.forEach(function(x){x.success&&d(function(O){return Object(b.a)(Object(b.a)({},O),{},{data:Object(b.a)(Object(b.a)({},O.data),{},Object(Z.a)({},Number(x.data.id),Object(Ba.c)(x.data.lessons)))})})})}).finally(function(){d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}),S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Rt.l)(Number(x),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(O){if(O.success){var T,C,_=((T=O.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&T!==void 0?T:[]).filter(function(K){return K.id===n}),B=(C=O.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&C!==void 0?C:[];S(function(K){return Object(b.a)(Object(b.a)({},K),{},{data:Object(b.a)(Object(b.a)({},K.data),{},Object(Z.a)({},Number(x),{finishedTopics:_,attendanceList:B}))})})}})})).finally(function(){return S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}))},[t.data,n]),{userCourses:t,userCoursesStats:m,userCoursesTopics:v}}var Qa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],qa=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(n,a){return Object(Ne.a)(new Date(a.date_from),w.c)}}],er=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,a){return Object(Ne.a)(new Date(a.created_at),w.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(n,a){return"".concat(a.result.result,"%")}}],tr=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=a.grade)!==null&&r!==void 0&&r.grade_date?Object(Ne.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),w.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&r!==void 0?r:"-"}}],pt=6,ar=function(n){var a,r,t,c,l=n.user_id,o=n.group_id,m=Object(te.b)(),S=m.semester_subject_id,p=Xa(l,S),g=p.studentExams,v=ka(o,l),d=v.finalGrades,f=v.deleteFinalGrade,x=Ha(),O=x.gradeTerms,T=za((a=d.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),C=T.subjectGradeScales,_=Ja(S,(r=d.data)===null||r===void 0?void 0:r.tutor_id,(t=d.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),B=_.tutorGradeScales,K=Ya(o,l),ce=K.userAttendanceSchedules,Fe=K.fetchUserAttendanceSchedules,A=Za(o,l),$=A.userCourses,F=A.userCoursesStats,H=A.userCoursesTopics,Pe=Y.a.useForm(),ke=Object(G.a)(Pe,1),ne=ke[0],ue=Object(j.useMemo)(function(){var Q;return((Q=O.data)!==null&&Q!==void 0?Q:[]).map(function(q){var re=q.id,fe=q.name;return{label:fe,value:re}})},[O.data]),J=Object(j.useMemo)(function(){var Q;return((Q=C.data)!==null&&Q!==void 0?Q:[]).map(function(q){var re=q.name,fe=q.id;return{label:re,value:fe}})},[C.data]),xe=Object(j.useMemo)(function(){var Q,q;return Xt((Q=g.data)!==null&&Q!==void 0?Q:[],(q=B.data)!==null&&q!==void 0?q:[])},[g.data,B.data]),Be=Object(j.useCallback)(function(){var Q=Object(R.a)(Object(h.a)().mark(function q(re){var fe,Ke,at,he,We,De,Ve;return Object(h.a)().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(at=re.grade_scale_id,he=re.grade_term_id,((fe=d.data)===null||fe===void 0?void 0:fe.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(We=(Ke=d.data)===null||Ke===void 0?void 0:Ke.grades.find(function(lt){var Nt=lt.grade_term;return Nt.id===he}),!We){Re.next=11;break}return Re.next=7,kt(We.id,{grade_scale_id:at});case 7:return De=Re.sent,it.b[De.success?"success":"error"](De.message),De.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,Vt({grade_scale_id:at,grade_term_id:he,lesson_group_user_id:d.data.id});case 13:Ve=Re.sent,it.b[Ve.success?"success":"error"](Ve.message),Ve.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades"));case 16:case"end":return Re.stop()}},q)}));return function(q){return Q.apply(this,arguments)}}(),[d.data,S]),Se=Object(j.useMemo)(function(){return[].concat(tr,[{title:Object(e.jsx)(s.a,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(q,re){var fe;return typeof(re==null||(fe=re.grade)===null||fe===void 0?void 0:fe.id)=="number"?[Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return f(re.grade.id)},okText:Object(e.jsx)(s.a,{id:"yes",defaultMessage:"Yes"}),cancelText:Object(e.jsx)(s.a,{id:"no",defaultMessage:"No"}),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(se.a,{type:"primary",icon:Object(e.jsx)(le.a,{}),danger:!0})})},"delete")]:[]}}])},[]),He=Object(j.useMemo)(function(){var Q;return((Q=O.data)!==null&&Q!==void 0?Q:[]).map(function(q){var re;return Object(b.a)(Object(b.a)({},q),{},{grade:(re=d.data)===null||re===void 0?void 0:re.grades.find(function(fe){var Ke=fe.grade_term;return Ke.id===q.id})})})},[d.data,O.data]),Qe=$.loading&&!$.data||F.loading&&!F.data||H.loading&&!H.data,ie=Boolean($.data&&F.data&&H.data);return d.loading?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[d.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:d.data.user})}),Object(e.jsx)(Ct.a,{})]}),Object(e.jsxs)(Ee.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:pt},dataSource:g.data,loading:g.loading,columns:er,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:pt},dataSource:He,loading:d.loading||O.loading,columns:Se,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:pt},cardProps:{bodyStyle:{padding:0}},dataSource:ce.data,loading:ce.loading,columns:[].concat(qa,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(q,re){return Object(e.jsx)(_t,{groupAttendanceScheduleId:re.id,studentId:l,attendance:re.attendance.value,onSuccess:Fe})}}])})}),Object(e.jsx)(X.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:pt},cardProps:{bodyStyle:{padding:0}},dataSource:B.data,loading:B.loading,columns:Qa})}),Qe&&Object(e.jsx)(ve.a,{}),ie&&((c=$.data)===null||c===void 0?void 0:c.map(function(Q){var q,re,fe,Ke,at,he,We,De,Ve=Q.id,dt=Q.title;return Object(e.jsxs)(X.a,{span:24,children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:dt}),Object(e.jsx)(Jt.c,{course_id:Number(Ve),topics:(q=(re=H.data)===null||re===void 0?void 0:re[Number(Ve)])!==null&&q!==void 0?q:[],stats:(fe=(Ke=F.data)===null||Ke===void 0||(at=Ke[Number(Ve)])===null||at===void 0?void 0:at.finishedTopics)!==null&&fe!==void 0?fe:[]}),Object(e.jsx)(Jt.a,{stats:(he=(We=F.data)===null||We===void 0||(De=We[Number(Ve)])===null||De===void 0?void 0:De.attendanceList)!==null&&he!==void 0?he:[]})]},Ve)}))]}),Object(e.jsx)(Y.a,{form:ne,onFinish:Be,children:Object(e.jsxs)(Y.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(zt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ue,width:"sm",fieldProps:{loading:O.loading}}),Object(e.jsx)(zt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:J,fieldProps:{loading:d.loading||C.loading}}),Object(e.jsx)(Y.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:xe}})})]})})]})},rr=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(r){var t=r.grade_name,c=r.grade_term,l=r.id;return Object(e.jsxs)(Je.a.Text,{children:[c.name,": ",t]},l)}):"-"})}}],nr=function(){var n,a,r=Object(de.k)(),t=Object(j.useMemo)(function(){var g,v,d,f;return{user_id:Number.isNaN(Number((g=r.query)===null||g===void 0?void 0:g.user_id))?null:Number((v=r.query)===null||v===void 0?void 0:v.user_id),group_id:Number.isNaN(Number((d=r.query)===null||d===void 0?void 0:d.group_id))?null:Number((f=r.query)===null||f===void 0?void 0:f.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(a=r.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,l=t.group_id,o=Object(te.b)(),m=o.teacherSubjectData,S=o.semester_subject_id,p=Object(j.useMemo)(function(){var g;return((g=m==null?void 0:m.groups)!==null&&g!==void 0?g:[]).map(function(v){var d=v.id,f=v.name;return{label:f,value:d}})},[m==null?void 0:m.groups]);return c!==null&&l!==null?Object(e.jsx)(ar,{user_id:c,group_id:l}):Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var g=Object(R.a)(Object(h.a)().mark(function v(d){var f,x,O,T,C,_,B,K,ce,Fe;return Object(h.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return x=d.group_id,O=x===void 0?[]:x,T=d.first_name,C=T===void 0?"":T,_=d.last_name,B=_===void 0?"":_,K=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function(F){var H=F.id;return H}),$.next=4,Bt(O.length===0?K:O);case 4:if(ce=$.sent,ce.success){$.next=7;break}return $.abrupt("return",{success:!1,total:0,data:[]});case 7:return Fe=ce.data.filter(function(F){var H=F.user;return H.first_name.toLowerCase().includes(C.toLowerCase())&&H.last_name.toLowerCase().includes(B.toLowerCase())}),$.abrupt("return",{success:!0,total:Fe.length,data:Fe});case 9:case"end":return $.stop()}},v)}));return function(v){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(v,d){return Object(e.jsx)(oe.a,{type:"Students",type_id:d.group_id},d.group_id)}}].concat(rr,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(v,d){return[Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(S,"/final-grades?user_id=").concat(d.user.id,"&group_id=").concat(d.group_id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(se.a,{type:"primary",icon:Object(e.jsx)(rt.a,{})})})},"edit")]}}])})},sr=i("dF/Y"),ur=i("o+0V"),qt=i("0WSk"),cr=["type","defaultRender"],ir=["type","defaultRender"],dr=function(n){var a=n.url;return Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(se.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(sr.a,{})})})},lr=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,a){return Object(Ne.a)(new Date(a.created_at),w.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(Ot.a)(a,cr);if(t==="form")return null;var o=r.getFieldValue("state");return Object(e.jsx)(qt.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(n,a){var r,t;return Object(e.jsx)(oe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id,text:a!=null&&(r=a.created_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.created_by)!==null&&t!==void 0&&t.last_name?"".concat(a.created_by.first_name," ").concat(a.created_by.last_name):void 0},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,a){return Object(Ne.a)(new Date(a.exported_at),w.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(Ot.a)(a,ir);if(t==="form")return null;var o=r.getFieldValue("state");return Object(e.jsx)(qt.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(n,a){var r,t;return Object(e.jsx)(oe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id,text:a!=null&&(r=a.exported_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.exported_by)!==null&&t!==void 0&&t.last_name?"".concat(a.exported_by.first_name," ").concat(a.exported_by.last_name):void 0},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(n,a){return[Object(e.jsx)(dr,{url:a.url},"download")]}}],or=function(){var n,a,r=Object(te.b)(),t=r.teacherSubjectData,c=Object(j.useMemo)(function(){var o;return((o=t==null?void 0:t.groups)!==null&&o!==void 0?o:[]).map(function(m){var S=m.id,p=m.name;return{value:S,label:p}})},[t==null?void 0:t.groups]),l=Object(j.useMemo)(function(){var o,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(o=t.groups)===null||o===void 0||(m=o[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(lr)},[t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var o=Object(R.a)(Object(h.a)().mark(function m(S){var p,g,v,d,f,x,O;return Object(h.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=S.group_id,d=v===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:v,f=S.created_by,x=S.exported_by,C.next=3,Object(ur.a)({group_id:d,created_by:f,exported_by:x});case 3:if(O=C.sent,O.success){C.next=6;break}return C.abrupt("return",{success:!1,data:[],total:0});case 6:return C.abrupt("return",{success:!0,data:O.data,total:O.data.length});case 7:case"end":return C.stop()}},m)}));return function(m){return o.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500}})},jr=function(n,a){var r;return(r=n.find(function(t){return t.name===a}))===null||r===void 0?void 0:r.id},br=function(n){var a=n.term,r=n.gradeScales,t=n.defaultFinalGrade,c=n.finalGrades,l=Object(j.useState)(t),o=Object(G.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(j.useMemo)(function(){return r.map(function(O){var T=O.name,C=O.id;return{value:C,label:T}})},[r]),x=Object(j.useCallback)(function(O){if(!!(c!=null&&c.id)){if(O===void 0){if(!m)return;d(!0),Ht(m.id).then(function(T){!T.success||S(void 0)}).finally(function(){return d(!1)});return}if(m){d(!0),kt(m.id,{grade_scale_id:O}).finally(function(){return d(!1)});return}d(!0),Vt({grade_term_id:a.id,grade_scale_id:O,lesson_group_user_id:c.id}).then(function(T){if(T.success){var C=T.data.grades.find(function(_){return _.grade_term.id===a.id});S(C)}}).finally(function(){return d(!1)})}},[m,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(ft.a,{allowClear:!0,loading:v,disabled:v,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:x,options:f,defaultValue:jr(r,t==null?void 0:t.grade_name)}):null},mr=i("LvDl"),fr=function(n){var a=n.exam_id,r=n.result,t=n.student_id,c=n.onSuccess,l=Object(j.useCallback)(Object(mr.debounce)(function(o){Te(a,t,{result:o!=null?o:0}).then(function(m){m.success&&(c==null||c(m.data))})},300),[a,r,t]);return Object(e.jsx)(Oe.a,{type:"number",min:0,max:100,onChange:l,defaultValue:r})},vr=function(n){var a=n.reduce(function(r,t){return[].concat(Object(ae.a)(r),[{title:Object(Ne.a)(new Date(t.date_from),w.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(l,o){return Object(e.jsx)(_t,{groupAttendanceScheduleId:t.id,attendance:o["attendance-".concat(t==null?void 0:t.date_from)],studentId:o.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Or=function(n,a){return n.reduce(function(r,t){var c=t.attendances.find(function(l){return l.user_id===a});return c?Object(b.a)(Object(b.a)({},r),{},Object(Z.a)({},"attendance-".concat(t.date_from),c.value)):r},{})},pr=function(n){var a=n.reduce(function(r,t){return[].concat(Object(ae.a)(r),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(l,o){var m;return(o==null||(m=o["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(fr,{result:o==null?void 0:o["exam-".concat(t.id)].result,exam_id:t.id,student_id:o.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},hr=function(n){return n.reduce(function(a,r){var t=r.result,c=r.id;return Object(b.a)(Object(b.a)({},a),{},Object(Z.a)({},"exam-".concat(c),t))},{})},gr=function(n,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(c,l){return Object(e.jsx)(br,{defaultFinalGrade:l["final-grade-".concat(r.id)],finalGrades:l.final_grades,term:r,gradeScales:a})}}})}},xr=function(n,a){return n.find(function(r){return r.user.id===a})},Sr=function(n){var a;return((a=n==null?void 0:n.grades)!==null&&a!==void 0?a:[]).reduce(function(r,t){return Object(b.a)(Object(b.a)({},r),{},Object(Z.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},yr=function(){var n,a,r=Object(te.b)(),t=r.teacherSubjectData,c=r.semester_subject_id,l=Object(j.useState)([]),o=Object(G.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.name),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(s.l)(),x=Object(j.useMemo)(function(){var C;return((C=t==null?void 0:t.groups)!==null&&C!==void 0?C:[]).map(function(_){var B=_.id,K=_.name;return{value:B,label:K}})},[t==null?void 0:t.groups]),O=Object(j.useRef)(),T=Object(j.useMemo)(function(){var C;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:x,defaultValue:x==null||(C=x[0])===null||C===void 0?void 0:C.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ae.a)(m))},[x,m]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var C=Object(R.a)(Object(h.a)().mark(function _(B){var K,ce,Fe,A,$,F,H,Pe,ke,ne,ue,J,xe,Be,Se,He,Qe,ie,Q,q,re,fe,Ke;return Object(h.a)().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return F=B.group_id,H=F===void 0?(K=x[0])===null||K===void 0?void 0:K.value:F,Pe=B.full_name,ke=Pe===void 0?"":Pe,he.next=3,Bt(H);case 3:if(ne=he.sent,ue=x.find(function(We){var De=We.value;return De===H}),!(!ne.success||ne.data[0]===void 0||c===null)){he.next=8;break}return it.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ue==null?void 0:ue.label})),he.abrupt("return",{data:[],total:0,success:!1});case 8:return he.next=10,Promise.all([Object(ht.b)(H),xt(H),E({group_id:H,per_page:-1}),Tt(c,(ce=ne.data)===null||ce===void 0||(Fe=ce[0])===null||Fe===void 0?void 0:Fe.tutor_id),Kt(),Wt((A=ne.data)===null||A===void 0||($=A[0])===null||$===void 0?void 0:$.s_subject_scale_form_id)]);case 10:if(J=he.sent,xe=Object(G.a)(J,6),Be=xe[0],Se=xe[1],He=xe[2],Qe=xe[3],ie=xe[4],Q=xe[5],!(!Be.success||!Se.success||!He.success||!Qe.success||!ie.success||!Q.success||!ue)){he.next=21;break}return it.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ue==null?void 0:ue.label})),he.abrupt("return",{data:[],total:0,success:!1});case 21:return d(ue.label),q=vr(Se.data),re=pr(He.data),fe=gr(ie.data,Q.data),S([q,re,fe,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Ke=Be.data.users.reduce(function(We,De){var Ve,dt,Re,lt=De.id,Nt=De.academic_teacher_id,Cr=De.first_name,Tr=De.last_name,ea="".concat(Tr," ").concat(Cr);if(Nt!==null||!ea.toLowerCase().includes(ke.toLowerCase()))return We;var Er=Or(Se.data,lt),ta=Yt(He.data,lt),jt=xr(ne.data,lt),Gr=(Ve=Zt((dt=jt==null?void 0:jt.s_subject_scale_form_id)!==null&&dt!==void 0?dt:0,(Re=Qe.data.grade_scale)!==null&&Re!==void 0?Re:[]))!==null&&Ve!==void 0?Ve:[],Mr=Xt(ta,Gr),Ir=hr(ta),Fr=Sr(jt);return[].concat(Object(ae.a)(We),[Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({id:lt,full_name:ea},Er),Ir),Fr),{},{proposed_grade:Mr,final_grades:jt})])},[]).sort(function(We,De){return We.full_name.localeCompare(De.full_name)}),he.abrupt("return",{data:Ke,total:Ke.length,success:!0});case 28:case"end":return he.stop()}},_)}));return function(_){return C.apply(this,arguments)}}(),columns:T,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:v}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:O,pagination:{onChange:function(){var _;return(_=O.current)===null||_===void 0?void 0:_.reload()}},rowKey:"id"})},_r=function(n){var a,r,t=n.tab,c=Object(s.l)(),l=Object(s.m)("@@initialState"),o=l.setInitialState,m=l.initialState,S=Object(te.b)(),p=S.teacherSubjectData,g=S.semester_subject_id,v=S.tutors,d=Object(j.useCallback)(Object(Ge.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(j.useMemo)(function(){return!!v.data.find(function(x){var O,T=x.id;return T===(m==null||(O=m.currentUser)===null||O===void 0?void 0:O.id)})||d(Ye.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(ge.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(se.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(g),breadcrumbName:String((r=p.subject)===null||r===void 0?void 0:r.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(je.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(O){o(Object(b.a)({},m)),s.f.push("/teacher/subjects/".concat(g,"/").concat(O))}},children:[Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(ye.a,{})},"groups"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(ya,{})},"students"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(va,{})},"exams"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ua,{})},"schedule"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(yr,{})},"class-register"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(Ga,{})},"attendance"),f&&Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(Aa,{})},"grades-scale"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(nr,{})},"final-grades"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(or,{})},"file-exports-history")]})}):Object(e.jsx)(ve.a,{})},Ur=Ae.default=function(){var u=Object(de.l)(),n=u.subjectId,a=u.tab,r=a===void 0?"groups":a;return Object(e.jsx)(te.a,{semester_subject_id:Number(n),children:Object(e.jsx)(_r,{tab:r})})}},p3I6:function(bt,Ae,i){"use strict";i.d(Ae,"b",function(){return Ge}),i.d(Ae,"c",function(){return we}),i.d(Ae,"a",function(){return ut});var b=i("miYZ"),$e=i("tsqr"),se=i("tJVT"),M=i("k1fw"),ve=i("oBTY"),j=i("q1tI"),nt=i.n(j),s=i("9kvl"),qe=i("Ty5D"),de=i("H6aw"),je=i("/y+f"),ge=i("nKUr"),Ye=i.n(ge),Ge=nt.a.createContext({}),te=function(){return Math.round(Math.random()*99999)},ye=function le(W){return W.reduce(function(w,E){return[].concat(Object(ve.a)(w),Object(ve.a)(E.lessons?le(E.lessons):[]),[E])},[])},we=function le(W){return W.reduce(function(w,E){var z;return[].concat(Object(ve.a)(w),Object(ve.a)(E.lessons?le(E.lessons):[]),Object(ve.a)((z=E.topics)!==null&&z!==void 0?z:[]))},[])},st=function le(W,w,E){return W.map(function(z){var _e,y;return Object(M.a)(Object(M.a)({},z),{},{lessons:z.lessons?le(z.lessons,w,E):[],topics:z.id===w?[].concat(Object(ve.a)((_e=z.topics)!==null&&_e!==void 0?_e:[]),[E]):(y=z.topics)!==null&&y!==void 0?y:[]})})},mt=function le(W,w,E){return E?W.map(function(z){return Object(M.a)(Object(M.a)({},z),{},{lessons:[].concat(Object(ve.a)(z.lessons?le(z.lessons,w,E):[]),Object(ve.a)(z.id===E?[w]:[]))})}):[].concat(Object(ve.a)(W),[w])},Le=function le(W,w,E){return W.map(function(z){return Object(M.a)(Object(M.a)({},z.id===w?E:z),{},{lessons:z.lessons?le(z.lessons,w,E):[]})})},h=function le(W,w){return W.map(function(E){return Object(M.a)(Object(M.a)({},E),{},{parent_id:w,lessons:E.lessons?le(E.lessons,E.id):[]})})},R=function le(W,w){return W.filter(function(E){return E.id!==w}).map(function(E){return Object(M.a)(Object(M.a)({},E),{},{lessons:E.lessons?le(E.lessons,w):[]})})},Ne=function le(W,w){return W.map(function(E){return Object(M.a)(Object(M.a)({},E),{},{lessons:E.lessons?le(E.lessons,w):[],topics:E.topics?E.topics.filter(function(z){return z.id!==w}):[]})})},rt=function le(W,w,E,z){return z==null?void 0:z.map(function(_e){if(_e.id===E){var y;return Object(M.a)(Object(M.a)({},_e),{},{topics:(y=_e.topics)===null||y===void 0?void 0:y.map(function(Ce){return Ce.id===W?w.file.response.data:Ce})})}else if(_e.lessons)return Object(M.a)(Object(M.a)({},_e),{},{lessons:le(W,w,E,_e.lessons||[])});return _e})},ut=function(W){var w=W.children,E=W.id,z=Object(j.useState)(),_e=Object(se.a)(z,2),y=_e[0],Ce=_e[1],tt=Object(s.l)(),et=Object(j.useMemo)(function(){return y&&y.lessons?we(y.lessons):[]},[y]),Ue=Object(j.useMemo)(function(){return y&&y.lessons?ye(y.lessons):[]},[y]),ot=Object(j.useState)([]),Xe=Object(se.a)(ot,2),Te=Xe[0],Me=Xe[1],be=Object(qe.k)();Object(j.useEffect)(function(){Me([])},[]);var me=Object(j.useCallback)(function(){Object(de.n)(E).then(function(I){return I.success&&Ce(Object(M.a)(Object(M.a)({},I.data),{},{lessons:h(I.data.lessons)}))})},[E]);Object(j.useEffect)(function(){me()},[me]);var oe=Object(j.useCallback)(function(I){var U=Ue.find(function(L){var P;return L==null||(P=L.topics)===null||P===void 0?void 0:P.find(function(V){return V.id===I})});return U?U.id:null},[Ue]),Ie=Object(j.useMemo)(function(){var I,U;return(I=be.query)!==null&&I!==void 0&&I.lesson?{mode:"lesson",id:Number(be.query.lesson),value:Ue.find(function(L){return L.id===Number(be.query.lesson)})}:(U=be.query)!==null&&U!==void 0&&U.topic?{mode:"topic",id:Number(be.query.topic),value:et.find(function(L){return L.id===Number(be.query.topic)})}:{mode:"init"}},[be.query,y,Ue,et]),Oe=Object(j.useCallback)(function(I){var U={course_id:E,topics:[],isNew:!0,id:y?y.lessons.length+1:te(),order:0,title:tt.formatMessage({id:"add_title_here"}),active:!0,parent_id:I};return Ce(function(L){var P;return Object(M.a)(Object(M.a)({},L),{},{lessons:mt((P=L==null?void 0:L.lessons)!==null&&P!==void 0?P:[],U,I)})}),U},[E,y]),G=Object(j.useCallback)(function(I,U){var L=Ue.find(function(V){return V.id===I}),P=L&&L.isNew;return(P?Object(de.g)(U):Object(de.v)(I,U)).then(function(V){return $e.b.success(V.message),me(),V.success&&Ce(function(k){var Z;return Object(M.a)(Object(M.a)({},k),{},{lessons:Le((Z=k==null?void 0:k.lessons)!==null&&Z!==void 0?Z:[],I,Object(M.a)(Object(M.a)({},V.data),{},{isNew:!1}))})})})},[y]),ze=Object(j.useCallback)(function(I){var U=Ue.find(function(P){return P.id===I});if(!!U){var L=U.isNew;L?Ce(function(P){var V;return Object(M.a)(Object(M.a)({},P),{},{lessons:R((V=P==null?void 0:P.lessons)!==null&&V!==void 0?V:[],I)})}):Object(de.p)(I).then(function(P){P.success&&($e.b.success(P.message),Ce(function(V){var k;return Object(M.a)(Object(M.a)({},V),{},{lessons:R((k=V==null?void 0:V.lessons)!==null&&k!==void 0?k:[],I)})}))})}},[y]),Ee=Object(j.useCallback)(function(I,U){var L,P=oe(I),V=Ue.find(function(ae){return ae.id===P}),k=V&&((L=V.topics)===null||L===void 0?void 0:L.find(function(ae){return ae.id===I})),Z=k==null?void 0:k.isNew;return(Z?Object(de.h)(U):Object(de.w)(I,U)).then(function(ae){ae.success&&($e.b.success(ae.message),me(),s.f.push("/courses/list/".concat(E,"/program/?topic=").concat(ae.data.id)),(k==null?void 0:k.topicable_type)===je.k.Video&&setTimeout(function(){me()},5e3))})},[oe,y,me]),pe=Object(j.useCallback)(function(I){var U=oe(I),L=Ue.find(function(k){return k.id===U});if(!!L){var P=et==null?void 0:et.find(function(k){return k.id===I}),V=P==null?void 0:P.isNew;V&&!P.topicable?Ce(function(k){var Z;return Object(M.a)(Object(M.a)({},k),{},{lessons:Ne((Z=k==null?void 0:k.lessons)!==null&&Z!==void 0?Z:[],I)})}):Object(de.q)(I).then(function(k){k.success&&($e.b.success(k.message),Ce(function(Z){var ae;return Object(M.a)(Object(M.a)({},Z),{},{lessons:Ne((ae=Z==null?void 0:Z.lessons)!==null&&ae!==void 0?ae:[],I)})}))})}},[y,oe]),X=Object(j.useCallback)(function(I,U){var L={lesson_id:I,isNew:!0,id:te(),title:tt.formatMessage({id:"add_title_here"}),active:!0,topicable_type:U};return Ce(function(P){var V;return Object(M.a)(Object(M.a)({},P),{},{lessons:st((V=P==null?void 0:P.lessons)!==null&&V!==void 0?V:[],I,L)})}),L},[]),Y=function(U,L){var P=oe(U);Ce(function(V){return Object(M.a)(Object(M.a)({},V),{},{lessons:V?rt(U,L,P,V.lessons||[]):[]})}),s.f.push("/courses/list/".concat(E,"/program/?topic=").concat(L.file.response.data.id))},ee=Object(j.useCallback)(function(I){return Object(de.d)(I).then(function(U){if(U.success){$e.b.success(U.message);var L=oe(I);Ce(function(P){var V;return Object(M.a)(Object(M.a)({},P),{},{lessons:P?(V=P.lessons)===null||V===void 0?void 0:V.map(function(k){if(k.id===L){var Z=k.topics||[];return Object(M.a)(Object(M.a)({},k),{},{topics:[].concat(Object(ve.a)(Z),[U.data])})}return k}):[]})})}})},[y,oe]),D=Object(j.useCallback)(function(I){return Object(de.c)(I).then(function(U){U.success&&($e.b.success(U.message),Ce(function(L){return Object(M.a)(Object(M.a)({},L),{},{lessons:L?[].concat(Object(ve.a)(L.lessons),[U.data]):[]})}))})},[]),N={state:y,h5ps:Te,id:E,addNewLesson:Oe,updateLesson:G,updateTopic:Ee,deleteLesson:ze,addNewTopic:X,deleteTopic:pe,onTopicUploaded:Y,cloneTopic:ee,cloneLesson:D,currentEditMode:Ie,getLessons:me};return Object(ge.jsx)(Ge.Provider,{value:N,children:w})}},"w/VK":function(bt,Ae,i){"use strict";i.d(Ae,"c",function(){return ve}),i.d(Ae,"a",function(){return nt}),i.d(Ae,"b",function(){return qe});var b=i("qLMh"),$e=i("k1fw"),se=i("9og8"),M=i("9kvl");function ve(je,ge){return j.apply(this,arguments)}function j(){return j=Object(se.a)(Object(b.a)().mark(function je(ge,Ye){return Object(b.a)().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.abrupt("return",Object(M.i)("/api/admin/reports/report",Object($e.a)({params:ge,method:"GET",useCache:!1},Ye||{})));case 1:case"end":return te.stop()}},je)})),j.apply(this,arguments)}function nt(je,ge,Ye){return s.apply(this,arguments)}function s(){return s=Object(se.a)(Object(b.a)().mark(function je(ge,Ye,Ge){return Object(b.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",Object(M.i)("/api/admin/stats/course/".concat(ge,"/export"),Object($e.a)({params:Ye,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ge||{})));case 1:case"end":return ye.stop()}},je)})),s.apply(this,arguments)}function qe(je,ge,Ye){return de.apply(this,arguments)}function de(){return de=Object(se.a)(Object(b.a)().mark(function je(ge,Ye,Ge){return Object(b.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",Object(M.i)("/api/admin/stats/topic/".concat(ge,"/export"),Object($e.a)({method:"GET",useCache:!1,params:{stat:Ye},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ge||{})));case 1:case"end":return ye.stop()}},je)})),de.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.453762b0.async.js.map