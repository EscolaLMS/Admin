(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"/y+f":function($e,ie,n){"use strict";n.d(ie,"f",function(){return c}),n.d(ie,"d",function(){return S}),n.d(ie,"e",function(){return I}),n.d(ie,"c",function(){return s}),n.d(ie,"a",function(){return ce}),n.d(ie,"b",function(){return Be});var c;(function(o){o.Unselected="",o.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",o.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",o.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",o.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",o.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",o.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",o.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",o.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",o.Project="EscolaLms\\TopicTypeProject\\Models\\Project",o.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(c||(c={}));var V;(function(o){o.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",o.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(V||(V={}));var U;(function(o){o.draft="draft",o.published="published",o.archived="archived"})(U||(U={}));var S;(function(o){o.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",o.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",o.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(S||(S={}));var I;(function(o){o.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(I||(I={}));var d;(function(o){o.cart_fixed="cart_fixed",o.cart_percent="cart_percent",o.product_fixed="product_fixed",o.product_percent="product_percent"})(d||(d={}));var s;(function(o){o.MULTIPLE_CHOICE="multiple_choice",o.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",o.TRUE_FALSE="true_false",o.SHORT_ANSWERS="short_answers",o.MATCHING="matching",o.NUMERICAL_QUESTION="numerical_question",o.ESSAY="essay",o.DESCRIPTION="description"})(s||(s={}));var ce;(function(o){o.PRESENT="present",o.ABSENT="absent"})(ce||(ce={}));var Be;(function(o){o.Manual="manual",o.TeamsForms="teams_forms",o.TeamsLecture="teams_lecture",o.TestPortal="test_portal"})(Be||(Be={}))},"0JQy":function($e,ie){var n="\\ud800-\\udfff",c="\\u0300-\\u036f",V="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",S=c+V+U,I="\\ufe0e\\ufe0f",d="["+n+"]",s="["+S+"]",ce="\\ud83c[\\udffb-\\udfff]",Be="(?:"+s+"|"+ce+")",o="[^"+n+"]",ee="(?:\\ud83c[\\udde6-\\uddff]){2}",Te="[\\ud800-\\udbff][\\udc00-\\udfff]",xe="\\u200d",Z=Be+"?",De="["+I+"]?",ut="(?:"+xe+"(?:"+[o,ee,Te].join("|")+")"+De+Z+")*",he=De+Z+ut,et="(?:"+[o+s+"?",s,ee,Te,d].join("|")+")",He=RegExp(ce+"(?="+ce+")|"+et+he,"g");function _(m){return m.match(He)||[]}$e.exports=_},"5R/X":function($e,ie,n){},"5Syx":function($e,ie,n){"use strict";n.d(ie,"c",function(){return ze}),n.d(ie,"b",function(){return ct}),n.d(ie,"a",function(){return Q});var c=n("OaEy"),V=n("2fM7"),U=n("g9YV"),S=n("wCAj"),I=n("BoS7"),d=n("Sdc0"),s=n("jrin"),ce=n("k1fw"),Be=n("DYRE"),o=n("zeV3"),ee=n("+BJd"),Te=n("mr32"),xe=n("oBTY"),Z=n("tJVT"),De=n("q1tI"),ut=n.n(De),he=n("9kvl"),et=n("Vpfc"),He=n("nhC9"),_=n("LDJE"),m=n("nKUr"),Je=n.n(m),tt=function(K){return K.topicable.content.contents?Object.values(K.topicable.content.contents)[0].library:"H5P"},ze=function(K){var E=K.topics,N=K.stats,le=Object(De.useState)(!1),F=Object(Z.a)(le,2),b=F[0],Ie=F[1],Ce=Object(De.useMemo)(function(){return[{title:Object(m.jsx)(he.a,{id:"user"}),dataIndex:"id",render:function(Ge){return Object(m.jsx)(et.a,{type:"App\\Models\\User",type_id:Ge})}},{title:Object(m.jsx)(he.a,{id:"email"}),dataIndex:"email"}].concat(Object(xe.a)(E.map(function(Se){var Ge,Me=(Ge=Se.topicable_type)===null||Ge===void 0?void 0:Ge.split("\\").pop();return Me==="H5P"&&(Me=tt(Se)),{render:function(R){var $=0,pe=0;switch(R&&(R.started_at&&R.finished_at?$=1:R.started_at&&($=2),pe=R.seconds/60),$){case 1:return Object(m.jsxs)(o.b,{children:[Object(m.jsx)(Te.a,{color:"success",children:"F"}),b&&Object(m.jsxs)("small",{children:[pe.toFixed(2),"m"]})]});case 2:return Object(m.jsxs)(o.b,{children:[Object(m.jsx)(Te.a,{color:"blue",children:"S"}),b&&Object(m.jsxs)("small",{children:[pe.toFixed(2),"m"]})]});case 0:default:return Object(m.jsx)(ut.a.Fragment,{children:Object(m.jsx)(Te.a,{color:"error",children:"N"})})}},title:Object(m.jsxs)("small",{children:[Object(m.jsx)(Te.a,{children:Me})," ",Se.title]}),dataIndex:Se.id}})))},[E,b]),Le=Object(De.useMemo)(function(){return N.map(function(Se){return E.reduce(function(Ge,Me){var Ze=Se.topics.find(function(R){return R.id===Me.id});return Object(ce.a)(Object(ce.a)({},Ge),{},Object(s.a)({},Number(Me.id),Ze!=null?Ze:0))},{email:Se.email,id:Se.id})})},[N,E]);return Object(m.jsx)(S.a,{title:function(){return Object(m.jsxs)(o.b,{children:[Object(m.jsx)(he.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(m.jsx)(Te.a,{color:"success",children:"F"}),Object(m.jsx)(he.a,{id:"Started",defaultMessage:"Started:"})," ",Object(m.jsx)(Te.a,{color:"blue",children:"S"}),Object(m.jsx)(he.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(m.jsx)(Te.a,{color:"error",children:"N"}),Object(m.jsx)(he.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(m.jsx)(d.a,{checked:b,onChange:function(Me){return Ie(Me)}})]})},columns:Ce,dataSource:Le,size:"small",scroll:{x:1500}})},ct=function(K){var E=K.stats,N=Object(De.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(b){return Object(m.jsx)(et.a,{type:"App\\Models\\User",type_id:b})}},{title:"email",dataIndex:"email"},{title:Object(m.jsx)(he.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),le=Object(De.useMemo)(function(){return E.map(function(F){var b=F.id,Ie=F.email,Ce=F.finished_at;return{id:b,email:Ie,finished_at:Ce}})},[E]);return Object(m.jsx)(S.a,{title:function(){return Object(m.jsx)(o.b,{children:Object(m.jsx)(he.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:N,dataSource:le,size:"small",scroll:{x:500}})},Q=function(K){var E=K.stats,N=Object(De.useState)(null),le=Object(Z.a)(N,2),F=le[0],b=le[1],Ie=Object(De.useState)(null),Ce=Object(Z.a)(Ie,2),Le=Ce[0],Se=Ce[1],Ge=Object(he.l)(),Me=Object(De.useMemo)(function(){return E.flatMap(function(R){return Object.values(R.attempts).flatMap(function($){var pe=$.dates,at=$.attempt,B=Object.values(pe).flatMap(function(qe){var ke=qe.date,lt=qe.seconds_total;return{date:ke,attempt:at,seconds_total:lt,email:R.email}});return B})})},[E]),Ze={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(m.jsx)(He.a,{title:Object(m.jsxs)(o.b,{children:[Object(m.jsx)(he.a,{id:"course.interactions_time_in_days"}),Object(m.jsx)(V.a,{showSearch:!0,value:F,onChange:function($){b($),Se(null)},placeholder:Object(m.jsx)(he.a,{id:"select_person",defaultMessage:"Select a person"}),children:E.map(function(R){var $=R.id,pe=R.email;return Object(m.jsx)(V.a.Option,{value:pe,children:pe},$)})}),Object(m.jsx)(V.a,{value:Le,onChange:function($){return Se($)},disabled:F===null,placeholder:Object(m.jsx)(he.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(xe.a)(new Set(Me.filter(function(R){var $=R.email;return $===F}).map(function(R){var $=R.attempt;return $}))).map(function(R){return Object(m.jsxs)(V.a.Option,{value:R,children:[Object(m.jsx)(he.a,{id:"attempt",defaultMessage:"Attempt"})," ",R]},R)})})]}),colSpan:12,layout:"center",children:Object(m.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(m.jsx)(_.a,Object(ce.a)(Object(ce.a)({},Ze),{},{tooltip:{title:"".concat(Ge.formatMessage({id:"attempt"})),formatter:function($){var pe=Math.floor(+$.seconds_total/60),at=+$.seconds_total>60?+$.seconds_total-pe*60:0;return{name:$.attempt,value:"".concat(pe,"m ").concat(at,"s")}}},data:Me.filter(function(R){var $=R.email;return $===F}).filter(function(R){var $=R.attempt;return Number.isInteger(Le)?$===Le:!0})}))})})}},Em2t:function($e,ie,n){var c=n("bahg"),V=n("quyA"),U=n("0JQy");function S(I){return V(I)?U(I):c(I)}$e.exports=S},Hn4i:function($e,ie,n){"use strict";var c=n("y8nQ"),V=n("Vl3Y"),U=n("+L6B"),S=n("2/Rp"),I=n("rePB"),d=n("ODXe"),s=n("Ff2n"),ce=n("x+uP"),Be=n("HaE+"),o=n("VTBJ"),ee=n("nKUr"),Te=n.n(ee),xe=n("xvlK"),Z=n("WuYN"),De=n("VMEa"),ut=n("LQCs"),he=n("ft2k"),et=n("uX+g"),He=n("+i8S"),_=n("ipCM"),m=n("6cGi"),Je=n("ub+h"),tt=n("bG1m"),ze=n("q1tI"),ct=n.n(ze),Q=n("mWMg"),W=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],K=["record","position","creatorButtonText","newRecordType","parentKey","style"],E=ct.a.createContext(void 0);function N(b){var Ie=b.children,Ce=b.record,Le=b.position,Se=b.newRecordType,Ge=b.parentKey,Me=Object(ze.useContext)(E);return ct.a.cloneElement(Ie,Object(o.a)(Object(o.a)({},Ie.props),{},{onClick:function(){var Ze=Object(Be.a)(Object(ce.a)().mark(function $(pe){var at,B,qe,ke;return Object(ce.a)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:return re.next=2,(at=(B=Ie.props).onClick)===null||at===void 0?void 0:at.call(B,pe);case 2:if(ke=re.sent,ke!==!1){re.next=5;break}return re.abrupt("return");case 5:Me==null||(qe=Me.current)===null||qe===void 0||qe.addEditRecord(Ce,{position:Le,newRecordType:Se,parentKey:Ge});case 6:case"end":return re.stop()}},$)}));function R($){return Ze.apply(this,arguments)}return R}()}))}function le(b){var Ie,Ce,Le=Object(ut.d)(),Se=b.onTableChange,Ge=b.maxLength,Me=b.formItemProps,Ze=b.recordCreatorProps,R=b.rowKey,$=b.controlled,pe=b.defaultValue,at=b.onChange,B=b.editableFormRef,qe=Object(s.a)(b,W),ke=Object(he.a)(b.value),lt=Object(ze.useRef)(),re=Object(ze.useRef)();Object(ze.useImperativeHandle)(qe.actionRef,function(){return lt.current});var we=Object(m.a)(function(){return b.value||pe||[]},{value:b.value,onChange:b.onChange}),mt=Object(d.a)(we,2),oe=mt[0],Fe=mt[1],it=ct.a.useMemo(function(){return typeof R=="function"?R:function(Re,k){return Re[R]||k}},[R]),A=function(k){if(typeof k=="number"&&!b.name){if(k>=oe.length)return k;var te=oe&&oe[k];return it==null?void 0:it(te,k)}if((typeof k=="string"||k>=oe.length)&&b.name){var ae=oe.findIndex(function(de,je){var Ae;return(it==null||(Ae=it(de,je))===null||Ae===void 0?void 0:Ae.toString())===(k==null?void 0:k.toString())});return ae}return k};Object(ze.useImperativeHandle)(B,function(){var Re=function(ae){var de,je;if(ae==null)throw new Error("rowIndex is required");var Ae=A(ae),nt=[b.name,(de=Ae==null?void 0:Ae.toString())!==null&&de!==void 0?de:""].flat(1).filter(Boolean);return(je=re.current)===null||je===void 0?void 0:je.getFieldValue(nt)},k=function(){var ae,de=[b.name].flat(1).filter(Boolean);if(Array.isArray(de)&&de.length===0){var je,Ae=(je=re.current)===null||je===void 0?void 0:je.getFieldsValue();return Array.isArray(Ae)?Ae:Object.keys(Ae).map(function(nt){return Ae[nt]})}return(ae=re.current)===null||ae===void 0?void 0:ae.getFieldValue(de)};return Object(o.a)(Object(o.a)({},re.current),{},{getRowData:Re,getRowsData:k,setRowData:function(ae,de){var je,Ae,nt,bt;if(ae==null)throw new Error("rowIndex is required");var ht=A(ae),yt=[b.name,(je=ht==null?void 0:ht.toString())!==null&&je!==void 0?je:""].flat(1).filter(Boolean),Tt=((Ae=re.current)===null||Ae===void 0||(nt=Ae.getFieldsValue)===null||nt===void 0?void 0:nt.call(Ae))||{},Ct=Object(tt.a)(Tt,yt,Object(o.a)(Object(o.a)({},Re(ae)),de||{}));return(bt=re.current)===null||bt===void 0?void 0:bt.setFieldsValue(Ct)}})}),Object(ze.useEffect)(function(){!b.controlled||oe.forEach(function(Re,k){var te;(te=re.current)===null||te===void 0||te.setFieldsValue(Object(I.a)({},it(Re,k),Re))},{})},[oe,b.controlled]),Object(ze.useEffect)(function(){if(b.name){var Re;re.current=b==null||(Re=b.editable)===null||Re===void 0?void 0:Re.form}},[(Ie=b.editable)===null||Ie===void 0?void 0:Ie.form,b.name]);var P=Ze||{},H=P.record,L=P.position,z=P.creatorButtonText,e=P.newRecordType,Ue=P.parentKey,Qe=P.style,xt=Object(s.a)(P,K),pt=L==="top",jt=Object(ze.useMemo)(function(){return Ge&&Ge<=(oe==null?void 0:oe.length)?!1:Ze!==!1&&Object(ee.jsx)(N,{record:Object(et.a)(H,oe==null?void 0:oe.length,oe)||{},position:L,parentKey:Object(et.a)(Ue,oe==null?void 0:oe.length,oe),newRecordType:e,children:Object(ee.jsx)(S.a,Object(o.a)(Object(o.a)({type:"dashed",style:Object(o.a)({display:"block",margin:"10px 0",width:"100%"},Qe),icon:Object(ee.jsx)(xe.a,{})},xt),{},{children:z||Le.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ze,Ge,oe==null?void 0:oe.length]),St=Object(ze.useMemo)(function(){return jt?pt?{components:{header:{wrapper:function(k){var te,ae=k.className,de=k.children;return Object(ee.jsxs)("thead",{className:ae,children:[de,Object(ee.jsxs)("tr",{style:{position:"relative"},children:[Object(ee.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:jt}),Object(ee.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(te=qe.columns)===null||te===void 0?void 0:te.length,children:jt})]})]})}}}}:{tableViewRender:function(k,te){var ae,de;return Object(ee.jsxs)(ee.Fragment,{children:[(ae=(de=b.tableViewRender)===null||de===void 0?void 0:de.call(b,k,te))!==null&&ae!==void 0?ae:te,jt]})}}:{}},[pt,jt]),Ot=Object(o.a)({},b.editable),Et=Object(He.a)(function(Re,k){var te,ae,de;if((te=b.editable)===null||te===void 0||(ae=te.onValuesChange)===null||ae===void 0||ae.call(te,Re,k),(de=b.onValuesChange)===null||de===void 0||de.call(b,k,Re),b.controlled){var je;b==null||(je=b.onChange)===null||je===void 0||je.call(b,k)}});return((b==null?void 0:b.onValuesChange)||((Ce=b.editable)===null||Ce===void 0?void 0:Ce.onValuesChange)||b.controlled&&(b==null?void 0:b.onChange))&&(Ot.onValuesChange=Et),Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(E.Provider,{value:lt,children:Object(ee.jsx)(Q.a,Object(o.a)(Object(o.a)(Object(o.a)({search:!1,options:!1,pagination:!1,rowKey:R,revalidateOnFocus:!1},qe),St),{},{tableLayout:"fixed",actionRef:lt,onChange:Se,editable:Object(o.a)(Object(o.a)({},Ot),{},{formProps:Object(o.a)({formRef:re},Ot.formProps)}),dataSource:oe,onDataSourceChange:function(k){if(Fe(k),b.name&&L==="top"){var te,ae=Object(tt.a)({},[b.name].flat(1).filter(Boolean),k);(te=re.current)===null||te===void 0||te.setFieldsValue(ae)}}}))}),b.name?Object(ee.jsx)(Z.a,{name:[b.name],children:function(k){var te,ae,de=Object(Je.a)(k,[b.name].flat(1)),je=de==null?void 0:de.find(function(Ae,nt){return!Object(_.a)(Ae,ke==null?void 0:ke[nt])});return je&&ke&&(b==null||(te=b.editable)===null||te===void 0||(ae=te.onValuesChange)===null||ae===void 0||ae.call(te,je,de)),null}}):null]})}function F(b){var Ie=De.a.useFormInstance();return b.name?Object(ee.jsx)(V.a.Item,Object(o.a)(Object(o.a)({style:{maxWidth:"100%"}},b==null?void 0:b.formItemProps),{},{name:b.name,children:Object(ee.jsx)(le,Object(o.a)(Object(o.a)({},b),{},{editable:Object(o.a)(Object(o.a)({},b.editable),{},{form:Ie})}))})):Object(ee.jsx)(le,Object(o.a)({},b))}F.RecordCreator=N,ie.a=F},KxBF:function($e,ie){function n(c,V,U){var S=-1,I=c.length;V<0&&(V=-V>I?0:I+V),U=U>I?I:U,U<0&&(U+=I),I=V>U?0:U-V>>>0,V>>>=0;for(var d=Array(I);++S<I;)d[S]=c[S+V];return d}$e.exports=n},LDJE:function($e,ie,n){"use strict";var c=n("q1tI"),V=n.n(c),U=n("ma/q"),S=n("ZIEt"),I=n("QpZ9"),d=n("GzfL"),s=n("Scwr"),ce=function(o,ee){var Te={};for(var xe in o)Object.prototype.hasOwnProperty.call(o,xe)&&ee.indexOf(xe)<0&&(Te[xe]=o[xe]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Z=0,xe=Object.getOwnPropertySymbols(o);Z<xe.length;Z++)ee.indexOf(xe[Z])<0&&Object.prototype.propertyIsEnumerable.call(o,xe[Z])&&(Te[xe[Z]]=o[xe[Z]]);return Te},Be=Object(c.forwardRef)(function(o,ee){var Te=o.chartRef,xe=o.style,Z=xe===void 0?{height:"inherit"}:xe,De=o.className,ut=o.loading,he=o.loadingTemplate,et=o.errorTemplate,He=ce(o,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),_=Object(S.a)(U.a,He),m=_.chart,Je=_.container;return Object(c.useEffect)(function(){Object(I.a)(Te,m.current)},[m.current]),Object(c.useImperativeHandle)(ee,function(){return{getChart:function(){return m.current}}}),V.a.createElement(d.a,{errorTemplate:et},ut&&V.a.createElement(s.a,{loadingTemplate:he,theme:o.theme}),V.a.createElement("div",{className:De,style:Z,ref:Je}))});ie.a=Be},bahg:function($e,ie){function n(c){return c.split("")}$e.exports=n},olry:function($e,ie,n){"use strict";n.r(ie);var c=n("k1fw"),V=n("+L6B"),U=n("2/Rp"),S=n("T2oS"),I=n("W9HT"),d=n("q1tI"),s=n("9kvl"),ce=n("55Ip"),Be=n("Ty5D"),o=n("nhC9"),ee=n("tMyG"),Te=n("my69"),xe=n("huej"),Z=n("mJ0o"),De=n("EhlZ"),ut=n("P2fV"),he=n("NJEC"),et=n("5Dmo"),He=n("3S7+"),_=n("qLMh"),m=n("9og8"),Je=n("sWYD"),tt=n("G3dp"),ze=n("lbgm"),ct=n("/MfK"),Q=n("Qiat"),W=n("mGZj");function K(l,u){return E.apply(this,arguments)}function E(){return E=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(c.a)({method:"GET",useCache:!1,params:u},t||{})));case 1:case"end":return a.stop()}},l)})),E.apply(this,arguments)}function N(l,u){return le.apply(this,arguments)}function le(){return le=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:u},t||{})));case 1:case"end":return a.stop()}},l)})),le.apply(this,arguments)}function F(l,u,t){return b.apply(this,arguments)}function b(){return b=Object(m.a)(Object(_.a)().mark(function l(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return i.stop()}},l)})),b.apply(this,arguments)}function Ie(l,u){return Ce.apply(this,arguments)}function Ce(){return Ce=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},l)})),Ce.apply(this,arguments)}function Le(l,u){return Se.apply(this,arguments)}function Se(){return Se=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},l)})),Se.apply(this,arguments)}function Ge(l,u,t,r){return Me.apply(this,arguments)}function Me(){return Me=Object(m.a)(Object(_.a)().mark(function l(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u,"/users/").concat(t),Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return j.stop()}},l)})),Me.apply(this,arguments)}function Ze(l,u,t){return R.apply(this,arguments)}function R(){return R=Object(m.a)(Object(_.a)().mark(function l(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u,"/users/").concat(t),Object(c.a)({method:"DELETE"},r||{})));case 1:case"end":return i.stop()}},l)})),R.apply(this,arguments)}var $=n("Vpfc"),pe=n("giR+"),at=n("fyUT"),B=n("tJVT"),qe=n("14J3"),ke=n("BMrR"),lt=n("jCWc"),re=n("kPKH"),we=n("VMEa"),mt=n("Qurx"),oe=n("lR9U"),Fe=n("/y+f"),it=n("2qtc"),A=n("kLXV"),P=n("oBTY"),H=n("OaEy"),L=n("2fM7"),z=n("DBJ/"),e=n("nKUr"),Ue=function(u){var t=u.type,r=u.onDataConverted,a=u.groupSelectDisabled,i=Object(Z.b)(),j=i.semester_subject_id,O=i.teacherSubjectData,h=Object(d.useState)(null),y=Object(B.a)(h,2),g=y[0],v=y[1],x=Object(d.useMemo)(function(){var T;return((T=O==null?void 0:O.groups)!==null&&T!==void 0?T:[]).map(function(C){var D=C.id,J=C.name;return{label:J,value:D}})},[]),f={type:t,group_id:g,semester_subject_id:j},p=Object(d.useCallback)(function(T){if(T.success){var C=T.data.results.filter(function(D){var J=D.user_id;return J!==null});if(!C.length)return;r({exam_results:C,group_id:T.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(we.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(L.a,{disabled:a,value:g,onChange:function(C){return v(C)},options:x,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(z.a,{name:"file",url:"/api/admin/exams/parse",onUpload:p,onChange:function(C){return!C.fileList.length&&r(void 0)},maxFiles:1,data:f,disabled:!g})]})},Qe=function(u){var t=u.onDataConverted,r=Object(Z.b)(),a=r.teacherSubjectData,i=r.groupUsers,j=Object(d.useState)(null),O=Object(B.a)(j,2),h=O[0],y=O[1],g=Object(d.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(f){var p=f.id,T=f.name;return{label:T,value:p}})},[]),v=Object(d.useCallback)(function(x){var f;y(x);var p=(f=i.byId)===null||f===void 0?void 0:f[x];if(!!p){var T=p.users.reduce(function(C,D){var J=D.id,M=D.email,be=D.first_name,X=D.last_name,fe=D.academic_teacher_id;return fe!==null?C:[].concat(Object(P.a)(C),[{email:M,first_name:be,last_name:X,user_id:J,result:0}])},[]);t({group_id:x,exam_results:T})}},[i.byId]);return Object(e.jsx)(L.a,{value:h,onChange:v,options:g,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},xt=[Fe.b.TeamsLecture,Fe.b.TestPortal,Fe.b.TeamsForms],pt=function(u){var t=u.open,r=u.closeModal,a=u.onSuccess,i=u.type,j=Object(Z.b)(),O=j.teacherSubjectData,h=j.fetchGroupUsers,y=Object(d.useState)(),g=Object(B.a)(y,2),v=g[0],x=g[1];return Object(d.useEffect)(function(){if(i===Fe.b.Manual&&t){var f;O==null||(f=O.groups)===null||f===void 0||f.forEach(function(p){var T=p.id;return h(T)})}},[i,t]),Object(e.jsxs)(A.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(i,"Convert")}),width:"40vw",open:t,onCancel:r,onOk:function(){v&&a(v)},okButtonProps:{disabled:!v},children:[xt.includes(i)&&Object(e.jsx)(Ue,{type:i,onDataConverted:x,groupSelectDisabled:!!v}),i===Fe.b.Manual&&Object(e.jsx)(Qe,{onDataConverted:x})]})},jt=function(u){var t=u.onSelect;return Object(e.jsxs)(ke.a,{gutter:[16,16],children:[Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(Fe.b.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(Fe.b.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(Fe.b.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(Fe.b.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},St=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Ot=function(u){var t,r=u.exam_id,a=we.a.useForm(),i=Object(B.a)(a,1),j=i[0],O=Object(d.useState)(),h=Object(B.a)(O,2),y=h[0],g=h[1],v=Object(d.useState)(),x=Object(B.a)(v,2),f=x[0],p=x[1],T=Object(d.useState)(!1),C=Object(B.a)(T,2),D=C[0],J=C[1],M=Object(Z.b)(),be=M.semester_subject_id,X=M.getGroupById,fe=Object(d.useMemo)(function(){var Pe;return((Pe=f==null?void 0:f.exam_results)!==null&&Pe!==void 0?Pe:[]).map(function(ue){var ge=ue.user_id;return ge})},[f==null?void 0:f.exam_results]);Object(d.useEffect)(function(){var Pe=Number(r);r==="new"&&(g(void 0),p(void 0),j.resetFields()),r!=="new"&&!Number.isNaN(Pe)&&(J(!0),Ie(Pe).then(function(ue){if(ue.success){var ge=ue.data,q=ge.type,ne=ge.results,ve=ge.title,Ee=ge.weight,ye=ge.passed_at,dt=ge.group_id;g(q),p({group_id:dt,exam_results:ne}),j.setFieldsValue({title:ve,weight:Ee,passed_at:ye})}}).finally(function(){return J(!1)}))},[r]);var Ke=Object(d.useCallback)(function(){g(void 0),p(void 0)},[]);return D?Object(e.jsx)(I.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(pt,{open:Boolean(y&&!f),type:y,closeModal:Ke,onSuccess:p}),Object(e.jsxs)(we.a,{form:j,submitter:y===void 0||!f?!1:void 0,onFinish:function(){var Pe=Object(m.a)(Object(_.a)().mark(function ue(ge){var q,ne,ve,Ee,ye,dt,me,G,w,Y;return Object(_.a)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(ne=f==null||(q=f.exam_results)===null||q===void 0?void 0:q.every(function(Ye){var We=Ye.result;return typeof We=="number"&&We>=0&&We<=100}),!(f&&ne&&typeof be=="number")){se.next=17;break}if(ve=ge.title,Ee=ge.passed_at,ye=ge.weight,dt=Number(r),me=f.exam_results,G=f.group_id,w={type:y,semester_subject_id:be,title:ve,passed_at:Ee,weight:ye,group_id:G,results:me},!Number.isNaN(dt)){se.next=12;break}return se.next=9,N(w);case 9:se.t0=se.sent,se.next=15;break;case 12:return se.next=14,F(dt,w);case 14:se.t0=se.sent;case 15:Y=se.t0,Y.success&&s.f.push("/teacher/subjects/".concat(be,"/exams"));case 17:return se.abrupt("return",!0);case 18:case"end":return se.stop()}},ue)}));return function(ue){return Pe.apply(this,arguments)}}(),onReset:Ke,children:[Object(e.jsxs)(we.a.Group,{children:[Object(e.jsx)(mt.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(oe.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(we.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(at.a,{})})]}),y&&f&&Object(e.jsx)(Q.a,{rowKey:"user_id",headerTitle:(t=X(f.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:fe,onValuesChange:function(ue,ge){return p({group_id:f.group_id,exam_results:ge})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:f.exam_results,columns:St}),!f&&Object(e.jsx)(jt,{onSelect:g})]})]})},Et=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Re=function(u){var t=u.exam_id;return Object(e.jsx)(Q.a,{rowKey:"user_id",search:!1,headerTitle:Object(e.jsx)(s.a,{id:"examResults"}),request:Object(m.a)(Object(_.a)().mark(function r(){var a;return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,Ie(t);case 2:if(a=j.sent,!a.success){j.next=5;break}return j.abrupt("return",{total:a.data.results.length,success:!0,data:a.data.results});case 5:return j.abrupt("return",[]);case 6:case"end":return j.stop()}},r)})),columns:Et})},k=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(u,t){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(t.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(u,t){return t.passed_at&&Object(Je.a)(new Date(t.passed_at),W.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(u,t){return t.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(u,t){return t.created_at&&Object(Je.a)(new Date(t.created_at),W.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(u,t){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(u,t){return Object(e.jsx)($.a,{type:"Students",type_id:t.group_id},t.group_id)}}],te=function(){var u,t,r=Object(d.useRef)(),a=Object(Z.b)(),i=a.semester_subject_id,j=Object(Be.k)(),O=Object(d.useMemo)(function(){var g,v,x;return{exam_id:(g=(v=j.query)===null||v===void 0?void 0:v.exam_id)!==null&&g!==void 0?g:null,results:(x=j.query)===null||x===void 0?void 0:x.results}},[(u=j.query)===null||u===void 0?void 0:u.exam_id,(t=j.query)===null||t===void 0?void 0:t.results]),h=O.exam_id,y=O.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(Re,{exam_id:Number(y)}):h!==null?Object(e.jsx)(Ot,{exam_id:h}):Object(e.jsx)(Q.a,{headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var g=Object(m.a)(Object(_.a)().mark(function v(x,f){var p,T,C,D;return Object(_.a)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(p=x.current,T=x.pageSize,i!==null){M.next=3;break}return M.abrupt("return",{data:[],total:0,success:!1});case 3:return C=f&&Object.entries(f)[0],M.next=6,K({per_page:T,page:p,semester_subject_id:Number.isNaN(i)?void 0:i,order_by:C&&C[0],order:C&&(C[1]==="ascend"?"ASC":"DESC")});case 6:if(D=M.sent,!D.success){M.next=9;break}return M.abrupt("return",{data:D.data,total:D.meta.total,success:!0});case 9:return M.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return M.stop()}},v)}));return function(v,x){return g.apply(this,arguments)}}(),columns:[].concat(k,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(v,x){return[Object(e.jsx)(ce.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?exam_id=").concat(x.id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(tt.a,{})})})},"edit"),Object(e.jsx)(ce.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?results=").concat(x.id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(U.a,{icon:Object(e.jsx)(ze.a,{})})})},"results"),Object(e.jsx)(he.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(m.a)(Object(_.a)().mark(function f(){var p;return Object(_.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,Le(x.id);case 2:p=C.sent,p.success&&r.current&&r.current.reload();case 4:case"end":return C.stop()}},f)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(ct.a,{}),danger:!0})})},"delete")]}}])})},ae=n("o0Ox"),de=n("miYZ"),je=n("tsqr"),Ae=n("4KAj");function nt(l,u){return bt.apply(this,arguments)}function bt(){return bt=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:u},t||{})));case 1:case"end":return a.stop()}},l)})),bt.apply(this,arguments)}var ht=function(u){var t=u.student_id,r=Object(d.useState)(!1),a=Object(B.a)(r,2),i=a[0],j=a[1],O=Object(d.useCallback)(Object(m.a)(Object(_.a)().mark(function h(){var y;return Object(_.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return j(!0),v.next=3,nt({user_id:t});case 3:if(y=v.sent,y.success){v.next=8;break}return je.b.error(y.message),j(!1),v.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),j(!1);case 10:case"end":return v.stop()}},h)})),[]);return Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(U.a,{loading:i,type:"primary",icon:Object(e.jsx)(Ae.a,{}),onClick:O})})},yt=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Tt=function(u){return u.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},Ct=function(u){return u.reduce(function(t,r){var a,i=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(j,O){return O.academic_teacher_id!==null?j:[].concat(Object(P.a)(j),[{group_id:r.id,group_name:r.name,user_id:O.id,first_name:O.first_name,last_name:O.last_name,email:O.email}])},[]);return[].concat(Object(P.a)(t),Object(P.a)(i))},[])},Zt=function(){var u=Object(Z.b)(),t=u.teacherSubjectData,r=Object(d.useMemo)(function(){var a;return Tt((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return Object(e.jsx)(Q.a,{rowKey:function(i){return"".concat(i.group_id,"-").concat(i.user_id)},search:{layout:"vertical"},request:function(){var a=Object(m.a)(Object(_.a)().mark(function i(j){var O,h,y,g,v,x,f,p,T;return Object(_.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return O=j.groups,h=j.first_name,y=h===void 0?"":h,g=j.last_name,v=g===void 0?"":g,x=j.email,f=x===void 0?"":x,D.next=3,Object(ae.a)({parent_id:t==null?void 0:t.group_id,"id[]":O});case 3:if(p=D.sent,p.success){D.next=6;break}return D.abrupt("return",{data:[],total:0,success:!1});case 6:return T=Ct(p.data).filter(function(J){return J.first_name.toLowerCase().includes(y.toLowerCase())&&J.last_name.toLowerCase().includes(v.toLowerCase())&&J.email.toLowerCase().includes(f.toLowerCase())}),D.abrupt("return",{data:T,total:T.length,success:!0});case 8:case"end":return D.stop()}},i)}));return function(i){return a.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(yt,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(i,j){return[Object(e.jsx)(ht,{student_id:j.user_id},"teamsChat")]}}])})},Na=n("/zsF"),Mt=n("PArb"),Pt=n("jrin");function Dt(l,u){return It.apply(this,arguments)}function It(){return It=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},l)})),It.apply(this,arguments)}function Wt(l,u,t,r){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(m.a)(Object(_.a)().mark(function l(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(u,"/attendances"),Object(c.a)({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return j.stop()}},l)})),Rt.apply(this,arguments)}var wa=n("sRBo"),Vt=n("kaz8"),Qt=function(u){var t=u.currentData,r=u.recordData,a=u.groupId,i=u.onSuccess,j=Object(d.useState)(!1),O=Object(B.a)(j,2),h=O[0],y=O[1],g=function(){y(!0),Wt(t.id,r.id,(r==null?void 0:r[String(t.date_from)])===Fe.a.PRESENT?Fe.a.ABSENT:Fe.a.PRESENT).then(function(x){x.success&&Dt(Number(a)).then(function(f){f.success&&(i(f.data),y(!1))})})};return h?Object(e.jsx)(I.a,{size:"small"}):Object(e.jsx)(Vt.a,{checked:(r==null?void 0:r[String(t.date_from)])===Fe.a.PRESENT,onChange:function(){return g()}})},Xt=Qt,kt=function(){var u,t,r,a=Object(Z.b)(),i=a.teacherSubjectData,j=Object(s.l)(),O=Object(d.useState)(!1),h=Object(B.a)(O,2),y=h[0],g=h[1],v=Object(d.useState)(),x=Object(B.a)(v,2),f=x[0],p=x[1],T=Object(d.useState)(),C=Object(B.a)(T,2),D=C[0],J=C[1],M=Object(d.useState)({full_name:""}),be=Object(B.a)(M,2),X=be[0],fe=be[1],Ke=Object(d.useState)((u=i==null||(t=i.groups)===null||t===void 0||(r=t[0])===null||r===void 0?void 0:r.id)!==null&&u!==void 0?u:null),Pe=Object(B.a)(Ke,2),ue=Pe[0],ge=Pe[1],q=Object(d.useMemo)(function(){var G;return((G=D==null?void 0:D.users)!==null&&G!==void 0?G:[]).reduce(function(w,Y){var Oe=Y.id,se=Y.first_name,Ye=Y.last_name,We=Y.academic_teacher_id,Ne={id:Oe,full_name:"".concat(Ye," ").concat(se," "),academic_teacher_id:We};if(!Ne.full_name.toLowerCase().includes(X.full_name.toLowerCase())||We!==null)return w;var Xe=(f!=null?f:[]).reduce(function(Ve,ot){var vt=ot.attendances.find(function(Ka){return Ka.user_id===Oe});return Object(c.a)(Object(c.a)({},Ve),{},Object(Pt.a)({},String(ot.date_from),vt==null?void 0:vt.value))},{}),ft=Object(c.a)(Object(c.a)({},Ne),Xe),_e=[].concat(Object(P.a)(w),[ft]);return _e.sort(function(Ve,ot){return Ve.full_name.localeCompare(ot.full_name)})},[])},[D,f,X==null?void 0:X.full_name]),ne=Object(d.useMemo)(function(){var G=(f!=null?f:[]).reduce(function(w,Y){return[].concat(Object(P.a)(w),[{title:String(Object(Je.a)(new Date(Y.date_from),W.c)),dataIndex:String(Y.date_from),hideInSearch:!0,width:100,align:"center",render:function(se,Ye){return Object(e.jsx)(Xt,{currentData:Y,recordData:Ye,onSuccess:function(Ne){return p(Ne)},groupId:ue})}}])},[]);return g(!1),[{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(P.a)(G))},[f]),ve=Object(d.useCallback)(function(G){var w,Y;if(G===null)return"";var Oe=i==null||(w=i.groups)===null||w===void 0?void 0:w.find(function(se){return se.id===G});return(Y=Oe==null?void 0:Oe.name)!==null&&Y!==void 0?Y:""},[i==null?void 0:i.groups]),Ee=Object(d.useCallback)(function(){return fe({full_name:""})},[]),ye=Object(d.useCallback)(function(G){var w=G.full_name,Y=w===void 0?"":w;return fe({full_name:Y})},[]),dt=Object(d.useMemo)(function(){var G;return((G=i==null?void 0:i.groups)!==null&&G!==void 0?G:[]).map(function(w){var Y=w.id,Oe=w.name;return{value:Y,label:Oe}})},[i==null?void 0:i.groups]),me=Object(d.useCallback)(function(G){Ee(),g(!0),ge(G)},[]);return Object(d.useEffect)(function(){ue!==null&&(Dt(ue).then(function(G){G.success&&p(G.data)}),Object(ae.b)(ue).then(function(G){G.success&&J(G.data)}))},[ue]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(we.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(L.a,{onChange:me,value:ue,options:dt})}),Object(e.jsx)(Mt.a,{}),ne.length===1?Object(e.jsx)(s.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."}):Object(e.jsx)(Q.a,{className:"attendances-table",headerTitle:"".concat(j.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(ve(ue),")"),rowKey:"id",onSubmit:ye,onReset:Ee,search:{layout:"vertical"},loading:y,dataSource:q,scroll:{x:1500},columns:ne})]})},qt=n("Hn4i"),ea=n("bRQS");function Ht(l,u,t){return At.apply(this,arguments)}function At(){return At=Object(m.a)(Object(_.a)().mark(function l(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(u,"/tutors/").concat(t,"/grades"),Object(c.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return i.stop()}},l)})),At.apply(this,arguments)}function ta(l,u,t,r){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(m.a)(Object(_.a)().mark(function l(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(u,"/tutors/").concat(t,"/grades"),Object(c.a)({method:"POST",data:r},a||{})));case 1:case"end":return j.stop()}},l)})),Lt.apply(this,arguments)}function aa(l,u){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(c.a)({method:"GET",params:{"groups[]":u},useCache:!1},t||{})));case 1:case"end":return a.stop()}},l)})),Gt.apply(this,arguments)}function na(l,u,t){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(m.a)(Object(_.a)().mark(function l(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(u,"/users/").concat(t),Object(c.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return i.stop()}},l)})),Ft.apply(this,arguments)}function ra(l){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(m.a)(Object(_.a)().mark(function l(u){return Object(_.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(c.a)({method:"GET",useCache:!1},u||{})));case 1:case"end":return r.stop()}},l)})),Ut.apply(this,arguments)}function sa(l,u){return $t.apply(this,arguments)}function $t(){return $t=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},l)})),$t.apply(this,arguments)}function ua(l,u){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(c.a)({method:"POST",data:u},t||{})));case 1:case"end":return a.stop()}},l)})),Bt.apply(this,arguments)}function ia(l,u,t){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(m.a)(Object(_.a)().mark(function l(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(u),Object(c.a)({method:"PATCH",data:t},r||{})));case 1:case"end":return i.stop()}},l)})),Kt.apply(this,arguments)}var ca=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],la=function(){var u,t,r=Object(s.m)("@@initialState"),a=r.initialState,i=Object(Z.b)(),j=i.semester_subject_id,O=i.tutors,h=we.a.useForm(),y=Object(B.a)(h,1),g=y[0],v=Object(d.useState)([]),x=Object(B.a)(v,2),f=x[0],p=x[1],T=Object(d.useRef)(),C=Object(d.useState)(!1),D=Object(B.a)(C,2),J=D[0],M=D[1],be=Object(d.useState)(null),X=Object(B.a)(be,2),fe=X[0],Ke=X[1],Pe=Object(d.useMemo)(function(){return!!O.data.find(function(q){var ne,ve=q.id;return ve===(a==null||(ne=a.currentUser)===null||ne===void 0?void 0:ne.id)})},[O.data,a==null||(u=a.currentUser)===null||u===void 0?void 0:u.id]),ue=Object(d.useMemo)(function(){return O.data.map(function(q){var ne=q.id,ve=q.first_name,Ee=q.last_name;return{label:"".concat(ve," ").concat(Ee),value:ne}})},[O.data]);Object(d.useEffect)(function(){var q,ne;if(!Pe||!(a!=null&&(q=a.currentUser)!==null&&q!==void 0&&q.id)){var ve;if((ve=O.data)!==null&&ve!==void 0&&ve[0]){var Ee;Ke((Ee=O.data)===null||Ee===void 0?void 0:Ee[0].id)}return}Ke(a==null||(ne=a.currentUser)===null||ne===void 0?void 0:ne.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,Pe]),Object(d.useEffect)(function(){j===null||fe===null||(M(!0),Ht(j,fe).then(function(q){if(q.success){var ne,ve=((ne=q.data.grade_scale)!==null&&ne!==void 0?ne:[]).map(function(Ee,ye){return Object(c.a)(Object(c.a)({},Ee),{},{id:String((ye+1)*100)})});g.setFieldValue("table",ve)}}).finally(function(){M(!1)}))},[j,fe]);var ge=Object(d.useCallback)(function(){var q=Object(m.a)(Object(_.a)().mark(function ne(ve){return Object(_.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!(j===null||fe===null)){ye.next=2;break}return ye.abrupt("return");case 2:return ye.next=4,ta(j,fe,{grade_scale:ve.table});case 4:case"end":return ye.stop()}},ne)}));return function(ne){return q.apply(this,arguments)}}(),[fe,j]);return O.loading?Object(e.jsx)(I.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(we.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(L.a,{disabled:Pe,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:ue,value:fe,onChange:function(ne){return Ke(ne)}})}),Object(e.jsx)(Mt.a,{}),Object(e.jsx)(we.a,{form:g,onFinish:ge,submitter:{render:function(ne,ve){var Ee=Object(B.a)(ve,2),ye=Ee[1];return[ye]}},children:Object(e.jsx)(qt.a,{name:"table",rowKey:"id",actionRef:T,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,loading:J,columns:[].concat(ca,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(ne,ve){return Object(e.jsx)(U.a,{type:"primary",onClick:function(){var ye;return(ye=T.current)===null||ye===void 0?void 0:ye.startEditable(ve.id)},icon:Object(e.jsx)(tt.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:f,saveText:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(ea.a,{})}),onChange:p,actionRender:function(ne,ve,Ee){return[Ee.save]}}})})]})},Wa=n("qbNl"),da=n("JBPa"),Va=n("tU7J"),rt=n("wFql"),Ha=n("Awhp"),oa=n("KrTs"),ja=n("wd/R"),st=n.n(ja);function ba(l,u){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(m.a)(Object(_.a)().mark(function l(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules",Object(c.a)({params:u,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},l)})),Nt.apply(this,arguments)}var Ja=n("5R/X"),fa=function(){var u=Object(d.useState)(null),t=Object(B.a)(u,2),r=t[0],a=t[1],i=Object(d.useState)([]),j=Object(B.a)(i,2),O=j[0],h=j[1],y=Object(Z.b)(),g=y.semester_subject_id,v=st()(),x=Object(d.useMemo)(function(){return O.map(function(M){return{id:M.id,title:"".concat(M.group.name," (").concat(M.term_status.name,")"),start:st()(M.date_from).toDate(),end:st()(M.date_to).toDate(),tutor_name:"".concat(M.tutor.first_name," ").concat(M.tutor.last_name),tutor_email:M.tutor.email,semester:M.semester.name,group:M.group.name,subject:M.subject.name,ms_teams_join_url:M.ms_teams_join_url}})},[O]),f=Object(d.useCallback)(function(M,be){ba({semester_subject_id:g,date_form:M.toDate(),date_to:be.toDate()}).then(function(X){X.success&&h(X.data)})},[g]),p=Object(d.useCallback)(function(M){a(M)},[]),T=Object(d.useCallback)(function(){a(null)},[]),C=Object(d.useCallback)(function(M){return M.isSame(v,"day")?"warning":M.isAfter(v,"day")?"success":"error"},[]),D=Object(d.useCallback)(function(M){var be=x.filter(function(X){return st()(X.start).isSame(M,"day")});return Object(e.jsx)("ul",{className:"events",children:be.map(function(X){return Object(e.jsx)("li",{onClick:function(){return p(X)},children:Object(e.jsx)(oa.a,{status:C(st()(X.start)),text:X.title})},X.id)})})},[O]),J=Object(d.useCallback)(function(M,be){var X=st()(M).startOf(be).subtract(1,"month"),fe=st()(M).endOf(be).add(1,"month");f(X,fe)},[]);return Object(d.useEffect)(function(){var M=st()().startOf("month"),be=st()().endOf("month");f(M,be)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(rt.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(da.a,{dateCellRender:D,onPanelChange:J}),Object(e.jsxs)(A.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:T,footer:null,children:[Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&st()(r.start).format(W.b)]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&st()(r.end).format(W.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(rt.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(U.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Jt=n("yj/a"),zt=n("5Syx"),gt=n("PpiC"),wt=n("H6aw"),ma=n("p3I6"),va=["attendances"],Oa=["results"];function ha(l,u){var t=Object(d.useState)({loading:!1}),r=Object(B.a)(t,2),a=r[0],i=r[1];return Object(d.useEffect)(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),na(l,u).then(function(j){j.success&&i(function(O){return Object(c.a)(Object(c.a)({},O),{},{data:j.data})})}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})})},[u,l]),{finalGrades:a}}function pa(){var l=Object(d.useState)({loading:!1}),u=Object(B.a)(l,2),t=u[0],r=u[1];return Object(d.useEffect)(function(){r(function(a){return Object(c.a)(Object(c.a)({},a),{},{loading:!0})}),ra().then(function(a){a.success&&r(function(i){return Object(c.a)(Object(c.a)({},i),{},{data:a.data})})}).finally(function(){r(function(a){return Object(c.a)(Object(c.a)({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function ga(l){var u=Object(d.useState)({loading:!1}),t=Object(B.a)(u,2),r=t[0],a=t[1];return Object(d.useEffect)(function(){l!==void 0&&(a(function(i){return Object(c.a)(Object(c.a)({},i),{},{loading:!0})}),sa(l).then(function(i){i.success&&a(function(j){return Object(c.a)(Object(c.a)({},j),{},{data:i.data})})}).finally(function(){a(function(i){return Object(c.a)(Object(c.a)({},i),{},{loading:!1})})}))},[l]),{subjectGradeScales:r}}function _a(l,u){var t=Object(d.useState)({loading:!1}),r=Object(B.a)(t,2),a=r[0],i=r[1];return Object(d.useEffect)(function(){typeof l!="number"||typeof u!="number"||(i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),Ht(l,u).then(function(j){j.success&&i(function(O){return Object(c.a)(Object(c.a)({},O),{},{data:j.data.grade_scale.map(function(h,y){return Object(c.a)(Object(c.a)({},h),{},{id:y})})})})}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})}))},[l,u]),{tutorGradeScales:a}}function xa(l,u){var t=Object(d.useState)({loading:!1}),r=Object(B.a)(t,2),a=r[0],i=r[1],j=Object(d.useCallback)(function(){i(function(h){return Object(c.a)(Object(c.a)({},h),{},{loading:!0})}),Dt(l).then(function(h){if(h.success){var y=h.data.reduce(function(g,v){var x=v.attendances,f=Object(gt.a)(v,va),p=x.find(function(T){return T.user_id===u});return p?[].concat(Object(P.a)(g),[Object(c.a)(Object(c.a)({},f),{},{attendance:p})]):g},[]);i(function(g){return Object(c.a)(Object(c.a)({},g),{},{data:y})})}}).finally(function(){i(function(h){return Object(c.a)(Object(c.a)({},h),{},{loading:!1})})})},[l,u]),O=Object(d.useCallback)(function(h,y){i(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!0})}),Wt(h,u,y).then(function(g){g.success?je.b.success(g.message):je.b.error(g.message)}).finally(function(){j(),i(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!1})})})},[j,u]);return Object(d.useEffect)(function(){j()},[j]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:j,updateUserAttendanceSchedules:O}}function Sa(l,u){var t=Object(d.useState)({loading:!1}),r=Object(B.a)(t,2),a=r[0],i=r[1];return Object(d.useEffect)(function(){!u||(i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),K({student_id:l,semester_subject_id:u}).then(function(j){if(j.success){var O=j.data.reduce(function(h,y){var g=Object(B.a)(y.results,1),v=g[0],x=Object(gt.a)(y,Oa);return v?[].concat(Object(P.a)(h),[Object(c.a)(Object(c.a)({},x),{},{result:v})]):h},[]);i(function(h){return Object(c.a)(Object(c.a)({},h),{},{data:O})})}}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})}))},[l,u]),{studentExams:a}}function Ea(l,u){var t=Object(d.useState)({loading:!1}),r=Object(B.a)(t,2),a=r[0],i=r[1],j=Object(d.useState)({loading:!1}),O=Object(B.a)(j,2),h=O[0],y=O[1],g=Object(d.useState)({loading:!1}),v=Object(B.a)(g,2),x=v[0],f=v[1];return Object(d.useEffect)(function(){i(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!0})}),Object(wt.e)({group_id:l}).then(function(p){p.success&&i(function(T){return Object(c.a)(Object(c.a)({},T),{},{data:p.data})})}).finally(function(){i(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!1})})})},[l]),Object(d.useEffect)(function(){!a.data||(f(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!0})}),Promise.all(a.data.map(function(p){var T=p.id;return Object(wt.m)(Number(T))})).then(function(p){p.forEach(function(T){T.success&&f(function(C){return Object(c.a)(Object(c.a)({},C),{},{data:Object(c.a)(Object(c.a)({},C.data),{},Object(Pt.a)({},Number(T.data.id),Object(ma.c)(T.data.lessons)))})})})}).finally(function(){f(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!1})})}),y(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!0})}),Promise.all(a.data.map(function(p){var T=p.id;return Object(wt.l)(Number(T),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(C){if(C.success){var D,J,M=((D=C.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&D!==void 0?D:[]).filter(function(X){return X.id===u}),be=(J=C.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&J!==void 0?J:[];y(function(X){return Object(c.a)(Object(c.a)({},X),{},{data:Object(c.a)(Object(c.a)({},X.data),{},Object(Pt.a)({},Number(T),{finishedTopics:M,attendanceList:be}))})})}})})).finally(function(){return y(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!1})})}))},[a.data,u]),{userCourses:a,userCoursesStats:h,userCoursesTopics:x}}var ya=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ta=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(u,t){return Object(Je.a)(new Date(t.date_from),W.c)}}],Ca=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(u,t){return Object(Je.a)(new Date(t.created_at),W.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(u,t){return"".concat(t.result.result,"%")}}],Ma=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(u,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?Object(Je.a)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),W.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(u,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],_t=6,Pa=function(u){var t,r,a=u.user_id,i=u.group_id,j=Object(Z.b)(),O=j.semester_subject_id,h=Sa(a,O),y=h.studentExams,g=ha(i,a),v=g.finalGrades,x=pa(),f=x.gradeTerms,p=ga((t=v.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),T=p.subjectGradeScales,C=_a(O,(r=v.data)===null||r===void 0?void 0:r.tutor_id),D=C.tutorGradeScales,J=xa(i,a),M=J.userAttendanceSchedules,be=J.updateUserAttendanceSchedules,X=Ea(i,a),fe=X.userCourses,Ke=X.userCoursesStats,Pe=X.userCoursesTopics,ue=we.a.useForm(),ge=Object(B.a)(ue,1),q=ge[0],ne=Object(d.useMemo)(function(){var me;return((me=f.data)!==null&&me!==void 0?me:[]).map(function(G){var w=G.id,Y=G.name;return{label:Y,value:w}})},[f.data]),ve=Object(d.useMemo)(function(){var me;return((me=T.data)!==null&&me!==void 0?me:[]).map(function(G){var w=G.name,Y=G.id;return{label:w,value:Y}})},[T.data]),Ee=Object(d.useMemo)(function(){var me,G,w,Y=((me=y.data)!==null&&me!==void 0?me:[]).reduce(function(_e,Ve){var ot=Ve.result,vt=Ve.weight;return[_e[0]+ot.result*vt,_e[1]+vt]},[0,0]),Oe=Object(B.a)(Y,2),se=Oe[0],Ye=Oe[1],We=Number.isNaN(se/Ye)?0:se/Ye,Ne=((G=D.data)!==null&&G!==void 0?G:[]).sort(function(_e,Ve){return _e.grade_value-Ve.grade_value}).reduce(function(_e,Ve){return[].concat(Object(P.a)(_e),[Object(c.a)(Object(c.a)({},Ve),{},{isWeightedAverageGreater:We>=Ve.grade_value})])},[]);if(Ne.every(function(_e){var Ve=_e.isWeightedAverageGreater;return Ve})){var Xe;return(Xe=Ne.at(-1))===null||Xe===void 0?void 0:Xe.name}var ft=Ne.findIndex(function(_e){var Ve=_e.isWeightedAverageGreater;return!Ve});return ft<0?"":(w=Ne[ft-1])===null||w===void 0?void 0:w.name},[y.data,D.data]),ye=Object(d.useCallback)(function(){var me=Object(m.a)(Object(_.a)().mark(function G(w){var Y,Oe,se,Ye,We,Ne,Xe;return Object(_.a)().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(se=w.grade_scale_id,Ye=w.grade_term_id,((Y=v.data)===null||Y===void 0?void 0:Y.id)!==void 0){_e.next=3;break}return _e.abrupt("return");case 3:if(We=(Oe=v.data)===null||Oe===void 0?void 0:Oe.grades.find(function(Ve){var ot=Ve.grade_term;return ot.id===Ye}),!We){_e.next=11;break}return _e.next=7,ia(We.id,{grade_scale_id:se});case 7:return Ne=_e.sent,je.b[Ne.success?"success":"error"](Ne.message),Ne.success&&s.f.push("/teacher/subjects/".concat(O,"/final-grades")),_e.abrupt("return");case 11:return _e.next=13,ua({grade_scale_id:se,grade_term_id:Ye,lesson_group_user_id:v.data.id});case 13:Xe=_e.sent,je.b[Xe.success?"success":"error"](Xe.message),Xe.success&&s.f.push("/teacher/subjects/".concat(O,"/final-grades"));case 16:case"end":return _e.stop()}},G)}));return function(G){return me.apply(this,arguments)}}(),[v.data,O]),dt=Object(d.useMemo)(function(){var me;return((me=f.data)!==null&&me!==void 0?me:[]).map(function(G){var w;return Object(c.a)(Object(c.a)({},G),{},{grade:(w=v.data)===null||w===void 0?void 0:w.grades.find(function(Y){var Oe=Y.grade_term;return Oe.id===G.id})})})},[v.data,f.data]);return v.loading?Object(e.jsx)(I.a,{}):Object(e.jsxs)(e.Fragment,{children:[v.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(rt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:v.data.user})}),Object(e.jsx)(Mt.a,{})]}),Object(e.jsxs)(ke.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(Q.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:_t},dataSource:y.data,loading:y.loading,columns:Ca,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(Q.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:_t},dataSource:dt,loading:v.loading||f.loading,columns:Ma,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(Q.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:_t},cardProps:{bodyStyle:{padding:0}},dataSource:M.data,loading:M.loading,columns:[].concat(Ta,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(G,w){return Object(e.jsx)(Vt.a,{onChange:function(Oe){return be(w.id,Oe.target.checked?Fe.a.PRESENT:Fe.a.ABSENT)},checked:w.attendance.value===Fe.a.PRESENT})}}])})}),Object(e.jsx)(re.a,{span:12,children:Object(e.jsx)(Q.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:_t},cardProps:{bodyStyle:{padding:0}},dataSource:D.data,loading:D.loading,columns:ya})}),fe.loading&&!fe.data||Ke.loading&&!Ke.data||Pe.loading&&!Pe.data&&Object(e.jsx)(I.a,{}),fe.data&&Ke.data&&Pe.data&&fe.data.map(function(me){var G,w,Y,Oe,se,Ye,We,Ne,Xe=me.id,ft=me.title;return Object(e.jsxs)(re.a,{span:24,children:[Object(e.jsx)(rt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:ft}),Object(e.jsx)(zt.c,{topics:(G=(w=Pe.data)===null||w===void 0?void 0:w[Number(Xe)])!==null&&G!==void 0?G:[],stats:(Y=(Oe=Ke.data)===null||Oe===void 0||(se=Oe[Number(Xe)])===null||se===void 0?void 0:se.finishedTopics)!==null&&Y!==void 0?Y:[]}),Object(e.jsx)(zt.a,{stats:(Ye=(We=Ke.data)===null||We===void 0||(Ne=We[Number(Xe)])===null||Ne===void 0?void 0:Ne.attendanceList)!==null&&Ye!==void 0?Ye:[]})]},Xe)})]}),Object(e.jsx)(we.a,{form:q,onFinish:ye,children:Object(e.jsxs)(we.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Jt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ne,width:"sm",fieldProps:{loading:f.loading}}),Object(e.jsx)(Jt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ve,fieldProps:{loading:v.loading||T.loading}}),Object(e.jsx)(we.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Ee}})})]})})]})},Da=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(u,t){return t.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(u,t){return t.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(u,t){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,i=r.grade_term,j=r.id;return Object(e.jsxs)(rt.a.Text,{children:[i.name,": ",a]},j)}):"-"})}}],Ia=function(){var u,t,r=Object(Be.k)(),a=Object(d.useMemo)(function(){var v,x,f,p;return{user_id:Number.isNaN(Number((v=r.query)===null||v===void 0?void 0:v.user_id))?null:Number((x=r.query)===null||x===void 0?void 0:x.user_id),group_id:Number.isNaN(Number((f=r.query)===null||f===void 0?void 0:f.group_id))?null:Number((p=r.query)===null||p===void 0?void 0:p.group_id)}},[(u=r.query)===null||u===void 0?void 0:u.user_id,(t=r.query)===null||t===void 0?void 0:t.group_id]),i=a.user_id,j=a.group_id,O=Object(Z.b)(),h=O.teacherSubjectData,y=O.semester_subject_id,g=Object(d.useMemo)(function(){var v;return((v=h==null?void 0:h.groups)!==null&&v!==void 0?v:[]).map(function(x){var f=x.id,p=x.name;return{label:p,value:f}})},[h==null?void 0:h.groups]);return i!==null&&j!==null?Object(e.jsx)(Pa,{user_id:i,group_id:j}):Object(e.jsx)(Q.a,{rowKey:"id",search:{layout:"vertical"},request:function(){var v=Object(m.a)(Object(_.a)().mark(function x(f){var p,T,C,D,J,M,be,X,fe,Ke;return Object(_.a)().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return T=f.group_id,C=T===void 0?[]:T,D=f.first_name,J=D===void 0?"":D,M=f.last_name,be=M===void 0?"":M,X=((p=h==null?void 0:h.groups)!==null&&p!==void 0?p:[]).map(function(ge){var q=ge.id;return q}),ue.next=4,aa(C.length===0?X:C);case 4:if(fe=ue.sent,fe.success){ue.next=7;break}return ue.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ke=fe.data.filter(function(ge){var q=ge.user;return q.first_name.toLowerCase().includes(J.toLowerCase())&&q.last_name.toLowerCase().includes(be.toLowerCase())}),ue.abrupt("return",{success:!0,total:Ke.length,data:Ke});case 9:case"end":return ue.stop()}},x)}));return function(x){return v.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:g,mode:"multiple"},render:function(x,f){return Object(e.jsx)($.a,{type:"Students",type_id:f.group_id},f.group_id)}}].concat(Da,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(x,f){return[Object(e.jsx)(ce.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(f.user.id,"&group_id=").concat(f.group_id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(tt.a,{})})})},"edit")]}}])})},Ra=n("dF/Y"),Aa=n("o+0V"),Yt=n("0WSk"),La=["type","defaultRender"],Ga=["type","defaultRender"],Fa=function(u){var t=u.url;return Object(e.jsx)(He.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Ra.a,{})})})},Ua=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(u,t){return Object(Je.a)(new Date(t.created_at),W.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(u,t,r){var a=t.type,i=t.defaultRender,j=Object(gt.a)(t,La);if(a==="form")return null;var O=r.getFieldValue("state");return Object(e.jsx)(Yt.a,Object(c.a)(Object(c.a)({},j),{},{state:{type:O}}))},render:function(u,t){return Object(e.jsx)($.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id},t.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(u,t){return Object(Je.a)(new Date(t.exported_at),W.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(u,t,r){var a=t.type,i=t.defaultRender,j=Object(gt.a)(t,Ga);if(a==="form")return null;var O=r.getFieldValue("state");return Object(e.jsx)(Yt.a,Object(c.a)(Object(c.a)({},j),{},{state:{type:O}}))},render:function(u,t){return Object(e.jsx)($.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id},t.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(u,t){return[Object(e.jsx)(Fa,{url:t.url},"download")]}}],$a=function(){var u,t,r=Object(Z.b)(),a=r.teacherSubjectData,i=Object(d.useMemo)(function(){var O;return((O=a==null?void 0:a.groups)!==null&&O!==void 0?O:[]).map(function(h){var y=h.id,g=h.name;return{value:y,label:g}})},[a==null?void 0:a.groups]),j=Object(d.useMemo)(function(){var O,h;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:i,defaultValue:a==null||(O=a.groups)===null||O===void 0||(h=O[0])===null||h===void 0?void 0:h.id,allowClear:!1}}].concat(Ua)},[a==null||(u=a.groups)===null||u===void 0||(t=u[0])===null||t===void 0?void 0:t.id,i]);return Object(e.jsx)(Q.a,{request:function(){var O=Object(m.a)(Object(_.a)().mark(function h(y){var g,v,x,f,p,T,C;return Object(_.a)().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return x=y.group_id,f=x===void 0?a==null||(g=a.groups)===null||g===void 0||(v=g[0])===null||v===void 0?void 0:v.id:x,p=y.created_by,T=y.exported_by,J.next=3,Object(Aa.a)({group_id:f,created_by:p,exported_by:T});case 3:if(C=J.sent,C.success){J.next=6;break}return J.abrupt("return",{success:!1,data:[],total:0});case 6:return J.abrupt("return",{success:!0,data:C.data,total:C.data.length});case 7:case"end":return J.stop()}},h)}));return function(h){return O.apply(this,arguments)}}(),columns:j,search:{layout:"vertical"},scroll:{x:1500}})},Ba=function(u){var t,r,a=u.tab,i=Object(s.l)(),j=Object(s.m)("@@initialState"),O=j.setInitialState,h=j.initialState,y=Object(Z.b)(),g=y.teacherSubjectData,v=y.semester_subject_id,x=y.tutors,f=Object(d.useCallback)(Object(xe.a)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),p=Object(d.useMemo)(function(){return!!x.data.find(function(T){var C,D=T.id;return D===(h==null||(C=h.currentUser)===null||C===void 0?void 0:C.id)})||f(Te.a.TeacherListGradeScale)},[]);return g?Object(e.jsx)(ee.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:g==null||(t=g.subject)===null||t===void 0?void 0:t.name}),", ",Object(e.jsx)(s.a,{id:a})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(ce.a,{to:"/teacher/subjects/".concat(v,"/exams?exam_id=new"),children:Object(e.jsx)(U.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:i.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:i.formatMessage({id:"Subjects"})},{path:String(v),breadcrumbName:String((r=g.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:i.formatMessage({id:a,defaultMessage:String(a)})}]}},children:Object(e.jsxs)(o.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(C){O(Object(c.a)({},h)),s.f.push("/teacher/subjects/".concat(v,"/").concat(C))}},children:[Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(De.a,{})},"groups"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(Zt,{})},"students"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(te,{})},"exams"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(fa,{})},"schedule"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(kt,{})},"attendance"),p&&Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(la,{})},"grades-scale"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Ia,{})},"final-grades"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)($a,{})},"file-exports-history")]})}):Object(e.jsx)(I.a,{})},za=ie.default=function(){var l=Object(Be.l)(),u=l.subjectId,t=l.tab,r=t===void 0?"groups":t;return Object(e.jsx)(Z.a,{semester_subject_id:Number(u),children:Object(e.jsx)(Ba,{tab:r})})}},p3I6:function($e,ie,n){"use strict";n.d(ie,"b",function(){return Z}),n.d(ie,"c",function(){return he}),n.d(ie,"a",function(){return ct});var c=n("miYZ"),V=n("tsqr"),U=n("tJVT"),S=n("k1fw"),I=n("oBTY"),d=n("q1tI"),s=n.n(d),ce=n("9kvl"),Be=n("Ty5D"),o=n("H6aw"),ee=n("/y+f"),Te=n("nKUr"),xe=n.n(Te),Z=s.a.createContext({}),De=function(){return Math.round(Math.random()*99999)},ut=function Q(W){return W.reduce(function(K,E){return[].concat(Object(I.a)(K),Object(I.a)(E.lessons?Q(E.lessons):[]),[E])},[])},he=function Q(W){return W.reduce(function(K,E){var N;return[].concat(Object(I.a)(K),Object(I.a)(E.lessons?Q(E.lessons):[]),Object(I.a)((N=E.topics)!==null&&N!==void 0?N:[]))},[])},et=function Q(W,K,E){return W.map(function(N){var le,F;return Object(S.a)(Object(S.a)({},N),{},{lessons:N.lessons?Q(N.lessons,K,E):[],topics:N.id===K?[].concat(Object(I.a)((le=N.topics)!==null&&le!==void 0?le:[]),[E]):(F=N.topics)!==null&&F!==void 0?F:[]})})},He=function Q(W,K,E){return E?W.map(function(N){return Object(S.a)(Object(S.a)({},N),{},{lessons:[].concat(Object(I.a)(N.lessons?Q(N.lessons,K,E):[]),Object(I.a)(N.id===E?[K]:[]))})}):[].concat(Object(I.a)(W),[K])},_=function Q(W,K,E){return W.map(function(N){return Object(S.a)(Object(S.a)({},N.id===K?E:N),{},{lessons:N.lessons?Q(N.lessons,K,E):[]})})},m=function Q(W,K){return W.map(function(E){return Object(S.a)(Object(S.a)({},E),{},{parent_id:K,lessons:E.lessons?Q(E.lessons,E.id):[]})})},Je=function Q(W,K){return W.filter(function(E){return E.id!==K}).map(function(E){return Object(S.a)(Object(S.a)({},E),{},{lessons:E.lessons?Q(E.lessons,K):[]})})},tt=function Q(W,K){return W.map(function(E){return Object(S.a)(Object(S.a)({},E),{},{lessons:E.lessons?Q(E.lessons,K):[],topics:E.topics?E.topics.filter(function(N){return N.id!==K}):[]})})},ze=function Q(W,K,E,N){return N==null?void 0:N.map(function(le){if(le.id===E){var F;return Object(S.a)(Object(S.a)({},le),{},{topics:(F=le.topics)===null||F===void 0?void 0:F.map(function(b){return b.id===W?K.file.response.data:b})})}else if(le.lessons)return Object(S.a)(Object(S.a)({},le),{},{lessons:Q(W,K,E,le.lessons||[])});return le})},ct=function(W){var K=W.children,E=W.id,N=Object(d.useState)(),le=Object(U.a)(N,2),F=le[0],b=le[1],Ie=Object(ce.l)(),Ce=Object(d.useMemo)(function(){return F&&F.lessons?he(F.lessons):[]},[F]),Le=Object(d.useMemo)(function(){return F&&F.lessons?ut(F.lessons):[]},[F]),Se=Object(d.useState)([]),Ge=Object(U.a)(Se,2),Me=Ge[0],Ze=Ge[1],R=Object(Be.k)();Object(d.useEffect)(function(){Ze([])},[]);var $=Object(d.useCallback)(function(){Object(o.m)(E).then(function(A){return A.success&&b(Object(S.a)(Object(S.a)({},A.data),{},{lessons:m(A.data.lessons)}))})},[E]);Object(d.useEffect)(function(){$()},[$]);var pe=Object(d.useCallback)(function(A){var P=Le.find(function(H){var L;return H==null||(L=H.topics)===null||L===void 0?void 0:L.find(function(z){return z.id===A})});return P?P.id:null},[Le]),at=Object(d.useMemo)(function(){var A,P;return(A=R.query)!==null&&A!==void 0&&A.lesson?{mode:"lesson",id:Number(R.query.lesson),value:Le.find(function(H){return H.id===Number(R.query.lesson)})}:(P=R.query)!==null&&P!==void 0&&P.topic?{mode:"topic",id:Number(R.query.topic),value:Ce.find(function(H){return H.id===Number(R.query.topic)})}:{mode:"init"}},[R.query,F,Le,Ce]),B=Object(d.useCallback)(function(A){var P={course_id:E,topics:[],isNew:!0,id:F?F.lessons.length+1:De(),order:0,title:Ie.formatMessage({id:"add_title_here"}),active:!0,parent_id:A};return b(function(H){var L;return Object(S.a)(Object(S.a)({},H),{},{lessons:He((L=H==null?void 0:H.lessons)!==null&&L!==void 0?L:[],P,A)})}),P},[E,F]),qe=Object(d.useCallback)(function(A,P){var H=Le.find(function(z){return z.id===A}),L=H&&H.isNew;return(L?Object(o.g)(P):Object(o.u)(A,P)).then(function(z){return V.b.success(z.message),$(),z.success&&b(function(e){var Ue;return Object(S.a)(Object(S.a)({},e),{},{lessons:_((Ue=e==null?void 0:e.lessons)!==null&&Ue!==void 0?Ue:[],A,Object(S.a)(Object(S.a)({},z.data),{},{isNew:!1}))})})})},[F]),ke=Object(d.useCallback)(function(A){var P=Le.find(function(L){return L.id===A});if(!!P){var H=P.isNew;H?b(function(L){var z;return Object(S.a)(Object(S.a)({},L),{},{lessons:Je((z=L==null?void 0:L.lessons)!==null&&z!==void 0?z:[],A)})}):Object(o.o)(A).then(function(L){L.success&&(V.b.success(L.message),b(function(z){var e;return Object(S.a)(Object(S.a)({},z),{},{lessons:Je((e=z==null?void 0:z.lessons)!==null&&e!==void 0?e:[],A)})}))})}},[F]),lt=Object(d.useCallback)(function(A,P){var H,L=pe(A),z=Le.find(function(Qe){return Qe.id===L}),e=z&&((H=z.topics)===null||H===void 0?void 0:H.find(function(Qe){return Qe.id===A})),Ue=e==null?void 0:e.isNew;return(Ue?Object(o.h)(P):Object(o.v)(A,P)).then(function(Qe){Qe.success&&(V.b.success(Qe.message),$(),ce.f.push("/courses/list/".concat(E,"/program/?topic=").concat(Qe.data.id)),(e==null?void 0:e.topicable_type)===ee.f.Video&&setTimeout(function(){$()},5e3))})},[pe,F,$]),re=Object(d.useCallback)(function(A){var P=pe(A),H=Le.find(function(e){return e.id===P});if(!!H){var L=Ce==null?void 0:Ce.find(function(e){return e.id===A}),z=L==null?void 0:L.isNew;z&&!L.topicable?b(function(e){var Ue;return Object(S.a)(Object(S.a)({},e),{},{lessons:tt((Ue=e==null?void 0:e.lessons)!==null&&Ue!==void 0?Ue:[],A)})}):Object(o.p)(A).then(function(e){e.success&&(V.b.success(e.message),b(function(Ue){var Qe;return Object(S.a)(Object(S.a)({},Ue),{},{lessons:tt((Qe=Ue==null?void 0:Ue.lessons)!==null&&Qe!==void 0?Qe:[],A)})}))})}},[F,pe]),we=Object(d.useCallback)(function(A,P){var H={lesson_id:A,isNew:!0,id:De(),title:Ie.formatMessage({id:"add_title_here"}),active:!0,topicable_type:P};return b(function(L){var z;return Object(S.a)(Object(S.a)({},L),{},{lessons:et((z=L==null?void 0:L.lessons)!==null&&z!==void 0?z:[],A,H)})}),H},[]),mt=function(P,H){var L=pe(P);b(function(z){return Object(S.a)(Object(S.a)({},z),{},{lessons:z?ze(P,H,L,z.lessons||[]):[]})}),ce.f.push("/courses/list/".concat(E,"/program/?topic=").concat(H.file.response.data.id))},oe=Object(d.useCallback)(function(A){return Object(o.d)(A).then(function(P){if(P.success){V.b.success(P.message);var H=pe(A);b(function(L){var z;return Object(S.a)(Object(S.a)({},L),{},{lessons:L?(z=L.lessons)===null||z===void 0?void 0:z.map(function(e){if(e.id===H){var Ue=e.topics||[];return Object(S.a)(Object(S.a)({},e),{},{topics:[].concat(Object(I.a)(Ue),[P.data])})}return e}):[]})})}})},[F,pe]),Fe=Object(d.useCallback)(function(A){return Object(o.c)(A).then(function(P){P.success&&(V.b.success(P.message),b(function(H){return Object(S.a)(Object(S.a)({},H),{},{lessons:H?[].concat(Object(I.a)(H.lessons),[P.data]):[]})}))})},[]),it={state:F,h5ps:Me,id:E,addNewLesson:B,updateLesson:qe,updateTopic:lt,deleteLesson:ke,addNewTopic:we,deleteTopic:re,onTopicUploaded:mt,cloneTopic:oe,cloneLesson:Fe,currentEditMode:at,getLessons:$};return Object(Te.jsx)(Z.Provider,{value:it,children:K})}},quyA:function($e,ie){var n="\\ud800-\\udfff",c="\\u0300-\\u036f",V="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",S=c+V+U,I="\\ufe0e\\ufe0f",d="\\u200d",s=RegExp("["+d+n+S+I+"]");function ce(Be){return s.test(Be)}$e.exports=ce},wy8a:function($e,ie,n){var c=n("KxBF");function V(U,S,I){var d=U.length;return I=I===void 0?d:I,!S&&I>=d?U:c(U,S,I)}$e.exports=V}}]);
