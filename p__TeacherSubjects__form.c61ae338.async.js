(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"/y+f":function(ft,he,u){"use strict";u.d(he,"f",function(){return l}),u.d(he,"d",function(){return D}),u.d(he,"e",function(){return ie}),u.d(he,"c",function(){return ze}),u.d(he,"a",function(){return s}),u.d(he,"b",function(){return we});var l;(function(v){v.Unselected="",v.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",v.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",v.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",v.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",v.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",v.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",v.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",v.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",v.Project="EscolaLms\\TopicTypeProject\\Models\\Project",v.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(l||(l={}));var Se;(function(v){v.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",v.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(Se||(Se={}));var be;(function(v){v.draft="draft",v.published="published",v.archived="archived"})(be||(be={}));var D;(function(v){v.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",v.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",v.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(D||(D={}));var ie;(function(v){v.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(ie||(ie={}));var j;(function(v){v.cart_fixed="cart_fixed",v.cart_percent="cart_percent",v.product_fixed="product_fixed",v.product_percent="product_percent"})(j||(j={}));var ze;(function(v){v.MULTIPLE_CHOICE="multiple_choice",v.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",v.TRUE_FALSE="true_false",v.SHORT_ANSWERS="short_answers",v.MATCHING="matching",v.NUMERICAL_QUESTION="numerical_question",v.ESSAY="essay",v.DESCRIPTION="description"})(ze||(ze={}));var s;(function(v){v.PRESENT="present",v.ABSENT="absent"})(s||(s={}));var we;(function(v){v.Manual="manual",v.TeamsForms="teams_forms",v.TeamsLecture="teams_lecture",v.TestPortal="test_portal"})(we||(we={}))},"5R/X":function(ft,he,u){},"5Syx":function(ft,he,u){"use strict";u.d(he,"c",function(){return $e}),u.d(he,"b",function(){return it}),u.d(he,"a",function(){return oe});var l=u("OaEy"),Se=u("2fM7"),be=u("g9YV"),D=u("wCAj"),ie=u("BoS7"),j=u("Sdc0"),ze=u("jrin"),s=u("k1fw"),we=u("DYRE"),v=u("zeV3"),z=u("+BJd"),Le=u("mr32"),Ee=u("oBTY"),Ae=u("tJVT"),q=u("q1tI"),ot=u.n(q),ye=u("9kvl"),tt=u("Vpfc"),jt=u("nhC9"),Ke=u("LDJE"),b=u("nKUr"),W=u.n(b),Fe=function(B){return B.topicable.content.contents?Object.values(B.topicable.content.contents)[0].library:"H5P"},$e=function(B){var C=B.topics,N=B.stats,le=Object(q.useState)(!1),P=Object(Ae.a)(le,2),f=P[0],pe=P[1],ge=Object(q.useMemo)(function(){return[{title:Object(b.jsx)(ye.a,{id:"user"}),dataIndex:"id",render:function(Ce){return Object(b.jsx)(tt.a,{type:"App\\Models\\User",type_id:Ce})}},{title:Object(b.jsx)(ye.a,{id:"email"}),dataIndex:"email"}].concat(Object(Ee.a)(C.map(function(ve){var Ce,_e=(Ce=ve.topicable_type)===null||Ce===void 0?void 0:Ce.split("\\").pop();return _e==="H5P"&&(_e=Fe(ve)),{render:function(A){var V=0,de=0;switch(A&&(A.started_at&&A.finished_at?V=1:A.started_at&&(V=2),de=A.seconds/60),V){case 1:return Object(b.jsxs)(v.b,{children:[Object(b.jsx)(Le.a,{color:"success",children:"F"}),f&&Object(b.jsxs)("small",{children:[de.toFixed(2),"m"]})]});case 2:return Object(b.jsxs)(v.b,{children:[Object(b.jsx)(Le.a,{color:"blue",children:"S"}),f&&Object(b.jsxs)("small",{children:[de.toFixed(2),"m"]})]});case 0:default:return Object(b.jsx)(ot.a.Fragment,{children:Object(b.jsx)(Le.a,{color:"error",children:"N"})})}},title:Object(b.jsxs)("small",{children:[Object(b.jsx)(Le.a,{children:_e})," ",ve.title]}),dataIndex:ve.id}})))},[C,f]),Re=Object(q.useMemo)(function(){return N.map(function(ve){return C.reduce(function(Ce,_e){var Ue=ve.topics.find(function(A){return A.id===_e.id});return Object(s.a)(Object(s.a)({},Ce),{},Object(ze.a)({},Number(_e.id),Ue!=null?Ue:0))},{email:ve.email,id:ve.id})})},[N,C]);return Object(b.jsx)(D.a,{title:function(){return Object(b.jsxs)(v.b,{children:[Object(b.jsx)(ye.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(b.jsx)(Le.a,{color:"success",children:"F"}),Object(b.jsx)(ye.a,{id:"Started",defaultMessage:"Started:"})," ",Object(b.jsx)(Le.a,{color:"blue",children:"S"}),Object(b.jsx)(ye.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(b.jsx)(Le.a,{color:"error",children:"N"}),Object(b.jsx)(ye.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(b.jsx)(j.a,{checked:f,onChange:function(_e){return pe(_e)}})]})},columns:ge,dataSource:Re,size:"small",scroll:{x:1500}})},it=function(B){var C=B.stats,N=Object(q.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(f){return Object(b.jsx)(tt.a,{type:"App\\Models\\User",type_id:f})}},{title:"email",dataIndex:"email"},{title:Object(b.jsx)(ye.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),le=Object(q.useMemo)(function(){return C.map(function(P){var f=P.id,pe=P.email,ge=P.finished_at;return{id:f,email:pe,finished_at:ge}})},[C]);return Object(b.jsx)(D.a,{title:function(){return Object(b.jsx)(v.b,{children:Object(b.jsx)(ye.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:N,dataSource:le,size:"small",scroll:{x:500}})},oe=function(B){var C=B.stats,N=Object(q.useState)(null),le=Object(Ae.a)(N,2),P=le[0],f=le[1],pe=Object(q.useState)(null),ge=Object(Ae.a)(pe,2),Re=ge[0],ve=ge[1],Ce=Object(ye.l)(),_e=Object(q.useMemo)(function(){return C.flatMap(function(A){return Object.values(A.attempts).flatMap(function(V){var de=V.dates,ke=V.attempt,qe=Object.values(de).flatMap(function(Ze){var We=Ze.date,Xe=Ze.seconds_total;return{date:We,attempt:ke,seconds_total:Xe,email:A.email}});return qe})})},[C]),Ue={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(b.jsx)(jt.a,{title:Object(b.jsxs)(v.b,{children:[Object(b.jsx)(ye.a,{id:"course.interactions_time_in_days"}),Object(b.jsx)(Se.a,{showSearch:!0,value:P,onChange:function(V){f(V),ve(null)},placeholder:Object(b.jsx)(ye.a,{id:"select_person",defaultMessage:"Select a person"}),children:C.map(function(A){var V=A.id,de=A.email;return Object(b.jsx)(Se.a.Option,{value:de,children:de},V)})}),Object(b.jsx)(Se.a,{value:Re,onChange:function(V){return ve(V)},disabled:P===null,placeholder:Object(b.jsx)(ye.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Ee.a)(new Set(_e.filter(function(A){var V=A.email;return V===P}).map(function(A){var V=A.attempt;return V}))).map(function(A){return Object(b.jsxs)(Se.a.Option,{value:A,children:[Object(b.jsx)(ye.a,{id:"attempt",defaultMessage:"Attempt"})," ",A]},A)})})]}),colSpan:12,layout:"center",children:Object(b.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(b.jsx)(Ke.a,Object(s.a)(Object(s.a)({},Ue),{},{tooltip:{title:"".concat(Ce.formatMessage({id:"attempt"})),formatter:function(V){var de=Math.floor(+V.seconds_total/60),ke=+V.seconds_total>60?+V.seconds_total-de*60:0;return{name:V.attempt,value:"".concat(de,"m ").concat(ke,"s")}}},data:_e.filter(function(A){var V=A.email;return V===P}).filter(function(A){var V=A.attempt;return Number.isInteger(Re)?V===Re:!0})}))})})}},Hn4i:function(ft,he,u){"use strict";var l=u("y8nQ"),Se=u("Vl3Y"),be=u("+L6B"),D=u("2/Rp"),ie=u("rePB"),j=u("ODXe"),ze=u("Ff2n"),s=u("x+uP"),we=u("HaE+"),v=u("VTBJ"),z=u("nKUr"),Le=u.n(z),Ee=u("xvlK"),Ae=u("WuYN"),q=u("VMEa"),ot=u("LQCs"),ye=u("ft2k"),tt=u("uX+g"),jt=u("+i8S"),Ke=u("ipCM"),b=u("6cGi"),W=u("ub+h"),Fe=u("bG1m"),$e=u("q1tI"),it=u.n($e),oe=u("mWMg"),ae=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],B=["record","position","creatorButtonText","newRecordType","parentKey","style"],C=it.a.createContext(void 0);function N(f){var pe=f.children,ge=f.record,Re=f.position,ve=f.newRecordType,Ce=f.parentKey,_e=Object($e.useContext)(C);return it.a.cloneElement(pe,Object(v.a)(Object(v.a)({},pe.props),{},{onClick:function(){var Ue=Object(we.a)(Object(s.a)().mark(function V(de){var ke,qe,Ze,We;return Object(s.a)().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return Te.next=2,(ke=(qe=pe.props).onClick)===null||ke===void 0?void 0:ke.call(qe,de);case 2:if(We=Te.sent,We!==!1){Te.next=5;break}return Te.abrupt("return");case 5:_e==null||(Ze=_e.current)===null||Ze===void 0||Ze.addEditRecord(ge,{position:Re,newRecordType:ve,parentKey:Ce});case 6:case"end":return Te.stop()}},V)}));function A(V){return Ue.apply(this,arguments)}return A}()}))}function le(f){var pe,ge,Re=Object(ot.d)(),ve=f.onTableChange,Ce=f.maxLength,_e=f.formItemProps,Ue=f.recordCreatorProps,A=f.rowKey,V=f.controlled,de=f.defaultValue,ke=f.onChange,qe=f.editableFormRef,Ze=Object(ze.a)(f,ae),We=Object(ye.a)(f.value),Xe=Object($e.useRef)(),Te=Object($e.useRef)();Object($e.useImperativeHandle)(Ze.actionRef,function(){return Xe.current});var Ot=Object(b.a)(function(){return f.value||de||[]},{value:f.value,onChange:f.onChange}),w=Object(j.a)(Ot,2),je=w[0],ht=w[1],dt=it.a.useMemo(function(){return typeof A=="function"?A:function(Pe,k){return Pe[A]||k}},[A]),R=function(k){if(typeof k=="number"&&!f.name){if(k>=je.length)return k;var ee=je&&je[k];return dt==null?void 0:dt(ee,k)}if((typeof k=="string"||k>=je.length)&&f.name){var re=je.findIndex(function(ue,xe){var De;return(dt==null||(De=dt(ue,xe))===null||De===void 0?void 0:De.toString())===(k==null?void 0:k.toString())});return re}return k};Object($e.useImperativeHandle)(qe,function(){var Pe=function(re){var ue,xe;if(re==null)throw new Error("rowIndex is required");var De=R(re),at=[f.name,(ue=De==null?void 0:De.toString())!==null&&ue!==void 0?ue:""].flat(1).filter(Boolean);return(xe=Te.current)===null||xe===void 0?void 0:xe.getFieldValue(at)},k=function(){var re,ue=[f.name].flat(1).filter(Boolean);if(Array.isArray(ue)&&ue.length===0){var xe,De=(xe=Te.current)===null||xe===void 0?void 0:xe.getFieldsValue();return Array.isArray(De)?De:Object.keys(De).map(function(at){return De[at]})}return(re=Te.current)===null||re===void 0?void 0:re.getFieldValue(ue)};return Object(v.a)(Object(v.a)({},Te.current),{},{getRowData:Pe,getRowsData:k,setRowData:function(re,ue){var xe,De,at,_t;if(re==null)throw new Error("rowIndex is required");var vt=R(re),Jt=[f.name,(xe=vt==null?void 0:vt.toString())!==null&&xe!==void 0?xe:""].flat(1).filter(Boolean),bt=((De=Te.current)===null||De===void 0||(at=De.getFieldsValue)===null||at===void 0?void 0:at.call(De))||{},Mt=Object(Fe.a)(bt,Jt,Object(v.a)(Object(v.a)({},Pe(re)),ue||{}));return(_t=Te.current)===null||_t===void 0?void 0:_t.setFieldsValue(Mt)}})}),Object($e.useEffect)(function(){!f.controlled||je.forEach(function(Pe,k){var ee;(ee=Te.current)===null||ee===void 0||ee.setFieldsValue(Object(ie.a)({},dt(Pe,k),Pe))},{})},[je,f.controlled]),Object($e.useEffect)(function(){if(f.name){var Pe;Te.current=f==null||(Pe=f.editable)===null||Pe===void 0?void 0:Pe.form}},[(pe=f.editable)===null||pe===void 0?void 0:pe.form,f.name]);var I=Ue||{},H=I.record,U=I.position,L=I.creatorButtonText,X=I.newRecordType,Me=I.parentKey,ne=I.style,zt=Object(ze.a)(I,B),pt=U==="top",mt=Object($e.useMemo)(function(){return Ce&&Ce<=(je==null?void 0:je.length)?!1:Ue!==!1&&Object(z.jsx)(N,{record:Object(tt.a)(H,je==null?void 0:je.length,je)||{},position:U,parentKey:Object(tt.a)(Me,je==null?void 0:je.length,je),newRecordType:X,children:Object(z.jsx)(D.a,Object(v.a)(Object(v.a)({type:"dashed",style:Object(v.a)({display:"block",margin:"10px 0",width:"100%"},ne),icon:Object(z.jsx)(Ee.a,{})},zt),{},{children:L||Re.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ue,Ce,je==null?void 0:je.length]),e=Object($e.useMemo)(function(){return mt?pt?{components:{header:{wrapper:function(k){var ee,re=k.className,ue=k.children;return Object(z.jsxs)("thead",{className:re,children:[ue,Object(z.jsxs)("tr",{style:{position:"relative"},children:[Object(z.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:mt}),Object(z.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ee=Ze.columns)===null||ee===void 0?void 0:ee.length,children:mt})]})]})}}}}:{tableViewRender:function(k,ee){var re,ue;return Object(z.jsxs)(z.Fragment,{children:[(re=(ue=f.tableViewRender)===null||ue===void 0?void 0:ue.call(f,k,ee))!==null&&re!==void 0?re:ee,mt]})}}:{}},[pt,mt]),gt=Object(v.a)({},f.editable),Tt=Object(jt.a)(function(Pe,k){var ee,re,ue;if((ee=f.editable)===null||ee===void 0||(re=ee.onValuesChange)===null||re===void 0||re.call(ee,Pe,k),(ue=f.onValuesChange)===null||ue===void 0||ue.call(f,k,Pe),f.controlled){var xe;f==null||(xe=f.onChange)===null||xe===void 0||xe.call(f,k)}});return((f==null?void 0:f.onValuesChange)||((ge=f.editable)===null||ge===void 0?void 0:ge.onValuesChange)||f.controlled&&(f==null?void 0:f.onChange))&&(gt.onValuesChange=Tt),Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(C.Provider,{value:Xe,children:Object(z.jsx)(oe.a,Object(v.a)(Object(v.a)(Object(v.a)({search:!1,options:!1,pagination:!1,rowKey:A,revalidateOnFocus:!1},Ze),e),{},{tableLayout:"fixed",actionRef:Xe,onChange:ve,editable:Object(v.a)(Object(v.a)({},gt),{},{formProps:Object(v.a)({formRef:Te},gt.formProps)}),dataSource:je,onDataSourceChange:function(k){if(ht(k),f.name&&U==="top"){var ee,re=Object(Fe.a)({},[f.name].flat(1).filter(Boolean),k);(ee=Te.current)===null||ee===void 0||ee.setFieldsValue(re)}}}))}),f.name?Object(z.jsx)(Ae.a,{name:[f.name],children:function(k){var ee,re,ue=Object(W.a)(k,[f.name].flat(1)),xe=ue==null?void 0:ue.find(function(De,at){return!Object(Ke.a)(De,We==null?void 0:We[at])});return xe&&We&&(f==null||(ee=f.editable)===null||ee===void 0||(re=ee.onValuesChange)===null||re===void 0||re.call(ee,xe,ue)),null}}):null]})}function P(f){var pe=q.a.useFormInstance();return f.name?Object(z.jsx)(Se.a.Item,Object(v.a)(Object(v.a)({style:{maxWidth:"100%"}},f==null?void 0:f.formItemProps),{},{name:f.name,children:Object(z.jsx)(le,Object(v.a)(Object(v.a)({},f),{},{editable:Object(v.a)(Object(v.a)({},f.editable),{},{form:pe})}))})):Object(z.jsx)(le,Object(v.a)({},f))}P.RecordCreator=N,he.a=P},LDJE:function(ft,he,u){"use strict";var l=u("q1tI"),Se=u.n(l),be=u("ma/q"),D=u("ZIEt"),ie=u("QpZ9"),j=u("GzfL"),ze=u("Scwr"),s=function(v,z){var Le={};for(var Ee in v)Object.prototype.hasOwnProperty.call(v,Ee)&&z.indexOf(Ee)<0&&(Le[Ee]=v[Ee]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ae=0,Ee=Object.getOwnPropertySymbols(v);Ae<Ee.length;Ae++)z.indexOf(Ee[Ae])<0&&Object.prototype.propertyIsEnumerable.call(v,Ee[Ae])&&(Le[Ee[Ae]]=v[Ee[Ae]]);return Le},we=Object(l.forwardRef)(function(v,z){var Le=v.chartRef,Ee=v.style,Ae=Ee===void 0?{height:"inherit"}:Ee,q=v.className,ot=v.loading,ye=v.loadingTemplate,tt=v.errorTemplate,jt=s(v,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Ke=Object(D.a)(be.a,jt),b=Ke.chart,W=Ke.container;return Object(l.useEffect)(function(){Object(ie.a)(Le,b.current)},[b.current]),Object(l.useImperativeHandle)(z,function(){return{getChart:function(){return b.current}}}),Se.a.createElement(j.a,{errorTemplate:tt},ot&&Se.a.createElement(ze.a,{loadingTemplate:ye,theme:v.theme}),Se.a.createElement("div",{className:q,style:Ae,ref:W}))});he.a=we},olry:function(ft,he,u){"use strict";u.r(he);var l=u("k1fw"),Se=u("+L6B"),be=u("2/Rp"),D=u("T2oS"),ie=u("W9HT"),j=u("q1tI"),ze=u.n(j),s=u("9kvl"),we=u("55Ip"),v=u("Ty5D"),z=u("nhC9"),Le=u("tMyG"),Ee=u("my69"),Ae=u("huej"),q=u("mJ0o"),ot=u("EhlZ"),ye=u("P2fV"),tt=u("NJEC"),jt=u("5Dmo"),Ke=u("3S7+"),b=u("qLMh"),W=u("9og8"),Fe=u("sWYD"),$e=u("G3dp"),it=u("VTBJ"),oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},ae=oe,B=u("6VBw"),C=function(r,a){return j.createElement(B.a,Object(it.a)(Object(it.a)({},r),{},{ref:a,icon:ae}))};C.displayName="LineChartOutlined";var N=j.forwardRef(C),le=u("/MfK"),P=u("Qiat"),f=u("mGZj");function pe(i,r){return ge.apply(this,arguments)}function ge(){return ge=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(l.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},i)})),ge.apply(this,arguments)}function Re(i,r){return ve.apply(this,arguments)}function ve(){return ve=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),ve.apply(this,arguments)}function Ce(i,r,a){return _e.apply(this,arguments)}function _e(){return _e=Object(W.a)(Object(b.a)().mark(function i(r,a,n){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),_e.apply(this,arguments)}function Ue(i,r){return A.apply(this,arguments)}function A(){return A=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),A.apply(this,arguments)}function V(i,r){return de.apply(this,arguments)}function de(){return de=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},i)})),de.apply(this,arguments)}function ke(i,r,a,n){return qe.apply(this,arguments)}function qe(){return qe=Object(W.a)(Object(b.a)().mark(function i(r,a,n,t){return Object(b.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return d.stop()}},i)})),qe.apply(this,arguments)}function Ze(i,r,a){return We.apply(this,arguments)}function We(){return We=Object(W.a)(Object(b.a)().mark(function i(r,a,n){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(l.a)({method:"DELETE"},n||{})));case 1:case"end":return c.stop()}},i)})),We.apply(this,arguments)}var Xe=u("Vpfc"),Te=u("giR+"),Ot=u("fyUT"),w=u("tJVT"),je=u("14J3"),ht=u("BMrR"),dt=u("jCWc"),R=u("kPKH"),I=u("VMEa"),H=u("Qurx"),U=u("lR9U"),L=u("/y+f"),X=u("2qtc"),Me=u("kLXV"),ne=u("oBTY"),zt=u("OaEy"),pt=u("2fM7"),mt=u("DBJ/"),e=u("nKUr"),gt=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,c=Object(q.b)(),d=c.semester_subject_id,m=c.teacherSubjectData,h=Object(j.useState)(null),E=Object(w.a)(h,2),p=E[0],g=E[1],x=Object(j.useMemo)(function(){var _;return((_=m==null?void 0:m.groups)!==null&&_!==void 0?_:[]).map(function(S){var T=S.id,M=S.name;return{label:M,value:T}})},[]),o={type:a,group_id:p,semester_subject_id:d},O=Object(j.useCallback)(function(_){if(_.success){var S=_.data.results.filter(function(T){var M=T.user_id;return M!==null});if(!S.length)return;n({exam_results:S,group_id:_.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(pt.a,{disabled:t,value:p,onChange:function(S){return g(S)},options:x,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(mt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:O,onChange:function(S){return!S.fileList.length&&n(void 0)},maxFiles:1,data:o,disabled:!p})]})},Tt=function(r){var a=r.onDataConverted,n=Object(q.b)(),t=n.teacherSubjectData,c=n.groupUsers,d=Object(j.useState)(null),m=Object(w.a)(d,2),h=m[0],E=m[1],p=Object(j.useMemo)(function(){var x;return((x=t==null?void 0:t.groups)!==null&&x!==void 0?x:[]).map(function(o){var O=o.id,_=o.name;return{label:_,value:O}})},[]),g=Object(j.useCallback)(function(x){var o;E(x);var O=(o=c.byId)===null||o===void 0?void 0:o[x];if(!!O){var _=O.users.reduce(function(S,T){var M=T.id,y=T.email,J=T.first_name,Y=T.last_name,fe=T.academic_teacher_id;return fe!==null?S:[].concat(Object(ne.a)(S),[{email:y,first_name:J,last_name:Y,user_id:M,result:0}])},[]);a({group_id:x,exam_results:_})}},[c.byId]);return Object(e.jsx)(pt.a,{value:h,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},Pe=[L.b.TeamsLecture,L.b.TestPortal,L.b.TeamsForms],k=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,c=r.type,d=Object(q.b)(),m=d.teacherSubjectData,h=d.fetchGroupUsers,E=Object(j.useState)(),p=Object(w.a)(E,2),g=p[0],x=p[1];return Object(j.useEffect)(function(){if(c===L.b.Manual&&a){var o;m==null||(o=m.groups)===null||o===void 0||o.forEach(function(O){var _=O.id;return h(_)})}},[c,a]),Object(e.jsxs)(Me.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){g&&t(g)},okButtonProps:{disabled:!g},children:[Pe.includes(c)&&Object(e.jsx)(gt,{type:c,onDataConverted:x,groupSelectDisabled:!!g}),c===L.b.Manual&&Object(e.jsx)(Tt,{onDataConverted:x})]})},ee=function(r){var a=r.onSelect;return Object(e.jsxs)(ht.a,{gutter:[16,16],children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(be.a,{type:"primary",onClick:function(){return a(L.b.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(be.a,{type:"primary",onClick:function(){return a(L.b.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(be.a,{type:"primary",onClick:function(){return a(L.b.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(be.a,{type:"primary",onClick:function(){return a(L.b.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},re=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ue=function(r){var a,n=r.exam_id,t=I.a.useForm(),c=Object(w.a)(t,1),d=c[0],m=Object(j.useState)(),h=Object(w.a)(m,2),E=h[0],p=h[1],g=Object(j.useState)(),x=Object(w.a)(g,2),o=x[0],O=x[1],_=Object(j.useState)(!1),S=Object(w.a)(_,2),T=S[0],M=S[1],y=Object(q.b)(),J=y.semester_subject_id,Y=y.getGroupById,fe=Object(j.useMemo)(function(){var F;return((F=o==null?void 0:o.exam_results)!==null&&F!==void 0?F:[]).map(function(G){var $=G.user_id;return $})},[o==null?void 0:o.exam_results]);Object(j.useEffect)(function(){var F=Number(n);n==="new"&&(p(void 0),O(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(F)&&(M(!0),Ue(F).then(function(G){if(G.success){var $=G.data,se=$.type,Ve=$.results,Ne=$.title,me=$.weight,Ie=$.passed_at,Z=$.group_id;p(se),O({group_id:Z,exam_results:Ve}),d.setFieldsValue({title:Ne,weight:me,passed_at:Ie})}}).finally(function(){return M(!1)}))},[n]);var Ge=Object(j.useCallback)(function(){p(void 0),O(void 0)},[]);return T?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(k,{open:Boolean(E&&!o),type:E,closeModal:Ge,onSuccess:O}),Object(e.jsxs)(I.a,{form:d,submitter:E===void 0||!o?!1:void 0,onFinish:function(){var F=Object(W.a)(Object(b.a)().mark(function G($){var se,Ve,Ne,me,Ie,Z,He,Je,Be,rt;return Object(b.a)().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(Ve=o==null||(se=o.exam_results)===null||se===void 0?void 0:se.every(function(Q){var ce=Q.result;return typeof ce=="number"&&ce>=0&&ce<=100}),!(o&&Ve&&typeof J=="number")){K.next=17;break}if(Ne=$.title,me=$.passed_at,Ie=$.weight,Z=Number(n),He=o.exam_results,Je=o.group_id,Be={type:E,semester_subject_id:J,title:Ne,passed_at:me,weight:Ie,group_id:Je,results:He},!Number.isNaN(Z)){K.next=12;break}return K.next=9,Re(Be);case 9:K.t0=K.sent,K.next=15;break;case 12:return K.next=14,Ce(Z,Be);case 14:K.t0=K.sent;case 15:rt=K.t0,rt.success&&s.f.push("/teacher/subjects/".concat(J,"/exams"));case 17:return K.abrupt("return",!0);case 18:case"end":return K.stop()}},G)}));return function(G){return F.apply(this,arguments)}}(),onReset:Ge,children:[Object(e.jsxs)(I.a.Group,{children:[Object(e.jsx)(H.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(U.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(I.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ot.a,{})})]}),E&&o&&Object(e.jsx)(P.a,{rowKey:"user_id",headerTitle:(a=Y(o.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:fe,onValuesChange:function(G,$){return O({group_id:o.group_id,exam_results:$})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:o.exam_results,columns:re}),!o&&Object(e.jsx)(ee,{onSelect:p})]})]})},xe=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],De=function(r){var a=r.exam_id,n=Object(j.useState)(""),t=Object(w.a)(n,2),c=t[0],d=t[1];return Object(e.jsx)(P.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(W.a)(Object(b.a)().mark(function m(){var h;return Object(b.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Ue(a);case 2:if(h=p.sent,!h.success){p.next=6;break}return d(h.data.title),p.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},m)})),columns:xe})},at=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(Fe.a)(new Date(a.passed_at),f.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(Fe.a)(new Date(a.created_at),f.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(Xe.a,{type:"Students",type_id:a.group_id},a.group_id)}}],_t=function(){var r,a,n=Object(j.useRef)(),t=Object(q.b)(),c=t.semester_subject_id,d=Object(v.k)(),m=Object(j.useMemo)(function(){var p,g,x;return{exam_id:(p=(g=d.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(x=d.query)===null||x===void 0?void 0:x.results}},[(r=d.query)===null||r===void 0?void 0:r.exam_id,(a=d.query)===null||a===void 0?void 0:a.results]),h=m.exam_id,E=m.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(De,{exam_id:Number(E)}):h!==null?Object(e.jsx)(ue,{exam_id:h}):Object(e.jsx)(P.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var p=Object(W.a)(Object(b.a)().mark(function g(x,o){var O,_,S,T;return Object(b.a)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(O=x.current,_=x.pageSize,c!==null){y.next=3;break}return y.abrupt("return",{data:[],total:0,success:!1});case 3:return S=o&&Object.entries(o)[0],y.next=6,pe({per_page:_,page:O,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:S&&S[0],order:S&&(S[1]==="ascend"?"ASC":"DESC")});case 6:if(T=y.sent,!T.success){y.next=9;break}return y.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return y.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return y.stop()}},g)}));return function(g,x){return p.apply(this,arguments)}}(),columns:[].concat(at,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,x){return[Object(e.jsx)(we.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?exam_id=").concat(x.id),children:Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(be.a,{type:"primary",icon:Object(e.jsx)($e.a,{})})})},"edit"),Object(e.jsx)(we.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?results=").concat(x.id),children:Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(be.a,{icon:Object(e.jsx)(N,{})})})},"results"),Object(e.jsx)(tt.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(W.a)(Object(b.a)().mark(function o(){var O;return Object(b.a)().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,V(x.id);case 2:O=S.sent,O.success&&n.current&&n.current.reload();case 4:case"end":return S.stop()}},o)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(be.a,{type:"primary",icon:Object(e.jsx)(le.a,{}),danger:!0})})},"delete")]}}])})},vt=u("o0Ox"),Jt=u("miYZ"),bt=u("tsqr"),Mt=u("4KAj");function ra(i,r){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),Pt.apply(this,arguments)}var sa=function(r){var a=r.student_id,n=Object(j.useState)(!1),t=Object(w.a)(n,2),c=t[0],d=t[1],m=Object(j.useCallback)(Object(W.a)(Object(b.a)().mark(function h(){var E;return Object(b.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return d(!0),g.next=3,ra({user_id:a});case 3:if(E=g.sent,E.success){g.next=8;break}return bt.b.error(E.message),d(!1),g.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return g.stop()}},h)})),[]);return Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(be.a,{loading:c,type:"primary",icon:Object(e.jsx)(Mt.a,{}),onClick:m})})},ua=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ca=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},ia=function(r){return r.reduce(function(a,n){var t,c=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(d,m){return m.academic_teacher_id!==null?d:[].concat(Object(ne.a)(d),[{group_id:n.id,group_name:n.name,user_id:m.id,first_name:m.first_name,last_name:m.last_name,email:m.email}])},[]);return[].concat(Object(ne.a)(a),Object(ne.a)(c))},[])},da=function(){var r=Object(q.b)(),a=r.teacherSubjectData,n=Object(j.useMemo)(function(){var t;return ca((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(P.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(W.a)(Object(b.a)().mark(function c(d){var m,h,E,p,g,x,o,O,_;return Object(b.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return m=d.groups,h=d.first_name,E=h===void 0?"":h,p=d.last_name,g=p===void 0?"":p,x=d.email,o=x===void 0?"":x,T.next=3,Object(vt.a)({parent_id:a==null?void 0:a.group_id,"id[]":m});case 3:if(O=T.sent,O.success){T.next=6;break}return T.abrupt("return",{data:[],total:0,success:!1});case 6:return _=ia(O.data).filter(function(M){return M.first_name.toLowerCase().includes(E.toLowerCase())&&M.last_name.toLowerCase().includes(g.toLowerCase())&&M.email.toLowerCase().includes(o.toLowerCase())}),T.abrupt("return",{data:_,total:_.length,success:!0});case 8:case"end":return T.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ua,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,d){return[Object(e.jsx)(sa,{student_id:d.user_id},"teamsChat")]}}])})},xt=u("jrin");function Dt(i,r){return It.apply(this,arguments)}function It(){return It=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),It.apply(this,arguments)}function Yt(i,r,a,n){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(W.a)(Object(b.a)().mark(function i(r,a,n,t){return Object(b.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(l.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return d.stop()}},i)})),Rt.apply(this,arguments)}var ln=u("sRBo"),Zt=u("kaz8"),la=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.defaultChecked,c=r.onSuccess,d=Object(j.useState)(!1),m=Object(w.a)(d,2),h=m[0],E=m[1],p=Object(j.useCallback)(function(g){E(!0),Yt(a,n,g.target.checked?L.a.PRESENT:L.a.ABSENT).then(function(x){x.success&&(c==null||c())}).finally(function(){return E(!1)})},[]);return Object(e.jsx)(Zt.a,{disabled:h,defaultChecked:t,onChange:p})},Xt=la,oa=function(){var r=Object(q.b)(),a=r.teacherSubjectData,n=Object(j.useState)([]),t=Object(w.a)(n,2),c=t[0],d=t[1],m=Object(j.useState)(""),h=Object(w.a)(m,2),E=h[0],p=h[1],g=Object(s.l)(),x=Object(j.useRef)(),o=Object(j.useMemo)(function(){var _;return((_=a==null?void 0:a.groups)!==null&&_!==void 0?_:[]).map(function(S){var T=S.id,M=S.name;return{value:T,label:M}})},[a==null?void 0:a.groups]),O=Object(j.useMemo)(function(){var _;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:o,defaultValue:o==null||(_=o[0])===null||_===void 0?void 0:_.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(c))},[o,c]);return Object(e.jsx)(P.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(E,")"),request:function(){var _=Object(W.a)(Object(b.a)().mark(function S(T){var M,y,J,Y,fe,Ge,F,G,$,se,Ve;return Object(b.a)().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return y=T.group_id,J=y===void 0?o==null||(M=o[0])===null||M===void 0?void 0:M.value:y,Y=T.full_name,fe=Y===void 0?"":Y,me.next=3,Promise.all([Object(vt.b)(J),Dt(J)]);case 3:if(Ge=me.sent,F=Object(w.a)(Ge,2),G=F[0],$=F[1],se=o.find(function(Ie){var Z=Ie.value;return Z===J}),!(!G.success||!$.success||!se)){me.next=10;break}return me.abrupt("return",{data:[],total:0,success:!1});case 10:if(p(se.label),$.data.length){me.next=15;break}return bt.b.warn(Object(e.jsx)(s.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),d([]),me.abrupt("return",{data:[],total:0,success:!0});case 15:return d($.data.reduce(function(Ie,Z){return[].concat(Object(ne.a)(Ie),[{title:String(Object(Fe.a)(new Date(Z.date_from),f.c)),dataIndex:String(Z.date_from),hideInSearch:!0,width:100,align:"center",render:function(Je,Be){return Object(e.jsx)(Xt,{groupAttendanceScheduleId:Z.id,defaultChecked:Be["".concat(Z==null?void 0:Z.date_from)]===L.a.PRESENT,studentId:Be.id})}}])},[])),Ve=G.data.users.reduce(function(Ie,Z){var He=Z.id,Je=Z.academic_teacher_id,Be=Z.first_name,rt=Z.last_name,te="".concat(rt," ").concat(Be);if(Je!==null||!te.toLowerCase().includes(fe.toLowerCase()))return Ie;var K=$.data.reduce(function(Q,ce){var Oe=ce.attendances.find(function(Qe){return Qe.user_id===He});return Oe?Object(l.a)(Object(l.a)({},Q),{},Object(xt.a)({},"".concat(ce.date_from),Oe.value)):Q},{});return[].concat(Object(ne.a)(Ie),[Object(l.a)({id:He,full_name:te},K)])},[]).sort(function(Ie,Z){return Ie.full_name.localeCompare(Z.full_name)}),me.abrupt("return",{data:Ve,total:Ve.length,success:!0});case 18:case"end":return me.stop()}},S)}));return function(S){return _.apply(this,arguments)}}(),columns:O,search:{layout:"vertical"},pagination:{onChange:function(){var S;return(S=x.current)===null||S===void 0?void 0:S.reload()}},scroll:{x:1500},actionRef:x,rowKey:"id"})},on=u("tU7J"),et=u("wFql"),jn=u("/zsF"),Lt=u("PArb"),ja=u("Hn4i"),ba=u("bRQS");function At(i,r,a){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(W.a)(Object(b.a)().mark(function i(r,a,n){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),Gt.apply(this,arguments)}function ma(i,r,a,n){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(W.a)(Object(b.a)().mark(function i(r,a,n,t){return Object(b.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"POST",data:n},t||{})));case 1:case"end":return d.stop()}},i)})),Ft.apply(this,arguments)}function Qt(i,r){return $t.apply(this,arguments)}function $t(){return $t=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(l.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),$t.apply(this,arguments)}function va(i,r,a){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(W.a)(Object(b.a)().mark(function i(r,a,n){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),Ut.apply(this,arguments)}function fa(i){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(W.a)(Object(b.a)().mark(function i(r){return Object(b.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(l.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},i)})),Bt.apply(this,arguments)}function Oa(i,r){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Nt.apply(this,arguments)}function ha(i,r){return wt.apply(this,arguments)}function wt(){return wt=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(l.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},i)})),wt.apply(this,arguments)}function pa(i,r,a){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(W.a)(Object(b.a)().mark(function i(r,a,n){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(l.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return c.stop()}},i)})),Kt.apply(this,arguments)}var ga=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],_a=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(j.useState)([]),c=Object(w.a)(t,2),d=c[0],m=c[1],h=Object(j.useRef)(),E=I.a.useForm(),p=Object(w.a)(E,1),g=p[0];return Object(j.useEffect)(function(){var x,o=((x=a.scale)!==null&&x!==void 0?x:[]).map(function(O,_){return Object(l.a)(Object(l.a)({},O),{},{id:String((_+1)*100)})});g.setFieldValue("table",o)},[]),Object(e.jsx)(I.a,{form:g,onFinish:n,submitter:{render:function(o,O){var _=Object(w.a)(O,2),S=_[1];return[S]}},children:Object(e.jsx)(ja.a,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(ga,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(o,O){return Object(e.jsx)(be.a,{type:"primary",onClick:function(){var S;return(S=h.current)===null||S===void 0?void 0:S.startEditable(O.id)},icon:Object(e.jsx)($e.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:d,saveText:Object(e.jsx)(be.a,{type:"primary",icon:Object(e.jsx)(ba.a,{})}),onChange:m,actionRender:function(o,O,_){return[_.save]}}})})},xa=function(){var r,a,n=Object(s.m)("@@initialState"),t=n.initialState,c=Object(q.b)(),d=c.semester_subject_id,m=c.tutors,h=Object(j.useState)(),E=Object(w.a)(h,2),p=E[0],g=E[1],x=Object(j.useState)(!1),o=Object(w.a)(x,2),O=o[0],_=o[1],S=Object(j.useState)(null),T=Object(w.a)(S,2),M=T[0],y=T[1],J=Object(j.useMemo)(function(){return!!m.data.find(function(F){var G,$=F.id;return $===(t==null||(G=t.currentUser)===null||G===void 0?void 0:G.id)})},[m.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),Y=Object(j.useMemo)(function(){return m.data.map(function(F){var G=F.id,$=F.first_name,se=F.last_name;return{label:"".concat($," ").concat(se),value:G}})},[m.data]),fe=Object(j.useCallback)(function(){d===null||M===null||(_(!0),g(void 0),At(d,M).then(function(F){F.success&&g(F.data)}).finally(function(){_(!1)}))},[d,M]),Ge=Object(j.useCallback)(function(F,G){return function(){var $=Object(W.a)(Object(b.a)().mark(function se(Ve){var Ne,me;return Object(b.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!(d===null||M===null)){Z.next=2;break}return Z.abrupt("return");case 2:return Ne=F.reduce(function(He,Je){return Je.s_subject_scale_form_id===G?[].concat(Object(ne.a)(He),[{s_subject_scale_form_id:G,scale:Ve.table.map(function(Be){var rt=Be.name,te=Be.grade,K=Be.grade_value;return{name:rt,grade:te,grade_value:K}})}]):[].concat(Object(ne.a)(He),[Je])},[]),Z.next=5,ma(d,M,{grade_scale:Ne});case 5:me=Z.sent,me.success&&fe();case 7:case"end":return Z.stop()}},se)}));return function(se){return $.apply(this,arguments)}}()},[M,d]);return Object(j.useEffect)(function(){var F,G;if(!J||!(t!=null&&(F=t.currentUser)!==null&&F!==void 0&&F.id)){var $;if(($=m.data)!==null&&$!==void 0&&$[0]){var se;y((se=m.data)===null||se===void 0?void 0:se[0].id)}return}y(t==null||(G=t.currentUser)===null||G===void 0?void 0:G.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,J]),Object(j.useEffect)(function(){fe()},[fe]),m.loading?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(pt.a,{disabled:J,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:Y,value:M,onChange:function(G){return y(G)}})}),Object(e.jsx)(Lt.a,{}),O&&!p&&Object(e.jsx)(ie.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(F,G){var $;return Object(e.jsxs)(ze.a.Fragment,{children:[G>0&&Object(e.jsx)(Lt.a,{}),Object(e.jsx)(_a,{subjectTutorGradeScale:F,onFormSubmit:Ge(($=p.grade_scale)!==null&&$!==void 0?$:[],F.s_subject_scale_form_id)})]},F.s_subject_scale_form_id)}):Object(e.jsx)(et.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},bn=u("qbNl"),Sa=u("JBPa"),mn=u("Awhp"),Ea=u("KrTs"),ya=u("wd/R"),nt=u.n(ya);function Ca(i,r){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(W.a)(Object(b.a)().mark(function i(r,a){return Object(b.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(l.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Wt.apply(this,arguments)}var vn=u("5R/X"),Ta=function(){var r=Object(j.useState)(null),a=Object(w.a)(r,2),n=a[0],t=a[1],c=Object(j.useState)([]),d=Object(w.a)(c,2),m=d[0],h=d[1],E=Object(q.b)(),p=E.semester_subject_id,g=nt()(),x=Object(j.useMemo)(function(){return m.map(function(y){return{id:y.id,title:"".concat(y.group.name," (").concat(y.term_status.name,")"),start:nt()(y.date_from).toDate(),end:nt()(y.date_to).toDate(),tutor_name:"".concat(y.tutor.first_name," ").concat(y.tutor.last_name),tutor_email:y.tutor.email,semester:y.semester.name,group:y.group.name,subject:y.subject.name,ms_teams_join_url:y.ms_teams_join_url}})},[m]),o=Object(j.useCallback)(function(y,J){Ca({semester_subject_id:p,date_form:y.toDate(),date_to:J.toDate()}).then(function(Y){Y.success&&h(Y.data)})},[p]),O=Object(j.useCallback)(function(y){t(y)},[]),_=Object(j.useCallback)(function(){t(null)},[]),S=Object(j.useCallback)(function(y){return y.isSame(g,"day")?"warning":y.isAfter(g,"day")?"success":"error"},[]),T=Object(j.useCallback)(function(y){var J=x.filter(function(Y){return nt()(Y.start).isSame(y,"day")});return Object(e.jsx)("ul",{className:"events",children:J.map(function(Y){return Object(e.jsx)("li",{onClick:function(){return O(Y)},children:Object(e.jsx)(Ea.a,{status:S(nt()(Y.start)),text:Y.title})},Y.id)})})},[m]),M=Object(j.useCallback)(function(y,J){var Y=nt()(y).startOf(J).subtract(1,"month"),fe=nt()(y).endOf(J).add(1,"month");o(Y,fe)},[]);return Object(j.useEffect)(function(){var y=nt()().startOf("month"),J=nt()().endOf("month");o(y,J)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(et.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Sa.a,{dateCellRender:T,onPanelChange:M}),Object(e.jsxs)(Me.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:_,footer:null,children:[Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&nt()(n.start).format(f.b)]}),Object(e.jsxs)(et.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",n&&nt()(n.end).format(f.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(et.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(be.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},kt=u("yj/a"),qt=u("5Syx"),St=u("PpiC"),Vt=u("H6aw"),Ma=u("p3I6"),Pa=["results"],ea=function(r,a){return r.reduce(function(n,t){var c=t.results,d=Object(St.a)(t,Pa),m=c.find(function(h){return h.user_id===a});return m?[].concat(Object(ne.a)(n),[Object(l.a)(Object(l.a)({},d),{},{result:m})]):n},[])},ta=function(r,a){var n,t=r.reduce(function(o,O){var _=O.result,S=O.weight;return[o[0]+_.result*S,o[1]+S]},[0,0]),c=Object(w.a)(t,2),d=c[0],m=c[1],h=Number.isNaN(d/m)?0:d/m,E=a.sort(function(o,O){return o.grade_value-O.grade_value}).reduce(function(o,O){return[].concat(Object(ne.a)(o),[Object(l.a)(Object(l.a)({},O),{},{isWeightedAverageGreater:h>=O.grade_value})])},[]);if(E.every(function(o){var O=o.isWeightedAverageGreater;return O})){var p,g;return(p=(g=E.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var x=E.findIndex(function(o){var O=o.isWeightedAverageGreater;return!O});return x<0?"":(n=E[x-1])===null||n===void 0?void 0:n.name},aa=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Da=["attendances"];function Ia(i,r){var a=Object(j.useState)({loading:!1}),n=Object(w.a)(a,2),t=n[0],c=n[1];return Object(j.useEffect)(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!0})}),va(i,r).then(function(d){d.success&&c(function(m){return Object(l.a)(Object(l.a)({},m),{},{data:d.data})})}).finally(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!1})})})},[r,i]),{finalGrades:t}}function Ra(){var i=Object(j.useState)({loading:!1}),r=Object(w.a)(i,2),a=r[0],n=r[1];return Object(j.useEffect)(function(){n(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!0})}),fa().then(function(t){t.success&&n(function(c){return Object(l.a)(Object(l.a)({},c),{},{data:t.data})})}).finally(function(){n(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function La(i){var r=Object(j.useState)({loading:!1}),a=Object(w.a)(r,2),n=a[0],t=a[1];return Object(j.useEffect)(function(){i!==void 0&&(t(function(c){return Object(l.a)(Object(l.a)({},c),{},{loading:!0})}),Oa(i).then(function(c){c.success&&t(function(d){return Object(l.a)(Object(l.a)({},d),{},{data:c.data})})}).finally(function(){t(function(c){return Object(l.a)(Object(l.a)({},c),{},{loading:!1})})}))},[i]),{subjectGradeScales:n}}function Aa(i,r,a){var n=Object(j.useState)({loading:!1}),t=Object(w.a)(n,2),c=t[0],d=t[1];return Object(j.useEffect)(function(){typeof i!="number"||typeof r!="number"||typeof a!="number"||(d(function(m){return Object(l.a)(Object(l.a)({},m),{},{loading:!0})}),At(i,r).then(function(m){m.success&&d(function(h){var E,p;return Object(l.a)(Object(l.a)({},h),{},{data:(E=aa(a,(p=m.data.grade_scale)!==null&&p!==void 0?p:[]))===null||E===void 0?void 0:E.map(function(g,x){return Object(l.a)(Object(l.a)({},g),{},{id:x})})})})}).finally(function(){d(function(m){return Object(l.a)(Object(l.a)({},m),{},{loading:!1})})}))},[i,r]),{tutorGradeScales:c}}function Ga(i,r){var a=Object(j.useState)({loading:!1}),n=Object(w.a)(a,2),t=n[0],c=n[1],d=Object(j.useCallback)(function(){c(function(h){return Object(l.a)(Object(l.a)({},h),{},{loading:!0})}),Dt(i).then(function(h){if(h.success){var E=h.data.reduce(function(p,g){var x=g.attendances,o=Object(St.a)(g,Da),O=x.find(function(_){return _.user_id===r});return O?[].concat(Object(ne.a)(p),[Object(l.a)(Object(l.a)({},o),{},{attendance:O})]):p},[]);c(function(p){return Object(l.a)(Object(l.a)({},p),{},{data:E})})}}).finally(function(){c(function(h){return Object(l.a)(Object(l.a)({},h),{},{loading:!1})})})},[i,r]),m=Object(j.useCallback)(function(h,E){c(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!0})}),Yt(h,r,E).then(function(p){p.success?bt.b.success(p.message):bt.b.error(p.message)}).finally(function(){d(),c(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!1})})})},[d,r]);return Object(j.useEffect)(function(){d()},[d]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:d,updateUserAttendanceSchedules:m}}function Fa(i,r){var a=Object(j.useState)({loading:!1}),n=Object(w.a)(a,2),t=n[0],c=n[1];return Object(j.useEffect)(function(){!r||(c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!0})}),pe({student_id:i,semester_subject_id:r}).then(function(d){if(d.success){var m=ea(d.data,i);c(function(h){return Object(l.a)(Object(l.a)({},h),{},{data:m})})}}).finally(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!1})})}))},[i,r]),{studentExams:t}}function $a(i,r){var a=Object(j.useState)({loading:!1}),n=Object(w.a)(a,2),t=n[0],c=n[1],d=Object(j.useState)({loading:!1}),m=Object(w.a)(d,2),h=m[0],E=m[1],p=Object(j.useState)({loading:!1}),g=Object(w.a)(p,2),x=g[0],o=g[1];return Object(j.useEffect)(function(){c(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Object(Vt.e)({group_id:i}).then(function(O){O.success&&c(function(_){return Object(l.a)(Object(l.a)({},_),{},{data:O.data})})}).finally(function(){c(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})})},[i]),Object(j.useEffect)(function(){!t.data||(o(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var _=O.id;return Object(Vt.m)(Number(_))})).then(function(O){O.forEach(function(_){_.success&&o(function(S){return Object(l.a)(Object(l.a)({},S),{},{data:Object(l.a)(Object(l.a)({},S.data),{},Object(xt.a)({},Number(_.data.id),Object(Ma.c)(_.data.lessons)))})})})}).finally(function(){o(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})}),E(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var _=O.id;return Object(Vt.l)(Number(_),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(S){if(S.success){var T,M,y=((T=S.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&T!==void 0?T:[]).filter(function(Y){return Y.id===r}),J=(M=S.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&M!==void 0?M:[];E(function(Y){return Object(l.a)(Object(l.a)({},Y),{},{data:Object(l.a)(Object(l.a)({},Y.data),{},Object(xt.a)({},Number(_),{finishedTopics:y,attendanceList:J}))})})}})})).finally(function(){return E(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:h,userCoursesTopics:x}}var Ua=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ba=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(Fe.a)(new Date(a.date_from),f.c)}}],Na=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(Fe.a)(new Date(a.created_at),f.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],wa=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(Fe.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),f.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],Et=6,Ka=function(r){var a,n,t,c,d=r.user_id,m=r.group_id,h=Object(q.b)(),E=h.semester_subject_id,p=Fa(d,E),g=p.studentExams,x=Ia(m,d),o=x.finalGrades,O=Ra(),_=O.gradeTerms,S=La((a=o.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),T=S.subjectGradeScales,M=Aa(E,(n=o.data)===null||n===void 0?void 0:n.tutor_id,(t=o.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),y=M.tutorGradeScales,J=Ga(m,d),Y=J.userAttendanceSchedules,fe=J.updateUserAttendanceSchedules,Ge=$a(m,d),F=Ge.userCourses,G=Ge.userCoursesStats,$=Ge.userCoursesTopics,se=I.a.useForm(),Ve=Object(w.a)(se,1),Ne=Ve[0],me=Object(j.useMemo)(function(){var te;return((te=_.data)!==null&&te!==void 0?te:[]).map(function(K){var Q=K.id,ce=K.name;return{label:ce,value:Q}})},[_.data]),Ie=Object(j.useMemo)(function(){var te;return((te=T.data)!==null&&te!==void 0?te:[]).map(function(K){var Q=K.name,ce=K.id;return{label:Q,value:ce}})},[T.data]),Z=Object(j.useMemo)(function(){var te,K;return ta((te=g.data)!==null&&te!==void 0?te:[],(K=y.data)!==null&&K!==void 0?K:[])},[g.data,y.data]),He=Object(j.useCallback)(function(){var te=Object(W.a)(Object(b.a)().mark(function K(Q){var ce,Oe,Qe,st,ut,lt,ct;return Object(b.a)().wrap(function(Ye){for(;;)switch(Ye.prev=Ye.next){case 0:if(Qe=Q.grade_scale_id,st=Q.grade_term_id,((ce=o.data)===null||ce===void 0?void 0:ce.id)!==void 0){Ye.next=3;break}return Ye.abrupt("return");case 3:if(ut=(Oe=o.data)===null||Oe===void 0?void 0:Oe.grades.find(function(Ht){var Ct=Ht.grade_term;return Ct.id===st}),!ut){Ye.next=11;break}return Ye.next=7,pa(ut.id,{grade_scale_id:Qe});case 7:return lt=Ye.sent,bt.b[lt.success?"success":"error"](lt.message),lt.success&&s.f.push("/teacher/subjects/".concat(E,"/final-grades")),Ye.abrupt("return");case 11:return Ye.next=13,ha({grade_scale_id:Qe,grade_term_id:st,lesson_group_user_id:o.data.id});case 13:ct=Ye.sent,bt.b[ct.success?"success":"error"](ct.message),ct.success&&s.f.push("/teacher/subjects/".concat(E,"/final-grades"));case 16:case"end":return Ye.stop()}},K)}));return function(K){return te.apply(this,arguments)}}(),[o.data,E]),Je=Object(j.useMemo)(function(){var te;return((te=_.data)!==null&&te!==void 0?te:[]).map(function(K){var Q;return Object(l.a)(Object(l.a)({},K),{},{grade:(Q=o.data)===null||Q===void 0?void 0:Q.grades.find(function(ce){var Oe=ce.grade_term;return Oe.id===K.id})})})},[o.data,_.data]),Be=F.loading&&!F.data||G.loading&&!G.data||$.loading&&!$.data,rt=Boolean(F.data&&G.data&&$.data);return o.loading?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[o.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(et.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:o.data.user})}),Object(e.jsx)(Lt.a,{})]}),Object(e.jsxs)(ht.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(P.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Et},dataSource:g.data,loading:g.loading,columns:Na,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(P.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Et},dataSource:Je,loading:o.loading||_.loading,columns:wa,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(P.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:Y.data,loading:Y.loading,columns:[].concat(Ba,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(K,Q){return Object(e.jsx)(Zt.a,{onChange:function(Oe){return fe(Q.id,Oe.target.checked?L.a.PRESENT:L.a.ABSENT)},checked:Q.attendance.value===L.a.PRESENT})}}])})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(P.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:y.data,loading:y.loading,columns:Ua})}),Be&&Object(e.jsx)(ie.a,{}),rt&&((c=F.data)===null||c===void 0?void 0:c.map(function(te){var K,Q,ce,Oe,Qe,st,ut,lt,ct=te.id,yt=te.title;return Object(e.jsxs)(R.a,{span:24,children:[Object(e.jsx)(et.a.Text,{style:{fontSize:"16px",fontWeight:500},children:yt}),Object(e.jsx)(qt.c,{topics:(K=(Q=$.data)===null||Q===void 0?void 0:Q[Number(ct)])!==null&&K!==void 0?K:[],stats:(ce=(Oe=G.data)===null||Oe===void 0||(Qe=Oe[Number(ct)])===null||Qe===void 0?void 0:Qe.finishedTopics)!==null&&ce!==void 0?ce:[]}),Object(e.jsx)(qt.a,{stats:(st=(ut=G.data)===null||ut===void 0||(lt=ut[Number(ct)])===null||lt===void 0?void 0:lt.attendanceList)!==null&&st!==void 0?st:[]})]},ct)}))]}),Object(e.jsx)(I.a,{form:Ne,onFinish:He,children:Object(e.jsxs)(I.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(kt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:me,width:"sm",fieldProps:{loading:_.loading}}),Object(e.jsx)(kt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Ie,fieldProps:{loading:o.loading||T.loading}}),Object(e.jsx)(I.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Z}})})]})})]})},Wa=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,c=n.grade_term,d=n.id;return Object(e.jsxs)(et.a.Text,{children:[c.name,": ",t]},d)}):"-"})}}],Va=function(){var r,a,n=Object(v.k)(),t=Object(j.useMemo)(function(){var g,x,o,O;return{user_id:Number.isNaN(Number((g=n.query)===null||g===void 0?void 0:g.user_id))?null:Number((x=n.query)===null||x===void 0?void 0:x.user_id),group_id:Number.isNaN(Number((o=n.query)===null||o===void 0?void 0:o.group_id))?null:Number((O=n.query)===null||O===void 0?void 0:O.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,d=t.group_id,m=Object(q.b)(),h=m.teacherSubjectData,E=m.semester_subject_id,p=Object(j.useMemo)(function(){var g;return((g=h==null?void 0:h.groups)!==null&&g!==void 0?g:[]).map(function(x){var o=x.id,O=x.name;return{label:O,value:o}})},[h==null?void 0:h.groups]);return c!==null&&d!==null?Object(e.jsx)(Ka,{user_id:c,group_id:d}):Object(e.jsx)(P.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var g=Object(W.a)(Object(b.a)().mark(function x(o){var O,_,S,T,M,y,J,Y,fe,Ge;return Object(b.a)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return _=o.group_id,S=_===void 0?[]:_,T=o.first_name,M=T===void 0?"":T,y=o.last_name,J=y===void 0?"":y,Y=((O=h==null?void 0:h.groups)!==null&&O!==void 0?O:[]).map(function($){var se=$.id;return se}),G.next=4,Qt(S.length===0?Y:S);case 4:if(fe=G.sent,fe.success){G.next=7;break}return G.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ge=fe.data.filter(function($){var se=$.user;return se.first_name.toLowerCase().includes(M.toLowerCase())&&se.last_name.toLowerCase().includes(J.toLowerCase())}),G.abrupt("return",{success:!0,total:Ge.length,data:Ge});case 9:case"end":return G.stop()}},x)}));return function(x){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(x,o){return Object(e.jsx)(Xe.a,{type:"Students",type_id:o.group_id},o.group_id)}}].concat(Wa,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(x,o){return[Object(e.jsx)(we.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(o.user.id,"&group_id=").concat(o.group_id),children:Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(be.a,{type:"primary",icon:Object(e.jsx)($e.a,{})})})},"edit")]}}])})},Ha=u("dF/Y"),za=u("o+0V"),na=u("0WSk"),Ja=["type","defaultRender"],Ya=["type","defaultRender"],Za=function(r){var a=r.url;return Object(e.jsx)(Ke.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(be.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Ha.a,{})})})},Xa=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(Fe.a)(new Date(a.created_at),f.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,d=Object(St.a)(a,Ja);if(t==="form")return null;var m=n.getFieldValue("state");return Object(e.jsx)(na.a,Object(l.a)(Object(l.a)({},d),{},{state:{type:m}}))},render:function(r,a){return Object(e.jsx)(Xe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(Fe.a)(new Date(a.exported_at),f.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,d=Object(St.a)(a,Ya);if(t==="form")return null;var m=n.getFieldValue("state");return Object(e.jsx)(na.a,Object(l.a)(Object(l.a)({},d),{},{state:{type:m}}))},render:function(r,a){return Object(e.jsx)(Xe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(Za,{url:a.url},"download")]}}],Qa=function(){var r,a,n=Object(q.b)(),t=n.teacherSubjectData,c=Object(j.useMemo)(function(){var m;return((m=t==null?void 0:t.groups)!==null&&m!==void 0?m:[]).map(function(h){var E=h.id,p=h.name;return{value:E,label:p}})},[t==null?void 0:t.groups]),d=Object(j.useMemo)(function(){var m,h;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(m=t.groups)===null||m===void 0||(h=m[0])===null||h===void 0?void 0:h.id,allowClear:!1}}].concat(Xa)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(P.a,{className:"table-standalone",request:function(){var m=Object(W.a)(Object(b.a)().mark(function h(E){var p,g,x,o,O,_,S;return Object(b.a)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return x=E.group_id,o=x===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:x,O=E.created_by,_=E.exported_by,M.next=3,Object(za.a)({group_id:o,created_by:O,exported_by:_});case 3:if(S=M.sent,S.success){M.next=6;break}return M.abrupt("return",{success:!1,data:[],total:0});case 6:return M.abrupt("return",{success:!0,data:S.data,total:S.data.length});case 7:case"end":return M.stop()}},h)}));return function(h){return m.apply(this,arguments)}}(),columns:d,search:{layout:"vertical"},scroll:{x:1500}})},ka=u("LvDl"),qa=function(r){var a=r.exam_id,n=r.result,t=r.student_id,c=r.onSuccess,d=Object(j.useCallback)(Object(ka.debounce)(function(m){ke(a,t,{result:m!=null?m:0}).then(function(h){h.success&&(c==null||c(h.data))})},300),[a,n,t]);return Object(e.jsx)(Ot.a,{type:"number",min:0,max:100,onChange:d,defaultValue:n})},en=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{title:Object(Fe.a)(new Date(t.date_from),f.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,m){return Object(e.jsx)(Xt,{groupAttendanceScheduleId:t.id,defaultChecked:m["attendance-".concat(t==null?void 0:t.date_from)]===L.a.PRESENT,studentId:m.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},tn=function(r,a){return r.reduce(function(n,t){var c=t.attendances.find(function(d){return d.user_id===a});return c?Object(l.a)(Object(l.a)({},n),{},Object(xt.a)({},"attendance-".concat(t.date_from),c.value)):n},{})},an=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(d,m){var h;return(m==null||(h=m["exam-".concat(t.id)])===null||h===void 0?void 0:h.result)!==void 0?Object(e.jsx)(qa,{result:m==null?void 0:m["exam-".concat(t.id)].result,exam_id:t.id,student_id:m.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},nn=function(r){return r.reduce(function(a,n){var t=n.result,c=n.id;return Object(l.a)(Object(l.a)({},a),{},Object(xt.a)({},"exam-".concat(c),t))},{})},rn=function(){var r,a,n=Object(q.b)(),t=n.teacherSubjectData,c=n.semester_subject_id,d=Object(j.useState)([]),m=Object(w.a)(d,2),h=m[0],E=m[1],p=Object(j.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),g=Object(w.a)(p,2),x=g[0],o=g[1],O=Object(j.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(M){var y=M.id,J=M.name;return{value:y,label:J}})},[t==null?void 0:t.groups]),_=Object(j.useRef)(),S=Object(j.useMemo)(function(){var T;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:O,defaultValue:O==null||(T=O[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(h))},[O,h]);return Object(e.jsx)(P.a,{className:"table-standalone",request:function(){var T=Object(W.a)(Object(b.a)().mark(function M(y){var J,Y,fe,Ge,F,G,$,se,Ve,Ne,me,Ie,Z,He,Je,Be,rt,te;return Object(b.a)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Ge=y.group_id,F=Ge===void 0?(J=O[0])===null||J===void 0?void 0:J.value:Ge,G=y.full_name,$=G===void 0?"":G,Q.next=3,Qt(F);case 3:if(se=Q.sent,!(!se.success||c===null)){Q.next=6;break}return Q.abrupt("return",{data:[],total:0,success:!1});case 6:return Q.next=8,Promise.all([Object(vt.b)(F),Dt(F),pe({group_id:F,per_page:-1}),At(c,(Y=se.data)===null||Y===void 0||(fe=Y[0])===null||fe===void 0?void 0:fe.tutor_id)]);case 8:if(Ve=Q.sent,Ne=Object(w.a)(Ve,4),me=Ne[0],Ie=Ne[1],Z=Ne[2],He=Ne[3],Je=O.find(function(ce){var Oe=ce.value;return Oe===F}),!(!me.success||!Ie.success||!Z.success||!He.success||!Je)){Q.next=17;break}return Q.abrupt("return",{data:[],total:0,success:!1});case 17:return o(Je.label),Be=en(Ie.data),rt=an(Z.data),E([Be,rt,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),te=me.data.users.reduce(function(ce,Oe){var Qe,st,ut=Oe.id,lt=Oe.academic_teacher_id,ct=Oe.first_name,yt=Oe.last_name,Ye="".concat(yt," ").concat(ct);if(lt!==null||!Ye.toLowerCase().includes($.toLowerCase()))return ce;var Ht=tn(Ie.data,ut),Ct=ea(Z.data,ut),un=(Qe=aa(se.data[0].s_subject_scale_form_id,(st=He.data.grade_scale)!==null&&st!==void 0?st:[]))!==null&&Qe!==void 0?Qe:[],cn=ta(Ct,un),dn=nn(Ct);return[].concat(Object(ne.a)(ce),[Object(l.a)(Object(l.a)({id:ut,full_name:Ye,proposed_grade:cn},Ht),dn)])},[]).sort(function(ce,Oe){return ce.full_name.localeCompare(Oe.full_name)}),Q.abrupt("return",{data:te,total:te.length,success:!0});case 23:case"end":return Q.stop()}},M)}));return function(M){return T.apply(this,arguments)}}(),columns:S,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:x}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:_,pagination:{onChange:function(){var M;return(M=_.current)===null||M===void 0?void 0:M.reload()}},rowKey:"id"})},sn=function(r){var a,n,t=r.tab,c=Object(s.l)(),d=Object(s.m)("@@initialState"),m=d.setInitialState,h=d.initialState,E=Object(q.b)(),p=E.teacherSubjectData,g=E.semester_subject_id,x=E.tutors,o=Object(j.useCallback)(Object(Ae.a)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),O=Object(j.useMemo)(function(){return!!x.data.find(function(_){var S,T=_.id;return T===(h==null||(S=h.currentUser)===null||S===void 0?void 0:S.id)})||o(Ee.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(Le.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(we.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(be.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"Subjects"})},{path:String(g),breadcrumbName:String((n=p.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(z.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(S){m(Object(l.a)({},h)),s.f.push("/teacher/subjects/".concat(g,"/").concat(S))}},children:[Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(ot.a,{})},"groups"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(da,{})},"students"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(_t,{})},"exams"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ta,{})},"schedule"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(rn,{})},"class-register"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(oa,{})},"attendance"),O&&Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(xa,{})},"grades-scale"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Va,{})},"final-grades"),Object(e.jsx)(z.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(Qa,{})},"file-exports-history")]})}):Object(e.jsx)(ie.a,{})},fn=he.default=function(){var i=Object(v.l)(),r=i.subjectId,a=i.tab,n=a===void 0?"groups":a;return Object(e.jsx)(q.a,{semester_subject_id:Number(r),children:Object(e.jsx)(sn,{tab:n})})}},p3I6:function(ft,he,u){"use strict";u.d(he,"b",function(){return Ae}),u.d(he,"c",function(){return ye}),u.d(he,"a",function(){return it});var l=u("miYZ"),Se=u("tsqr"),be=u("tJVT"),D=u("k1fw"),ie=u("oBTY"),j=u("q1tI"),ze=u.n(j),s=u("9kvl"),we=u("Ty5D"),v=u("H6aw"),z=u("/y+f"),Le=u("nKUr"),Ee=u.n(Le),Ae=ze.a.createContext({}),q=function(){return Math.round(Math.random()*99999)},ot=function oe(ae){return ae.reduce(function(B,C){return[].concat(Object(ie.a)(B),Object(ie.a)(C.lessons?oe(C.lessons):[]),[C])},[])},ye=function oe(ae){return ae.reduce(function(B,C){var N;return[].concat(Object(ie.a)(B),Object(ie.a)(C.lessons?oe(C.lessons):[]),Object(ie.a)((N=C.topics)!==null&&N!==void 0?N:[]))},[])},tt=function oe(ae,B,C){return ae.map(function(N){var le,P;return Object(D.a)(Object(D.a)({},N),{},{lessons:N.lessons?oe(N.lessons,B,C):[],topics:N.id===B?[].concat(Object(ie.a)((le=N.topics)!==null&&le!==void 0?le:[]),[C]):(P=N.topics)!==null&&P!==void 0?P:[]})})},jt=function oe(ae,B,C){return C?ae.map(function(N){return Object(D.a)(Object(D.a)({},N),{},{lessons:[].concat(Object(ie.a)(N.lessons?oe(N.lessons,B,C):[]),Object(ie.a)(N.id===C?[B]:[]))})}):[].concat(Object(ie.a)(ae),[B])},Ke=function oe(ae,B,C){return ae.map(function(N){return Object(D.a)(Object(D.a)({},N.id===B?C:N),{},{lessons:N.lessons?oe(N.lessons,B,C):[]})})},b=function oe(ae,B){return ae.map(function(C){return Object(D.a)(Object(D.a)({},C),{},{parent_id:B,lessons:C.lessons?oe(C.lessons,C.id):[]})})},W=function oe(ae,B){return ae.filter(function(C){return C.id!==B}).map(function(C){return Object(D.a)(Object(D.a)({},C),{},{lessons:C.lessons?oe(C.lessons,B):[]})})},Fe=function oe(ae,B){return ae.map(function(C){return Object(D.a)(Object(D.a)({},C),{},{lessons:C.lessons?oe(C.lessons,B):[],topics:C.topics?C.topics.filter(function(N){return N.id!==B}):[]})})},$e=function oe(ae,B,C,N){return N==null?void 0:N.map(function(le){if(le.id===C){var P;return Object(D.a)(Object(D.a)({},le),{},{topics:(P=le.topics)===null||P===void 0?void 0:P.map(function(f){return f.id===ae?B.file.response.data:f})})}else if(le.lessons)return Object(D.a)(Object(D.a)({},le),{},{lessons:oe(ae,B,C,le.lessons||[])});return le})},it=function(ae){var B=ae.children,C=ae.id,N=Object(j.useState)(),le=Object(be.a)(N,2),P=le[0],f=le[1],pe=Object(s.l)(),ge=Object(j.useMemo)(function(){return P&&P.lessons?ye(P.lessons):[]},[P]),Re=Object(j.useMemo)(function(){return P&&P.lessons?ot(P.lessons):[]},[P]),ve=Object(j.useState)([]),Ce=Object(be.a)(ve,2),_e=Ce[0],Ue=Ce[1],A=Object(we.k)();Object(j.useEffect)(function(){Ue([])},[]);var V=Object(j.useCallback)(function(){Object(v.m)(C).then(function(R){return R.success&&f(Object(D.a)(Object(D.a)({},R.data),{},{lessons:b(R.data.lessons)}))})},[C]);Object(j.useEffect)(function(){V()},[V]);var de=Object(j.useCallback)(function(R){var I=Re.find(function(H){var U;return H==null||(U=H.topics)===null||U===void 0?void 0:U.find(function(L){return L.id===R})});return I?I.id:null},[Re]),ke=Object(j.useMemo)(function(){var R,I;return(R=A.query)!==null&&R!==void 0&&R.lesson?{mode:"lesson",id:Number(A.query.lesson),value:Re.find(function(H){return H.id===Number(A.query.lesson)})}:(I=A.query)!==null&&I!==void 0&&I.topic?{mode:"topic",id:Number(A.query.topic),value:ge.find(function(H){return H.id===Number(A.query.topic)})}:{mode:"init"}},[A.query,P,Re,ge]),qe=Object(j.useCallback)(function(R){var I={course_id:C,topics:[],isNew:!0,id:P?P.lessons.length+1:q(),order:0,title:pe.formatMessage({id:"add_title_here"}),active:!0,parent_id:R};return f(function(H){var U;return Object(D.a)(Object(D.a)({},H),{},{lessons:jt((U=H==null?void 0:H.lessons)!==null&&U!==void 0?U:[],I,R)})}),I},[C,P]),Ze=Object(j.useCallback)(function(R,I){var H=Re.find(function(L){return L.id===R}),U=H&&H.isNew;return(U?Object(v.g)(I):Object(v.u)(R,I)).then(function(L){return Se.b.success(L.message),V(),L.success&&f(function(X){var Me;return Object(D.a)(Object(D.a)({},X),{},{lessons:Ke((Me=X==null?void 0:X.lessons)!==null&&Me!==void 0?Me:[],R,Object(D.a)(Object(D.a)({},L.data),{},{isNew:!1}))})})})},[P]),We=Object(j.useCallback)(function(R){var I=Re.find(function(U){return U.id===R});if(!!I){var H=I.isNew;H?f(function(U){var L;return Object(D.a)(Object(D.a)({},U),{},{lessons:W((L=U==null?void 0:U.lessons)!==null&&L!==void 0?L:[],R)})}):Object(v.o)(R).then(function(U){U.success&&(Se.b.success(U.message),f(function(L){var X;return Object(D.a)(Object(D.a)({},L),{},{lessons:W((X=L==null?void 0:L.lessons)!==null&&X!==void 0?X:[],R)})}))})}},[P]),Xe=Object(j.useCallback)(function(R,I){var H,U=de(R),L=Re.find(function(ne){return ne.id===U}),X=L&&((H=L.topics)===null||H===void 0?void 0:H.find(function(ne){return ne.id===R})),Me=X==null?void 0:X.isNew;return(Me?Object(v.h)(I):Object(v.v)(R,I)).then(function(ne){ne.success&&(Se.b.success(ne.message),V(),s.f.push("/courses/list/".concat(C,"/program/?topic=").concat(ne.data.id)),(X==null?void 0:X.topicable_type)===z.f.Video&&setTimeout(function(){V()},5e3))})},[de,P,V]),Te=Object(j.useCallback)(function(R){var I=de(R),H=Re.find(function(X){return X.id===I});if(!!H){var U=ge==null?void 0:ge.find(function(X){return X.id===R}),L=U==null?void 0:U.isNew;L&&!U.topicable?f(function(X){var Me;return Object(D.a)(Object(D.a)({},X),{},{lessons:Fe((Me=X==null?void 0:X.lessons)!==null&&Me!==void 0?Me:[],R)})}):Object(v.p)(R).then(function(X){X.success&&(Se.b.success(X.message),f(function(Me){var ne;return Object(D.a)(Object(D.a)({},Me),{},{lessons:Fe((ne=Me==null?void 0:Me.lessons)!==null&&ne!==void 0?ne:[],R)})}))})}},[P,de]),Ot=Object(j.useCallback)(function(R,I){var H={lesson_id:R,isNew:!0,id:q(),title:pe.formatMessage({id:"add_title_here"}),active:!0,topicable_type:I};return f(function(U){var L;return Object(D.a)(Object(D.a)({},U),{},{lessons:tt((L=U==null?void 0:U.lessons)!==null&&L!==void 0?L:[],R,H)})}),H},[]),w=function(I,H){var U=de(I);f(function(L){return Object(D.a)(Object(D.a)({},L),{},{lessons:L?$e(I,H,U,L.lessons||[]):[]})}),s.f.push("/courses/list/".concat(C,"/program/?topic=").concat(H.file.response.data.id))},je=Object(j.useCallback)(function(R){return Object(v.d)(R).then(function(I){if(I.success){Se.b.success(I.message);var H=de(R);f(function(U){var L;return Object(D.a)(Object(D.a)({},U),{},{lessons:U?(L=U.lessons)===null||L===void 0?void 0:L.map(function(X){if(X.id===H){var Me=X.topics||[];return Object(D.a)(Object(D.a)({},X),{},{topics:[].concat(Object(ie.a)(Me),[I.data])})}return X}):[]})})}})},[P,de]),ht=Object(j.useCallback)(function(R){return Object(v.c)(R).then(function(I){I.success&&(Se.b.success(I.message),f(function(H){return Object(D.a)(Object(D.a)({},H),{},{lessons:H?[].concat(Object(ie.a)(H.lessons),[I.data]):[]})}))})},[]),dt={state:P,h5ps:_e,id:C,addNewLesson:qe,updateLesson:Ze,updateTopic:Xe,deleteLesson:We,addNewTopic:Ot,deleteTopic:Te,onTopicUploaded:w,cloneTopic:je,cloneLesson:ht,currentEditMode:ke,getLessons:V};return Object(Le.jsx)(Ae.Provider,{value:dt,children:B})}}}]);
