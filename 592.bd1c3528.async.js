(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[592],{20568:function(J,F,e){"use strict";e.d(F,{Z:function(){return L}});var w=e(19632),h=e.n(w),z=e(97857),m=e.n(z),N=e(5574),U=e.n(N),c=e(67294),y=e(17578),T=e(78957),v=e(25514),W=e(96365),t=e(14726),M=e(2487),S=e(72252),$=e(82061),b=e(55725),f=e(69753),o=e(80854),d=e(29477),n=e(85893),a=function(C){var B=C.directory,R=C.onUploaded;return(0,n.jsxs)(T.Z,{align:"start",children:[(0,n.jsxs)(v.Z.Text,{children:[(0,n.jsx)(o.FormattedMessage,{id:"pages.files.filesBrowser"}),(0,n.jsx)(v.Z.Text,{code:!0,children:B})]}),(0,n.jsx)(d.Z,{url:"/api/admin/file/upload",name:"file[]",data:{target:B},onUpload:function(K){K.success&&R(B,K.data)}})]})},E=function(C){var B=C.defaultDirectory,R=B===void 0?"/":B,x=C.onFile,K=C.hideDeleteBtn,P=K===void 0?!1:K,l=C.forceLoading,_=l===void 0?!1:l,p=(0,o.useIntl)(),O=(0,c.useState)({loading:!1,name:"",directory:R,current_page:1,data:void 0,per_page:1,last_page:1,total:0}),g=U()(O,2),s=g[0],V=g[1],I=(0,c.useRef)(),j=(0,c.useCallback)(function(i){V(function(r){return m()(m()({},r),{},{loading:i})})},[]),H=(0,c.useCallback)(function(i,r){i.success&&V(function(u){return m()(m()(m()({},u),i.data),{},{data:[{url:r.split("/").slice(0,-1).join("/"),name:"..",created_at:"",mime:"directory"}].concat(h()(i.data.data.map(function(D){return m()(m()({},D),{},{url:D.mime==="directory"?"".concat(r,"/").concat(D.name):D.url})}))).filter(function(D){return r==="/"||r===R?D.name!=="..":!0}),directory:r,loading:!1})})},[j]),A=(0,c.useCallback)(function(i){var r,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,D=function(){return I.current&&I.current.abort()};return D(),I.current=new AbortController,j(!0),(0,y.QZ)({directory:i,page:u},{signal:(r=I.current)===null||r===void 0?void 0:r.signal}).then(function(Z){Z.success&&H(Z,i)}).catch(function(){return j(!1)}),function(){D()}},[j]);(0,c.useEffect)(function(){return A(R)},[R,A]);var X=(0,c.useCallback)(function(i){j(!0),(0,y.Od)(i).then(function(){A(s.directory)}).catch(function(){j(!1)})},[A,j,s.directory]),Y=(0,c.useCallback)(function(i,r){var u,D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Z=function(){return I.current&&I.current.abort()};return Z(),I.current=new AbortController,j(!0),(0,y.ht)({directory:i,name:r,page:D},{signal:(u=I.current)===null||u===void 0?void 0:u.signal}).then(function(k){k.success&&H(k,i)}).catch(function(){return j(!1)}),function(){Z()}},[j]);return(0,n.jsxs)("div",{className:"file-browser",children:[(0,n.jsxs)("div",{className:"file-browser__header",children:[(0,n.jsx)(W.Z,{placeholder:p.formatMessage({id:"search_file"}),className:"file-browser__input",onChange:function(r){return V(function(u){return m()(m()({},u),{},{name:r.target.value})})},value:s.name}),(0,n.jsxs)("div",{children:[(0,n.jsx)(t.ZP,{className:"file-browser__button",onClick:function(){return A(s.directory)},children:(0,n.jsx)(o.FormattedMessage,{id:"reset"})}),(0,n.jsx)(t.ZP,{className:"file-browser__button",type:"primary",onClick:function(){return Y(s.directory,s.name)},children:(0,n.jsx)(o.FormattedMessage,{id:"query"})})]})]}),(0,n.jsx)(M.Z,{loading:s.loading||_,size:"small",itemLayout:"horizontal",dataSource:s.data,header:(0,n.jsx)(a,{directory:s.directory,onUploaded:function(r,u){u&&(A(r),x&&x(u,r))}}),footer:(0,n.jsx)(a,{directory:s.directory,onUploaded:function(r,u){A(r),u&&x&&x(u,r)}}),renderItem:function(r){return(0,n.jsx)(M.Z.Item,{actions:r.mime!=="directory"&&!P?[(0,n.jsx)(t.ZP,{type:"default",danger:!0,icon:(0,n.jsx)($.Z,{}),size:"small",onClick:function(){return X(r.url)}},"dir")]:[],children:(0,n.jsx)(M.Z.Item.Meta,{avatar:r.mime==="directory"?(0,n.jsx)(t.ZP,{type:"primary",icon:(0,n.jsx)(b.Z,{}),size:"small",onClick:function(){return A(r.url)}}):(0,n.jsx)("a",{href:r.url,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(t.ZP,{type:"default",icon:(0,n.jsx)(f.Z,{}),size:"small"})}),description:(0,n.jsx)(c.Fragment,{children:(0,n.jsx)(t.ZP,{type:"text",size:"small",onClick:function(){return r.mime==="directory"?A(r.url):x&&x(r,s.directory)},children:r.name})})})})}}),(0,n.jsx)(S.Z,{pageSizeOptions:[],current:s.current_page,total:s.total,pageSize:s.per_page,onChange:function(r){return A(s.directory,r)}})]})},L=E},82238:function(J,F,e){"use strict";var w=e(9783),h=e.n(w),z=e(5574),m=e.n(z),N=e(13769),U=e.n(N),c=e(15009),y=e.n(c),T=e(97857),v=e.n(T),W=e(99289),t=e.n(W),M=e(20568),S=e(29477),$=e(54734),b=e(14726),f=e(28248),o=e(2453),d=e(67294),n=e(80854),a=e(11238),E=e(85893),L=["folder","onResponse"],G=function(){var P=t()(y()().mark(function l(_,p,O){return y()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",(0,a.ZP)(_,v()({method:"POST",data:p},O||{})));case 1:case"end":return s.stop()}},l)}));return function(_,p,O){return P.apply(this,arguments)}}(),C=function(l){var _=l.split("//").join("/");return _=_[_.length-1]==="/"?_:"".concat(_,"/"),_=_[0]==="/"?_.slice(1):_,_},B=function(l){return Array.isArray(l)&&l[0]?l[0].name:l.name},R=function(l,_){var p=C(l),O=B(_);return O.includes(p)?O:"".concat(p).concat(O)},x=function(l){return{file:{status:"done",uid:"fileFromBrowser",name:"fileFromBrowser",response:l},fileList:[]}};function K(P){var l=P.folder,_=P.onResponse,p=U()(P,L),O=(0,d.useState)(!1),g=m()(O,2),s=g[0],V=g[1],I=(0,d.useState)(!1),j=m()(I,2),H=j[0],A=j[1],X=p.url,Y=p.name,i=p.onChange,r=p.data,u=(0,d.useCallback)(function(){V(!1)},[]);return(0,E.jsxs)("div",{children:[(0,E.jsxs)(b.ZP,{onClick:function(){return V(!0)},icon:(0,E.jsx)($.Z,{}),children:[" ",(0,E.jsx)(n.FormattedMessage,{id:"browse"})]}),s&&(0,E.jsx)(f.Z,{open:s,onCancel:u,onOk:u,width:"60vw",children:(0,E.jsx)(M.Z,{forceLoading:H,hideDeleteBtn:!0,defaultDirectory:l,onFile:function(Z,k){k&&(A(!0),G(X,v()(v()({},r),{},h()({},Y,R(k,Z)))).then(function(Q){A(!1),_&&_(Q),Q.success?(u(),i&&i(x(Q))):o.ZP.error(Q.message)}).catch(function(Q){A(!1),"data"in Q?o.ZP.error(Q.data.message):o.ZP.error("Unknown Error")}))}})}),(0,E.jsx)("div",{style:{marginTop:"10px"},children:(0,E.jsx)(S.Z,v()({},p))})]})}F.Z=K},29477:function(J,F,e){"use strict";var w=e(97857),h=e.n(w),z=e(5574),m=e.n(z),N=e(55523),U=e(75842),c=e(21974),y=e(67294),T=e(80854),v=e(85893);function W(t){var M=t.onChange,S=t.onUpload,$=t.url,b=t.name,f=t.extra,o=t.accept,d=t.data,n=t.wrapInForm,a=n===void 0?!0:n,E=t.title,L=t.formProps,G=t.maxFiles,C=t.clearListAfterUpload,B=t.hideLabel,R=t.disabled,x=t.showUploadList,K=(0,y.useState)(),P=m()(K,2),l=P[0],_=P[1],p=(0,T.useIntl)();return d&&d[b]&&delete d[b],(0,v.jsx)(c.Z,{condition:a,wrap:function(g){return(0,v.jsx)(U.Z,h()(h()({},L),{},{children:g}))},children:(0,v.jsx)(N.Z,{title:E||" ".concat(p.formatMessage({id:"upload_click_here"})),placeholder:p.formatMessage({id:"upload_click_here"}),label:!B&&(0,v.jsx)(T.FormattedMessage,{id:"upload"}),max:G!=null?G:2,fieldProps:{data:d,accept:o,name:b,showUploadList:x,headers:{Authorization:"Bearer ".concat(localStorage.getItem("TOKEN"))},onChange:function(g){_(g),M&&M(g),g.file.status==="done"&&(S&&S(g.file.response),C&&_(void 0))}},action:"".concat(window.REACT_APP_API_URL||"https://api-stage.escolalms.com").concat($),extra:f,fileList:l==null?void 0:l.fileList,disabled:R})})}F.Z=W},17578:function(J,F,e){"use strict";e.d(F,{Od:function(){return $},QZ:function(){return y},ht:function(){return v},pV:function(){return S},ws:function(){return t}});var w=e(15009),h=e.n(w),z=e(97857),m=e.n(z),N=e(99289),U=e.n(N),c=e(80854);function y(f,o){return T.apply(this,arguments)}function T(){return T=U()(h()().mark(function f(o,d){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,c.request)("/api/admin/file/list",m()({method:"GET",params:o},d||{})));case 1:case"end":return a.stop()}},f)})),T.apply(this,arguments)}function v(f,o){return W.apply(this,arguments)}function W(){return W=U()(h()().mark(function f(o,d){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,c.request)("/api/admin/file/find",m()({method:"GET",params:o},d||{})));case 1:case"end":return a.stop()}},f)})),W.apply(this,arguments)}function t(f,o,d){return M.apply(this,arguments)}function M(){return M=U()(h()().mark(function f(o,d,n){var a;return h()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return a=new FormData,a.append("file[]",o),a.append("target",d),L.abrupt("return",(0,c.request)("/api/admin/file/upload",m()({method:"POST",data:a},n||{})));case 4:case"end":return L.stop()}},f)})),M.apply(this,arguments)}var S=function(o){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;return"".concat(window.REACT_APP_API_URL||"https://api-stage.escolalms.com","/api/images/img?path=").concat(o,"&w=").concat(d)};function $(f,o){return b.apply(this,arguments)}function b(){return b=U()(h()().mark(function f(o,d){return h()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,c.request)("/api/admin/file/delete",m()({method:"DELETE",data:{url:o}},d||{})));case 1:case"end":return a.stop()}},f)})),b.apply(this,arguments)}},24654:function(){}}]);
