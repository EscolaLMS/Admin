(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{CUYv:function(ne,v,t){"use strict";t.r(v);var l=t("T2oS"),x=t("W9HT"),C=t("miYZ"),g=t("tsqr"),D=t("qLMh"),E=t("k1fw"),W=t("9og8"),N=t("tJVT"),m=t("q1tI"),k=t("VMEa"),J=t("Qurx"),H=t("F/zT"),Z=t("BiO0"),G=t("nhC9"),M=t("GuVI"),B=t("0WSk"),q=t("tMyG"),u=t("9kvl"),_=t("Ty5D"),Y=t("nRaC"),ee=t("5RzL"),w=t("oBTY"),Q=t("H6aw"),e=t("nKUr"),a=function U(b){return b.reduce(function(o,i){return[].concat(Object(w.a)(o),[{value:"EscolaLms\\Courses\\Lesson:".concat(i.id),title:i.title,label:i.title,children:i.lessons?U(i.lessons):[]}],Object(w.a)(i.topics?i.topics.map(function(O){return{value:"EscolaLms\\Courses\\Topic:".concat(O.id),title:"Unit: ".concat(O.title),label:O.title}}):[]))},[])},s=function(b){var o=b.value,i=b.onChange,O=Object(m.useState)([]),S=Object(N.a)(O,2),r=S[0],$=S[1];return Object(m.useEffect)(function(){Object(W.a)(Object(D.a)().mark(function P(){var f,I,A;return Object(D.a)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,Object(Q.e)({page:-1,pageSize:100});case 2:if(f=h.sent,!f.success){h.next=9;break}return h.next=6,Promise.all(f.data.filter(function(d){return d.id}).map(function(d){return Object(Q.m)(d.id)}));case 6:I=h.sent,A=I.filter(function(d){return d.success}).map(function(d){return{value:"EscolaLms\\Courses\\Course:".concat(d.success&&d.data.id),title:d.success?d.data.title:"",label:d.success?d.data.title:"",children:d.success?a(d.data.lessons):void 0}}),$(A);case 9:case"end":return h.stop()}},P)}))()},[]),Object(e.jsx)(ee.a,{loading:r.length===0,treeLine:!0,showSearch:!0,style:{width:"100%"},value:o,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"Please select",allowClear:!0,treeDefaultExpandAll:!0,onChange:function(f){return i&&i(f)},treeData:r})},j=t("Mwp2"),c=t("VXEj"),n=t("5NDa"),V=t("5rEg"),ce=t("+L6B"),te=t("2/Rp"),se=function(b){var o,i,O=b.note,S=b.onRemoved,r=b.onEdited,$=b.taskId,P=Object(m.useState)(O.note),f=Object(N.a)(P,2),I=f[0],A=f[1];return Object(e.jsx)(c.b.Item,{actions:[Object(e.jsx)(te.a,{size:"small",type:"primary",onClick:function(){return Object(M.j)(O.id,{task_id:$,note:I}).then(function(){r&&r()})},children:Object(e.jsx)(u.a,{id:"Notes.edit_note",defaultMessage:"Edit Note"})},"update"),Object(e.jsx)(te.a,{size:"small",danger:!0,onClick:function(){return Object(M.e)(O.id).then(function(){S&&S()})},children:Object(e.jsx)(u.a,{id:"Notes.delete_note",defaultMessage:"Delete Note"})},"delete")],children:Object(e.jsx)(c.b.Item.Meta,{avatar:Object(e.jsxs)(m.Fragment,{children:[Object(e.jsx)(u.a,{id:"Notes.created_by",defaultMessage:"Created by"}),Object(e.jsx)("br",{}),(o=O.user)===null||o===void 0?void 0:o.first_name," ",(i=O.user)===null||i===void 0?void 0:i.last_name]}),description:Object(e.jsx)(V.a.TextArea,{value:I,onChange:function(h){return A(h.target.value)}})})})},re=function(b){var o=b.notes,i=b.onAdded,O=b.onRemoved,S=b.onEdited,r=b.taskId,$=Object(m.useState)(""),P=Object(N.a)($,2),f=P[0],I=P[1],A=Object(m.useState)(!1),R=Object(N.a)(A,2),h=R[0],d=R[1],z=Object(m.useCallback)(function(){d(!0),Object(M.c)({task_id:r,note:f}).catch(function(X){return console.log("err",X)}).then(function(){I(""),i&&i()}).finally(function(){d(!1)})},[f,r]);return Object(e.jsx)("div",{children:Object(e.jsx)(c.b,{loading:h,itemLayout:"horizontal",dataSource:[].concat(Object(w.a)(o),[0]),renderItem:function(y){return Number.isInteger(y)?Object(e.jsx)(c.b.Item,{actions:[Object(e.jsx)(te.a,{size:"small",type:"primary",onClick:function(){z()},children:Object(e.jsx)(u.a,{id:"Notes.create_note",defaultMessage:"Create Note"})},"new")],children:Object(e.jsx)(c.b.Item.Meta,{avatar:Object(e.jsx)(m.Fragment,{children:Object(e.jsx)(u.a,{id:"Notes.new_note",defaultMessage:"New note"})}),description:Object(e.jsx)(V.a.TextArea,{value:f,onChange:function(F){return I(F.target.value)}})})}):typeof y=="object"&&Object(e.jsx)(se,{taskId:r,note:y,onRemoved:function(){return O&&O()},onEdited:function(){return S&&S()}})}})})},ue=v.default=function(){var U=Object(u.l)(),b=Object(_.l)(),o=b.task,i=o==="new",O=Object(m.useState)(),S=Object(N.a)(O,2),r=S[0],$=S[1],P=Object(m.useState)(!1),f=Object(N.a)(P,2),I=f[0],A=f[1],R=k.a.useForm(),h=Object(N.a)(R,1),d=h[0],z=Object(m.useCallback)(Object(W.a)(Object(D.a)().mark(function y(){var p;return Object(D.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return A(!0),T.next=3,Object(M.f)(Number(o));case 3:p=T.sent,p.success&&$(Object(E.a)({},p.data)),A(!1);case 6:case"end":return T.stop()}},y)})),[o]);Object(m.useEffect)(function(){if(o==="new"){$({});return}z()},[o,z]);var X=Object(m.useMemo)(function(){return{onFinish:function(){var y=Object(W.a)(Object(D.a)().mark(function F(T){var K,ae;return Object(D.a)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(ae=Object(E.a)(Object(E.a)({},T),{},{related_id:T.related?T.related.split(":")[1]:void 0,related_type:T.related?T.related.split(":")[0]:void 0}),o!=="new"){L.next=8;break}return L.next=4,Object(M.b)(ae);case 4:K=L.sent,K.success&&u.f.push("/other/tasks/".concat(K.data.id)),L.next=11;break;case 8:return L.next=10,Object(M.i)(Number(o),ae);case 10:K=L.sent;case 11:g.b.success(K.message);case 12:case"end":return L.stop()}},F)}));function p(F){return y.apply(this,arguments)}return p}(),initialValues:Object(E.a)(Object(E.a)({},r),{},{user_id:r&&r.user&&r.user.id?r.user.id:void 0,created_by_id:r&&r.created_by&&r.created_by.id?r.created_by.id:void 0,related:r!=null&&r.related_id&&r.related_type?"".concat(r.related_type,":").concat(r.related_id):void 0})}},[r,o]);return r?Object(e.jsx)(q.a,{title:i?Object(e.jsx)(u.a,{id:"new_task"}):Object(e.jsx)(u.a,{id:"edit_task"}),children:Object(e.jsx)(G.a,{children:Object(e.jsxs)(k.a,Object(E.a)(Object(E.a)({},X),{},{form:d,children:[Object(e.jsxs)(k.a.Group,{children:[Object(e.jsx)(J.a,{width:"md",name:"title",label:Object(e.jsx)(u.a,{id:"title"}),tooltip:Object(e.jsx)(u.a,{id:"title"}),placeholder:U.formatMessage({id:"title"}),required:!0}),Object(e.jsx)(k.a.Item,{name:"user_id",label:Object(e.jsx)(u.a,{id:"assignee"}),tooltip:Object(e.jsx)(u.a,{id:"assignee"}),valuePropName:"value",required:!0,children:Object(e.jsx)(B.a,{})}),!i&&Object(e.jsx)(k.a.Item,{name:"created_by_id",label:Object(e.jsx)(u.a,{id:"created_by"}),tooltip:Object(e.jsx)(u.a,{id:"created_by"}),valuePropName:"value",children:Object(e.jsx)(B.a,{disabled:!0})}),!i&&Object(e.jsx)(H.a,{name:"completed_at",label:Object(e.jsx)(u.a,{id:"completed_at",defaultMessage:"Completed"}),tooltip:Object(e.jsx)(u.a,{id:"completed_at_tooltip",defaultMessage:"Completed"}),fieldProps:{onChange:function(p){(p?Object(M.a)(Number(o)):Object(M.g)(Number(o))).then(function(F){g.b.success(F.message)})}}})]}),Object(e.jsx)(J.a,{name:"related",shouldUpdate:!0,hidden:!0}),Object(e.jsx)(k.a.Item,{label:Object(e.jsx)(u.a,{id:"relates_to",defaultMessage:"Relates to"}),tooltip:Object(e.jsx)(u.a,{id:"relates_to_tooltip",defaultMessage:"Relates to"}),shouldUpdate:!0,children:function(p){return Object(e.jsx)(s,{value:p.getFieldValue("related"),onChange:function(T){p.setFieldValue("related",T)}})}}),Object(e.jsx)(Z.a,{width:"md",name:"description",label:Object(e.jsx)(u.a,{id:"description"}),tooltip:Object(e.jsx)(u.a,{id:"description"}),placeholder:U.formatMessage({id:"description"})}),!i&&Object(e.jsx)(G.a,{title:"notes",bordered:!0,children:r.notes&&Object(e.jsx)(re,{notes:r.notes,taskId:Number(o),onAdded:function(){return z()},onEdited:function(){return z()},onRemoved:function(){return z()}})}),I&&Object(e.jsx)(x.a,{})]}))})}):Object(e.jsx)(x.a,{})}},GuVI:function(ne,v,t){"use strict";t.d(v,"h",function(){return D}),t.d(v,"d",function(){return W}),t.d(v,"f",function(){return m}),t.d(v,"b",function(){return J}),t.d(v,"i",function(){return Z}),t.d(v,"a",function(){return M}),t.d(v,"g",function(){return q}),t.d(v,"c",function(){return _}),t.d(v,"j",function(){return ee}),t.d(v,"e",function(){return Q});var l=t("qLMh"),x=t("k1fw"),C=t("9og8"),g=t("9kvl");function D(a,s){return E.apply(this,arguments)}function E(){return E=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks",Object(x.a)({method:"GET",params:Object(x.a)(Object(x.a)({},s),{},{per_page:s.pageSize,page:s.current})},j||{})));case 1:case"end":return n.stop()}},a)})),E.apply(this,arguments)}function W(a,s){return N.apply(this,arguments)}function N(){return N=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks/".concat(s),Object(x.a)({method:"DELETE"},j||{})));case 1:case"end":return n.stop()}},a)})),N.apply(this,arguments)}function m(a,s){return k.apply(this,arguments)}function k(){return k=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks/".concat(s),Object(x.a)({method:"GET"},j||{})));case 1:case"end":return n.stop()}},a)})),k.apply(this,arguments)}function J(a){return H.apply(this,arguments)}function H(){return H=Object(C.a)(Object(l.a)().mark(function a(s){return Object(l.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(g.i)("/api/admin/tasks",{method:"POST",data:s}));case 1:case"end":return c.stop()}},a)})),H.apply(this,arguments)}function Z(a,s,j){return G.apply(this,arguments)}function G(){return G=Object(C.a)(Object(l.a)().mark(function a(s,j,c){return Object(l.a)().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.abrupt("return",Object(g.i)("/api/admin/tasks/".concat(s),Object(x.a)({method:"PATCH",data:j},c||{})));case 1:case"end":return V.stop()}},a)})),G.apply(this,arguments)}function M(a,s){return B.apply(this,arguments)}function B(){return B=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks/complete/".concat(s),Object(x.a)({method:"POST"},j||{})));case 1:case"end":return n.stop()}},a)})),B.apply(this,arguments)}function q(a,s){return u.apply(this,arguments)}function u(){return u=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks/incomplete/".concat(s),Object(x.a)({method:"POST"},j||{})));case 1:case"end":return n.stop()}},a)})),u.apply(this,arguments)}function _(a){return Y.apply(this,arguments)}function Y(){return Y=Object(C.a)(Object(l.a)().mark(function a(s){return Object(l.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(g.i)("/api/admin/tasks/notes",{method:"POST",data:s}));case 1:case"end":return c.stop()}},a)})),Y.apply(this,arguments)}function ee(a,s){return w.apply(this,arguments)}function w(){return w=Object(C.a)(Object(l.a)().mark(function a(s,j){return Object(l.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(g.i)("/api/admin/tasks/notes/".concat(s),{method:"PATCH",data:j}));case 1:case"end":return n.stop()}},a)})),w.apply(this,arguments)}function Q(a){return e.apply(this,arguments)}function e(){return e=Object(C.a)(Object(l.a)().mark(function a(s){return Object(l.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(g.i)("/api/admin/tasks/notes/".concat(s),{method:"DELETE"}));case 1:case"end":return c.stop()}},a)})),e.apply(this,arguments)}}}]);
