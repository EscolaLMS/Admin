(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"/y+f":function(ht,de,s){"use strict";s.d(de,"h",function(){return l}),s.d(de,"e",function(){return I}),s.d(de,"f",function(){return ue}),s.d(de,"d",function(){return ke}),s.d(de,"a",function(){return c}),s.d(de,"c",function(){return We}),s.d(de,"b",function(){return M}),s.d(de,"g",function(){return F});var l;(function(y){y.Unselected="",y.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",y.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",y.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",y.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",y.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",y.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",y.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",y.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",y.Project="EscolaLms\\TopicTypeProject\\Models\\Project",y.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(l||(l={}));var ge;(function(y){y.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",y.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(ge||(ge={}));var oe;(function(y){y.draft="draft",y.published="published",y.archived="archived"})(oe||(oe={}));var I;(function(y){y.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",y.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",y.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(I||(I={}));var ue;(function(y){y.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(ue||(ue={}));var d;(function(y){y.cart_fixed="cart_fixed",y.cart_percent="cart_percent",y.product_fixed="product_fixed",y.product_percent="product_percent"})(d||(d={}));var ke;(function(y){y.MULTIPLE_CHOICE="multiple_choice",y.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",y.TRUE_FALSE="true_false",y.SHORT_ANSWERS="short_answers",y.MATCHING="matching",y.NUMERICAL_QUESTION="numerical_question",y.ESSAY="essay",y.DESCRIPTION="description"})(ke||(ke={}));var c;(function(y){y.PRESENT="present",y.PRESENT_NOT_EXERCISING="present_not_exercising",y.ABSENT="absent",y.EXCUSED_ABSENCE="excused_absence"})(c||(c={}));var We;(function(y){y.Manual="manual",y.TeamsForms="teams_forms",y.TeamsLecture="teams_lecture",y.TestPortal="test_portal"})(We||(We={}));var M;(function(y){y.Simple="simple",y.Complex="complex"})(M||(M={}));var F;(function(y){y.QuizSummary="EscolaLms\\Reports\\Stats\\Topic\\QuizSummaryForTopicTypeGIFT"})(F||(F={}))},"5R/X":function(ht,de,s){},"5Syx":function(ht,de,s){"use strict";s.d(de,"c",function(){return w}),s.d(de,"b",function(){return v}),s.d(de,"a",function(){return He});var l=s("OaEy"),ge=s("2fM7"),oe=s("g9YV"),I=s("wCAj"),ue=s("14J3"),d=s("BMrR"),ke=s("BoS7"),c=s("Sdc0"),We=s("jrin"),M=s("k1fw"),F=s("DYRE"),y=s("zeV3"),me=s("+BJd"),je=s("mr32"),q=s("oBTY"),Me=s("tJVT"),Ue=s("q1tI"),jt=s.n(Ue),vt=s("nhC9"),ze=s("LDJE"),x=s("9kvl"),V=s("Vpfc"),Je=s("+L6B"),Ve=s("2/Rp"),ut=s("qLMh"),xe=s("9og8"),be=s("4KAj"),ee=s("w/VK"),m=s("nKUr"),Y=function(ve){var Ge=ve.course_id,Pe=ve.stat,Re=Pe===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Pe,Se=Object(Ue.useState)(!1),ae=Object(Me.a)(Se,2),Ee=ae[0],_e=ae[1],Ze=Object(Ue.useCallback)(function(Ye){return Object(xe.a)(Object(ut.a)().mark(function ye(){var ie,le;return Object(ut.a)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return _e(!0),A.prev=1,A.next=4,Object(ee.a)(Ye,{stat:Re});case 4:ie=A.sent,ie instanceof Blob&&(le=document.createElement("a"),le.href=window.URL.createObjectURL(ie),le.download="finished_topics_".concat(Ge,".xlsx"),document.body.appendChild(le),le.click(),document.body.removeChild(le)),A.next=11;break;case 8:A.prev=8,A.t0=A.catch(1),console.error(A.t0);case 11:return A.prev=11,_e(!1),A.finish(11);case 14:case"end":return A.stop()}},ye,null,[[1,8,11,14]])}))},[Re]);return Object(m.jsxs)(Ve.a,{type:"primary",loading:Ee,onClick:Ze(Ge),children:[Object(m.jsx)(be.a,{})," ",Object(m.jsx)(x.a,{id:"export"})]})},De=function(ve){return ve.topicable.content.contents?Object.values(ve.topicable.content.contents)[0].library:"H5P"},w=function(ve){var Ge=ve.course_id,Pe=ve.topics,Re=ve.stats,Se=Object(Ue.useState)(!1),ae=Object(Me.a)(Se,2),Ee=ae[0],_e=ae[1],Ze=Object(Ue.useMemo)(function(){return[{title:Object(m.jsx)(x.a,{id:"user"}),dataIndex:"id",render:function(ie){return Object(m.jsx)(V.a,{type:"App\\Models\\User",type_id:ie})}},{title:Object(m.jsx)(x.a,{id:"email"}),dataIndex:"email"}].concat(Object(q.a)(Pe.map(function(ye){var ie,le=(ie=ye.topicable_type)===null||ie===void 0?void 0:ie.split("\\").pop();return le==="H5P"&&(le=De(ye)),{render:function(A){var G=0,Q=0;switch(A&&(A.started_at&&A.finished_at?G=1:A.started_at&&(G=2),Q=A.seconds/60),G){case 1:return Object(m.jsxs)(y.b,{children:[Object(m.jsx)(je.a,{color:"success",children:"F"}),Ee&&Object(m.jsxs)("small",{children:[Q.toFixed(2),"m"]})]});case 2:return Object(m.jsxs)(y.b,{children:[Object(m.jsx)(je.a,{color:"blue",children:"S"}),Ee&&Object(m.jsxs)("small",{children:[Q.toFixed(2),"m"]})]});case 0:default:return Object(m.jsx)(jt.a.Fragment,{children:Object(m.jsx)(je.a,{color:"error",children:"N"})})}},title:Object(m.jsxs)("small",{children:[Object(m.jsx)(je.a,{children:le})," ",ye.title]}),dataIndex:ye.id}})))},[Pe,Ee]),Ye=Object(Ue.useMemo)(function(){return Re.map(function(ye){return Pe.reduce(function(ie,le){var $=ye.topics.find(function(A){return A.id===le.id});return Object(M.a)(Object(M.a)({},ie),{},Object(We.a)({},Number(le.id),$!=null?$:0))},{email:ye.email,id:ye.id})})},[Re,Pe]);return Object(m.jsx)(I.a,{title:function(){return Object(m.jsxs)(d.a,{justify:"space-between",align:"middle",children:[Object(m.jsxs)(y.b,{children:[Object(m.jsx)(x.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(m.jsx)(je.a,{color:"success",children:"F"}),Object(m.jsx)(x.a,{id:"Started",defaultMessage:"Started:"})," ",Object(m.jsx)(je.a,{color:"blue",children:"S"}),Object(m.jsx)(x.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(m.jsx)(je.a,{color:"error",children:"N"}),Object(m.jsx)(x.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(m.jsx)(c.a,{checked:Ee,onChange:function(le){return _e(le)}})]}),Object(m.jsx)(Y,{course_id:Ge})]})},columns:Ze,dataSource:Ye,size:"small",scroll:{x:1500}})},v=function(ve){var Ge=ve.stats,Pe=Object(Ue.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(ae){return Object(m.jsx)(V.a,{type:"App\\Models\\User",type_id:ae})}},{title:"email",dataIndex:"email"},{title:Object(m.jsx)(x.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Re=Object(Ue.useMemo)(function(){return Ge.map(function(Se){var ae=Se.id,Ee=Se.email,_e=Se.finished_at;return{id:ae,email:Ee,finished_at:_e}})},[Ge]);return Object(m.jsx)(I.a,{title:function(){return Object(m.jsx)(y.b,{children:Object(m.jsx)(x.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Pe,dataSource:Re,size:"small",scroll:{x:500}})},He=function(ve){var Ge=ve.stats,Pe=Object(Ue.useState)(null),Re=Object(Me.a)(Pe,2),Se=Re[0],ae=Re[1],Ee=Object(Ue.useState)(null),_e=Object(Me.a)(Ee,2),Ze=_e[0],Ye=_e[1],ye=Object(x.l)(),ie=Object(Ue.useMemo)(function(){return Ge.flatMap(function($){return Object.values($.attempts).flatMap(function(A){var G=A.dates,Q=A.attempt,ft=Object.values(G).flatMap(function(at){var R=at.date,D=at.seconds_total;return{date:R,attempt:Q,seconds_total:D,email:$.email}});return ft})})},[Ge]),le={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(m.jsx)(vt.a,{title:Object(m.jsxs)(y.b,{children:[Object(m.jsx)(x.a,{id:"course.interactions_time_in_days"}),Object(m.jsx)(ge.a,{showSearch:!0,value:Se,onChange:function(A){ae(A),Ye(null)},placeholder:Object(m.jsx)(x.a,{id:"select_person",defaultMessage:"Select a person"}),children:Ge.map(function($){var A=$.id,G=$.email;return Object(m.jsx)(ge.a.Option,{value:G,children:G},A)})}),Object(m.jsx)(ge.a,{value:Ze,onChange:function(A){return Ye(A)},disabled:Se===null,placeholder:Object(m.jsx)(x.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(q.a)(new Set(ie.filter(function($){var A=$.email;return A===Se}).map(function($){var A=$.attempt;return A}))).map(function($){return Object(m.jsxs)(ge.a.Option,{value:$,children:[Object(m.jsx)(x.a,{id:"attempt",defaultMessage:"Attempt"})," ",$]},$)})})]}),colSpan:12,layout:"center",children:Object(m.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(m.jsx)(ze.a,Object(M.a)(Object(M.a)({},le),{},{tooltip:{title:"".concat(ye.formatMessage({id:"attempt"})),formatter:function(A){var G=Math.floor(+A.seconds_total/60),Q=+A.seconds_total>60?+A.seconds_total-G*60:0;return{name:A.attempt,value:"".concat(G,"m ").concat(Q,"s")}}},data:ie.filter(function($){var A=$.email;return A===Se}).filter(function($){var A=$.attempt;return Number.isInteger(Ze)?A===Ze:!0})}))})})}},Hn4i:function(ht,de,s){"use strict";var l=s("y8nQ"),ge=s("Vl3Y"),oe=s("+L6B"),I=s("2/Rp"),ue=s("rePB"),d=s("ODXe"),ke=s("Ff2n"),c=s("x+uP"),We=s("HaE+"),M=s("VTBJ"),F=s("nKUr"),y=s.n(F),me=s("xvlK"),je=s("WuYN"),q=s("VMEa"),Me=s("LQCs"),Ue=s("ft2k"),jt=s("uX+g"),vt=s("+i8S"),ze=s("ipCM"),x=s("6cGi"),V=s("ub+h"),Je=s("bG1m"),Ve=s("q1tI"),ut=s.n(Ve),xe=s("mWMg"),be=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],ee=["record","position","creatorButtonText","newRecordType","parentKey","style"],m=ut.a.createContext(void 0);function Y(v){var He=v.children,Ne=v.record,ve=v.position,Ge=v.newRecordType,Pe=v.parentKey,Re=Object(Ve.useContext)(m);return ut.a.cloneElement(He,Object(M.a)(Object(M.a)({},He.props),{},{onClick:function(){var Se=Object(We.a)(Object(c.a)().mark(function Ee(_e){var Ze,Ye,ye,ie;return Object(c.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return $.next=2,(Ze=(Ye=He.props).onClick)===null||Ze===void 0?void 0:Ze.call(Ye,_e);case 2:if(ie=$.sent,ie!==!1){$.next=5;break}return $.abrupt("return");case 5:Re==null||(ye=Re.current)===null||ye===void 0||ye.addEditRecord(Ne,{position:ve,newRecordType:Ge,parentKey:Pe});case 6:case"end":return $.stop()}},Ee)}));function ae(Ee){return Se.apply(this,arguments)}return ae}()}))}function De(v){var He,Ne,ve=Object(Me.d)(),Ge=v.onTableChange,Pe=v.maxLength,Re=v.formItemProps,Se=v.recordCreatorProps,ae=v.rowKey,Ee=v.controlled,_e=v.defaultValue,Ze=v.onChange,Ye=v.editableFormRef,ye=Object(ke.a)(v,be),ie=Object(Ue.a)(v.value),le=Object(Ve.useRef)(),$=Object(Ve.useRef)();Object(Ve.useImperativeHandle)(ye.actionRef,function(){return le.current});var A=Object(x.a)(function(){return v.value||_e||[]},{value:v.value,onChange:v.onChange}),G=Object(d.a)(A,2),Q=G[0],ft=G[1],at=ut.a.useMemo(function(){return typeof ae=="function"?ae:function(Fe,k){return Fe[ae]||k}},[ae]),R=function(k){if(typeof k=="number"&&!v.name){if(k>=Q.length)return k;var ne=Q&&Q[k];return at==null?void 0:at(ne,k)}if((typeof k=="string"||k>=Q.length)&&v.name){var ce=Q.findIndex(function(fe,Ie){var Ae;return(at==null||(Ae=at(fe,Ie))===null||Ae===void 0?void 0:Ae.toString())===(k==null?void 0:k.toString())});return ce}return k};Object(Ve.useImperativeHandle)(Ye,function(){var Fe=function(ce){var fe,Ie;if(ce==null)throw new Error("rowIndex is required");var Ae=R(ce),it=[v.name,(fe=Ae==null?void 0:Ae.toString())!==null&&fe!==void 0?fe:""].flat(1).filter(Boolean);return(Ie=$.current)===null||Ie===void 0?void 0:Ie.getFieldValue(it)},k=function(){var ce,fe=[v.name].flat(1).filter(Boolean);if(Array.isArray(fe)&&fe.length===0){var Ie,Ae=(Ie=$.current)===null||Ie===void 0?void 0:Ie.getFieldsValue();return Array.isArray(Ae)?Ae:Object.keys(Ae).map(function(it){return Ae[it]})}return(ce=$.current)===null||ce===void 0?void 0:ce.getFieldValue(fe)};return Object(M.a)(Object(M.a)({},$.current),{},{getRowData:Fe,getRowsData:k,setRowData:function(ce,fe){var Ie,Ae,it,_t;if(ce==null)throw new Error("rowIndex is required");var xt=R(ce),Zt=[v.name,(Ie=xt==null?void 0:xt.toString())!==null&&Ie!==void 0?Ie:""].flat(1).filter(Boolean),mt=((Ae=$.current)===null||Ae===void 0||(it=Ae.getFieldsValue)===null||it===void 0?void 0:it.call(Ae))||{},Dt=Object(Je.a)(mt,Zt,Object(M.a)(Object(M.a)({},Fe(ce)),fe||{}));return(_t=$.current)===null||_t===void 0?void 0:_t.setFieldsValue(Dt)}})}),Object(Ve.useEffect)(function(){!v.controlled||Q.forEach(function(Fe,k){var ne;(ne=$.current)===null||ne===void 0||ne.setFieldsValue(Object(ue.a)({},at(Fe,k),Fe))},{})},[Q,v.controlled]),Object(Ve.useEffect)(function(){if(v.name){var Fe;$.current=v==null||(Fe=v.editable)===null||Fe===void 0?void 0:Fe.form}},[(He=v.editable)===null||He===void 0?void 0:He.form,v.name]);var D=Se||{},H=D.record,B=D.position,L=D.creatorButtonText,X=D.newRecordType,Le=D.parentKey,se=D.style,Xt=Object(ke.a)(D,ee),pt=B==="top",gt=Object(Ve.useMemo)(function(){return Pe&&Pe<=(Q==null?void 0:Q.length)?!1:Se!==!1&&Object(F.jsx)(Y,{record:Object(jt.a)(H,Q==null?void 0:Q.length,Q)||{},position:B,parentKey:Object(jt.a)(Le,Q==null?void 0:Q.length,Q),newRecordType:X,children:Object(F.jsx)(I.a,Object(M.a)(Object(M.a)({type:"dashed",style:Object(M.a)({display:"block",margin:"10px 0",width:"100%"},se),icon:Object(F.jsx)(me.a,{})},Xt),{},{children:L||ve.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Se,Pe,Q==null?void 0:Q.length]),e=Object(Ve.useMemo)(function(){return gt?pt?{components:{header:{wrapper:function(k){var ne,ce=k.className,fe=k.children;return Object(F.jsxs)("thead",{className:ce,children:[fe,Object(F.jsxs)("tr",{style:{position:"relative"},children:[Object(F.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:gt}),Object(F.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ne=ye.columns)===null||ne===void 0?void 0:ne.length,children:gt})]})]})}}}}:{tableViewRender:function(k,ne){var ce,fe;return Object(F.jsxs)(F.Fragment,{children:[(ce=(fe=v.tableViewRender)===null||fe===void 0?void 0:fe.call(v,k,ne))!==null&&ce!==void 0?ce:ne,gt]})}}:{}},[pt,gt]),St=Object(M.a)({},v.editable),It=Object(vt.a)(function(Fe,k){var ne,ce,fe;if((ne=v.editable)===null||ne===void 0||(ce=ne.onValuesChange)===null||ce===void 0||ce.call(ne,Fe,k),(fe=v.onValuesChange)===null||fe===void 0||fe.call(v,k,Fe),v.controlled){var Ie;v==null||(Ie=v.onChange)===null||Ie===void 0||Ie.call(v,k)}});return((v==null?void 0:v.onValuesChange)||((Ne=v.editable)===null||Ne===void 0?void 0:Ne.onValuesChange)||v.controlled&&(v==null?void 0:v.onChange))&&(St.onValuesChange=It),Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(m.Provider,{value:le,children:Object(F.jsx)(xe.a,Object(M.a)(Object(M.a)(Object(M.a)({search:!1,options:!1,pagination:!1,rowKey:ae,revalidateOnFocus:!1},ye),e),{},{tableLayout:"fixed",actionRef:le,onChange:Ge,editable:Object(M.a)(Object(M.a)({},St),{},{formProps:Object(M.a)({formRef:$},St.formProps)}),dataSource:Q,onDataSourceChange:function(k){if(ft(k),v.name&&B==="top"){var ne,ce=Object(Je.a)({},[v.name].flat(1).filter(Boolean),k);(ne=$.current)===null||ne===void 0||ne.setFieldsValue(ce)}}}))}),v.name?Object(F.jsx)(je.a,{name:[v.name],children:function(k){var ne,ce,fe=Object(V.a)(k,[v.name].flat(1)),Ie=fe==null?void 0:fe.find(function(Ae,it){return!Object(ze.a)(Ae,ie==null?void 0:ie[it])});return Ie&&ie&&(v==null||(ne=v.editable)===null||ne===void 0||(ce=ne.onValuesChange)===null||ce===void 0||ce.call(ne,Ie,fe)),null}}):null]})}function w(v){var He=q.a.useFormInstance();return v.name?Object(F.jsx)(ge.a.Item,Object(M.a)(Object(M.a)({style:{maxWidth:"100%"}},v==null?void 0:v.formItemProps),{},{name:v.name,children:Object(F.jsx)(De,Object(M.a)(Object(M.a)({},v),{},{editable:Object(M.a)(Object(M.a)({},v.editable),{},{form:He})}))})):Object(F.jsx)(De,Object(M.a)({},v))}w.RecordCreator=Y,de.a=w},LDJE:function(ht,de,s){"use strict";var l=s("q1tI"),ge=s.n(l),oe=s("ma/q"),I=s("ZIEt"),ue=s("QpZ9"),d=s("GzfL"),ke=s("Scwr"),c=function(M,F){var y={};for(var me in M)Object.prototype.hasOwnProperty.call(M,me)&&F.indexOf(me)<0&&(y[me]=M[me]);if(M!=null&&typeof Object.getOwnPropertySymbols=="function")for(var je=0,me=Object.getOwnPropertySymbols(M);je<me.length;je++)F.indexOf(me[je])<0&&Object.prototype.propertyIsEnumerable.call(M,me[je])&&(y[me[je]]=M[me[je]]);return y},We=Object(l.forwardRef)(function(M,F){var y=M.chartRef,me=M.style,je=me===void 0?{height:"inherit"}:me,q=M.className,Me=M.loading,Ue=M.loadingTemplate,jt=M.errorTemplate,vt=c(M,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ze=Object(I.a)(oe.a,vt),x=ze.chart,V=ze.container;return Object(l.useEffect)(function(){Object(ue.a)(y,x.current)},[x.current]),Object(l.useImperativeHandle)(F,function(){return{getChart:function(){return x.current}}}),ge.a.createElement(d.a,{errorTemplate:jt},Me&&ge.a.createElement(ke.a,{loadingTemplate:Ue,theme:M.theme}),ge.a.createElement("div",{className:q,style:je,ref:V}))});de.a=We},olry:function(ht,de,s){"use strict";s.r(de);var l=s("k1fw"),ge=s("+L6B"),oe=s("2/Rp"),I=s("T2oS"),ue=s("W9HT"),d=s("q1tI"),ke=s.n(d),c=s("9kvl"),We=s("55Ip"),M=s("Ty5D"),F=s("nhC9"),y=s("tMyG"),me=s("my69"),je=s("huej"),q=s("mJ0o"),Me=s("EhlZ"),Ue=s("P2fV"),jt=s("NJEC"),vt=s("5Dmo"),ze=s("3S7+"),x=s("qLMh"),V=s("9og8"),Je=s("sWYD"),Ve=s("G3dp"),ut=s("VTBJ"),xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},be=xe,ee=s("6VBw"),m=function(n,a){return d.createElement(ee.a,Object(ut.a)(Object(ut.a)({},n),{},{ref:a,icon:be}))};m.displayName="LineChartOutlined";var Y=d.forwardRef(m),De=s("/MfK"),w=s("Qiat"),v=s("mGZj");function He(i,n){return Ne.apply(this,arguments)}function Ne(){return Ne=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/exams",Object(l.a)({method:"GET",useCache:!1,params:n},a||{})));case 1:case"end":return t.stop()}},i)})),Ne.apply(this,arguments)}function ve(i,n){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/exams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},i)})),Ge.apply(this,arguments)}function Pe(i,n,a){return Re.apply(this,arguments)}function Re(){return Re=Object(V.a)(Object(x.a)().mark(function i(n,a,r){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(c.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"PUT",data:a,useCache:!1},r||{})));case 1:case"end":return u.stop()}},i)})),Re.apply(this,arguments)}function Se(i,n){return ae.apply(this,arguments)}function ae(){return ae=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),ae.apply(this,arguments)}function Ee(i,n){return _e.apply(this,arguments)}function _e(){return _e=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},i)})),_e.apply(this,arguments)}function Ze(i,n,a,r){return Ye.apply(this,arguments)}function Ye(){return Ye=Object(V.a)(Object(x.a)().mark(function i(n,a,r,t){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(c.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return o.stop()}},i)})),Ye.apply(this,arguments)}function ye(i,n,a){return ie.apply(this,arguments)}function ie(){return ie=Object(V.a)(Object(x.a)().mark(function i(n,a,r){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(c.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(l.a)({method:"DELETE"},r||{})));case 1:case"end":return u.stop()}},i)})),ie.apply(this,arguments)}var le=s("Vpfc"),$=s("giR+"),A=s("fyUT"),G=s("tJVT"),Q=s("14J3"),ft=s("BMrR"),at=s("jCWc"),R=s("kPKH"),D=s("VMEa"),H=s("Qurx"),B=s("lR9U"),L=s("/y+f"),X=s("2qtc"),Le=s("kLXV"),se=s("oBTY"),Xt=s("OaEy"),pt=s("2fM7"),gt=s("DBJ/"),e=s("nKUr"),St=function(n){var a=n.type,r=n.onDataConverted,t=n.groupSelectDisabled,u=Object(q.b)(),o=u.semester_subject_id,b=u.teacherSubjectData,f=Object(d.useState)(null),E=Object(G.a)(f,2),_=E[0],p=E[1],S=Object(d.useMemo)(function(){var h;return((h=b==null?void 0:b.groups)!==null&&h!==void 0?h:[]).map(function(g){var P=g.id,T=g.name;return{label:T,value:P}})},[]),j={type:a,group_id:_,semester_subject_id:o},O=Object(d.useCallback)(function(h){if(h.success){var g=h.data.results.filter(function(P){var T=P.user_id;return T!==null});if(!g.length)return;r({exam_results:g,group_id:h.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(c.a,{id:"group"}),children:Object(e.jsx)(pt.a,{disabled:t,value:_,onChange:function(g){return p(g)},options:S,placeholder:Object(e.jsx)(c.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(gt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:O,onChange:function(g){return!g.fileList.length&&r(void 0)},maxFiles:1,data:j,disabled:!_})]})},It=function(n){var a=n.onDataConverted,r=Object(q.b)(),t=r.teacherSubjectData,u=r.groupUsers,o=Object(d.useState)(null),b=Object(G.a)(o,2),f=b[0],E=b[1],_=Object(d.useMemo)(function(){var S;return((S=t==null?void 0:t.groups)!==null&&S!==void 0?S:[]).map(function(j){var O=j.id,h=j.name;return{label:h,value:O}})},[]),p=Object(d.useCallback)(function(S){var j;E(S);var O=(j=u.byId)===null||j===void 0?void 0:j[S];if(!!O){var h=O.users.reduce(function(g,P){var T=P.id,C=P.email,J=P.first_name,z=P.last_name,Ce=P.academic_teacher_id;return Ce!==null?g:[].concat(Object(se.a)(g),[{email:C,first_name:J,last_name:z,user_id:T,result:0}])},[]);a({group_id:S,exam_results:h})}},[u.byId]);return Object(e.jsx)(pt.a,{value:f,onChange:p,options:_,placeholder:Object(e.jsx)(c.a,{id:"select_group"}),style:{width:"100%"}})},Fe=[L.c.TeamsLecture,L.c.TestPortal,L.c.TeamsForms],k=function(n){var a=n.open,r=n.closeModal,t=n.onSuccess,u=n.type,o=Object(q.b)(),b=o.teacherSubjectData,f=o.fetchGroupUsers,E=Object(d.useState)(),_=Object(G.a)(E,2),p=_[0],S=_[1];return Object(d.useEffect)(function(){if(u===L.c.Manual&&a){var j;b==null||(j=b.groups)===null||j===void 0||j.forEach(function(O){var h=O.id;return f(h)})}},[u,a]),Object(e.jsxs)(Le.a,{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.Exams.".concat(u,"Convert")}),width:"40vw",open:a,onCancel:r,onOk:function(){p&&t(p)},okButtonProps:{disabled:!p},children:[Fe.includes(u)&&Object(e.jsx)(St,{type:u,onDataConverted:S,groupSelectDisabled:!!p}),u===L.c.Manual&&Object(e.jsx)(It,{onDataConverted:S})]})},ne=function(n){var a=n.onSelect;return Object(e.jsxs)(ft.a,{gutter:[16,16],children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(oe.a,{type:"primary",onClick:function(){return a(L.c.TeamsForms)},children:Object(e.jsx)(c.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(oe.a,{type:"primary",onClick:function(){return a(L.c.TestPortal)},children:Object(e.jsx)(c.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(oe.a,{type:"primary",onClick:function(){return a(L.c.TeamsLecture)},children:Object(e.jsx)(c.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(oe.a,{type:"primary",onClick:function(){return a(L.c.Manual)},children:Object(e.jsx)(c.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ce=[{title:Object(e.jsx)(c.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(c.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(c.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(c.a,{id:"number_between",values:{min:0,max:100}})}]}}],fe=function(n){var a,r=n.exam_id,t=D.a.useForm(),u=Object(G.a)(t,1),o=u[0],b=Object(d.useState)(),f=Object(G.a)(b,2),E=f[0],_=f[1],p=Object(d.useState)(),S=Object(G.a)(p,2),j=S[0],O=S[1],h=Object(d.useState)(!1),g=Object(G.a)(h,2),P=g[0],T=g[1],C=Object(q.b)(),J=C.semester_subject_id,z=C.getGroupById,Ce=Object(d.useMemo)(function(){var K;return((K=j==null?void 0:j.exam_results)!==null&&K!==void 0?K:[]).map(function(N){var U=N.user_id;return U})},[j==null?void 0:j.exam_results]);Object(d.useEffect)(function(){var K=Number(r);r==="new"&&(_(void 0),O(void 0),o.resetFields()),r!=="new"&&!Number.isNaN(K)&&(T(!0),Se(K).then(function(N){if(N.success){var U=N.data,te=U.type,Qe=U.results,nt=U.title,Oe=U.weight,he=U.passed_at,Z=U.group_id;_(te),O({group_id:Z,exam_results:Qe}),o.setFieldsValue({title:nt,weight:Oe,passed_at:he})}}).finally(function(){return T(!1)}))},[r]);var we=Object(d.useCallback)(function(){_(void 0),O(void 0)},[]);return P?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(k,{open:Boolean(E&&!j),type:E,closeModal:we,onSuccess:O}),Object(e.jsxs)(D.a,{form:o,submitter:E===void 0||!j?!1:void 0,onFinish:function(){var K=Object(V.a)(Object(x.a)().mark(function N(U){var te,Qe,nt,Oe,he,Z,Be,tt,Ke,rt;return Object(x.a)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(Qe=j==null||(te=j.exam_results)===null||te===void 0?void 0:te.every(function(pe){var Te=pe.result;return typeof Te=="number"&&Te>=0&&Te<=100}),!(j&&Qe&&typeof J=="number")){W.next=17;break}if(nt=U.title,Oe=U.passed_at,he=U.weight,Z=Number(r),Be=j.exam_results,tt=j.group_id,Ke={type:E,semester_subject_id:J,title:nt,passed_at:Oe,weight:he,group_id:tt,results:Be},!Number.isNaN(Z)){W.next=12;break}return W.next=9,ve(Ke);case 9:W.t0=W.sent,W.next=15;break;case 12:return W.next=14,Pe(Z,Ke);case 14:W.t0=W.sent;case 15:rt=W.t0,rt.success&&c.f.push("/teacher/subjects/".concat(J,"/exams"));case 17:return W.abrupt("return",!0);case 18:case"end":return W.stop()}},N)}));return function(N){return K.apply(this,arguments)}}(),onReset:we,children:[Object(e.jsxs)(D.a.Group,{children:[Object(e.jsx)(H.a,{label:Object(e.jsx)(c.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(B.a,{label:Object(e.jsx)(c.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(D.a.Item,{name:"weight",label:Object(e.jsx)(c.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(c.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(A.a,{})})]}),E&&j&&Object(e.jsx)(w.a,{rowKey:"user_id",headerTitle:(a=z(j.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:Ce,onValuesChange:function(N,U){return O({group_id:j.group_id,exam_results:U})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:j.exam_results,columns:ce}),!j&&Object(e.jsx)(ne,{onSelect:_})]})]})},Ie=[{title:Object(e.jsx)(c.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(c.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(c.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Ae=function(n){var a=n.exam_id,r=Object(d.useState)(""),t=Object(G.a)(r,2),u=t[0],o=t[1];return Object(e.jsx)(w.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:u,request:Object(V.a)(Object(x.a)().mark(function b(){var f;return Object(x.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,Se(a);case 2:if(f=_.sent,!f.success){_.next=6;break}return o(f.data.title),_.abrupt("return",{total:f.data.results.length,success:!0,data:f.data.results});case 6:return _.abrupt("return",[]);case 7:case"end":return _.stop()}},b)})),columns:Ie})},it=[{title:Object(e.jsx)(c.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(c.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(c.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,a){return Object(e.jsx)(c.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,a){return a.passed_at&&Object(Je.a)(new Date(a.passed_at),v.c)}},{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,a){return a.weight+"%"}},{title:Object(e.jsx)(c.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,a){return a.created_at&&Object(Je.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(c.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,a){return Object(e.jsx)(c.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(c.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,a){return Object(e.jsx)(le.a,{type:"Students",type_id:a.group_id},a.group_id)}}],_t=function(){var n,a,r=Object(d.useRef)(),t=Object(q.b)(),u=t.semester_subject_id,o=Object(M.k)(),b=Object(d.useMemo)(function(){var _,p,S;return{exam_id:(_=(p=o.query)===null||p===void 0?void 0:p.exam_id)!==null&&_!==void 0?_:null,results:(S=o.query)===null||S===void 0?void 0:S.results}},[(n=o.query)===null||n===void 0?void 0:n.exam_id,(a=o.query)===null||a===void 0?void 0:a.results]),f=b.exam_id,E=b.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(Ae,{exam_id:Number(E)}):f!==null?Object(e.jsx)(fe,{exam_id:f}):Object(e.jsx)(w.a,{className:"table-standalone",headerTitle:Object(e.jsx)(c.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var _=Object(V.a)(Object(x.a)().mark(function p(S,j){var O,h,g,P;return Object(x.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(O=S.current,h=S.pageSize,u!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return g=j&&Object.entries(j)[0],C.next=6,He({per_page:h,page:O,semester_subject_id:Number.isNaN(u)?void 0:u,order_by:g&&g[0],order:g&&(g[1]==="ascend"?"ASC":"DESC")});case 6:if(P=C.sent,!P.success){C.next=9;break}return C.abrupt("return",{data:P.data,total:P.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},p)}));return function(p,S){return _.apply(this,arguments)}}(),columns:[].concat(it,[{title:Object(e.jsx)(c.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(p,S){return[Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?exam_id=").concat(S.id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(oe.a,{type:"primary",icon:Object(e.jsx)(Ve.a,{})})})},"edit"),Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?results=").concat(S.id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(oe.a,{icon:Object(e.jsx)(Y,{})})})},"results"),Object(e.jsx)(jt.a,{title:Object(e.jsx)(c.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(V.a)(Object(x.a)().mark(function j(){var O;return Object(x.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,Ee(S.id);case 2:O=g.sent,O.success&&r.current&&r.current.reload();case 4:case"end":return g.stop()}},j)})),okText:Object(e.jsx)(c.a,{id:"yes"}),cancelText:Object(e.jsx)(c.a,{id:"no"}),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(oe.a,{type:"primary",icon:Object(e.jsx)(De.a,{}),danger:!0})})},"delete")]}}])})},xt=s("o0Ox"),Zt=s("miYZ"),mt=s("tsqr"),Dt=s("4KAj");function oa(i,n){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/chats/ms-teams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},i)})),Gt.apply(this,arguments)}var ja=function(n){var a=n.student_id,r=Object(d.useState)(!1),t=Object(G.a)(r,2),u=t[0],o=t[1],b=Object(d.useCallback)(Object(V.a)(Object(x.a)().mark(function f(){var E;return Object(x.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o(!0),p.next=3,oa({user_id:a});case 3:if(E=p.sent,E.success){p.next=8;break}return mt.b.error(E.message),o(!1),p.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),o(!1);case 10:case"end":return p.stop()}},f)})),[]);return Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(oe.a,{loading:u,type:"primary",icon:Object(e.jsx)(Dt.a,{}),onClick:b})})},ba=[{title:Object(e.jsx)(c.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(c.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(c.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(c.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(c.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],va=function(n){return n.map(function(a){var r=a.id,t=a.name;return{label:t,value:r}})},fa=function(n){return n.reduce(function(a,r){var t,u=r==null||(t=r.users)===null||t===void 0?void 0:t.reduce(function(o,b){return b.academic_teacher_id!==null?o:[].concat(Object(se.a)(o),[{group_id:r.id,group_name:r.name,user_id:b.id,first_name:b.first_name,last_name:b.last_name,email:b.email}])},[]);return[].concat(Object(se.a)(a),Object(se.a)(u))},[])},ma=function(){var n=Object(q.b)(),a=n.teacherSubjectData,r=Object(d.useMemo)(function(){var t;return va((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(w.a,{className:"table-standalone",rowKey:function(u){return"".concat(u.group_id,"-").concat(u.user_id)},search:{layout:"vertical"},request:function(){var t=Object(V.a)(Object(x.a)().mark(function u(o){var b,f,E,_,p,S,j,O,h;return Object(x.a)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return b=o.groups,f=o.first_name,E=f===void 0?"":f,_=o.last_name,p=_===void 0?"":_,S=o.email,j=S===void 0?"":S,P.next=3,Object(xt.a)({parent_id:a==null?void 0:a.group_id,"id[]":b});case 3:if(O=P.sent,O.success){P.next=6;break}return P.abrupt("return",{data:[],total:0,success:!1});case 6:return h=fa(O.data).filter(function(T){return T.first_name.toLowerCase().includes(E.toLowerCase())&&T.last_name.toLowerCase().includes(p.toLowerCase())&&T.email.toLowerCase().includes(j.toLowerCase())}),P.abrupt("return",{data:h,total:h.length,success:!0});case 8:case"end":return P.stop()}},u)}));return function(u){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(c.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(ba,[{hideInSearch:!0,title:Object(e.jsx)(c.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(u,o){return[Object(e.jsx)(ja,{student_id:o.user_id},"teamsChat")]}}])})},bt=s("jrin");function Rt(i,n){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/schedules/groups/".concat(n),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Lt.apply(this,arguments)}function Oa(i,n,a,r){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(V.a)(Object(x.a)().mark(function i(n,a,r,t){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(c.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(l.a)({data:{attendances:[{user_id:a,value:r}]},method:"POST"},t||{})));case 1:case"end":return o.stop()}},i)})),Ft.apply(this,arguments)}var Tn=s("DYRE"),ha=s("zeV3"),Mn=s("sRBo"),Qt=s("kaz8");function pa(i){var n,a,r=i===null?L.a.ABSENT:i,t=(n={},Object(bt.a)(n,L.a.PRESENT,{ch1:!0,ch2:!1}),Object(bt.a)(n,L.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(bt.a)(n,L.a.ABSENT,{ch1:!1,ch2:!1}),Object(bt.a)(n,L.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),n);return(a=t[r])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function ga(i){var n,a=i.ch1,r=i.ch2,t="".concat(a,"_").concat(r),u={true_false:L.a.PRESENT,true_true:L.a.PRESENT_NOT_EXERCISING,false_false:L.a.ABSENT,false_true:L.a.EXCUSED_ABSENCE};return(n=u[t])!==null&&n!==void 0?n:L.a.ABSENT}var xa=function(n){var a=n.groupAttendanceScheduleId,r=n.studentId,t=n.attendance,u=n.onSuccess,o=Object(d.useState)(pa(t)),b=Object(G.a)(o,2),f=b[0],E=b[1],_=Object(d.useState)(!1),p=Object(G.a)(_,2),S=p[0],j=p[1],O=Object(d.useRef)(!0),h=Object(d.useCallback)(function(T){j(!0),Oa(a,r,ga(T)).then(function(C){C.success&&(u==null||u())}).finally(function(){return j(!1)})},[]),g=Object(d.useCallback)(function(T){return E(T.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),P=Object(d.useCallback)(function(T){return E(function(C){return Object(l.a)(Object(l.a)({},C),{},{ch2:T.target.checked})})},[]);return Object(d.useEffect)(function(){if(O.current){O.current=!1;return}h(f)},[f,h]),Object(e.jsxs)(ha.b,{children:[Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"present"}),children:Object(e.jsx)(Qt.a,{disabled:S,checked:f.ch1,onChange:g})}),Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:f.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Qt.a,{disabled:S,checked:f.ch2,onChange:P})})]})},At=xa,Sa=function(){var n=Object(q.b)(),a=n.teacherSubjectData,r=Object(d.useState)([]),t=Object(G.a)(r,2),u=t[0],o=t[1],b=Object(d.useState)(""),f=Object(G.a)(b,2),E=f[0],_=f[1],p=Object(c.l)(),S=Object(d.useRef)(),j=Object(d.useMemo)(function(){var h;return((h=a==null?void 0:a.groups)!==null&&h!==void 0?h:[]).map(function(g){var P=g.id,T=g.name;return{value:P,label:T}})},[a==null?void 0:a.groups]),O=Object(d.useMemo)(function(){var h;return[{title:Object(e.jsx)(c.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:j,defaultValue:j==null||(h=j[0])===null||h===void 0?void 0:h.value,allowClear:!1}},{title:Object(e.jsx)(c.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(se.a)(u))},[j,u]);return Object(e.jsx)(w.a,{className:"table-standalone",headerTitle:"".concat(p.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(E,")"),request:function(){var h=Object(V.a)(Object(x.a)().mark(function g(P){var T,C,J,z,Ce,we,K,N,U,te,Qe;return Object(x.a)().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return C=P.group_id,J=C===void 0?j==null||(T=j[0])===null||T===void 0?void 0:T.value:C,z=P.full_name,Ce=z===void 0?"":z,Oe.next=3,Promise.all([Object(xt.b)(J),Rt(J)]);case 3:if(we=Oe.sent,K=Object(G.a)(we,2),N=K[0],U=K[1],te=j.find(function(he){var Z=he.value;return Z===J}),!(!N.success||!U.success||!te)){Oe.next=10;break}return Oe.abrupt("return",{data:[],total:0,success:!1});case 10:if(U.data.length){Oe.next=13;break}return mt.b.error(p.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),Oe.abrupt("return",{data:[],total:0,success:!1});case 13:return _(te.label),o(U.data.reduce(function(he,Z){return[].concat(Object(se.a)(he),[{title:String(Object(Je.a)(new Date(Z.date_from),v.c)),dataIndex:String(Z.date_from),hideInSearch:!0,width:100,align:"center",render:function(tt,Ke){return Object(e.jsx)(At,{groupAttendanceScheduleId:Z.id,attendance:Ke["".concat(Z==null?void 0:Z.date_from)],studentId:Ke.id})}}])},[])),Qe=N.data.users.reduce(function(he,Z){var Be=Z.id,tt=Z.academic_teacher_id,Ke=Z.first_name,rt=Z.last_name,re="".concat(rt," ").concat(Ke);if(tt!==null||!re.toLowerCase().includes(Ce.toLowerCase()))return he;var W=U.data.reduce(function(pe,Te){var qe=Te.attendances.find(function(ct){return ct.user_id===Be});return qe?Object(l.a)(Object(l.a)({},pe),{},Object(bt.a)({},"".concat(Te.date_from),qe.value)):pe},{});return[].concat(Object(se.a)(he),[Object(l.a)({id:Be,full_name:re},W)])},[]).sort(function(he,Z){return he.full_name.localeCompare(Z.full_name)}),Oe.abrupt("return",{data:Qe,total:Qe.length,success:!0});case 17:case"end":return Oe.stop()}},g)}));return function(g){return h.apply(this,arguments)}}(),columns:O,search:{layout:"vertical"},pagination:{onChange:function(){var g;return(g=S.current)===null||g===void 0?void 0:g.reload()}},scroll:{x:1500},actionRef:S,rowKey:"id"})},Pn=s("tU7J"),st=s("wFql"),In=s("/zsF"),$t=s("PArb"),_a=s("Hn4i"),ya=s("bRQS");function Nt(i,n,a){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(V.a)(Object(x.a)().mark(function i(n,a,r){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(c.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return u.stop()}},i)})),Ut.apply(this,arguments)}function Ea(i,n,a,r){return wt.apply(this,arguments)}function wt(){return wt=Object(V.a)(Object(x.a)().mark(function i(n,a,r,t){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(c.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"POST",data:r},t||{})));case 1:case"end":return o.stop()}},i)})),wt.apply(this,arguments)}function kt(i,n){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/lesson-group-users",Object(l.a)({method:"GET",params:{"groups[]":n},useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Bt.apply(this,arguments)}function Ca(i,n,a){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(V.a)(Object(x.a)().mark(function i(n,a,r){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(c.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(a),Object(l.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return u.stop()}},i)})),Kt.apply(this,arguments)}function qt(i){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(V.a)(Object(x.a)().mark(function i(n){return Object(x.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(c.i)("/api/admin/grade-terms",Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},i)})),Wt.apply(this,arguments)}function ea(i,n){return Vt.apply(this,arguments)}function Vt(){return Vt=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/grade-scales/".concat(n),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Vt.apply(this,arguments)}function ta(i,n){return Ht.apply(this,arguments)}function Ht(){return Ht=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/final-grades",Object(l.a)({method:"POST",data:n},a||{})));case 1:case"end":return t.stop()}},i)})),Ht.apply(this,arguments)}function aa(i,n,a){return zt.apply(this,arguments)}function zt(){return zt=Object(V.a)(Object(x.a)().mark(function i(n,a,r){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(c.i)("/api/admin/final-grades/".concat(n),Object(l.a)({method:"PATCH",data:a},r||{})));case 1:case"end":return u.stop()}},i)})),zt.apply(this,arguments)}var Ta=[{title:Object(e.jsx)(c.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(c.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(c.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(c.a,{id:"number_between",values:{min:0,max:100}})}]}}],Ma=function(n){var a=n.subjectTutorGradeScale,r=n.onFormSubmit,t=Object(d.useState)([]),u=Object(G.a)(t,2),o=u[0],b=u[1],f=Object(d.useRef)(),E=D.a.useForm(),_=Object(G.a)(E,1),p=_[0];return Object(d.useEffect)(function(){var S,j=((S=a.scale)!==null&&S!==void 0?S:[]).map(function(O,h){return Object(l.a)(Object(l.a)({},O),{},{id:String((h+1)*100)})});p.setFieldValue("table",j)},[]),Object(e.jsx)(D.a,{form:p,onFinish:r,submitter:{render:function(j,O){var h=Object(G.a)(O,2),g=h[1];return[g]}},children:Object(e.jsx)(_a.a,{name:"table",rowKey:"id",actionRef:f,formItemProps:{label:Object(e.jsx)(c.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Ta,[{title:Object(e.jsx)(c.a,{id:"options"}),valueType:"option",render:function(j,O){return Object(e.jsx)(oe.a,{type:"primary",onClick:function(){var g;return(g=f.current)===null||g===void 0?void 0:g.startEditable(O.id)},icon:Object(e.jsx)(Ve.a,{})})}}]),editable:{form:p,type:"multiple",editableKeys:o,saveText:Object(e.jsx)(oe.a,{type:"primary",icon:Object(e.jsx)(ya.a,{})}),onChange:b,actionRender:function(j,O,h){return[h.save]}}})})},Pa=function(){var n,a,r=Object(c.m)("@@initialState"),t=r.initialState,u=Object(q.b)(),o=u.semester_subject_id,b=u.tutors,f=Object(d.useState)(),E=Object(G.a)(f,2),_=E[0],p=E[1],S=Object(d.useState)(!1),j=Object(G.a)(S,2),O=j[0],h=j[1],g=Object(d.useState)(null),P=Object(G.a)(g,2),T=P[0],C=P[1],J=Object(d.useMemo)(function(){return!!b.data.find(function(K){var N,U=K.id;return U===(t==null||(N=t.currentUser)===null||N===void 0?void 0:N.id)})},[b.data,t==null||(n=t.currentUser)===null||n===void 0?void 0:n.id]),z=Object(d.useMemo)(function(){return b.data.map(function(K){var N=K.id,U=K.first_name,te=K.last_name;return{label:"".concat(U," ").concat(te),value:N}})},[b.data]),Ce=Object(d.useCallback)(function(){o===null||T===null||(h(!0),p(void 0),Nt(o,T).then(function(K){K.success&&p(K.data)}).finally(function(){h(!1)}))},[o,T]),we=Object(d.useCallback)(function(K,N){return function(){var U=Object(V.a)(Object(x.a)().mark(function te(Qe){var nt,Oe;return Object(x.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!(o===null||T===null)){Z.next=2;break}return Z.abrupt("return");case 2:return nt=K.reduce(function(Be,tt){return tt.s_subject_scale_form_id===N?[].concat(Object(se.a)(Be),[{s_subject_scale_form_id:N,scale:Qe.table.map(function(Ke){var rt=Ke.name,re=Ke.grade,W=Ke.grade_value;return{name:rt,grade:re,grade_value:W}})}]):[].concat(Object(se.a)(Be),[tt])},[]),Z.next=5,Ea(o,T,{grade_scale:nt});case 5:Oe=Z.sent,Oe.success&&Ce();case 7:case"end":return Z.stop()}},te)}));return function(te){return U.apply(this,arguments)}}()},[T,o]);return Object(d.useEffect)(function(){var K,N;if(!J||!(t!=null&&(K=t.currentUser)!==null&&K!==void 0&&K.id)){var U;if((U=b.data)!==null&&U!==void 0&&U[0]){var te;C((te=b.data)===null||te===void 0?void 0:te[0].id)}return}C(t==null||(N=t.currentUser)===null||N===void 0?void 0:N.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,J]),Object(d.useEffect)(function(){Ce()},[Ce]),b.loading?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(c.a,{id:"menu.Teacher"}),children:Object(e.jsx)(pt.a,{disabled:J,placeholder:Object(e.jsx)(c.a,{id:"select"}),options:z,value:T,onChange:function(N){return C(N)}})}),Object(e.jsx)($t.a,{}),O&&!_&&Object(e.jsx)(ue.a,{}),_!=null&&_.grade_scale?_.grade_scale.map(function(K,N){var U;return Object(e.jsxs)(ke.a.Fragment,{children:[N>0&&Object(e.jsx)($t.a,{}),Object(e.jsx)(Ma,{subjectTutorGradeScale:K,onFormSubmit:we((U=_.grade_scale)!==null&&U!==void 0?U:[],K.s_subject_scale_form_id)})]},K.s_subject_scale_form_id)}):Object(e.jsx)(st.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(c.a,{id:"gradesScalesMissing"})})]})},Dn=s("qbNl"),Ia=s("JBPa"),Gn=s("Awhp"),Da=s("KrTs"),Ga=s("wd/R"),lt=s.n(Ga);function Ra(i,n){return Jt.apply(this,arguments)}function Jt(){return Jt=Object(V.a)(Object(x.a)().mark(function i(n,a){return Object(x.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(c.i)("/api/admin/schedules",Object(l.a)({params:n,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Jt.apply(this,arguments)}var Rn=s("5R/X"),La=function(){var n=Object(d.useState)(null),a=Object(G.a)(n,2),r=a[0],t=a[1],u=Object(d.useState)([]),o=Object(G.a)(u,2),b=o[0],f=o[1],E=Object(q.b)(),_=E.semester_subject_id,p=lt()(),S=Object(d.useMemo)(function(){return b.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:lt()(C.date_from).toDate(),end:lt()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[b]),j=Object(d.useCallback)(function(C,J){Ra({semester_subject_id:_,date_form:C.toDate(),date_to:J.toDate()}).then(function(z){z.success&&f(z.data)})},[_]),O=Object(d.useCallback)(function(C){t(C)},[]),h=Object(d.useCallback)(function(){t(null)},[]),g=Object(d.useCallback)(function(C){return C.isSame(p,"day")?"warning":C.isAfter(p,"day")?"success":"error"},[]),P=Object(d.useCallback)(function(C){var J=S.filter(function(z){return lt()(z.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:J.map(function(z){return Object(e.jsx)("li",{onClick:function(){return O(z)},children:Object(e.jsx)(Da.a,{status:g(lt()(z.start)),text:z.title})},z.id)})})},[b]),T=Object(d.useCallback)(function(C,J){var z=lt()(C).startOf(J).subtract(1,"month"),Ce=lt()(C).endOf(J).add(1,"month");j(z,Ce)},[]);return Object(d.useEffect)(function(){var C=lt()().startOf("month"),J=lt()().endOf("month");j(C,J)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Title,{level:4,children:Object(e.jsx)(c.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ia.a,{dateCellRender:P,onPanelChange:T}),Object(e.jsxs)(Le.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:h,footer:null,children:[Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&lt()(r.start).format(v.b)]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(c.a,{id:"end_at",defaultMessage:"End date"}),":",r&&lt()(r.end).format(v.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(st.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(oe.a,{type:"primary",children:Object(e.jsx)(c.a,{id:"msTeams"})})},"teamsLink")})]})]})},na=s("yj/a"),ra=s("5Syx"),Tt=s("PpiC"),Yt=s("H6aw"),Fa=s("p3I6"),Aa=["results"],sa=function(n,a){return n.reduce(function(r,t){var u=t.results,o=Object(Tt.a)(t,Aa),b=u.find(function(f){return f.user_id===a});return b?[].concat(Object(se.a)(r),[Object(l.a)(Object(l.a)({},o),{},{result:b})]):r},[])},ca=function(n,a){var r,t=n.reduce(function(j,O){var h=O.result,g=O.weight;return[j[0]+h.result*g,j[1]+g]},[0,0]),u=Object(G.a)(t,2),o=u[0],b=u[1],f=Number.isNaN(o/b)?0:o/b,E=a.sort(function(j,O){return j.grade_value-O.grade_value}).reduce(function(j,O){return[].concat(Object(se.a)(j),[Object(l.a)(Object(l.a)({},O),{},{isWeightedAverageGreater:f>=O.grade_value})])},[]);if(E.every(function(j){var O=j.isWeightedAverageGreater;return O})){var _,p;return(_=(p=E.at(-1))===null||p===void 0?void 0:p.name)!==null&&_!==void 0?_:""}var S=E.findIndex(function(j){var O=j.isWeightedAverageGreater;return!O});return S<0?"":(r=E[S-1])===null||r===void 0?void 0:r.name},ua=function(n,a){var r;return(r=a.find(function(t){return t.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},$a=["attendances"];function Na(i,n){var a=Object(d.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],u=r[1];return Object(d.useEffect)(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!0})}),Ca(i,n).then(function(o){o.success&&u(function(b){return Object(l.a)(Object(l.a)({},b),{},{data:o.data})})}).finally(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!1})})})},[n,i]),{finalGrades:t}}function Ua(){var i=Object(d.useState)({loading:!1}),n=Object(G.a)(i,2),a=n[0],r=n[1];return Object(d.useEffect)(function(){r(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!0})}),qt().then(function(t){t.success&&r(function(u){return Object(l.a)(Object(l.a)({},u),{},{data:t.data})})}).finally(function(){r(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function wa(i){var n=Object(d.useState)({loading:!1}),a=Object(G.a)(n,2),r=a[0],t=a[1];return Object(d.useEffect)(function(){i!==void 0&&(t(function(u){return Object(l.a)(Object(l.a)({},u),{},{loading:!0})}),ea(i).then(function(u){u.success&&t(function(o){return Object(l.a)(Object(l.a)({},o),{},{data:u.data})})}).finally(function(){t(function(u){return Object(l.a)(Object(l.a)({},u),{},{loading:!1})})}))},[i]),{subjectGradeScales:r}}function Ba(i,n,a){var r=Object(d.useState)({loading:!1}),t=Object(G.a)(r,2),u=t[0],o=t[1];return Object(d.useEffect)(function(){typeof i!="number"||typeof n!="number"||typeof a!="number"||(o(function(b){return Object(l.a)(Object(l.a)({},b),{},{loading:!0})}),Nt(i,n).then(function(b){b.success&&o(function(f){var E,_;return Object(l.a)(Object(l.a)({},f),{},{data:(E=ua(a,(_=b.data.grade_scale)!==null&&_!==void 0?_:[]))===null||E===void 0?void 0:E.map(function(p,S){return Object(l.a)(Object(l.a)({},p),{},{id:S})})})})}).finally(function(){o(function(b){return Object(l.a)(Object(l.a)({},b),{},{loading:!1})})}))},[i,n]),{tutorGradeScales:u}}function Ka(i,n){var a=Object(d.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],u=r[1],o=Object(d.useCallback)(function(){u(function(b){return Object(l.a)(Object(l.a)({},b),{},{loading:!0})}),Rt(i).then(function(b){if(b.success){var f=b.data.reduce(function(E,_){var p=_.attendances,S=Object(Tt.a)(_,$a),j=p.find(function(O){return O.user_id===n});return j?[].concat(Object(se.a)(E),[Object(l.a)(Object(l.a)({},S),{},{attendance:j})]):E},[]);u(function(E){return Object(l.a)(Object(l.a)({},E),{},{data:f})})}}).finally(function(){u(function(b){return Object(l.a)(Object(l.a)({},b),{},{loading:!1})})})},[i,n]);return Object(d.useEffect)(function(){o()},[o]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:o}}function Wa(i,n){var a=Object(d.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],u=r[1];return Object(d.useEffect)(function(){!n||(u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!0})}),He({student_id:i,semester_subject_id:n}).then(function(o){if(o.success){var b=sa(o.data,i);u(function(f){return Object(l.a)(Object(l.a)({},f),{},{data:b})})}}).finally(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!1})})}))},[i,n]),{studentExams:t}}function Va(i,n){var a=Object(d.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],u=r[1],o=Object(d.useState)({loading:!1}),b=Object(G.a)(o,2),f=b[0],E=b[1],_=Object(d.useState)({loading:!1}),p=Object(G.a)(_,2),S=p[0],j=p[1];return Object(d.useEffect)(function(){u(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Object(Yt.e)({group_id:i}).then(function(O){O.success&&u(function(h){return Object(l.a)(Object(l.a)({},h),{},{data:O.data})})}).finally(function(){u(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})})},[i]),Object(d.useEffect)(function(){!t.data||(j(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var h=O.id;return Object(Yt.n)(Number(h))})).then(function(O){O.forEach(function(h){h.success&&j(function(g){return Object(l.a)(Object(l.a)({},g),{},{data:Object(l.a)(Object(l.a)({},g.data),{},Object(bt.a)({},Number(h.data.id),Object(Fa.c)(h.data.lessons)))})})})}).finally(function(){j(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})}),E(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var h=O.id;return Object(Yt.l)(Number(h),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(g){if(g.success){var P,T,C=((P=g.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&P!==void 0?P:[]).filter(function(z){return z.id===n}),J=(T=g.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&T!==void 0?T:[];E(function(z){return Object(l.a)(Object(l.a)({},z),{},{data:Object(l.a)(Object(l.a)({},z.data),{},Object(bt.a)({},Number(h),{finishedTopics:C,attendanceList:J}))})})}})})).finally(function(){return E(function(O){return Object(l.a)(Object(l.a)({},O),{},{loading:!1})})}))},[t.data,n]),{userCourses:t,userCoursesStats:f,userCoursesTopics:S}}var Ha=[{title:Object(e.jsx)(c.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(c.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(c.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],za=[{title:Object(e.jsx)(c.a,{id:"date"}),dataIndex:"date_from",render:function(n,a){return Object(Je.a)(new Date(a.date_from),v.c)}}],Ja=[{title:Object(e.jsx)(c.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(c.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,a){return Object(Je.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(c.a,{id:"grade"}),dataIndex:"result",render:function(n,a){return"".concat(a.result.result,"%")}}],Ya=[{title:Object(e.jsx)(c.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(c.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=a.grade)!==null&&r!==void 0&&r.grade_date?Object(Je.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),v.c):"-"}},{title:Object(e.jsx)(c.a,{id:"grade"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&r!==void 0?r:"-"}}],Mt=6,Xa=function(n){var a,r,t,u,o=n.user_id,b=n.group_id,f=Object(q.b)(),E=f.semester_subject_id,_=Wa(o,E),p=_.studentExams,S=Na(b,o),j=S.finalGrades,O=Ua(),h=O.gradeTerms,g=wa((a=j.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),P=g.subjectGradeScales,T=Ba(E,(r=j.data)===null||r===void 0?void 0:r.tutor_id,(t=j.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),C=T.tutorGradeScales,J=Ka(b,o),z=J.userAttendanceSchedules,Ce=J.fetchUserAttendanceSchedules,we=Va(b,o),K=we.userCourses,N=we.userCoursesStats,U=we.userCoursesTopics,te=D.a.useForm(),Qe=Object(G.a)(te,1),nt=Qe[0],Oe=Object(d.useMemo)(function(){var re;return((re=h.data)!==null&&re!==void 0?re:[]).map(function(W){var pe=W.id,Te=W.name;return{label:Te,value:pe}})},[h.data]),he=Object(d.useMemo)(function(){var re;return((re=P.data)!==null&&re!==void 0?re:[]).map(function(W){var pe=W.name,Te=W.id;return{label:pe,value:Te}})},[P.data]),Z=Object(d.useMemo)(function(){var re,W;return ca((re=p.data)!==null&&re!==void 0?re:[],(W=C.data)!==null&&W!==void 0?W:[])},[p.data,C.data]),Be=Object(d.useCallback)(function(){var re=Object(V.a)(Object(x.a)().mark(function W(pe){var Te,qe,ct,dt,Ot,$e,Xe;return Object(x.a)().wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(ct=pe.grade_scale_id,dt=pe.grade_term_id,((Te=j.data)===null||Te===void 0?void 0:Te.id)!==void 0){et.next=3;break}return et.abrupt("return");case 3:if(Ot=(qe=j.data)===null||qe===void 0?void 0:qe.grades.find(function(yt){var Et=yt.grade_term;return Et.id===dt}),!Ot){et.next=11;break}return et.next=7,aa(Ot.id,{grade_scale_id:ct});case 7:return $e=et.sent,mt.b[$e.success?"success":"error"]($e.message),$e.success&&c.f.push("/teacher/subjects/".concat(E,"/final-grades")),et.abrupt("return");case 11:return et.next=13,ta({grade_scale_id:ct,grade_term_id:dt,lesson_group_user_id:j.data.id});case 13:Xe=et.sent,mt.b[Xe.success?"success":"error"](Xe.message),Xe.success&&c.f.push("/teacher/subjects/".concat(E,"/final-grades"));case 16:case"end":return et.stop()}},W)}));return function(W){return re.apply(this,arguments)}}(),[j.data,E]),tt=Object(d.useMemo)(function(){var re;return((re=h.data)!==null&&re!==void 0?re:[]).map(function(W){var pe;return Object(l.a)(Object(l.a)({},W),{},{grade:(pe=j.data)===null||pe===void 0?void 0:pe.grades.find(function(Te){var qe=Te.grade_term;return qe.id===W.id})})})},[j.data,h.data]),Ke=K.loading&&!K.data||N.loading&&!N.data||U.loading&&!U.data,rt=Boolean(K.data&&N.data&&U.data);return j.loading?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[j.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.Student",values:j.data.user})}),Object(e.jsx)($t.a,{})]}),Object(e.jsxs)(ft.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(w.a,{rowKey:"id",headerTitle:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:p.data,loading:p.loading,columns:Ja,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(w.a,{rowKey:"id",headerTitle:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:tt,loading:j.loading||h.loading,columns:Ya,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(w.a,{rowKey:"id",headerTitle:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:z.data,loading:z.loading,columns:[].concat(za,[{title:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(W,pe){return Object(e.jsx)(At,{groupAttendanceScheduleId:pe.id,studentId:o,attendance:pe.attendance.value,onSuccess:Ce})}}])})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(w.a,{rowKey:"id",headerTitle:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:C.data,loading:C.loading,columns:Ha})}),Ke&&Object(e.jsx)(ue.a,{}),rt&&((u=K.data)===null||u===void 0?void 0:u.map(function(re){var W,pe,Te,qe,ct,dt,Ot,$e,Xe=re.id,ot=re.title;return Object(e.jsxs)(R.a,{span:24,children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:ot}),Object(e.jsx)(ra.c,{course_id:Number(Xe),topics:(W=(pe=U.data)===null||pe===void 0?void 0:pe[Number(Xe)])!==null&&W!==void 0?W:[],stats:(Te=(qe=N.data)===null||qe===void 0||(ct=qe[Number(Xe)])===null||ct===void 0?void 0:ct.finishedTopics)!==null&&Te!==void 0?Te:[]}),Object(e.jsx)(ra.a,{stats:(dt=(Ot=N.data)===null||Ot===void 0||($e=Ot[Number(Xe)])===null||$e===void 0?void 0:$e.attendanceList)!==null&&dt!==void 0?dt:[]})]},Xe)}))]}),Object(e.jsx)(D.a,{form:nt,onFinish:Be,children:Object(e.jsxs)(D.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(na.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})}],label:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:Oe,width:"sm",fieldProps:{loading:h.loading}}),Object(e.jsx)(na.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(c.a,{id:"field_required"})}],label:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:he,fieldProps:{loading:j.loading||P.loading}}),Object(e.jsx)(D.a.Item,{children:Object(e.jsx)(c.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Z}})})]})})]})},Za=[{title:Object(e.jsx)(c.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,a){return a.user.first_name}},{title:Object(e.jsx)(c.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,a){return a.user.last_name}},{title:Object(e.jsx)(c.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(r){var t=r.grade_name,u=r.grade_term,o=r.id;return Object(e.jsxs)(st.a.Text,{children:[u.name,": ",t]},o)}):"-"})}}],Qa=function(){var n,a,r=Object(M.k)(),t=Object(d.useMemo)(function(){var p,S,j,O;return{user_id:Number.isNaN(Number((p=r.query)===null||p===void 0?void 0:p.user_id))?null:Number((S=r.query)===null||S===void 0?void 0:S.user_id),group_id:Number.isNaN(Number((j=r.query)===null||j===void 0?void 0:j.group_id))?null:Number((O=r.query)===null||O===void 0?void 0:O.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(a=r.query)===null||a===void 0?void 0:a.group_id]),u=t.user_id,o=t.group_id,b=Object(q.b)(),f=b.teacherSubjectData,E=b.semester_subject_id,_=Object(d.useMemo)(function(){var p;return((p=f==null?void 0:f.groups)!==null&&p!==void 0?p:[]).map(function(S){var j=S.id,O=S.name;return{label:O,value:j}})},[f==null?void 0:f.groups]);return u!==null&&o!==null?Object(e.jsx)(Xa,{user_id:u,group_id:o}):Object(e.jsx)(w.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var p=Object(V.a)(Object(x.a)().mark(function S(j){var O,h,g,P,T,C,J,z,Ce,we;return Object(x.a)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return h=j.group_id,g=h===void 0?[]:h,P=j.first_name,T=P===void 0?"":P,C=j.last_name,J=C===void 0?"":C,z=((O=f==null?void 0:f.groups)!==null&&O!==void 0?O:[]).map(function(U){var te=U.id;return te}),N.next=4,kt(g.length===0?z:g);case 4:if(Ce=N.sent,Ce.success){N.next=7;break}return N.abrupt("return",{success:!1,total:0,data:[]});case 7:return we=Ce.data.filter(function(U){var te=U.user;return te.first_name.toLowerCase().includes(T.toLowerCase())&&te.last_name.toLowerCase().includes(J.toLowerCase())}),N.abrupt("return",{success:!0,total:we.length,data:we});case 9:case"end":return N.stop()}},S)}));return function(S){return p.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(c.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:_,mode:"multiple"},render:function(S,j){return Object(e.jsx)(le.a,{type:"Students",type_id:j.group_id},j.group_id)}}].concat(Za,[{title:Object(e.jsx)(c.a,{id:"options"}),hideInSearch:!0,render:function(S,j){return[Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(j.user.id,"&group_id=").concat(j.group_id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"edit"}),children:Object(e.jsx)(oe.a,{type:"primary",icon:Object(e.jsx)(Ve.a,{})})})},"edit")]}}])})},ka=s("dF/Y"),qa=s("o+0V"),ia=s("0WSk"),en=["type","defaultRender"],tn=["type","defaultRender"],an=function(n){var a=n.url;return Object(e.jsx)(ze.a,{title:Object(e.jsx)(c.a,{id:"download"}),children:Object(e.jsx)(oe.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(ka.a,{})})})},nn=[{title:Object(e.jsx)(c.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(c.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,a){return Object(Je.a)(new Date(a.created_at),v.a)}},{title:Object(e.jsx)(c.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,a,r){var t=a.type,u=a.defaultRender,o=Object(Tt.a)(a,en);if(t==="form")return null;var b=r.getFieldValue("state");return Object(e.jsx)(ia.a,Object(l.a)(Object(l.a)({},o),{},{state:{type:b}}))},render:function(n,a){return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(c.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,a){return Object(Je.a)(new Date(a.exported_at),v.a)}},{title:Object(e.jsx)(c.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,a,r){var t=a.type,u=a.defaultRender,o=Object(Tt.a)(a,tn);if(t==="form")return null;var b=r.getFieldValue("state");return Object(e.jsx)(ia.a,Object(l.a)(Object(l.a)({},o),{},{state:{type:b}}))},render:function(n,a){return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(c.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(c.a,{id:"options"}),valueType:"option",render:function(n,a){return[Object(e.jsx)(an,{url:a.url},"download")]}}],rn=function(){var n,a,r=Object(q.b)(),t=r.teacherSubjectData,u=Object(d.useMemo)(function(){var b;return((b=t==null?void 0:t.groups)!==null&&b!==void 0?b:[]).map(function(f){var E=f.id,_=f.name;return{value:E,label:_}})},[t==null?void 0:t.groups]),o=Object(d.useMemo)(function(){var b,f;return[{title:Object(e.jsx)(c.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:u,defaultValue:t==null||(b=t.groups)===null||b===void 0||(f=b[0])===null||f===void 0?void 0:f.id,allowClear:!1}}].concat(nn)},[t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.id,u]);return Object(e.jsx)(w.a,{className:"table-standalone",request:function(){var b=Object(V.a)(Object(x.a)().mark(function f(E){var _,p,S,j,O,h,g;return Object(x.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return S=E.group_id,j=S===void 0?t==null||(_=t.groups)===null||_===void 0||(p=_[0])===null||p===void 0?void 0:p.id:S,O=E.created_by,h=E.exported_by,T.next=3,Object(qa.a)({group_id:j,created_by:O,exported_by:h});case 3:if(g=T.sent,g.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:g.data,total:g.data.length});case 7:case"end":return T.stop()}},f)}));return function(f){return b.apply(this,arguments)}}(),columns:o,search:{layout:"vertical"},scroll:{x:1500}})},sn=function(n,a){var r;return(r=n.find(function(t){return t.name===a}))===null||r===void 0?void 0:r.id},cn=function(n){var a=n.term,r=n.gradeScales,t=n.defaultFinalGrade,u=n.finalGrades,o=Object(d.useState)(t),b=Object(G.a)(o,2),f=b[0],E=b[1],_=Object(d.useState)(!1),p=Object(G.a)(_,2),S=p[0],j=p[1],O=Object(d.useMemo)(function(){return r.map(function(g){var P=g.name,T=g.id;return{value:T,label:P}})},[r]),h=Object(d.useCallback)(function(g){if(!!(u!=null&&u.id)){if(f){j(!0),aa(f.id,{grade_scale_id:g}).finally(function(){return j(!1)});return}j(!0),ta({grade_term_id:a.id,grade_scale_id:g,lesson_group_user_id:u.id}).then(function(P){if(P.success){var T=P.data.grades.find(function(C){return C.grade_term.id===a.id});E(T)}}).finally(function(){return j(!1)})}},[f,a.id,u==null?void 0:u.id]);return u?Object(e.jsx)(pt.a,{loading:S,disabled:S,placeholder:Object(e.jsx)(c.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:h,options:O,defaultValue:sn(r,t==null?void 0:t.grade_name)}):null},un=s("LvDl"),ln=function(n){var a=n.exam_id,r=n.result,t=n.student_id,u=n.onSuccess,o=Object(d.useCallback)(Object(un.debounce)(function(b){Ze(a,t,{result:b!=null?b:0}).then(function(f){f.success&&(u==null||u(f.data))})},300),[a,r,t]);return Object(e.jsx)(A.a,{type:"number",min:0,max:100,onChange:o,defaultValue:r})},dn=function(n){var a=n.reduce(function(r,t){return[].concat(Object(se.a)(r),[{title:Object(Je.a)(new Date(t.date_from),v.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(o,b){return Object(e.jsx)(At,{groupAttendanceScheduleId:t.id,attendance:b["attendance-".concat(t==null?void 0:t.date_from)],studentId:b.id})}}])},[]);return a.length?{title:Object(e.jsx)(c.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(c.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},on=function(n,a){return n.reduce(function(r,t){var u=t.attendances.find(function(o){return o.user_id===a});return u?Object(l.a)(Object(l.a)({},r),{},Object(bt.a)({},"attendance-".concat(t.date_from),u.value)):r},{})},jn=function(n){var a=n.reduce(function(r,t){return[].concat(Object(se.a)(r),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(c.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(o,b){var f;return(b==null||(f=b["exam-".concat(t.id)])===null||f===void 0?void 0:f.result)!==void 0?Object(e.jsx)(ln,{result:b==null?void 0:b["exam-".concat(t.id)].result,exam_id:t.id,student_id:b.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(c.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(c.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},bn=function(n){return n.reduce(function(a,r){var t=r.result,u=r.id;return Object(l.a)(Object(l.a)({},a),{},Object(bt.a)({},"exam-".concat(u),t))},{})},vn=function(n,a){return{title:Object(e.jsx)(c.a,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(u,o){return Object(e.jsx)(cn,{defaultFinalGrade:o["final-grade-".concat(r.id)],finalGrades:o.final_grades,term:r,gradeScales:a})}}})}},fn=function(n,a){return n.find(function(r){return r.user.id===a})},mn=function(n){var a;return((a=n==null?void 0:n.grades)!==null&&a!==void 0?a:[]).reduce(function(r,t){return Object(l.a)(Object(l.a)({},r),{},Object(bt.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},On=function(){var n,a,r=Object(q.b)(),t=r.teacherSubjectData,u=r.semester_subject_id,o=Object(d.useState)([]),b=Object(G.a)(o,2),f=b[0],E=b[1],_=Object(d.useState)(t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.name),p=Object(G.a)(_,2),S=p[0],j=p[1],O=Object(c.l)(),h=Object(d.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(C){var J=C.id,z=C.name;return{value:J,label:z}})},[t==null?void 0:t.groups]),g=Object(d.useRef)(),P=Object(d.useMemo)(function(){var T;return[{title:Object(e.jsx)(c.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:h,defaultValue:h==null||(T=h[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(c.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(se.a)(f))},[h,f]);return Object(e.jsx)(w.a,{className:"table-standalone",request:function(){var T=Object(V.a)(Object(x.a)().mark(function C(J){var z,Ce,we,K,N,U,te,Qe,nt,Oe,he,Z,Be,tt,Ke,rt,re,W,pe,Te,qe,ct,dt;return Object(x.a)().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return U=J.group_id,te=U===void 0?(z=h[0])===null||z===void 0?void 0:z.value:U,Qe=J.full_name,nt=Qe===void 0?"":Qe,$e.next=3,kt(te);case 3:if(Oe=$e.sent,he=h.find(function(Xe){var ot=Xe.value;return ot===te}),!(!Oe.success||Oe.data[0]===void 0||u===null)){$e.next=8;break}return mt.b.error(O.formatMessage({id:"groupDataMissing"},{group_name:he==null?void 0:he.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 8:return $e.next=10,Promise.all([Object(xt.b)(te),Rt(te),He({group_id:te,per_page:-1}),Nt(u,(Ce=Oe.data)===null||Ce===void 0||(we=Ce[0])===null||we===void 0?void 0:we.tutor_id),qt(),ea((K=Oe.data)===null||K===void 0||(N=K[0])===null||N===void 0?void 0:N.s_subject_scale_form_id)]);case 10:if(Z=$e.sent,Be=Object(G.a)(Z,6),tt=Be[0],Ke=Be[1],rt=Be[2],re=Be[3],W=Be[4],pe=Be[5],!(!tt.success||!Ke.success||!rt.success||!re.success||!W.success||!pe.success||!he)){$e.next=21;break}return mt.b.error(O.formatMessage({id:"groupDataMissing"},{group_name:he==null?void 0:he.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 21:return j(he.label),Te=dn(Ke.data),qe=jn(rt.data),ct=vn(W.data,pe.data),E([Te,qe,ct,{title:Object(e.jsx)(c.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),dt=tt.data.users.reduce(function(Xe,ot){var et,yt,Et,Pt=ot.id,pn=ot.academic_teacher_id,gn=ot.first_name,xn=ot.last_name,la="".concat(xn," ").concat(gn);if(pn!==null||!la.toLowerCase().includes(nt.toLowerCase()))return Xe;var Sn=on(Ke.data,Pt),da=sa(rt.data,Pt),Ct=fn(Oe.data,Pt),_n=(et=ua((yt=Ct==null?void 0:Ct.s_subject_scale_form_id)!==null&&yt!==void 0?yt:0,(Et=re.data.grade_scale)!==null&&Et!==void 0?Et:[]))!==null&&et!==void 0?et:[],yn=ca(da,_n),En=bn(da),Cn=mn(Ct);return[].concat(Object(se.a)(Xe),[Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({id:Pt,full_name:la},Sn),En),Cn),{},{proposed_grade:yn,final_grades:Ct})])},[]).sort(function(Xe,ot){return Xe.full_name.localeCompare(ot.full_name)}),$e.abrupt("return",{data:dt,total:dt.length,success:!0});case 28:case"end":return $e.stop()}},C)}));return function(C){return T.apply(this,arguments)}}(),columns:P,headerTitle:Object(e.jsx)(c.a,{id:"classRegisterTitleWithGroupName",values:{groupName:S}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:g,pagination:{onChange:function(){var C;return(C=g.current)===null||C===void 0?void 0:C.reload()}},rowKey:"id"})},hn=function(n){var a,r,t=n.tab,u=Object(c.l)(),o=Object(c.m)("@@initialState"),b=o.setInitialState,f=o.initialState,E=Object(q.b)(),_=E.teacherSubjectData,p=E.semester_subject_id,S=E.tutors,j=Object(d.useCallback)(Object(je.a)(f==null?void 0:f.currentUser),[f==null?void 0:f.currentUser]),O=Object(d.useMemo)(function(){return!!S.data.find(function(h){var g,P=h.id;return P===(f==null||(g=f.currentUser)===null||g===void 0?void 0:g.id)})||j(me.a.TeacherListGradeScale)},[]);return _?Object(e.jsx)(y.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(c.a,{id:_==null||(a=_.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(c.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(p,"/exams?exam_id=new"),children:Object(e.jsx)(oe.a,{type:"primary",children:Object(e.jsx)(c.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:u.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:u.formatMessage({id:"Subjects"})},{path:String(p),breadcrumbName:String((r=_.subject)===null||r===void 0?void 0:r.name)},{path:String(t),breadcrumbName:u.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(F.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(g){b(Object(l.a)({},f)),c.f.push("/teacher/subjects/".concat(p,"/").concat(g))}},children:[Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"groups"}),children:Object(e.jsx)(Me.a,{})},"groups"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"students"}),children:Object(e.jsx)(ma,{})},"students"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"exams"}),children:Object(e.jsx)(_t,{})},"exams"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"schedule"}),children:Object(e.jsx)(La,{})},"schedule"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"class-register"}),children:Object(e.jsx)(On,{})},"class-register"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"attendance"}),children:Object(e.jsx)(Sa,{})},"attendance"),O&&Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"grades-scale"}),children:Object(e.jsx)(Pa,{})},"grades-scale"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"final-grades"}),children:Object(e.jsx)(Qa,{})},"final-grades"),Object(e.jsx)(F.a.TabPane,{tab:Object(e.jsx)(c.a,{id:"file-exports-history"}),children:Object(e.jsx)(rn,{})},"file-exports-history")]})}):Object(e.jsx)(ue.a,{})},Ln=de.default=function(){var i=Object(M.l)(),n=i.subjectId,a=i.tab,r=a===void 0?"groups":a;return Object(e.jsx)(q.a,{semester_subject_id:Number(n),children:Object(e.jsx)(hn,{tab:r})})}},p3I6:function(ht,de,s){"use strict";s.d(de,"b",function(){return je}),s.d(de,"c",function(){return Ue}),s.d(de,"a",function(){return ut});var l=s("miYZ"),ge=s("tsqr"),oe=s("tJVT"),I=s("k1fw"),ue=s("oBTY"),d=s("q1tI"),ke=s.n(d),c=s("9kvl"),We=s("Ty5D"),M=s("H6aw"),F=s("/y+f"),y=s("nKUr"),me=s.n(y),je=ke.a.createContext({}),q=function(){return Math.round(Math.random()*99999)},Me=function xe(be){return be.reduce(function(ee,m){return[].concat(Object(ue.a)(ee),Object(ue.a)(m.lessons?xe(m.lessons):[]),[m])},[])},Ue=function xe(be){return be.reduce(function(ee,m){var Y;return[].concat(Object(ue.a)(ee),Object(ue.a)(m.lessons?xe(m.lessons):[]),Object(ue.a)((Y=m.topics)!==null&&Y!==void 0?Y:[]))},[])},jt=function xe(be,ee,m){return be.map(function(Y){var De,w;return Object(I.a)(Object(I.a)({},Y),{},{lessons:Y.lessons?xe(Y.lessons,ee,m):[],topics:Y.id===ee?[].concat(Object(ue.a)((De=Y.topics)!==null&&De!==void 0?De:[]),[m]):(w=Y.topics)!==null&&w!==void 0?w:[]})})},vt=function xe(be,ee,m){return m?be.map(function(Y){return Object(I.a)(Object(I.a)({},Y),{},{lessons:[].concat(Object(ue.a)(Y.lessons?xe(Y.lessons,ee,m):[]),Object(ue.a)(Y.id===m?[ee]:[]))})}):[].concat(Object(ue.a)(be),[ee])},ze=function xe(be,ee,m){return be.map(function(Y){return Object(I.a)(Object(I.a)({},Y.id===ee?m:Y),{},{lessons:Y.lessons?xe(Y.lessons,ee,m):[]})})},x=function xe(be,ee){return be.map(function(m){return Object(I.a)(Object(I.a)({},m),{},{parent_id:ee,lessons:m.lessons?xe(m.lessons,m.id):[]})})},V=function xe(be,ee){return be.filter(function(m){return m.id!==ee}).map(function(m){return Object(I.a)(Object(I.a)({},m),{},{lessons:m.lessons?xe(m.lessons,ee):[]})})},Je=function xe(be,ee){return be.map(function(m){return Object(I.a)(Object(I.a)({},m),{},{lessons:m.lessons?xe(m.lessons,ee):[],topics:m.topics?m.topics.filter(function(Y){return Y.id!==ee}):[]})})},Ve=function xe(be,ee,m,Y){return Y==null?void 0:Y.map(function(De){if(De.id===m){var w;return Object(I.a)(Object(I.a)({},De),{},{topics:(w=De.topics)===null||w===void 0?void 0:w.map(function(v){return v.id===be?ee.file.response.data:v})})}else if(De.lessons)return Object(I.a)(Object(I.a)({},De),{},{lessons:xe(be,ee,m,De.lessons||[])});return De})},ut=function(be){var ee=be.children,m=be.id,Y=Object(d.useState)(),De=Object(oe.a)(Y,2),w=De[0],v=De[1],He=Object(c.l)(),Ne=Object(d.useMemo)(function(){return w&&w.lessons?Ue(w.lessons):[]},[w]),ve=Object(d.useMemo)(function(){return w&&w.lessons?Me(w.lessons):[]},[w]),Ge=Object(d.useState)([]),Pe=Object(oe.a)(Ge,2),Re=Pe[0],Se=Pe[1],ae=Object(We.k)();Object(d.useEffect)(function(){Se([])},[]);var Ee=Object(d.useCallback)(function(){Object(M.n)(m).then(function(R){return R.success&&v(Object(I.a)(Object(I.a)({},R.data),{},{lessons:x(R.data.lessons)}))})},[m]);Object(d.useEffect)(function(){Ee()},[Ee]);var _e=Object(d.useCallback)(function(R){var D=ve.find(function(H){var B;return H==null||(B=H.topics)===null||B===void 0?void 0:B.find(function(L){return L.id===R})});return D?D.id:null},[ve]),Ze=Object(d.useMemo)(function(){var R,D;return(R=ae.query)!==null&&R!==void 0&&R.lesson?{mode:"lesson",id:Number(ae.query.lesson),value:ve.find(function(H){return H.id===Number(ae.query.lesson)})}:(D=ae.query)!==null&&D!==void 0&&D.topic?{mode:"topic",id:Number(ae.query.topic),value:Ne.find(function(H){return H.id===Number(ae.query.topic)})}:{mode:"init"}},[ae.query,w,ve,Ne]),Ye=Object(d.useCallback)(function(R){var D={course_id:m,topics:[],isNew:!0,id:w?w.lessons.length+1:q(),order:0,title:He.formatMessage({id:"add_title_here"}),active:!0,parent_id:R};return v(function(H){var B;return Object(I.a)(Object(I.a)({},H),{},{lessons:vt((B=H==null?void 0:H.lessons)!==null&&B!==void 0?B:[],D,R)})}),D},[m,w]),ye=Object(d.useCallback)(function(R,D){var H=ve.find(function(L){return L.id===R}),B=H&&H.isNew;return(B?Object(M.g)(D):Object(M.v)(R,D)).then(function(L){return ge.b.success(L.message),Ee(),L.success&&v(function(X){var Le;return Object(I.a)(Object(I.a)({},X),{},{lessons:ze((Le=X==null?void 0:X.lessons)!==null&&Le!==void 0?Le:[],R,Object(I.a)(Object(I.a)({},L.data),{},{isNew:!1}))})})})},[w]),ie=Object(d.useCallback)(function(R){var D=ve.find(function(B){return B.id===R});if(!!D){var H=D.isNew;H?v(function(B){var L;return Object(I.a)(Object(I.a)({},B),{},{lessons:V((L=B==null?void 0:B.lessons)!==null&&L!==void 0?L:[],R)})}):Object(M.p)(R).then(function(B){B.success&&(ge.b.success(B.message),v(function(L){var X;return Object(I.a)(Object(I.a)({},L),{},{lessons:V((X=L==null?void 0:L.lessons)!==null&&X!==void 0?X:[],R)})}))})}},[w]),le=Object(d.useCallback)(function(R,D){var H,B=_e(R),L=ve.find(function(se){return se.id===B}),X=L&&((H=L.topics)===null||H===void 0?void 0:H.find(function(se){return se.id===R})),Le=X==null?void 0:X.isNew;return(Le?Object(M.h)(D):Object(M.w)(R,D)).then(function(se){se.success&&(ge.b.success(se.message),Ee(),c.f.push("/courses/list/".concat(m,"/program/?topic=").concat(se.data.id)),(X==null?void 0:X.topicable_type)===F.h.Video&&setTimeout(function(){Ee()},5e3))})},[_e,w,Ee]),$=Object(d.useCallback)(function(R){var D=_e(R),H=ve.find(function(X){return X.id===D});if(!!H){var B=Ne==null?void 0:Ne.find(function(X){return X.id===R}),L=B==null?void 0:B.isNew;L&&!B.topicable?v(function(X){var Le;return Object(I.a)(Object(I.a)({},X),{},{lessons:Je((Le=X==null?void 0:X.lessons)!==null&&Le!==void 0?Le:[],R)})}):Object(M.q)(R).then(function(X){X.success&&(ge.b.success(X.message),v(function(Le){var se;return Object(I.a)(Object(I.a)({},Le),{},{lessons:Je((se=Le==null?void 0:Le.lessons)!==null&&se!==void 0?se:[],R)})}))})}},[w,_e]),A=Object(d.useCallback)(function(R,D){var H={lesson_id:R,isNew:!0,id:q(),title:He.formatMessage({id:"add_title_here"}),active:!0,topicable_type:D};return v(function(B){var L;return Object(I.a)(Object(I.a)({},B),{},{lessons:jt((L=B==null?void 0:B.lessons)!==null&&L!==void 0?L:[],R,H)})}),H},[]),G=function(D,H){var B=_e(D);v(function(L){return Object(I.a)(Object(I.a)({},L),{},{lessons:L?Ve(D,H,B,L.lessons||[]):[]})}),c.f.push("/courses/list/".concat(m,"/program/?topic=").concat(H.file.response.data.id))},Q=Object(d.useCallback)(function(R){return Object(M.d)(R).then(function(D){if(D.success){ge.b.success(D.message);var H=_e(R);v(function(B){var L;return Object(I.a)(Object(I.a)({},B),{},{lessons:B?(L=B.lessons)===null||L===void 0?void 0:L.map(function(X){if(X.id===H){var Le=X.topics||[];return Object(I.a)(Object(I.a)({},X),{},{topics:[].concat(Object(ue.a)(Le),[D.data])})}return X}):[]})})}})},[w,_e]),ft=Object(d.useCallback)(function(R){return Object(M.c)(R).then(function(D){D.success&&(ge.b.success(D.message),v(function(H){return Object(I.a)(Object(I.a)({},H),{},{lessons:H?[].concat(Object(ue.a)(H.lessons),[D.data]):[]})}))})},[]),at={state:w,h5ps:Re,id:m,addNewLesson:Ye,updateLesson:ye,updateTopic:le,deleteLesson:ie,addNewTopic:A,deleteTopic:$,onTopicUploaded:G,cloneTopic:Q,cloneLesson:ft,currentEditMode:Ze,getLessons:Ee};return Object(y.jsx)(je.Provider,{value:at,children:ee})}},"w/VK":function(ht,de,s){"use strict";s.d(de,"c",function(){return ue}),s.d(de,"a",function(){return ke}),s.d(de,"b",function(){return We});var l=s("qLMh"),ge=s("k1fw"),oe=s("9og8"),I=s("9kvl");function ue(F,y){return d.apply(this,arguments)}function d(){return d=Object(oe.a)(Object(l.a)().mark(function F(y,me){return Object(l.a)().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",Object(I.i)("/api/admin/reports/report",Object(ge.a)({params:y,method:"GET",useCache:!1},me||{})));case 1:case"end":return q.stop()}},F)})),d.apply(this,arguments)}function ke(F,y,me){return c.apply(this,arguments)}function c(){return c=Object(oe.a)(Object(l.a)().mark(function F(y,me,je){return Object(l.a)().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:return Me.abrupt("return",Object(I.i)("/api/admin/stats/course/".concat(y,"/export"),Object(ge.a)({params:me,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},je||{})));case 1:case"end":return Me.stop()}},F)})),c.apply(this,arguments)}function We(F,y,me){return M.apply(this,arguments)}function M(){return M=Object(oe.a)(Object(l.a)().mark(function F(y,me,je){return Object(l.a)().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:return Me.abrupt("return",Object(I.i)("/api/admin/stats/topic/".concat(y,"/export"),Object(ge.a)({method:"GET",useCache:!1,params:{stat:me},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},je||{})));case 1:case"end":return Me.stop()}},F)})),M.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.08a8ba2e.async.js.map