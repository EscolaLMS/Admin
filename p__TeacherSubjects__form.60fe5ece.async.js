(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(jt,De,i){},"5Syx":function(jt,De,i){"use strict";i.d(De,"c",function(){return Se}),i.d(De,"b",function(){return at}),i.d(De,"a",function(){return et});var b=i("OaEy"),Ie=i("2fM7"),ce=i("g9YV"),F=i("wCAj"),je=i("14J3"),l=i("BMrR"),nt=i("BoS7"),s=i("Sdc0"),qe=i("jrin"),ie=i("k1fw"),le=i("DYRE"),ve=i("zeV3"),Ye=i("+BJd"),Ce=i("mr32"),Q=i("oBTY"),ge=i("tJVT"),Pe=i("q1tI"),st=i.n(Pe),bt=i("nhC9"),We=i("LDJE"),h=i("9kvl"),R=i("nz6D"),we=i("Vpfc"),ut=i("+L6B"),lt=i("2/Rp"),ae=i("qLMh"),V=i("9og8"),A=i("4KAj"),I=i("w/VK"),S=i("nKUr"),xe=function(ye){var _e=ye.course_id,Ee=ye.stat,Fe=Ee===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Ee,Oe=Object(Pe.useState)(!1),re=Object(ge.a)(Oe,2),ee=re[0],ze=re[1],Le=Object(Pe.useCallback)(function(G){return Object(V.a)(Object(ae.a)().mark(function be(){var ne,fe;return Object(ae.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return ze(!0),E.prev=1,E.next=4,Object(I.a)(G,{stat:Fe});case 4:ne=E.sent,ne instanceof Blob&&(fe=document.createElement("a"),fe.href=window.URL.createObjectURL(ne),fe.download="finished_topics_".concat(_e,".xlsx"),document.body.appendChild(fe),fe.click(),document.body.removeChild(fe)),E.next=11;break;case 8:E.prev=8,E.t0=E.catch(1),console.error(E.t0);case 11:return E.prev=11,ze(!1),E.finish(11);case 14:case"end":return E.stop()}},be,null,[[1,8,11,14]])}))},[Fe]);return Object(S.jsxs)(lt.a,{type:"primary",loading:ee,onClick:Le(_e),children:[Object(S.jsx)(A.a,{})," ",Object(S.jsx)(h.a,{id:"export"})]})},J=function(ye){return ye.topicable.content.contents?Object.values(ye.topicable.content.contents)[0].library:"H5P"},Se=function(ye){var _e=ye.course_id,Ee=ye.topics,Fe=ye.stats,Oe=Object(Pe.useState)(!1),re=Object(ge.a)(Oe,2),ee=re[0],ze=re[1],Le=Object(Pe.useMemo)(function(){return[{title:Object(S.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(ne){return Object(S.jsx)(we.a,{type:"App\\Models\\User",type_id:ne})}},{title:Object(S.jsx)(h.a,{id:"email"}),dataIndex:"email"}].concat(Object(Q.a)(Ee.map(function(be){var ne,fe=(ne=be.topicable_type)===null||ne===void 0?void 0:ne.split("\\").pop();return fe==="H5P"&&(fe=J(be)),{render:function(E){var Ae=0,Xe=0;switch(E&&(E.started_at&&E.finished_at?Ae=1:E.started_at&&(Ae=2),Xe=E.seconds/60),Ae){case 1:return Object(S.jsxs)(ve.b,{children:[Object(S.jsx)(Ce.a,{color:"success",children:"F"}),ee&&Object(S.jsxs)("small",{children:[Xe.toFixed(2),"m"]})]});case 2:return Object(S.jsxs)(ve.b,{children:[Object(S.jsx)(Ce.a,{color:"blue",children:"S"}),ee&&Object(S.jsxs)("small",{children:[Xe.toFixed(2),"m"]})]});case 0:default:return Object(S.jsx)(st.a.Fragment,{children:Object(S.jsx)(Ce.a,{color:"error",children:"N"})})}},title:Object(S.jsxs)("small",{children:[Object(S.jsx)(Ce.a,{children:fe})," ",be.title]}),dataIndex:be.id}})))},[Ee,ee]),G=Object(Pe.useMemo)(function(){return Fe.map(function(be){return Ee.reduce(function(ne,fe){var L=be.topics.find(function(E){return E.id===fe.id});return Object(ie.a)(Object(ie.a)({},ne),{},Object(qe.a)({},Number(fe.id),L!=null?L:0))},{email:be.email,id:be.id})})},[Fe,Ee]);return Object(S.jsx)(F.a,{title:function(){return Object(S.jsxs)(l.a,{justify:"space-between",align:"middle",children:[Object(S.jsxs)(ve.b,{children:[Object(S.jsx)(h.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(S.jsx)(Ce.a,{color:"success",children:"F"}),Object(S.jsx)(h.a,{id:"Started",defaultMessage:"Started:"})," ",Object(S.jsx)(Ce.a,{color:"blue",children:"S"}),Object(S.jsx)(h.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(S.jsx)(Ce.a,{color:"error",children:"N"}),Object(S.jsx)(h.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(S.jsx)(s.a,{checked:ee,onChange:function(fe){return ze(fe)}})]}),Object(S.jsx)(xe,{course_id:_e})]})},columns:Le,dataSource:G,size:"small",scroll:{x:1500},components:{table:function(ne){return Object(S.jsx)(R.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(S.jsx)("table",Object(ie.a)({},ne))})}}})},at=function(ye){var _e=ye.stats,Ee=ye.attempts,Fe=Object(Pe.useMemo)(function(){return[{title:Object(S.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(ee){return Object(S.jsx)(we.a,{type:"App\\Models\\User",type_id:ee})}},{title:Object(S.jsx)(h.a,{id:"email"}),dataIndex:"email"},{title:Object(S.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(S.jsx)(h.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Oe=Object(Pe.useMemo)(function(){return _e.map(function(re){var ee=re.id,ze=re.email,Le=re.finished_at,G=Ee==null?void 0:Ee.find(function(ne){return ne.id===ee}),be=Array.isArray(G==null?void 0:G.attempts)?G==null?void 0:G.attempts.length:0;return{id:ee,email:ze,finished_at:Le,attempt:be}})},[_e]);return Object(S.jsx)(F.a,{title:function(){return Object(S.jsx)(ve.b,{children:Object(S.jsx)(h.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Fe,dataSource:Oe,size:"small",scroll:{x:500}})},et=function(ye){var _e=ye.stats,Ee=Object(Pe.useState)(null),Fe=Object(ge.a)(Ee,2),Oe=Fe[0],re=Fe[1],ee=Object(Pe.useState)(null),ze=Object(ge.a)(ee,2),Le=ze[0],G=ze[1],be=Object(h.l)(),ne=Object(Pe.useMemo)(function(){return _e.flatMap(function(L){return Object.values(L.attempts).flatMap(function(E){var Ae=E.dates,Xe=E.attempt,de=Object.values(Ae).flatMap(function(P){var N=P.date,M=P.seconds_total;return{date:N,attempt:Xe,seconds_total:M,email:L.email}});return de})})},[_e]),fe={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(S.jsx)(bt.a,{title:Object(S.jsxs)(ve.b,{children:[Object(S.jsx)(h.a,{id:"course.interactions_time_in_days"}),Object(S.jsx)(Ie.a,{showSearch:!0,value:Oe,onChange:function(E){re(E),G(null)},placeholder:Object(S.jsx)(h.a,{id:"select_person",defaultMessage:"Select a person"}),children:_e.map(function(L){var E=L.id,Ae=L.email;return Object(S.jsx)(Ie.a.Option,{value:Ae,children:Ae},E)})}),Object(S.jsx)(Ie.a,{value:Le,onChange:function(E){return G(E)},disabled:Oe===null,placeholder:Object(S.jsx)(h.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Q.a)(new Set(ne.filter(function(L){var E=L.email;return E===Oe}).map(function(L){var E=L.attempt;return E}))).map(function(L){return Object(S.jsxs)(Ie.a.Option,{value:L,children:[Object(S.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"})," ",L]},L)})})]}),colSpan:12,layout:"center",children:Object(S.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(S.jsx)(We.a,Object(ie.a)(Object(ie.a)({},fe),{},{tooltip:{title:"".concat(be.formatMessage({id:"attempt"})),formatter:function(E){var Ae=Math.floor(+E.seconds_total/60),Xe=+E.seconds_total>60?+E.seconds_total-Ae*60:0;return{name:E.attempt,value:"".concat(Ae,"m ").concat(Xe,"s")}}},data:ne.filter(function(L){var E=L.email;return E===Oe}).filter(function(L){var E=L.attempt;return Number.isInteger(Le)?E===Le:!0})}))})})}},olry:function(jt,De,i){"use strict";i.r(De);var b=i("k1fw"),Ie=i("+L6B"),ce=i("2/Rp"),F=i("T2oS"),je=i("W9HT"),l=i("q1tI"),nt=i.n(l),s=i("9kvl"),qe=i("55Ip"),ie=i("Ty5D"),le=i("nhC9"),ve=i("tMyG"),Ye=i("my69"),Ce=i("huej"),Q=i("mJ0o"),ge=i("EhlZ"),Pe=i("P2fV"),st=i("NJEC"),bt=i("5Dmo"),We=i("3S7+"),h=i("qLMh"),R=i("9og8"),we=i("sWYD"),ut=i("G3dp"),lt=i("lbgm"),ae=i("/MfK"),V=i("Qiat"),A=i("mGZj");function I(u,r){return S.apply(this,arguments)}function S(){return S=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},u)})),S.apply(this,arguments)}function xe(u,r){return J.apply(this,arguments)}function J(){return J=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},u)})),J.apply(this,arguments)}function Se(u,r,a){return at.apply(this,arguments)}function at(){return at=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),at.apply(this,arguments)}function et(u,r){return Te.apply(this,arguments)}function Te(){return Te=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Te.apply(this,arguments)}function ye(u,r){return _e.apply(this,arguments)}function _e(){return _e=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),_e.apply(this,arguments)}function Ee(u,r,a,n){return Fe.apply(this,arguments)}function Fe(){return Fe=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return o.stop()}},u)})),Fe.apply(this,arguments)}function Oe(u,r,a){return re.apply(this,arguments)}function re(){return re=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(b.a)({method:"DELETE"},n||{})));case 1:case"end":return c.stop()}},u)})),re.apply(this,arguments)}var ee=i("Vpfc"),ze=i("giR+"),Le=i("fyUT"),G=i("tJVT"),be=i("14J3"),ne=i("BMrR"),fe=i("jCWc"),L=i("kPKH"),E=i("VMEa"),Ae=i("Qurx"),Xe=i("lR9U"),de=i("/y+f"),P=i("2qtc"),N=i("kLXV"),M=i("oBTY"),U=i("OaEy"),B=i("2fM7"),H=i("DBJ/"),e=i("nKUr"),Ve=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,c=Object(Q.b)(),o=c.semester_subject_id,j=c.teacherSubjectData,f=Object(l.useState)(null),y=Object(G.a)(f,2),p=y[0],g=y[1],v=Object(l.useMemo)(function(){var x;return((x=j==null?void 0:j.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{label:C,value:T}})},[]),d={type:a,group_id:p,semester_subject_id:o},m=Object(l.useCallback)(function(x){if(x.success){var O=x.data.results.filter(function(T){var C=T.user_id;return C!==null});if(!O.length)return;n({exam_results:O,group_id:x.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(B.a,{disabled:t,value:p,onChange:function(O){return g(O)},options:v,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(H.a,{name:"file",url:"/api/admin/exams/parse",onUpload:m,onChange:function(O){return!O.fileList.length&&n(void 0)},maxFiles:1,data:d,disabled:!p})]})},qt=function(r){var a=r.onDataConverted,n=Object(Q.b)(),t=n.teacherSubjectData,c=n.groupUsers,o=Object(l.useState)(null),j=Object(G.a)(o,2),f=j[0],y=j[1],p=Object(l.useMemo)(function(){var v;return((v=t==null?void 0:t.groups)!==null&&v!==void 0?v:[]).map(function(d){var m=d.id,x=d.name;return{label:x,value:m}})},[]),g=Object(l.useCallback)(function(v){var d;y(v);var m=(d=c.byId)===null||d===void 0?void 0:d[v];if(!!m){var x=m.users.reduce(function(O,T){var C=T.id,_=T.email,K=T.first_name,W=T.last_name,se=T.academic_teacher_id;return se!==null?O:[].concat(Object(M.a)(O),[{email:_,first_name:K,last_name:W,user_id:C,result:0}])},[]);a({group_id:v,exam_results:x})}},[c.byId]);return Object(e.jsx)(B.a,{value:f,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},ea=[de.c.TeamsLecture,de.c.TestPortal,de.c.TeamsForms],ta=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,c=r.type,o=Object(Q.b)(),j=o.teacherSubjectData,f=o.fetchGroupUsers,y=Object(l.useState)(),p=Object(G.a)(y,2),g=p[0],v=p[1];return Object(l.useEffect)(function(){if(c===de.c.Manual&&a){var d;j==null||(d=j.groups)===null||d===void 0||d.forEach(function(m){var x=m.id;return f(x)})}},[c,a]),Object(e.jsxs)(N.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){g&&t(g)},okButtonProps:{disabled:!g},children:[ea.includes(c)&&Object(e.jsx)(Ve,{type:c,onDataConverted:v,groupSelectDisabled:!!g}),c===de.c.Manual&&Object(e.jsx)(qt,{onDataConverted:v})]})},aa=function(r){var a=r.onSelect;return Object(e.jsxs)(ne.a,{gutter:[16,16],children:[Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(ce.a,{type:"primary",onClick:function(){return a(de.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(ce.a,{type:"primary",onClick:function(){return a(de.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(ce.a,{type:"primary",onClick:function(){return a(de.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(ce.a,{type:"primary",onClick:function(){return a(de.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ra=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],na=function(r){var a,n=r.exam_id,t=E.a.useForm(),c=Object(G.a)(t,1),o=c[0],j=Object(l.useState)(),f=Object(G.a)(j,2),y=f[0],p=f[1],g=Object(l.useState)(),v=Object(G.a)(g,2),d=v[0],m=v[1],x=Object(l.useState)(!1),O=Object(G.a)(x,2),T=O[0],C=O[1],_=Object(Q.b)(),K=_.semester_subject_id,W=_.getGroupById,se=Object(l.useMemo)(function(){var w;return((w=d==null?void 0:d.exam_results)!==null&&w!==void 0?w:[]).map(function(D){var $=D.user_id;return $})},[d==null?void 0:d.exam_results]);Object(l.useEffect)(function(){var w=Number(n);n==="new"&&(p(void 0),m(void 0),o.resetFields()),n!=="new"&&!Number.isNaN(w)&&(C(!0),et(w).then(function(D){if(D.success){var $=D.data,k=$.type,$e=$.results,ke=$.title,q=$.weight,te=$.passed_at,z=$.group_id;p(k),m({group_id:z,exam_results:$e}),o.setFieldsValue({title:ke,weight:q,passed_at:te})}}).finally(function(){return C(!1)}))},[n]);var Ge=Object(l.useCallback)(function(){p(void 0),m(void 0)},[]);return T?Object(e.jsx)(je.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(ta,{open:Boolean(y&&!d),type:y,closeModal:Ge,onSuccess:m}),Object(e.jsxs)(E.a,{form:o,submitter:y===void 0||!d?!1:void 0,onFinish:function(){var w=Object(R.a)(Object(h.a)().mark(function D($){var k,$e,ke,q,te,z,pe,Ne,he,He;return Object(h.a)().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if($e=d==null||(k=d.exam_results)===null||k===void 0?void 0:k.every(function(Y){var X=Y.result;return typeof X=="number"&&X>=0&&X<=100}),!(d&&$e&&typeof K=="number")){ue.next=17;break}if(ke=$.title,q=$.passed_at,te=$.weight,z=Number(n),pe=d.exam_results,Ne=d.group_id,he={type:y,semester_subject_id:K,title:ke,passed_at:q,weight:te,group_id:Ne,results:pe},!Number.isNaN(z)){ue.next=12;break}return ue.next=9,xe(he);case 9:ue.t0=ue.sent,ue.next=15;break;case 12:return ue.next=14,Se(z,he);case 14:ue.t0=ue.sent;case 15:He=ue.t0,He.success&&s.f.push("/teacher/subjects/".concat(K,"/exams"));case 17:return ue.abrupt("return",!0);case 18:case"end":return ue.stop()}},D)}));return function(D){return w.apply(this,arguments)}}(),onReset:Ge,children:[Object(e.jsxs)(E.a.Group,{children:[Object(e.jsx)(Ae.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(Xe.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(E.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Le.a,{})})]}),y&&d&&Object(e.jsx)(V.a,{rowKey:"user_id",headerTitle:(a=W(d.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:se,onValuesChange:function(D,$){return m({group_id:d.group_id,exam_results:$})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:d.exam_results,columns:ra}),!d&&Object(e.jsx)(aa,{onSelect:p})]})]})},sa=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],ua=function(r){var a=r.exam_id,n=Object(l.useState)(""),t=Object(G.a)(n,2),c=t[0],o=t[1];return Object(e.jsx)(V.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(R.a)(Object(h.a)().mark(function j(){var f;return Object(h.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,et(a);case 2:if(f=p.sent,!f.success){p.next=6;break}return o(f.data.title),p.abrupt("return",{total:f.data.results.length,success:!0,data:f.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},j)})),columns:sa})},ca=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(we.a)(new Date(a.passed_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(we.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(ee.a,{type:"Students",type_id:a.group_id},a.group_id)}}],ia=function(){var r,a,n=Object(l.useRef)(),t=Object(Q.b)(),c=t.semester_subject_id,o=Object(ie.k)(),j=Object(l.useMemo)(function(){var p,g,v;return{exam_id:(p=(g=o.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(v=o.query)===null||v===void 0?void 0:v.results}},[(r=o.query)===null||r===void 0?void 0:r.exam_id,(a=o.query)===null||a===void 0?void 0:a.results]),f=j.exam_id,y=j.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(ua,{exam_id:Number(y)}):f!==null?Object(e.jsx)(na,{exam_id:f}):Object(e.jsx)(V.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var p=Object(R.a)(Object(h.a)().mark(function g(v,d){var m,x,O,T;return Object(h.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(m=v.current,x=v.pageSize,c!==null){_.next=3;break}return _.abrupt("return",{data:[],total:0,success:!1});case 3:return O=d&&Object.entries(d)[0],_.next=6,I({per_page:x,page:m,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:O&&O[0],order:O&&(O[1]==="ascend"?"ASC":"DESC")});case 6:if(T=_.sent,!T.success){_.next=9;break}return _.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return _.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return _.stop()}},g)}));return function(g,v){return p.apply(this,arguments)}}(),columns:[].concat(ca,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,v){return[Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?exam_id=").concat(v.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(ce.a,{type:"primary",icon:Object(e.jsx)(ut.a,{})})})},"edit"),Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?results=").concat(v.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(ce.a,{icon:Object(e.jsx)(lt.a,{})})})},"results"),Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(R.a)(Object(h.a)().mark(function d(){var m;return Object(h.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,ye(v.id);case 2:m=O.sent,m.success&&n.current&&n.current.reload();case 4:case"end":return O.stop()}},d)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ce.a,{type:"primary",icon:Object(e.jsx)(ae.a,{}),danger:!0})})},"delete")]}}])})},vt=i("o0Ox"),Cr=i("miYZ"),ct=i("tsqr"),da=i("4KAj");function la(u,r){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},u)})),Ot.apply(this,arguments)}var oa=function(r){var a=r.student_id,n=Object(l.useState)(!1),t=Object(G.a)(n,2),c=t[0],o=t[1],j=Object(l.useCallback)(Object(R.a)(Object(h.a)().mark(function f(){var y;return Object(h.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o(!0),g.next=3,la({user_id:a});case 3:if(y=g.sent,y.success){g.next=8;break}return ct.b.error(y.message),o(!1),g.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),o(!1);case 10:case"end":return g.stop()}},f)})),[]);return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(ce.a,{loading:c,type:"primary",icon:Object(e.jsx)(da.a,{}),onClick:j})})},ja=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ba=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},fa=function(r){return r.reduce(function(a,n){var t,c=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(o,j){return j.academic_teacher_id!==null?o:[].concat(Object(M.a)(o),[{group_id:n.id,group_name:n.name,user_id:j.id,first_name:j.first_name,last_name:j.last_name,email:j.email}])},[]);return[].concat(Object(M.a)(a),Object(M.a)(c))},[])},ma=function(){var r=Object(Q.b)(),a=r.teacherSubjectData,n=Object(l.useMemo)(function(){var t;return ba((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(V.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(R.a)(Object(h.a)().mark(function c(o){var j,f,y,p,g,v,d,m,x;return Object(h.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return j=o.groups,f=o.first_name,y=f===void 0?"":f,p=o.last_name,g=p===void 0?"":p,v=o.email,d=v===void 0?"":v,T.next=3,Object(vt.a)({parent_id:a==null?void 0:a.group_id,"id[]":j});case 3:if(m=T.sent,m.success){T.next=6;break}return T.abrupt("return",{data:[],total:0,success:!1});case 6:return x=fa(m.data).filter(function(C){return C.first_name.toLowerCase().includes(y.toLowerCase())&&C.last_name.toLowerCase().includes(g.toLowerCase())&&C.email.toLowerCase().includes(d.toLowerCase())}),T.abrupt("return",{data:x,total:x.length,success:!0});case 8:case"end":return T.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ja,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,o){return[Object(e.jsx)(oa,{student_id:o.user_id},"teamsChat")]}}])})},tt=i("jrin");function pt(u,r){return ht.apply(this,arguments)}function ht(){return ht=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),ht.apply(this,arguments)}function va(u,r,a,n){return gt.apply(this,arguments)}function gt(){return gt=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(b.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return o.stop()}},u)})),gt.apply(this,arguments)}var Tr=i("DYRE"),Oa=i("zeV3"),Er=i("sRBo"),Rt=i("kaz8");function pa(u){var r,a,n=u===null?de.a.ABSENT:u,t=(r={},Object(tt.a)(r,de.a.PRESENT,{ch1:!0,ch2:!1}),Object(tt.a)(r,de.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(tt.a)(r,de.a.ABSENT,{ch1:!1,ch2:!1}),Object(tt.a)(r,de.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),r);return(a=t[n])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function ha(u){var r,a=u.ch1,n=u.ch2,t="".concat(a,"_").concat(n),c={true_false:de.a.PRESENT,true_true:de.a.PRESENT_NOT_EXERCISING,false_false:de.a.ABSENT,false_true:de.a.EXCUSED_ABSENCE};return(r=c[t])!==null&&r!==void 0?r:de.a.ABSENT}var ga=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.attendance,c=r.onSuccess,o=Object(l.useState)(pa(t)),j=Object(G.a)(o,2),f=j[0],y=j[1],p=Object(l.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],m=Object(l.useRef)(!0),x=Object(l.useCallback)(function(C){d(!0),va(a,n,ha(C)).then(function(_){_.success&&(c==null||c())}).finally(function(){return d(!1)})},[]),O=Object(l.useCallback)(function(C){return y(C.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),T=Object(l.useCallback)(function(C){return y(function(_){return Object(b.a)(Object(b.a)({},_),{},{ch2:C.target.checked})})},[]);return Object(l.useEffect)(function(){if(m.current){m.current=!1;return}x(f)},[f,x]),Object(e.jsxs)(Oa.b,{children:[Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Rt.a,{disabled:v,checked:f.ch1,onChange:O})}),Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:f.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Rt.a,{disabled:v,checked:f.ch2,onChange:T})})]})},xt=ga,xa=function(){var r=Object(Q.b)(),a=r.teacherSubjectData,n=Object(l.useState)([]),t=Object(G.a)(n,2),c=t[0],o=t[1],j=Object(l.useState)(""),f=Object(G.a)(j,2),y=f[0],p=f[1],g=Object(s.l)(),v=Object(l.useRef)(),d=Object(l.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{value:T,label:C}})},[a==null?void 0:a.groups]),m=Object(l.useMemo)(function(){var x;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:d,defaultValue:d==null||(x=d[0])===null||x===void 0?void 0:x.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(M.a)(c))},[d,c]);return Object(e.jsx)(V.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var x=Object(R.a)(Object(h.a)().mark(function O(T){var C,_,K,W,se,Ge,w,D,$,k,$e;return Object(h.a)().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return _=T.group_id,K=_===void 0?d==null||(C=d[0])===null||C===void 0?void 0:C.value:_,W=T.full_name,se=W===void 0?"":W,q.next=3,Promise.all([Object(vt.b)(K),pt(K)]);case 3:if(Ge=q.sent,w=Object(G.a)(Ge,2),D=w[0],$=w[1],k=d.find(function(te){var z=te.value;return z===K}),!(!D.success||!$.success||!k)){q.next=10;break}return q.abrupt("return",{data:[],total:0,success:!1});case 10:if($.data.length){q.next=13;break}return ct.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),q.abrupt("return",{data:[],total:0,success:!1});case 13:return p(k.label),o($.data.reduce(function(te,z){return[].concat(Object(M.a)(te),[{title:String(Object(we.a)(new Date(z.date_from),A.c)),dataIndex:String(z.date_from),hideInSearch:!0,width:100,align:"center",render:function(Ne,he){return Object(e.jsx)(xt,{groupAttendanceScheduleId:z.id,attendance:he["".concat(z==null?void 0:z.date_from)],studentId:he.id})}}])},[])),$e=D.data.users.reduce(function(te,z){var pe=z.id,Ne=z.academic_teacher_id,he=z.first_name,He=z.last_name,Ze="".concat(He," ").concat(he);if(Ne!==null||!Ze.toLowerCase().includes(se.toLowerCase()))return te;var ue=$.data.reduce(function(Y,X){var Z=X.attendances.find(function(oe){return oe.user_id===pe});return Z?Object(b.a)(Object(b.a)({},Y),{},Object(tt.a)({},"".concat(X.date_from),Z.value)):Y},{});return[].concat(Object(M.a)(te),[Object(b.a)({id:pe,full_name:Ze},ue)])},[]).sort(function(te,z){return te.full_name.localeCompare(z.full_name)}),q.abrupt("return",{data:$e,total:$e.length,success:!0});case 17:case"end":return q.stop()}},O)}));return function(O){return x.apply(this,arguments)}}(),columns:m,search:{layout:"vertical"},pagination:{onChange:function(){var O;return(O=v.current)===null||O===void 0?void 0:O.reload()}},scroll:{x:1500},actionRef:v,rowKey:"id"})},Gr=i("tU7J"),Je=i("wFql"),Mr=i("/zsF"),St=i("PArb"),Sa=i("Hn4i"),ya=i("bRQS");function yt(u,r,a){return _t.apply(this,arguments)}function _t(){return _t=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),_t.apply(this,arguments)}function _a(u,r,a,n){return Ct.apply(this,arguments)}function Ct(){return Ct=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"POST",data:n},t||{})));case 1:case"end":return o.stop()}},u)})),Ct.apply(this,arguments)}function Lt(u,r){return Tt.apply(this,arguments)}function Tt(){return Tt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(b.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Tt.apply(this,arguments)}function Ca(u,r,a){return Et.apply(this,arguments)}function Et(){return Et=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),Et.apply(this,arguments)}function Nt(u){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(R.a)(Object(h.a)().mark(function u(r){return Object(h.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},u)})),Gt.apply(this,arguments)}function Ut(u,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Mt.apply(this,arguments)}function Bt(u,r){return It.apply(this,arguments)}function It(){return It=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(b.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},u)})),It.apply(this,arguments)}function Kt(u,r,a){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(b.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return c.stop()}},u)})),Ft.apply(this,arguments)}function Wt(u,r){return $t.apply(this,arguments)}function $t(){return $t=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),$t.apply(this,arguments)}var Ta=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Ea=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(l.useState)([]),c=Object(G.a)(t,2),o=c[0],j=c[1],f=Object(l.useRef)(),y=E.a.useForm(),p=Object(G.a)(y,1),g=p[0];return Object(l.useEffect)(function(){var v,d=((v=a.scale)!==null&&v!==void 0?v:[]).map(function(m,x){return Object(b.a)(Object(b.a)({},m),{},{id:String((x+1)*100)})});g.setFieldValue("table",d)},[]),Object(e.jsx)(E.a,{form:g,onFinish:n,submitter:{render:function(d,m){var x=Object(G.a)(m,2),O=x[1];return[O]}},children:Object(e.jsx)(Sa.a,{name:"table",rowKey:"id",actionRef:f,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Ta,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(d,m){return Object(e.jsx)(ce.a,{type:"primary",onClick:function(){var O;return(O=f.current)===null||O===void 0?void 0:O.startEditable(m.id)},icon:Object(e.jsx)(ut.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:o,saveText:Object(e.jsx)(ce.a,{type:"primary",icon:Object(e.jsx)(ya.a,{})}),onChange:j,actionRender:function(d,m,x){return[x.save]}}})})},Ga=function(){var r,a,n=Object(s.m)("@@initialState"),t=n.initialState,c=Object(Q.b)(),o=c.semester_subject_id,j=c.tutors,f=Object(l.useState)(),y=Object(G.a)(f,2),p=y[0],g=y[1],v=Object(l.useState)(!1),d=Object(G.a)(v,2),m=d[0],x=d[1],O=Object(l.useState)(null),T=Object(G.a)(O,2),C=T[0],_=T[1],K=Object(l.useMemo)(function(){return!!j.data.find(function(w){var D,$=w.id;return $===(t==null||(D=t.currentUser)===null||D===void 0?void 0:D.id)})},[j.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),W=Object(l.useMemo)(function(){return j.data.map(function(w){var D=w.id,$=w.first_name,k=w.last_name;return{label:"".concat($," ").concat(k),value:D}})},[j.data]),se=Object(l.useCallback)(function(){o===null||C===null||(x(!0),g(void 0),yt(o,C).then(function(w){w.success&&g(w.data)}).finally(function(){x(!1)}))},[o,C]),Ge=Object(l.useCallback)(function(w,D){return function(){var $=Object(R.a)(Object(h.a)().mark(function k($e){var ke,q;return Object(h.a)().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(o===null||C===null)){z.next=2;break}return z.abrupt("return");case 2:return ke=w.reduce(function(pe,Ne){return Ne.s_subject_scale_form_id===D?[].concat(Object(M.a)(pe),[{s_subject_scale_form_id:D,scale:$e.table.map(function(he){var He=he.name,Ze=he.grade,ue=he.grade_value;return{name:He,grade:Ze,grade_value:ue}})}]):[].concat(Object(M.a)(pe),[Ne])},[]),z.next=5,_a(o,C,{grade_scale:ke});case 5:q=z.sent,q.success&&se();case 7:case"end":return z.stop()}},k)}));return function(k){return $.apply(this,arguments)}}()},[C,o]);return Object(l.useEffect)(function(){var w,D;if(!K||!(t!=null&&(w=t.currentUser)!==null&&w!==void 0&&w.id)){var $;if(($=j.data)!==null&&$!==void 0&&$[0]){var k;_((k=j.data)===null||k===void 0?void 0:k[0].id)}return}_(t==null||(D=t.currentUser)===null||D===void 0?void 0:D.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,K]),Object(l.useEffect)(function(){se()},[se]),j.loading?Object(e.jsx)(je.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(B.a,{disabled:K,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:W,value:C,onChange:function(D){return _(D)}})}),Object(e.jsx)(St.a,{}),m&&!p&&Object(e.jsx)(je.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(w,D){var $;return Object(e.jsxs)(nt.a.Fragment,{children:[D>0&&Object(e.jsx)(St.a,{}),Object(e.jsx)(Ea,{subjectTutorGradeScale:w,onFormSubmit:Ge(($=p.grade_scale)!==null&&$!==void 0?$:[],w.s_subject_scale_form_id)})]},w.s_subject_scale_form_id)}):Object(e.jsx)(Je.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Ir=i("qbNl"),Ma=i("JBPa"),Fr=i("Awhp"),Ia=i("KrTs"),Fa=i("wd/R"),Qe=i.n(Fa);function $a(u,r){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(b.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Dt.apply(this,arguments)}var $r=i("5R/X"),Da=function(){var r=Object(l.useState)(null),a=Object(G.a)(r,2),n=a[0],t=a[1],c=Object(l.useState)([]),o=Object(G.a)(c,2),j=o[0],f=o[1],y=Object(Q.b)(),p=y.semester_subject_id,g=Qe()(),v=Object(l.useMemo)(function(){return j.map(function(_){return{id:_.id,title:"".concat(_.group.name," (").concat(_.term_status.name,")"),start:Qe()(_.date_from).toDate(),end:Qe()(_.date_to).toDate(),tutor_name:"".concat(_.tutor.first_name," ").concat(_.tutor.last_name),tutor_email:_.tutor.email,semester:_.semester.name,group:_.group.name,subject:_.subject.name,ms_teams_join_url:_.ms_teams_join_url}})},[j]),d=Object(l.useCallback)(function(_,K){$a({semester_subject_id:p,date_form:_.toDate(),date_to:K.toDate()}).then(function(W){W.success&&f(W.data)})},[p]),m=Object(l.useCallback)(function(_){t(_)},[]),x=Object(l.useCallback)(function(){t(null)},[]),O=Object(l.useCallback)(function(_){return _.isSame(g,"day")?"warning":_.isAfter(g,"day")?"success":"error"},[]),T=Object(l.useCallback)(function(_){var K=v.filter(function(W){return Qe()(W.start).isSame(_,"day")});return Object(e.jsx)("ul",{className:"events",children:K.map(function(W){return Object(e.jsx)("li",{onClick:function(){return m(W)},children:Object(e.jsx)(Ia.a,{status:O(Qe()(W.start)),text:W.title})},W.id)})})},[j]),C=Object(l.useCallback)(function(_,K){var W=Qe()(_).startOf(K).subtract(1,"month"),se=Qe()(_).endOf(K).add(1,"month");d(W,se)},[]);return Object(l.useEffect)(function(){var _=Qe()().startOf("month"),K=Qe()().endOf("month");d(_,K)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ma.a,{dateCellRender:T,onPanelChange:C}),Object(e.jsxs)(N.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:x,footer:null,children:[Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&Qe()(n.start).format(A.b)]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",n&&Qe()(n.end).format(A.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(Je.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(ce.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Vt=i("yj/a"),kt=i("5Syx"),ft=i("PpiC"),Pt=i("H6aw"),Pa=i("p3I6"),wa=["results"],Ht=function(r,a){return r.reduce(function(n,t){var c=t.results,o=Object(ft.a)(t,wa),j=c.find(function(f){return f.user_id===a});return j?[].concat(Object(M.a)(n),[Object(b.a)(Object(b.a)({},o),{},{result:j})]):n},[])},zt=function(r,a){var n,t=r.reduce(function(d,m){var x=m.result,O=m.weight;return[d[0]+x.result*O,d[1]+O]},[0,0]),c=Object(G.a)(t,2),o=c[0],j=c[1],f=Number.isNaN(o/j)?0:o/j,y=a.sort(function(d,m){return d.grade_value-m.grade_value}).reduce(function(d,m){return[].concat(Object(M.a)(d),[Object(b.a)(Object(b.a)({},m),{},{isWeightedAverageGreater:f>=m.grade_value})])},[]);if(y.every(function(d){var m=d.isWeightedAverageGreater;return m})){var p,g;return(p=(g=y.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var v=y.findIndex(function(d){var m=d.isWeightedAverageGreater;return!m});return v<0?"":(n=y[v-1])===null||n===void 0?void 0:n.name},Jt=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Aa=["attendances"];function Ra(u){return function(a){u(function(n){return Object(b.a)(Object(b.a)({},n),{},{loading:a})})}}function Yt(u,r){return wt.apply(this,arguments)}function wt(){return wt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r(!0),t.prev=1,t.abrupt("return",a());case 3:return t.prev=3,r(!1),t.finish(3);case 6:case"end":return t.stop()}},u,null,[[1,,3,6]])})),wt.apply(this,arguments)}function La(u,r){var a=Object(l.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],o=Object(l.useCallback)(Ra(c),[]),j=Object(l.useCallback)(Object(R.a)(Object(h.a)().mark(function y(){var p;return Object(h.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,Ca(u,r);case 2:if(p=v.sent,p.success){v.next=5;break}return v.abrupt("return",p);case 5:return c(function(d){return Object(b.a)(Object(b.a)({},d),{},{data:p.data})}),v.abrupt("return",p);case 7:case"end":return v.stop()}},y)})),[r,u]),f=Object(l.useCallback)(function(y){return Yt(o,function(){return Wt(y).then(j)})},[j]);return Object(l.useEffect)(function(){Yt(o,j)},[j]),{finalGrades:t,deleteFinalGrade:f}}function Na(){var u=Object(l.useState)({loading:!1}),r=Object(G.a)(u,2),a=r[0],n=r[1];return Object(l.useEffect)(function(){n(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!0})}),Nt().then(function(t){t.success&&n(function(c){return Object(b.a)(Object(b.a)({},c),{},{data:t.data})})}).finally(function(){n(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function Ua(u){var r=Object(l.useState)({loading:!1}),a=Object(G.a)(r,2),n=a[0],t=a[1];return Object(l.useEffect)(function(){u!==void 0&&(t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!0})}),Ut(u).then(function(c){c.success&&t(function(o){return Object(b.a)(Object(b.a)({},o),{},{data:c.data})})}).finally(function(){t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!1})})}))},[u]),{subjectGradeScales:n}}function Ba(u,r,a){var n=Object(l.useState)({loading:!1}),t=Object(G.a)(n,2),c=t[0],o=t[1];return Object(l.useEffect)(function(){typeof u!="number"||typeof r!="number"||typeof a!="number"||(o(function(j){return Object(b.a)(Object(b.a)({},j),{},{loading:!0})}),yt(u,r).then(function(j){j.success&&o(function(f){var y,p;return Object(b.a)(Object(b.a)({},f),{},{data:(y=Jt(a,(p=j.data.grade_scale)!==null&&p!==void 0?p:[]))===null||y===void 0?void 0:y.map(function(g,v){return Object(b.a)(Object(b.a)({},g),{},{id:v})})})})}).finally(function(){o(function(j){return Object(b.a)(Object(b.a)({},j),{},{loading:!1})})}))},[u,r]),{tutorGradeScales:c}}function Ka(u,r){var a=Object(l.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],o=Object(l.useCallback)(function(){c(function(j){return Object(b.a)(Object(b.a)({},j),{},{loading:!0})}),pt(u).then(function(j){if(j.success){var f=j.data.reduce(function(y,p){var g=p.attendances,v=Object(ft.a)(p,Aa),d=g.find(function(m){return m.user_id===r});return d?[].concat(Object(M.a)(y),[Object(b.a)(Object(b.a)({},v),{},{attendance:d})]):y},[]);c(function(y){return Object(b.a)(Object(b.a)({},y),{},{data:f})})}}).finally(function(){c(function(j){return Object(b.a)(Object(b.a)({},j),{},{loading:!1})})})},[u,r]);return Object(l.useEffect)(function(){o()},[o]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:o}}function Wa(u,r){var a=Object(l.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1];return Object(l.useEffect)(function(){!r||(c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),I({student_id:u,semester_subject_id:r}).then(function(o){if(o.success){var j=Ht(o.data,u);c(function(f){return Object(b.a)(Object(b.a)({},f),{},{data:j})})}}).finally(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})}))},[u,r]),{studentExams:t}}function Va(u,r){var a=Object(l.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],o=Object(l.useState)({loading:!1}),j=Object(G.a)(o,2),f=j[0],y=j[1],p=Object(l.useState)({loading:!1}),g=Object(G.a)(p,2),v=g[0],d=g[1];return Object(l.useEffect)(function(){c(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!0})}),Object(Pt.e)({group_id:u}).then(function(m){m.success&&c(function(x){return Object(b.a)(Object(b.a)({},x),{},{data:m.data})})}).finally(function(){c(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!1})})})},[u]),Object(l.useEffect)(function(){!t.data||(d(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!0})}),Promise.all(t.data.map(function(m){var x=m.id;return Object(Pt.n)(Number(x))})).then(function(m){m.forEach(function(x){x.success&&d(function(O){return Object(b.a)(Object(b.a)({},O),{},{data:Object(b.a)(Object(b.a)({},O.data),{},Object(tt.a)({},Number(x.data.id),Object(Pa.c)(x.data.lessons)))})})})}).finally(function(){d(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!1})})}),y(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!0})}),Promise.all(t.data.map(function(m){var x=m.id;return Object(Pt.l)(Number(x),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(O){if(O.success){var T,C,_=((T=O.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&T!==void 0?T:[]).filter(function(W){return W.id===r}),K=(C=O.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&C!==void 0?C:[];y(function(W){return Object(b.a)(Object(b.a)({},W),{},{data:Object(b.a)(Object(b.a)({},W.data),{},Object(tt.a)({},Number(x),{finishedTopics:_,attendanceList:K}))})})}})})).finally(function(){return y(function(m){return Object(b.a)(Object(b.a)({},m),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:f,userCoursesTopics:v}}var ka=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ha=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(we.a)(new Date(a.date_from),A.c)}}],za=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(we.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],Ja=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(we.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),A.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],mt=6,Ya=function(r){var a,n,t,c,o=r.user_id,j=r.group_id,f=Object(Q.b)(),y=f.semester_subject_id,p=Wa(o,y),g=p.studentExams,v=La(j,o),d=v.finalGrades,m=v.deleteFinalGrade,x=Na(),O=x.gradeTerms,T=Ua((a=d.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),C=T.subjectGradeScales,_=Ba(y,(n=d.data)===null||n===void 0?void 0:n.tutor_id,(t=d.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),K=_.tutorGradeScales,W=Ka(j,o),se=W.userAttendanceSchedules,Ge=W.fetchUserAttendanceSchedules,w=Va(j,o),D=w.userCourses,$=w.userCoursesStats,k=w.userCoursesTopics,$e=E.a.useForm(),ke=Object(G.a)($e,1),q=ke[0],te=Object(l.useMemo)(function(){var Y;return((Y=O.data)!==null&&Y!==void 0?Y:[]).map(function(X){var Z=X.id,oe=X.name;return{label:oe,value:Z}})},[O.data]),z=Object(l.useMemo)(function(){var Y;return((Y=C.data)!==null&&Y!==void 0?Y:[]).map(function(X){var Z=X.name,oe=X.id;return{label:Z,value:oe}})},[C.data]),pe=Object(l.useMemo)(function(){var Y,X;return zt((Y=g.data)!==null&&Y!==void 0?Y:[],(X=K.data)!==null&&X!==void 0?X:[])},[g.data,K.data]),Ne=Object(l.useCallback)(function(){var Y=Object(R.a)(Object(h.a)().mark(function X(Z){var oe,Ue,rt,me,Be,Me,Ke;return Object(h.a)().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(rt=Z.grade_scale_id,me=Z.grade_term_id,((oe=d.data)===null||oe===void 0?void 0:oe.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(Be=(Ue=d.data)===null||Ue===void 0?void 0:Ue.grades.find(function(dt){var At=dt.grade_term;return At.id===me}),!Be){Re.next=11;break}return Re.next=7,Kt(Be.id,{grade_scale_id:rt});case 7:return Me=Re.sent,ct.b[Me.success?"success":"error"](Me.message),Me.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,Bt({grade_scale_id:rt,grade_term_id:me,lesson_group_user_id:d.data.id});case 13:Ke=Re.sent,ct.b[Ke.success?"success":"error"](Ke.message),Ke.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades"));case 16:case"end":return Re.stop()}},X)}));return function(X){return Y.apply(this,arguments)}}(),[d.data,y]),he=Object(l.useMemo)(function(){return[].concat(Ja,[{title:Object(e.jsx)(s.a,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(X,Z){var oe;return typeof(Z==null||(oe=Z.grade)===null||oe===void 0?void 0:oe.id)=="number"?[Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return m(Z.grade.id)},okText:Object(e.jsx)(s.a,{id:"yes",defaultMessage:"Yes"}),cancelText:Object(e.jsx)(s.a,{id:"no",defaultMessage:"No"}),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ce.a,{type:"primary",icon:Object(e.jsx)(ae.a,{}),danger:!0})})},"delete")]:[]}}])},[]),He=Object(l.useMemo)(function(){var Y;return((Y=O.data)!==null&&Y!==void 0?Y:[]).map(function(X){var Z;return Object(b.a)(Object(b.a)({},X),{},{grade:(Z=d.data)===null||Z===void 0?void 0:Z.grades.find(function(oe){var Ue=oe.grade_term;return Ue.id===X.id})})})},[d.data,O.data]),Ze=D.loading&&!D.data||$.loading&&!$.data||k.loading&&!k.data,ue=Boolean(D.data&&$.data&&k.data);return d.loading?Object(e.jsx)(je.a,{}):Object(e.jsxs)(e.Fragment,{children:[d.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:d.data.user})}),Object(e.jsx)(St.a,{})]}),Object(e.jsxs)(ne.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(V.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:mt},dataSource:g.data,loading:g.loading,columns:za,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(V.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:mt},dataSource:He,loading:d.loading||O.loading,columns:he,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(V.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:se.data,loading:se.loading,columns:[].concat(Ha,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(X,Z){return Object(e.jsx)(xt,{groupAttendanceScheduleId:Z.id,studentId:o,attendance:Z.attendance.value,onSuccess:Ge})}}])})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(V.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:K.data,loading:K.loading,columns:ka})}),Ze&&Object(e.jsx)(je.a,{}),ue&&((c=D.data)===null||c===void 0?void 0:c.map(function(Y){var X,Z,oe,Ue,rt,me,Be,Me,Ke=Y.id,it=Y.title;return Object(e.jsxs)(L.a,{span:24,children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:it}),Object(e.jsx)(kt.c,{course_id:Number(Ke),topics:(X=(Z=k.data)===null||Z===void 0?void 0:Z[Number(Ke)])!==null&&X!==void 0?X:[],stats:(oe=(Ue=$.data)===null||Ue===void 0||(rt=Ue[Number(Ke)])===null||rt===void 0?void 0:rt.finishedTopics)!==null&&oe!==void 0?oe:[]}),Object(e.jsx)(kt.a,{stats:(me=(Be=$.data)===null||Be===void 0||(Me=Be[Number(Ke)])===null||Me===void 0?void 0:Me.attendanceList)!==null&&me!==void 0?me:[]})]},Ke)}))]}),Object(e.jsx)(E.a,{form:q,onFinish:Ne,children:Object(e.jsxs)(E.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Vt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:te,width:"sm",fieldProps:{loading:O.loading}}),Object(e.jsx)(Vt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:z,fieldProps:{loading:d.loading||C.loading}}),Object(e.jsx)(E.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:pe}})})]})})]})},Xa=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,c=n.grade_term,o=n.id;return Object(e.jsxs)(Je.a.Text,{children:[c.name,": ",t]},o)}):"-"})}}],Qa=function(){var r,a,n=Object(ie.k)(),t=Object(l.useMemo)(function(){var g,v,d,m;return{user_id:Number.isNaN(Number((g=n.query)===null||g===void 0?void 0:g.user_id))?null:Number((v=n.query)===null||v===void 0?void 0:v.user_id),group_id:Number.isNaN(Number((d=n.query)===null||d===void 0?void 0:d.group_id))?null:Number((m=n.query)===null||m===void 0?void 0:m.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,o=t.group_id,j=Object(Q.b)(),f=j.teacherSubjectData,y=j.semester_subject_id,p=Object(l.useMemo)(function(){var g;return((g=f==null?void 0:f.groups)!==null&&g!==void 0?g:[]).map(function(v){var d=v.id,m=v.name;return{label:m,value:d}})},[f==null?void 0:f.groups]);return c!==null&&o!==null?Object(e.jsx)(Ya,{user_id:c,group_id:o}):Object(e.jsx)(V.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var g=Object(R.a)(Object(h.a)().mark(function v(d){var m,x,O,T,C,_,K,W,se,Ge;return Object(h.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return x=d.group_id,O=x===void 0?[]:x,T=d.first_name,C=T===void 0?"":T,_=d.last_name,K=_===void 0?"":_,W=((m=f==null?void 0:f.groups)!==null&&m!==void 0?m:[]).map(function($){var k=$.id;return k}),D.next=4,Lt(O.length===0?W:O);case 4:if(se=D.sent,se.success){D.next=7;break}return D.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ge=se.data.filter(function($){var k=$.user;return k.first_name.toLowerCase().includes(C.toLowerCase())&&k.last_name.toLowerCase().includes(K.toLowerCase())}),D.abrupt("return",{success:!0,total:Ge.length,data:Ge});case 9:case"end":return D.stop()}},v)}));return function(v){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(v,d){return Object(e.jsx)(ee.a,{type:"Students",type_id:d.group_id},d.group_id)}}].concat(Xa,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(v,d){return[Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(d.user.id,"&group_id=").concat(d.group_id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(ce.a,{type:"primary",icon:Object(e.jsx)(ut.a,{})})})},"edit")]}}])})},Za=i("dF/Y"),qa=i("o+0V"),Xt=i("0WSk"),er=["type","defaultRender"],tr=["type","defaultRender"],ar=function(r){var a=r.url;return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(ce.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Za.a,{})})})},rr=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(we.a)(new Date(a.created_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,o=Object(ft.a)(a,er);if(t==="form")return null;var j=n.getFieldValue("state");return Object(e.jsx)(Xt.a,Object(b.a)(Object(b.a)({},o),{},{state:{type:j}}))},render:function(r,a){return Object(e.jsx)(ee.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(we.a)(new Date(a.exported_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,o=Object(ft.a)(a,tr);if(t==="form")return null;var j=n.getFieldValue("state");return Object(e.jsx)(Xt.a,Object(b.a)(Object(b.a)({},o),{},{state:{type:j}}))},render:function(r,a){return Object(e.jsx)(ee.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(ar,{url:a.url},"download")]}}],nr=function(){var r,a,n=Object(Q.b)(),t=n.teacherSubjectData,c=Object(l.useMemo)(function(){var j;return((j=t==null?void 0:t.groups)!==null&&j!==void 0?j:[]).map(function(f){var y=f.id,p=f.name;return{value:y,label:p}})},[t==null?void 0:t.groups]),o=Object(l.useMemo)(function(){var j,f;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(j=t.groups)===null||j===void 0||(f=j[0])===null||f===void 0?void 0:f.id,allowClear:!1}}].concat(rr)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(V.a,{className:"table-standalone",request:function(){var j=Object(R.a)(Object(h.a)().mark(function f(y){var p,g,v,d,m,x,O;return Object(h.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=y.group_id,d=v===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:v,m=y.created_by,x=y.exported_by,C.next=3,Object(qa.a)({group_id:d,created_by:m,exported_by:x});case 3:if(O=C.sent,O.success){C.next=6;break}return C.abrupt("return",{success:!1,data:[],total:0});case 6:return C.abrupt("return",{success:!0,data:O.data,total:O.data.length});case 7:case"end":return C.stop()}},f)}));return function(f){return j.apply(this,arguments)}}(),columns:o,search:{layout:"vertical"},scroll:{x:1500}})},sr=function(r,a){var n;return(n=r.find(function(t){return t.name===a}))===null||n===void 0?void 0:n.id},ur=function(r){var a=r.term,n=r.gradeScales,t=r.defaultFinalGrade,c=r.finalGrades,o=Object(l.useState)(t),j=Object(G.a)(o,2),f=j[0],y=j[1],p=Object(l.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],m=Object(l.useMemo)(function(){return n.map(function(O){var T=O.name,C=O.id;return{value:C,label:T}})},[n]),x=Object(l.useCallback)(function(O){if(!!(c!=null&&c.id)){if(O===void 0){if(!f)return;d(!0),Wt(f.id).then(function(T){!T.success||y(void 0)}).finally(function(){return d(!1)});return}if(f){d(!0),Kt(f.id,{grade_scale_id:O}).finally(function(){return d(!1)});return}d(!0),Bt({grade_term_id:a.id,grade_scale_id:O,lesson_group_user_id:c.id}).then(function(T){if(T.success){var C=T.data.grades.find(function(_){return _.grade_term.id===a.id});y(C)}}).finally(function(){return d(!1)})}},[f,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(B.a,{allowClear:!0,loading:v,disabled:v,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:x,options:m,defaultValue:sr(n,t==null?void 0:t.grade_name)}):null},cr=i("LvDl"),ir=function(r){var a=r.exam_id,n=r.result,t=r.student_id,c=r.onSuccess,o=Object(l.useCallback)(Object(cr.debounce)(function(j){Ee(a,t,{result:j!=null?j:0}).then(function(f){f.success&&(c==null||c(f.data))})},300),[a,n,t]);return Object(e.jsx)(Le.a,{type:"number",min:0,max:100,onChange:o,defaultValue:n})},dr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(M.a)(n),[{title:Object(we.a)(new Date(t.date_from),A.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(o,j){return Object(e.jsx)(xt,{groupAttendanceScheduleId:t.id,attendance:j["attendance-".concat(t==null?void 0:t.date_from)],studentId:j.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},lr=function(r,a){return r.reduce(function(n,t){var c=t.attendances.find(function(o){return o.user_id===a});return c?Object(b.a)(Object(b.a)({},n),{},Object(tt.a)({},"attendance-".concat(t.date_from),c.value)):n},{})},or=function(r){var a=r.reduce(function(n,t){return[].concat(Object(M.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(o,j){var f;return(j==null||(f=j["exam-".concat(t.id)])===null||f===void 0?void 0:f.result)!==void 0?Object(e.jsx)(ir,{result:j==null?void 0:j["exam-".concat(t.id)].result,exam_id:t.id,student_id:j.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},jr=function(r){return r.reduce(function(a,n){var t=n.result,c=n.id;return Object(b.a)(Object(b.a)({},a),{},Object(tt.a)({},"exam-".concat(c),t))},{})},br=function(r,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(c,o){return Object(e.jsx)(ur,{defaultFinalGrade:o["final-grade-".concat(n.id)],finalGrades:o.final_grades,term:n,gradeScales:a})}}})}},fr=function(r,a){return r.find(function(n){return n.user.id===a})},mr=function(r){var a;return((a=r==null?void 0:r.grades)!==null&&a!==void 0?a:[]).reduce(function(n,t){return Object(b.a)(Object(b.a)({},n),{},Object(tt.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},vr=function(){var r,a,n=Object(Q.b)(),t=n.teacherSubjectData,c=n.semester_subject_id,o=Object(l.useState)([]),j=Object(G.a)(o,2),f=j[0],y=j[1],p=Object(l.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),g=Object(G.a)(p,2),v=g[0],d=g[1],m=Object(s.l)(),x=Object(l.useMemo)(function(){var C;return((C=t==null?void 0:t.groups)!==null&&C!==void 0?C:[]).map(function(_){var K=_.id,W=_.name;return{value:K,label:W}})},[t==null?void 0:t.groups]),O=Object(l.useRef)(),T=Object(l.useMemo)(function(){var C;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:x,defaultValue:x==null||(C=x[0])===null||C===void 0?void 0:C.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(M.a)(f))},[x,f]);return Object(e.jsx)(V.a,{className:"table-standalone",request:function(){var C=Object(R.a)(Object(h.a)().mark(function _(K){var W,se,Ge,w,D,$,k,$e,ke,q,te,z,pe,Ne,he,He,Ze,ue,Y,X,Z,oe,Ue;return Object(h.a)().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return $=K.group_id,k=$===void 0?(W=x[0])===null||W===void 0?void 0:W.value:$,$e=K.full_name,ke=$e===void 0?"":$e,me.next=3,Lt(k);case 3:if(q=me.sent,te=x.find(function(Be){var Me=Be.value;return Me===k}),!(!q.success||q.data[0]===void 0||c===null)){me.next=8;break}return ct.b.error(m.formatMessage({id:"groupDataMissing"},{group_name:te==null?void 0:te.label})),me.abrupt("return",{data:[],total:0,success:!1});case 8:return me.next=10,Promise.all([Object(vt.b)(k),pt(k),I({group_id:k,per_page:-1}),yt(c,(se=q.data)===null||se===void 0||(Ge=se[0])===null||Ge===void 0?void 0:Ge.tutor_id),Nt(),Ut((w=q.data)===null||w===void 0||(D=w[0])===null||D===void 0?void 0:D.s_subject_scale_form_id)]);case 10:if(z=me.sent,pe=Object(G.a)(z,6),Ne=pe[0],he=pe[1],He=pe[2],Ze=pe[3],ue=pe[4],Y=pe[5],!(!Ne.success||!he.success||!He.success||!Ze.success||!ue.success||!Y.success||!te)){me.next=21;break}return ct.b.error(m.formatMessage({id:"groupDataMissing"},{group_name:te==null?void 0:te.label})),me.abrupt("return",{data:[],total:0,success:!1});case 21:return d(te.label),X=dr(he.data),Z=or(He.data),oe=br(ue.data,Y.data),y([X,Z,oe,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Ue=Ne.data.users.reduce(function(Be,Me){var Ke,it,Re,dt=Me.id,At=Me.academic_teacher_id,pr=Me.first_name,hr=Me.last_name,Qt="".concat(hr," ").concat(pr);if(At!==null||!Qt.toLowerCase().includes(ke.toLowerCase()))return Be;var gr=lr(he.data,dt),Zt=Ht(He.data,dt),ot=fr(q.data,dt),xr=(Ke=Jt((it=ot==null?void 0:ot.s_subject_scale_form_id)!==null&&it!==void 0?it:0,(Re=Ze.data.grade_scale)!==null&&Re!==void 0?Re:[]))!==null&&Ke!==void 0?Ke:[],Sr=zt(Zt,xr),yr=jr(Zt),_r=mr(ot);return[].concat(Object(M.a)(Be),[Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({id:dt,full_name:Qt},gr),yr),_r),{},{proposed_grade:Sr,final_grades:ot})])},[]).sort(function(Be,Me){return Be.full_name.localeCompare(Me.full_name)}),me.abrupt("return",{data:Ue,total:Ue.length,success:!0});case 28:case"end":return me.stop()}},_)}));return function(_){return C.apply(this,arguments)}}(),columns:T,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:v}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:O,pagination:{onChange:function(){var _;return(_=O.current)===null||_===void 0?void 0:_.reload()}},rowKey:"id"})},Or=function(r){var a,n,t=r.tab,c=Object(s.l)(),o=Object(s.m)("@@initialState"),j=o.setInitialState,f=o.initialState,y=Object(Q.b)(),p=y.teacherSubjectData,g=y.semester_subject_id,v=y.tutors,d=Object(l.useCallback)(Object(Ce.a)(f==null?void 0:f.currentUser),[f==null?void 0:f.currentUser]),m=Object(l.useMemo)(function(){return!!v.data.find(function(x){var O,T=x.id;return T===(f==null||(O=f.currentUser)===null||O===void 0?void 0:O.id)})||d(Ye.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(ve.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(qe.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(ce.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(g),breadcrumbName:String((n=p.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(le.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(O){j(Object(b.a)({},f)),s.f.push("/teacher/subjects/".concat(g,"/").concat(O))}},children:[Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(ge.a,{})},"groups"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(ma,{})},"students"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(ia,{})},"exams"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Da,{})},"schedule"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(vr,{})},"class-register"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(xa,{})},"attendance"),m&&Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(Ga,{})},"grades-scale"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Qa,{})},"final-grades"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(nr,{})},"file-exports-history")]})}):Object(e.jsx)(je.a,{})},Dr=De.default=function(){var u=Object(ie.l)(),r=u.subjectId,a=u.tab,n=a===void 0?"groups":a;return Object(e.jsx)(Q.a,{semester_subject_id:Number(r),children:Object(e.jsx)(Or,{tab:n})})}},p3I6:function(jt,De,i){"use strict";i.d(De,"b",function(){return Ce}),i.d(De,"c",function(){return Pe}),i.d(De,"a",function(){return lt});var b=i("miYZ"),Ie=i("tsqr"),ce=i("tJVT"),F=i("k1fw"),je=i("oBTY"),l=i("q1tI"),nt=i.n(l),s=i("9kvl"),qe=i("Ty5D"),ie=i("H6aw"),le=i("/y+f"),ve=i("nKUr"),Ye=i.n(ve),Ce=nt.a.createContext({}),Q=function(){return Math.round(Math.random()*99999)},ge=function ae(V){return V.reduce(function(A,I){return[].concat(Object(je.a)(A),Object(je.a)(I.lessons?ae(I.lessons):[]),[I])},[])},Pe=function ae(V){return V.reduce(function(A,I){var S;return[].concat(Object(je.a)(A),Object(je.a)(I.lessons?ae(I.lessons):[]),Object(je.a)((S=I.topics)!==null&&S!==void 0?S:[]))},[])},st=function ae(V,A,I){return V.map(function(S){var xe,J;return Object(F.a)(Object(F.a)({},S),{},{lessons:S.lessons?ae(S.lessons,A,I):[],topics:S.id===A?[].concat(Object(je.a)((xe=S.topics)!==null&&xe!==void 0?xe:[]),[I]):(J=S.topics)!==null&&J!==void 0?J:[]})})},bt=function ae(V,A,I){return I?V.map(function(S){return Object(F.a)(Object(F.a)({},S),{},{lessons:[].concat(Object(je.a)(S.lessons?ae(S.lessons,A,I):[]),Object(je.a)(S.id===I?[A]:[]))})}):[].concat(Object(je.a)(V),[A])},We=function ae(V,A,I){return V.map(function(S){return Object(F.a)(Object(F.a)({},S.id===A?I:S),{},{lessons:S.lessons?ae(S.lessons,A,I):[]})})},h=function ae(V,A){return V.map(function(I){return Object(F.a)(Object(F.a)({},I),{},{parent_id:A,lessons:I.lessons?ae(I.lessons,I.id):[]})})},R=function ae(V,A){return V.filter(function(I){return I.id!==A}).map(function(I){return Object(F.a)(Object(F.a)({},I),{},{lessons:I.lessons?ae(I.lessons,A):[]})})},we=function ae(V,A){return V.map(function(I){return Object(F.a)(Object(F.a)({},I),{},{lessons:I.lessons?ae(I.lessons,A):[],topics:I.topics?I.topics.filter(function(S){return S.id!==A}):[]})})},ut=function ae(V,A,I,S){return S==null?void 0:S.map(function(xe){if(xe.id===I){var J;return Object(F.a)(Object(F.a)({},xe),{},{topics:(J=xe.topics)===null||J===void 0?void 0:J.map(function(Se){return Se.id===V?A.file.response.data:Se})})}else if(xe.lessons)return Object(F.a)(Object(F.a)({},xe),{},{lessons:ae(V,A,I,xe.lessons||[])});return xe})},lt=function(V){var A=V.children,I=V.id,S=Object(l.useState)(),xe=Object(ce.a)(S,2),J=xe[0],Se=xe[1],at=Object(s.l)(),et=Object(l.useMemo)(function(){return J&&J.lessons?Pe(J.lessons):[]},[J]),Te=Object(l.useMemo)(function(){return J&&J.lessons?ge(J.lessons):[]},[J]),ye=Object(l.useState)([]),_e=Object(ce.a)(ye,2),Ee=_e[0],Fe=_e[1],Oe=Object(qe.k)();Object(l.useEffect)(function(){Fe([])},[]);var re=Object(l.useCallback)(function(){Object(ie.n)(I).then(function(P){return P.success&&Se(Object(F.a)(Object(F.a)({},P.data),{},{lessons:h(P.data.lessons)}))})},[I]);Object(l.useEffect)(function(){re()},[re]);var ee=Object(l.useCallback)(function(P){var N=Te.find(function(M){var U;return M==null||(U=M.topics)===null||U===void 0?void 0:U.find(function(B){return B.id===P})});return N?N.id:null},[Te]),ze=Object(l.useMemo)(function(){var P,N;return(P=Oe.query)!==null&&P!==void 0&&P.lesson?{mode:"lesson",id:Number(Oe.query.lesson),value:Te.find(function(M){return M.id===Number(Oe.query.lesson)})}:(N=Oe.query)!==null&&N!==void 0&&N.topic?{mode:"topic",id:Number(Oe.query.topic),value:et.find(function(M){return M.id===Number(Oe.query.topic)})}:{mode:"init"}},[Oe.query,J,Te,et]),Le=Object(l.useCallback)(function(P){var N={course_id:I,topics:[],isNew:!0,id:J?J.lessons.length+1:Q(),order:0,title:at.formatMessage({id:"add_title_here"}),active:!0,parent_id:P};return Se(function(M){var U;return Object(F.a)(Object(F.a)({},M),{},{lessons:bt((U=M==null?void 0:M.lessons)!==null&&U!==void 0?U:[],N,P)})}),N},[I,J]),G=Object(l.useCallback)(function(P,N){var M=Te.find(function(B){return B.id===P}),U=M&&M.isNew;return(U?Object(ie.g)(N):Object(ie.v)(P,N)).then(function(B){return Ie.b.success(B.message),re(),B.success&&Se(function(H){var e;return Object(F.a)(Object(F.a)({},H),{},{lessons:We((e=H==null?void 0:H.lessons)!==null&&e!==void 0?e:[],P,Object(F.a)(Object(F.a)({},B.data),{},{isNew:!1}))})})})},[J]),be=Object(l.useCallback)(function(P){var N=Te.find(function(U){return U.id===P});if(!!N){var M=N.isNew;M?Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:R((B=U==null?void 0:U.lessons)!==null&&B!==void 0?B:[],P)})}):Object(ie.p)(P).then(function(U){U.success&&(Ie.b.success(U.message),Se(function(B){var H;return Object(F.a)(Object(F.a)({},B),{},{lessons:R((H=B==null?void 0:B.lessons)!==null&&H!==void 0?H:[],P)})}))})}},[J]),ne=Object(l.useCallback)(function(P,N){var M,U=ee(P),B=Te.find(function(Ve){return Ve.id===U}),H=B&&((M=B.topics)===null||M===void 0?void 0:M.find(function(Ve){return Ve.id===P})),e=H==null?void 0:H.isNew;return(e?Object(ie.h)(N):Object(ie.w)(P,N)).then(function(Ve){Ve.success&&(Ie.b.success(Ve.message),re(),s.f.push("/courses/list/".concat(I,"/program/?topic=").concat(Ve.data.id)),(H==null?void 0:H.topicable_type)===le.j.Video&&setTimeout(function(){re()},5e3))})},[ee,J,re]),fe=Object(l.useCallback)(function(P){var N=ee(P),M=Te.find(function(H){return H.id===N});if(!!M){var U=et==null?void 0:et.find(function(H){return H.id===P}),B=U==null?void 0:U.isNew;B&&!U.topicable?Se(function(H){var e;return Object(F.a)(Object(F.a)({},H),{},{lessons:we((e=H==null?void 0:H.lessons)!==null&&e!==void 0?e:[],P)})}):Object(ie.q)(P).then(function(H){H.success&&(Ie.b.success(H.message),Se(function(e){var Ve;return Object(F.a)(Object(F.a)({},e),{},{lessons:we((Ve=e==null?void 0:e.lessons)!==null&&Ve!==void 0?Ve:[],P)})}))})}},[J,ee]),L=Object(l.useCallback)(function(P,N){var M={lesson_id:P,isNew:!0,id:Q(),title:at.formatMessage({id:"add_title_here"}),active:!0,topicable_type:N};return Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:st((B=U==null?void 0:U.lessons)!==null&&B!==void 0?B:[],P,M)})}),M},[]),E=function(N,M){var U=ee(N);Se(function(B){return Object(F.a)(Object(F.a)({},B),{},{lessons:B?ut(N,M,U,B.lessons||[]):[]})}),s.f.push("/courses/list/".concat(I,"/program/?topic=").concat(M.file.response.data.id))},Ae=Object(l.useCallback)(function(P){return Object(ie.d)(P).then(function(N){if(N.success){Ie.b.success(N.message);var M=ee(P);Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:U?(B=U.lessons)===null||B===void 0?void 0:B.map(function(H){if(H.id===M){var e=H.topics||[];return Object(F.a)(Object(F.a)({},H),{},{topics:[].concat(Object(je.a)(e),[N.data])})}return H}):[]})})}})},[J,ee]),Xe=Object(l.useCallback)(function(P){return Object(ie.c)(P).then(function(N){N.success&&(Ie.b.success(N.message),Se(function(M){return Object(F.a)(Object(F.a)({},M),{},{lessons:M?[].concat(Object(je.a)(M.lessons),[N.data]):[]})}))})},[]),de={state:J,h5ps:Ee,id:I,addNewLesson:Le,updateLesson:G,updateTopic:ne,deleteLesson:be,addNewTopic:L,deleteTopic:fe,onTopicUploaded:E,cloneTopic:Ae,cloneLesson:Xe,currentEditMode:ze,getLessons:re};return Object(ve.jsx)(Ce.Provider,{value:de,children:A})}},"w/VK":function(jt,De,i){"use strict";i.d(De,"c",function(){return je}),i.d(De,"a",function(){return nt}),i.d(De,"b",function(){return qe});var b=i("qLMh"),Ie=i("k1fw"),ce=i("9og8"),F=i("9kvl");function je(le,ve){return l.apply(this,arguments)}function l(){return l=Object(ce.a)(Object(b.a)().mark(function le(ve,Ye){return Object(b.a)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.abrupt("return",Object(F.i)("/api/admin/reports/report",Object(Ie.a)({params:ve,method:"GET",useCache:!1},Ye||{})));case 1:case"end":return Q.stop()}},le)})),l.apply(this,arguments)}function nt(le,ve,Ye){return s.apply(this,arguments)}function s(){return s=Object(ce.a)(Object(b.a)().mark(function le(ve,Ye,Ce){return Object(b.a)().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.abrupt("return",Object(F.i)("/api/admin/stats/course/".concat(ve,"/export"),Object(Ie.a)({params:Ye,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ce||{})));case 1:case"end":return ge.stop()}},le)})),s.apply(this,arguments)}function qe(le,ve,Ye){return ie.apply(this,arguments)}function ie(){return ie=Object(ce.a)(Object(b.a)().mark(function le(ve,Ye,Ce){return Object(b.a)().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.abrupt("return",Object(F.i)("/api/admin/stats/topic/".concat(ve,"/export"),Object(Ie.a)({method:"GET",useCache:!1,params:{stat:Ye},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ce||{})));case 1:case"end":return ge.stop()}},le)})),ie.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.60fe5ece.async.js.map