(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(bt,we,i){},"5Syx":function(bt,we,i){"use strict";i.d(we,"c",function(){return _e}),i.d(we,"b",function(){return at}),i.d(we,"a",function(){return tt});var b=i("OaEy"),$e=i("2fM7"),re=i("g9YV"),I=i("wCAj"),me=i("14J3"),j=i("BMrR"),nt=i("BoS7"),s=i("Sdc0"),et=i("jrin"),oe=i("k1fw"),je=i("DYRE"),pe=i("zeV3"),Xe=i("+BJd"),Ee=i("mr32"),Z=i("oBTY"),Se=i("tJVT"),Ae=i("q1tI"),st=i.n(Ae),mt=i("nhC9"),Ue=i("LDJE"),h=i("9kvl"),R=i("nz6D"),Re=i("Vpfc"),ut=i("+L6B"),ot=i("2/Rp"),ue=i("qLMh"),W=i("9og8"),A=i("4KAj"),M=i("w/VK"),S=i("nKUr"),ye=function(Ce){var Te=Ce.course_id,Me=Ce.stat,De=Me===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Me,he=Object(Ae.useState)(!1),ce=Object(Se.a)(he,2),ne=ce[0],Je=ce[1],Be=Object(Ae.useCallback)(function(G){return Object(W.a)(Object(ue.a)().mark(function fe(){var ie,ve;return Object(ue.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return Je(!0),E.prev=1,E.next=4,Object(M.a)(G,{stat:De});case 4:ie=E.sent,ie instanceof Blob&&(ve=document.createElement("a"),ve.href=window.URL.createObjectURL(ie),ve.download="finished_topics_".concat(Te,".xlsx"),document.body.appendChild(ve),ve.click(),document.body.removeChild(ve)),E.next=11;break;case 8:E.prev=8,E.t0=E.catch(1),console.error(E.t0);case 11:return E.prev=11,Je(!1),E.finish(11);case 14:case"end":return E.stop()}},fe,null,[[1,8,11,14]])}))},[De]);return Object(S.jsxs)(ot.a,{type:"primary",loading:ne,onClick:Be(Te),children:[Object(S.jsx)(A.a,{})," ",Object(S.jsx)(h.a,{id:"export"})]})},J=function(Ce){return Ce.topicable.content.contents?Object.values(Ce.topicable.content.contents)[0].library:"H5P"},_e=function(Ce){var Te=Ce.course_id,Me=Ce.topics,De=Ce.stats,he=Object(Ae.useState)(!1),ce=Object(Se.a)(he,2),ne=ce[0],Je=ce[1],Be=Object(Ae.useMemo)(function(){return[{title:Object(S.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(ie){return Object(S.jsx)(Re.a,{type:"App\\Models\\User",type_id:ie})}},{title:Object(S.jsx)(h.a,{id:"email"}),dataIndex:"email"}].concat(Object(Z.a)(Me.map(function(fe){var ie,ve=(ie=fe.topicable_type)===null||ie===void 0?void 0:ie.split("\\").pop();return ve==="H5P"&&(ve=J(fe)),{render:function(E){var Le=0,Qe=0;switch(E&&(E.started_at&&E.finished_at?Le=1:E.started_at&&(Le=2),Qe=E.seconds/60),Le){case 1:return Object(S.jsxs)(pe.b,{children:[Object(S.jsx)(Ee.a,{color:"success",children:"F"}),ne&&Object(S.jsxs)("small",{children:[Qe.toFixed(2),"m"]})]});case 2:return Object(S.jsxs)(pe.b,{children:[Object(S.jsx)(Ee.a,{color:"blue",children:"S"}),ne&&Object(S.jsxs)("small",{children:[Qe.toFixed(2),"m"]})]});case 0:default:return Object(S.jsx)(st.a.Fragment,{children:Object(S.jsx)(Ee.a,{color:"error",children:"N"})})}},title:Object(S.jsxs)("small",{children:[Object(S.jsx)(Ee.a,{children:ve})," ",fe.title]}),dataIndex:fe.id}})))},[Me,ne]),G=Object(Ae.useMemo)(function(){return De.map(function(fe){return Me.reduce(function(ie,ve){var L=fe.topics.find(function(E){return E.id===ve.id});return Object(oe.a)(Object(oe.a)({},ie),{},Object(et.a)({},Number(ve.id),L!=null?L:0))},{email:fe.email,id:fe.id})})},[De,Me]);return Object(S.jsx)(I.a,{title:function(){return Object(S.jsxs)(j.a,{justify:"space-between",align:"middle",children:[Object(S.jsxs)(pe.b,{children:[Object(S.jsx)(h.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(S.jsx)(Ee.a,{color:"success",children:"F"}),Object(S.jsx)(h.a,{id:"Started",defaultMessage:"Started:"})," ",Object(S.jsx)(Ee.a,{color:"blue",children:"S"}),Object(S.jsx)(h.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(S.jsx)(Ee.a,{color:"error",children:"N"}),Object(S.jsx)(h.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(S.jsx)(s.a,{checked:ne,onChange:function(ve){return Je(ve)}})]}),Object(S.jsx)(ye,{course_id:Te})]})},columns:Be,dataSource:G,size:"small",scroll:{x:1500},components:{table:function(ie){return Object(S.jsx)(R.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(S.jsx)("table",Object(oe.a)({},ie))})}}})},at=function(Ce){var Te=Ce.stats,Me=Ce.attempts,De=Object(Ae.useMemo)(function(){return[{title:Object(S.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(ne){return Object(S.jsx)(Re.a,{type:"App\\Models\\User",type_id:ne})}},{title:Object(S.jsx)(h.a,{id:"email"}),dataIndex:"email"},{title:Object(S.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(S.jsx)(h.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),he=Object(Ae.useMemo)(function(){return Te.map(function(ce){var ne=ce.id,Je=ce.email,Be=ce.finished_at,G=Me==null?void 0:Me.find(function(ie){return ie.id===ne}),fe=Array.isArray(G==null?void 0:G.attempts)?G==null?void 0:G.attempts.length:0;return{id:ne,email:Je,finished_at:Be,attempt:fe}})},[Te]);return Object(S.jsx)(I.a,{title:function(){return Object(S.jsx)(pe.b,{children:Object(S.jsx)(h.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:De,dataSource:he,size:"small",scroll:{x:500}})},tt=function(Ce){var Te=Ce.stats,Me=Object(Ae.useState)(null),De=Object(Se.a)(Me,2),he=De[0],ce=De[1],ne=Object(Ae.useState)(null),Je=Object(Se.a)(ne,2),Be=Je[0],G=Je[1],fe=Object(h.l)(),ie=Object(Ae.useMemo)(function(){return Te.flatMap(function(L){return Object.values(L.attempts).flatMap(function(E){var Le=E.dates,Qe=E.attempt,q=Object.values(Le).flatMap(function(D){var N=D.date,U=D.seconds_total;return{date:N,attempt:Qe,seconds_total:U,email:L.email}});return q})})},[Te]),ve={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(S.jsx)(mt.a,{title:Object(S.jsxs)(pe.b,{children:[Object(S.jsx)(h.a,{id:"course.interactions_time_in_days"}),Object(S.jsx)($e.a,{showSearch:!0,value:he,onChange:function(E){ce(E),G(null)},placeholder:Object(S.jsx)(h.a,{id:"select_person",defaultMessage:"Select a person"}),children:Te.map(function(L){var E=L.id,Le=L.email;return Object(S.jsx)($e.a.Option,{value:Le,children:Le},E)})}),Object(S.jsx)($e.a,{value:Be,onChange:function(E){return G(E)},disabled:he===null,placeholder:Object(S.jsx)(h.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Z.a)(new Set(ie.filter(function(L){var E=L.email;return E===he}).map(function(L){var E=L.attempt;return E}))).map(function(L){return Object(S.jsxs)($e.a.Option,{value:L,children:[Object(S.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"})," ",L]},L)})})]}),colSpan:12,layout:"center",children:Object(S.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(S.jsx)(Ue.a,Object(oe.a)(Object(oe.a)({},ve),{},{tooltip:{title:"".concat(fe.formatMessage({id:"attempt"})),formatter:function(E){var Le=Math.floor(+E.seconds_total/60),Qe=+E.seconds_total>60?+E.seconds_total-Le*60:0;return{name:E.attempt,value:"".concat(Le,"m ").concat(Qe,"s")}}},data:ie.filter(function(L){var E=L.email;return E===he}).filter(function(L){var E=L.attempt;return Number.isInteger(Be)?E===Be:!0})}))})})}},olry:function(bt,we,i){"use strict";i.r(we);var b=i("k1fw"),$e=i("+L6B"),re=i("2/Rp"),I=i("T2oS"),me=i("W9HT"),j=i("q1tI"),nt=i.n(j),s=i("9kvl"),et=i("55Ip"),oe=i("Ty5D"),je=i("nhC9"),pe=i("tMyG"),Xe=i("my69"),Ee=i("huej"),Z=i("mJ0o"),Se=i("EhlZ"),Ae=i("P2fV"),st=i("NJEC"),mt=i("5Dmo"),Ue=i("3S7+"),h=i("qLMh"),R=i("9og8"),Re=i("sWYD"),ut=i("G3dp"),ot=i("lbgm"),ue=i("/MfK"),W=i("Qiat"),A=i("mGZj");function M(u,r){return S.apply(this,arguments)}function S(){return S=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},u)})),S.apply(this,arguments)}function ye(u,r){return J.apply(this,arguments)}function J(){return J=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},u)})),J.apply(this,arguments)}function _e(u,r,a){return at.apply(this,arguments)}function at(){return at=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),at.apply(this,arguments)}function tt(u,r){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Ge.apply(this,arguments)}function Ce(u,r){return Te.apply(this,arguments)}function Te(){return Te=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),Te.apply(this,arguments)}function Me(u,r,a,n){return De.apply(this,arguments)}function De(){return De=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return l.stop()}},u)})),De.apply(this,arguments)}function he(u,r,a){return ce.apply(this,arguments)}function ce(){return ce=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(b.a)({method:"DELETE"},n||{})));case 1:case"end":return c.stop()}},u)})),ce.apply(this,arguments)}var ne=i("Vpfc"),Je=i("giR+"),Be=i("fyUT"),G=i("tJVT"),fe=i("14J3"),ie=i("BMrR"),ve=i("jCWc"),L=i("kPKH"),E=i("VMEa"),Le=i("Qurx"),Qe=i("lR9U"),q=i("/y+f"),D=i("2qtc"),N=i("kLXV"),U=i("DYRE"),w=i("zeV3"),H=i("XCrF"),V=i("1GRj"),Y=i("jrin"),ee=i("oBTY"),$r=i("OaEy"),ft=i("2fM7"),aa=i("+YFz"),ra=i("DBJ/"),e=i("nKUr"),ct,na=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,c=Object(Z.b)(),l=c.semester_subject_id,o=c.teacherSubjectData,m=Object(j.useState)(null),y=Object(G.a)(m,2),p=y[0],g=y[1],v=Object(j.useMemo)(function(){var x;return((x=o==null?void 0:o.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{label:C,value:T}})},[]),d={type:a,group_id:p,semester_subject_id:l},f=Object(j.useCallback)(function(x){if(x.success){var O=x.data.results.filter(function(T){var C=T.user_id;return C!==null});if(!O.length)return;n({exam_results:O,group_id:x.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(ft.a,{disabled:t,value:p,onChange:function(O){return g(O)},options:v,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(ra.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(O){return!O.fileList.length&&n(void 0)},maxFiles:1,data:d,disabled:!p})]})},sa=function(r){var a=r.onDataConverted,n=Object(Z.b)(),t=n.teacherSubjectData,c=n.groupUsers,l=Object(j.useState)(null),o=Object(G.a)(l,2),m=o[0],y=o[1],p=Object(j.useMemo)(function(){var v;return((v=t==null?void 0:t.groups)!==null&&v!==void 0?v:[]).map(function(d){var f=d.id,x=d.name;return{label:x,value:f}})},[]),g=Object(j.useCallback)(function(v){var d;y(v);var f=(d=c.byId)===null||d===void 0?void 0:d[v];if(!!f){var x=f.users.reduce(function(O,T){var C=T.id,_=T.email,B=T.first_name,K=T.last_name,de=T.academic_teacher_id;return de!==null?O:[].concat(Object(ee.a)(O),[{email:_,first_name:B,last_name:K,user_id:C,result:0}])},[]);a({group_id:v,exam_results:x})}},[c.byId]);return Object(e.jsx)(ft.a,{value:m,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},vt=(ct={},Object(Y.a)(ct,q.c.TestPortal,["/teacher-examples/testPortal.png"]),Object(Y.a)(ct,q.c.TeamsForms,["/teacher-examples/teamsForms.png"]),Object(Y.a)(ct,q.c.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),Object(Y.a)(ct,q.c.Manual,[]),ct),ua=function(r){var a=r.images,n=Object(j.useState)(!1),t=Object(G.a)(n,2),c=t[0],l=t[1],o=Object(j.useCallback)(function(){return l(!0)},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"see_file_example_image"}),children:Object(e.jsx)(re.a,{onClick:o,icon:Object(e.jsx)(aa.a,{})})}),Object(e.jsx)(V.a.PreviewGroup,{preview:{visible:c,onVisibleChange:l},children:a.map(function(m){return Object(e.jsx)(V.a,{style:{display:"none"},src:m},m)})})]})},ca=function(r){var a,n=r.type,t=r.onOk,c=r.onCancel,l=r.okDisabled,o=(a=vt==null?void 0:vt[n])!==null&&a!==void 0?a:vt[q.c.Manual];return Object(e.jsxs)(w.b,{style:{width:"100%",justifyContent:o.length?"space-between":"flex-end"},children:[!!o.length&&Object(e.jsx)(ua,{images:o}),Object(e.jsxs)(w.b,{children:[Object(e.jsx)(re.a,{onClick:c,children:Object(e.jsx)(s.a,{id:"cancel"})}),Object(e.jsx)(re.a,{type:"primary",disabled:l,onClick:t,children:Object(e.jsx)(s.a,{id:"ok"})})]})]})},ia=[q.c.TeamsLecture,q.c.TestPortal,q.c.TeamsForms],da=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,c=r.type,l=Object(Z.b)(),o=l.teacherSubjectData,m=l.fetchGroupUsers,y=Object(j.useState)(),p=Object(G.a)(y,2),g=p[0],v=p[1];return Object(j.useEffect)(function(){if(c===q.c.Manual&&a){var d;o==null||(d=o.groups)===null||d===void 0||d.forEach(function(f){var x=f.id;return m(x)})}},[c,a]),Object(e.jsxs)(N.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,footer:Object(e.jsx)(ca,{type:c,onOk:function(){g&&t(g)},onCancel:n,okDisabled:!g}),children:[ia.includes(c)&&Object(e.jsx)(na,{type:c,onDataConverted:v,groupSelectDisabled:!!g}),c===q.c.Manual&&Object(e.jsx)(sa,{onDataConverted:v})]})},la=function(r){var a=r.onSelect;return Object(e.jsxs)(ie.a,{gutter:[16,16],children:[Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(re.a,{type:"primary",onClick:function(){return a(q.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(re.a,{type:"primary",onClick:function(){return a(q.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(re.a,{type:"primary",onClick:function(){return a(q.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(re.a,{type:"primary",onClick:function(){return a(q.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},oa=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ja=function(r){var a,n=r.exam_id,t=E.a.useForm(),c=Object(G.a)(t,1),l=c[0],o=Object(j.useState)(),m=Object(G.a)(o,2),y=m[0],p=m[1],g=Object(j.useState)(),v=Object(G.a)(g,2),d=v[0],f=v[1],x=Object(j.useState)(!1),O=Object(G.a)(x,2),T=O[0],C=O[1],_=Object(Z.b)(),B=_.semester_subject_id,K=_.getGroupById,de=Object(j.useMemo)(function(){var P;return((P=d==null?void 0:d.exam_results)!==null&&P!==void 0?P:[]).map(function($){var F=$.user_id;return F})},[d==null?void 0:d.exam_results]);Object(j.useEffect)(function(){var P=Number(n);n==="new"&&(p(void 0),f(void 0),l.resetFields()),n!=="new"&&!Number.isNaN(P)&&(C(!0),tt(P).then(function($){if($.success){var F=$.data,k=F.type,Pe=F.results,He=F.title,ae=F.weight,se=F.passed_at,z=F.group_id;p(k),f({group_id:z,exam_results:Pe}),l.setFieldsValue({title:He,weight:ae,passed_at:se})}}).finally(function(){return C(!1)}))},[n]);var Ie=Object(j.useCallback)(function(){p(void 0),f(void 0)},[]);return T?Object(e.jsx)(me.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(da,{open:Boolean(y&&!d),type:y,closeModal:Ie,onSuccess:f}),Object(e.jsxs)(E.a,{form:l,submitter:y===void 0||!d?!1:void 0,onFinish:function(){var P=Object(R.a)(Object(h.a)().mark(function $(F){var k,Pe,He,ae,se,z,ge,Ke,xe,ze;return Object(h.a)().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:if(Pe=d==null||(k=d.exam_results)===null||k===void 0?void 0:k.every(function(X){var Q=X.result;return typeof Q=="number"&&Q>=0&&Q<=100}),!(d&&Pe&&typeof B=="number")){le.next=17;break}if(He=F.title,ae=F.passed_at,se=F.weight,z=Number(n),ge=d.exam_results,Ke=d.group_id,xe={type:y,semester_subject_id:B,title:He,passed_at:ae,weight:se,group_id:Ke,results:ge},!Number.isNaN(z)){le.next=12;break}return le.next=9,ye(xe);case 9:le.t0=le.sent,le.next=15;break;case 12:return le.next=14,_e(z,xe);case 14:le.t0=le.sent;case 15:ze=le.t0,ze.success&&s.f.push("/teacher/subjects/".concat(B,"/exams"));case 17:return le.abrupt("return",!0);case 18:case"end":return le.stop()}},$)}));return function($){return P.apply(this,arguments)}}(),onReset:Ie,children:[Object(e.jsxs)(E.a.Group,{children:[Object(e.jsx)(Le.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(Qe.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(E.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Be.a,{})})]}),y&&d&&Object(e.jsx)(W.a,{rowKey:"user_id",headerTitle:(a=K(d.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:de,onValuesChange:function($,F){return f({group_id:d.group_id,exam_results:F})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:d.exam_results,columns:oa}),!d&&Object(e.jsx)(la,{onSelect:p})]})]})},ba=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],ma=function(r){var a=r.exam_id,n=Object(j.useState)(""),t=Object(G.a)(n,2),c=t[0],l=t[1];return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(R.a)(Object(h.a)().mark(function o(){var m;return Object(h.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,tt(a);case 2:if(m=p.sent,!m.success){p.next=6;break}return l(m.data.title),p.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},o)})),columns:ba})},fa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(Re.a)(new Date(a.passed_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(Re.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(ne.a,{type:"Students",type_id:a.group_id},a.group_id)}}],va=function(){var r,a,n=Object(j.useRef)(),t=Object(Z.b)(),c=t.semester_subject_id,l=Object(oe.k)(),o=Object(j.useMemo)(function(){var p,g,v;return{exam_id:(p=(g=l.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(v=l.query)===null||v===void 0?void 0:v.results}},[(r=l.query)===null||r===void 0?void 0:r.exam_id,(a=l.query)===null||a===void 0?void 0:a.results]),m=o.exam_id,y=o.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(ma,{exam_id:Number(y)}):m!==null?Object(e.jsx)(ja,{exam_id:m}):Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var p=Object(R.a)(Object(h.a)().mark(function g(v,d){var f,x,O,T;return Object(h.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=v.current,x=v.pageSize,c!==null){_.next=3;break}return _.abrupt("return",{data:[],total:0,success:!1});case 3:return O=d&&Object.entries(d)[0],_.next=6,M({per_page:x,page:f,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:O&&O[0],order:O&&(O[1]==="ascend"?"ASC":"DESC")});case 6:if(T=_.sent,!T.success){_.next=9;break}return _.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return _.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return _.stop()}},g)}));return function(g,v){return p.apply(this,arguments)}}(),columns:[].concat(fa,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,v){return[Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?exam_id=").concat(v.id),children:Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(re.a,{type:"primary",icon:Object(e.jsx)(ut.a,{})})})},"edit"),Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?results=").concat(v.id),children:Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(re.a,{icon:Object(e.jsx)(ot.a,{})})})},"results"),Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(R.a)(Object(h.a)().mark(function d(){var f;return Object(h.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Ce(v.id);case 2:f=O.sent,f.success&&n.current&&n.current.reload();case 4:case"end":return O.stop()}},d)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(re.a,{type:"primary",icon:Object(e.jsx)(ue.a,{}),danger:!0})})},"delete")]}}])})},ht=i("o0Ox"),Dr=i("miYZ"),it=i("tsqr"),Oa=i("4KAj");function pa(u,r){return gt.apply(this,arguments)}function gt(){return gt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},u)})),gt.apply(this,arguments)}var ha=function(r){var a=r.student_id,n=Object(j.useState)(!1),t=Object(G.a)(n,2),c=t[0],l=t[1],o=Object(j.useCallback)(Object(R.a)(Object(h.a)().mark(function m(){var y;return Object(h.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l(!0),g.next=3,pa({user_id:a});case 3:if(y=g.sent,y.success){g.next=8;break}return it.b.error(y.message),l(!1),g.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),l(!1);case 10:case"end":return g.stop()}},m)})),[]);return Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(re.a,{loading:c,type:"primary",icon:Object(e.jsx)(Oa.a,{}),onClick:o})})},ga=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],xa=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},Sa=function(r){return r.reduce(function(a,n){var t,c=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(l,o){return o.academic_teacher_id!==null?l:[].concat(Object(ee.a)(l),[{group_id:n.id,group_name:n.name,user_id:o.id,first_name:o.first_name,last_name:o.last_name,email:o.email}])},[]);return[].concat(Object(ee.a)(a),Object(ee.a)(c))},[])},ya=function(){var r=Object(Z.b)(),a=r.teacherSubjectData,n=Object(j.useMemo)(function(){var t;return xa((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(R.a)(Object(h.a)().mark(function c(l){var o,m,y,p,g,v,d,f,x;return Object(h.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return o=l.groups,m=l.first_name,y=m===void 0?"":m,p=l.last_name,g=p===void 0?"":p,v=l.email,d=v===void 0?"":v,T.next=3,Object(ht.a)({parent_id:a==null?void 0:a.group_id,"id[]":o});case 3:if(f=T.sent,f.success){T.next=6;break}return T.abrupt("return",{data:[],total:0,success:!1});case 6:return x=Sa(f.data).filter(function(C){return C.first_name.toLowerCase().includes(y.toLowerCase())&&C.last_name.toLowerCase().includes(g.toLowerCase())&&C.email.toLowerCase().includes(d.toLowerCase())}),T.abrupt("return",{data:x,total:x.length,success:!0});case 8:case"end":return T.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ga,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,l){return[Object(e.jsx)(ha,{student_id:l.user_id},"teamsChat")]}}])})};function xt(u,r){return St.apply(this,arguments)}function St(){return St=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),St.apply(this,arguments)}function _a(u,r,a,n){return yt.apply(this,arguments)}function yt(){return yt=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(b.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return l.stop()}},u)})),yt.apply(this,arguments)}var Pr=i("sRBo"),Ut=i("kaz8");function Ca(u){var r,a,n=u===null?q.a.ABSENT:u,t=(r={},Object(Y.a)(r,q.a.PRESENT,{ch1:!0,ch2:!1}),Object(Y.a)(r,q.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(Y.a)(r,q.a.ABSENT,{ch1:!1,ch2:!1}),Object(Y.a)(r,q.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),r);return(a=t[n])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function Ta(u){var r,a=u.ch1,n=u.ch2,t="".concat(a,"_").concat(n),c={true_false:q.a.PRESENT,true_true:q.a.PRESENT_NOT_EXERCISING,false_false:q.a.ABSENT,false_true:q.a.EXCUSED_ABSENCE};return(r=c[t])!==null&&r!==void 0?r:q.a.ABSENT}var Ea=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.attendance,c=r.onSuccess,l=Object(j.useState)(Ca(t)),o=Object(G.a)(l,2),m=o[0],y=o[1],p=Object(j.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(j.useRef)(!0),x=Object(j.useCallback)(function(C){d(!0),_a(a,n,Ta(C)).then(function(_){_.success&&(c==null||c())}).finally(function(){return d(!1)})},[]),O=Object(j.useCallback)(function(C){return y(C.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),T=Object(j.useCallback)(function(C){return y(function(_){return Object(b.a)(Object(b.a)({},_),{},{ch2:C.target.checked})})},[]);return Object(j.useEffect)(function(){if(f.current){f.current=!1;return}x(m)},[m,x]),Object(e.jsxs)(w.b,{children:[Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Ut.a,{disabled:v,checked:m.ch1,onChange:O})}),Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Ut.a,{disabled:v,checked:m.ch2,onChange:T})})]})},_t=Ea,Ga=function(){var r=Object(Z.b)(),a=r.teacherSubjectData,n=Object(j.useState)([]),t=Object(G.a)(n,2),c=t[0],l=t[1],o=Object(j.useState)(""),m=Object(G.a)(o,2),y=m[0],p=m[1],g=Object(s.l)(),v=Object(j.useRef)(),d=Object(j.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(O){var T=O.id,C=O.name;return{value:T,label:C}})},[a==null?void 0:a.groups]),f=Object(j.useMemo)(function(){var x;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:d,defaultValue:d==null||(x=d[0])===null||x===void 0?void 0:x.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ee.a)(c))},[d,c]);return Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var x=Object(R.a)(Object(h.a)().mark(function O(T){var C,_,B,K,de,Ie,P,$,F,k,Pe;return Object(h.a)().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return _=T.group_id,B=_===void 0?d==null||(C=d[0])===null||C===void 0?void 0:C.value:_,K=T.full_name,de=K===void 0?"":K,ae.next=3,Promise.all([Object(ht.b)(B),xt(B)]);case 3:if(Ie=ae.sent,P=Object(G.a)(Ie,2),$=P[0],F=P[1],k=d.find(function(se){var z=se.value;return z===B}),!(!$.success||!F.success||!k)){ae.next=10;break}return ae.abrupt("return",{data:[],total:0,success:!1});case 10:if(F.data.length){ae.next=13;break}return it.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),ae.abrupt("return",{data:[],total:0,success:!1});case 13:return p(k.label),l(F.data.reduce(function(se,z){return[].concat(Object(ee.a)(se),[{title:String(Object(Re.a)(new Date(z.date_from),A.c)),dataIndex:String(z.date_from),hideInSearch:!0,width:100,align:"center",render:function(Ke,xe){return Object(e.jsx)(_t,{groupAttendanceScheduleId:z.id,attendance:xe["".concat(z==null?void 0:z.date_from)],studentId:xe.id})}}])},[])),Pe=$.data.users.reduce(function(se,z){var ge=z.id,Ke=z.academic_teacher_id,xe=z.first_name,ze=z.last_name,qe="".concat(ze," ").concat(xe);if(Ke!==null||!qe.toLowerCase().includes(de.toLowerCase()))return se;var le=F.data.reduce(function(X,Q){var te=Q.attendances.find(function(be){return be.user_id===ge});return te?Object(b.a)(Object(b.a)({},X),{},Object(Y.a)({},"".concat(Q.date_from),te.value)):X},{});return[].concat(Object(ee.a)(se),[Object(b.a)({id:ge,full_name:qe},le)])},[]).sort(function(se,z){return se.full_name.localeCompare(z.full_name)}),ae.abrupt("return",{data:Pe,total:Pe.length,success:!0});case 17:case"end":return ae.stop()}},O)}));return function(O){return x.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{onChange:function(){var O;return(O=v.current)===null||O===void 0?void 0:O.reload()}},scroll:{x:1500},actionRef:v,rowKey:"id"})},wr=i("tU7J"),Ye=i("wFql"),Ar=i("/zsF"),Ct=i("PArb"),Ma=i("Hn4i"),Ia=i("bRQS");function Tt(u,r,a){return Et.apply(this,arguments)}function Et(){return Et=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),Et.apply(this,arguments)}function Fa(u,r,a,n){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(R.a)(Object(h.a)().mark(function u(r,a,n,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"POST",data:n},t||{})));case 1:case"end":return l.stop()}},u)})),Gt.apply(this,arguments)}function Bt(u,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(b.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Mt.apply(this,arguments)}function $a(u,r,a){return It.apply(this,arguments)}function It(){return It=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},u)})),It.apply(this,arguments)}function Kt(u){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(R.a)(Object(h.a)().mark(function u(r){return Object(h.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},u)})),Ft.apply(this,arguments)}function Wt(u,r){return $t.apply(this,arguments)}function $t(){return $t=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(r),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),$t.apply(this,arguments)}function Vt(u,r){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(b.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},u)})),Dt.apply(this,arguments)}function kt(u,r,a){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(R.a)(Object(h.a)().mark(function u(r,a,n){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(b.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return c.stop()}},u)})),Pt.apply(this,arguments)}function Ht(u,r){return wt.apply(this,arguments)}function wt(){return wt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),wt.apply(this,arguments)}var Da=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Pa=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(j.useState)([]),c=Object(G.a)(t,2),l=c[0],o=c[1],m=Object(j.useRef)(),y=E.a.useForm(),p=Object(G.a)(y,1),g=p[0];return Object(j.useEffect)(function(){var v,d=((v=a.scale)!==null&&v!==void 0?v:[]).map(function(f,x){return Object(b.a)(Object(b.a)({},f),{},{id:String((x+1)*100)})});g.setFieldValue("table",d)},[]),Object(e.jsx)(E.a,{form:g,onFinish:n,submitter:{render:function(d,f){var x=Object(G.a)(f,2),O=x[1];return[O]}},children:Object(e.jsx)(Ma.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Da,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(d,f){return Object(e.jsx)(re.a,{type:"primary",onClick:function(){var O;return(O=m.current)===null||O===void 0?void 0:O.startEditable(f.id)},icon:Object(e.jsx)(ut.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:l,saveText:Object(e.jsx)(re.a,{type:"primary",icon:Object(e.jsx)(Ia.a,{})}),onChange:o,actionRender:function(d,f,x){return[x.save]}}})})},wa=function(){var r,a,n=Object(s.m)("@@initialState"),t=n.initialState,c=Object(Z.b)(),l=c.semester_subject_id,o=c.tutors,m=Object(j.useState)(),y=Object(G.a)(m,2),p=y[0],g=y[1],v=Object(j.useState)(!1),d=Object(G.a)(v,2),f=d[0],x=d[1],O=Object(j.useState)(null),T=Object(G.a)(O,2),C=T[0],_=T[1],B=Object(j.useMemo)(function(){return!!o.data.find(function(P){var $,F=P.id;return F===(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)})},[o.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),K=Object(j.useMemo)(function(){return o.data.map(function(P){var $=P.id,F=P.first_name,k=P.last_name;return{label:"".concat(F," ").concat(k),value:$}})},[o.data]),de=Object(j.useCallback)(function(){l===null||C===null||(x(!0),g(void 0),Tt(l,C).then(function(P){P.success&&g(P.data)}).finally(function(){x(!1)}))},[l,C]),Ie=Object(j.useCallback)(function(P,$){return function(){var F=Object(R.a)(Object(h.a)().mark(function k(Pe){var He,ae;return Object(h.a)().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(l===null||C===null)){z.next=2;break}return z.abrupt("return");case 2:return He=P.reduce(function(ge,Ke){return Ke.s_subject_scale_form_id===$?[].concat(Object(ee.a)(ge),[{s_subject_scale_form_id:$,scale:Pe.table.map(function(xe){var ze=xe.name,qe=xe.grade,le=xe.grade_value;return{name:ze,grade:qe,grade_value:le}})}]):[].concat(Object(ee.a)(ge),[Ke])},[]),z.next=5,Fa(l,C,{grade_scale:He});case 5:ae=z.sent,ae.success&&de();case 7:case"end":return z.stop()}},k)}));return function(k){return F.apply(this,arguments)}}()},[C,l]);return Object(j.useEffect)(function(){var P,$;if(!B||!(t!=null&&(P=t.currentUser)!==null&&P!==void 0&&P.id)){var F;if((F=o.data)!==null&&F!==void 0&&F[0]){var k;_((k=o.data)===null||k===void 0?void 0:k[0].id)}return}_(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,B]),Object(j.useEffect)(function(){de()},[de]),o.loading?Object(e.jsx)(me.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(ft.a,{disabled:B,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:K,value:C,onChange:function($){return _($)}})}),Object(e.jsx)(Ct.a,{}),f&&!p&&Object(e.jsx)(me.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(P,$){var F;return Object(e.jsxs)(nt.a.Fragment,{children:[$>0&&Object(e.jsx)(Ct.a,{}),Object(e.jsx)(Pa,{subjectTutorGradeScale:P,onFormSubmit:Ie((F=p.grade_scale)!==null&&F!==void 0?F:[],P.s_subject_scale_form_id)})]},P.s_subject_scale_form_id)}):Object(e.jsx)(Ye.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Rr=i("qbNl"),Aa=i("JBPa"),Lr=i("Awhp"),Ra=i("KrTs"),La=i("wd/R"),Ze=i.n(La);function Na(u,r){return At.apply(this,arguments)}function At(){return At=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(b.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),At.apply(this,arguments)}var Nr=i("5R/X"),Ua=function(){var r=Object(j.useState)(null),a=Object(G.a)(r,2),n=a[0],t=a[1],c=Object(j.useState)([]),l=Object(G.a)(c,2),o=l[0],m=l[1],y=Object(Z.b)(),p=y.semester_subject_id,g=Ze()(),v=Object(j.useMemo)(function(){return o.map(function(_){return{id:_.id,title:"".concat(_.group.name," (").concat(_.term_status.name,")"),start:Ze()(_.date_from).toDate(),end:Ze()(_.date_to).toDate(),tutor_name:"".concat(_.tutor.first_name," ").concat(_.tutor.last_name),tutor_email:_.tutor.email,semester:_.semester.name,group:_.group.name,subject:_.subject.name,ms_teams_join_url:_.ms_teams_join_url}})},[o]),d=Object(j.useCallback)(function(_,B){Na({semester_subject_id:p,date_form:_.toDate(),date_to:B.toDate()}).then(function(K){K.success&&m(K.data)})},[p]),f=Object(j.useCallback)(function(_){t(_)},[]),x=Object(j.useCallback)(function(){t(null)},[]),O=Object(j.useCallback)(function(_){return _.isSame(g,"day")?"warning":_.isAfter(g,"day")?"success":"error"},[]),T=Object(j.useCallback)(function(_){var B=v.filter(function(K){return Ze()(K.start).isSame(_,"day")});return Object(e.jsx)("ul",{className:"events",children:B.map(function(K){return Object(e.jsx)("li",{onClick:function(){return f(K)},children:Object(e.jsx)(Ra.a,{status:O(Ze()(K.start)),text:K.title})},K.id)})})},[o]),C=Object(j.useCallback)(function(_,B){var K=Ze()(_).startOf(B).subtract(1,"month"),de=Ze()(_).endOf(B).add(1,"month");d(K,de)},[]);return Object(j.useEffect)(function(){var _=Ze()().startOf("month"),B=Ze()().endOf("month");d(_,B)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Aa.a,{dateCellRender:T,onPanelChange:C}),Object(e.jsxs)(N.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:x,footer:null,children:[Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&Ze()(n.start).format(A.b)]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",n&&Ze()(n.end).format(A.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(Ye.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(re.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},zt=i("yj/a"),Jt=i("5Syx"),Ot=i("PpiC"),Rt=i("H6aw"),Ba=i("p3I6"),Ka=["results"],Yt=function(r,a){return r.reduce(function(n,t){var c=t.results,l=Object(Ot.a)(t,Ka),o=c.find(function(m){return m.user_id===a});return o?[].concat(Object(ee.a)(n),[Object(b.a)(Object(b.a)({},l),{},{result:o})]):n},[])},Xt=function(r,a){var n,t=r.reduce(function(d,f){var x=f.result,O=f.weight;return[d[0]+x.result*O,d[1]+O]},[0,0]),c=Object(G.a)(t,2),l=c[0],o=c[1],m=Number.isNaN(l/o)?0:l/o,y=a.sort(function(d,f){return d.grade_value-f.grade_value}).reduce(function(d,f){return[].concat(Object(ee.a)(d),[Object(b.a)(Object(b.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(y.every(function(d){var f=d.isWeightedAverageGreater;return f})){var p,g;return(p=(g=y.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var v=y.findIndex(function(d){var f=d.isWeightedAverageGreater;return!f});return v<0?"":(n=y[v-1])===null||n===void 0?void 0:n.name},Qt=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Wa=["attendances"];function Va(u){return function(a){u(function(n){return Object(b.a)(Object(b.a)({},n),{},{loading:a})})}}function Zt(u,r){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(R.a)(Object(h.a)().mark(function u(r,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r(!0),t.prev=1,t.abrupt("return",a());case 3:return t.prev=3,r(!1),t.finish(3);case 6:case"end":return t.stop()}},u,null,[[1,,3,6]])})),Lt.apply(this,arguments)}function ka(u,r){var a=Object(j.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],l=Object(j.useCallback)(Va(c),[]),o=Object(j.useCallback)(Object(R.a)(Object(h.a)().mark(function y(){var p;return Object(h.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,$a(u,r);case 2:if(p=v.sent,p.success){v.next=5;break}return v.abrupt("return",p);case 5:return c(function(d){return Object(b.a)(Object(b.a)({},d),{},{data:p.data})}),v.abrupt("return",p);case 7:case"end":return v.stop()}},y)})),[r,u]),m=Object(j.useCallback)(function(y){return Zt(l,function(){return Ht(y).then(o)})},[o]);return Object(j.useEffect)(function(){Zt(l,o)},[o]),{finalGrades:t,deleteFinalGrade:m}}function Ha(){var u=Object(j.useState)({loading:!1}),r=Object(G.a)(u,2),a=r[0],n=r[1];return Object(j.useEffect)(function(){n(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!0})}),Kt().then(function(t){t.success&&n(function(c){return Object(b.a)(Object(b.a)({},c),{},{data:t.data})})}).finally(function(){n(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function za(u){var r=Object(j.useState)({loading:!1}),a=Object(G.a)(r,2),n=a[0],t=a[1];return Object(j.useEffect)(function(){u!==void 0&&(t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!0})}),Wt(u).then(function(c){c.success&&t(function(l){return Object(b.a)(Object(b.a)({},l),{},{data:c.data})})}).finally(function(){t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!1})})}))},[u]),{subjectGradeScales:n}}function Ja(u,r,a){var n=Object(j.useState)({loading:!1}),t=Object(G.a)(n,2),c=t[0],l=t[1];return Object(j.useEffect)(function(){typeof u!="number"||typeof r!="number"||typeof a!="number"||(l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),Tt(u,r).then(function(o){o.success&&l(function(m){var y,p;return Object(b.a)(Object(b.a)({},m),{},{data:(y=Qt(a,(p=o.data.grade_scale)!==null&&p!==void 0?p:[]))===null||y===void 0?void 0:y.map(function(g,v){return Object(b.a)(Object(b.a)({},g),{},{id:v})})})})}).finally(function(){l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})}))},[u,r]),{tutorGradeScales:c}}function Ya(u,r){var a=Object(j.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],l=Object(j.useCallback)(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),xt(u).then(function(o){if(o.success){var m=o.data.reduce(function(y,p){var g=p.attendances,v=Object(Ot.a)(p,Wa),d=g.find(function(f){return f.user_id===r});return d?[].concat(Object(ee.a)(y),[Object(b.a)(Object(b.a)({},v),{},{attendance:d})]):y},[]);c(function(y){return Object(b.a)(Object(b.a)({},y),{},{data:m})})}}).finally(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})})},[u,r]);return Object(j.useEffect)(function(){l()},[l]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:l}}function Xa(u,r){var a=Object(j.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1];return Object(j.useEffect)(function(){!r||(c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!0})}),M({student_id:u,semester_subject_id:r}).then(function(l){if(l.success){var o=Yt(l.data,u);c(function(m){return Object(b.a)(Object(b.a)({},m),{},{data:o})})}}).finally(function(){c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!1})})}))},[u,r]),{studentExams:t}}function Qa(u,r){var a=Object(j.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],c=n[1],l=Object(j.useState)({loading:!1}),o=Object(G.a)(l,2),m=o[0],y=o[1],p=Object(j.useState)({loading:!1}),g=Object(G.a)(p,2),v=g[0],d=g[1];return Object(j.useEffect)(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Object(Rt.e)({group_id:u}).then(function(f){f.success&&c(function(x){return Object(b.a)(Object(b.a)({},x),{},{data:f.data})})}).finally(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})})},[u]),Object(j.useEffect)(function(){!t.data||(d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Rt.n)(Number(x))})).then(function(f){f.forEach(function(x){x.success&&d(function(O){return Object(b.a)(Object(b.a)({},O),{},{data:Object(b.a)(Object(b.a)({},O.data),{},Object(Y.a)({},Number(x.data.id),Object(Ba.c)(x.data.lessons)))})})})}).finally(function(){d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}),y(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Rt.l)(Number(x),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(O){if(O.success){var T,C,_=((T=O.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&T!==void 0?T:[]).filter(function(K){return K.id===r}),B=(C=O.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&C!==void 0?C:[];y(function(K){return Object(b.a)(Object(b.a)({},K),{},{data:Object(b.a)(Object(b.a)({},K.data),{},Object(Y.a)({},Number(x),{finishedTopics:_,attendanceList:B}))})})}})})).finally(function(){return y(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:m,userCoursesTopics:v}}var Za=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],qa=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(Re.a)(new Date(a.date_from),A.c)}}],er=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(Re.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],tr=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(Re.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),A.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],pt=6,ar=function(r){var a,n,t,c,l=r.user_id,o=r.group_id,m=Object(Z.b)(),y=m.semester_subject_id,p=Xa(l,y),g=p.studentExams,v=ka(o,l),d=v.finalGrades,f=v.deleteFinalGrade,x=Ha(),O=x.gradeTerms,T=za((a=d.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),C=T.subjectGradeScales,_=Ja(y,(n=d.data)===null||n===void 0?void 0:n.tutor_id,(t=d.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),B=_.tutorGradeScales,K=Ya(o,l),de=K.userAttendanceSchedules,Ie=K.fetchUserAttendanceSchedules,P=Qa(o,l),$=P.userCourses,F=P.userCoursesStats,k=P.userCoursesTopics,Pe=E.a.useForm(),He=Object(G.a)(Pe,1),ae=He[0],se=Object(j.useMemo)(function(){var X;return((X=O.data)!==null&&X!==void 0?X:[]).map(function(Q){var te=Q.id,be=Q.name;return{label:be,value:te}})},[O.data]),z=Object(j.useMemo)(function(){var X;return((X=C.data)!==null&&X!==void 0?X:[]).map(function(Q){var te=Q.name,be=Q.id;return{label:te,value:be}})},[C.data]),ge=Object(j.useMemo)(function(){var X,Q;return Xt((X=g.data)!==null&&X!==void 0?X:[],(Q=B.data)!==null&&Q!==void 0?Q:[])},[g.data,B.data]),Ke=Object(j.useCallback)(function(){var X=Object(R.a)(Object(h.a)().mark(function Q(te){var be,We,rt,Oe,Ve,Fe,ke;return Object(h.a)().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:if(rt=te.grade_scale_id,Oe=te.grade_term_id,((be=d.data)===null||be===void 0?void 0:be.id)!==void 0){Ne.next=3;break}return Ne.abrupt("return");case 3:if(Ve=(We=d.data)===null||We===void 0?void 0:We.grades.find(function(lt){var Nt=lt.grade_term;return Nt.id===Oe}),!Ve){Ne.next=11;break}return Ne.next=7,kt(Ve.id,{grade_scale_id:rt});case 7:return Fe=Ne.sent,it.b[Fe.success?"success":"error"](Fe.message),Fe.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades")),Ne.abrupt("return");case 11:return Ne.next=13,Vt({grade_scale_id:rt,grade_term_id:Oe,lesson_group_user_id:d.data.id});case 13:ke=Ne.sent,it.b[ke.success?"success":"error"](ke.message),ke.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades"));case 16:case"end":return Ne.stop()}},Q)}));return function(Q){return X.apply(this,arguments)}}(),[d.data,y]),xe=Object(j.useMemo)(function(){return[].concat(tr,[{title:Object(e.jsx)(s.a,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Q,te){var be;return typeof(te==null||(be=te.grade)===null||be===void 0?void 0:be.id)=="number"?[Object(e.jsx)(st.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return f(te.grade.id)},okText:Object(e.jsx)(s.a,{id:"yes",defaultMessage:"Yes"}),cancelText:Object(e.jsx)(s.a,{id:"no",defaultMessage:"No"}),children:Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(re.a,{type:"primary",icon:Object(e.jsx)(ue.a,{}),danger:!0})})},"delete")]:[]}}])},[]),ze=Object(j.useMemo)(function(){var X;return((X=O.data)!==null&&X!==void 0?X:[]).map(function(Q){var te;return Object(b.a)(Object(b.a)({},Q),{},{grade:(te=d.data)===null||te===void 0?void 0:te.grades.find(function(be){var We=be.grade_term;return We.id===Q.id})})})},[d.data,O.data]),qe=$.loading&&!$.data||F.loading&&!F.data||k.loading&&!k.data,le=Boolean($.data&&F.data&&k.data);return d.loading?Object(e.jsx)(me.a,{}):Object(e.jsxs)(e.Fragment,{children:[d.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:d.data.user})}),Object(e.jsx)(Ct.a,{})]}),Object(e.jsxs)(ie.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:pt},dataSource:g.data,loading:g.loading,columns:er,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:pt},dataSource:ze,loading:d.loading||O.loading,columns:xe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:pt},cardProps:{bodyStyle:{padding:0}},dataSource:de.data,loading:de.loading,columns:[].concat(qa,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Q,te){return Object(e.jsx)(_t,{groupAttendanceScheduleId:te.id,studentId:l,attendance:te.attendance.value,onSuccess:Ie})}}])})}),Object(e.jsx)(L.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:pt},cardProps:{bodyStyle:{padding:0}},dataSource:B.data,loading:B.loading,columns:Za})}),qe&&Object(e.jsx)(me.a,{}),le&&((c=$.data)===null||c===void 0?void 0:c.map(function(X){var Q,te,be,We,rt,Oe,Ve,Fe,ke=X.id,dt=X.title;return Object(e.jsxs)(L.a,{span:24,children:[Object(e.jsx)(Ye.a.Text,{style:{fontSize:"16px",fontWeight:500},children:dt}),Object(e.jsx)(Jt.c,{course_id:Number(ke),topics:(Q=(te=k.data)===null||te===void 0?void 0:te[Number(ke)])!==null&&Q!==void 0?Q:[],stats:(be=(We=F.data)===null||We===void 0||(rt=We[Number(ke)])===null||rt===void 0?void 0:rt.finishedTopics)!==null&&be!==void 0?be:[]}),Object(e.jsx)(Jt.a,{stats:(Oe=(Ve=F.data)===null||Ve===void 0||(Fe=Ve[Number(ke)])===null||Fe===void 0?void 0:Fe.attendanceList)!==null&&Oe!==void 0?Oe:[]})]},ke)}))]}),Object(e.jsx)(E.a,{form:ae,onFinish:Ke,children:Object(e.jsxs)(E.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(zt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:se,width:"sm",fieldProps:{loading:O.loading}}),Object(e.jsx)(zt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:z,fieldProps:{loading:d.loading||C.loading}}),Object(e.jsx)(E.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:ge}})})]})})]})},rr=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,c=n.grade_term,l=n.id;return Object(e.jsxs)(Ye.a.Text,{children:[c.name,": ",t]},l)}):"-"})}}],nr=function(){var r,a,n=Object(oe.k)(),t=Object(j.useMemo)(function(){var g,v,d,f;return{user_id:Number.isNaN(Number((g=n.query)===null||g===void 0?void 0:g.user_id))?null:Number((v=n.query)===null||v===void 0?void 0:v.user_id),group_id:Number.isNaN(Number((d=n.query)===null||d===void 0?void 0:d.group_id))?null:Number((f=n.query)===null||f===void 0?void 0:f.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,l=t.group_id,o=Object(Z.b)(),m=o.teacherSubjectData,y=o.semester_subject_id,p=Object(j.useMemo)(function(){var g;return((g=m==null?void 0:m.groups)!==null&&g!==void 0?g:[]).map(function(v){var d=v.id,f=v.name;return{label:f,value:d}})},[m==null?void 0:m.groups]);return c!==null&&l!==null?Object(e.jsx)(ar,{user_id:c,group_id:l}):Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var g=Object(R.a)(Object(h.a)().mark(function v(d){var f,x,O,T,C,_,B,K,de,Ie;return Object(h.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return x=d.group_id,O=x===void 0?[]:x,T=d.first_name,C=T===void 0?"":T,_=d.last_name,B=_===void 0?"":_,K=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function(F){var k=F.id;return k}),$.next=4,Bt(O.length===0?K:O);case 4:if(de=$.sent,de.success){$.next=7;break}return $.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ie=de.data.filter(function(F){var k=F.user;return k.first_name.toLowerCase().includes(C.toLowerCase())&&k.last_name.toLowerCase().includes(B.toLowerCase())}),$.abrupt("return",{success:!0,total:Ie.length,data:Ie});case 9:case"end":return $.stop()}},v)}));return function(v){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(v,d){return Object(e.jsx)(ne.a,{type:"Students",type_id:d.group_id},d.group_id)}}].concat(rr,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(v,d){return[Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(d.user.id,"&group_id=").concat(d.group_id),children:Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(re.a,{type:"primary",icon:Object(e.jsx)(ut.a,{})})})},"edit")]}}])})},sr=i("dF/Y"),ur=i("o+0V"),qt=i("0WSk"),cr=["type","defaultRender"],ir=["type","defaultRender"],dr=function(r){var a=r.url;return Object(e.jsx)(Ue.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(re.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(sr.a,{})})})},lr=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(Re.a)(new Date(a.created_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,l=Object(Ot.a)(a,cr);if(t==="form")return null;var o=n.getFieldValue("state");return Object(e.jsx)(qt.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(r,a){var n,t;return Object(e.jsx)(ne.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id,text:a!=null&&(n=a.created_by)!==null&&n!==void 0&&n.first_name&&a!==null&&a!==void 0&&(t=a.created_by)!==null&&t!==void 0&&t.last_name?"".concat(a.created_by.first_name," ").concat(a.created_by.last_name):void 0},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(Re.a)(new Date(a.exported_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,l=Object(Ot.a)(a,ir);if(t==="form")return null;var o=n.getFieldValue("state");return Object(e.jsx)(qt.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(r,a){var n,t;return Object(e.jsx)(ne.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id,text:a!=null&&(n=a.exported_by)!==null&&n!==void 0&&n.first_name&&a!==null&&a!==void 0&&(t=a.exported_by)!==null&&t!==void 0&&t.last_name?"".concat(a.exported_by.first_name," ").concat(a.exported_by.last_name):void 0},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(dr,{url:a.url},"download")]}}],or=function(){var r,a,n=Object(Z.b)(),t=n.teacherSubjectData,c=Object(j.useMemo)(function(){var o;return((o=t==null?void 0:t.groups)!==null&&o!==void 0?o:[]).map(function(m){var y=m.id,p=m.name;return{value:y,label:p}})},[t==null?void 0:t.groups]),l=Object(j.useMemo)(function(){var o,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(o=t.groups)===null||o===void 0||(m=o[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(lr)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var o=Object(R.a)(Object(h.a)().mark(function m(y){var p,g,v,d,f,x,O;return Object(h.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return v=y.group_id,d=v===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:v,f=y.created_by,x=y.exported_by,C.next=3,Object(ur.a)({group_id:d,created_by:f,exported_by:x});case 3:if(O=C.sent,O.success){C.next=6;break}return C.abrupt("return",{success:!1,data:[],total:0});case 6:return C.abrupt("return",{success:!0,data:O.data,total:O.data.length});case 7:case"end":return C.stop()}},m)}));return function(m){return o.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500}})},jr=function(r,a){var n;return(n=r.find(function(t){return t.name===a}))===null||n===void 0?void 0:n.id},br=function(r){var a=r.term,n=r.gradeScales,t=r.defaultFinalGrade,c=r.finalGrades,l=Object(j.useState)(t),o=Object(G.a)(l,2),m=o[0],y=o[1],p=Object(j.useState)(!1),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(j.useMemo)(function(){return n.map(function(O){var T=O.name,C=O.id;return{value:C,label:T}})},[n]),x=Object(j.useCallback)(function(O){if(!!(c!=null&&c.id)){if(O===void 0){if(!m)return;d(!0),Ht(m.id).then(function(T){!T.success||y(void 0)}).finally(function(){return d(!1)});return}if(m){d(!0),kt(m.id,{grade_scale_id:O}).finally(function(){return d(!1)});return}d(!0),Vt({grade_term_id:a.id,grade_scale_id:O,lesson_group_user_id:c.id}).then(function(T){if(T.success){var C=T.data.grades.find(function(_){return _.grade_term.id===a.id});y(C)}}).finally(function(){return d(!1)})}},[m,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(ft.a,{allowClear:!0,loading:v,disabled:v,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:x,options:f,defaultValue:jr(n,t==null?void 0:t.grade_name)}):null},mr=i("LvDl"),fr=function(r){var a=r.exam_id,n=r.result,t=r.student_id,c=r.onSuccess,l=Object(j.useCallback)(Object(mr.debounce)(function(o){Me(a,t,{result:o!=null?o:0}).then(function(m){m.success&&(c==null||c(m.data))})},300),[a,n,t]);return Object(e.jsx)(Be.a,{type:"number",min:0,max:100,onChange:l,defaultValue:n})},vr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ee.a)(n),[{title:Object(Re.a)(new Date(t.date_from),A.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(l,o){return Object(e.jsx)(_t,{groupAttendanceScheduleId:t.id,attendance:o["attendance-".concat(t==null?void 0:t.date_from)],studentId:o.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Or=function(r,a){return r.reduce(function(n,t){var c=t.attendances.find(function(l){return l.user_id===a});return c?Object(b.a)(Object(b.a)({},n),{},Object(Y.a)({},"attendance-".concat(t.date_from),c.value)):n},{})},pr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ee.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(l,o){var m;return(o==null||(m=o["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(fr,{result:o==null?void 0:o["exam-".concat(t.id)].result,exam_id:t.id,student_id:o.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},hr=function(r){return r.reduce(function(a,n){var t=n.result,c=n.id;return Object(b.a)(Object(b.a)({},a),{},Object(Y.a)({},"exam-".concat(c),t))},{})},gr=function(r,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(c,l){return Object(e.jsx)(br,{defaultFinalGrade:l["final-grade-".concat(n.id)],finalGrades:l.final_grades,term:n,gradeScales:a})}}})}},xr=function(r,a){return r.find(function(n){return n.user.id===a})},Sr=function(r){var a;return((a=r==null?void 0:r.grades)!==null&&a!==void 0?a:[]).reduce(function(n,t){return Object(b.a)(Object(b.a)({},n),{},Object(Y.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},yr=function(){var r,a,n=Object(Z.b)(),t=n.teacherSubjectData,c=n.semester_subject_id,l=Object(j.useState)([]),o=Object(G.a)(l,2),m=o[0],y=o[1],p=Object(j.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),g=Object(G.a)(p,2),v=g[0],d=g[1],f=Object(s.l)(),x=Object(j.useMemo)(function(){var C;return((C=t==null?void 0:t.groups)!==null&&C!==void 0?C:[]).map(function(_){var B=_.id,K=_.name;return{value:B,label:K}})},[t==null?void 0:t.groups]),O=Object(j.useRef)(),T=Object(j.useMemo)(function(){var C;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:x,defaultValue:x==null||(C=x[0])===null||C===void 0?void 0:C.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ee.a)(m))},[x,m]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var C=Object(R.a)(Object(h.a)().mark(function _(B){var K,de,Ie,P,$,F,k,Pe,He,ae,se,z,ge,Ke,xe,ze,qe,le,X,Q,te,be,We;return Object(h.a)().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return F=B.group_id,k=F===void 0?(K=x[0])===null||K===void 0?void 0:K.value:F,Pe=B.full_name,He=Pe===void 0?"":Pe,Oe.next=3,Bt(k);case 3:if(ae=Oe.sent,se=x.find(function(Ve){var Fe=Ve.value;return Fe===k}),!(!ae.success||ae.data[0]===void 0||c===null)){Oe.next=8;break}return it.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:se==null?void 0:se.label})),Oe.abrupt("return",{data:[],total:0,success:!1});case 8:return Oe.next=10,Promise.all([Object(ht.b)(k),xt(k),M({group_id:k,per_page:-1}),Tt(c,(de=ae.data)===null||de===void 0||(Ie=de[0])===null||Ie===void 0?void 0:Ie.tutor_id),Kt(),Wt((P=ae.data)===null||P===void 0||($=P[0])===null||$===void 0?void 0:$.s_subject_scale_form_id)]);case 10:if(z=Oe.sent,ge=Object(G.a)(z,6),Ke=ge[0],xe=ge[1],ze=ge[2],qe=ge[3],le=ge[4],X=ge[5],!(!Ke.success||!xe.success||!ze.success||!qe.success||!le.success||!X.success||!se)){Oe.next=21;break}return it.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:se==null?void 0:se.label})),Oe.abrupt("return",{data:[],total:0,success:!1});case 21:return d(se.label),Q=vr(xe.data),te=pr(ze.data),be=gr(le.data,X.data),y([Q,te,be,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),We=Ke.data.users.reduce(function(Ve,Fe){var ke,dt,Ne,lt=Fe.id,Nt=Fe.academic_teacher_id,Cr=Fe.first_name,Tr=Fe.last_name,ea="".concat(Tr," ").concat(Cr);if(Nt!==null||!ea.toLowerCase().includes(He.toLowerCase()))return Ve;var Er=Or(xe.data,lt),ta=Yt(ze.data,lt),jt=xr(ae.data,lt),Gr=(ke=Qt((dt=jt==null?void 0:jt.s_subject_scale_form_id)!==null&&dt!==void 0?dt:0,(Ne=qe.data.grade_scale)!==null&&Ne!==void 0?Ne:[]))!==null&&ke!==void 0?ke:[],Mr=Xt(ta,Gr),Ir=hr(ta),Fr=Sr(jt);return[].concat(Object(ee.a)(Ve),[Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({id:lt,full_name:ea},Er),Ir),Fr),{},{proposed_grade:Mr,final_grades:jt})])},[]).sort(function(Ve,Fe){return Ve.full_name.localeCompare(Fe.full_name)}),Oe.abrupt("return",{data:We,total:We.length,success:!0});case 28:case"end":return Oe.stop()}},_)}));return function(_){return C.apply(this,arguments)}}(),columns:T,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:v}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:O,pagination:{onChange:function(){var _;return(_=O.current)===null||_===void 0?void 0:_.reload()}},rowKey:"id"})},_r=function(r){var a,n,t=r.tab,c=Object(s.l)(),l=Object(s.m)("@@initialState"),o=l.setInitialState,m=l.initialState,y=Object(Z.b)(),p=y.teacherSubjectData,g=y.semester_subject_id,v=y.tutors,d=Object(j.useCallback)(Object(Ee.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(j.useMemo)(function(){return!!v.data.find(function(x){var O,T=x.id;return T===(m==null||(O=m.currentUser)===null||O===void 0?void 0:O.id)})||d(Xe.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(pe.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(re.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(g),breadcrumbName:String((n=p.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(je.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(O){o(Object(b.a)({},m)),s.f.push("/teacher/subjects/".concat(g,"/").concat(O))}},children:[Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(Se.a,{})},"groups"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(ya,{})},"students"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(va,{})},"exams"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ua,{})},"schedule"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(yr,{})},"class-register"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(Ga,{})},"attendance"),f&&Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(wa,{})},"grades-scale"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(nr,{})},"final-grades"),Object(e.jsx)(je.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(or,{})},"file-exports-history")]})}):Object(e.jsx)(me.a,{})},Ur=we.default=function(){var u=Object(oe.l)(),r=u.subjectId,a=u.tab,n=a===void 0?"groups":a;return Object(e.jsx)(Z.a,{semester_subject_id:Number(r),children:Object(e.jsx)(_r,{tab:n})})}},p3I6:function(bt,we,i){"use strict";i.d(we,"b",function(){return Ee}),i.d(we,"c",function(){return Ae}),i.d(we,"a",function(){return ot});var b=i("miYZ"),$e=i("tsqr"),re=i("tJVT"),I=i("k1fw"),me=i("oBTY"),j=i("q1tI"),nt=i.n(j),s=i("9kvl"),et=i("Ty5D"),oe=i("H6aw"),je=i("/y+f"),pe=i("nKUr"),Xe=i.n(pe),Ee=nt.a.createContext({}),Z=function(){return Math.round(Math.random()*99999)},Se=function ue(W){return W.reduce(function(A,M){return[].concat(Object(me.a)(A),Object(me.a)(M.lessons?ue(M.lessons):[]),[M])},[])},Ae=function ue(W){return W.reduce(function(A,M){var S;return[].concat(Object(me.a)(A),Object(me.a)(M.lessons?ue(M.lessons):[]),Object(me.a)((S=M.topics)!==null&&S!==void 0?S:[]))},[])},st=function ue(W,A,M){return W.map(function(S){var ye,J;return Object(I.a)(Object(I.a)({},S),{},{lessons:S.lessons?ue(S.lessons,A,M):[],topics:S.id===A?[].concat(Object(me.a)((ye=S.topics)!==null&&ye!==void 0?ye:[]),[M]):(J=S.topics)!==null&&J!==void 0?J:[]})})},mt=function ue(W,A,M){return M?W.map(function(S){return Object(I.a)(Object(I.a)({},S),{},{lessons:[].concat(Object(me.a)(S.lessons?ue(S.lessons,A,M):[]),Object(me.a)(S.id===M?[A]:[]))})}):[].concat(Object(me.a)(W),[A])},Ue=function ue(W,A,M){return W.map(function(S){return Object(I.a)(Object(I.a)({},S.id===A?M:S),{},{lessons:S.lessons?ue(S.lessons,A,M):[]})})},h=function ue(W,A){return W.map(function(M){return Object(I.a)(Object(I.a)({},M),{},{parent_id:A,lessons:M.lessons?ue(M.lessons,M.id):[]})})},R=function ue(W,A){return W.filter(function(M){return M.id!==A}).map(function(M){return Object(I.a)(Object(I.a)({},M),{},{lessons:M.lessons?ue(M.lessons,A):[]})})},Re=function ue(W,A){return W.map(function(M){return Object(I.a)(Object(I.a)({},M),{},{lessons:M.lessons?ue(M.lessons,A):[],topics:M.topics?M.topics.filter(function(S){return S.id!==A}):[]})})},ut=function ue(W,A,M,S){return S==null?void 0:S.map(function(ye){if(ye.id===M){var J;return Object(I.a)(Object(I.a)({},ye),{},{topics:(J=ye.topics)===null||J===void 0?void 0:J.map(function(_e){return _e.id===W?A.file.response.data:_e})})}else if(ye.lessons)return Object(I.a)(Object(I.a)({},ye),{},{lessons:ue(W,A,M,ye.lessons||[])});return ye})},ot=function(W){var A=W.children,M=W.id,S=Object(j.useState)(),ye=Object(re.a)(S,2),J=ye[0],_e=ye[1],at=Object(s.l)(),tt=Object(j.useMemo)(function(){return J&&J.lessons?Ae(J.lessons):[]},[J]),Ge=Object(j.useMemo)(function(){return J&&J.lessons?Se(J.lessons):[]},[J]),Ce=Object(j.useState)([]),Te=Object(re.a)(Ce,2),Me=Te[0],De=Te[1],he=Object(et.k)();Object(j.useEffect)(function(){De([])},[]);var ce=Object(j.useCallback)(function(){Object(oe.n)(M).then(function(D){return D.success&&_e(Object(I.a)(Object(I.a)({},D.data),{},{lessons:h(D.data.lessons)}))})},[M]);Object(j.useEffect)(function(){ce()},[ce]);var ne=Object(j.useCallback)(function(D){var N=Ge.find(function(U){var w;return U==null||(w=U.topics)===null||w===void 0?void 0:w.find(function(H){return H.id===D})});return N?N.id:null},[Ge]),Je=Object(j.useMemo)(function(){var D,N;return(D=he.query)!==null&&D!==void 0&&D.lesson?{mode:"lesson",id:Number(he.query.lesson),value:Ge.find(function(U){return U.id===Number(he.query.lesson)})}:(N=he.query)!==null&&N!==void 0&&N.topic?{mode:"topic",id:Number(he.query.topic),value:tt.find(function(U){return U.id===Number(he.query.topic)})}:{mode:"init"}},[he.query,J,Ge,tt]),Be=Object(j.useCallback)(function(D){var N={course_id:M,topics:[],isNew:!0,id:J?J.lessons.length+1:Z(),order:0,title:at.formatMessage({id:"add_title_here"}),active:!0,parent_id:D};return _e(function(U){var w;return Object(I.a)(Object(I.a)({},U),{},{lessons:mt((w=U==null?void 0:U.lessons)!==null&&w!==void 0?w:[],N,D)})}),N},[M,J]),G=Object(j.useCallback)(function(D,N){var U=Ge.find(function(H){return H.id===D}),w=U&&U.isNew;return(w?Object(oe.g)(N):Object(oe.v)(D,N)).then(function(H){return $e.b.success(H.message),ce(),H.success&&_e(function(V){var Y;return Object(I.a)(Object(I.a)({},V),{},{lessons:Ue((Y=V==null?void 0:V.lessons)!==null&&Y!==void 0?Y:[],D,Object(I.a)(Object(I.a)({},H.data),{},{isNew:!1}))})})})},[J]),fe=Object(j.useCallback)(function(D){var N=Ge.find(function(w){return w.id===D});if(!!N){var U=N.isNew;U?_e(function(w){var H;return Object(I.a)(Object(I.a)({},w),{},{lessons:R((H=w==null?void 0:w.lessons)!==null&&H!==void 0?H:[],D)})}):Object(oe.p)(D).then(function(w){w.success&&($e.b.success(w.message),_e(function(H){var V;return Object(I.a)(Object(I.a)({},H),{},{lessons:R((V=H==null?void 0:H.lessons)!==null&&V!==void 0?V:[],D)})}))})}},[J]),ie=Object(j.useCallback)(function(D,N){var U,w=ne(D),H=Ge.find(function(ee){return ee.id===w}),V=H&&((U=H.topics)===null||U===void 0?void 0:U.find(function(ee){return ee.id===D})),Y=V==null?void 0:V.isNew;return(Y?Object(oe.h)(N):Object(oe.w)(D,N)).then(function(ee){ee.success&&($e.b.success(ee.message),ce(),s.f.push("/courses/list/".concat(M,"/program/?topic=").concat(ee.data.id)),(V==null?void 0:V.topicable_type)===je.j.Video&&setTimeout(function(){ce()},5e3))})},[ne,J,ce]),ve=Object(j.useCallback)(function(D){var N=ne(D),U=Ge.find(function(V){return V.id===N});if(!!U){var w=tt==null?void 0:tt.find(function(V){return V.id===D}),H=w==null?void 0:w.isNew;H&&!w.topicable?_e(function(V){var Y;return Object(I.a)(Object(I.a)({},V),{},{lessons:Re((Y=V==null?void 0:V.lessons)!==null&&Y!==void 0?Y:[],D)})}):Object(oe.q)(D).then(function(V){V.success&&($e.b.success(V.message),_e(function(Y){var ee;return Object(I.a)(Object(I.a)({},Y),{},{lessons:Re((ee=Y==null?void 0:Y.lessons)!==null&&ee!==void 0?ee:[],D)})}))})}},[J,ne]),L=Object(j.useCallback)(function(D,N){var U={lesson_id:D,isNew:!0,id:Z(),title:at.formatMessage({id:"add_title_here"}),active:!0,topicable_type:N};return _e(function(w){var H;return Object(I.a)(Object(I.a)({},w),{},{lessons:st((H=w==null?void 0:w.lessons)!==null&&H!==void 0?H:[],D,U)})}),U},[]),E=function(N,U){var w=ne(N);_e(function(H){return Object(I.a)(Object(I.a)({},H),{},{lessons:H?ut(N,U,w,H.lessons||[]):[]})}),s.f.push("/courses/list/".concat(M,"/program/?topic=").concat(U.file.response.data.id))},Le=Object(j.useCallback)(function(D){return Object(oe.d)(D).then(function(N){if(N.success){$e.b.success(N.message);var U=ne(D);_e(function(w){var H;return Object(I.a)(Object(I.a)({},w),{},{lessons:w?(H=w.lessons)===null||H===void 0?void 0:H.map(function(V){if(V.id===U){var Y=V.topics||[];return Object(I.a)(Object(I.a)({},V),{},{topics:[].concat(Object(me.a)(Y),[N.data])})}return V}):[]})})}})},[J,ne]),Qe=Object(j.useCallback)(function(D){return Object(oe.c)(D).then(function(N){N.success&&($e.b.success(N.message),_e(function(U){return Object(I.a)(Object(I.a)({},U),{},{lessons:U?[].concat(Object(me.a)(U.lessons),[N.data]):[]})}))})},[]),q={state:J,h5ps:Me,id:M,addNewLesson:Be,updateLesson:G,updateTopic:ie,deleteLesson:fe,addNewTopic:L,deleteTopic:ve,onTopicUploaded:E,cloneTopic:Le,cloneLesson:Qe,currentEditMode:Je,getLessons:ce};return Object(pe.jsx)(Ee.Provider,{value:q,children:A})}},"w/VK":function(bt,we,i){"use strict";i.d(we,"c",function(){return me}),i.d(we,"a",function(){return nt}),i.d(we,"b",function(){return et});var b=i("qLMh"),$e=i("k1fw"),re=i("9og8"),I=i("9kvl");function me(je,pe){return j.apply(this,arguments)}function j(){return j=Object(re.a)(Object(b.a)().mark(function je(pe,Xe){return Object(b.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",Object(I.i)("/api/admin/reports/report",Object($e.a)({params:pe,method:"GET",useCache:!1},Xe||{})));case 1:case"end":return Z.stop()}},je)})),j.apply(this,arguments)}function nt(je,pe,Xe){return s.apply(this,arguments)}function s(){return s=Object(re.a)(Object(b.a)().mark(function je(pe,Xe,Ee){return Object(b.a)().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.abrupt("return",Object(I.i)("/api/admin/stats/course/".concat(pe,"/export"),Object($e.a)({params:Xe,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return Se.stop()}},je)})),s.apply(this,arguments)}function et(je,pe,Xe){return oe.apply(this,arguments)}function oe(){return oe=Object(re.a)(Object(b.a)().mark(function je(pe,Xe,Ee){return Object(b.a)().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.abrupt("return",Object(I.i)("/api/admin/stats/topic/".concat(pe,"/export"),Object($e.a)({method:"GET",useCache:!1,params:{stat:Xe},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return Se.stop()}},je)})),oe.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.78876037.async.js.map