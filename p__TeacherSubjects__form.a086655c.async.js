(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"/y+f":function(ft,ve,s){"use strict";s.d(ve,"f",function(){return l}),s.d(ve,"d",function(){return M}),s.d(ve,"e",function(){return ue}),s.d(ve,"c",function(){return Ye}),s.d(ve,"a",function(){return u}),s.d(ve,"b",function(){return Te});var l;(function(b){b.Unselected="",b.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",b.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",b.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",b.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",b.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",b.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",b.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",b.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",b.Project="EscolaLms\\TopicTypeProject\\Models\\Project",b.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(l||(l={}));var Se;(function(b){b.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",b.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(Se||(Se={}));var me;(function(b){b.draft="draft",b.published="published",b.archived="archived"})(me||(me={}));var M;(function(b){b.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",b.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",b.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(M||(M={}));var ue;(function(b){b.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(ue||(ue={}));var o;(function(b){b.cart_fixed="cart_fixed",b.cart_percent="cart_percent",b.product_fixed="product_fixed",b.product_percent="product_percent"})(o||(o={}));var Ye;(function(b){b.MULTIPLE_CHOICE="multiple_choice",b.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",b.TRUE_FALSE="true_false",b.SHORT_ANSWERS="short_answers",b.MATCHING="matching",b.NUMERICAL_QUESTION="numerical_question",b.ESSAY="essay",b.DESCRIPTION="description"})(Ye||(Ye={}));var u;(function(b){b.PRESENT="present",b.ABSENT="absent"})(u||(u={}));var Te;(function(b){b.Manual="manual",b.TeamsForms="teams_forms",b.TeamsLecture="teams_lecture",b.TestPortal="test_portal"})(Te||(Te={}))},"5R/X":function(ft,ve,s){},"5Syx":function(ft,ve,s){"use strict";s.d(ve,"c",function(){return N}),s.d(ve,"b",function(){return v}),s.d(ve,"a",function(){return Ke});var l=s("OaEy"),Se=s("2fM7"),me=s("g9YV"),M=s("wCAj"),ue=s("14J3"),o=s("BMrR"),Ye=s("BoS7"),u=s("Sdc0"),Te=s("jrin"),b=s("k1fw"),B=s("DYRE"),$e=s("zeV3"),fe=s("+BJd"),le=s("mr32"),Oe=s("oBTY"),at=s("tJVT"),Ne=s("q1tI"),ot=s.n(Ne),bt=s("nhC9"),Ze=s("LDJE"),g=s("9kvl"),K=s("Vpfc"),We=s("+L6B"),Be=s("2/Rp"),st=s("qLMh"),he=s("9og8"),de=s("4KAj"),q=s("w/VK"),O=s("nKUr"),Y=function(oe){var De=oe.course_id,Me=oe.stat,Re=Me===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Me,pe=Object(Ne.useState)(!1),ee=Object(at.a)(pe,2),_e=ee[0],ge=ee[1],ze=Object(Ne.useCallback)(function(Ve){return Object(he.a)(Object(st.a)().mark(function xe(){var ce,ie;return Object(st.a)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return ge(!0),L.prev=1,L.next=4,Object(q.a)(Ve,{stat:Re});case 4:ce=L.sent,ce instanceof Blob&&(ie=document.createElement("a"),ie.href=window.URL.createObjectURL(ce),ie.download="finished_topics_".concat(De,".xlsx"),document.body.appendChild(ie),ie.click(),document.body.removeChild(ie)),L.next=11;break;case 8:L.prev=8,L.t0=L.catch(1),console.error(L.t0);case 11:return L.prev=11,ge(!1),L.finish(11);case 14:case"end":return L.stop()}},xe,null,[[1,8,11,14]])}))},[Re]);return Object(O.jsxs)(Be.a,{type:"primary",loading:_e,onClick:ze(De),children:[Object(O.jsx)(de.a,{})," ",Object(O.jsx)(g.a,{id:"export"})]})},Ie=function(oe){return oe.topicable.content.contents?Object.values(oe.topicable.content.contents)[0].library:"H5P"},N=function(oe){var De=oe.course_id,Me=oe.topics,Re=oe.stats,pe=Object(Ne.useState)(!1),ee=Object(at.a)(pe,2),_e=ee[0],ge=ee[1],ze=Object(Ne.useMemo)(function(){return[{title:Object(O.jsx)(g.a,{id:"user"}),dataIndex:"id",render:function(ce){return Object(O.jsx)(K.a,{type:"App\\Models\\User",type_id:ce})}},{title:Object(O.jsx)(g.a,{id:"email"}),dataIndex:"email"}].concat(Object(Oe.a)(Me.map(function(xe){var ce,ie=(ce=xe.topicable_type)===null||ce===void 0?void 0:ce.split("\\").pop();return ie==="H5P"&&(ie=Ie(xe)),{render:function(L){var R=0,Q=0;switch(L&&(L.started_at&&L.finished_at?R=1:L.started_at&&(R=2),Q=L.seconds/60),R){case 1:return Object(O.jsxs)($e.b,{children:[Object(O.jsx)(le.a,{color:"success",children:"F"}),_e&&Object(O.jsxs)("small",{children:[Q.toFixed(2),"m"]})]});case 2:return Object(O.jsxs)($e.b,{children:[Object(O.jsx)(le.a,{color:"blue",children:"S"}),_e&&Object(O.jsxs)("small",{children:[Q.toFixed(2),"m"]})]});case 0:default:return Object(O.jsx)(ot.a.Fragment,{children:Object(O.jsx)(le.a,{color:"error",children:"N"})})}},title:Object(O.jsxs)("small",{children:[Object(O.jsx)(le.a,{children:ie})," ",xe.title]}),dataIndex:xe.id}})))},[Me,_e]),Ve=Object(Ne.useMemo)(function(){return Re.map(function(xe){return Me.reduce(function(ce,ie){var A=xe.topics.find(function(L){return L.id===ie.id});return Object(b.a)(Object(b.a)({},ce),{},Object(Te.a)({},Number(ie.id),A!=null?A:0))},{email:xe.email,id:xe.id})})},[Re,Me]);return Object(O.jsx)(M.a,{title:function(){return Object(O.jsxs)(o.a,{justify:"space-between",align:"middle",children:[Object(O.jsxs)($e.b,{children:[Object(O.jsx)(g.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(O.jsx)(le.a,{color:"success",children:"F"}),Object(O.jsx)(g.a,{id:"Started",defaultMessage:"Started:"})," ",Object(O.jsx)(le.a,{color:"blue",children:"S"}),Object(O.jsx)(g.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(O.jsx)(le.a,{color:"error",children:"N"}),Object(O.jsx)(g.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(O.jsx)(u.a,{checked:_e,onChange:function(ie){return ge(ie)}})]}),Object(O.jsx)(Y,{course_id:De})]})},columns:ze,dataSource:Ve,size:"small",scroll:{x:1500}})},v=function(oe){var De=oe.stats,Me=Object(Ne.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(ee){return Object(O.jsx)(K.a,{type:"App\\Models\\User",type_id:ee})}},{title:"email",dataIndex:"email"},{title:Object(O.jsx)(g.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Re=Object(Ne.useMemo)(function(){return De.map(function(pe){var ee=pe.id,_e=pe.email,ge=pe.finished_at;return{id:ee,email:_e,finished_at:ge}})},[De]);return Object(O.jsx)(M.a,{title:function(){return Object(O.jsx)($e.b,{children:Object(O.jsx)(g.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Me,dataSource:Re,size:"small",scroll:{x:500}})},Ke=function(oe){var De=oe.stats,Me=Object(Ne.useState)(null),Re=Object(at.a)(Me,2),pe=Re[0],ee=Re[1],_e=Object(Ne.useState)(null),ge=Object(at.a)(_e,2),ze=ge[0],Ve=ge[1],xe=Object(g.l)(),ce=Object(Ne.useMemo)(function(){return De.flatMap(function(A){return Object.values(A.attempts).flatMap(function(L){var R=L.dates,Q=L.attempt,mt=Object.values(R).flatMap(function(et){var D=et.date,I=et.seconds_total;return{date:D,attempt:Q,seconds_total:I,email:A.email}});return mt})})},[De]),ie={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(O.jsx)(bt.a,{title:Object(O.jsxs)($e.b,{children:[Object(O.jsx)(g.a,{id:"course.interactions_time_in_days"}),Object(O.jsx)(Se.a,{showSearch:!0,value:pe,onChange:function(L){ee(L),Ve(null)},placeholder:Object(O.jsx)(g.a,{id:"select_person",defaultMessage:"Select a person"}),children:De.map(function(A){var L=A.id,R=A.email;return Object(O.jsx)(Se.a.Option,{value:R,children:R},L)})}),Object(O.jsx)(Se.a,{value:ze,onChange:function(L){return Ve(L)},disabled:pe===null,placeholder:Object(O.jsx)(g.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Oe.a)(new Set(ce.filter(function(A){var L=A.email;return L===pe}).map(function(A){var L=A.attempt;return L}))).map(function(A){return Object(O.jsxs)(Se.a.Option,{value:A,children:[Object(O.jsx)(g.a,{id:"attempt",defaultMessage:"Attempt"})," ",A]},A)})})]}),colSpan:12,layout:"center",children:Object(O.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(O.jsx)(Ze.a,Object(b.a)(Object(b.a)({},ie),{},{tooltip:{title:"".concat(xe.formatMessage({id:"attempt"})),formatter:function(L){var R=Math.floor(+L.seconds_total/60),Q=+L.seconds_total>60?+L.seconds_total-R*60:0;return{name:L.attempt,value:"".concat(R,"m ").concat(Q,"s")}}},data:ce.filter(function(A){var L=A.email;return L===pe}).filter(function(A){var L=A.attempt;return Number.isInteger(ze)?L===ze:!0})}))})})}},Hn4i:function(ft,ve,s){"use strict";var l=s("y8nQ"),Se=s("Vl3Y"),me=s("+L6B"),M=s("2/Rp"),ue=s("rePB"),o=s("ODXe"),Ye=s("Ff2n"),u=s("x+uP"),Te=s("HaE+"),b=s("VTBJ"),B=s("nKUr"),$e=s.n(B),fe=s("xvlK"),le=s("WuYN"),Oe=s("VMEa"),at=s("LQCs"),Ne=s("ft2k"),ot=s("uX+g"),bt=s("+i8S"),Ze=s("ipCM"),g=s("6cGi"),K=s("ub+h"),We=s("bG1m"),Be=s("q1tI"),st=s.n(Be),he=s("mWMg"),de=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],q=["record","position","creatorButtonText","newRecordType","parentKey","style"],O=st.a.createContext(void 0);function Y(v){var Ke=v.children,Ue=v.record,oe=v.position,De=v.newRecordType,Me=v.parentKey,Re=Object(Be.useContext)(O);return st.a.cloneElement(Ke,Object(b.a)(Object(b.a)({},Ke.props),{},{onClick:function(){var pe=Object(Te.a)(Object(u.a)().mark(function _e(ge){var ze,Ve,xe,ce;return Object(u.a)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(ze=(Ve=Ke.props).onClick)===null||ze===void 0?void 0:ze.call(Ve,ge);case 2:if(ce=A.sent,ce!==!1){A.next=5;break}return A.abrupt("return");case 5:Re==null||(xe=Re.current)===null||xe===void 0||xe.addEditRecord(Ue,{position:oe,newRecordType:De,parentKey:Me});case 6:case"end":return A.stop()}},_e)}));function ee(_e){return pe.apply(this,arguments)}return ee}()}))}function Ie(v){var Ke,Ue,oe=Object(at.d)(),De=v.onTableChange,Me=v.maxLength,Re=v.formItemProps,pe=v.recordCreatorProps,ee=v.rowKey,_e=v.controlled,ge=v.defaultValue,ze=v.onChange,Ve=v.editableFormRef,xe=Object(Ye.a)(v,de),ce=Object(Ne.a)(v.value),ie=Object(Be.useRef)(),A=Object(Be.useRef)();Object(Be.useImperativeHandle)(xe.actionRef,function(){return ie.current});var L=Object(g.a)(function(){return v.value||ge||[]},{value:v.value,onChange:v.onChange}),R=Object(o.a)(L,2),Q=R[0],mt=R[1],et=st.a.useMemo(function(){return typeof ee=="function"?ee:function(Le,k){return Le[ee]||k}},[ee]),D=function(k){if(typeof k=="number"&&!v.name){if(k>=Q.length)return k;var te=Q&&Q[k];return et==null?void 0:et(te,k)}if((typeof k=="string"||k>=Q.length)&&v.name){var re=Q.findIndex(function(je,Pe){var Ae;return(et==null||(Ae=et(je,Pe))===null||Ae===void 0?void 0:Ae.toString())===(k==null?void 0:k.toString())});return re}return k};Object(Be.useImperativeHandle)(Ve,function(){var Le=function(re){var je,Pe;if(re==null)throw new Error("rowIndex is required");var Ae=D(re),ut=[v.name,(je=Ae==null?void 0:Ae.toString())!==null&&je!==void 0?je:""].flat(1).filter(Boolean);return(Pe=A.current)===null||Pe===void 0?void 0:Pe.getFieldValue(ut)},k=function(){var re,je=[v.name].flat(1).filter(Boolean);if(Array.isArray(je)&&je.length===0){var Pe,Ae=(Pe=A.current)===null||Pe===void 0?void 0:Pe.getFieldsValue();return Array.isArray(Ae)?Ae:Object.keys(Ae).map(function(ut){return Ae[ut]})}return(re=A.current)===null||re===void 0?void 0:re.getFieldValue(je)};return Object(b.a)(Object(b.a)({},A.current),{},{getRowData:Le,getRowsData:k,setRowData:function(re,je){var Pe,Ae,ut,xt;if(re==null)throw new Error("rowIndex is required");var ht=D(re),Jt=[v.name,(Pe=ht==null?void 0:ht.toString())!==null&&Pe!==void 0?Pe:""].flat(1).filter(Boolean),vt=((Ae=A.current)===null||Ae===void 0||(ut=Ae.getFieldsValue)===null||ut===void 0?void 0:ut.call(Ae))||{},Mt=Object(We.a)(vt,Jt,Object(b.a)(Object(b.a)({},Le(re)),je||{}));return(xt=A.current)===null||xt===void 0?void 0:xt.setFieldsValue(Mt)}})}),Object(Be.useEffect)(function(){!v.controlled||Q.forEach(function(Le,k){var te;(te=A.current)===null||te===void 0||te.setFieldsValue(Object(ue.a)({},et(Le,k),Le))},{})},[Q,v.controlled]),Object(Be.useEffect)(function(){if(v.name){var Le;A.current=v==null||(Le=v.editable)===null||Le===void 0?void 0:Le.form}},[(Ke=v.editable)===null||Ke===void 0?void 0:Ke.form,v.name]);var I=pe||{},V=I.record,w=I.position,G=I.creatorButtonText,Z=I.newRecordType,Ge=I.parentKey,ne=I.style,zt=Object(Ye.a)(I,q),pt=w==="top",Ot=Object(Be.useMemo)(function(){return Me&&Me<=(Q==null?void 0:Q.length)?!1:pe!==!1&&Object(B.jsx)(Y,{record:Object(ot.a)(V,Q==null?void 0:Q.length,Q)||{},position:w,parentKey:Object(ot.a)(Ge,Q==null?void 0:Q.length,Q),newRecordType:Z,children:Object(B.jsx)(M.a,Object(b.a)(Object(b.a)({type:"dashed",style:Object(b.a)({display:"block",margin:"10px 0",width:"100%"},ne),icon:Object(B.jsx)(fe.a,{})},zt),{},{children:G||oe.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[pe,Me,Q==null?void 0:Q.length]),e=Object(Be.useMemo)(function(){return Ot?pt?{components:{header:{wrapper:function(k){var te,re=k.className,je=k.children;return Object(B.jsxs)("thead",{className:re,children:[je,Object(B.jsxs)("tr",{style:{position:"relative"},children:[Object(B.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:Ot}),Object(B.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(te=xe.columns)===null||te===void 0?void 0:te.length,children:Ot})]})]})}}}}:{tableViewRender:function(k,te){var re,je;return Object(B.jsxs)(B.Fragment,{children:[(re=(je=v.tableViewRender)===null||je===void 0?void 0:je.call(v,k,te))!==null&&re!==void 0?re:te,Ot]})}}:{}},[pt,Ot]),gt=Object(b.a)({},v.editable),Tt=Object(bt.a)(function(Le,k){var te,re,je;if((te=v.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Le,k),(je=v.onValuesChange)===null||je===void 0||je.call(v,k,Le),v.controlled){var Pe;v==null||(Pe=v.onChange)===null||Pe===void 0||Pe.call(v,k)}});return((v==null?void 0:v.onValuesChange)||((Ue=v.editable)===null||Ue===void 0?void 0:Ue.onValuesChange)||v.controlled&&(v==null?void 0:v.onChange))&&(gt.onValuesChange=Tt),Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(O.Provider,{value:ie,children:Object(B.jsx)(he.a,Object(b.a)(Object(b.a)(Object(b.a)({search:!1,options:!1,pagination:!1,rowKey:ee,revalidateOnFocus:!1},xe),e),{},{tableLayout:"fixed",actionRef:ie,onChange:De,editable:Object(b.a)(Object(b.a)({},gt),{},{formProps:Object(b.a)({formRef:A},gt.formProps)}),dataSource:Q,onDataSourceChange:function(k){if(mt(k),v.name&&w==="top"){var te,re=Object(We.a)({},[v.name].flat(1).filter(Boolean),k);(te=A.current)===null||te===void 0||te.setFieldsValue(re)}}}))}),v.name?Object(B.jsx)(le.a,{name:[v.name],children:function(k){var te,re,je=Object(K.a)(k,[v.name].flat(1)),Pe=je==null?void 0:je.find(function(Ae,ut){return!Object(Ze.a)(Ae,ce==null?void 0:ce[ut])});return Pe&&ce&&(v==null||(te=v.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Pe,je)),null}}):null]})}function N(v){var Ke=Oe.a.useFormInstance();return v.name?Object(B.jsx)(Se.a.Item,Object(b.a)(Object(b.a)({style:{maxWidth:"100%"}},v==null?void 0:v.formItemProps),{},{name:v.name,children:Object(B.jsx)(Ie,Object(b.a)(Object(b.a)({},v),{},{editable:Object(b.a)(Object(b.a)({},v.editable),{},{form:Ke})}))})):Object(B.jsx)(Ie,Object(b.a)({},v))}N.RecordCreator=Y,ve.a=N},LDJE:function(ft,ve,s){"use strict";var l=s("q1tI"),Se=s.n(l),me=s("ma/q"),M=s("ZIEt"),ue=s("QpZ9"),o=s("GzfL"),Ye=s("Scwr"),u=function(b,B){var $e={};for(var fe in b)Object.prototype.hasOwnProperty.call(b,fe)&&B.indexOf(fe)<0&&($e[fe]=b[fe]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var le=0,fe=Object.getOwnPropertySymbols(b);le<fe.length;le++)B.indexOf(fe[le])<0&&Object.prototype.propertyIsEnumerable.call(b,fe[le])&&($e[fe[le]]=b[fe[le]]);return $e},Te=Object(l.forwardRef)(function(b,B){var $e=b.chartRef,fe=b.style,le=fe===void 0?{height:"inherit"}:fe,Oe=b.className,at=b.loading,Ne=b.loadingTemplate,ot=b.errorTemplate,bt=u(b,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Ze=Object(M.a)(me.a,bt),g=Ze.chart,K=Ze.container;return Object(l.useEffect)(function(){Object(ue.a)($e,g.current)},[g.current]),Object(l.useImperativeHandle)(B,function(){return{getChart:function(){return g.current}}}),Se.a.createElement(o.a,{errorTemplate:ot},at&&Se.a.createElement(Ye.a,{loadingTemplate:Ne,theme:b.theme}),Se.a.createElement("div",{className:Oe,style:le,ref:K}))});ve.a=Te},olry:function(ft,ve,s){"use strict";s.r(ve);var l=s("k1fw"),Se=s("+L6B"),me=s("2/Rp"),M=s("T2oS"),ue=s("W9HT"),o=s("q1tI"),Ye=s.n(o),u=s("9kvl"),Te=s("55Ip"),b=s("Ty5D"),B=s("nhC9"),$e=s("tMyG"),fe=s("my69"),le=s("huej"),Oe=s("mJ0o"),at=s("EhlZ"),Ne=s("P2fV"),ot=s("NJEC"),bt=s("5Dmo"),Ze=s("3S7+"),g=s("qLMh"),K=s("9og8"),We=s("sWYD"),Be=s("G3dp"),st=s("VTBJ"),he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},de=he,q=s("6VBw"),O=function(r,a){return o.createElement(q.a,Object(st.a)(Object(st.a)({},r),{},{ref:a,icon:de}))};O.displayName="LineChartOutlined";var Y=o.forwardRef(O),Ie=s("/MfK"),N=s("Qiat"),v=s("mGZj");function Ke(i,r){return Ue.apply(this,arguments)}function Ue(){return Ue=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(l.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},i)})),Ue.apply(this,arguments)}function oe(i,r){return De.apply(this,arguments)}function De(){return De=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),De.apply(this,arguments)}function Me(i,r,a){return Re.apply(this,arguments)}function Re(){return Re=Object(K.a)(Object(g.a)().mark(function i(r,a,n){return Object(g.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),Re.apply(this,arguments)}function pe(i,r){return ee.apply(this,arguments)}function ee(){return ee=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),ee.apply(this,arguments)}function _e(i,r){return ge.apply(this,arguments)}function ge(){return ge=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(l.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},i)})),ge.apply(this,arguments)}function ze(i,r,a,n){return Ve.apply(this,arguments)}function Ve(){return Ve=Object(K.a)(Object(g.a)().mark(function i(r,a,n,t){return Object(g.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return d.stop()}},i)})),Ve.apply(this,arguments)}function xe(i,r,a){return ce.apply(this,arguments)}function ce(){return ce=Object(K.a)(Object(g.a)().mark(function i(r,a,n){return Object(g.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(l.a)({method:"DELETE"},n||{})));case 1:case"end":return c.stop()}},i)})),ce.apply(this,arguments)}var ie=s("Vpfc"),A=s("giR+"),L=s("fyUT"),R=s("tJVT"),Q=s("14J3"),mt=s("BMrR"),et=s("jCWc"),D=s("kPKH"),I=s("VMEa"),V=s("Qurx"),w=s("lR9U"),G=s("/y+f"),Z=s("2qtc"),Ge=s("kLXV"),ne=s("oBTY"),zt=s("OaEy"),pt=s("2fM7"),Ot=s("DBJ/"),e=s("nKUr"),gt=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,c=Object(Oe.b)(),d=c.semester_subject_id,m=c.teacherSubjectData,h=Object(o.useState)(null),E=Object(R.a)(h,2),p=E[0],x=E[1],_=Object(o.useMemo)(function(){var S;return((S=m==null?void 0:m.groups)!==null&&S!==void 0?S:[]).map(function(y){var T=y.id,P=y.name;return{label:P,value:T}})},[]),j={type:a,group_id:p,semester_subject_id:d},f=Object(o.useCallback)(function(S){if(S.success){var y=S.data.results.filter(function(T){var P=T.user_id;return P!==null});if(!y.length)return;n({exam_results:y,group_id:S.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(u.a,{id:"group"}),children:Object(e.jsx)(pt.a,{disabled:t,value:p,onChange:function(y){return x(y)},options:_,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(Ot.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(y){return!y.fileList.length&&n(void 0)},maxFiles:1,data:j,disabled:!p})]})},Tt=function(r){var a=r.onDataConverted,n=Object(Oe.b)(),t=n.teacherSubjectData,c=n.groupUsers,d=Object(o.useState)(null),m=Object(R.a)(d,2),h=m[0],E=m[1],p=Object(o.useMemo)(function(){var _;return((_=t==null?void 0:t.groups)!==null&&_!==void 0?_:[]).map(function(j){var f=j.id,S=j.name;return{label:S,value:f}})},[]),x=Object(o.useCallback)(function(_){var j;E(_);var f=(j=c.byId)===null||j===void 0?void 0:j[_];if(!!f){var S=f.users.reduce(function(y,T){var P=T.id,C=T.email,H=T.first_name,z=T.last_name,Ee=T.academic_teacher_id;return Ee!==null?y:[].concat(Object(ne.a)(y),[{email:C,first_name:H,last_name:z,user_id:P,result:0}])},[]);a({group_id:_,exam_results:S})}},[c.byId]);return Object(e.jsx)(pt.a,{value:h,onChange:x,options:p,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})},Le=[G.b.TeamsLecture,G.b.TestPortal,G.b.TeamsForms],k=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,c=r.type,d=Object(Oe.b)(),m=d.teacherSubjectData,h=d.fetchGroupUsers,E=Object(o.useState)(),p=Object(R.a)(E,2),x=p[0],_=p[1];return Object(o.useEffect)(function(){if(c===G.b.Manual&&a){var j;m==null||(j=m.groups)===null||j===void 0||j.forEach(function(f){var S=f.id;return h(S)})}},[c,a]),Object(e.jsxs)(Ge.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){x&&t(x)},okButtonProps:{disabled:!x},children:[Le.includes(c)&&Object(e.jsx)(gt,{type:c,onDataConverted:_,groupSelectDisabled:!!x}),c===G.b.Manual&&Object(e.jsx)(Tt,{onDataConverted:_})]})},te=function(r){var a=r.onSelect;return Object(e.jsxs)(mt.a,{gutter:[16,16],children:[Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(me.a,{type:"primary",onClick:function(){return a(G.b.TeamsForms)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(me.a,{type:"primary",onClick:function(){return a(G.b.TestPortal)},children:Object(e.jsx)(u.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(me.a,{type:"primary",onClick:function(){return a(G.b.TeamsLecture)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(me.a,{type:"primary",onClick:function(){return a(G.b.Manual)},children:Object(e.jsx)(u.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},re=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],je=function(r){var a,n=r.exam_id,t=I.a.useForm(),c=Object(R.a)(t,1),d=c[0],m=Object(o.useState)(),h=Object(R.a)(m,2),E=h[0],p=h[1],x=Object(o.useState)(),_=Object(R.a)(x,2),j=_[0],f=_[1],S=Object(o.useState)(!1),y=Object(R.a)(S,2),T=y[0],P=y[1],C=Object(Oe.b)(),H=C.semester_subject_id,z=C.getGroupById,Ee=Object(o.useMemo)(function(){var $;return(($=j==null?void 0:j.exam_results)!==null&&$!==void 0?$:[]).map(function(F){var U=F.user_id;return U})},[j==null?void 0:j.exam_results]);Object(o.useEffect)(function(){var $=Number(n);n==="new"&&(p(void 0),f(void 0),d.resetFields()),n!=="new"&&!Number.isNaN($)&&(P(!0),pe($).then(function(F){if(F.success){var U=F.data,se=U.type,Xe=U.results,Je=U.title,ye=U.weight,Fe=U.passed_at,J=U.group_id;p(se),f({group_id:J,exam_results:Xe}),d.setFieldsValue({title:Je,weight:ye,passed_at:Fe})}}).finally(function(){return P(!1)}))},[n]);var we=Object(o.useCallback)(function(){p(void 0),f(void 0)},[]);return T?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(k,{open:Boolean(E&&!j),type:E,closeModal:we,onSuccess:f}),Object(e.jsxs)(I.a,{form:d,submitter:E===void 0||!j?!1:void 0,onFinish:function(){var $=Object(K.a)(Object(g.a)().mark(function F(U){var se,Xe,Je,ye,Fe,J,Qe,ke,He,it;return Object(g.a)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:if(Xe=j==null||(se=j.exam_results)===null||se===void 0?void 0:se.every(function(X){var be=X.result;return typeof be=="number"&&be>=0&&be<=100}),!(j&&Xe&&typeof H=="number")){W.next=17;break}if(Je=U.title,ye=U.passed_at,Fe=U.weight,J=Number(n),Qe=j.exam_results,ke=j.group_id,He={type:E,semester_subject_id:H,title:Je,passed_at:ye,weight:Fe,group_id:ke,results:Qe},!Number.isNaN(J)){W.next=12;break}return W.next=9,oe(He);case 9:W.t0=W.sent,W.next=15;break;case 12:return W.next=14,Me(J,He);case 14:W.t0=W.sent;case 15:it=W.t0,it.success&&u.f.push("/teacher/subjects/".concat(H,"/exams"));case 17:return W.abrupt("return",!0);case 18:case"end":return W.stop()}},F)}));return function(F){return $.apply(this,arguments)}}(),onReset:we,children:[Object(e.jsxs)(I.a.Group,{children:[Object(e.jsx)(V.a,{label:Object(e.jsx)(u.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(w.a,{label:Object(e.jsx)(u.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(I.a.Item,{name:"weight",label:Object(e.jsx)(u.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(L.a,{})})]}),E&&j&&Object(e.jsx)(N.a,{rowKey:"user_id",headerTitle:(a=z(j.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:Ee,onValuesChange:function(F,U){return f({group_id:j.group_id,exam_results:U})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:j.exam_results,columns:re}),!j&&Object(e.jsx)(te,{onSelect:p})]})]})},Pe=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Ae=function(r){var a=r.exam_id,n=Object(o.useState)(""),t=Object(R.a)(n,2),c=t[0],d=t[1];return Object(e.jsx)(N.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(K.a)(Object(g.a)().mark(function m(){var h;return Object(g.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,pe(a);case 2:if(h=p.sent,!h.success){p.next=6;break}return d(h.data.title),p.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},m)})),columns:Pe})},ut=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(u.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(u.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(u.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(We.a)(new Date(a.passed_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(We.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(u.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(ie.a,{type:"Students",type_id:a.group_id},a.group_id)}}],xt=function(){var r,a,n=Object(o.useRef)(),t=Object(Oe.b)(),c=t.semester_subject_id,d=Object(b.k)(),m=Object(o.useMemo)(function(){var p,x,_;return{exam_id:(p=(x=d.query)===null||x===void 0?void 0:x.exam_id)!==null&&p!==void 0?p:null,results:(_=d.query)===null||_===void 0?void 0:_.results}},[(r=d.query)===null||r===void 0?void 0:r.exam_id,(a=d.query)===null||a===void 0?void 0:a.results]),h=m.exam_id,E=m.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(Ae,{exam_id:Number(E)}):h!==null?Object(e.jsx)(je,{exam_id:h}):Object(e.jsx)(N.a,{className:"table-standalone",headerTitle:Object(e.jsx)(u.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var p=Object(K.a)(Object(g.a)().mark(function x(_,j){var f,S,y,T;return Object(g.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(f=_.current,S=_.pageSize,c!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return y=j&&Object.entries(j)[0],C.next=6,Ke({per_page:S,page:f,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:y&&y[0],order:y&&(y[1]==="ascend"?"ASC":"DESC")});case 6:if(T=C.sent,!T.success){C.next=9;break}return C.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},x)}));return function(x,_){return p.apply(this,arguments)}}(),columns:[].concat(ut,[{title:Object(e.jsx)(u.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(x,_){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?exam_id=").concat(_.id),children:Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(me.a,{type:"primary",icon:Object(e.jsx)(Be.a,{})})})},"edit"),Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?results=").concat(_.id),children:Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(me.a,{icon:Object(e.jsx)(Y,{})})})},"results"),Object(e.jsx)(ot.a,{title:Object(e.jsx)(u.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(K.a)(Object(g.a)().mark(function j(){var f;return Object(g.a)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,_e(_.id);case 2:f=y.sent,f.success&&n.current&&n.current.reload();case 4:case"end":return y.stop()}},j)})),okText:Object(e.jsx)(u.a,{id:"yes"}),cancelText:Object(e.jsx)(u.a,{id:"no"}),children:Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(me.a,{type:"primary",icon:Object(e.jsx)(Ie.a,{}),danger:!0})})},"delete")]}}])})},ht=s("o0Ox"),Jt=s("miYZ"),vt=s("tsqr"),Mt=s("4KAj");function ra(i,r){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/chats/ms-teams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),Pt.apply(this,arguments)}var sa=function(r){var a=r.student_id,n=Object(o.useState)(!1),t=Object(R.a)(n,2),c=t[0],d=t[1],m=Object(o.useCallback)(Object(K.a)(Object(g.a)().mark(function h(){var E;return Object(g.a)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return d(!0),x.next=3,ra({user_id:a});case 3:if(E=x.sent,E.success){x.next=8;break}return vt.b.error(E.message),d(!1),x.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return x.stop()}},h)})),[]);return Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(me.a,{loading:c,type:"primary",icon:Object(e.jsx)(Mt.a,{}),onClick:m})})},ua=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(u.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ca=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},ia=function(r){return r.reduce(function(a,n){var t,c=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(d,m){return m.academic_teacher_id!==null?d:[].concat(Object(ne.a)(d),[{group_id:n.id,group_name:n.name,user_id:m.id,first_name:m.first_name,last_name:m.last_name,email:m.email}])},[]);return[].concat(Object(ne.a)(a),Object(ne.a)(c))},[])},la=function(){var r=Object(Oe.b)(),a=r.teacherSubjectData,n=Object(o.useMemo)(function(){var t;return ca((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(N.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(K.a)(Object(g.a)().mark(function c(d){var m,h,E,p,x,_,j,f,S;return Object(g.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return m=d.groups,h=d.first_name,E=h===void 0?"":h,p=d.last_name,x=p===void 0?"":p,_=d.email,j=_===void 0?"":_,T.next=3,Object(ht.a)({parent_id:a==null?void 0:a.group_id,"id[]":m});case 3:if(f=T.sent,f.success){T.next=6;break}return T.abrupt("return",{data:[],total:0,success:!1});case 6:return S=ia(f.data).filter(function(P){return P.first_name.toLowerCase().includes(E.toLowerCase())&&P.last_name.toLowerCase().includes(x.toLowerCase())&&P.email.toLowerCase().includes(j.toLowerCase())}),T.abrupt("return",{data:S,total:S.length,success:!0});case 8:case"end":return T.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ua,[{hideInSearch:!0,title:Object(e.jsx)(u.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,d){return[Object(e.jsx)(sa,{student_id:d.user_id},"teamsChat")]}}])})},St=s("jrin");function It(i,r){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules/groups/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Dt.apply(this,arguments)}function Yt(i,r,a,n){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(K.a)(Object(g.a)().mark(function i(r,a,n,t){return Object(g.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(u.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(l.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return d.stop()}},i)})),Rt.apply(this,arguments)}var dn=s("sRBo"),Zt=s("kaz8"),da=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.defaultChecked,c=r.onSuccess,d=Object(o.useState)(!1),m=Object(R.a)(d,2),h=m[0],E=m[1],p=Object(o.useCallback)(function(x){E(!0),Yt(a,n,x.target.checked?G.a.PRESENT:G.a.ABSENT).then(function(_){_.success&&(c==null||c())}).finally(function(){return E(!1)})},[]);return Object(e.jsx)(Zt.a,{disabled:h,defaultChecked:t,onChange:p})},Xt=da,oa=function(){var r=Object(Oe.b)(),a=r.teacherSubjectData,n=Object(o.useState)([]),t=Object(R.a)(n,2),c=t[0],d=t[1],m=Object(o.useState)(""),h=Object(R.a)(m,2),E=h[0],p=h[1],x=Object(u.l)(),_=Object(o.useRef)(),j=Object(o.useMemo)(function(){var S;return((S=a==null?void 0:a.groups)!==null&&S!==void 0?S:[]).map(function(y){var T=y.id,P=y.name;return{value:T,label:P}})},[a==null?void 0:a.groups]),f=Object(o.useMemo)(function(){var S;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:j,defaultValue:j==null||(S=j[0])===null||S===void 0?void 0:S.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(c))},[j,c]);return Object(e.jsx)(N.a,{className:"table-standalone",headerTitle:"".concat(x.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(E,")"),request:function(){var S=Object(K.a)(Object(g.a)().mark(function y(T){var P,C,H,z,Ee,we,$,F,U,se,Xe;return Object(g.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return C=T.group_id,H=C===void 0?j==null||(P=j[0])===null||P===void 0?void 0:P.value:C,z=T.full_name,Ee=z===void 0?"":z,ye.next=3,Promise.all([Object(ht.b)(H),It(H)]);case 3:if(we=ye.sent,$=Object(R.a)(we,2),F=$[0],U=$[1],se=j.find(function(Fe){var J=Fe.value;return J===H}),!(!F.success||!U.success||!se)){ye.next=10;break}return ye.abrupt("return",{data:[],total:0,success:!1});case 10:if(p(se.label),U.data.length){ye.next=15;break}return vt.b.warn(Object(e.jsx)(u.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),d([]),ye.abrupt("return",{data:[],total:0,success:!0});case 15:return d(U.data.reduce(function(Fe,J){return[].concat(Object(ne.a)(Fe),[{title:String(Object(We.a)(new Date(J.date_from),v.c)),dataIndex:String(J.date_from),hideInSearch:!0,width:100,align:"center",render:function(ke,He){return Object(e.jsx)(Xt,{groupAttendanceScheduleId:J.id,defaultChecked:He["".concat(J==null?void 0:J.date_from)]===G.a.PRESENT,studentId:He.id})}}])},[])),Xe=F.data.users.reduce(function(Fe,J){var Qe=J.id,ke=J.academic_teacher_id,He=J.first_name,it=J.last_name,ae="".concat(it," ").concat(He);if(ke!==null||!ae.toLowerCase().includes(Ee.toLowerCase()))return Fe;var W=U.data.reduce(function(X,be){var Ce=be.attendances.find(function(tt){return tt.user_id===Qe});return Ce?Object(l.a)(Object(l.a)({},X),{},Object(St.a)({},"".concat(be.date_from),Ce.value)):X},{});return[].concat(Object(ne.a)(Fe),[Object(l.a)({id:Qe,full_name:ae},W)])},[]).sort(function(Fe,J){return Fe.full_name.localeCompare(J.full_name)}),ye.abrupt("return",{data:Xe,total:Xe.length,success:!0});case 18:case"end":return ye.stop()}},y)}));return function(y){return S.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{onChange:function(){var y;return(y=_.current)===null||y===void 0?void 0:y.reload()}},scroll:{x:1500},actionRef:_,rowKey:"id"})},on=s("tU7J"),nt=s("wFql"),jn=s("/zsF"),Gt=s("PArb"),ja=s("Hn4i"),ba=s("bRQS");function Lt(i,r,a){return At.apply(this,arguments)}function At(){return At=Object(K.a)(Object(g.a)().mark(function i(r,a,n){return Object(g.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),At.apply(this,arguments)}function ma(i,r,a,n){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(K.a)(Object(g.a)().mark(function i(r,a,n,t){return Object(g.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(l.a)({method:"POST",data:n},t||{})));case 1:case"end":return d.stop()}},i)})),Ft.apply(this,arguments)}function Qt(i,r){return $t.apply(this,arguments)}function $t(){return $t=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/lesson-group-users",Object(l.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),$t.apply(this,arguments)}function va(i,r,a){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(K.a)(Object(g.a)().mark(function i(r,a,n){return Object(g.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return c.stop()}},i)})),Ut.apply(this,arguments)}function fa(i){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(K.a)(Object(g.a)().mark(function i(r){return Object(g.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(u.i)("/api/admin/grade-terms",Object(l.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},i)})),Nt.apply(this,arguments)}function Oa(i,r){return wt.apply(this,arguments)}function wt(){return wt=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/grade-scales/".concat(r),Object(l.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),wt.apply(this,arguments)}function ha(i,r){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/final-grades",Object(l.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},i)})),Bt.apply(this,arguments)}function pa(i,r,a){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(K.a)(Object(g.a)().mark(function i(r,a,n){return Object(g.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/final-grades/".concat(r),Object(l.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return c.stop()}},i)})),Kt.apply(this,arguments)}var ga=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],xa=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(o.useState)([]),c=Object(R.a)(t,2),d=c[0],m=c[1],h=Object(o.useRef)(),E=I.a.useForm(),p=Object(R.a)(E,1),x=p[0];return Object(o.useEffect)(function(){var _,j=((_=a.scale)!==null&&_!==void 0?_:[]).map(function(f,S){return Object(l.a)(Object(l.a)({},f),{},{id:String((S+1)*100)})});x.setFieldValue("table",j)},[]),Object(e.jsx)(I.a,{form:x,onFinish:n,submitter:{render:function(j,f){var S=Object(R.a)(f,2),y=S[1];return[y]}},children:Object(e.jsx)(ja.a,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:Object(e.jsx)(u.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(ga,[{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(j,f){return Object(e.jsx)(me.a,{type:"primary",onClick:function(){var y;return(y=h.current)===null||y===void 0?void 0:y.startEditable(f.id)},icon:Object(e.jsx)(Be.a,{})})}}]),editable:{form:x,type:"multiple",editableKeys:d,saveText:Object(e.jsx)(me.a,{type:"primary",icon:Object(e.jsx)(ba.a,{})}),onChange:m,actionRender:function(j,f,S){return[S.save]}}})})},Sa=function(){var r,a,n=Object(u.m)("@@initialState"),t=n.initialState,c=Object(Oe.b)(),d=c.semester_subject_id,m=c.tutors,h=Object(o.useState)(),E=Object(R.a)(h,2),p=E[0],x=E[1],_=Object(o.useState)(!1),j=Object(R.a)(_,2),f=j[0],S=j[1],y=Object(o.useState)(null),T=Object(R.a)(y,2),P=T[0],C=T[1],H=Object(o.useMemo)(function(){return!!m.data.find(function($){var F,U=$.id;return U===(t==null||(F=t.currentUser)===null||F===void 0?void 0:F.id)})},[m.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),z=Object(o.useMemo)(function(){return m.data.map(function($){var F=$.id,U=$.first_name,se=$.last_name;return{label:"".concat(U," ").concat(se),value:F}})},[m.data]),Ee=Object(o.useCallback)(function(){d===null||P===null||(S(!0),x(void 0),Lt(d,P).then(function($){$.success&&x($.data)}).finally(function(){S(!1)}))},[d,P]),we=Object(o.useCallback)(function($,F){return function(){var U=Object(K.a)(Object(g.a)().mark(function se(Xe){var Je,ye;return Object(g.a)().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(!(d===null||P===null)){J.next=2;break}return J.abrupt("return");case 2:return Je=$.reduce(function(Qe,ke){return ke.s_subject_scale_form_id===F?[].concat(Object(ne.a)(Qe),[{s_subject_scale_form_id:F,scale:Xe.table.map(function(He){var it=He.name,ae=He.grade,W=He.grade_value;return{name:it,grade:ae,grade_value:W}})}]):[].concat(Object(ne.a)(Qe),[ke])},[]),J.next=5,ma(d,P,{grade_scale:Je});case 5:ye=J.sent,ye.success&&Ee();case 7:case"end":return J.stop()}},se)}));return function(se){return U.apply(this,arguments)}}()},[P,d]);return Object(o.useEffect)(function(){var $,F;if(!H||!(t!=null&&($=t.currentUser)!==null&&$!==void 0&&$.id)){var U;if((U=m.data)!==null&&U!==void 0&&U[0]){var se;C((se=m.data)===null||se===void 0?void 0:se[0].id)}return}C(t==null||(F=t.currentUser)===null||F===void 0?void 0:F.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,H]),Object(o.useEffect)(function(){Ee()},[Ee]),m.loading?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(u.a,{id:"menu.Teacher"}),children:Object(e.jsx)(pt.a,{disabled:H,placeholder:Object(e.jsx)(u.a,{id:"select"}),options:z,value:P,onChange:function(F){return C(F)}})}),Object(e.jsx)(Gt.a,{}),f&&!p&&Object(e.jsx)(ue.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function($,F){var U;return Object(e.jsxs)(Ye.a.Fragment,{children:[F>0&&Object(e.jsx)(Gt.a,{}),Object(e.jsx)(xa,{subjectTutorGradeScale:$,onFormSubmit:we((U=p.grade_scale)!==null&&U!==void 0?U:[],$.s_subject_scale_form_id)})]},$.s_subject_scale_form_id)}):Object(e.jsx)(nt.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(u.a,{id:"gradesScalesMissing"})})]})},bn=s("qbNl"),_a=s("JBPa"),mn=s("Awhp"),ya=s("KrTs"),Ea=s("wd/R"),ct=s.n(Ea);function Ca(i,r){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(K.a)(Object(g.a)().mark(function i(r,a){return Object(g.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules",Object(l.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Wt.apply(this,arguments)}var vn=s("5R/X"),Ta=function(){var r=Object(o.useState)(null),a=Object(R.a)(r,2),n=a[0],t=a[1],c=Object(o.useState)([]),d=Object(R.a)(c,2),m=d[0],h=d[1],E=Object(Oe.b)(),p=E.semester_subject_id,x=ct()(),_=Object(o.useMemo)(function(){return m.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:ct()(C.date_from).toDate(),end:ct()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[m]),j=Object(o.useCallback)(function(C,H){Ca({semester_subject_id:p,date_form:C.toDate(),date_to:H.toDate()}).then(function(z){z.success&&h(z.data)})},[p]),f=Object(o.useCallback)(function(C){t(C)},[]),S=Object(o.useCallback)(function(){t(null)},[]),y=Object(o.useCallback)(function(C){return C.isSame(x,"day")?"warning":C.isAfter(x,"day")?"success":"error"},[]),T=Object(o.useCallback)(function(C){var H=_.filter(function(z){return ct()(z.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:H.map(function(z){return Object(e.jsx)("li",{onClick:function(){return f(z)},children:Object(e.jsx)(ya.a,{status:y(ct()(z.start)),text:z.title})},z.id)})})},[m]),P=Object(o.useCallback)(function(C,H){var z=ct()(C).startOf(H).subtract(1,"month"),Ee=ct()(C).endOf(H).add(1,"month");j(z,Ee)},[]);return Object(o.useEffect)(function(){var C=ct()().startOf("month"),H=ct()().endOf("month");j(C,H)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(nt.a.Title,{level:4,children:Object(e.jsx)(u.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(_a.a,{dateCellRender:T,onPanelChange:P}),Object(e.jsxs)(Ge.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:S,footer:null,children:[Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&ct()(n.start).format(v.b)]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"end_at",defaultMessage:"End date"}),":",n&&ct()(n.end).format(v.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(nt.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(me.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"msTeams"})})},"teamsLink")})]})]})},kt=s("yj/a"),qt=s("5Syx"),_t=s("PpiC"),Vt=s("H6aw"),Ma=s("p3I6"),Pa=["results"],ea=function(r,a){return r.reduce(function(n,t){var c=t.results,d=Object(_t.a)(t,Pa),m=c.find(function(h){return h.user_id===a});return m?[].concat(Object(ne.a)(n),[Object(l.a)(Object(l.a)({},d),{},{result:m})]):n},[])},ta=function(r,a){var n,t=r.reduce(function(j,f){var S=f.result,y=f.weight;return[j[0]+S.result*y,j[1]+y]},[0,0]),c=Object(R.a)(t,2),d=c[0],m=c[1],h=Number.isNaN(d/m)?0:d/m,E=a.sort(function(j,f){return j.grade_value-f.grade_value}).reduce(function(j,f){return[].concat(Object(ne.a)(j),[Object(l.a)(Object(l.a)({},f),{},{isWeightedAverageGreater:h>=f.grade_value})])},[]);if(E.every(function(j){var f=j.isWeightedAverageGreater;return f})){var p,x;return(p=(x=E.at(-1))===null||x===void 0?void 0:x.name)!==null&&p!==void 0?p:""}var _=E.findIndex(function(j){var f=j.isWeightedAverageGreater;return!f});return _<0?"":(n=E[_-1])===null||n===void 0?void 0:n.name},aa=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Ia=["attendances"];function Da(i,r){var a=Object(o.useState)({loading:!1}),n=Object(R.a)(a,2),t=n[0],c=n[1];return Object(o.useEffect)(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!0})}),va(i,r).then(function(d){d.success&&c(function(m){return Object(l.a)(Object(l.a)({},m),{},{data:d.data})})}).finally(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!1})})})},[r,i]),{finalGrades:t}}function Ra(){var i=Object(o.useState)({loading:!1}),r=Object(R.a)(i,2),a=r[0],n=r[1];return Object(o.useEffect)(function(){n(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!0})}),fa().then(function(t){t.success&&n(function(c){return Object(l.a)(Object(l.a)({},c),{},{data:t.data})})}).finally(function(){n(function(t){return Object(l.a)(Object(l.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function Ga(i){var r=Object(o.useState)({loading:!1}),a=Object(R.a)(r,2),n=a[0],t=a[1];return Object(o.useEffect)(function(){i!==void 0&&(t(function(c){return Object(l.a)(Object(l.a)({},c),{},{loading:!0})}),Oa(i).then(function(c){c.success&&t(function(d){return Object(l.a)(Object(l.a)({},d),{},{data:c.data})})}).finally(function(){t(function(c){return Object(l.a)(Object(l.a)({},c),{},{loading:!1})})}))},[i]),{subjectGradeScales:n}}function La(i,r,a){var n=Object(o.useState)({loading:!1}),t=Object(R.a)(n,2),c=t[0],d=t[1];return Object(o.useEffect)(function(){typeof i!="number"||typeof r!="number"||typeof a!="number"||(d(function(m){return Object(l.a)(Object(l.a)({},m),{},{loading:!0})}),Lt(i,r).then(function(m){m.success&&d(function(h){var E,p;return Object(l.a)(Object(l.a)({},h),{},{data:(E=aa(a,(p=m.data.grade_scale)!==null&&p!==void 0?p:[]))===null||E===void 0?void 0:E.map(function(x,_){return Object(l.a)(Object(l.a)({},x),{},{id:_})})})})}).finally(function(){d(function(m){return Object(l.a)(Object(l.a)({},m),{},{loading:!1})})}))},[i,r]),{tutorGradeScales:c}}function Aa(i,r){var a=Object(o.useState)({loading:!1}),n=Object(R.a)(a,2),t=n[0],c=n[1],d=Object(o.useCallback)(function(){c(function(h){return Object(l.a)(Object(l.a)({},h),{},{loading:!0})}),It(i).then(function(h){if(h.success){var E=h.data.reduce(function(p,x){var _=x.attendances,j=Object(_t.a)(x,Ia),f=_.find(function(S){return S.user_id===r});return f?[].concat(Object(ne.a)(p),[Object(l.a)(Object(l.a)({},j),{},{attendance:f})]):p},[]);c(function(p){return Object(l.a)(Object(l.a)({},p),{},{data:E})})}}).finally(function(){c(function(h){return Object(l.a)(Object(l.a)({},h),{},{loading:!1})})})},[i,r]),m=Object(o.useCallback)(function(h,E){c(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!0})}),Yt(h,r,E).then(function(p){p.success?vt.b.success(p.message):vt.b.error(p.message)}).finally(function(){d(),c(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!1})})})},[d,r]);return Object(o.useEffect)(function(){d()},[d]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:d,updateUserAttendanceSchedules:m}}function Fa(i,r){var a=Object(o.useState)({loading:!1}),n=Object(R.a)(a,2),t=n[0],c=n[1];return Object(o.useEffect)(function(){!r||(c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!0})}),Ke({student_id:i,semester_subject_id:r}).then(function(d){if(d.success){var m=ea(d.data,i);c(function(h){return Object(l.a)(Object(l.a)({},h),{},{data:m})})}}).finally(function(){c(function(d){return Object(l.a)(Object(l.a)({},d),{},{loading:!1})})}))},[i,r]),{studentExams:t}}function $a(i,r){var a=Object(o.useState)({loading:!1}),n=Object(R.a)(a,2),t=n[0],c=n[1],d=Object(o.useState)({loading:!1}),m=Object(R.a)(d,2),h=m[0],E=m[1],p=Object(o.useState)({loading:!1}),x=Object(R.a)(p,2),_=x[0],j=x[1];return Object(o.useEffect)(function(){c(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!0})}),Object(Vt.e)({group_id:i}).then(function(f){f.success&&c(function(S){return Object(l.a)(Object(l.a)({},S),{},{data:f.data})})}).finally(function(){c(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!1})})})},[i]),Object(o.useEffect)(function(){!t.data||(j(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var S=f.id;return Object(Vt.m)(Number(S))})).then(function(f){f.forEach(function(S){S.success&&j(function(y){return Object(l.a)(Object(l.a)({},y),{},{data:Object(l.a)(Object(l.a)({},y.data),{},Object(St.a)({},Number(S.data.id),Object(Ma.c)(S.data.lessons)))})})})}).finally(function(){j(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!1})})}),E(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var S=f.id;return Object(Vt.l)(Number(S),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(y){if(y.success){var T,P,C=((T=y.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&T!==void 0?T:[]).filter(function(z){return z.id===r}),H=(P=y.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&P!==void 0?P:[];E(function(z){return Object(l.a)(Object(l.a)({},z),{},{data:Object(l.a)(Object(l.a)({},z.data),{},Object(St.a)({},Number(S),{finishedTopics:C,attendanceList:H}))})})}})})).finally(function(){return E(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:h,userCoursesTopics:_}}var Ua=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Na=[{title:Object(e.jsx)(u.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(We.a)(new Date(a.date_from),v.c)}}],wa=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(We.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],Ba=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(We.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),v.c):"-"}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],yt=6,Ka=function(r){var a,n,t,c,d=r.user_id,m=r.group_id,h=Object(Oe.b)(),E=h.semester_subject_id,p=Fa(d,E),x=p.studentExams,_=Da(m,d),j=_.finalGrades,f=Ra(),S=f.gradeTerms,y=Ga((a=j.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),T=y.subjectGradeScales,P=La(E,(n=j.data)===null||n===void 0?void 0:n.tutor_id,(t=j.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),C=P.tutorGradeScales,H=Aa(m,d),z=H.userAttendanceSchedules,Ee=H.updateUserAttendanceSchedules,we=$a(m,d),$=we.userCourses,F=we.userCoursesStats,U=we.userCoursesTopics,se=I.a.useForm(),Xe=Object(R.a)(se,1),Je=Xe[0],ye=Object(o.useMemo)(function(){var ae;return((ae=S.data)!==null&&ae!==void 0?ae:[]).map(function(W){var X=W.id,be=W.name;return{label:be,value:X}})},[S.data]),Fe=Object(o.useMemo)(function(){var ae;return((ae=T.data)!==null&&ae!==void 0?ae:[]).map(function(W){var X=W.name,be=W.id;return{label:X,value:be}})},[T.data]),J=Object(o.useMemo)(function(){var ae,W;return ta((ae=x.data)!==null&&ae!==void 0?ae:[],(W=C.data)!==null&&W!==void 0?W:[])},[x.data,C.data]),Qe=Object(o.useCallback)(function(){var ae=Object(K.a)(Object(g.a)().mark(function W(X){var be,Ce,tt,lt,dt,jt,rt;return Object(g.a)().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(tt=X.grade_scale_id,lt=X.grade_term_id,((be=j.data)===null||be===void 0?void 0:be.id)!==void 0){qe.next=3;break}return qe.abrupt("return");case 3:if(dt=(Ce=j.data)===null||Ce===void 0?void 0:Ce.grades.find(function(Ht){var Ct=Ht.grade_term;return Ct.id===lt}),!dt){qe.next=11;break}return qe.next=7,pa(dt.id,{grade_scale_id:tt});case 7:return jt=qe.sent,vt.b[jt.success?"success":"error"](jt.message),jt.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades")),qe.abrupt("return");case 11:return qe.next=13,ha({grade_scale_id:tt,grade_term_id:lt,lesson_group_user_id:j.data.id});case 13:rt=qe.sent,vt.b[rt.success?"success":"error"](rt.message),rt.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades"));case 16:case"end":return qe.stop()}},W)}));return function(W){return ae.apply(this,arguments)}}(),[j.data,E]),ke=Object(o.useMemo)(function(){var ae;return((ae=S.data)!==null&&ae!==void 0?ae:[]).map(function(W){var X;return Object(l.a)(Object(l.a)({},W),{},{grade:(X=j.data)===null||X===void 0?void 0:X.grades.find(function(be){var Ce=be.grade_term;return Ce.id===W.id})})})},[j.data,S.data]),He=$.loading&&!$.data||F.loading&&!F.data||U.loading&&!U.data,it=Boolean($.data&&F.data&&U.data);return j.loading?Object(e.jsx)(ue.a,{}):Object(e.jsxs)(e.Fragment,{children:[j.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(nt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Student",values:j.data.user})}),Object(e.jsx)(Gt.a,{})]}),Object(e.jsxs)(mt.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(N.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:yt},dataSource:x.data,loading:x.loading,columns:wa,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(N.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:yt},dataSource:ke,loading:j.loading||S.loading,columns:Ba,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(N.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:yt},cardProps:{bodyStyle:{padding:0}},dataSource:z.data,loading:z.loading,columns:[].concat(Na,[{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(W,X){return Object(e.jsx)(Zt.a,{onChange:function(Ce){return Ee(X.id,Ce.target.checked?G.a.PRESENT:G.a.ABSENT)},checked:X.attendance.value===G.a.PRESENT})}}])})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(N.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:yt},cardProps:{bodyStyle:{padding:0}},dataSource:C.data,loading:C.loading,columns:Ua})}),He&&Object(e.jsx)(ue.a,{}),it&&((c=$.data)===null||c===void 0?void 0:c.map(function(ae){var W,X,be,Ce,tt,lt,dt,jt,rt=ae.id,Et=ae.title;return Object(e.jsxs)(D.a,{span:24,children:[Object(e.jsx)(nt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Et}),Object(e.jsx)(qt.c,{course_id:Number(rt),topics:(W=(X=U.data)===null||X===void 0?void 0:X[Number(rt)])!==null&&W!==void 0?W:[],stats:(be=(Ce=F.data)===null||Ce===void 0||(tt=Ce[Number(rt)])===null||tt===void 0?void 0:tt.finishedTopics)!==null&&be!==void 0?be:[]}),Object(e.jsx)(qt.a,{stats:(lt=(dt=F.data)===null||dt===void 0||(jt=dt[Number(rt)])===null||jt===void 0?void 0:jt.attendanceList)!==null&&lt!==void 0?lt:[]})]},rt)}))]}),Object(e.jsx)(I.a,{form:Je,onFinish:Qe,children:Object(e.jsxs)(I.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(kt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ye,width:"sm",fieldProps:{loading:S.loading}}),Object(e.jsx)(kt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Fe,fieldProps:{loading:j.loading||T.loading}}),Object(e.jsx)(I.a.Item,{children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:J}})})]})})]})},Wa=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(u.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,c=n.grade_term,d=n.id;return Object(e.jsxs)(nt.a.Text,{children:[c.name,": ",t]},d)}):"-"})}}],Va=function(){var r,a,n=Object(b.k)(),t=Object(o.useMemo)(function(){var x,_,j,f;return{user_id:Number.isNaN(Number((x=n.query)===null||x===void 0?void 0:x.user_id))?null:Number((_=n.query)===null||_===void 0?void 0:_.user_id),group_id:Number.isNaN(Number((j=n.query)===null||j===void 0?void 0:j.group_id))?null:Number((f=n.query)===null||f===void 0?void 0:f.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,d=t.group_id,m=Object(Oe.b)(),h=m.teacherSubjectData,E=m.semester_subject_id,p=Object(o.useMemo)(function(){var x;return((x=h==null?void 0:h.groups)!==null&&x!==void 0?x:[]).map(function(_){var j=_.id,f=_.name;return{label:f,value:j}})},[h==null?void 0:h.groups]);return c!==null&&d!==null?Object(e.jsx)(Ka,{user_id:c,group_id:d}):Object(e.jsx)(N.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var x=Object(K.a)(Object(g.a)().mark(function _(j){var f,S,y,T,P,C,H,z,Ee,we;return Object(g.a)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return S=j.group_id,y=S===void 0?[]:S,T=j.first_name,P=T===void 0?"":T,C=j.last_name,H=C===void 0?"":C,z=((f=h==null?void 0:h.groups)!==null&&f!==void 0?f:[]).map(function(U){var se=U.id;return se}),F.next=4,Qt(y.length===0?z:y);case 4:if(Ee=F.sent,Ee.success){F.next=7;break}return F.abrupt("return",{success:!1,total:0,data:[]});case 7:return we=Ee.data.filter(function(U){var se=U.user;return se.first_name.toLowerCase().includes(P.toLowerCase())&&se.last_name.toLowerCase().includes(H.toLowerCase())}),F.abrupt("return",{success:!0,total:we.length,data:we});case 9:case"end":return F.stop()}},_)}));return function(_){return x.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(_,j){return Object(e.jsx)(ie.a,{type:"Students",type_id:j.group_id},j.group_id)}}].concat(Wa,[{title:Object(e.jsx)(u.a,{id:"options"}),hideInSearch:!0,render:function(_,j){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(j.user.id,"&group_id=").concat(j.group_id),children:Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"edit"}),children:Object(e.jsx)(me.a,{type:"primary",icon:Object(e.jsx)(Be.a,{})})})},"edit")]}}])})},Ha=s("dF/Y"),za=s("o+0V"),na=s("0WSk"),Ja=["type","defaultRender"],Ya=["type","defaultRender"],Za=function(r){var a=r.url;return Object(e.jsx)(Ze.a,{title:Object(e.jsx)(u.a,{id:"download"}),children:Object(e.jsx)(me.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Ha.a,{})})})},Xa=[{title:Object(e.jsx)(u.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(We.a)(new Date(a.created_at),v.a)}},{title:Object(e.jsx)(u.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,d=Object(_t.a)(a,Ja);if(t==="form")return null;var m=n.getFieldValue("state");return Object(e.jsx)(na.a,Object(l.a)(Object(l.a)({},d),{},{state:{type:m}}))},render:function(r,a){return Object(e.jsx)(ie.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(u.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(We.a)(new Date(a.exported_at),v.a)}},{title:Object(e.jsx)(u.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,c=a.defaultRender,d=Object(_t.a)(a,Ya);if(t==="form")return null;var m=n.getFieldValue("state");return Object(e.jsx)(na.a,Object(l.a)(Object(l.a)({},d),{},{state:{type:m}}))},render:function(r,a){return Object(e.jsx)(ie.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(u.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(Za,{url:a.url},"download")]}}],Qa=function(){var r,a,n=Object(Oe.b)(),t=n.teacherSubjectData,c=Object(o.useMemo)(function(){var m;return((m=t==null?void 0:t.groups)!==null&&m!==void 0?m:[]).map(function(h){var E=h.id,p=h.name;return{value:E,label:p}})},[t==null?void 0:t.groups]),d=Object(o.useMemo)(function(){var m,h;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(m=t.groups)===null||m===void 0||(h=m[0])===null||h===void 0?void 0:h.id,allowClear:!1}}].concat(Xa)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(N.a,{className:"table-standalone",request:function(){var m=Object(K.a)(Object(g.a)().mark(function h(E){var p,x,_,j,f,S,y;return Object(g.a)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return _=E.group_id,j=_===void 0?t==null||(p=t.groups)===null||p===void 0||(x=p[0])===null||x===void 0?void 0:x.id:_,f=E.created_by,S=E.exported_by,P.next=3,Object(za.a)({group_id:j,created_by:f,exported_by:S});case 3:if(y=P.sent,y.success){P.next=6;break}return P.abrupt("return",{success:!1,data:[],total:0});case 6:return P.abrupt("return",{success:!0,data:y.data,total:y.data.length});case 7:case"end":return P.stop()}},h)}));return function(h){return m.apply(this,arguments)}}(),columns:d,search:{layout:"vertical"},scroll:{x:1500}})},ka=s("LvDl"),qa=function(r){var a=r.exam_id,n=r.result,t=r.student_id,c=r.onSuccess,d=Object(o.useCallback)(Object(ka.debounce)(function(m){ze(a,t,{result:m!=null?m:0}).then(function(h){h.success&&(c==null||c(h.data))})},300),[a,n,t]);return Object(e.jsx)(L.a,{type:"number",min:0,max:100,onChange:d,defaultValue:n})},en=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{title:Object(We.a)(new Date(t.date_from),v.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,m){return Object(e.jsx)(Xt,{groupAttendanceScheduleId:t.id,defaultChecked:m["attendance-".concat(t==null?void 0:t.date_from)]===G.a.PRESENT,studentId:m.id})}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},tn=function(r,a){return r.reduce(function(n,t){var c=t.attendances.find(function(d){return d.user_id===a});return c?Object(l.a)(Object(l.a)({},n),{},Object(St.a)({},"attendance-".concat(t.date_from),c.value)):n},{})},an=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(u.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(d,m){var h;return(m==null||(h=m["exam-".concat(t.id)])===null||h===void 0?void 0:h.result)!==void 0?Object(e.jsx)(qa,{result:m==null?void 0:m["exam-".concat(t.id)].result,exam_id:t.id,student_id:m.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},nn=function(r){return r.reduce(function(a,n){var t=n.result,c=n.id;return Object(l.a)(Object(l.a)({},a),{},Object(St.a)({},"exam-".concat(c),t))},{})},rn=function(){var r,a,n=Object(Oe.b)(),t=n.teacherSubjectData,c=n.semester_subject_id,d=Object(o.useState)([]),m=Object(R.a)(d,2),h=m[0],E=m[1],p=Object(o.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),x=Object(R.a)(p,2),_=x[0],j=x[1],f=Object(o.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(P){var C=P.id,H=P.name;return{value:C,label:H}})},[t==null?void 0:t.groups]),S=Object(o.useRef)(),y=Object(o.useMemo)(function(){var T;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:f,defaultValue:f==null||(T=f[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(h))},[f,h]);return Object(e.jsx)(N.a,{className:"table-standalone",request:function(){var T=Object(K.a)(Object(g.a)().mark(function P(C){var H,z,Ee,we,$,F,U,se,Xe,Je,ye,Fe,J,Qe,ke,He,it,ae;return Object(g.a)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return we=C.group_id,$=we===void 0?(H=f[0])===null||H===void 0?void 0:H.value:we,F=C.full_name,U=F===void 0?"":F,X.next=3,Qt($);case 3:if(se=X.sent,!(!se.success||c===null)){X.next=6;break}return X.abrupt("return",{data:[],total:0,success:!1});case 6:return X.next=8,Promise.all([Object(ht.b)($),It($),Ke({group_id:$,per_page:-1}),Lt(c,(z=se.data)===null||z===void 0||(Ee=z[0])===null||Ee===void 0?void 0:Ee.tutor_id)]);case 8:if(Xe=X.sent,Je=Object(R.a)(Xe,4),ye=Je[0],Fe=Je[1],J=Je[2],Qe=Je[3],ke=f.find(function(be){var Ce=be.value;return Ce===$}),!(!ye.success||!Fe.success||!J.success||!Qe.success||!ke)){X.next=17;break}return X.abrupt("return",{data:[],total:0,success:!1});case 17:return j(ke.label),He=en(Fe.data),it=an(J.data),E([He,it,{title:Object(e.jsx)(u.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),ae=ye.data.users.reduce(function(be,Ce){var tt,lt,dt=Ce.id,jt=Ce.academic_teacher_id,rt=Ce.first_name,Et=Ce.last_name,qe="".concat(Et," ").concat(rt);if(jt!==null||!qe.toLowerCase().includes(U.toLowerCase()))return be;var Ht=tn(Fe.data,dt),Ct=ea(J.data,dt),un=(tt=aa(se.data[0].s_subject_scale_form_id,(lt=Qe.data.grade_scale)!==null&&lt!==void 0?lt:[]))!==null&&tt!==void 0?tt:[],cn=ta(Ct,un),ln=nn(Ct);return[].concat(Object(ne.a)(be),[Object(l.a)(Object(l.a)({id:dt,full_name:qe,proposed_grade:cn},Ht),ln)])},[]).sort(function(be,Ce){return be.full_name.localeCompare(Ce.full_name)}),X.abrupt("return",{data:ae,total:ae.length,success:!0});case 23:case"end":return X.stop()}},P)}));return function(P){return T.apply(this,arguments)}}(),columns:y,headerTitle:Object(e.jsx)(u.a,{id:"classRegisterTitleWithGroupName",values:{groupName:_}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:S,pagination:{onChange:function(){var P;return(P=S.current)===null||P===void 0?void 0:P.reload()}},rowKey:"id"})},sn=function(r){var a,n,t=r.tab,c=Object(u.l)(),d=Object(u.m)("@@initialState"),m=d.setInitialState,h=d.initialState,E=Object(Oe.b)(),p=E.teacherSubjectData,x=E.semester_subject_id,_=E.tutors,j=Object(o.useCallback)(Object(le.a)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),f=Object(o.useMemo)(function(){return!!_.data.find(function(S){var y,T=S.id;return T===(h==null||(y=h.currentUser)===null||y===void 0?void 0:y.id)})||j(fe.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)($e.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(u.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(u.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(x,"/exams?exam_id=new"),children:Object(e.jsx)(me.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"Subjects"})},{path:String(x),breadcrumbName:String((n=p.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(B.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(y){m(Object(l.a)({},h)),u.f.push("/teacher/subjects/".concat(x,"/").concat(y))}},children:[Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"groups"}),children:Object(e.jsx)(at.a,{})},"groups"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"students"}),children:Object(e.jsx)(la,{})},"students"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"exams"}),children:Object(e.jsx)(xt,{})},"exams"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"schedule"}),children:Object(e.jsx)(Ta,{})},"schedule"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"class-register"}),children:Object(e.jsx)(rn,{})},"class-register"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"attendance"}),children:Object(e.jsx)(oa,{})},"attendance"),f&&Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"grades-scale"}),children:Object(e.jsx)(Sa,{})},"grades-scale"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"final-grades"}),children:Object(e.jsx)(Va,{})},"final-grades"),Object(e.jsx)(B.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"file-exports-history"}),children:Object(e.jsx)(Qa,{})},"file-exports-history")]})}):Object(e.jsx)(ue.a,{})},fn=ve.default=function(){var i=Object(b.l)(),r=i.subjectId,a=i.tab,n=a===void 0?"groups":a;return Object(e.jsx)(Oe.a,{semester_subject_id:Number(r),children:Object(e.jsx)(sn,{tab:n})})}},p3I6:function(ft,ve,s){"use strict";s.d(ve,"b",function(){return le}),s.d(ve,"c",function(){return Ne}),s.d(ve,"a",function(){return st});var l=s("miYZ"),Se=s("tsqr"),me=s("tJVT"),M=s("k1fw"),ue=s("oBTY"),o=s("q1tI"),Ye=s.n(o),u=s("9kvl"),Te=s("Ty5D"),b=s("H6aw"),B=s("/y+f"),$e=s("nKUr"),fe=s.n($e),le=Ye.a.createContext({}),Oe=function(){return Math.round(Math.random()*99999)},at=function he(de){return de.reduce(function(q,O){return[].concat(Object(ue.a)(q),Object(ue.a)(O.lessons?he(O.lessons):[]),[O])},[])},Ne=function he(de){return de.reduce(function(q,O){var Y;return[].concat(Object(ue.a)(q),Object(ue.a)(O.lessons?he(O.lessons):[]),Object(ue.a)((Y=O.topics)!==null&&Y!==void 0?Y:[]))},[])},ot=function he(de,q,O){return de.map(function(Y){var Ie,N;return Object(M.a)(Object(M.a)({},Y),{},{lessons:Y.lessons?he(Y.lessons,q,O):[],topics:Y.id===q?[].concat(Object(ue.a)((Ie=Y.topics)!==null&&Ie!==void 0?Ie:[]),[O]):(N=Y.topics)!==null&&N!==void 0?N:[]})})},bt=function he(de,q,O){return O?de.map(function(Y){return Object(M.a)(Object(M.a)({},Y),{},{lessons:[].concat(Object(ue.a)(Y.lessons?he(Y.lessons,q,O):[]),Object(ue.a)(Y.id===O?[q]:[]))})}):[].concat(Object(ue.a)(de),[q])},Ze=function he(de,q,O){return de.map(function(Y){return Object(M.a)(Object(M.a)({},Y.id===q?O:Y),{},{lessons:Y.lessons?he(Y.lessons,q,O):[]})})},g=function he(de,q){return de.map(function(O){return Object(M.a)(Object(M.a)({},O),{},{parent_id:q,lessons:O.lessons?he(O.lessons,O.id):[]})})},K=function he(de,q){return de.filter(function(O){return O.id!==q}).map(function(O){return Object(M.a)(Object(M.a)({},O),{},{lessons:O.lessons?he(O.lessons,q):[]})})},We=function he(de,q){return de.map(function(O){return Object(M.a)(Object(M.a)({},O),{},{lessons:O.lessons?he(O.lessons,q):[],topics:O.topics?O.topics.filter(function(Y){return Y.id!==q}):[]})})},Be=function he(de,q,O,Y){return Y==null?void 0:Y.map(function(Ie){if(Ie.id===O){var N;return Object(M.a)(Object(M.a)({},Ie),{},{topics:(N=Ie.topics)===null||N===void 0?void 0:N.map(function(v){return v.id===de?q.file.response.data:v})})}else if(Ie.lessons)return Object(M.a)(Object(M.a)({},Ie),{},{lessons:he(de,q,O,Ie.lessons||[])});return Ie})},st=function(de){var q=de.children,O=de.id,Y=Object(o.useState)(),Ie=Object(me.a)(Y,2),N=Ie[0],v=Ie[1],Ke=Object(u.l)(),Ue=Object(o.useMemo)(function(){return N&&N.lessons?Ne(N.lessons):[]},[N]),oe=Object(o.useMemo)(function(){return N&&N.lessons?at(N.lessons):[]},[N]),De=Object(o.useState)([]),Me=Object(me.a)(De,2),Re=Me[0],pe=Me[1],ee=Object(Te.k)();Object(o.useEffect)(function(){pe([])},[]);var _e=Object(o.useCallback)(function(){Object(b.m)(O).then(function(D){return D.success&&v(Object(M.a)(Object(M.a)({},D.data),{},{lessons:g(D.data.lessons)}))})},[O]);Object(o.useEffect)(function(){_e()},[_e]);var ge=Object(o.useCallback)(function(D){var I=oe.find(function(V){var w;return V==null||(w=V.topics)===null||w===void 0?void 0:w.find(function(G){return G.id===D})});return I?I.id:null},[oe]),ze=Object(o.useMemo)(function(){var D,I;return(D=ee.query)!==null&&D!==void 0&&D.lesson?{mode:"lesson",id:Number(ee.query.lesson),value:oe.find(function(V){return V.id===Number(ee.query.lesson)})}:(I=ee.query)!==null&&I!==void 0&&I.topic?{mode:"topic",id:Number(ee.query.topic),value:Ue.find(function(V){return V.id===Number(ee.query.topic)})}:{mode:"init"}},[ee.query,N,oe,Ue]),Ve=Object(o.useCallback)(function(D){var I={course_id:O,topics:[],isNew:!0,id:N?N.lessons.length+1:Oe(),order:0,title:Ke.formatMessage({id:"add_title_here"}),active:!0,parent_id:D};return v(function(V){var w;return Object(M.a)(Object(M.a)({},V),{},{lessons:bt((w=V==null?void 0:V.lessons)!==null&&w!==void 0?w:[],I,D)})}),I},[O,N]),xe=Object(o.useCallback)(function(D,I){var V=oe.find(function(G){return G.id===D}),w=V&&V.isNew;return(w?Object(b.g)(I):Object(b.u)(D,I)).then(function(G){return Se.b.success(G.message),_e(),G.success&&v(function(Z){var Ge;return Object(M.a)(Object(M.a)({},Z),{},{lessons:Ze((Ge=Z==null?void 0:Z.lessons)!==null&&Ge!==void 0?Ge:[],D,Object(M.a)(Object(M.a)({},G.data),{},{isNew:!1}))})})})},[N]),ce=Object(o.useCallback)(function(D){var I=oe.find(function(w){return w.id===D});if(!!I){var V=I.isNew;V?v(function(w){var G;return Object(M.a)(Object(M.a)({},w),{},{lessons:K((G=w==null?void 0:w.lessons)!==null&&G!==void 0?G:[],D)})}):Object(b.o)(D).then(function(w){w.success&&(Se.b.success(w.message),v(function(G){var Z;return Object(M.a)(Object(M.a)({},G),{},{lessons:K((Z=G==null?void 0:G.lessons)!==null&&Z!==void 0?Z:[],D)})}))})}},[N]),ie=Object(o.useCallback)(function(D,I){var V,w=ge(D),G=oe.find(function(ne){return ne.id===w}),Z=G&&((V=G.topics)===null||V===void 0?void 0:V.find(function(ne){return ne.id===D})),Ge=Z==null?void 0:Z.isNew;return(Ge?Object(b.h)(I):Object(b.v)(D,I)).then(function(ne){ne.success&&(Se.b.success(ne.message),_e(),u.f.push("/courses/list/".concat(O,"/program/?topic=").concat(ne.data.id)),(Z==null?void 0:Z.topicable_type)===B.f.Video&&setTimeout(function(){_e()},5e3))})},[ge,N,_e]),A=Object(o.useCallback)(function(D){var I=ge(D),V=oe.find(function(Z){return Z.id===I});if(!!V){var w=Ue==null?void 0:Ue.find(function(Z){return Z.id===D}),G=w==null?void 0:w.isNew;G&&!w.topicable?v(function(Z){var Ge;return Object(M.a)(Object(M.a)({},Z),{},{lessons:We((Ge=Z==null?void 0:Z.lessons)!==null&&Ge!==void 0?Ge:[],D)})}):Object(b.p)(D).then(function(Z){Z.success&&(Se.b.success(Z.message),v(function(Ge){var ne;return Object(M.a)(Object(M.a)({},Ge),{},{lessons:We((ne=Ge==null?void 0:Ge.lessons)!==null&&ne!==void 0?ne:[],D)})}))})}},[N,ge]),L=Object(o.useCallback)(function(D,I){var V={lesson_id:D,isNew:!0,id:Oe(),title:Ke.formatMessage({id:"add_title_here"}),active:!0,topicable_type:I};return v(function(w){var G;return Object(M.a)(Object(M.a)({},w),{},{lessons:ot((G=w==null?void 0:w.lessons)!==null&&G!==void 0?G:[],D,V)})}),V},[]),R=function(I,V){var w=ge(I);v(function(G){return Object(M.a)(Object(M.a)({},G),{},{lessons:G?Be(I,V,w,G.lessons||[]):[]})}),u.f.push("/courses/list/".concat(O,"/program/?topic=").concat(V.file.response.data.id))},Q=Object(o.useCallback)(function(D){return Object(b.d)(D).then(function(I){if(I.success){Se.b.success(I.message);var V=ge(D);v(function(w){var G;return Object(M.a)(Object(M.a)({},w),{},{lessons:w?(G=w.lessons)===null||G===void 0?void 0:G.map(function(Z){if(Z.id===V){var Ge=Z.topics||[];return Object(M.a)(Object(M.a)({},Z),{},{topics:[].concat(Object(ue.a)(Ge),[I.data])})}return Z}):[]})})}})},[N,ge]),mt=Object(o.useCallback)(function(D){return Object(b.c)(D).then(function(I){I.success&&(Se.b.success(I.message),v(function(V){return Object(M.a)(Object(M.a)({},V),{},{lessons:V?[].concat(Object(ue.a)(V.lessons),[I.data]):[]})}))})},[]),et={state:N,h5ps:Re,id:O,addNewLesson:Ve,updateLesson:xe,updateTopic:ie,deleteLesson:ce,addNewTopic:L,deleteTopic:A,onTopicUploaded:R,cloneTopic:Q,cloneLesson:mt,currentEditMode:ze,getLessons:_e};return Object($e.jsx)(le.Provider,{value:et,children:q})}},"w/VK":function(ft,ve,s){"use strict";s.d(ve,"b",function(){return ue}),s.d(ve,"a",function(){return Ye});var l=s("qLMh"),Se=s("k1fw"),me=s("9og8"),M=s("9kvl");function ue(Te,b){return o.apply(this,arguments)}function o(){return o=Object(me.a)(Object(l.a)().mark(function Te(b,B){return Object(l.a)().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return fe.abrupt("return",Object(M.i)("/api/admin/reports/report",Object(Se.a)({params:b,method:"GET",useCache:!1},B||{})));case 1:case"end":return fe.stop()}},Te)})),o.apply(this,arguments)}function Ye(Te,b,B){return u.apply(this,arguments)}function u(){return u=Object(me.a)(Object(l.a)().mark(function Te(b,B,$e){return Object(l.a)().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:return le.abrupt("return",Object(M.i)("/api/admin/stats/course/".concat(b,"/export"),Object(Se.a)({params:B,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},$e||{})));case 1:case"end":return le.stop()}},Te)})),u.apply(this,arguments)}}}]);
