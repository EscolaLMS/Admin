"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803],{56717:function(jt,at,o){var Qe=o(1413),c=o(67294),Te=o(93696),w=o(84089),Re=function(m,s){return c.createElement(w.Z,(0,Qe.Z)((0,Qe.Z)({},m),{},{ref:s,icon:Te.Z}))};Re.displayName="InfoCircleOutlined",at.Z=c.forwardRef(Re)},78677:function(jt,at,o){var Qe=o(67294),c=o(80404),Te=function(){return Te=Object.assign||function(Re){for(var F,m=1,s=arguments.length;m<s;m++){F=arguments[m];for(var Ve in F)Object.prototype.hasOwnProperty.call(F,Ve)&&(Re[Ve]=F[Ve])}return Re},Te.apply(this,arguments)},w=function(Re){return Qe.createElement(c.P,Te({},Re,{chartType:"Column"}))};at.Z=w},88280:function(jt,at,o){o.d(at,{Z:function(){return xt}});var Qe=o(4942),c=o(97685),Te=o(45987),w=o(74165),Re=o(15861),F=o(1413),m=o(87462),s=o(67294),Ve=o(42110),ze=o(78026),ce=function(Ne,rt){return s.createElement(ze.Z,(0,m.Z)({},Ne,{ref:rt,icon:Ve.Z}))},p=s.forwardRef(ce),E=o(97462),u=o(952),b=o(10915),x=o(48171),ie=o(53914),k=o(22270),ye=o(60249),P=o(14726),he=o(75842),xe=o(21770),qe=o(88306),vt=o(8880),Me=o(72717),V=o(85893),oe=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],L=["record","position","creatorButtonText","newRecordType","parentKey","style"],B=s.createContext(void 0);function Ue(e){var Ne=e.children,rt=e.record,Ie=e.position,Pe=e.newRecordType,ae=e.parentKey,ve=(0,s.useContext)(B);return s.cloneElement(Ne,(0,F.Z)((0,F.Z)({},Ne.props),{},{onClick:function(){var Ze=(0,Re.Z)((0,w.Z)().mark(function je(we){var Ye,Je,Ge,pe;return(0,w.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.next=2,(Ye=(Je=Ne.props).onClick)===null||Ye===void 0?void 0:Ye.call(Je,we);case 2:if(pe=H.sent,pe!==!1){H.next=5;break}return H.abrupt("return");case 5:ve==null||(Ge=ve.current)===null||Ge===void 0||Ge.addEditRecord(rt,{position:Ie,newRecordType:Pe,parentKey:ae});case 6:case"end":return H.stop()}},je)}));function Q(je){return Ze.apply(this,arguments)}return Q}()}))}function g(e){var Ne,rt,Ie=(0,b.YB)(),Pe=e.onTableChange,ae=e.maxLength,ve=e.formItemProps,Ze=e.recordCreatorProps,Q=e.rowKey,je=e.controlled,we=e.defaultValue,Ye=e.onChange,Je=e.editableFormRef,Ge=(0,Te.Z)(e,oe),pe=(0,s.useRef)(void 0),_e=(0,s.useRef)(),H=(0,s.useRef)();(0,s.useImperativeHandle)(Ge.actionRef,function(){return _e.current},[_e.current]);var me=(0,xe.Z)(function(){return e.value||we||[]},{value:e.value,onChange:e.onChange}),G=(0,c.Z)(me,2),q=G[0],lt=G[1],$=s.useMemo(function(){return typeof Q=="function"?Q:function(le,De){return le[Q]||De}},[Q]),re=(0,x.J)(function(le){if(typeof le=="number"&&!e.name){if(le>=q.length)return le;var De=q&&q[le];return $==null?void 0:$(De,le)}if((typeof le=="string"||le>=q.length)&&e.name){var de=q.findIndex(function(Se,be){var Ae;return($==null||(Ae=$(Se,be))===null||Ae===void 0?void 0:Ae.toString())===(le==null?void 0:le.toString())});if(de!==-1)return de}return le});(0,s.useImperativeHandle)(Je,function(){var le=function(Se){var be,Ae;if(Se==null)throw new Error("rowIndex is required");var et=re(Se),dt=[e.name,(be=et==null?void 0:et.toString())!==null&&be!==void 0?be:""].flat(1).filter(Boolean);return(Ae=H.current)===null||Ae===void 0?void 0:Ae.getFieldValue(dt)},De=function(){var Se,be=[e.name].flat(1).filter(Boolean);if(Array.isArray(be)&&be.length===0){var Ae,et=(Ae=H.current)===null||Ae===void 0?void 0:Ae.getFieldsValue();return Array.isArray(et)?et:Object.keys(et).map(function(dt){return et[dt]})}return(Se=H.current)===null||Se===void 0?void 0:Se.getFieldValue(be)};return(0,F.Z)((0,F.Z)({},H.current),{},{getRowData:le,getRowsData:De,setRowData:function(Se,be){var Ae,et;if(Se==null)throw new Error("rowIndex is required");var dt=re(Se),gt=[e.name,(Ae=dt==null?void 0:dt.toString())!==null&&Ae!==void 0?Ae:""].flat(1).filter(Boolean),Et=Object.assign({},(0,F.Z)((0,F.Z)({},le(Se)),be||{})),_t=(0,vt.Z)({},gt,Et);return(et=H.current)===null||et===void 0||et.setFieldsValue(_t),!0}})},[re,e.name,H.current]),(0,s.useEffect)(function(){e.controlled&&(q||[]).forEach(function(le,De){var de;(de=H.current)===null||de===void 0||de.setFieldsValue((0,Qe.Z)({},"".concat($(le,De)),le))},{})},[(0,ie.ZP)(q),e.controlled]),(0,s.useEffect)(function(){if(e.name){var le;H.current=e==null||(le=e.editable)===null||le===void 0?void 0:le.form}},[(Ne=e.editable)===null||Ne===void 0?void 0:Ne.form,e.name]);var W=Ze||{},K=W.record,te=W.position,ne=W.creatorButtonText,Xe=W.newRecordType,tt=W.parentKey,Tt=W.style,yt=(0,Te.Z)(W,L),Ft=te==="top",pt=(0,s.useMemo)(function(){return typeof ae=="number"&&ae<=(q==null?void 0:q.length)?!1:Ze!==!1&&(0,V.jsx)(Ue,{record:(0,k.h)(K,q==null?void 0:q.length,q)||{},position:te,parentKey:(0,k.h)(tt,q==null?void 0:q.length,q),newRecordType:Xe,children:(0,V.jsx)(P.ZP,(0,F.Z)((0,F.Z)({type:"dashed",style:(0,F.Z)({display:"block",margin:"10px 0",width:"100%"},Tt),icon:(0,V.jsx)(p,{})},yt),{},{children:ne||Ie.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ze,ae,q==null?void 0:q.length]),Lt=(0,s.useMemo)(function(){return pt?Ft?{components:{header:{wrapper:function(De){var de,Se=De.className,be=De.children;return(0,V.jsxs)("thead",{className:Se,children:[be,(0,V.jsxs)("tr",{style:{position:"relative"},children:[(0,V.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:pt}),(0,V.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(de=Ge.columns)===null||de===void 0?void 0:de.length,children:pt})]})]})}}}}:{tableViewRender:function(De,de){var Se,be;return(0,V.jsxs)(V.Fragment,{children:[(Se=(be=e.tableViewRender)===null||be===void 0?void 0:be.call(e,De,de))!==null&&Se!==void 0?Se:de,pt]})}}:{}},[Ft,pt]),St=(0,F.Z)({},e.editable),Vt=(0,x.J)(function(le,De){var de,Se,be;if((de=e.editable)===null||de===void 0||(Se=de.onValuesChange)===null||Se===void 0||Se.call(de,le,De),(be=e.onValuesChange)===null||be===void 0||be.call(e,De,le),e.controlled){var Ae;e==null||(Ae=e.onChange)===null||Ae===void 0||Ae.call(e,De)}});return(e!=null&&e.onValuesChange||(rt=e.editable)!==null&&rt!==void 0&&rt.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(St.onValuesChange=Vt),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B.Provider,{value:_e,children:(0,V.jsx)(Me.Z,(0,F.Z)((0,F.Z)((0,F.Z)({search:!1,options:!1,pagination:!1,rowKey:Q,revalidateOnFocus:!1},Ge),Lt),{},{tableLayout:"fixed",actionRef:_e,onChange:Pe,editable:(0,F.Z)((0,F.Z)({},St),{},{formProps:(0,F.Z)({formRef:H},St.formProps)}),dataSource:q,onDataSourceChange:function(De){if(lt(De),e.name&&te==="top"){var de,Se=(0,vt.Z)({},[e.name].flat(1).filter(Boolean),De);(de=H.current)===null||de===void 0||de.setFieldsValue(Se)}}}))}),e.name?(0,V.jsx)(E.Z,{name:[e.name],children:function(De){var de,Se;if(!pe.current)return pe.current=q,null;var be=(0,qe.Z)(De,[e.name].flat(1)),Ae=be==null?void 0:be.find(function(et,dt){var gt;return!(0,ye.A)(et,(gt=pe.current)===null||gt===void 0?void 0:gt[dt])});return pe.current=q,Ae&&(e==null||(de=e.editable)===null||de===void 0||(Se=de.onValuesChange)===null||Se===void 0||Se.call(de,Ae,be)),null}}):null]})}function We(e){var Ne=u.ZP.useFormInstance();return e.name?(0,V.jsx)(he.Z.Item,(0,F.Z)((0,F.Z)({style:{maxWidth:"100%"}},e==null?void 0:e.formItemProps),{},{name:e.name,shouldUpdate:function(Ie,Pe){var ae=[e.name].flat(1);try{return JSON.stringify((0,qe.Z)(Ie,ae))!==JSON.stringify((0,qe.Z)(Pe,ae))}catch(ve){return!0}},children:(0,V.jsx)(g,(0,F.Z)((0,F.Z)({},e),{},{editable:(0,F.Z)((0,F.Z)({},e.editable),{},{form:Ne})}))})):(0,V.jsx)(g,(0,F.Z)({},e))}We.RecordCreator=Ue;var xt=We},11312:function(jt,at,o){o.d(at,{nu:function(){return rt},rL:function(){return Ne},Du:function(){return e}});var Qe=o(9783),c=o.n(Qe),Te=o(97857),w=o.n(Te),Re=o(19632),F=o.n(Re),m=o(5574),s=o.n(m),Ve=o(45919),ze=o(66419),ce=o(78677),p=o(26271),E=o(78957),u=o(66309),b=o(72051),x=o(71230),ie=o(72269),k=o(83863),ye=o(60943),P=o(67294),he=o(70804),xe=o(80854),qe=o(62235),vt=o(15009),Me=o.n(vt),V=o(99289),oe=o.n(V),L=o(58638),B=o(14726),Ue=o(76841),g=o(85893),We=function(Pe){var ae=Pe.course_id,ve=Pe.stat,Ze=ve===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":ve,Q=(0,P.useState)(!1),je=s()(Q,2),we=je[0],Ye=je[1],Je=(0,P.useCallback)(function(Ge){return oe()(Me()().mark(function pe(){var _e,H;return Me()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Ye(!0),G.prev=1,G.next=4,(0,Ue._g)(Ge,{stat:Ze});case 4:_e=G.sent,_e instanceof Blob&&(H=document.createElement("a"),H.href=window.URL.createObjectURL(_e),H.download="finished_topics_".concat(ae,".xlsx"),document.body.appendChild(H),H.click(),document.body.removeChild(H)),G.next=11;break;case 8:G.prev=8,G.t0=G.catch(1),console.error(G.t0);case 11:return G.prev=11,Ye(!1),G.finish(11);case 14:case"end":return G.stop()}},pe,null,[[1,8,11,14]])}))},[Ze]);return(0,g.jsxs)(B.ZP,{type:"primary",loading:we,onClick:Je(ae),children:[(0,g.jsx)(L.Z,{})," ",(0,g.jsx)(xe.FormattedMessage,{id:"export"})]})},xt=function(Pe){return Pe.topicable.content.contents?Object.values(Pe.topicable.content.contents)[0].library:"H5P"},e=function(Pe){var ae=Pe.course_id,ve=Pe.topics,Ze=Pe.stats,Q=(0,P.useState)(!1),je=s()(Q,2),we=je[0],Ye=je[1],Je=(0,P.useMemo)(function(){return[{title:(0,g.jsx)(xe.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(_e){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:_e})}},{title:(0,g.jsx)(xe.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(F()(ve.map(function(pe){var _e,H=(_e=pe.topicable_type)===null||_e===void 0?void 0:_e.split("\\").pop();return H==="H5P"&&(H=xt(pe)),{render:function(G){var q=0;switch(G&&(G.started_at&&G.finished_at?q=1:G.started_at&&(q=2)),q){case 1:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(u.Z,{color:"success",children:"F"}),we&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 2:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(u.Z,{color:"blue",children:"S"}),we&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 0:default:return(0,g.jsx)(P.Fragment,{children:(0,g.jsx)(u.Z,{color:"error",children:"N"})})}},title:(0,g.jsxs)("small",{children:[(0,g.jsx)(u.Z,{children:H})," ",pe.title]}),dataIndex:pe.id}})))},[ve,we]),Ge=(0,P.useMemo)(function(){return Ze.map(function(pe){return ve.reduce(function(_e,H){var me=pe.topics.find(function(G){return G.id===H.id});return w()(w()({},_e),{},c()({},Number(H.id),me!=null?me:0))},{email:pe.email,id:pe.id})})},[Ze,ve]);return(0,g.jsx)(b.Z,{title:function(){return(0,g.jsxs)(x.Z,{justify:"space-between",align:"middle",children:[(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(xe.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,g.jsx)(u.Z,{color:"success",children:"F"}),(0,g.jsx)(xe.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,g.jsx)(u.Z,{color:"blue",children:"S"}),(0,g.jsx)(xe.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,g.jsx)(u.Z,{color:"error",children:"N"}),(0,g.jsx)(xe.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,g.jsx)(ie.Z,{checked:we,onChange:function(H){return Ye(H)}})]}),(0,g.jsx)(We,{course_id:ae})]})},columns:Je,dataSource:Ge,size:"small",scroll:{x:1500},components:{table:function(_e){return(0,g.jsx)(he.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,g.jsx)("table",w()({},_e))})}}})},Ne=function(Pe){var ae=Pe.stats,ve=Pe.attempts,Ze=(0,P.useMemo)(function(){return[{title:(0,g.jsx)(xe.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(we){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:we})}},{title:(0,g.jsx)(xe.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,g.jsx)(xe.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,g.jsx)(xe.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(we){return we?(0,ye.WU)(new Date(we),Ve.Cu):""}}]},[]),Q=(0,P.useMemo)(function(){return ae.map(function(je){var we=je.id,Ye=je.email,Je=je.finished_at,Ge=ve==null?void 0:ve.find(function(_e){return _e.id===we}),pe=Array.isArray(Ge==null?void 0:Ge.attempts)?Ge==null?void 0:Ge.attempts.length:0;return{id:we,email:Ye,finished_at:Je,attempt:pe}})},[ae]);return(0,g.jsx)(b.Z,{title:function(){return(0,g.jsx)(E.Z,{children:(0,g.jsx)(xe.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ze,dataSource:Q,size:"small",scroll:{x:500}})},rt=function(Pe){var ae=Pe.stats,ve=(0,P.useState)(null),Ze=s()(ve,2),Q=Ze[0],je=Ze[1],we=(0,P.useState)(null),Ye=s()(we,2),Je=Ye[0],Ge=Ye[1],pe=(0,xe.useIntl)(),_e=(0,P.useMemo)(function(){return ae.flatMap(function(me){return Object.values(me.attempts).flatMap(function(G){var q=G.dates,lt=G.attempt,$=Object.values(q).flatMap(function(re){var W=re.date,K=re.seconds_total;return{date:W,attempt:lt,seconds_total:K,email:me.email}});return $})})},[ae]),H={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,g.jsx)(p.ZP,{title:(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(xe.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,g.jsx)(k.default,{showSearch:!0,value:Q,onChange:function(G){je(G),Ge(null)},placeholder:(0,g.jsx)(xe.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:ae.map(function(me){var G=me.id,q=me.email;return(0,g.jsx)(k.default.Option,{value:q,children:q},G)})}),(0,g.jsx)(k.default,{value:Je,onChange:function(G){return Ge(G)},disabled:Q===null,placeholder:(0,g.jsx)(xe.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:F()(new Set(_e.filter(function(me){var G=me.email;return G===Q}).map(function(me){var G=me.attempt;return G}))).map(function(me){return(0,g.jsxs)(k.default.Option,{value:me,children:[(0,g.jsx)(xe.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",me]},me)})})]}),colSpan:12,layout:"center",children:(0,g.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,g.jsx)(ce.Z,w()(w()({},H),{},{tooltip:{title:"".concat(pe.formatMessage({id:"attempt"})),formatter:function(G){var q=Math.floor(+G.seconds_total/60),lt=+G.seconds_total>60?+G.seconds_total-q*60:0;return{name:G.attempt,value:"".concat(q,"m ").concat(lt,"s")}}},data:_e.filter(function(me){var G=me.email;return G===Q}).filter(function(me){var G=me.attempt;return Number.isInteger(Je)?G===Je:!0})}))})})}},87366:function(jt,at,o){o.d(at,{Il:function(){return vt},_y:function(){return E},uS:function(){return x}});var Qe=o(5574),c=o.n(Qe),Te=o(97857),w=o.n(Te),Re=o(19632),F=o.n(Re),m=o(2453),s=o(67294),Ve=o(80854),ze=o(99100),ce=o(31472),p=o(85893),E=s.createContext({}),u=function(){return Math.round(Math.random()*99999)},b=function Me(V){return V.reduce(function(oe,L){return[].concat(F()(oe),F()(L.lessons?Me(L.lessons):[]),[L])},[])},x=function Me(V){return V.reduce(function(oe,L){var B;return[].concat(F()(oe),F()(L.lessons?Me(L.lessons):[]),F()((B=L.topics)!==null&&B!==void 0?B:[]))},[])},ie=function Me(V,oe,L){return V.map(function(B){var Ue,g;return w()(w()({},B),{},{lessons:B.lessons?Me(B.lessons,oe,L):[],topics:B.id===oe?[].concat(F()((Ue=B.topics)!==null&&Ue!==void 0?Ue:[]),[L]):(g=B.topics)!==null&&g!==void 0?g:[]})})},k=function Me(V,oe,L){return L?V.map(function(B){return w()(w()({},B),{},{lessons:[].concat(F()(B.lessons?Me(B.lessons,oe,L):[]),F()(B.id===L?[oe]:[]))})}):[].concat(F()(V),[oe])},ye=function Me(V,oe,L){return V.map(function(B){return w()(w()({},B.id===oe?L:B),{},{lessons:B.lessons?Me(B.lessons,oe,L):[]})})},P=function Me(V,oe){return V.map(function(L){return w()(w()({},L),{},{parent_id:oe,lessons:L.lessons?Me(L.lessons,L.id):[]})})},he=function Me(V,oe){return V.filter(function(L){return L.id!==oe}).map(function(L){return w()(w()({},L),{},{lessons:L.lessons?Me(L.lessons,oe):[]})})},xe=function Me(V,oe){return V.map(function(L){return w()(w()({},L),{},{lessons:L.lessons?Me(L.lessons,oe):[],topics:L.topics?L.topics.filter(function(B){return B.id!==oe}):[]})})},qe=function Me(V,oe,L,B){return B==null?void 0:B.map(function(Ue){if(Ue.id===L){var g;return w()(w()({},Ue),{},{topics:(g=Ue.topics)===null||g===void 0?void 0:g.map(function(We){return We.id===V?oe.file.response.data:We})})}else if(Ue.lessons)return w()(w()({},Ue),{},{lessons:Me(V,oe,L,Ue.lessons||[])});return Ue})},vt=function(V){var oe=V.children,L=V.id,B=(0,s.useState)(),Ue=c()(B,2),g=Ue[0],We=Ue[1],xt=(0,Ve.useIntl)(),e=(0,s.useMemo)(function(){return g&&g.lessons?x(g.lessons):[]},[g]),Ne=(0,s.useMemo)(function(){return g&&g.lessons?b(g.lessons):[]},[g]),rt=(0,s.useState)([]),Ie=c()(rt,2),Pe=Ie[0],ae=Ie[1],ve=(0,Ve.useLocation)(),Ze=(0,s.useMemo)(function(){var $=new URLSearchParams(ve.search);return{lesson:$.get("lesson"),topic:$.get("topic")}},[ve]);(0,s.useEffect)(function(){ae([])},[]);var Q=(0,s.useCallback)(function(){(0,ze.Nx)(L).then(function($){return $.success&&We(w()(w()({},$.data),{},{lessons:P($.data.lessons)}))})},[L]);(0,s.useEffect)(function(){Q()},[Q]);var je=(0,s.useCallback)(function($){var re=Ne.find(function(W){var K;return W==null||(K=W.topics)===null||K===void 0?void 0:K.find(function(te){return te.id===$})});return re?re.id:null},[Ne]),we=(0,s.useMemo)(function(){return Ze.lesson?{mode:"lesson",id:Number(Ze.lesson),value:Ne.find(function($){return $.id===Number(Ze.lesson)})}:Ze.topic?{mode:"topic",id:Number(Ze.topic),value:e.find(function($){return $.id===Number(Ze.topic)})}:{mode:"init"}},[Ze,g,Ne,e]),Ye=(0,s.useCallback)(function($){var re={course_id:L,topics:[],isNew:!0,id:g?g.lessons.length+1:u(),order:0,title:xt.formatMessage({id:"add_title_here"}),active:!0,parent_id:$};return We(function(W){var K;return w()(w()({},W),{},{lessons:k((K=W==null?void 0:W.lessons)!==null&&K!==void 0?K:[],re,$)})}),re},[L,g]),Je=(0,s.useCallback)(function($,re){var W=Ne.find(function(te){return te.id===$}),K=W&&W.isNew;return(K?(0,ze.aA)(re):(0,ze.sI)($,re)).then(function(te){return m.ZP.success(te.message),Q(),te.success&&We(function(ne){var Xe;return w()(w()({},ne),{},{lessons:ye((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],$,w()(w()({},te.data),{},{isNew:!1}))})})})},[g]),Ge=(0,s.useCallback)(function($){var re=Ne.find(function(K){return K.id===$});if(re){var W=re.isNew;W?We(function(K){var te;return w()(w()({},K),{},{lessons:he((te=K==null?void 0:K.lessons)!==null&&te!==void 0?te:[],$)})}):(0,ze.iI)($).then(function(K){K.success&&(m.ZP.success(K.message),We(function(te){var ne;return w()(w()({},te),{},{lessons:he((ne=te==null?void 0:te.lessons)!==null&&ne!==void 0?ne:[],$)})}))})}},[g]),pe=(0,s.useCallback)(function($,re){var W,K=je($),te=Ne.find(function(tt){return tt.id===K}),ne=te&&((W=te.topics)===null||W===void 0?void 0:W.find(function(tt){return tt.id===$})),Xe=ne==null?void 0:ne.isNew;return(Xe?(0,ze.HV)(re):(0,ze.Cn)($,re)).then(function(tt){tt.success&&(m.ZP.success(tt.message),Q(),Ve.history.push("/courses/list/".concat(L,"/program/?topic=").concat(tt.data.id)),(ne==null?void 0:ne.topicable_type)===ce.oz.Video&&setTimeout(function(){Q()},5e3))})},[je,g,Q]),_e=(0,s.useCallback)(function($){var re=je($),W=Ne.find(function(ne){return ne.id===re});if(W){var K=e==null?void 0:e.find(function(ne){return ne.id===$}),te=K==null?void 0:K.isNew;te&&!K.topicable?We(function(ne){var Xe;return w()(w()({},ne),{},{lessons:xe((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],$)})}):(0,ze.vJ)($).then(function(ne){ne.success&&(m.ZP.success(ne.message),We(function(Xe){var tt;return w()(w()({},Xe),{},{lessons:xe((tt=Xe==null?void 0:Xe.lessons)!==null&&tt!==void 0?tt:[],$)})}))})}},[g,je]),H=(0,s.useCallback)(function($,re){var W={lesson_id:$,isNew:!0,id:u(),title:xt.formatMessage({id:"add_title_here"}),active:!0,topicable_type:re};return We(function(K){var te;return w()(w()({},K),{},{lessons:ie((te=K==null?void 0:K.lessons)!==null&&te!==void 0?te:[],$,W)})}),W},[]),me=function(re,W){var K=je(re);We(function(te){return w()(w()({},te),{},{lessons:te?qe(re,W,K,te.lessons||[]):[]})}),Ve.history.push("/courses/list/".concat(L,"/program/?topic=").concat(W.file.response.data.id))},G=(0,s.useCallback)(function($){return(0,ze.Cx)($).then(function(re){if(re.success){m.ZP.success(re.message);var W=je($);We(function(K){var te;return w()(w()({},K),{},{lessons:K?(te=K.lessons)===null||te===void 0?void 0:te.map(function(ne){if(ne.id===W){var Xe=ne.topics||[];return w()(w()({},ne),{},{topics:[].concat(F()(Xe),[re.data])})}return ne}):[]})})}})},[g,je]),q=(0,s.useCallback)(function($){return(0,ze.if)($).then(function(re){re.success&&(m.ZP.success(re.message),We(function(W){return w()(w()({},W),{},{lessons:W?[].concat(F()(W.lessons),[re.data]):[]})}))})},[]),lt={state:g,h5ps:Pe,id:L,addNewLesson:Ye,updateLesson:Je,updateTopic:pe,deleteLesson:Ge,addNewTopic:H,deleteTopic:_e,onTopicUploaded:me,cloneTopic:G,cloneLesson:q,currentEditMode:we,getLessons:Q};return(0,p.jsx)(E.Provider,{value:lt,children:oe})}},42733:function(jt,at,o){o.r(at),o.d(at,{default:function(){return $r}});var Qe=o(97857),c=o.n(Qe),Te=o(26271),w=o(74453),Re=o(75081),F=o(14726),m=o(67294),s=o(80854),Ve=o(91115),ze=o(26114),ce=o(15009),p=o.n(ce),E=o(9783),u=o.n(E),b=o(99289),x=o.n(b),ie=o(19632),k=o.n(ie),ye=o(5574),P=o.n(ye),he=o(16894),xe=o(2453),qe=o(60943);function vt(i,n){return Me.apply(this,arguments)}function Me(){return Me=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Me.apply(this,arguments)}function V(i,n,t,r){return oe.apply(this,arguments)}function oe(){return oe=x()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n,"/attendances"),c()({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return d.stop()}},i)})),oe.apply(this,arguments)}var L=o(78957),B=o(83062),Ue=o(84567),g=o(31472);function We(i){var n,t=i===null?g.cX.ABSENT:i,r=u()(u()(u()(u()({},g.cX.PRESENT,{ch1:!0,ch2:!1}),g.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),g.cX.ABSENT,{ch1:!1,ch2:!1}),g.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(n=r[t])!==null&&n!==void 0?n:{ch1:!1,ch2:!1}}function xt(i){var n,t=i.ch1,r=i.ch2,a="".concat(t,"_").concat(r),l={true_false:g.cX.PRESENT,true_true:g.cX.PRESENT_NOT_EXERCISING,false_false:g.cX.ABSENT,false_true:g.cX.EXCUSED_ABSENCE};return(n=l[a])!==null&&n!==void 0?n:g.cX.ABSENT}var e=o(85893),Ne=function(n){var t=n.groupAttendanceScheduleId,r=n.studentId,a=n.attendance,l=n.onSuccess,d=(0,m.useState)(We(a)),f=P()(d,2),h=f[0],M=f[1],_=(0,m.useState)(!1),C=P()(_,2),T=C[0],v=C[1],j=(0,m.useRef)(!0),S=(0,m.useCallback)(function(Z){v(!0),V(t,r,xt(Z)).then(function(D){D.success&&(l==null||l())}).finally(function(){return v(!1)})},[]),y=(0,m.useCallback)(function(Z){return M(Z.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),O=(0,m.useCallback)(function(Z){return M(function(D){return c()(c()({},D),{},{ch2:Z.target.checked})})},[]);return(0,m.useEffect)(function(){if(j.current){j.current=!1;return}S(h)},[h,S]),(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(Ue.Z,{disabled:T,checked:h.ch1,onChange:y})}),(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:h.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(Ue.Z,{disabled:T,checked:h.ch2,onChange:O})})]})},rt=Ne,Ie=o(45919),Pe=o(95213),ae=o(7092),ve=o(66149),Ze=function(){var n=(0,ae.Z)(),t=n.teacherSubjectData,r=(0,m.useState)([]),a=P()(r,2),l=a[0],d=a[1],f=(0,m.useState)(""),h=P()(f,2),M=h[0],_=h[1],C=(0,s.useIntl)(),T=(0,m.useRef)(),v=(0,m.useMemo)(function(){var S;return((S=t==null?void 0:t.groups)!==null&&S!==void 0?S:[]).map(function(y){var O=y.id,Z=y.name;return{value:O,label:Z}})},[t==null?void 0:t.groups]),j=(0,m.useMemo)(function(){var S;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:v,defaultValue:v==null||(S=v[0])===null||S===void 0?void 0:S.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(l))},[v,l]);return(0,e.jsx)(he.ZP,{className:"table-standalone",headerTitle:"".concat(C.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(M,")"),request:function(){var S=x()(p()().mark(function y(O){var Z,D,ee,U,Y,R,I,A,N,se,Ke;return p()().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:return D=O.group_id,ee=D===void 0?v==null||(Z=v[0])===null||Z===void 0?void 0:Z.value:D,U=O.full_name,Y=U===void 0?"":U,Le.next=3,Promise.all([(0,Pe.X)(ee),vt(ee)]);case 3:if(R=Le.sent,I=P()(R,2),A=I[0],N=I[1],se=v.find(function($e){var X=$e.value;return X===ee}),!(!A.success||!N.success||!se)){Le.next=10;break}return Le.abrupt("return",{data:[],total:0,success:!1});case 10:if(N.data.length){Le.next=13;break}return xe.ZP.error(C.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),Le.abrupt("return",{data:[],total:0,success:!1});case 13:return _(se.label),d(N.data.reduce(function($e,X){return[].concat(k()($e),[{title:String((0,qe.WU)(new Date(X.date_from),Ie.GC)),dataIndex:String(X.date_from),hideInSearch:!0,width:100,align:"center",render:function(z,ue){return(0,e.jsx)(rt,{groupAttendanceScheduleId:X.id,attendance:ue["".concat(X==null?void 0:X.date_from)],studentId:ue.id})}}])},[])),Ke=A.data.users.reduce(function($e,X){var Fe=X.id,z=X.academic_teacher_id,ue=X.first_name,Ee=X.last_name,Oe="".concat(Ee," ").concat(ue);if(z!==null||!Oe.toLowerCase().includes(Y.toLowerCase()))return $e;var J=N.data.reduce(function(ge,fe){var Ce=fe.attendances.find(function(ke){return ke.user_id===Fe});return Ce?c()(c()({},ge),{},u()({},"".concat(fe.date_from),Ce.value)):ge},{});return[].concat(k()($e),[c()({id:Fe,full_name:Oe},J)])},[]).sort(function($e,X){return $e.full_name.localeCompare(X.full_name)}),Le.abrupt("return",{data:Ke,total:Ke.length,success:!0});case 17:case"end":return Le.stop()}},y)}));return function(y){return S.apply(this,arguments)}}(),columns:j,search:{layout:"vertical"},pagination:{defaultPageSize:ve.S,onChange:function(){var y;return(y=T.current)===null||y===void 0?void 0:y.reload()}},scroll:{x:1500},actionRef:T,rowKey:"id"})},Q=o(25514),je=o(28248),we=o(2487),Ye=o(96365),Je=o(75842);function Ge(i,n){return pe.apply(this,arguments)}function pe(){return pe=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"GET",params:n},t||{})));case 1:case"end":return a.stop()}},i)})),pe.apply(this,arguments)}function _e(i,n){return H.apply(this,arguments)}function H(){return H=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),H.apply(this,arguments)}function me(i,n,t){return G.apply(this,arguments)}function G(){return G=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),c()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},i)})),G.apply(this,arguments)}function q(i,n,t){return lt.apply(this,arguments)}function lt(){return lt=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),c()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},i)})),lt.apply(this,arguments)}var $=function(n){var t=n.visible,r=n.onClose,a=n.user,l=Q.Z.Text,d=a.name,f=a.groupId,h=a.userId,M=(0,m.useState)(""),_=P()(M,2),C=_[0],T=_[1],v=(0,m.useState)(!1),j=P()(v,2),S=j[0],y=j[1],O=(0,m.useState)([]),Z=P()(O,2),D=Z[0],ee=Z[1],U=(0,m.useState)(null),Y=P()(U,2),R=Y[0],I=Y[1],A=(0,m.useState)({current_page:1,per_page:5,last_page:1,total:0}),N=P()(A,2),se=N[0],Ke=N[1],He=function(){var Fe=x()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Ge({bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h,page:ue,per_page:se.per_page});case 2:Ee=J.sent,Ee.success&&(ee(Ee.data),Ke(Ee.meta));case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}(),Le=function(){var Fe=x()(p()().mark(function z(){var ue;return p()().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return Oe.next=2,_e({value:C,bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h});case 2:ue=Oe.sent,ue.success&&(He(),y(!1),T(""));case 4:case"end":return Oe.stop()}},z)}));return function(){return Fe.apply(this,arguments)}}(),$e=function(){var Fe=x()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,q(ue);case 2:Ee=J.sent,Ee.success&&He();case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}(),X=function(){var Fe=x()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,me(ue,{value:(R==null?void 0:R.currentText)||"",bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h});case 2:Ee=J.sent,Ee.success&&(He(),I(null));case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}();return(0,m.useEffect)(function(){He()},[]),(0,e.jsxs)(je.Z,{title:(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(d,")")})]}),open:t,onCancel:r,footer:[(0,e.jsx)(F.ZP,{onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(we.Z,{dataSource:D,pagination:{onChange:function(z){return He(z)},pageSize:se.per_page,total:se.total,current:se.current_page},renderItem:function(z){return(0,e.jsx)(we.Z.Item,{actions:[(0,e.jsx)(F.ZP,{danger:!0,onClick:function(){return $e(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},z.id),(R==null?void 0:R.currentNoteId)===z.id?(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(F.ZP,{onClick:function(){return X(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(F.ZP,{onClick:function(){return I(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(F.ZP,{onClick:function(){return I({currentNoteId:z.id,currentText:z.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},z.id)],children:(R==null?void 0:R.currentNoteId)===z.id&&(R==null?void 0:R.currentText)!==null?(0,e.jsx)(Ye.Z.TextArea,{value:R==null?void 0:R.currentText,onChange:function(Ee){return I(function(Oe){return c()(c()({},Oe),{},{currentText:Ee.target.value})})}}):z.value})}}),S?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Je.Z,{layout:"vertical",children:(0,e.jsx)(Je.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(Ye.Z.TextArea,{value:C,onChange:function(z){return T(z.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(F.ZP,{type:"primary",onClick:Le,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return y(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return y(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},re=$;function W(i,n){return K.apply(this,arguments)}function K(){return K=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},i)})),K.apply(this,arguments)}function te(i,n){return ne.apply(this,arguments)}function ne(){return ne=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),ne.apply(this,arguments)}function Xe(i,n,t){return tt.apply(this,arguments)}function tt(){return tt=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),tt.apply(this,arguments)}function Tt(i,n){return yt.apply(this,arguments)}function yt(){return yt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),yt.apply(this,arguments)}function Ft(i,n){return pt.apply(this,arguments)}function pt(){return pt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),pt.apply(this,arguments)}function Lt(i,n,t,r){return St.apply(this,arguments)}function St(){return St=x()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n,"/users/").concat(t),c()({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return d.stop()}},i)})),St.apply(this,arguments)}function Vt(i,n,t){return le.apply(this,arguments)}function le(){return le=_asyncToGenerator(_regeneratorRuntime().mark(function i(n,t,r){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(n,"/users/").concat(t),_objectSpread({method:"DELETE"},r||{})));case 1:case"end":return l.stop()}},i)})),le.apply(this,arguments)}function De(i,n,t){return de.apply(this,arguments)}function de(){return de=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),c()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),de.apply(this,arguments)}function Se(i,n,t,r){return be.apply(this,arguments)}function be(){return be=x()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),c()({method:"POST",data:r},a||{})));case 1:case"end":return d.stop()}},i)})),be.apply(this,arguments)}function Ae(i,n){return et.apply(this,arguments)}function et(){return et=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",c()({method:"GET",params:{groups:n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),et.apply(this,arguments)}function dt(i,n,t){return gt.apply(this,arguments)}function gt(){return gt=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),c()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),gt.apply(this,arguments)}function Et(i){return _t.apply(this,arguments)}function _t(){return _t=x()(p()().mark(function i(n){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-terms",c()({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},i)})),_t.apply(this,arguments)}function zt(i,n){return $t.apply(this,arguments)}function $t(){return $t=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),$t.apply(this,arguments)}function Xt(i,n){return Rt.apply(this,arguments)}function Rt(){return Rt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades",c()({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Rt.apply(this,arguments)}function Ht(i,n,t){return Nt.apply(this,arguments)}function Nt(){return Nt=x()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),c()({method:"PATCH",data:t},r||{})));case 1:case"end":return l.stop()}},i)})),Nt.apply(this,arguments)}function Yt(i,n){return Ot.apply(this,arguments)}function Ot(){return Ot=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),Ot.apply(this,arguments)}var Pt=o(47389),fa=o(13769),Zt=o.n(fa),va=["results"],Jt=function(n,t){return n.reduce(function(r,a){var l=a.results,d=Zt()(a,va),f=l.find(function(h){return h.user_id===t});return f?[].concat(k()(r),[c()(c()({},d),{},{result:f})]):r},[])},Qt=function(n,t){var r,a=n.reduce(function(v,j){var S=j.result,y=j.weight;return[v[0]+S.result*y,v[1]+y]},[0,0]),l=P()(a,2),d=l[0],f=l[1],h=Number.isNaN(d/f)?0:d/f,M=t.sort(function(v,j){return v.grade_value-j.grade_value}).reduce(function(v,j){return[].concat(k()(v),[c()(c()({},j),{},{isWeightedAverageGreater:h>=j.grade_value})])},[]);if(M.every(function(v){var j=v.isWeightedAverageGreater;return j})){var _,C;return(_=(C=M.at(-1))===null||C===void 0?void 0:C.name)!==null&&_!==void 0?_:""}var T=M.findIndex(function(v){var j=v.isWeightedAverageGreater;return!j});return T<0?"":(r=M[T-1])===null||r===void 0?void 0:r.name},qt=function(n,t){var r;return(r=t.find(function(a){return a.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},ea=o(8925),pa=o(96486),ga=function(n){var t=n.exam_id,r=n.result,a=n.student_id,l=n.onSuccess,d=(0,m.useCallback)((0,pa.debounce)(function(f){Lt(t,a,{result:f!=null?f:0}).then(function(h){h.success&&(l==null||l(h.data))})},300),[t,r,a]);return(0,e.jsx)(ea.Z,{type:"number",min:0,max:100,onChange:d,defaultValue:r})},It=o(83863),ha=function(n,t){var r;return(r=n.find(function(a){return a.name===t}))===null||r===void 0?void 0:r.id},xa=function(n){var t=n.term,r=n.gradeScales,a=n.defaultFinalGrade,l=n.finalGrades,d=(0,m.useState)(a),f=P()(d,2),h=f[0],M=f[1],_=(0,m.useState)(!1),C=P()(_,2),T=C[0],v=C[1],j=(0,m.useState)(!1),S=P()(j,2),y=S[0],O=S[1],Z=(0,s.useIntl)(),D=(0,m.useMemo)(function(){return r.map(function(Y){var R=Y.name,I=Y.id;return{value:I,label:R}})},[r]),ee=function(R){O(!0),xe.ZP.error(Z.formatMessage({id:R.data.message}))},U=(0,m.useCallback)(function(Y){if(l!=null&&l.id){if(Y===void 0){if(!h)return;v(!0),Yt(h.id).then(function(R){R.success&&M(void 0)}).finally(function(){return v(!1)});return}if(h){v(!0),Ht(h.id,{grade_scale_id:Y}).catch(function(R){var I;R!=null&&(I=R.data)!==null&&I!==void 0&&I.message&&ee(R)}).finally(function(){return v(!1)});return}v(!0),Xt({grade_term_id:t.id,grade_scale_id:Y,lesson_group_user_id:l.id}).then(function(R){if(R.success){var I=R.data.grades.find(function(A){return A.grade_term.id===t.id});M(I),y&&O(!1)}}).catch(function(R){var I;R!=null&&(I=R.data)!==null&&I!==void 0&&I.message&&ee(R)}).finally(function(){return v(!1)})}},[h,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(It.default,{allowClear:!0,status:y?"error":"",loading:T,disabled:T,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:U,options:D,defaultValue:ha(r,a==null?void 0:a.grade_name)}):null},ja=function(n){var t=n.reduce(function(r,a){return[].concat(k()(r),[{title:(0,qe.WU)(new Date(a.date_from),Ie.GC),dataIndex:"attendance-".concat(a.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,f){return(0,e.jsx)(rt,{groupAttendanceScheduleId:a.id,attendance:f["attendance-".concat(a==null?void 0:a.date_from)],studentId:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Sa=function(n,t){return n.reduce(function(r,a){var l=a.attendances.find(function(d){return d.user_id===t});return l?c()(c()({},r),{},u()({},"attendance-".concat(a.date_from),l.value)):r},{})},ba=function(n){var t=n.reduce(function(r,a){return[].concat(k()(r),[{dataIndex:"exam-".concat(a.id),title:(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:a}),hideInSearch:!0,width:100,render:function(d,f){var h;return(f==null||(h=f["exam-".concat(a.id)])===null||h===void 0?void 0:h.result)!==void 0?(0,e.jsx)(ga,{result:f==null?void 0:f["exam-".concat(a.id)].result,exam_id:a.id,student_id:f.id}):"-"}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},ya=function(n){return n.reduce(function(t,r){var a=r.result,l=r.id;return c()(c()({},t),{},u()({},"exam-".concat(l),a))},{})},_a=function(n,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(l,d){var f;return(0,e.jsx)(xa,{defaultFinalGrade:d["final-grade-".concat(r.id)],finalGrades:d.final_grades,term:r,gradeScales:t},"".concat(d==null||(f=d.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(r.id))}}})}},Ma=function(n,t){return n.find(function(r){return r.user.id===t})},Ca=function(n){var t;return((t=n==null?void 0:n.grades)!==null&&t!==void 0?t:[]).reduce(function(r,a){return c()(c()({},r),{},u()({},"final-grade-".concat(a.grade_term.id),a))},{})},Ta=function(){var n,t=(0,ae.Z)(),r=t.teacherSubjectData,a=t.semester_subject_id,l=(0,m.useState)([]),d=P()(l,2),f=d[0],h=d[1],M=(0,m.useState)(r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.name),_=P()(M,2),C=_[0],T=_[1],v=(0,m.useState)(null),j=P()(v,2),S=j[0],y=j[1],O=(0,s.useIntl)(),Z=(0,m.useMemo)(function(){var U;return((U=r==null?void 0:r.groups)!==null&&U!==void 0?U:[]).map(function(Y){var R=Y.id,I=Y.name;return{value:R,label:I}})},[r==null?void 0:r.groups]),D=(0,m.useRef)(),ee=(0,m.useMemo)(function(){var U;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:Z,defaultValue:Z==null||(U=Z[0])===null||U===void 0?void 0:U.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(R,I){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{}),onClick:function(){return y({userName:I.full_name,userId:I.id,groupId:I.final_grades.group_id})}})})})}}])},[Z,f]);return(0,e.jsxs)(e.Fragment,{children:[(S==null?void 0:S.userId)&&(0,e.jsx)(re,{visible:!!S.userId,onClose:function(){return y(null)},user:{name:S.userName,userId:S.userId,groupId:S.groupId}}),(0,e.jsx)(he.ZP,{sticky:!0,className:"table-standalone",request:function(){var U=x()(p()().mark(function Y(R){var I,A,N,se,Ke,He,Le,$e,X,Fe,z,ue,Ee,Oe,J,ge,fe,Ce,ke,nt,mt;return p()().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return se=R.group_id,Ke=se===void 0?(I=Z[0])===null||I===void 0?void 0:I.value:se,He=R.full_name,Le=He===void 0?"":He,Be.next=3,Ae(Ke);case 3:if($e=Be.sent,X=Z.find(function(it){var ut=it.value;return ut===Ke}),!(!$e.success||$e.data[0]===void 0||a===null)){Be.next=8;break}return xe.ZP.error(O.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 8:return Be.next=10,Promise.all([(0,Pe.X)(Ke),vt(Ke),W({group_id:Ke,per_page:-1}),De(a,(A=$e.data)===null||A===void 0||(A=A[0])===null||A===void 0?void 0:A.tutor_id),Et(),zt((N=$e.data)===null||N===void 0||(N=N[0])===null||N===void 0?void 0:N.s_subject_scale_form_id)]);case 10:if(Fe=Be.sent,z=P()(Fe,6),ue=z[0],Ee=z[1],Oe=z[2],J=z[3],ge=z[4],fe=z[5],!(!ue.success||!Ee.success||!Oe.success||!J.success||!ge.success||!fe.success||!X)){Be.next=21;break}return xe.ZP.error(O.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 21:return T(X.label),Ce=ja(Ee.data),ke=ba(Oe.data),nt=_a(ge.data,fe.data),h([Ce,ke,nt,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),mt=ue.data.users.reduce(function(it,ut){var At,st,Mt,bt=ut.id,Rr=ut.academic_teacher_id,Nr=ut.first_name,Or=ut.last_name,ca="".concat(Or," ").concat(Nr);if(Rr!==null||!ca.toLowerCase().includes(Le.toLowerCase()))return it;var Ur=Sa(Ee.data,bt),ma=Jt(Oe.data,bt),Ct=Ma($e.data,bt),kr=(At=qt((st=Ct==null?void 0:Ct.s_subject_scale_form_id)!==null&&st!==void 0?st:0,(Mt=J.data.grade_scale)!==null&&Mt!==void 0?Mt:[]))!==null&&At!==void 0?At:[],Br=Qt(ma,kr),Wr=ya(ma),Kr=Ca(Ct);return[].concat(k()(it),[c()(c()(c()(c()({id:bt,full_name:ca},Ur),Wr),Kr),{},{proposed_grade:Br,final_grades:Ct})])},[]).sort(function(it,ut){return it.full_name.localeCompare(ut.full_name)}),Be.abrupt("return",{data:mt,total:mt.length,success:!0});case 28:case"end":return Be.stop()}},Y)}));return function(Y){return U.apply(this,arguments)}}(),columns:ee,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:C}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:D,pagination:{defaultPageSize:ve.S,onChange:function(){var Y;return(Y=D.current)===null||Y===void 0?void 0:Y.reload()}},rowKey:"id"})]})},ta=o(1413),Fa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ea=Fa,Pa=o(84089),aa=function(n,t){return m.createElement(Pa.Z,(0,ta.Z)((0,ta.Z)({},n),{},{ref:t,icon:Ea}))};aa.displayName="LineChartOutlined";var Za=m.forwardRef(aa),ra=o(82061),na=o(86738),wt=o(62235),ot=o(952),Ia=o(5966),wa=o(50335),sa=o(71230),ht=o(15746),Ga=o(56717),ia=o(95830),Da=o(29477),Aa=function(n){var t=n.type,r=n.onDataConverted,a=n.groupSelectDisabled,l=(0,ae.Z)(),d=l.semester_subject_id,f=l.teacherSubjectData,h=(0,m.useState)(null),M=P()(h,2),_=M[0],C=M[1],T=(0,m.useMemo)(function(){var S;return((S=f==null?void 0:f.groups)!==null&&S!==void 0?S:[]).map(function(y){var O=y.id,Z=y.name;return{label:Z,value:O}})},[]),v={type:t,group_id:_,semester_subject_id:d},j=(0,m.useCallback)(function(S){if(S.success){var y=S.data.results.filter(function(O){var Z=O.user_id;return Z!==null});if(!y.length)return;r({exam_results:y,group_id:S.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(It.default,{disabled:a,value:_,onChange:function(y){return C(y)},options:T,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Da.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:j,onChange:function(y){return!y.fileList.length&&r(void 0)},maxFiles:1,data:v,disabled:!_})]})},La=function(n){var t=n.onDataConverted,r=(0,ae.Z)(),a=r.teacherSubjectData,l=r.groupUsers,d=(0,m.useState)(null),f=P()(d,2),h=f[0],M=f[1],_=(0,m.useMemo)(function(){var T;return((T=a==null?void 0:a.groups)!==null&&T!==void 0?T:[]).map(function(v){var j=v.id,S=v.name;return{label:S,value:j}})},[]),C=(0,m.useCallback)(function(T){var v;M(T);var j=(v=l.byId)===null||v===void 0?void 0:v[T];if(j){var S=j.users.reduce(function(y,O){var Z=O.id,D=O.email,ee=O.first_name,U=O.last_name,Y=O.academic_teacher_id;return Y!==null?y:[].concat(k()(y),[{email:D,first_name:ee,last_name:U,user_id:Z,result:0}])},[]);t({group_id:T,exam_results:S})}},[l.byId]);return(0,e.jsx)(It.default,{value:h,onChange:C,options:_,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Gt=u()(u()(u()(u()({},g.UL.TestPortal,["/teacher-examples/testPortal.png"]),g.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),g.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),g.UL.Manual,[]),$a=function(n){var t=n.images,r=(0,m.useState)(!1),a=P()(r,2),l=a[0],d=a[1],f=(0,m.useCallback)(function(){return d(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(F.ZP,{onClick:f,icon:(0,e.jsx)(Ga.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:d},children:t.map(function(h){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:h},h)})})]})},Ra=function(n){var t,r=n.type,a=n.onOk,l=n.onCancel,d=n.okDisabled,f=(t=Gt==null?void 0:Gt[r])!==null&&t!==void 0?t:Gt[g.UL.Manual];return(0,e.jsxs)(L.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)($a,{images:f}),(0,e.jsxs)(L.Z,{children:[(0,e.jsx)(F.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(F.ZP,{type:"primary",disabled:d,onClick:a,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Na=[g.UL.TeamsLecture,g.UL.TestPortal,g.UL.TeamsForms],Oa=function(n){var t=n.open,r=n.closeModal,a=n.onSuccess,l=n.type,d=(0,ae.Z)(),f=d.teacherSubjectData,h=d.fetchGroupUsers,M=(0,m.useState)(),_=P()(M,2),C=_[0],T=_[1];return(0,m.useEffect)(function(){if(l===g.UL.Manual&&t){var v;f==null||(v=f.groups)===null||v===void 0||v.forEach(function(j){var S=j.id;return h(S)})}},[l,t]),(0,e.jsxs)(je.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:r,footer:(0,e.jsx)(Ra,{type:l,onOk:function(){C&&a(C)},onCancel:r,okDisabled:!C}),children:[Na.includes(l)&&(0,e.jsx)(Aa,{type:l,onDataConverted:T,groupSelectDisabled:!!C}),l===g.UL.Manual&&(0,e.jsx)(La,{onDataConverted:T})]})},Ua=function(n){var t=n.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ka=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Ba=function(n){var t,r=n.exam_id,a=ot.ZP.useForm(),l=P()(a,1),d=l[0],f=(0,m.useState)(),h=P()(f,2),M=h[0],_=h[1],C=(0,m.useState)(),T=P()(C,2),v=T[0],j=T[1],S=(0,m.useState)(!1),y=P()(S,2),O=y[0],Z=y[1],D=(0,ae.Z)(),ee=D.semester_subject_id,U=D.getGroupById,Y=(0,m.useMemo)(function(){var I;return((I=v==null?void 0:v.exam_results)!==null&&I!==void 0?I:[]).map(function(A){var N=A.user_id;return N})},[v==null?void 0:v.exam_results]);(0,m.useEffect)(function(){var I=Number(r);r==="new"&&(_(void 0),j(void 0),d.resetFields()),r!=="new"&&!Number.isNaN(I)&&(Z(!0),Tt(I).then(function(A){if(A.success){var N=A.data,se=N.type,Ke=N.results,He=N.title,Le=N.weight,$e=N.passed_at,X=N.group_id;_(se),j({group_id:X,exam_results:Ke}),d.setFieldsValue({title:He,weight:Le,passed_at:$e})}}).finally(function(){return Z(!1)}))},[r]);var R=(0,m.useCallback)(function(){_(void 0),j(void 0)},[]);return O?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[M&&(0,e.jsx)(Oa,{open:!!(M&&!v),type:M,closeModal:R,onSuccess:j}),(0,e.jsxs)(ot.ZP,{form:d,submitter:M===void 0||!v?!1:void 0,onFinish:function(){var I=x()(p()().mark(function A(N){var se,Ke,He,Le,$e,X,Fe,z,ue,Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(Ke=v==null||(se=v.exam_results)===null||se===void 0?void 0:se.every(function(ge){var fe=ge.result;return typeof fe=="number"&&fe>=0&&fe<=100}),!(v&&Ke&&typeof ee=="number")){J.next=17;break}if(He=N.title,Le=N.passed_at,$e=N.weight,X=Number(r),Fe=v.exam_results,z=v.group_id,ue={type:M,semester_subject_id:ee,title:He,passed_at:Le,weight:$e,group_id:z,results:Fe},!Number.isNaN(X)){J.next=12;break}return J.next=9,te(ue);case 9:J.t0=J.sent,J.next=15;break;case 12:return J.next=14,Xe(X,ue);case 14:J.t0=J.sent;case 15:Ee=J.t0,Ee.success&&s.history.push("/teacher/subjects/".concat(ee,"/exams"));case 17:return J.abrupt("return",!0);case 18:case"end":return J.stop()}},A)}));return function(A){return I.apply(this,arguments)}}(),onReset:R,children:[(0,e.jsxs)(ot.ZP.Group,{children:[(0,e.jsx)(Ia.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(wa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),(0,e.jsx)(ot.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(ea.Z,{})})]}),M&&v&&(0,e.jsx)(he.ZP,{rowKey:"user_id",headerTitle:(t=U(v.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:Y,onValuesChange:function(A,N){return j({group_id:v.group_id,exam_results:N})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:v.exam_results.sort(function(I,A){return I.last_name.localeCompare(A.last_name)}),pagination:{defaultPageSize:ve.S},columns:ka}),!v&&(0,e.jsx)(Ua,{onSelect:_})]})]})},Wa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Ka=function(n){var t=n.exam_id,r=(0,m.useState)(""),a=P()(r,2),l=a[0],d=a[1];return(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:ve.S},request:x()(p()().mark(function f(){var h;return p()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,Tt(t);case 2:if(h=_.sent,!h.success){_.next=6;break}return d(h.data.title),_.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return _.abrupt("return",[]);case 7:case"end":return _.stop()}},f)})),columns:Wa})},Va=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&(0,qe.WU)(new Date(t.passed_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight+"%"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&(0,qe.WU)(new Date(t.created_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return(0,e.jsx)(wt.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],za=function(){var n,t=(0,m.useRef)(),r=(0,ae.Z)(),a=r.semester_subject_id,l=(0,s.useLocation)(),d=new URLSearchParams(l.search),f=(n=d.get("exam_id"))!==null&&n!==void 0?n:null,h=d.get("results");return h!==null&&!Number.isNaN(Number(h))?(0,e.jsx)(Ka,{exam_id:Number(h)}):f!==null?(0,e.jsx)(Ba,{exam_id:f}):(0,e.jsx)(he.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:ve.S},request:function(){var M=x()(p()().mark(function _(C,T){var v,j,S,y;return p()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(v=C.current,j=C.pageSize,a!==null){Z.next=3;break}return Z.abrupt("return",{data:[],total:0,success:!1});case 3:return S=T&&Object.entries(T)[0],Z.next=6,W({per_page:j,page:v,semester_subject_id:Number.isNaN(a)?void 0:a,order_by:S&&S[0],order:S&&(S[1]==="ascend"?"ASC":"DESC")});case 6:if(y=Z.sent,!y.success){Z.next=9;break}return Z.abrupt("return",{data:y.data,total:y.meta.total,success:!0});case 9:return Z.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return Z.stop()}},_)}));return function(_,C){return M.apply(this,arguments)}}(),columns:[].concat(Va,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(_,C){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C.semester_subject_id,"/exams?exam_id=").concat(C.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C.semester_subject_id,"/exams?results=").concat(C.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(F.ZP,{icon:(0,e.jsx)(Za,{})})})},"results"),(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:x()(p()().mark(function T(){var v;return p()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Ft(C.id);case 2:v=S.sent,v.success&&t.current&&t.current.reload();case 4:case"end":return S.stop()}},T)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(ra.Z,{}),danger:!0})})},"delete")]}}])})},Xa=o(69753),ua=o(44167),Ha=o(84665),Ya=["type","defaultRender"],Ja=["type","defaultRender"],Qa=function(n){var t=n.url;return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(Xa.Z,{})})})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return(0,qe.WU)(new Date(t.created_at),Ie.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,d=Zt()(t,Ya);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(ua.Z,c()(c()({},d),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(r=t.created_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.created_by)!==null&&a!==void 0&&a.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return(0,qe.WU)(new Date(t.exported_at),Ie.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,d=Zt()(t,Ja);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(ua.Z,c()(c()({},d),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(r=t.exported_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.exported_by)!==null&&a!==void 0&&a.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(n,t){return[(0,e.jsx)(Qa,{url:t.url},"download")]}}],er=function(){var n,t=(0,ae.Z)(),r=t.teacherSubjectData,a=(0,m.useMemo)(function(){var d;return((d=r==null?void 0:r.groups)!==null&&d!==void 0?d:[]).map(function(f){var h=f.id,M=f.name;return{value:h,label:M}})},[r==null?void 0:r.groups]),l=(0,m.useMemo)(function(){var d;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:a,defaultValue:r==null||(d=r.groups)===null||d===void 0||(d=d[0])===null||d===void 0?void 0:d.id,allowClear:!1}}].concat(qa)},[r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.id,a]);return(0,e.jsx)(he.ZP,{className:"table-standalone",request:function(){var d=x()(p()().mark(function f(h){var M,_,C,T,v,j;return p()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return _=h.group_id,C=_===void 0?r==null||(M=r.groups)===null||M===void 0||(M=M[0])===null||M===void 0?void 0:M.id:_,T=h.created_by,v=h.exported_by,y.next=3,(0,Ha.v)({group_id:C,created_by:T,exported_by:v});case 3:if(j=y.sent,j.success){y.next=6;break}return y.abrupt("return",{success:!1,data:[],total:0});case 6:return y.abrupt("return",{success:!0,data:j.data,total:j.data.length});case 7:case"end":return y.stop()}},f)}));return function(f){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:ve.S}})},oa=o(64317),Ut=o(96074),la=o(11312),tr=o(87366),kt=o(99100),ar=["attendances"];function rr(i){return function(t){i(function(r){return c()(c()({},r),{},{loading:t})})}}function da(i,n){return Bt.apply(this,arguments)}function Bt(){return Bt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n(!0),a.prev=1,a.abrupt("return",t());case 3:return a.prev=3,n(!1),a.finish(3);case 6:case"end":return a.stop()}},i,null,[[1,,3,6]])})),Bt.apply(this,arguments)}function nr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useCallback)(rr(l),[]),f=(0,m.useCallback)(x()(p()().mark(function M(){var _;return p()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,dt(i,n);case 2:if(_=T.sent,_.success){T.next=5;break}return T.abrupt("return",_);case 5:return l(function(v){return c()(c()({},v),{},{data:_.data})}),T.abrupt("return",_);case 7:case"end":return T.stop()}},M)})),[n,i]),h=(0,m.useCallback)(function(M){return da(d,function(){return Yt(M).then(f)})},[f]);return(0,m.useEffect)(function(){da(d,f)},[f]),{finalGrades:a,deleteFinalGrade:h}}function sr(){var i=(0,m.useState)({loading:!1}),n=P()(i,2),t=n[0],r=n[1];return(0,m.useEffect)(function(){r(function(a){return c()(c()({},a),{},{loading:!0})}),Et().then(function(a){a.success&&r(function(l){return c()(c()({},l),{},{data:a.data})})}).finally(function(){r(function(a){return c()(c()({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function ir(i){var n=(0,m.useState)({loading:!1}),t=P()(n,2),r=t[0],a=t[1];return(0,m.useEffect)(function(){i!==void 0&&(a(function(l){return c()(c()({},l),{},{loading:!0})}),zt(i).then(function(l){l.success&&a(function(d){return c()(c()({},d),{},{data:l.data})})}).finally(function(){a(function(l){return c()(c()({},l),{},{loading:!1})})}))},[i]),{subjectGradeScales:r}}function ur(i,n,t){var r=(0,m.useState)({loading:!1}),a=P()(r,2),l=a[0],d=a[1];return(0,m.useEffect)(function(){typeof i!="number"||typeof n!="number"||typeof t!="number"||(d(function(f){return c()(c()({},f),{},{loading:!0})}),De(i,n).then(function(f){f.success&&d(function(h){var M,_;return c()(c()({},h),{},{data:(M=qt(t,(_=f.data.grade_scale)!==null&&_!==void 0?_:[]))===null||M===void 0?void 0:M.map(function(C,T){return c()(c()({},C),{},{id:T})})})})}).finally(function(){d(function(f){return c()(c()({},f),{},{loading:!1})})}))},[i,n]),{tutorGradeScales:l}}function or(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useCallback)(function(){l(function(f){return c()(c()({},f),{},{loading:!0})}),vt(i).then(function(f){if(f.success){var h=f.data.reduce(function(M,_){var C=_.attendances,T=Zt()(_,ar),v=C.find(function(j){return j.user_id===n});return v?[].concat(k()(M),[c()(c()({},T),{},{attendance:v})]):M},[]);l(function(M){return c()(c()({},M),{},{data:h})})}}).finally(function(){l(function(f){return c()(c()({},f),{},{loading:!1})})})},[i,n]);return(0,m.useEffect)(function(){d()},[d]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:d}}function lr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1];return(0,m.useEffect)(function(){n&&(l(function(d){return c()(c()({},d),{},{loading:!0})}),W({student_id:i,semester_subject_id:n}).then(function(d){if(d.success){var f=Jt(d.data,i);l(function(h){return c()(c()({},h),{},{data:f})})}}).finally(function(){l(function(d){return c()(c()({},d),{},{loading:!1})})}))},[i,n]),{studentExams:a}}function dr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useState)({loading:!1}),f=P()(d,2),h=f[0],M=f[1],_=(0,m.useState)({loading:!1}),C=P()(_,2),T=C[0],v=C[1];return(0,m.useEffect)(function(){l(function(j){return c()(c()({},j),{},{loading:!0})}),(0,kt.N7)({group_id:i}).then(function(j){j.success&&l(function(S){return c()(c()({},S),{},{data:j.data})})}).finally(function(){l(function(j){return c()(c()({},j),{},{loading:!1})})})},[i]),(0,m.useEffect)(function(){a.data&&(v(function(j){return c()(c()({},j),{},{loading:!0})}),Promise.all(a.data.map(function(j){var S=j.id;return(0,kt.Nx)(Number(S))})).then(function(j){j.forEach(function(S){S.success&&v(function(y){return c()(c()({},y),{},{data:c()(c()({},y.data),{},u()({},Number(S.data.id),(0,tr.uS)(S.data.lessons)))})})})}).finally(function(){v(function(j){return c()(c()({},j),{},{loading:!1})})}),M(function(j){return c()(c()({},j),{},{loading:!0})}),Promise.all(a.data.map(function(j){var S=j.id;return(0,kt.ue)(Number(S),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(y){if(y.success){var O,Z,D=((O=y.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&O!==void 0?O:[]).filter(function(U){return U.id===n}),ee=(Z=y.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&Z!==void 0?Z:[];M(function(U){return c()(c()({},U),{},{data:c()(c()({},U.data),{},u()({},Number(S),{finishedTopics:D,attendanceList:ee}))})})}})})).finally(function(){return M(function(j){return c()(c()({},j),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:h,userCoursesTopics:T}}var cr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],mr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(n,t){return(0,qe.WU)(new Date(t.date_from),Ie.GC)}}],fr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return(0,qe.WU)(new Date(t.created_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result,"%")}}],vr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?(0,qe.WU)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),Ie.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],Dt=6,pr=function(n){var t,r,a,l,d=n.user_id,f=n.group_id,h=(0,ae.Z)(),M=h.semester_subject_id,_=lr(d,M),C=_.studentExams,T=nr(f,d),v=T.finalGrades,j=T.deleteFinalGrade,S=sr(),y=S.gradeTerms,O=ir((t=v.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),Z=O.subjectGradeScales,D=ur(M,(r=v.data)===null||r===void 0?void 0:r.tutor_id,(a=v.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),ee=D.tutorGradeScales,U=or(f,d),Y=U.userAttendanceSchedules,R=U.fetchUserAttendanceSchedules,I=dr(f,d),A=I.userCourses,N=I.userCoursesStats,se=I.userCoursesTopics,Ke=ot.ZP.useForm(),He=P()(Ke,1),Le=He[0],$e=(0,m.useMemo)(function(){var ge;return((ge=y.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce=fe.id,ke=fe.name;return{label:ke,value:Ce}})},[y.data]),X=(0,m.useMemo)(function(){var ge;return((ge=Z.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce=fe.name,ke=fe.id;return{label:Ce,value:ke}})},[Z.data]),Fe=(0,m.useMemo)(function(){var ge,fe;return Qt((ge=C.data)!==null&&ge!==void 0?ge:[],(fe=ee.data)!==null&&fe!==void 0?fe:[])},[C.data,ee.data]),z=(0,m.useCallback)(function(){var ge=x()(p()().mark(function fe(Ce){var ke,nt,mt,ft,Be,it,ut;return p()().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(mt=Ce.grade_scale_id,ft=Ce.grade_term_id,((ke=v.data)===null||ke===void 0?void 0:ke.id)!==void 0){st.next=3;break}return st.abrupt("return");case 3:if(Be=(nt=v.data)===null||nt===void 0?void 0:nt.grades.find(function(Mt){var bt=Mt.grade_term;return bt.id===ft}),!Be){st.next=11;break}return st.next=7,Ht(Be.id,{grade_scale_id:mt});case 7:return it=st.sent,xe.ZP[it.success?"success":"error"](it.message),it.success&&s.history.push("/teacher/subjects/".concat(M,"/final-grades")),st.abrupt("return");case 11:return st.next=13,Xt({grade_scale_id:mt,grade_term_id:ft,lesson_group_user_id:v.data.id});case 13:ut=st.sent,xe.ZP[ut.success?"success":"error"](ut.message),ut.success&&s.history.push("/teacher/subjects/".concat(M,"/final-grades"));case 16:case"end":return st.stop()}},fe)}));return function(fe){return ge.apply(this,arguments)}}(),[v.data,M]),ue=(0,m.useMemo)(function(){return[].concat(vr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(fe,Ce){var ke;return typeof(Ce==null||(ke=Ce.grade)===null||ke===void 0?void 0:ke.id)=="number"?[(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return j(Ce.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(ra.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),Ee=(0,m.useMemo)(function(){var ge;return((ge=y.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce;return c()(c()({},fe),{},{grade:(Ce=v.data)===null||Ce===void 0?void 0:Ce.grades.find(function(ke){var nt=ke.grade_term;return nt.id===fe.id})})})},[v.data,y.data]),Oe=A.loading&&!A.data||N.loading&&!N.data||se.loading&&!se.data,J=!!(A.data&&N.data&&se.data);return v.loading?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[v.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:v.data.user})}),(0,e.jsx)(Ut.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:C.data,loading:C.loading,columns:fr,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:Ee,loading:v.loading||y.loading,columns:ue,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:Y.data,loading:Y.loading,columns:[].concat(mr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(fe,Ce){return(0,e.jsx)(rt,{groupAttendanceScheduleId:Ce.id,studentId:d,attendance:Ce.attendance.value,onSuccess:R})}}])})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:ee.data,loading:ee.loading,columns:cr})}),Oe&&(0,e.jsx)(Re.Z,{}),J&&((l=A.data)===null||l===void 0?void 0:l.map(function(ge){var fe,Ce,ke,nt,mt,ft,Be=ge.id,it=ge.title;return(0,e.jsxs)(ht.Z,{span:24,children:[(0,e.jsx)(Q.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:it}),(0,e.jsx)(la.Du,{course_id:Number(Be),topics:(fe=(Ce=se.data)===null||Ce===void 0?void 0:Ce[Number(Be)])!==null&&fe!==void 0?fe:[],stats:(ke=(nt=N.data)===null||nt===void 0||(nt=nt[Number(Be)])===null||nt===void 0?void 0:nt.finishedTopics)!==null&&ke!==void 0?ke:[]}),(0,e.jsx)(la.nu,{stats:(mt=(ft=N.data)===null||ft===void 0||(ft=ft[Number(Be)])===null||ft===void 0?void 0:ft.attendanceList)!==null&&mt!==void 0?mt:[]})]},Be)}))]}),(0,e.jsx)(ot.ZP,{form:Le,onFinish:z,children:(0,e.jsxs)(ot.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(oa.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:$e,width:"sm",fieldProps:{loading:y.loading}}),(0,e.jsx)(oa.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:X,fieldProps:{loading:v.loading||Z.loading}}),(0,e.jsx)(ot.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Fe}})})]})})]})},gr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,l=r.grade_term,d=r.id;return(0,e.jsxs)(Q.Z.Text,{children:[l.name,": ",a]},d)}):"-"})}}],hr=function(){var n,t,r=(0,s.useLocation)(),a=new URLSearchParams(r.search),l=(n=a.get("user_id"))!==null&&n!==void 0?n:null,d=(t=a.get("group_id"))!==null&&t!==void 0?t:null,f=(0,ae.Z)(),h=f.teacherSubjectData,M=f.semester_subject_id,_=(0,m.useMemo)(function(){var C;return((C=h==null?void 0:h.groups)!==null&&C!==void 0?C:[]).map(function(T){var v=T.id,j=T.name;return{label:j,value:v}})},[h==null?void 0:h.groups]);return l!==null&&d!==null?(0,e.jsx)(pr,{user_id:Number(l),group_id:Number(d)}):(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:ve.S},request:function(){var C=x()(p()().mark(function T(v){var j,S,y,O,Z,D,ee,U,Y,R;return p()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return S=v.group_id,y=S===void 0?[]:S,O=v.first_name,Z=O===void 0?"":O,D=v.last_name,ee=D===void 0?"":D,U=((j=h==null?void 0:h.groups)!==null&&j!==void 0?j:[]).map(function(N){var se=N.id;return se}),A.next=4,Ae(y.length===0?U:y);case 4:if(Y=A.sent,Y.success){A.next=7;break}return A.abrupt("return",{success:!1,total:0,data:[]});case 7:return R=Y.data.filter(function(N){var se=N.user;return se.first_name.toLowerCase().includes(Z.toLowerCase())&&se.last_name.toLowerCase().includes(ee.toLowerCase())}),A.abrupt("return",{success:!0,total:R.length,data:R});case 9:case"end":return A.stop()}},T)}));return function(T){return C.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:_,mode:"multiple"},render:function(T,v){return(0,e.jsx)(wt.Z,{type:"Students",type_id:v.group_id},v.group_id)}}].concat(gr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(T,v){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(M,"/final-grades?user_id=").concat(v.user.id,"&group_id=").concat(v.group_id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{})})})},"edit")]}}])})},xr=o(88284),jr=o(88280),Sr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],br=function(n){var t=n.subjectTutorGradeScale,r=n.onFormSubmit,a=(0,m.useState)([]),l=P()(a,2),d=l[0],f=l[1],h=(0,m.useRef)(),M=ot.ZP.useForm(),_=P()(M,1),C=_[0];return(0,m.useEffect)(function(){var T,v=((T=t.scale)!==null&&T!==void 0?T:[]).map(function(j,S){return c()(c()({},j),{},{id:String((S+1)*100)})});C.setFieldValue("table",v)},[]),(0,e.jsx)(ot.ZP,{form:C,onFinish:r,submitter:{render:function(v,j){var S=P()(j,2),y=S[1];return[y]}},children:(0,e.jsx)(jr.Z,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Sr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(v,j){return(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){var y;return(y=h.current)===null||y===void 0?void 0:y.startEditable(j.id)},icon:(0,e.jsx)(Pt.Z,{})})}}]),editable:{form:C,type:"multiple",editableKeys:d,saveText:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(xr.Z,{})}),onChange:f,actionRender:function(v,j,S){return[S.save]}}})})},yr=function(){var n,t,r=(0,s.useModel)("@@initialState"),a=r.initialState,l=(0,ae.Z)(),d=l.semester_subject_id,f=l.tutors,h=(0,m.useState)(),M=P()(h,2),_=M[0],C=M[1],T=(0,m.useState)(!1),v=P()(T,2),j=v[0],S=v[1],y=(0,m.useState)(null),O=P()(y,2),Z=O[0],D=O[1],ee=(0,m.useMemo)(function(){return!!f.data.find(function(I){var A,N=I.id;return N===(a==null||(A=a.currentUser)===null||A===void 0?void 0:A.id)})},[f.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),U=(0,m.useMemo)(function(){return f.data.map(function(I){var A=I.id,N=I.first_name,se=I.last_name;return{label:"".concat(N," ").concat(se),value:A}})},[f.data]),Y=(0,m.useCallback)(function(){d===null||Z===null||(S(!0),C(void 0),De(d,Z).then(function(I){I.success&&C(I.data)}).finally(function(){S(!1)}))},[d,Z]),R=(0,m.useCallback)(function(I,A){return function(){var N=x()(p()().mark(function se(Ke){var He,Le;return p()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(d===null||Z===null)){X.next=2;break}return X.abrupt("return");case 2:return He=I.reduce(function(Fe,z){return z.s_subject_scale_form_id===A?[].concat(k()(Fe),[{s_subject_scale_form_id:A,scale:Ke.table.map(function(ue){var Ee=ue.name,Oe=ue.grade,J=ue.grade_value;return{name:Ee,grade:Oe,grade_value:J}})}]):[].concat(k()(Fe),[z])},[]),X.next=5,Se(d,Z,{grade_scale:He});case 5:Le=X.sent,Le.success&&Y();case 7:case"end":return X.stop()}},se)}));return function(se){return N.apply(this,arguments)}}()},[Z,d]);return(0,m.useEffect)(function(){var I,A;if(!ee||!(a!=null&&(I=a.currentUser)!==null&&I!==void 0&&I.id)){var N;if((N=f.data)!==null&&N!==void 0&&N[0]){var se;D((se=f.data)===null||se===void 0?void 0:se[0].id)}return}D(a==null||(A=a.currentUser)===null||A===void 0?void 0:A.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,ee]),(0,m.useEffect)(function(){Y()},[Y]),f.loading?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(It.default,{disabled:ee,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:U,value:Z,onChange:function(A){return D(A)}})}),(0,e.jsx)(Ut.Z,{}),j&&!_&&(0,e.jsx)(Re.Z,{}),_!=null&&_.grade_scale?_.grade_scale.map(function(I,A){var N;return(0,e.jsxs)(m.Fragment,{children:[A>0&&(0,e.jsx)(Ut.Z,{}),(0,e.jsx)(br,{subjectTutorGradeScale:I,onFormSubmit:R((N=_.grade_scale)!==null&&N!==void 0?N:[],I.s_subject_scale_form_id)})]},I.s_subject_scale_form_id)}):(0,e.jsx)(Q.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},_r=o(30814),Mr=o(40411),Cr=o(31156),Tr=o(27484),ct=o.n(Tr);function Fr(i,n){return Wt.apply(this,arguments)}function Wt(){return Wt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules",c()({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Wt.apply(this,arguments)}var Er=function(){var n=(0,m.useState)(null),t=P()(n,2),r=t[0],a=t[1],l=(0,m.useState)([]),d=P()(l,2),f=d[0],h=d[1],M=(0,ae.Z)(),_=M.semester_subject_id,C=ct()(),T=(0,m.useMemo)(function(){return f.map(function(D){return{id:D.id,title:"".concat(D.group.name," (").concat(D.term_status.name,")"),start:ct()(D.date_from).toDate(),end:ct()(D.date_to).toDate(),tutor_name:"".concat(D.tutor.first_name," ").concat(D.tutor.last_name),tutor_email:D.tutor.email,semester:D.semester.name,group:D.group.name,subject:D.subject.name,ms_teams_join_url:D.ms_teams_join_url}})},[f]),v=(0,m.useCallback)(function(D,ee){Fr({semester_subject_id:_,date_form:D.toDate(),date_to:ee.toDate()}).then(function(U){U.success&&h(U.data)})},[_]),j=(0,m.useCallback)(function(D){a(D)},[]),S=(0,m.useCallback)(function(){a(null)},[]),y=(0,m.useCallback)(function(D){return D.isSame(C,"day")?"warning":D.isAfter(C,"day")?"success":"error"},[]),O=(0,m.useCallback)(function(D){var ee=T.filter(function(U){return ct()(U.start).isSame(D,"day")});return(0,e.jsx)("ul",{className:"events",children:ee.map(function(U){return(0,e.jsx)("li",{onClick:function(){return j(U)},children:(0,e.jsx)(Mr.Z,{status:y(ct()(U.start)),text:U.title})},U.id)})})},[f]),Z=(0,m.useCallback)(function(D,ee){var U=ct()(D).startOf(ee).subtract(1,"month"),Y=ct()(D).endOf(ee).add(1,"month");v(U,Y)},[]);return(0,m.useEffect)(function(){var D=ct()().startOf("month"),ee=ct()().endOf("month");v(D,ee)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(Cr.Z,{dateCellRender:O,onPanelChange:Z}),(0,e.jsxs)(je.Z,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:S,footer:null,children:[(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",r&&ct()(r.start).format(Ie.E)]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",r&&ct()(r.end).format(Ie.E)]}),(r==null?void 0:r.ms_teams_join_url)&&(0,e.jsx)(Q.Z.Paragraph,{children:(0,e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(F.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},Pr=o(58638);function Zr(i,n){return Kt.apply(this,arguments)}function Kt(){return Kt=x()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Kt.apply(this,arguments)}var Ir=function(n){var t=n.student_id,r=(0,m.useState)(!1),a=P()(r,2),l=a[0],d=a[1],f=(0,m.useCallback)(x()(p()().mark(function h(){var M;return p()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d(!0),C.next=3,Zr({user_id:t});case 3:if(M=C.sent,M.success){C.next=8;break}return xe.ZP.error(M.message),d(!1),C.abrupt("return");case 8:window.open(M.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return C.stop()}},h)})),[]);return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(F.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(Pr.Z,{}),onClick:f})})},wr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Gr=function(n){return n.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},Dr=function(n){return n.reduce(function(t,r){var a,l=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(d,f){return f.academic_teacher_id!==null?d:[].concat(k()(d),[{group_id:r.id,group_name:r.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(k()(t),k()(l))},[])},Ar=function(){var n=(0,ae.Z)(),t=n.teacherSubjectData,r=(0,m.useMemo)(function(){var a;return Gr((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:ve.S},request:function(){var a=x()(p()().mark(function l(d){var f,h,M,_,C,T,v,j,S;return p()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return f=d.groups,h=d.first_name,M=h===void 0?"":h,_=d.last_name,C=_===void 0?"":_,T=d.email,v=T===void 0?"":T,O.next=3,(0,Pe.Z)({parent_id:t==null?void 0:t.group_id,"id[]":f});case 3:if(j=O.sent,j.success){O.next=6;break}return O.abrupt("return",{data:[],total:0,success:!1});case 6:return S=Dr(j.data).filter(function(Z){return Z.first_name.toLowerCase().includes(M.toLowerCase())&&Z.last_name.toLowerCase().includes(C.toLowerCase())&&Z.email.toLowerCase().includes(v.toLowerCase())}),O.abrupt("return",{data:S,total:S.length,success:!0});case 8:case"end":return O.stop()}},l)}));return function(l){return a.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(wr,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,d){return[(0,e.jsx)(Ir,{student_id:d.user_id},"teamsChat")]}}])})},Lr=function(n){var t,r,a=n.tab,l=(0,s.useIntl)(),d=(0,s.useModel)("@@initialState"),f=d.setInitialState,h=d.initialState,M=(0,ae.Z)(),_=M.teacherSubjectData,C=M.semester_subject_id,T=M.tutors,v=(0,m.useCallback)((0,ze.X)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),j=(0,m.useMemo)(function(){return!!T.data.find(function(S){var y,O=S.id;return O===(h==null||(y=h.currentUser)===null||y===void 0?void 0:y.id)})||v(Ve.Z.TeacherListGradeScale)},[]);return _?(0,e.jsx)(w._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:_==null||(t=_.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:a})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C,"/exams?exam_id=new"),children:(0,e.jsx)(F.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(C),breadcrumbName:String((r=_.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:l.formatMessage({id:a,defaultMessage:String(a)})}]}},children:(0,e.jsxs)(Te.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(y){f(c()({},h)),s.history.push("/teacher/subjects/".concat(C,"/").concat(y))}},children:[(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(_r.F,{})},"groups"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(Ar,{})},"students"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(za,{})},"exams"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Er,{})},"schedule"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(Ta,{})},"class-register"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),children:(0,e.jsx)(Ze,{})},"attendance"),j&&(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(yr,{})},"grades-scale"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(hr,{})},"final-grades"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(er,{})},"file-exports-history")]})}):(0,e.jsx)(Re.Z,{})},$r=function(){var i=(0,s.useParams)(),n=i.subjectId,t=i.tab,r=t===void 0?"groups":t;return(0,e.jsx)(ae.p,{semester_subject_id:Number(n),children:(0,e.jsx)(Lr,{tab:r})})}},76841:function(jt,at,o){o.d(at,{Gm:function(){return s},Sx:function(){return p},_g:function(){return ze}});var Qe=o(15009),c=o.n(Qe),Te=o(97857),w=o.n(Te),Re=o(99289),F=o.n(Re),m=o(80854);function s(u,b){return Ve.apply(this,arguments)}function Ve(){return Ve=F()(c()().mark(function u(b,x){return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",(0,m.request)("/api/admin/reports/report",w()({params:b,method:"GET",useCache:!1},x||{})));case 1:case"end":return k.stop()}},u)})),Ve.apply(this,arguments)}function ze(u,b,x){return ce.apply(this,arguments)}function ce(){return ce=F()(c()().mark(function u(b,x,ie){return c()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",(0,m.request)("/api/admin/stats/course/".concat(b,"/export"),w()({params:x,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return ye.stop()}},u)})),ce.apply(this,arguments)}function p(u,b,x){return E.apply(this,arguments)}function E(){return E=F()(c()().mark(function u(b,x,ie){return c()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",(0,m.request)("/api/admin/stats/topic/".concat(b,"/export"),w()({method:"GET",useCache:!1,params:{stat:x},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return ye.stop()}},u)})),E.apply(this,arguments)}},70804:function(jt,at,o){var Qe=o(67294);var c=function(ce,p){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,u){E.__proto__=u}||function(E,u){for(var b in u)u.hasOwnProperty(b)&&(E[b]=u[b])})(ce,p)},Te,w,Re=(function(ce){(function(){var p={}.hasOwnProperty;function E(){for(var u=[],b=0;b<arguments.length;b++){var x=arguments[b];if(x){var ie=typeof x;if(ie==="string"||ie==="number")u.push(x);else if(Array.isArray(x)&&x.length){var k=E.apply(null,x);k&&u.push(k)}else if(ie==="object")for(var ye in x)p.call(x,ye)&&x[ye]&&u.push(ye)}}return u.join(" ")}ce.exports?(E.default=E,ce.exports=E):window.classNames=E})()}(w={path:Te,exports:{},require:function(ce,p){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(p==null&&w.path)}},w.exports),w.exports);function F(ce,p,E){var u,b,x,ie,k;function ye(){var he=Date.now()-ie;he<p&&he>=0?u=setTimeout(ye,p-he):(u=null,E||(k=ce.apply(x,b),x=b=null))}p==null&&(p=100);var P=function(){x=this,b=arguments,ie=Date.now();var he=E&&!u;return u||(u=setTimeout(ye,p)),he&&(k=ce.apply(x,b),x=b=null),k};return P.clear=function(){u&&(clearTimeout(u),u=null)},P.flush=function(){u&&(k=ce.apply(x,b),x=b=null,clearTimeout(u),u=null)},P}F.debounce=F;var m=F;(function(ce,p){p===void 0&&(p={});var E=p.insertAt;if(ce&&typeof document!="undefined"){var u=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css",E==="top"&&u.firstChild?u.insertBefore(b,u.firstChild):u.appendChild(b),b.styleSheet?b.styleSheet.cssText=ce:b.appendChild(document.createTextNode(ce))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var s,Ve=(s="indiana-scroll-container",function(ce,p){if(!ce)return s;var E;typeof ce=="string"?E=ce:p=ce;var u=s;return E&&(u+="__"+E),u+(p?Object.keys(p).reduce(function(b,x){var ie=p[x];return ie&&(b+=" "+(typeof ie=="boolean"?u+"--"+x:u+"--"+x+"_"+ie)),b},""):"")}),ze=function(ce){function p(E){var u=ce.call(this,E)||this;return u.onEndScroll=function(){u.scrolling=!1,!u.pressed&&u.started&&u.processEnd()},u.onScroll=function(b){var x=u.container.current;x.scrollLeft===u.scrollLeft&&x.scrollTop===u.scrollTop||(u.scrolling=!0,u.processScroll(b),u.onEndScroll())},u.onTouchStart=function(b){var x=u.props.nativeMobileScroll;if(u.isDraggable(b.target))if(u.internal=!0,x&&u.scrolling)u.pressed=!0;else{var ie=b.touches[0];u.processClick(b,ie.clientX,ie.clientY),!x&&u.props.stopPropagation&&b.stopPropagation()}},u.onTouchEnd=function(b){var x=u.props.nativeMobileScroll;u.pressed&&(!u.started||u.scrolling&&x?u.pressed=!1:u.processEnd(),u.forceUpdate())},u.onTouchMove=function(b){var x=u.props.nativeMobileScroll;if(u.pressed&&(!x||!u.isMobile)){var ie=b.touches[0];ie&&u.processMove(b,ie.clientX,ie.clientY),b.preventDefault(),u.props.stopPropagation&&b.stopPropagation()}},u.onMouseDown=function(b){u.isDraggable(b.target)&&u.isScrollable()&&(u.internal=!0,u.props.buttons.indexOf(b.button)!==-1&&(u.processClick(b,b.clientX,b.clientY),b.preventDefault(),u.props.stopPropagation&&b.stopPropagation()))},u.onMouseMove=function(b){u.pressed&&(u.processMove(b,b.clientX,b.clientY),b.preventDefault(),u.props.stopPropagation&&b.stopPropagation())},u.onMouseUp=function(b){u.pressed&&(u.started?u.processEnd():(u.internal=!1,u.pressed=!1,u.forceUpdate(),u.props.onClick&&u.props.onClick(b)),b.preventDefault(),u.props.stopPropagation&&b.stopPropagation())},u.container=Qe.createRef(),u.onEndScroll=m(u.onEndScroll,300),u.scrolling=!1,u.started=!1,u.pressed=!1,u.internal=!1,u.getRef=u.getRef.bind(u),u}return function(E,u){function b(){this.constructor=E}c(E,u),E.prototype=u===null?Object.create(u):(b.prototype=u.prototype,new b)}(p,ce),p.prototype.componentDidMount=function(){var E=this.props.nativeMobileScroll,u=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),u.addEventListener("touchstart",this.onTouchStart,{passive:!1}),u.addEventListener("mousedown",this.onMouseDown,{passive:!1}),E&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},p.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},p.prototype.getElement=function(){return this.container.current},p.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},p.prototype.isDraggable=function(E){var u=this.props.ignoreElements;if(u){var b=E.closest(u);return b===null||b.contains(this.getElement())}return!0},p.prototype.isScrollable=function(){var E=this.container.current;return E&&(E.scrollWidth>E.clientWidth||E.scrollHeight>E.clientHeight)},p.prototype.processClick=function(E,u,b){var x=this.container.current;this.scrollLeft=x.scrollLeft,this.scrollTop=x.scrollTop,this.clientX=u,this.clientY=b,this.pressed=!0},p.prototype.processStart=function(E){E===void 0&&(E=!0);var u=this.props.onStartScroll;this.started=!0,E&&document.body.classList.add("indiana-dragging"),u&&u({external:!this.internal}),this.forceUpdate()},p.prototype.processScroll=function(E){if(this.started){var u=this.props.onScroll;u&&u({external:!this.internal})}else this.processStart(!1)},p.prototype.processMove=function(E,u,b){var x=this.props,ie=x.horizontal,k=x.vertical,ye=x.activationDistance,P=x.onScroll,he=this.container.current;this.started?(ie&&(he.scrollLeft-=u-this.clientX),k&&(he.scrollTop-=b-this.clientY),P&&P({external:!this.internal}),this.clientX=u,this.clientY=b,this.scrollLeft=he.scrollLeft,this.scrollTop=he.scrollTop):(ie&&Math.abs(u-this.clientX)>ye||k&&Math.abs(b-this.clientY)>ye)&&(this.clientX=u,this.clientY=b,this.processStart())},p.prototype.processEnd=function(){var E=this.props.onEndScroll;this.container.current&&E&&E({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},p.prototype.getRef=function(E){[this.container,this.props.innerRef].forEach(function(u){u&&(typeof u=="function"?u(E):u.current=E)})},p.prototype.render=function(){var E=this.props,u=E.children,b=E.draggingClassName,x=E.className,ie=E.style,k=E.hideScrollbars,ye=E.component;return Qe.createElement(ye,{className:Re(x,this.pressed&&b,Ve({dragging:this.pressed,"hide-scrollbars":k,"native-scroll":this.isMobile})),style:ie,ref:this.getRef,onScroll:this.onScroll},u)},p.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},p}(Qe.PureComponent);at.Z=ze}}]);
