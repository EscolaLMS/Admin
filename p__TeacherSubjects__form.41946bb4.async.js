(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"/y+f":function(Be,ce,n){"use strict";n.d(ce,"f",function(){return c}),n.d(ce,"d",function(){return S}),n.d(ce,"e",function(){return A}),n.d(ce,"c",function(){return s}),n.d(ce,"a",function(){return le}),n.d(ce,"b",function(){return Ke});var c;(function(o){o.Unselected="",o.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",o.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",o.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",o.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",o.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",o.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",o.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",o.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",o.Project="EscolaLms\\TopicTypeProject\\Models\\Project",o.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(c||(c={}));var W;(function(o){o.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",o.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(W||(W={}));var U;(function(o){o.draft="draft",o.published="published",o.archived="archived"})(U||(U={}));var S;(function(o){o.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",o.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",o.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(S||(S={}));var A;(function(o){o.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(A||(A={}));var l;(function(o){o.cart_fixed="cart_fixed",o.cart_percent="cart_percent",o.product_fixed="product_fixed",o.product_percent="product_percent"})(l||(l={}));var s;(function(o){o.MULTIPLE_CHOICE="multiple_choice",o.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",o.TRUE_FALSE="true_false",o.SHORT_ANSWERS="short_answers",o.MATCHING="matching",o.NUMERICAL_QUESTION="numerical_question",o.ESSAY="essay",o.DESCRIPTION="description"})(s||(s={}));var le;(function(o){o.PRESENT="present",o.ABSENT="absent"})(le||(le={}));var Ke;(function(o){o.Manual="manual",o.TeamsForms="teams_forms",o.TeamsLecture="teams_lecture",o.TestPortal="test_portal"})(Ke||(Ke={}))},"0JQy":function(Be,ce){var n="\\ud800-\\udfff",c="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",S=c+W+U,A="\\ufe0e\\ufe0f",l="["+n+"]",s="["+S+"]",le="\\ud83c[\\udffb-\\udfff]",Ke="(?:"+s+"|"+le+")",o="[^"+n+"]",ee="(?:\\ud83c[\\udde6-\\uddff]){2}",Te="[\\ud800-\\udbff][\\udc00-\\udfff]",xe="\\u200d",Q=Ke+"?",Re="["+A+"]?",ut="(?:"+xe+"(?:"+[o,ee,Te].join("|")+")"+Re+Q+")*",he=Re+Q+ut,tt="(?:"+[o+s+"?",s,ee,Te,l].join("|")+")",ze=RegExp(le+"(?="+le+")|"+tt+he,"g");function _(v){return v.match(ze)||[]}Be.exports=_},"5R/X":function(Be,ce,n){},"5Syx":function(Be,ce,n){"use strict";n.d(ce,"c",function(){return Ve}),n.d(ce,"b",function(){return it}),n.d(ce,"a",function(){return me});var c=n("OaEy"),W=n("2fM7"),U=n("g9YV"),S=n("wCAj"),A=n("BoS7"),l=n("Sdc0"),s=n("jrin"),le=n("k1fw"),Ke=n("DYRE"),o=n("zeV3"),ee=n("+BJd"),Te=n("mr32"),xe=n("oBTY"),Q=n("tJVT"),Re=n("q1tI"),ut=n.n(Re),he=n("9kvl"),tt=n("Vpfc"),ze=n("nhC9"),_=n("LDJE"),v=n("nKUr"),Ye=n.n(v),at=function($){return $.topicable.content.contents?Object.values($.topicable.content.contents)[0].library:"H5P"},Ve=function($){var y=$.topics,K=$.stats,z=Object(Re.useState)(!1),I=Object(Q.a)(z,2),b=I[0],Ce=I[1],Ue=Object(Re.useMemo)(function(){return[{title:Object(v.jsx)(he.a,{id:"user"}),dataIndex:"id",render:function(Se){return Object(v.jsx)(tt.a,{type:"App\\Models\\User",type_id:Se})}},{title:Object(v.jsx)(he.a,{id:"email"}),dataIndex:"email"}].concat(Object(xe.a)(y.map(function(Ae){var Se,Le=(Se=Ae.topicable_type)===null||Se===void 0?void 0:Se.split("\\").pop();return Le==="H5P"&&(Le=at(Ae)),{render:function(L){var B=0,pe=0;switch(L&&(L.started_at&&L.finished_at?B=1:L.started_at&&(B=2),pe=L.seconds/60),B){case 1:return Object(v.jsxs)(o.b,{children:[Object(v.jsx)(Te.a,{color:"success",children:"F"}),b&&Object(v.jsxs)("small",{children:[pe.toFixed(2),"m"]})]});case 2:return Object(v.jsxs)(o.b,{children:[Object(v.jsx)(Te.a,{color:"blue",children:"S"}),b&&Object(v.jsxs)("small",{children:[pe.toFixed(2),"m"]})]});case 0:default:return Object(v.jsx)(ut.a.Fragment,{children:Object(v.jsx)(Te.a,{color:"error",children:"N"})})}},title:Object(v.jsxs)("small",{children:[Object(v.jsx)(Te.a,{children:Le})," ",Ae.title]}),dataIndex:Ae.id}})))},[y,b]),Me=Object(Re.useMemo)(function(){return K.map(function(Ae){return y.reduce(function(Se,Le){var Ne=Ae.topics.find(function(L){return L.id===Le.id});return Object(le.a)(Object(le.a)({},Se),{},Object(s.a)({},Number(Le.id),Ne!=null?Ne:0))},{email:Ae.email,id:Ae.id})})},[K,y]);return Object(v.jsx)(S.a,{title:function(){return Object(v.jsxs)(o.b,{children:[Object(v.jsx)(he.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(v.jsx)(Te.a,{color:"success",children:"F"}),Object(v.jsx)(he.a,{id:"Started",defaultMessage:"Started:"})," ",Object(v.jsx)(Te.a,{color:"blue",children:"S"}),Object(v.jsx)(he.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(v.jsx)(Te.a,{color:"error",children:"N"}),Object(v.jsx)(he.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(v.jsx)(l.a,{checked:b,onChange:function(Le){return Ce(Le)}})]})},columns:Ue,dataSource:Me,size:"small",scroll:{x:1500}})},it=function($){var y=$.stats,K=Object(Re.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(b){return Object(v.jsx)(tt.a,{type:"App\\Models\\User",type_id:b})}},{title:"email",dataIndex:"email"},{title:Object(v.jsx)(he.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),z=Object(Re.useMemo)(function(){return y.map(function(I){var b=I.id,Ce=I.email,Ue=I.finished_at;return{id:b,email:Ce,finished_at:Ue}})},[y]);return Object(v.jsx)(S.a,{title:function(){return Object(v.jsx)(o.b,{children:Object(v.jsx)(he.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:K,dataSource:z,size:"small",scroll:{x:500}})},me=function($){var y=$.stats,K=Object(Re.useState)(null),z=Object(Q.a)(K,2),I=z[0],b=z[1],Ce=Object(Re.useState)(null),Ue=Object(Q.a)(Ce,2),Me=Ue[0],Ae=Ue[1],Se=Object(he.l)(),Le=Object(Re.useMemo)(function(){return y.flatMap(function(L){return Object.values(L.attempts).flatMap(function(B){var pe=B.dates,qe=B.attempt,ct=Object.values(pe).flatMap(function(Ze){var Qe=Ze.date,lt=Ze.seconds_total;return{date:Qe,attempt:qe,seconds_total:lt,email:L.email}});return ct})})},[y]),Ne={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(v.jsx)(ze.a,{title:Object(v.jsxs)(o.b,{children:[Object(v.jsx)(he.a,{id:"course.interactions_time_in_days"}),Object(v.jsx)(W.a,{showSearch:!0,value:I,onChange:function(B){b(B),Ae(null)},placeholder:Object(v.jsx)(he.a,{id:"select_person",defaultMessage:"Select a person"}),children:y.map(function(L){var B=L.id,pe=L.email;return Object(v.jsx)(W.a.Option,{value:pe,children:pe},B)})}),Object(v.jsx)(W.a,{value:Me,onChange:function(B){return Ae(B)},disabled:I===null,placeholder:Object(v.jsx)(he.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(xe.a)(new Set(Le.filter(function(L){var B=L.email;return B===I}).map(function(L){var B=L.attempt;return B}))).map(function(L){return Object(v.jsxs)(W.a.Option,{value:L,children:[Object(v.jsx)(he.a,{id:"attempt",defaultMessage:"Attempt"})," ",L]},L)})})]}),colSpan:12,layout:"center",children:Object(v.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(v.jsx)(_.a,Object(le.a)(Object(le.a)({},Ne),{},{tooltip:{title:"".concat(Se.formatMessage({id:"attempt"})),formatter:function(B){var pe=Math.floor(+B.seconds_total/60),qe=+B.seconds_total>60?+B.seconds_total-pe*60:0;return{name:B.attempt,value:"".concat(pe,"m ").concat(qe,"s")}}},data:Le.filter(function(L){var B=L.email;return B===I}).filter(function(L){var B=L.attempt;return Number.isInteger(Me)?B===Me:!0})}))})})}},Em2t:function(Be,ce,n){var c=n("bahg"),W=n("quyA"),U=n("0JQy");function S(A){return W(A)?U(A):c(A)}Be.exports=S},Hn4i:function(Be,ce,n){"use strict";var c=n("y8nQ"),W=n("Vl3Y"),U=n("+L6B"),S=n("2/Rp"),A=n("rePB"),l=n("ODXe"),s=n("Ff2n"),le=n("x+uP"),Ke=n("HaE+"),o=n("VTBJ"),ee=n("nKUr"),Te=n.n(ee),xe=n("xvlK"),Q=n("WuYN"),Re=n("VMEa"),ut=n("LQCs"),he=n("ft2k"),tt=n("uX+g"),ze=n("+i8S"),_=n("ipCM"),v=n("6cGi"),Ye=n("ub+h"),at=n("bG1m"),Ve=n("q1tI"),it=n.n(Ve),me=n("mWMg"),ne=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],$=["record","position","creatorButtonText","newRecordType","parentKey","style"],y=it.a.createContext(void 0);function K(b){var Ce=b.children,Ue=b.record,Me=b.position,Ae=b.newRecordType,Se=b.parentKey,Le=Object(Ve.useContext)(y);return it.a.cloneElement(Ce,Object(o.a)(Object(o.a)({},Ce.props),{},{onClick:function(){var Ne=Object(Ke.a)(Object(le.a)().mark(function B(pe){var qe,ct,Ze,Qe;return Object(le.a)().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:return Pe.next=2,(qe=(ct=Ce.props).onClick)===null||qe===void 0?void 0:qe.call(ct,pe);case 2:if(Qe=Pe.sent,Qe!==!1){Pe.next=5;break}return Pe.abrupt("return");case 5:Le==null||(Ze=Le.current)===null||Ze===void 0||Ze.addEditRecord(Ue,{position:Me,newRecordType:Ae,parentKey:Se});case 6:case"end":return Pe.stop()}},B)}));function L(B){return Ne.apply(this,arguments)}return L}()}))}function z(b){var Ce,Ue,Me=Object(ut.d)(),Ae=b.onTableChange,Se=b.maxLength,Le=b.formItemProps,Ne=b.recordCreatorProps,L=b.rowKey,B=b.controlled,pe=b.defaultValue,qe=b.onChange,ct=b.editableFormRef,Ze=Object(s.a)(b,ne),Qe=Object(he.a)(b.value),lt=Object(Ve.useRef)(),Pe=Object(Ve.useRef)();Object(Ve.useImperativeHandle)(Ze.actionRef,function(){return lt.current});var V=Object(v.a)(function(){return b.value||pe||[]},{value:b.value,onChange:b.onChange}),Ot=Object(l.a)(V,2),oe=Ot[0],pt=Ot[1],$e=it.a.useMemo(function(){return typeof L=="function"?L:function(Ge,k){return Ge[L]||k}},[L]),P=function(k){if(typeof k=="number"&&!b.name){if(k>=oe.length)return k;var te=oe&&oe[k];return $e==null?void 0:$e(te,k)}if((typeof k=="string"||k>=oe.length)&&b.name){var re=oe.findIndex(function(de,De){var Fe;return($e==null||(Fe=$e(de,De))===null||Fe===void 0?void 0:Fe.toString())===(k==null?void 0:k.toString())});return re}return k};Object(Ve.useImperativeHandle)(ct,function(){var Ge=function(re){var de,De;if(re==null)throw new Error("rowIndex is required");var Fe=P(re),nt=[b.name,(de=Fe==null?void 0:Fe.toString())!==null&&de!==void 0?de:""].flat(1).filter(Boolean);return(De=Pe.current)===null||De===void 0?void 0:De.getFieldValue(nt)},k=function(){var re,de=[b.name].flat(1).filter(Boolean);if(Array.isArray(de)&&de.length===0){var De,Fe=(De=Pe.current)===null||De===void 0?void 0:De.getFieldsValue();return Array.isArray(Fe)?Fe:Object.keys(Fe).map(function(nt){return Fe[nt]})}return(re=Pe.current)===null||re===void 0?void 0:re.getFieldValue(de)};return Object(o.a)(Object(o.a)({},Pe.current),{},{getRowData:Ge,getRowsData:k,setRowData:function(re,de){var De,Fe,nt,mt;if(re==null)throw new Error("rowIndex is required");var _t=P(re),jt=[b.name,(De=_t==null?void 0:_t.toString())!==null&&De!==void 0?De:""].flat(1).filter(Boolean),Tt=((Fe=Pe.current)===null||Fe===void 0||(nt=Fe.getFieldsValue)===null||nt===void 0?void 0:nt.call(Fe))||{},Ct=Object(at.a)(Tt,jt,Object(o.a)(Object(o.a)({},Ge(re)),de||{}));return(mt=Pe.current)===null||mt===void 0?void 0:mt.setFieldsValue(Ct)}})}),Object(Ve.useEffect)(function(){!b.controlled||oe.forEach(function(Ge,k){var te;(te=Pe.current)===null||te===void 0||te.setFieldsValue(Object(A.a)({},$e(Ge,k),Ge))},{})},[oe,b.controlled]),Object(Ve.useEffect)(function(){if(b.name){var Ge;Pe.current=b==null||(Ge=b.editable)===null||Ge===void 0?void 0:Ge.form}},[(Ce=b.editable)===null||Ce===void 0?void 0:Ce.form,b.name]);var F=Ne||{},w=F.record,M=F.position,Y=F.creatorButtonText,J=F.newRecordType,ue=F.parentKey,et=F.style,ft=Object(s.a)(F,$),gt=M==="top",e=Object(Ve.useMemo)(function(){return Se&&Se<=(oe==null?void 0:oe.length)?!1:Ne!==!1&&Object(ee.jsx)(K,{record:Object(tt.a)(w,oe==null?void 0:oe.length,oe)||{},position:M,parentKey:Object(tt.a)(ue,oe==null?void 0:oe.length,oe),newRecordType:J,children:Object(ee.jsx)(S.a,Object(o.a)(Object(o.a)({type:"dashed",style:Object(o.a)({display:"block",margin:"10px 0",width:"100%"},et),icon:Object(ee.jsx)(xe.a,{})},ft),{},{children:Y||Me.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ne,Se,oe==null?void 0:oe.length]),Et=Object(Ve.useMemo)(function(){return e?gt?{components:{header:{wrapper:function(k){var te,re=k.className,de=k.children;return Object(ee.jsxs)("thead",{className:re,children:[de,Object(ee.jsxs)("tr",{style:{position:"relative"},children:[Object(ee.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:e}),Object(ee.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(te=Ze.columns)===null||te===void 0?void 0:te.length,children:e})]})]})}}}}:{tableViewRender:function(k,te){var re,de;return Object(ee.jsxs)(ee.Fragment,{children:[(re=(de=b.tableViewRender)===null||de===void 0?void 0:de.call(b,k,te))!==null&&re!==void 0?re:te,e]})}}:{}},[gt,e]),ht=Object(o.a)({},b.editable),yt=Object(ze.a)(function(Ge,k){var te,re,de;if((te=b.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Ge,k),(de=b.onValuesChange)===null||de===void 0||de.call(b,k,Ge),b.controlled){var De;b==null||(De=b.onChange)===null||De===void 0||De.call(b,k)}});return((b==null?void 0:b.onValuesChange)||((Ue=b.editable)===null||Ue===void 0?void 0:Ue.onValuesChange)||b.controlled&&(b==null?void 0:b.onChange))&&(ht.onValuesChange=yt),Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(y.Provider,{value:lt,children:Object(ee.jsx)(me.a,Object(o.a)(Object(o.a)(Object(o.a)({search:!1,options:!1,pagination:!1,rowKey:L,revalidateOnFocus:!1},Ze),Et),{},{tableLayout:"fixed",actionRef:lt,onChange:Ae,editable:Object(o.a)(Object(o.a)({},ht),{},{formProps:Object(o.a)({formRef:Pe},ht.formProps)}),dataSource:oe,onDataSourceChange:function(k){if(pt(k),b.name&&M==="top"){var te,re=Object(at.a)({},[b.name].flat(1).filter(Boolean),k);(te=Pe.current)===null||te===void 0||te.setFieldsValue(re)}}}))}),b.name?Object(ee.jsx)(Q.a,{name:[b.name],children:function(k){var te,re,de=Object(Ye.a)(k,[b.name].flat(1)),De=de==null?void 0:de.find(function(Fe,nt){return!Object(_.a)(Fe,Qe==null?void 0:Qe[nt])});return De&&Qe&&(b==null||(te=b.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,De,de)),null}}):null]})}function I(b){var Ce=Re.a.useFormInstance();return b.name?Object(ee.jsx)(W.a.Item,Object(o.a)(Object(o.a)({style:{maxWidth:"100%"}},b==null?void 0:b.formItemProps),{},{name:b.name,children:Object(ee.jsx)(z,Object(o.a)(Object(o.a)({},b),{},{editable:Object(o.a)(Object(o.a)({},b.editable),{},{form:Ce})}))})):Object(ee.jsx)(z,Object(o.a)({},b))}I.RecordCreator=K,ce.a=I},KxBF:function(Be,ce){function n(c,W,U){var S=-1,A=c.length;W<0&&(W=-W>A?0:A+W),U=U>A?A:U,U<0&&(U+=A),A=W>U?0:U-W>>>0,W>>>=0;for(var l=Array(A);++S<A;)l[S]=c[S+W];return l}Be.exports=n},LDJE:function(Be,ce,n){"use strict";var c=n("q1tI"),W=n.n(c),U=n("ma/q"),S=n("ZIEt"),A=n("QpZ9"),l=n("GzfL"),s=n("Scwr"),le=function(o,ee){var Te={};for(var xe in o)Object.prototype.hasOwnProperty.call(o,xe)&&ee.indexOf(xe)<0&&(Te[xe]=o[xe]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Q=0,xe=Object.getOwnPropertySymbols(o);Q<xe.length;Q++)ee.indexOf(xe[Q])<0&&Object.prototype.propertyIsEnumerable.call(o,xe[Q])&&(Te[xe[Q]]=o[xe[Q]]);return Te},Ke=Object(c.forwardRef)(function(o,ee){var Te=o.chartRef,xe=o.style,Q=xe===void 0?{height:"inherit"}:xe,Re=o.className,ut=o.loading,he=o.loadingTemplate,tt=o.errorTemplate,ze=le(o,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),_=Object(S.a)(U.a,ze),v=_.chart,Ye=_.container;return Object(c.useEffect)(function(){Object(A.a)(Te,v.current)},[v.current]),Object(c.useImperativeHandle)(ee,function(){return{getChart:function(){return v.current}}}),W.a.createElement(l.a,{errorTemplate:tt},ut&&W.a.createElement(s.a,{loadingTemplate:he,theme:o.theme}),W.a.createElement("div",{className:Re,style:Q,ref:Ye}))});ce.a=Ke},bahg:function(Be,ce){function n(c){return c.split("")}Be.exports=n},olry:function(Be,ce,n){"use strict";n.r(ce);var c=n("k1fw"),W=n("+L6B"),U=n("2/Rp"),S=n("T2oS"),A=n("W9HT"),l=n("q1tI"),s=n("9kvl"),le=n("55Ip"),Ke=n("Ty5D"),o=n("nhC9"),ee=n("tMyG"),Te=n("my69"),xe=n("huej"),Q=n("mJ0o"),Re=n("EhlZ"),ut=n("P2fV"),he=n("NJEC"),tt=n("5Dmo"),ze=n("3S7+"),_=n("qLMh"),v=n("9og8"),Ye=n("sWYD"),at=n("G3dp"),Ve=n("VTBJ"),it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},me=it,ne=n("6VBw"),$=function(u,t){return l.createElement(ne.a,Object(Ve.a)(Object(Ve.a)({},u),{},{ref:t,icon:me}))};$.displayName="LineChartOutlined";var y=l.forwardRef($),K=n("/MfK"),z=n("Qiat"),I=n("mGZj");function b(d,u){return Ce.apply(this,arguments)}function Ce(){return Ce=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(c.a)({method:"GET",useCache:!1,params:u},t||{})));case 1:case"end":return a.stop()}},d)})),Ce.apply(this,arguments)}function Ue(d,u){return Me.apply(this,arguments)}function Me(){return Me=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:u},t||{})));case 1:case"end":return a.stop()}},d)})),Me.apply(this,arguments)}function Ae(d,u,t){return Se.apply(this,arguments)}function Se(){return Se=Object(v.a)(Object(_.a)().mark(function d(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return i.stop()}},d)})),Se.apply(this,arguments)}function Le(d,u){return Ne.apply(this,arguments)}function Ne(){return Ne=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},d)})),Ne.apply(this,arguments)}function L(d,u){return B.apply(this,arguments)}function B(){return B=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u),Object(c.a)({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},d)})),B.apply(this,arguments)}function pe(d,u,t,r){return qe.apply(this,arguments)}function qe(){return qe=Object(v.a)(Object(_.a)().mark(function d(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u,"/users/").concat(t),Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return j.stop()}},d)})),qe.apply(this,arguments)}function ct(d,u,t){return Ze.apply(this,arguments)}function Ze(){return Ze=Object(v.a)(Object(_.a)().mark(function d(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/exams/".concat(u,"/users/").concat(t),Object(c.a)({method:"DELETE"},r||{})));case 1:case"end":return i.stop()}},d)})),Ze.apply(this,arguments)}var Qe=n("Vpfc"),lt=n("giR+"),Pe=n("fyUT"),V=n("tJVT"),Ot=n("14J3"),oe=n("BMrR"),pt=n("jCWc"),$e=n("kPKH"),P=n("VMEa"),F=n("Qurx"),w=n("lR9U"),M=n("/y+f"),Y=n("2qtc"),J=n("kLXV"),ue=n("oBTY"),et=n("OaEy"),ft=n("2fM7"),gt=n("DBJ/"),e=n("nKUr"),Et=function(u){var t=u.type,r=u.onDataConverted,a=u.groupSelectDisabled,i=Object(Q.b)(),j=i.semester_subject_id,O=i.teacherSubjectData,m=Object(l.useState)(null),E=Object(V.a)(m,2),p=E[0],h=E[1],x=Object(l.useMemo)(function(){var T;return((T=O==null?void 0:O.groups)!==null&&T!==void 0?T:[]).map(function(C){var R=C.id,H=C.name;return{label:H,value:R}})},[]),f={type:t,group_id:p,semester_subject_id:j},g=Object(l.useCallback)(function(T){if(T.success){var C=T.data.results.filter(function(R){var H=R.user_id;return H!==null});if(!C.length)return;r({exam_results:C,group_id:T.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(P.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(ft.a,{disabled:a,value:p,onChange:function(C){return h(C)},options:x,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(gt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:g,onChange:function(C){return!C.fileList.length&&r(void 0)},maxFiles:1,data:f,disabled:!p})]})},ht=function(u){var t=u.onDataConverted,r=Object(Q.b)(),a=r.teacherSubjectData,i=r.groupUsers,j=Object(l.useState)(null),O=Object(V.a)(j,2),m=O[0],E=O[1],p=Object(l.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(f){var g=f.id,T=f.name;return{label:T,value:g}})},[]),h=Object(l.useCallback)(function(x){var f;E(x);var g=(f=i.byId)===null||f===void 0?void 0:f[x];if(!!g){var T=g.users.reduce(function(C,R){var H=R.id,D=R.email,je=R.first_name,X=R.last_name,be=R.academic_teacher_id;return be!==null?C:[].concat(Object(ue.a)(C),[{email:D,first_name:je,last_name:X,user_id:H,result:0}])},[]);t({group_id:x,exam_results:T})}},[i.byId]);return Object(e.jsx)(ft.a,{value:m,onChange:h,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},yt=[M.b.TeamsLecture,M.b.TestPortal,M.b.TeamsForms],Ge=function(u){var t=u.open,r=u.closeModal,a=u.onSuccess,i=u.type,j=Object(Q.b)(),O=j.teacherSubjectData,m=j.fetchGroupUsers,E=Object(l.useState)(),p=Object(V.a)(E,2),h=p[0],x=p[1];return Object(l.useEffect)(function(){if(i===M.b.Manual&&t){var f;O==null||(f=O.groups)===null||f===void 0||f.forEach(function(g){var T=g.id;return m(T)})}},[i,t]),Object(e.jsxs)(J.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(i,"Convert")}),width:"40vw",open:t,onCancel:r,onOk:function(){h&&a(h)},okButtonProps:{disabled:!h},children:[yt.includes(i)&&Object(e.jsx)(Et,{type:i,onDataConverted:x,groupSelectDisabled:!!h}),i===M.b.Manual&&Object(e.jsx)(ht,{onDataConverted:x})]})},k=function(u){var t=u.onSelect;return Object(e.jsxs)(oe.a,{gutter:[16,16],children:[Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(M.b.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(M.b.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(M.b.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){return t(M.b.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},te=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],re=function(u){var t,r=u.exam_id,a=P.a.useForm(),i=Object(V.a)(a,1),j=i[0],O=Object(l.useState)(),m=Object(V.a)(O,2),E=m[0],p=m[1],h=Object(l.useState)(),x=Object(V.a)(h,2),f=x[0],g=x[1],T=Object(l.useState)(!1),C=Object(V.a)(T,2),R=C[0],H=C[1],D=Object(Q.b)(),je=D.semester_subject_id,X=D.getGroupById,be=Object(l.useMemo)(function(){var Ie;return((Ie=f==null?void 0:f.exam_results)!==null&&Ie!==void 0?Ie:[]).map(function(ie){var ge=ie.user_id;return ge})},[f==null?void 0:f.exam_results]);Object(l.useEffect)(function(){var Ie=Number(r);r==="new"&&(p(void 0),g(void 0),j.resetFields()),r!=="new"&&!Number.isNaN(Ie)&&(H(!0),Le(Ie).then(function(ie){if(ie.success){var ge=ie.data,q=ge.type,ae=ge.results,ve=ge.title,Ee=ge.weight,ye=ge.passed_at,dt=ge.group_id;p(q),g({group_id:dt,exam_results:ae}),j.setFieldsValue({title:ve,weight:Ee,passed_at:ye})}}).finally(function(){return H(!1)}))},[r]);var we=Object(l.useCallback)(function(){p(void 0),g(void 0)},[]);return R?Object(e.jsx)(A.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(Ge,{open:Boolean(E&&!f),type:E,closeModal:we,onSuccess:g}),Object(e.jsxs)(P.a,{form:j,submitter:E===void 0||!f?!1:void 0,onFinish:function(){var Ie=Object(v.a)(Object(_.a)().mark(function ie(ge){var q,ae,ve,Ee,ye,dt,fe,G,N,Z;return Object(_.a)().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:if(ae=f==null||(q=f.exam_results)===null||q===void 0?void 0:q.every(function(Xe){var He=Xe.result;return typeof He=="number"&&He>=0&&He<=100}),!(f&&ae&&typeof je=="number")){se.next=17;break}if(ve=ge.title,Ee=ge.passed_at,ye=ge.weight,dt=Number(r),fe=f.exam_results,G=f.group_id,N={type:E,semester_subject_id:je,title:ve,passed_at:Ee,weight:ye,group_id:G,results:fe},!Number.isNaN(dt)){se.next=12;break}return se.next=9,Ue(N);case 9:se.t0=se.sent,se.next=15;break;case 12:return se.next=14,Ae(dt,N);case 14:se.t0=se.sent;case 15:Z=se.t0,Z.success&&s.f.push("/teacher/subjects/".concat(je,"/exams"));case 17:return se.abrupt("return",!0);case 18:case"end":return se.stop()}},ie)}));return function(ie){return Ie.apply(this,arguments)}}(),onReset:we,children:[Object(e.jsxs)(P.a.Group,{children:[Object(e.jsx)(F.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(w.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(P.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Pe.a,{})})]}),E&&f&&Object(e.jsx)(z.a,{rowKey:"user_id",headerTitle:(t=X(f.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:be,onValuesChange:function(ie,ge){return g({group_id:f.group_id,exam_results:ge})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:f.exam_results,columns:te}),!f&&Object(e.jsx)(k,{onSelect:p})]})]})},de=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],De=function(u){var t=u.exam_id,r=Object(l.useState)(""),a=Object(V.a)(r,2),i=a[0],j=a[1];return Object(e.jsx)(z.a,{rowKey:"user_id",search:!1,headerTitle:i,request:Object(v.a)(Object(_.a)().mark(function O(){var m;return Object(_.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Le(t);case 2:if(m=p.sent,!m.success){p.next=6;break}return j(m.data.title),p.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},O)})),columns:de})},Fe=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(u,t){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(t.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(u,t){return t.passed_at&&Object(Ye.a)(new Date(t.passed_at),I.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(u,t){return t.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(u,t){return t.created_at&&Object(Ye.a)(new Date(t.created_at),I.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(u,t){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(u,t){return Object(e.jsx)(Qe.a,{type:"Students",type_id:t.group_id},t.group_id)}}],nt=function(){var u,t,r=Object(l.useRef)(),a=Object(Q.b)(),i=a.semester_subject_id,j=Object(Ke.k)(),O=Object(l.useMemo)(function(){var p,h,x;return{exam_id:(p=(h=j.query)===null||h===void 0?void 0:h.exam_id)!==null&&p!==void 0?p:null,results:(x=j.query)===null||x===void 0?void 0:x.results}},[(u=j.query)===null||u===void 0?void 0:u.exam_id,(t=j.query)===null||t===void 0?void 0:t.results]),m=O.exam_id,E=O.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(De,{exam_id:Number(E)}):m!==null?Object(e.jsx)(re,{exam_id:m}):Object(e.jsx)(z.a,{headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var p=Object(v.a)(Object(_.a)().mark(function h(x,f){var g,T,C,R;return Object(_.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(g=x.current,T=x.pageSize,i!==null){D.next=3;break}return D.abrupt("return",{data:[],total:0,success:!1});case 3:return C=f&&Object.entries(f)[0],D.next=6,b({per_page:T,page:g,semester_subject_id:Number.isNaN(i)?void 0:i,order_by:C&&C[0],order:C&&(C[1]==="ascend"?"ASC":"DESC")});case 6:if(R=D.sent,!R.success){D.next=9;break}return D.abrupt("return",{data:R.data,total:R.meta.total,success:!0});case 9:return D.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return D.stop()}},h)}));return function(h,x){return p.apply(this,arguments)}}(),columns:[].concat(Fe,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(h,x){return[Object(e.jsx)(le.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?exam_id=").concat(x.id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(at.a,{})})})},"edit"),Object(e.jsx)(le.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?results=").concat(x.id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(U.a,{icon:Object(e.jsx)(y,{})})})},"results"),Object(e.jsx)(he.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(v.a)(Object(_.a)().mark(function f(){var g;return Object(_.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,L(x.id);case 2:g=C.sent,g.success&&r.current&&r.current.reload();case 4:case"end":return C.stop()}},f)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(K.a,{}),danger:!0})})},"delete")]}}])})},mt=n("o0Ox"),_t=n("miYZ"),jt=n("tsqr"),Tt=n("4KAj");function Ct(d,u){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(c.a)({method:"POST",headers:{"Content-Type":"application/json"},data:u},t||{})));case 1:case"end":return a.stop()}},d)})),Mt.apply(this,arguments)}var Qt=function(u){var t=u.student_id,r=Object(l.useState)(!1),a=Object(V.a)(r,2),i=a[0],j=a[1],O=Object(l.useCallback)(Object(v.a)(Object(_.a)().mark(function m(){var E;return Object(_.a)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return j(!0),h.next=3,Ct({user_id:t});case 3:if(E=h.sent,E.success){h.next=8;break}return jt.b.error(E.message),j(!1),h.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),j(!1);case 10:case"end":return h.stop()}},m)})),[]);return Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(U.a,{loading:i,type:"primary",icon:Object(e.jsx)(Tt.a,{}),onClick:O})})},Xt=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],kt=function(u){return u.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},qt=function(u){return u.reduce(function(t,r){var a,i=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(j,O){return O.academic_teacher_id!==null?j:[].concat(Object(ue.a)(j),[{group_id:r.id,group_name:r.name,user_id:O.id,first_name:O.first_name,last_name:O.last_name,email:O.email}])},[]);return[].concat(Object(ue.a)(t),Object(ue.a)(i))},[])},ea=function(){var u=Object(Q.b)(),t=u.teacherSubjectData,r=Object(l.useMemo)(function(){var a;return kt((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return Object(e.jsx)(z.a,{rowKey:function(i){return"".concat(i.group_id,"-").concat(i.user_id)},search:{layout:"vertical"},request:function(){var a=Object(v.a)(Object(_.a)().mark(function i(j){var O,m,E,p,h,x,f,g,T;return Object(_.a)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return O=j.groups,m=j.first_name,E=m===void 0?"":m,p=j.last_name,h=p===void 0?"":p,x=j.email,f=x===void 0?"":x,R.next=3,Object(mt.a)({parent_id:t==null?void 0:t.group_id,"id[]":O});case 3:if(g=R.sent,g.success){R.next=6;break}return R.abrupt("return",{data:[],total:0,success:!1});case 6:return T=qt(g.data).filter(function(H){return H.first_name.toLowerCase().includes(E.toLowerCase())&&H.last_name.toLowerCase().includes(h.toLowerCase())&&H.email.toLowerCase().includes(f.toLowerCase())}),R.abrupt("return",{data:T,total:T.length,success:!0});case 8:case"end":return R.stop()}},i)}));return function(i){return a.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(Xt,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(i,j){return[Object(e.jsx)(Qt,{student_id:j.user_id},"teamsChat")]}}])})},Ja=n("/zsF"),Pt=n("PArb"),Dt=n("jrin");function It(d,u){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},d)})),Rt.apply(this,arguments)}function Vt(d,u,t,r){return At.apply(this,arguments)}function At(){return At=Object(v.a)(Object(_.a)().mark(function d(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(u,"/attendances"),Object(c.a)({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return j.stop()}},d)})),At.apply(this,arguments)}var za=n("sRBo"),Ht=n("kaz8"),ta=function(u){var t=u.currentData,r=u.recordData,a=u.groupId,i=u.onSuccess,j=Object(l.useState)(!1),O=Object(V.a)(j,2),m=O[0],E=O[1],p=function(){E(!0),Vt(t.id,r.id,(r==null?void 0:r[String(t.date_from)])===M.a.PRESENT?M.a.ABSENT:M.a.PRESENT).then(function(x){x.success&&It(Number(a)).then(function(f){f.success&&(i(f.data),E(!1))})})};return m?Object(e.jsx)(A.a,{size:"small"}):Object(e.jsx)(Ht.a,{checked:(r==null?void 0:r[String(t.date_from)])===M.a.PRESENT,onChange:function(){return p()}})},aa=ta,na=function(){var u,t,r,a=Object(Q.b)(),i=a.teacherSubjectData,j=Object(s.l)(),O=Object(l.useState)(!1),m=Object(V.a)(O,2),E=m[0],p=m[1],h=Object(l.useState)(),x=Object(V.a)(h,2),f=x[0],g=x[1],T=Object(l.useState)(),C=Object(V.a)(T,2),R=C[0],H=C[1],D=Object(l.useState)({full_name:""}),je=Object(V.a)(D,2),X=je[0],be=je[1],we=Object(l.useState)((u=i==null||(t=i.groups)===null||t===void 0||(r=t[0])===null||r===void 0?void 0:r.id)!==null&&u!==void 0?u:null),Ie=Object(V.a)(we,2),ie=Ie[0],ge=Ie[1],q=Object(l.useMemo)(function(){var G;return((G=R==null?void 0:R.users)!==null&&G!==void 0?G:[]).reduce(function(N,Z){var Oe=Z.id,se=Z.first_name,Xe=Z.last_name,He=Z.academic_teacher_id,We={id:Oe,full_name:"".concat(Xe," ").concat(se," "),academic_teacher_id:He};if(!We.full_name.toLowerCase().includes(X.full_name.toLowerCase())||He!==null)return N;var ke=(f!=null?f:[]).reduce(function(Je,ot){var vt=ot.attendances.find(function(Ha){return Ha.user_id===Oe});return Object(c.a)(Object(c.a)({},Je),{},Object(Dt.a)({},String(ot.date_from),vt==null?void 0:vt.value))},{}),bt=Object(c.a)(Object(c.a)({},We),ke),_e=[].concat(Object(ue.a)(N),[bt]);return _e.sort(function(Je,ot){return Je.full_name.localeCompare(ot.full_name)})},[])},[R,f,X==null?void 0:X.full_name]),ae=Object(l.useMemo)(function(){var G=(f!=null?f:[]).reduce(function(N,Z){return[].concat(Object(ue.a)(N),[{title:String(Object(Ye.a)(new Date(Z.date_from),I.c)),dataIndex:String(Z.date_from),hideInSearch:!0,width:100,align:"center",render:function(se,Xe){return Object(e.jsx)(aa,{currentData:Z,recordData:Xe,onSuccess:function(We){return g(We)},groupId:ie})}}])},[]);return p(!1),[{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ue.a)(G))},[f]),ve=Object(l.useCallback)(function(G){var N,Z;if(G===null)return"";var Oe=i==null||(N=i.groups)===null||N===void 0?void 0:N.find(function(se){return se.id===G});return(Z=Oe==null?void 0:Oe.name)!==null&&Z!==void 0?Z:""},[i==null?void 0:i.groups]),Ee=Object(l.useCallback)(function(){return be({full_name:""})},[]),ye=Object(l.useCallback)(function(G){var N=G.full_name,Z=N===void 0?"":N;return be({full_name:Z})},[]),dt=Object(l.useMemo)(function(){var G;return((G=i==null?void 0:i.groups)!==null&&G!==void 0?G:[]).map(function(N){var Z=N.id,Oe=N.name;return{value:Z,label:Oe}})},[i==null?void 0:i.groups]),fe=Object(l.useCallback)(function(G){Ee(),p(!0),ge(G)},[]);return Object(l.useEffect)(function(){ie!==null&&(It(ie).then(function(G){G.success&&g(G.data)}),Object(mt.b)(ie).then(function(G){G.success&&H(G.data)}))},[ie]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(P.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(ft.a,{onChange:fe,value:ie,options:dt})}),Object(e.jsx)(Pt.a,{}),ae.length===1?Object(e.jsx)(s.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."}):Object(e.jsx)(z.a,{className:"attendances-table",headerTitle:"".concat(j.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(ve(ie),")"),rowKey:"id",onSubmit:ye,onReset:Ee,search:{layout:"vertical"},loading:E,dataSource:q,scroll:{x:1500},columns:ae})]})},ra=n("Hn4i"),sa=n("bRQS");function Jt(d,u,t){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(v.a)(Object(_.a)().mark(function d(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(u,"/tutors/").concat(t,"/grades"),Object(c.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return i.stop()}},d)})),Lt.apply(this,arguments)}function ua(d,u,t,r){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(v.a)(Object(_.a)().mark(function d(u,t,r,a){return Object(_.a)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(u,"/tutors/").concat(t,"/grades"),Object(c.a)({method:"POST",data:r},a||{})));case 1:case"end":return j.stop()}},d)})),Gt.apply(this,arguments)}function ia(d,u){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(c.a)({method:"GET",params:{"groups[]":u},useCache:!1},t||{})));case 1:case"end":return a.stop()}},d)})),Ft.apply(this,arguments)}function ca(d,u,t){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(v.a)(Object(_.a)().mark(function d(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(u,"/users/").concat(t),Object(c.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return i.stop()}},d)})),Ut.apply(this,arguments)}function la(d){return $t.apply(this,arguments)}function $t(){return $t=Object(v.a)(Object(_.a)().mark(function d(u){return Object(_.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(c.a)({method:"GET",useCache:!1},u||{})));case 1:case"end":return r.stop()}},d)})),$t.apply(this,arguments)}function da(d,u){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(u),Object(c.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},d)})),Bt.apply(this,arguments)}function oa(d,u){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(c.a)({method:"POST",data:u},t||{})));case 1:case"end":return a.stop()}},d)})),Kt.apply(this,arguments)}function ja(d,u,t){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(v.a)(Object(_.a)().mark(function d(u,t,r){return Object(_.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(u),Object(c.a)({method:"PATCH",data:t},r||{})));case 1:case"end":return i.stop()}},d)})),Nt.apply(this,arguments)}var ba=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],fa=function(){var u,t,r=Object(s.m)("@@initialState"),a=r.initialState,i=Object(Q.b)(),j=i.semester_subject_id,O=i.tutors,m=P.a.useForm(),E=Object(V.a)(m,1),p=E[0],h=Object(l.useState)([]),x=Object(V.a)(h,2),f=x[0],g=x[1],T=Object(l.useRef)(),C=Object(l.useState)(!1),R=Object(V.a)(C,2),H=R[0],D=R[1],je=Object(l.useState)(null),X=Object(V.a)(je,2),be=X[0],we=X[1],Ie=Object(l.useMemo)(function(){return!!O.data.find(function(q){var ae,ve=q.id;return ve===(a==null||(ae=a.currentUser)===null||ae===void 0?void 0:ae.id)})},[O.data,a==null||(u=a.currentUser)===null||u===void 0?void 0:u.id]),ie=Object(l.useMemo)(function(){return O.data.map(function(q){var ae=q.id,ve=q.first_name,Ee=q.last_name;return{label:"".concat(ve," ").concat(Ee),value:ae}})},[O.data]);Object(l.useEffect)(function(){var q,ae;if(!Ie||!(a!=null&&(q=a.currentUser)!==null&&q!==void 0&&q.id)){var ve;if((ve=O.data)!==null&&ve!==void 0&&ve[0]){var Ee;we((Ee=O.data)===null||Ee===void 0?void 0:Ee[0].id)}return}we(a==null||(ae=a.currentUser)===null||ae===void 0?void 0:ae.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,Ie]),Object(l.useEffect)(function(){j===null||be===null||(D(!0),Jt(j,be).then(function(q){if(q.success){var ae,ve=((ae=q.data.grade_scale)!==null&&ae!==void 0?ae:[]).map(function(Ee,ye){return Object(c.a)(Object(c.a)({},Ee),{},{id:String((ye+1)*100)})});p.setFieldValue("table",ve)}}).finally(function(){D(!1)}))},[j,be]);var ge=Object(l.useCallback)(function(){var q=Object(v.a)(Object(_.a)().mark(function ae(ve){return Object(_.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(!(j===null||be===null)){ye.next=2;break}return ye.abrupt("return");case 2:return ye.next=4,ua(j,be,{grade_scale:ve.table});case 4:case"end":return ye.stop()}},ae)}));return function(ae){return q.apply(this,arguments)}}(),[be,j]);return O.loading?Object(e.jsx)(A.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(P.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(ft.a,{disabled:Ie,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:ie,value:be,onChange:function(ae){return we(ae)}})}),Object(e.jsx)(Pt.a,{}),Object(e.jsx)(P.a,{form:p,onFinish:ge,submitter:{render:function(ae,ve){var Ee=Object(V.a)(ve,2),ye=Ee[1];return[ye]}},children:Object(e.jsx)(ra.a,{name:"table",rowKey:"id",actionRef:T,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,loading:H,columns:[].concat(ba,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(ae,ve){return Object(e.jsx)(U.a,{type:"primary",onClick:function(){var ye;return(ye=T.current)===null||ye===void 0?void 0:ye.startEditable(ve.id)},icon:Object(e.jsx)(at.a,{})})}}]),editable:{form:p,type:"multiple",editableKeys:f,saveText:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(sa.a,{})}),onChange:g,actionRender:function(ae,ve,Ee){return[Ee.save]}}})})]})},Ya=n("qbNl"),ma=n("JBPa"),Za=n("tU7J"),rt=n("wFql"),Qa=n("Awhp"),va=n("KrTs"),Oa=n("wd/R"),st=n.n(Oa);function ha(d,u){return wt.apply(this,arguments)}function wt(){return wt=Object(v.a)(Object(_.a)().mark(function d(u,t){return Object(_.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules",Object(c.a)({params:u,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},d)})),wt.apply(this,arguments)}var Xa=n("5R/X"),pa=function(){var u=Object(l.useState)(null),t=Object(V.a)(u,2),r=t[0],a=t[1],i=Object(l.useState)([]),j=Object(V.a)(i,2),O=j[0],m=j[1],E=Object(Q.b)(),p=E.semester_subject_id,h=st()(),x=Object(l.useMemo)(function(){return O.map(function(D){return{id:D.id,title:"".concat(D.group.name," (").concat(D.term_status.name,")"),start:st()(D.date_from).toDate(),end:st()(D.date_to).toDate(),tutor_name:"".concat(D.tutor.first_name," ").concat(D.tutor.last_name),tutor_email:D.tutor.email,semester:D.semester.name,group:D.group.name,subject:D.subject.name,ms_teams_join_url:D.ms_teams_join_url}})},[O]),f=Object(l.useCallback)(function(D,je){ha({semester_subject_id:p,date_form:D.toDate(),date_to:je.toDate()}).then(function(X){X.success&&m(X.data)})},[p]),g=Object(l.useCallback)(function(D){a(D)},[]),T=Object(l.useCallback)(function(){a(null)},[]),C=Object(l.useCallback)(function(D){return D.isSame(h,"day")?"warning":D.isAfter(h,"day")?"success":"error"},[]),R=Object(l.useCallback)(function(D){var je=x.filter(function(X){return st()(X.start).isSame(D,"day")});return Object(e.jsx)("ul",{className:"events",children:je.map(function(X){return Object(e.jsx)("li",{onClick:function(){return g(X)},children:Object(e.jsx)(va.a,{status:C(st()(X.start)),text:X.title})},X.id)})})},[O]),H=Object(l.useCallback)(function(D,je){var X=st()(D).startOf(je).subtract(1,"month"),be=st()(D).endOf(je).add(1,"month");f(X,be)},[]);return Object(l.useEffect)(function(){var D=st()().startOf("month"),je=st()().endOf("month");f(D,je)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(rt.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(ma.a,{dateCellRender:R,onPanelChange:H}),Object(e.jsxs)(J.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:T,footer:null,children:[Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&st()(r.start).format(I.b)]}),Object(e.jsxs)(rt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&st()(r.end).format(I.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(rt.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(U.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},zt=n("yj/a"),Yt=n("5Syx"),xt=n("PpiC"),Wt=n("H6aw"),ga=n("p3I6"),_a=["attendances"],xa=["results"];function Sa(d,u){var t=Object(l.useState)({loading:!1}),r=Object(V.a)(t,2),a=r[0],i=r[1];return Object(l.useEffect)(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),ca(d,u).then(function(j){j.success&&i(function(O){return Object(c.a)(Object(c.a)({},O),{},{data:j.data})})}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})})},[u,d]),{finalGrades:a}}function Ea(){var d=Object(l.useState)({loading:!1}),u=Object(V.a)(d,2),t=u[0],r=u[1];return Object(l.useEffect)(function(){r(function(a){return Object(c.a)(Object(c.a)({},a),{},{loading:!0})}),la().then(function(a){a.success&&r(function(i){return Object(c.a)(Object(c.a)({},i),{},{data:a.data})})}).finally(function(){r(function(a){return Object(c.a)(Object(c.a)({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function ya(d){var u=Object(l.useState)({loading:!1}),t=Object(V.a)(u,2),r=t[0],a=t[1];return Object(l.useEffect)(function(){d!==void 0&&(a(function(i){return Object(c.a)(Object(c.a)({},i),{},{loading:!0})}),da(d).then(function(i){i.success&&a(function(j){return Object(c.a)(Object(c.a)({},j),{},{data:i.data})})}).finally(function(){a(function(i){return Object(c.a)(Object(c.a)({},i),{},{loading:!1})})}))},[d]),{subjectGradeScales:r}}function Ta(d,u){var t=Object(l.useState)({loading:!1}),r=Object(V.a)(t,2),a=r[0],i=r[1];return Object(l.useEffect)(function(){typeof d!="number"||typeof u!="number"||(i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),Jt(d,u).then(function(j){j.success&&i(function(O){return Object(c.a)(Object(c.a)({},O),{},{data:j.data.grade_scale.map(function(m,E){return Object(c.a)(Object(c.a)({},m),{},{id:E})})})})}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})}))},[d,u]),{tutorGradeScales:a}}function Ca(d,u){var t=Object(l.useState)({loading:!1}),r=Object(V.a)(t,2),a=r[0],i=r[1],j=Object(l.useCallback)(function(){i(function(m){return Object(c.a)(Object(c.a)({},m),{},{loading:!0})}),It(d).then(function(m){if(m.success){var E=m.data.reduce(function(p,h){var x=h.attendances,f=Object(xt.a)(h,_a),g=x.find(function(T){return T.user_id===u});return g?[].concat(Object(ue.a)(p),[Object(c.a)(Object(c.a)({},f),{},{attendance:g})]):p},[]);i(function(p){return Object(c.a)(Object(c.a)({},p),{},{data:E})})}}).finally(function(){i(function(m){return Object(c.a)(Object(c.a)({},m),{},{loading:!1})})})},[d,u]),O=Object(l.useCallback)(function(m,E){i(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!0})}),Vt(m,u,E).then(function(p){p.success?jt.b.success(p.message):jt.b.error(p.message)}).finally(function(){j(),i(function(p){return Object(c.a)(Object(c.a)({},p),{},{loading:!1})})})},[j,u]);return Object(l.useEffect)(function(){j()},[j]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:j,updateUserAttendanceSchedules:O}}function Ma(d,u){var t=Object(l.useState)({loading:!1}),r=Object(V.a)(t,2),a=r[0],i=r[1];return Object(l.useEffect)(function(){!u||(i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!0})}),b({student_id:d,semester_subject_id:u}).then(function(j){if(j.success){var O=j.data.reduce(function(m,E){var p=Object(V.a)(E.results,1),h=p[0],x=Object(xt.a)(E,xa);return h?[].concat(Object(ue.a)(m),[Object(c.a)(Object(c.a)({},x),{},{result:h})]):m},[]);i(function(m){return Object(c.a)(Object(c.a)({},m),{},{data:O})})}}).finally(function(){i(function(j){return Object(c.a)(Object(c.a)({},j),{},{loading:!1})})}))},[d,u]),{studentExams:a}}function Pa(d,u){var t=Object(l.useState)({loading:!1}),r=Object(V.a)(t,2),a=r[0],i=r[1],j=Object(l.useState)({loading:!1}),O=Object(V.a)(j,2),m=O[0],E=O[1],p=Object(l.useState)({loading:!1}),h=Object(V.a)(p,2),x=h[0],f=h[1];return Object(l.useEffect)(function(){i(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!0})}),Object(Wt.e)({group_id:d}).then(function(g){g.success&&i(function(T){return Object(c.a)(Object(c.a)({},T),{},{data:g.data})})}).finally(function(){i(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!1})})})},[d]),Object(l.useEffect)(function(){!a.data||(f(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!0})}),Promise.all(a.data.map(function(g){var T=g.id;return Object(Wt.m)(Number(T))})).then(function(g){g.forEach(function(T){T.success&&f(function(C){return Object(c.a)(Object(c.a)({},C),{},{data:Object(c.a)(Object(c.a)({},C.data),{},Object(Dt.a)({},Number(T.data.id),Object(ga.c)(T.data.lessons)))})})})}).finally(function(){f(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!1})})}),E(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!0})}),Promise.all(a.data.map(function(g){var T=g.id;return Object(Wt.l)(Number(T),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(C){if(C.success){var R,H,D=((R=C.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&R!==void 0?R:[]).filter(function(X){return X.id===u}),je=(H=C.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&H!==void 0?H:[];E(function(X){return Object(c.a)(Object(c.a)({},X),{},{data:Object(c.a)(Object(c.a)({},X.data),{},Object(Dt.a)({},Number(T),{finishedTopics:D,attendanceList:je}))})})}})})).finally(function(){return E(function(g){return Object(c.a)(Object(c.a)({},g),{},{loading:!1})})}))},[a.data,u]),{userCourses:a,userCoursesStats:m,userCoursesTopics:x}}var Da=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ia=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(u,t){return Object(Ye.a)(new Date(t.date_from),I.c)}}],Ra=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(u,t){return Object(Ye.a)(new Date(t.created_at),I.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(u,t){return"".concat(t.result.result,"%")}}],Aa=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(u,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?Object(Ye.a)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),I.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(u,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],St=6,La=function(u){var t,r,a=u.user_id,i=u.group_id,j=Object(Q.b)(),O=j.semester_subject_id,m=Ma(a,O),E=m.studentExams,p=Sa(i,a),h=p.finalGrades,x=Ea(),f=x.gradeTerms,g=ya((t=h.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),T=g.subjectGradeScales,C=Ta(O,(r=h.data)===null||r===void 0?void 0:r.tutor_id),R=C.tutorGradeScales,H=Ca(i,a),D=H.userAttendanceSchedules,je=H.updateUserAttendanceSchedules,X=Pa(i,a),be=X.userCourses,we=X.userCoursesStats,Ie=X.userCoursesTopics,ie=P.a.useForm(),ge=Object(V.a)(ie,1),q=ge[0],ae=Object(l.useMemo)(function(){var fe;return((fe=f.data)!==null&&fe!==void 0?fe:[]).map(function(G){var N=G.id,Z=G.name;return{label:Z,value:N}})},[f.data]),ve=Object(l.useMemo)(function(){var fe;return((fe=T.data)!==null&&fe!==void 0?fe:[]).map(function(G){var N=G.name,Z=G.id;return{label:N,value:Z}})},[T.data]),Ee=Object(l.useMemo)(function(){var fe,G,N,Z=((fe=E.data)!==null&&fe!==void 0?fe:[]).reduce(function(_e,Je){var ot=Je.result,vt=Je.weight;return[_e[0]+ot.result*vt,_e[1]+vt]},[0,0]),Oe=Object(V.a)(Z,2),se=Oe[0],Xe=Oe[1],He=Number.isNaN(se/Xe)?0:se/Xe,We=((G=R.data)!==null&&G!==void 0?G:[]).sort(function(_e,Je){return _e.grade_value-Je.grade_value}).reduce(function(_e,Je){return[].concat(Object(ue.a)(_e),[Object(c.a)(Object(c.a)({},Je),{},{isWeightedAverageGreater:He>=Je.grade_value})])},[]);if(We.every(function(_e){var Je=_e.isWeightedAverageGreater;return Je})){var ke;return(ke=We.at(-1))===null||ke===void 0?void 0:ke.name}var bt=We.findIndex(function(_e){var Je=_e.isWeightedAverageGreater;return!Je});return bt<0?"":(N=We[bt-1])===null||N===void 0?void 0:N.name},[E.data,R.data]),ye=Object(l.useCallback)(function(){var fe=Object(v.a)(Object(_.a)().mark(function G(N){var Z,Oe,se,Xe,He,We,ke;return Object(_.a)().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(se=N.grade_scale_id,Xe=N.grade_term_id,((Z=h.data)===null||Z===void 0?void 0:Z.id)!==void 0){_e.next=3;break}return _e.abrupt("return");case 3:if(He=(Oe=h.data)===null||Oe===void 0?void 0:Oe.grades.find(function(Je){var ot=Je.grade_term;return ot.id===Xe}),!He){_e.next=11;break}return _e.next=7,ja(He.id,{grade_scale_id:se});case 7:return We=_e.sent,jt.b[We.success?"success":"error"](We.message),We.success&&s.f.push("/teacher/subjects/".concat(O,"/final-grades")),_e.abrupt("return");case 11:return _e.next=13,oa({grade_scale_id:se,grade_term_id:Xe,lesson_group_user_id:h.data.id});case 13:ke=_e.sent,jt.b[ke.success?"success":"error"](ke.message),ke.success&&s.f.push("/teacher/subjects/".concat(O,"/final-grades"));case 16:case"end":return _e.stop()}},G)}));return function(G){return fe.apply(this,arguments)}}(),[h.data,O]),dt=Object(l.useMemo)(function(){var fe;return((fe=f.data)!==null&&fe!==void 0?fe:[]).map(function(G){var N;return Object(c.a)(Object(c.a)({},G),{},{grade:(N=h.data)===null||N===void 0?void 0:N.grades.find(function(Z){var Oe=Z.grade_term;return Oe.id===G.id})})})},[h.data,f.data]);return h.loading?Object(e.jsx)(A.a,{}):Object(e.jsxs)(e.Fragment,{children:[h.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(rt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:h.data.user})}),Object(e.jsx)(Pt.a,{})]}),Object(e.jsxs)(oe.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(z.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:St},dataSource:E.data,loading:E.loading,columns:Ra,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(z.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:St},dataSource:dt,loading:h.loading||f.loading,columns:Aa,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(z.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:St},cardProps:{bodyStyle:{padding:0}},dataSource:D.data,loading:D.loading,columns:[].concat(Ia,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(G,N){return Object(e.jsx)(Ht.a,{onChange:function(Oe){return je(N.id,Oe.target.checked?M.a.PRESENT:M.a.ABSENT)},checked:N.attendance.value===M.a.PRESENT})}}])})}),Object(e.jsx)($e.a,{span:12,children:Object(e.jsx)(z.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:St},cardProps:{bodyStyle:{padding:0}},dataSource:R.data,loading:R.loading,columns:Da})}),be.loading&&!be.data||we.loading&&!we.data||Ie.loading&&!Ie.data&&Object(e.jsx)(A.a,{}),be.data&&we.data&&Ie.data&&be.data.map(function(fe){var G,N,Z,Oe,se,Xe,He,We,ke=fe.id,bt=fe.title;return Object(e.jsxs)($e.a,{span:24,children:[Object(e.jsx)(rt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:bt}),Object(e.jsx)(Yt.c,{topics:(G=(N=Ie.data)===null||N===void 0?void 0:N[Number(ke)])!==null&&G!==void 0?G:[],stats:(Z=(Oe=we.data)===null||Oe===void 0||(se=Oe[Number(ke)])===null||se===void 0?void 0:se.finishedTopics)!==null&&Z!==void 0?Z:[]}),Object(e.jsx)(Yt.a,{stats:(Xe=(He=we.data)===null||He===void 0||(We=He[Number(ke)])===null||We===void 0?void 0:We.attendanceList)!==null&&Xe!==void 0?Xe:[]})]},ke)})]}),Object(e.jsx)(P.a,{form:q,onFinish:ye,children:Object(e.jsxs)(P.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(zt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ae,width:"sm",fieldProps:{loading:f.loading}}),Object(e.jsx)(zt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ve,fieldProps:{loading:h.loading||T.loading}}),Object(e.jsx)(P.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Ee}})})]})})]})},Ga=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(u,t){return t.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(u,t){return t.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(u,t){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,i=r.grade_term,j=r.id;return Object(e.jsxs)(rt.a.Text,{children:[i.name,": ",a]},j)}):"-"})}}],Fa=function(){var u,t,r=Object(Ke.k)(),a=Object(l.useMemo)(function(){var h,x,f,g;return{user_id:Number.isNaN(Number((h=r.query)===null||h===void 0?void 0:h.user_id))?null:Number((x=r.query)===null||x===void 0?void 0:x.user_id),group_id:Number.isNaN(Number((f=r.query)===null||f===void 0?void 0:f.group_id))?null:Number((g=r.query)===null||g===void 0?void 0:g.group_id)}},[(u=r.query)===null||u===void 0?void 0:u.user_id,(t=r.query)===null||t===void 0?void 0:t.group_id]),i=a.user_id,j=a.group_id,O=Object(Q.b)(),m=O.teacherSubjectData,E=O.semester_subject_id,p=Object(l.useMemo)(function(){var h;return((h=m==null?void 0:m.groups)!==null&&h!==void 0?h:[]).map(function(x){var f=x.id,g=x.name;return{label:g,value:f}})},[m==null?void 0:m.groups]);return i!==null&&j!==null?Object(e.jsx)(La,{user_id:i,group_id:j}):Object(e.jsx)(z.a,{rowKey:"id",search:{layout:"vertical"},request:function(){var h=Object(v.a)(Object(_.a)().mark(function x(f){var g,T,C,R,H,D,je,X,be,we;return Object(_.a)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return T=f.group_id,C=T===void 0?[]:T,R=f.first_name,H=R===void 0?"":R,D=f.last_name,je=D===void 0?"":D,X=((g=m==null?void 0:m.groups)!==null&&g!==void 0?g:[]).map(function(ge){var q=ge.id;return q}),ie.next=4,ia(C.length===0?X:C);case 4:if(be=ie.sent,be.success){ie.next=7;break}return ie.abrupt("return",{success:!1,total:0,data:[]});case 7:return we=be.data.filter(function(ge){var q=ge.user;return q.first_name.toLowerCase().includes(H.toLowerCase())&&q.last_name.toLowerCase().includes(je.toLowerCase())}),ie.abrupt("return",{success:!0,total:we.length,data:we});case 9:case"end":return ie.stop()}},x)}));return function(x){return h.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(x,f){return Object(e.jsx)(Qe.a,{type:"Students",type_id:f.group_id},f.group_id)}}].concat(Ga,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(x,f){return[Object(e.jsx)(le.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(f.user.id,"&group_id=").concat(f.group_id),children:Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(U.a,{type:"primary",icon:Object(e.jsx)(at.a,{})})})},"edit")]}}])})},Ua=n("dF/Y"),$a=n("o+0V"),Zt=n("0WSk"),Ba=["type","defaultRender"],Ka=["type","defaultRender"],Na=function(u){var t=u.url;return Object(e.jsx)(ze.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(U.a,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Ua.a,{})})})},wa=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(u,t){return Object(Ye.a)(new Date(t.created_at),I.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(u,t,r){var a=t.type,i=t.defaultRender,j=Object(xt.a)(t,Ba);if(a==="form")return null;var O=r.getFieldValue("state");return Object(e.jsx)(Zt.a,Object(c.a)(Object(c.a)({},j),{},{state:{type:O}}))},render:function(u,t){return Object(e.jsx)(Qe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id},t.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(u,t){return Object(Ye.a)(new Date(t.exported_at),I.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(u,t,r){var a=t.type,i=t.defaultRender,j=Object(xt.a)(t,Ka);if(a==="form")return null;var O=r.getFieldValue("state");return Object(e.jsx)(Zt.a,Object(c.a)(Object(c.a)({},j),{},{state:{type:O}}))},render:function(u,t){return Object(e.jsx)(Qe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id},t.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(u,t){return[Object(e.jsx)(Na,{url:t.url},"download")]}}],Wa=function(){var u,t,r=Object(Q.b)(),a=r.teacherSubjectData,i=Object(l.useMemo)(function(){var O;return((O=a==null?void 0:a.groups)!==null&&O!==void 0?O:[]).map(function(m){var E=m.id,p=m.name;return{value:E,label:p}})},[a==null?void 0:a.groups]),j=Object(l.useMemo)(function(){var O,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:i,defaultValue:a==null||(O=a.groups)===null||O===void 0||(m=O[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(wa)},[a==null||(u=a.groups)===null||u===void 0||(t=u[0])===null||t===void 0?void 0:t.id,i]);return Object(e.jsx)(z.a,{request:function(){var O=Object(v.a)(Object(_.a)().mark(function m(E){var p,h,x,f,g,T,C;return Object(_.a)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return x=E.group_id,f=x===void 0?a==null||(p=a.groups)===null||p===void 0||(h=p[0])===null||h===void 0?void 0:h.id:x,g=E.created_by,T=E.exported_by,H.next=3,Object($a.a)({group_id:f,created_by:g,exported_by:T});case 3:if(C=H.sent,C.success){H.next=6;break}return H.abrupt("return",{success:!1,data:[],total:0});case 6:return H.abrupt("return",{success:!0,data:C.data,total:C.data.length});case 7:case"end":return H.stop()}},m)}));return function(m){return O.apply(this,arguments)}}(),columns:j,search:{layout:"vertical"},scroll:{x:1500}})},Va=function(u){var t,r,a=u.tab,i=Object(s.l)(),j=Object(s.m)("@@initialState"),O=j.setInitialState,m=j.initialState,E=Object(Q.b)(),p=E.teacherSubjectData,h=E.semester_subject_id,x=E.tutors,f=Object(l.useCallback)(Object(xe.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),g=Object(l.useMemo)(function(){return!!x.data.find(function(T){var C,R=T.id;return R===(m==null||(C=m.currentUser)===null||C===void 0?void 0:C.id)})||f(Te.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(ee.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(t=p.subject)===null||t===void 0?void 0:t.name}),", ",Object(e.jsx)(s.a,{id:a})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(le.a,{to:"/teacher/subjects/".concat(h,"/exams?exam_id=new"),children:Object(e.jsx)(U.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:i.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:i.formatMessage({id:"Subjects"})},{path:String(h),breadcrumbName:String((r=p.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:i.formatMessage({id:a,defaultMessage:String(a)})}]}},children:Object(e.jsxs)(o.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(C){O(Object(c.a)({},m)),s.f.push("/teacher/subjects/".concat(h,"/").concat(C))}},children:[Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(Re.a,{})},"groups"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(ea,{})},"students"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(nt,{})},"exams"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(pa,{})},"schedule"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(na,{})},"attendance"),g&&Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(fa,{})},"grades-scale"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Fa,{})},"final-grades"),Object(e.jsx)(o.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(Wa,{})},"file-exports-history")]})}):Object(e.jsx)(A.a,{})},ka=ce.default=function(){var d=Object(Ke.l)(),u=d.subjectId,t=d.tab,r=t===void 0?"groups":t;return Object(e.jsx)(Q.a,{semester_subject_id:Number(u),children:Object(e.jsx)(Va,{tab:r})})}},p3I6:function(Be,ce,n){"use strict";n.d(ce,"b",function(){return Q}),n.d(ce,"c",function(){return he}),n.d(ce,"a",function(){return it});var c=n("miYZ"),W=n("tsqr"),U=n("tJVT"),S=n("k1fw"),A=n("oBTY"),l=n("q1tI"),s=n.n(l),le=n("9kvl"),Ke=n("Ty5D"),o=n("H6aw"),ee=n("/y+f"),Te=n("nKUr"),xe=n.n(Te),Q=s.a.createContext({}),Re=function(){return Math.round(Math.random()*99999)},ut=function me(ne){return ne.reduce(function($,y){return[].concat(Object(A.a)($),Object(A.a)(y.lessons?me(y.lessons):[]),[y])},[])},he=function me(ne){return ne.reduce(function($,y){var K;return[].concat(Object(A.a)($),Object(A.a)(y.lessons?me(y.lessons):[]),Object(A.a)((K=y.topics)!==null&&K!==void 0?K:[]))},[])},tt=function me(ne,$,y){return ne.map(function(K){var z,I;return Object(S.a)(Object(S.a)({},K),{},{lessons:K.lessons?me(K.lessons,$,y):[],topics:K.id===$?[].concat(Object(A.a)((z=K.topics)!==null&&z!==void 0?z:[]),[y]):(I=K.topics)!==null&&I!==void 0?I:[]})})},ze=function me(ne,$,y){return y?ne.map(function(K){return Object(S.a)(Object(S.a)({},K),{},{lessons:[].concat(Object(A.a)(K.lessons?me(K.lessons,$,y):[]),Object(A.a)(K.id===y?[$]:[]))})}):[].concat(Object(A.a)(ne),[$])},_=function me(ne,$,y){return ne.map(function(K){return Object(S.a)(Object(S.a)({},K.id===$?y:K),{},{lessons:K.lessons?me(K.lessons,$,y):[]})})},v=function me(ne,$){return ne.map(function(y){return Object(S.a)(Object(S.a)({},y),{},{parent_id:$,lessons:y.lessons?me(y.lessons,y.id):[]})})},Ye=function me(ne,$){return ne.filter(function(y){return y.id!==$}).map(function(y){return Object(S.a)(Object(S.a)({},y),{},{lessons:y.lessons?me(y.lessons,$):[]})})},at=function me(ne,$){return ne.map(function(y){return Object(S.a)(Object(S.a)({},y),{},{lessons:y.lessons?me(y.lessons,$):[],topics:y.topics?y.topics.filter(function(K){return K.id!==$}):[]})})},Ve=function me(ne,$,y,K){return K==null?void 0:K.map(function(z){if(z.id===y){var I;return Object(S.a)(Object(S.a)({},z),{},{topics:(I=z.topics)===null||I===void 0?void 0:I.map(function(b){return b.id===ne?$.file.response.data:b})})}else if(z.lessons)return Object(S.a)(Object(S.a)({},z),{},{lessons:me(ne,$,y,z.lessons||[])});return z})},it=function(ne){var $=ne.children,y=ne.id,K=Object(l.useState)(),z=Object(U.a)(K,2),I=z[0],b=z[1],Ce=Object(le.l)(),Ue=Object(l.useMemo)(function(){return I&&I.lessons?he(I.lessons):[]},[I]),Me=Object(l.useMemo)(function(){return I&&I.lessons?ut(I.lessons):[]},[I]),Ae=Object(l.useState)([]),Se=Object(U.a)(Ae,2),Le=Se[0],Ne=Se[1],L=Object(Ke.k)();Object(l.useEffect)(function(){Ne([])},[]);var B=Object(l.useCallback)(function(){Object(o.m)(y).then(function(P){return P.success&&b(Object(S.a)(Object(S.a)({},P.data),{},{lessons:v(P.data.lessons)}))})},[y]);Object(l.useEffect)(function(){B()},[B]);var pe=Object(l.useCallback)(function(P){var F=Me.find(function(w){var M;return w==null||(M=w.topics)===null||M===void 0?void 0:M.find(function(Y){return Y.id===P})});return F?F.id:null},[Me]),qe=Object(l.useMemo)(function(){var P,F;return(P=L.query)!==null&&P!==void 0&&P.lesson?{mode:"lesson",id:Number(L.query.lesson),value:Me.find(function(w){return w.id===Number(L.query.lesson)})}:(F=L.query)!==null&&F!==void 0&&F.topic?{mode:"topic",id:Number(L.query.topic),value:Ue.find(function(w){return w.id===Number(L.query.topic)})}:{mode:"init"}},[L.query,I,Me,Ue]),ct=Object(l.useCallback)(function(P){var F={course_id:y,topics:[],isNew:!0,id:I?I.lessons.length+1:Re(),order:0,title:Ce.formatMessage({id:"add_title_here"}),active:!0,parent_id:P};return b(function(w){var M;return Object(S.a)(Object(S.a)({},w),{},{lessons:ze((M=w==null?void 0:w.lessons)!==null&&M!==void 0?M:[],F,P)})}),F},[y,I]),Ze=Object(l.useCallback)(function(P,F){var w=Me.find(function(Y){return Y.id===P}),M=w&&w.isNew;return(M?Object(o.g)(F):Object(o.u)(P,F)).then(function(Y){return W.b.success(Y.message),B(),Y.success&&b(function(J){var ue;return Object(S.a)(Object(S.a)({},J),{},{lessons:_((ue=J==null?void 0:J.lessons)!==null&&ue!==void 0?ue:[],P,Object(S.a)(Object(S.a)({},Y.data),{},{isNew:!1}))})})})},[I]),Qe=Object(l.useCallback)(function(P){var F=Me.find(function(M){return M.id===P});if(!!F){var w=F.isNew;w?b(function(M){var Y;return Object(S.a)(Object(S.a)({},M),{},{lessons:Ye((Y=M==null?void 0:M.lessons)!==null&&Y!==void 0?Y:[],P)})}):Object(o.o)(P).then(function(M){M.success&&(W.b.success(M.message),b(function(Y){var J;return Object(S.a)(Object(S.a)({},Y),{},{lessons:Ye((J=Y==null?void 0:Y.lessons)!==null&&J!==void 0?J:[],P)})}))})}},[I]),lt=Object(l.useCallback)(function(P,F){var w,M=pe(P),Y=Me.find(function(et){return et.id===M}),J=Y&&((w=Y.topics)===null||w===void 0?void 0:w.find(function(et){return et.id===P})),ue=J==null?void 0:J.isNew;return(ue?Object(o.h)(F):Object(o.v)(P,F)).then(function(et){et.success&&(W.b.success(et.message),B(),le.f.push("/courses/list/".concat(y,"/program/?topic=").concat(et.data.id)),(J==null?void 0:J.topicable_type)===ee.f.Video&&setTimeout(function(){B()},5e3))})},[pe,I,B]),Pe=Object(l.useCallback)(function(P){var F=pe(P),w=Me.find(function(J){return J.id===F});if(!!w){var M=Ue==null?void 0:Ue.find(function(J){return J.id===P}),Y=M==null?void 0:M.isNew;Y&&!M.topicable?b(function(J){var ue;return Object(S.a)(Object(S.a)({},J),{},{lessons:at((ue=J==null?void 0:J.lessons)!==null&&ue!==void 0?ue:[],P)})}):Object(o.p)(P).then(function(J){J.success&&(W.b.success(J.message),b(function(ue){var et;return Object(S.a)(Object(S.a)({},ue),{},{lessons:at((et=ue==null?void 0:ue.lessons)!==null&&et!==void 0?et:[],P)})}))})}},[I,pe]),V=Object(l.useCallback)(function(P,F){var w={lesson_id:P,isNew:!0,id:Re(),title:Ce.formatMessage({id:"add_title_here"}),active:!0,topicable_type:F};return b(function(M){var Y;return Object(S.a)(Object(S.a)({},M),{},{lessons:tt((Y=M==null?void 0:M.lessons)!==null&&Y!==void 0?Y:[],P,w)})}),w},[]),Ot=function(F,w){var M=pe(F);b(function(Y){return Object(S.a)(Object(S.a)({},Y),{},{lessons:Y?Ve(F,w,M,Y.lessons||[]):[]})}),le.f.push("/courses/list/".concat(y,"/program/?topic=").concat(w.file.response.data.id))},oe=Object(l.useCallback)(function(P){return Object(o.d)(P).then(function(F){if(F.success){W.b.success(F.message);var w=pe(P);b(function(M){var Y;return Object(S.a)(Object(S.a)({},M),{},{lessons:M?(Y=M.lessons)===null||Y===void 0?void 0:Y.map(function(J){if(J.id===w){var ue=J.topics||[];return Object(S.a)(Object(S.a)({},J),{},{topics:[].concat(Object(A.a)(ue),[F.data])})}return J}):[]})})}})},[I,pe]),pt=Object(l.useCallback)(function(P){return Object(o.c)(P).then(function(F){F.success&&(W.b.success(F.message),b(function(w){return Object(S.a)(Object(S.a)({},w),{},{lessons:w?[].concat(Object(A.a)(w.lessons),[F.data]):[]})}))})},[]),$e={state:I,h5ps:Le,id:y,addNewLesson:ct,updateLesson:Ze,updateTopic:lt,deleteLesson:Qe,addNewTopic:V,deleteTopic:Pe,onTopicUploaded:Ot,cloneTopic:oe,cloneLesson:pt,currentEditMode:qe,getLessons:B};return Object(Te.jsx)(Q.Provider,{value:$e,children:$})}},quyA:function(Be,ce){var n="\\ud800-\\udfff",c="\\u0300-\\u036f",W="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",S=c+W+U,A="\\ufe0e\\ufe0f",l="\\u200d",s=RegExp("["+l+n+S+A+"]");function le(Ke){return s.test(Ke)}Be.exports=le},wy8a:function(Be,ce,n){var c=n("KxBF");function W(U,S,A){var l=U.length;return A=A===void 0?l:A,!S&&A>=l?U:c(U,S,A)}Be.exports=W}}]);
