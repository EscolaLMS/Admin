"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7480,2803,8047],{78677:function(ye,te,t){var ae=t(67294),G=t(2759),k=function(){return k=Object.assign||function(X){for(var l,w=1,T=arguments.length;w<T;w++){l=arguments[w];for(var Y in l)Object.prototype.hasOwnProperty.call(l,Y)&&(X[Y]=l[Y])}return X},k.apply(this,arguments)},J=(0,ae.forwardRef)(function(X,l){return ae.createElement(G.P,k({},X,{chartType:"Column",ref:l}))});te.Z=J},58664:function(ye,te,t){t.d(te,{T:function(){return R}});var ae=t(19632),G=t.n(ae),k=t(5574),J=t.n(k),X=t(74656),l=t(74330),w=t(67294),T=t(51490),Y=t(99100),K=t(32283),be=t(80854),O=t(85893),fe=function(V){return V.map(function(_){return"name"in _?{id:Number(_.id),name:_.name}:{id:Number(_.id),name:_.title?_.title:""}})},R=function(V){var _=V.value,re=V.onChange,ie=V.multiple,ve=ie===void 0?!1:ie,xe=V.defaultValue,oe=V.modelType,z=oe===void 0?"COURSE":oe,W=(0,w.useState)([]),ue=J()(W,2),ee=ue[0],m=ue[1],a=(0,w.useState)(!1),he=J()(a,2),Ce=he[0],le=he[1],b=(0,w.useRef)(),ge=(0,w.useCallback)(function(j){var A,$,Q,H;switch(z){case"COURSE":return(0,Y.N7)(j,{signal:b==null||(A=b.current)===null||A===void 0?void 0:A.signal});case"WEBINAR":return(0,K.i5)(j,{signal:b==null||($=b.current)===null||$===void 0?void 0:$.signal});case"CONSULTATIONS":return(0,T.sL)(j,{signal:b==null||(Q=b.current)===null||Q===void 0?void 0:Q.signal});default:return(0,Y.N7)(j,{signal:b==null||(H=b.current)===null||H===void 0?void 0:H.signal})}},[z,b]),pe=(0,w.useCallback)(function(j){var A,$,Q,H;switch(z){case"COURSE":return(0,Y.XR)(Number(j),{signal:(A=b.current)===null||A===void 0?void 0:A.signal});case"WEBINAR":return(0,K.tz)(Number(j),{signal:($=b.current)===null||$===void 0?void 0:$.signal});case"CONSULTATIONS":return(0,T.hW)(Number(j),{signal:(Q=b.current)===null||Q===void 0?void 0:Q.signal});default:return(0,Y.XR)(Number(j),{signal:(H=b.current)===null||H===void 0?void 0:H.signal})}},[z,b]),se=(0,w.useCallback)(function(j){le(!0),b.current&&b.current.abort(),b.current=new AbortController,ge(j?{title:j}:{}).then(function(A){A.success&&m(fe(A.data)),le(!1)}).catch(function(){return le(!1)})},[z]),e=(0,w.useCallback)(function(j){se(j)},[se]);return(0,w.useEffect)(function(){return b.current=new AbortController,_&&pe(Number(_)).then(function(j){j&&j.success&&m(function(A){return[].concat(G()(A),G()(fe([j.data])))})}),function(){b.current&&b.current.abort()}},[_,z]),(0,O.jsx)(X.default,{defaultValue:xe,onFocus:function(){return se()},allowClear:!0,style:{width:"100%"},value:_,onChange:re,mode:ve?"multiple":void 0,showSearch:!0,onSearch:e,placeholder:(0,O.jsx)(be.FormattedMessage,{id:"select_content",defaultMessage:"select_content"}),optionFilterProp:"children",filterOption:function(A,$){if($&&$.children){var Q;return($==null||(Q=$.children)===null||Q===void 0?void 0:Q.toString().toLowerCase().indexOf(A.toLowerCase()))>=0}return!0},notFoundContent:Ce?(0,O.jsx)(l.Z,{size:"small"}):null,optionLabelProp:"label",children:ee.map(function(j){return(0,O.jsx)(X.default.Option,{value:j.id,label:j.name,children:j.name},j.id)})})}},92008:function(ye,te,t){t.r(te),t.d(te,{QuestionareForm:function(){return Te},default:function(){return ke}});var ae=t(19632),G=t.n(ae),k=t(9783),J=t.n(k),X=t(97857),l=t.n(X),w=t(15009),T=t.n(w),Y=t(99289),K=t.n(Y),be=t(5574),O=t.n(be),fe=t(58664),R=t(95020),q=t(78715),V=t(952),_=t(5966),re=t(52688),ie=t(64317),ve=t(31199),xe=t(74453),oe=t(71471),z=t(75842),W=t(2453),ue=t(74330),ee=t(14726),m=t(67294),a=t(80854),he=t(13769),Ce=t.n(he),le=t(62235),b=t(44167),ge=t(45919),pe=t(16894),se=t(60943),e=t(85893),j=["type"],A=function(I){var o=I.record,Z=z.Z.useForm(),S=O()(Z,1),C=S[0],d=(0,a.useIntl)(),B=(0,m.useMemo)(function(){return{onValuesChange:function(g,c){var x=c,v=x.visible_on_front;(0,R.lt)(o.id,{visible_on_front:v}).then(function(L){W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"question_answer_visibility_changed",defaultMessage:L.message}))}).catch(function(){return W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}))})},submitter:{render:function(){return null}}}},[]);return(0,e.jsx)(V.ZP,l()(l()({form:C},B),{},{children:(0,e.jsx)(re.Z,{name:"visible_on_front",initialValue:o.visible_on_front,checkedChildren:d.formatMessage({id:"visible",defaultMessage:"visible"}),unCheckedChildren:d.formatMessage({id:"hidden",defaultMessage:"hidden"})})}))},$=function(I){var o=I.questionnaireId,Z=I.questions,S=(0,m.useMemo)(function(){return Z&&Z.reduce(function(E,g){return l()(l()({},E),{},J()({},g.id,g.title))},{})},[Z]),C=[{title:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),dataIndex:"question_id",hideInSearch:!1,valueEnum:S,valueType:"select"}],d=(0,a.useIntl)(),B=[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"updated_at",defaultMessage:"updated_at"}),dataIndex:"updated_at",hideInSearch:!0,render:function(g,c){return c.updated_at?new Date(c.updated_at).toLocaleString():"-"},sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"from",defaultMessage:"from"}),dataIndex:"date",hideInSearch:!1,hideInForm:!0,hideInTable:!0,valueType:"date"},{title:(0,e.jsx)(a.FormattedMessage,{id:"to",defaultMessage:"to"}),dataIndex:"dateto",hideInSearch:!1,hideInForm:!0,hideInTable:!0,valueType:"date"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"question_title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"note",defaultMessage:"note"}),dataIndex:"note",hideInSearch:!0,sorter:!0,render:function(g,c){var x,v;return c.note&&((x=c.note)===null||x===void 0?void 0:x.length)>64?((v=c.note)===null||v===void 0?void 0:v.slice(0,64))+"...":c.note}},{title:(0,e.jsx)(a.FormattedMessage,{id:"user",defaultMessage:"user"}),dataIndex:"user_id",hideInSearch:!1,render:function(g,c){var x,v;return(0,e.jsxs)("div",{children:[(0,e.jsx)(le.Z,{type:"App\\Models\\User",type_id:c.user_id}),(0,e.jsx)("p",{className:"list-paragraph",children:(x=c.user)===null||x===void 0?void 0:x.name}),(0,e.jsx)("p",{className:"list-paragraph",children:(v=c.user)===null||v===void 0?void 0:v.email})]})},renderFormItem:function(g,c,x){var v=c.type,L=Ce()(c,j);if(v==="form")return null;var F=x.getFieldValue("state");return(0,e.jsx)(b.Z,l()(l()({},L),{},{state:{type:F}}))}},{title:(0,e.jsx)(a.FormattedMessage,{id:"sum_rate",defaultMessage:"sum_rate"}),dataIndex:"rate",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"}),dataIndex:"visible_on_front",hideInSearch:!0,sorter:!1,render:function(g,c){return(0,e.jsx)(A,{record:c})}}];return(0,e.jsx)(pe.ZP,{headerTitle:d.formatMessage({id:"answers",defaultMessage:"answers"}),search:{layout:"vertical"},rowKey:"id",request:function(g,c){var x=g.pageSize,v=g.current,L=g.question_id,F=g.user_id,r=g.date,y=g.dateto,s=c&&Object.entries(c)[0];return(0,R.l)(o,{per_page:x,page:v,question_id:L,user_id:F,updated_at_from:r?(0,se.WU)(new Date(r),ge.Cu):void 0,updated_at_to:y?(0,se.WU)(new Date(y),ge.Cu):void 0,order_by:s&&s[0],order:s?s[1]==="ascend"?"ASC":"DESC":void 0}).then(function(P){return P.success?{data:P.data,success:!0}:[]})},columns:[].concat(B,C)})},Q=$,H=t(66419),$e=t(51042),we=t(47389),Le=t(82061),Se=t(83062),Ue=t(86738),Me=t(31472),Ve=t(37476),Qe=function(I){var o=(0,a.useIntl)(),Z=I.visible,S=I.onVisibleChange,C=I.onFinish,d=I.id,B=I.questionsList,E=z.Z.useForm(),g=O()(E,1),c=g[0];(0,m.useEffect)(function(){typeof d=="number"&&d>0?(0,R.a5)(d).then(function(v){v.success&&c.setFieldsValue(v.data)}):c.resetFields()},[d,c]);var x=Object.values(Me.Yo).map(function(v){return{name:v,label:o.formatMessage({id:"QuestionType.".concat(v)}),value:v,disabled:v===Me.Yo.Review&&B.findIndex(function(L){var F=L.type;return F===Me.Yo.Review})!==-1}});return(0,e.jsxs)(Ve.Y,{form:c,title:o.formatMessage({id:typeof d=="number"&&d>0?"question_edit":"question_add",defaultMessage:typeof d=="number"&&d>0?"question_edit":"question_add"}),width:"400px",visible:Z,onVisibleChange:S,onFinish:C,children:[(0,e.jsx)(ie.Z,{name:"type",options:x,label:(0,e.jsx)(a.FormattedMessage,{id:"type"}),initialValue:Me.Yo.Rate}),(0,e.jsx)(_.Z,{width:"lg",name:"title",label:(0,e.jsx)(a.FormattedMessage,{id:"title"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"title"}),placeholder:o.formatMessage({id:"title"})}),(0,e.jsx)(_.Z,{width:"lg",name:"description",label:(0,e.jsx)(a.FormattedMessage,{id:"description"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"description"}),placeholder:o.formatMessage({id:"description"})}),(0,e.jsx)(ve.Z,{width:"lg",name:"position",label:(0,e.jsx)(a.FormattedMessage,{id:"position"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"position"}),placeholder:o.formatMessage({id:"position",defaultMessage:"position"}),min:0,max:9999,fieldProps:{step:1}}),(0,e.jsx)(re.Z,{initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})}),(0,e.jsx)(re.Z,{initialValue:!0,name:"public_answers",label:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"})})]})},We=Qe,Be=function(I){var o=I.questionnaireId,Z=I.questions,S=I.fetchData,C=(0,a.useIntl)(),d=(0,m.useState)(!1),B=O()(d,2),E=B[0],g=B[1],c=(0,m.useMemo)(function(){return[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!1,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",hideInSearch:!0,sorter:!0,renderText:function(r,y){return C.formatMessage({id:"QuestionType.".concat(y.type)})}},{title:(0,e.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"description"}),dataIndex:"description",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"position",defaultMessage:"position"}),dataIndex:"position",hideInSearch:!0,sorter:!0}]},[]),x=(0,m.useRef)(),v=function(){var F=K()(T()().mark(function r(y,s){var P;return T()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return P=W.ZP.loading(C.formatMessage({id:"loading"})),h.prev=1,h.next=4,s&&s!==-1?(0,R.WW)(s,l()(l()({},y),{},{questionnaire_id:o})):(0,R.xL)(l()(l()({},y),{},{questionnaire_id:o}));case 4:return P(),S(),W.ZP.success(C.formatMessage({id:"success"})),h.abrupt("return",!0);case 10:return h.prev=10,h.t0=h.catch(1),P(),W.ZP.error(C.formatMessage({id:"error"})),h.abrupt("return",!1);case 15:case"end":return h.stop()}},r,null,[[1,10]])}));return function(y,s){return F.apply(this,arguments)}}(),L=(0,m.useCallback)(function(){var F=K()(T()().mark(function r(y){var s;return T()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s=W.ZP.loading(C.formatMessage({id:"loading"})),p.prev=1,p.next=4,(0,R.Km)(y);case 4:return s(),S(),p.abrupt("return",!0);case 9:return p.prev=9,p.t0=p.catch(1),s(),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"})),p.abrupt("return",!1);case 14:case"end":return p.stop()}},r,null,[[1,9]])}));return function(r){return F.apply(this,arguments)}}(),[x,C]);return(0,m.useEffect)(function(){var F;(F=x.current)===null||F===void 0||F.reload()},[Z,S]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(pe.ZP,{headerTitle:C.formatMessage({id:"question_list",defaultMessage:"question_list"}),actionRef:x,rowKey:"id",search:{layout:"vertical"},toolBarRender:function(){return[(0,e.jsxs)(ee.ZP,{type:"primary",onClick:function(){g(-1)},children:[(0,e.jsx)($e.Z,{})," ",(0,e.jsx)(a.FormattedMessage,{id:"pages.searchTable.new",defaultMessage:"\u65B0\u5EFA"})]},"primary")]},columns:[].concat(G()(c),[{title:(0,e.jsx)(a.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(r,y){return[(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)(we.Z,{}),onClick:function(){return y.id&&g(y.id)}})},"edit"),(0,e.jsx)(Ue.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return y.id&&L(y.id)},okText:(0,e.jsx)(a.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(a.FormattedMessage,{id:"no"}),children:(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)(Le.Z,{}),danger:!0})})},"delete")]}}]),request:function(r,y){var s=r.title,P=y&&Object.entries(y)[0];return new Promise(function(p){var h=Z?G()(Z):[];s&&(h=h.filter(function(de){return de.title.toLowerCase().includes(s.toLowerCase())})),P&&(h=(0,H.Pf)(h,P[0],P[1]!=="ascend")),p({data:h,success:!0,total:h.length})})}}),(0,e.jsx)(We,{id:E,visible:Number.isInteger(E),onVisibleChange:function(r){return r===!1&&g(!1)},questionsList:Z!=null?Z:[],onFinish:function(){var F=K()(T()().mark(function r(y){var s;return T()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,v(y,Number(E));case 2:s=p.sent,s&&g(!1);case 4:case"end":return p.stop()}},r)}));return function(r){return F.apply(this,arguments)}}()})]})},Ke=Be,Pe=t(74656),qe=t(78677),ze=t(38925),Ge={isGroup:!0,xField:"label",yField:"value",seriesField:"type",marginRatio:0},Ye=function(I){var o=I.state,Z=(0,a.useIntl)();return(0,e.jsxs)(q.ZP,{headerBordered:!0,style:{height:"500px"},children:[o.mode==="loading"&&(0,e.jsx)(ue.Z,{}),o.mode==="loaded"&&o.value.length>0?(0,e.jsx)(qe.Z,l()(l()({},Ge),{},{data:[].concat(G()(o.value),G()(o.value)).map(function(S,C){return{label:S.title,value:C>o.value.length-1?S.count_answers:Number(S.avg_rate),type:C>o.value.length-1?Z.formatMessage({id:"answers"}):"Rating"}})})):o.mode!=="loading"&&(0,e.jsx)("p",{children:(0,e.jsx)(a.FormattedMessage,{id:"no_data",defaultMessage:"no_data"})}),o.mode==="error"&&(0,e.jsx)(ze.Z,{message:o.error.data.message,type:"error"})]})},Xe=Ye,He=function(I){var o=I.questionnaireId,Z=I.models,S=(0,m.useState)(""),C=O()(S,2),d=C[0],B=C[1],E=(0,m.useState)({mode:"init"}),g=O()(E,2),c=g[0],x=g[1],v=(0,m.useState)(!1),L=O()(v,2),F=L[0],r=L[1],y=(0,m.useCallback)(K()(T()().mark(function s(){var P,p,h;return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return P=d.split("/"),r(!0),u.prev=2,u.next=5,(0,R.Hp)(P[2],Number(P[1]),Number(o));case 5:p=u.sent,p instanceof Blob&&(h=document.createElement("a"),h.href=window.URL.createObjectURL(p),h.download="raport_questionaire_".concat(P[2],"_").concat(o,".xlsx"),document.body.appendChild(h),h.click(),document.body.removeChild(h)),u.next=12;break;case 9:u.prev=9,u.t0=u.catch(2),x({mode:"error",error:u.t0});case 12:return u.prev=12,r(!1),u.finish(12);case 15:case"end":return u.stop()}},s,null,[[2,9,12,15]])})),[d,o]);return(0,m.useEffect)(function(){x({mode:"loading"});var s=function(){var P=K()(T()().mark(function p(){var h;return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,!d){u.next=7;break}return u.next=4,(0,R.Cq)(o,Number(d.split("/")[0]),Number(d.split("/")[1]));case 4:u.t0=u.sent,u.next=10;break;case 7:return u.next=9,(0,R.Cq)(o);case 9:u.t0=u.sent;case 10:h=u.t0,h.success&&x({mode:"loaded",value:h.data}),u.next=17;break;case 14:u.prev=14,u.t1=u.catch(0),x({mode:"error",error:u.t1});case 17:case"end":return u.stop()}},p,null,[[0,14]])}));return function(){return P.apply(this,arguments)}}();s()},[o,Z,d]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(oe.Z.Title,{level:5,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.raports.filter",defaultMessage:"questionnaire.raports.filter"})}),(0,e.jsx)(Pe.default,{allowClear:!0,style:{minWidth:"400px"},onChange:function(P){return B(P)},children:Z.map(function(s){return(0,e.jsxs)(Pe.default.Option,{value:"".concat(s.model_type_id,"/").concat(s.model_id,"/").concat(s.model_type_title),children:[(0,e.jsx)(a.FormattedMessage,{id:s.model_type_title,defaultMessage:s.model_type_title})," ","- ",s.model_title]},s.id)})}),d&&(0,e.jsxs)("div",{children:[(0,e.jsx)("br",{}),(0,e.jsx)(ee.ZP,{onClick:y,loading:F,children:(0,e.jsx)(a.FormattedMessage,{id:"download"})})]}),(0,e.jsx)("hr",{}),(0,e.jsx)(q.ZP,{split:"vertical",children:(0,e.jsx)(q.ZP,{colSpan:24,layout:"center",children:(0,e.jsx)(Xe,{state:c})})})]})},Je=He,Ie=oe.Z.Title,Te=function(){var I,o,Z=(0,a.useParams)(),S=Z.questionnaireId,C=(0,a.useIntl)(),d=S==="new",B=z.Z.useForm(),E=O()(B,1),g=E[0],c=z.Z.useForm(),x=O()(c,1),v=x[0],L=(0,m.useState)(),F=O()(L,2),r=F[0],y=F[1],s=(0,m.useState)("questionnaire"),P=O()(s,2),p=P[0],h=P[1],de=(0,m.useState)(),u=O()(de,2),Ze=u[0],et=u[1],tt=(0,m.useState)({}),Ee=O()(tt,2),ce=Ee[0],Oe=Ee[1],at=(0,m.useState)({}),Ae=O()(at,2),De=Ae[0],rt=Ae[1],Ne=(0,m.useCallback)(K()(T()().mark(function n(){var i;return T()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.xR)();case 2:i=f.sent,i.success&&et(i.data);case 4:case"end":return f.stop()}},n)})),[]),Re=(0,m.useCallback)(function(n,i){return n.reduce(function(M,f){return(M[f[i]]=M[f[i]]||[]).push(f.model_id),M},{})},[]),me=(0,m.useCallback)(K()(T()().mark(function n(){var i;return T()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.Iu)(Number(S));case 2:i=f.sent,i.success&&(y(l()({},i.data)),i.data.models&&Oe(Re(i.data.models,"model_type_id")));case 4:case"end":return f.stop()}},n)})),[S,Re]);(0,m.useEffect)(function(){if(Ne(),d){y({title:"new"});return}me()},[S,me,Ne,d]);var st=(0,m.useCallback)(function(n,i){Oe(function(M){return l()(l()({},M),{},J()({},i,n))})},[]),Fe=(0,m.useCallback)(function(n){var i=[];return Object.keys(n).map(function(M){i.push.apply(i,G()(n[M].map(function(f){return{model_id:Number(f),model_type_id:Number(M),target_group:v.getFieldValue("models.".concat(Number(M),".").concat(Number(f),".target_group")),display_frequency_minutes:v.getFieldValue("models.".concat(Number(M),".").concat(Number(f),".display_frequency_minutes"))}})))}),i},[v]),nt=(0,m.useMemo)(function(){return{onFinish:function(){var n=K()(T()().mark(function M(f){var U,D;return T()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(N.prev=0,!d){N.next=9;break}return N.next=4,(0,R.wW)(l()(l()({},f),{},{models:Fe(ce)}));case 4:U=N.sent,U.success&&a.history.push("/other/questionnaire/".concat(U.data.id)),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"})),N.next=14;break;case 9:return N.next=11,(0,R.xN)(Number(r==null?void 0:r.id),l()(l()({},f),{},{models:Fe(ce)}));case 11:D=N.sent,D.success&&me(),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"}));case 14:N.next=19;break;case 16:N.prev=16,N.t0=N.catch(0),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}));case 19:case"end":return N.stop()}},M,null,[[0,16]])}));function i(M){return n.apply(this,arguments)}return i}(),initialValues:r}},[r,ce,me,Fe,d]),_e=(0,m.useCallback)(function(n){var i;return r&&((i=r.models)===null||i===void 0?void 0:i.filter(function(M){return M.model_type_title===n}))},[r]),it=(0,m.useCallback)(function(n,i,M,f){var U;return((U=_e(i))===null||U===void 0||(U=U.find(function(D){return D.model_id===Number(n)}))===null||U===void 0?void 0:U.model_title)||De[f][M]},[_e,De]),ot=(0,m.useMemo)(function(){var n;return r==null||(n=r.models)===null||n===void 0?void 0:n.reduce(function(i,M){var f="models.".concat(M.model_type_id,".").concat(M.model_id);return i["".concat(f,".target_group")]=M.target_group,i["".concat(f,".display_frequency_minutes")]=M.display_frequency_minutes,i},{})},[r==null?void 0:r.models]);if(!r)return(0,e.jsx)(ue.Z,{});var ut=[{label:(0,e.jsx)(a.FormattedMessage,{id:"author"}),value:"author"},{label:(0,e.jsx)(a.FormattedMessage,{id:"users"}),value:"user"}];return(0,e.jsx)(xe._z,{title:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(a.FormattedMessage,{id:r!=null&&r.title?"questionnaire":"new_questionnaire"})}),header:{breadcrumb:{routes:[{path:"other/questionnaire",breadcrumbName:C.formatMessage({id:"menu.Other activities.Questionnaire"})},{path:String(S),breadcrumbName:C.formatMessage({id:"form"})},{path:"/",breadcrumbName:String(r==null?void 0:r.title)}]}},children:(0,e.jsxs)(q.ZP,{tabs:{type:"card",defaultActiveKey:"questionnaire",activeKey:p,onChange:function(i){return h(i)}},children:[(0,e.jsxs)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"}),children:[(0,e.jsx)(Ie,{level:3,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"})}),(0,e.jsx)(V.ZP,l()(l()({},nt),{},{form:g,children:(0,e.jsxs)(V.ZP.Group,{children:[(0,e.jsx)(_.Z,{label:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),rules:[{required:!0}],width:"md",name:"title"}),(0,e.jsx)(re.Z,{width:"md",initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})})]})}))]},"questionnaire"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),disabled:d,children:(0,e.jsx)(Ke,{questionnaireId:Number(S),questions:r.questions||[],fetchData:me})},"questions"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"answers",defaultMessage:"answers"}),disabled:d,children:(0,e.jsx)(Q,{questionnaireId:Number(S),questions:r.questions||[]})},"answers"),Ze&&Ze.map(function(n){var i,M,f,U;return(0,e.jsxs)(q.ZP.TabPane,{tab:"".concat(C.formatMessage({id:"assign"})," ").concat(C.formatMessage({id:"to"})," ").concat(C.formatMessage({id:(i=n.title)===null||i===void 0?void 0:i.replace(n.title.charAt(0),n.title.charAt(0).toUpperCase())})),disabled:d,children:[(0,e.jsx)(fe.T,{defaultValue:((M=r.models)===null||M===void 0?void 0:M.filter(function(D){return D.model_type_title===n.title}).map(function(D){return{value:D.model_id,label:D.model_title}}))||[],multiple:!0,onChange:function(je,N){return[st(je,n.id),rt(function(lt){return l()(l()({},lt),{},J()({},n.id,N.map(function(dt){return dt.label})))})]},modelType:(f=n.title)===null||f===void 0?void 0:f.toUpperCase()}),(0,e.jsx)(V.ZP,{form:v,submitter:!1,initialValues:ot,style:{marginTop:"20px"},children:ce[n.id]&&((U=ce[n.id])===null||U===void 0?void 0:U.map(function(D,je){return(0,e.jsxs)("div",{children:[(0,e.jsx)(Ie,{level:5,children:it(Number(D),n.title,je,n.id)}),(0,e.jsxs)(V.ZP.Group,{children:[(0,e.jsx)(ie.Z,{width:"md",name:"models.".concat(n.id,".").concat(D,".target_group"),label:(0,e.jsx)(a.FormattedMessage,{id:"target_group",defaultMessage:"target_group"}),initialValue:"user",options:ut}),(0,e.jsx)(ve.Z,{width:"md",name:"models.".concat(n.id,".").concat(D,".display_frequency_minutes"),label:(0,e.jsx)(a.FormattedMessage,{id:"display_frequency_minutes",defaultMessage:"display_frequency_minutes"})})]})]},String(D))}))}),(0,e.jsx)(ee.ZP,{className:"submit-btn",type:"primary",onClick:function(){return g.submit()},children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.submit",defaultMessage:"questionnaire.submit"})})]},String(n.id))}),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"menu.reports",defaultMessage:"menu.reports"}),disabled:d||((I=r.models)===null||I===void 0?void 0:I.length)===0,children:(r==null?void 0:r.models)&&(r==null||(o=r.models)===null||o===void 0?void 0:o.length)>0&&(0,e.jsx)(Je,{questionnaireId:Number(S),models:r.models})},"raport")]})})},ke=Te}}]);
