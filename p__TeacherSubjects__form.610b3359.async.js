(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(mt,Ae,i){},"5Syx":function(mt,Ae,i){"use strict";i.d(Ae,"c",function(){return tt}),i.d(Ae,"b",function(){return Be}),i.d(Ae,"a",function(){return jt});var b=i("OaEy"),Fe=i("2fM7"),te=i("g9YV"),I=i("wCAj"),ve=i("14J3"),j=i("BMrR"),st=i("BoS7"),s=i("Sdc0"),et=i("jrin"),ce=i("k1fw"),le=i("DYRE"),pe=i("zeV3"),Xe=i("+BJd"),Ee=i("mr32"),Q=i("oBTY"),ye=i("tJVT"),we=i("q1tI"),ut=i.n(we),ft=i("nhC9"),Ne=i("LDJE"),h=i("9kvl"),N=i("nz6D"),Ue=i("sWYD"),nt=i("mGZj"),ct=i("Vpfc"),ie=i("+L6B"),W=i("2/Rp"),A=i("qLMh"),G=i("9og8"),z=i("4KAj"),_e=i("w/VK"),y=i("nKUr"),Ce=function(Te){var Ge=Te.course_id,oe=Te.stat,je=oe===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":oe,de=Object(we.useState)(!1),ne=Object(ye.a)(de,2),he=ne[0],Ke=ne[1],M=Object(we.useCallback)(function(De){return Object(G.a)(Object(A.a)().mark(function be(){var me,Z;return Object(A.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return Ke(!0),D.prev=1,D.next=4,Object(_e.a)(De,{stat:je});case 4:me=D.sent,me instanceof Blob&&(Z=document.createElement("a"),Z.href=window.URL.createObjectURL(me),Z.download="finished_topics_".concat(Ge,".xlsx"),document.body.appendChild(Z),Z.click(),document.body.removeChild(Z)),D.next=11;break;case 8:D.prev=8,D.t0=D.catch(1),console.error(D.t0);case 11:return D.prev=11,Ke(!1),D.finish(11);case 14:case"end":return D.stop()}},be,null,[[1,8,11,14]])}))},[je]);return Object(y.jsxs)(W.a,{type:"primary",loading:he,onClick:M(Ge),children:[Object(y.jsx)(z.a,{})," ",Object(y.jsx)(h.a,{id:"export"})]})},at=function(Te){return Te.topicable.content.contents?Object.values(Te.topicable.content.contents)[0].library:"H5P"},tt=function(Te){var Ge=Te.course_id,oe=Te.topics,je=Te.stats,de=Object(we.useState)(!1),ne=Object(ye.a)(de,2),he=ne[0],Ke=ne[1],M=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(me){return Object(y.jsx)(ct.a,{type:"App\\Models\\User",type_id:me})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"}].concat(Object(Q.a)(oe.map(function(be){var me,Z=(me=be.topicable_type)===null||me===void 0?void 0:me.split("\\").pop();return Z==="H5P"&&(Z=at(be)),{render:function(D){var Re=0,C=0;switch(D&&(D.started_at&&D.finished_at?Re=1:D.started_at&&(Re=2),C=D.seconds/60),Re){case 1:return Object(y.jsxs)(pe.b,{children:[Object(y.jsx)(Ee.a,{color:"success",children:"F"}),he&&Object(y.jsxs)("small",{children:[C.toFixed(2),"m"]})]});case 2:return Object(y.jsxs)(pe.b,{children:[Object(y.jsx)(Ee.a,{color:"blue",children:"S"}),he&&Object(y.jsxs)("small",{children:[C.toFixed(2),"m"]})]});case 0:default:return Object(y.jsx)(ut.a.Fragment,{children:Object(y.jsx)(Ee.a,{color:"error",children:"N"})})}},title:Object(y.jsxs)("small",{children:[Object(y.jsx)(Ee.a,{children:Z})," ",be.title]}),dataIndex:be.id}})))},[oe,he]),De=Object(we.useMemo)(function(){return je.map(function(be){return oe.reduce(function(me,Z){var w=be.topics.find(function(D){return D.id===Z.id});return Object(ce.a)(Object(ce.a)({},me),{},Object(et.a)({},Number(Z.id),w!=null?w:0))},{email:be.email,id:be.id})})},[je,oe]);return Object(y.jsx)(I.a,{title:function(){return Object(y.jsxs)(j.a,{justify:"space-between",align:"middle",children:[Object(y.jsxs)(pe.b,{children:[Object(y.jsx)(h.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(y.jsx)(Ee.a,{color:"success",children:"F"}),Object(y.jsx)(h.a,{id:"Started",defaultMessage:"Started:"})," ",Object(y.jsx)(Ee.a,{color:"blue",children:"S"}),Object(y.jsx)(h.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(y.jsx)(Ee.a,{color:"error",children:"N"}),Object(y.jsx)(h.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(y.jsx)(s.a,{checked:he,onChange:function(Z){return Ke(Z)}})]}),Object(y.jsx)(Ce,{course_id:Ge})]})},columns:M,dataSource:De,size:"small",scroll:{x:1500},components:{table:function(me){return Object(y.jsx)(N.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(y.jsx)("table",Object(ce.a)({},me))})}}})},Be=function(Te){var Ge=Te.stats,oe=Te.attempts,je=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(he){return Object(y.jsx)(ct.a,{type:"App\\Models\\User",type_id:he})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"},{title:Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(y.jsx)(h.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(he){return he?Object(Ue.a)(new Date(he),nt.a):""}}]},[]),de=Object(we.useMemo)(function(){return Ge.map(function(ne){var he=ne.id,Ke=ne.email,M=ne.finished_at,De=oe==null?void 0:oe.find(function(me){return me.id===he}),be=Array.isArray(De==null?void 0:De.attempts)?De==null?void 0:De.attempts.length:0;return{id:he,email:Ke,finished_at:M,attempt:be}})},[Ge]);return Object(y.jsx)(I.a,{title:function(){return Object(y.jsx)(pe.b,{children:Object(y.jsx)(h.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:je,dataSource:de,size:"small",scroll:{x:500}})},jt=function(Te){var Ge=Te.stats,oe=Object(we.useState)(null),je=Object(ye.a)(oe,2),de=je[0],ne=je[1],he=Object(we.useState)(null),Ke=Object(ye.a)(he,2),M=Ke[0],De=Ke[1],be=Object(h.l)(),me=Object(we.useMemo)(function(){return Ge.flatMap(function(w){return Object.values(w.attempts).flatMap(function(D){var Re=D.dates,C=D.attempt,V=Object.values(Re).flatMap(function(R){var L=R.date,U=R.seconds_total;return{date:L,attempt:C,seconds_total:U,email:w.email}});return V})})},[Ge]),Z={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(y.jsx)(ft.a,{title:Object(y.jsxs)(pe.b,{children:[Object(y.jsx)(h.a,{id:"course.interactions_time_in_days"}),Object(y.jsx)(Fe.a,{showSearch:!0,value:de,onChange:function(D){ne(D),De(null)},placeholder:Object(y.jsx)(h.a,{id:"select_person",defaultMessage:"Select a person"}),children:Ge.map(function(w){var D=w.id,Re=w.email;return Object(y.jsx)(Fe.a.Option,{value:Re,children:Re},D)})}),Object(y.jsx)(Fe.a,{value:M,onChange:function(D){return De(D)},disabled:de===null,placeholder:Object(y.jsx)(h.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Q.a)(new Set(me.filter(function(w){var D=w.email;return D===de}).map(function(w){var D=w.attempt;return D}))).map(function(w){return Object(y.jsxs)(Fe.a.Option,{value:w,children:[Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"})," ",w]},w)})})]}),colSpan:12,layout:"center",children:Object(y.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(y.jsx)(Ne.a,Object(ce.a)(Object(ce.a)({},Z),{},{tooltip:{title:"".concat(be.formatMessage({id:"attempt"})),formatter:function(D){var Re=Math.floor(+D.seconds_total/60),C=+D.seconds_total>60?+D.seconds_total-Re*60:0;return{name:D.attempt,value:"".concat(Re,"m ").concat(C,"s")}}},data:me.filter(function(w){var D=w.email;return D===de}).filter(function(w){var D=w.attempt;return Number.isInteger(M)?D===M:!0})}))})})}},olry:function(mt,Ae,i){"use strict";i.r(Ae);var b=i("k1fw"),Fe=i("+L6B"),te=i("2/Rp"),I=i("T2oS"),ve=i("W9HT"),j=i("q1tI"),st=i.n(j),s=i("9kvl"),et=i("55Ip"),ce=i("Ty5D"),le=i("nhC9"),pe=i("tMyG"),Xe=i("my69"),Ee=i("huej"),Q=i("mJ0o"),ye=i("EhlZ"),we=i("P2fV"),ut=i("NJEC"),ft=i("5Dmo"),Ne=i("3S7+"),h=i("qLMh"),N=i("9og8"),Ue=i("sWYD"),nt=i("G3dp"),ct=i("lbgm"),ie=i("/MfK"),W=i("Qiat"),A=i("mGZj");function G(u,n){return z.apply(this,arguments)}function z(){return z=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"GET",useCache:!1,params:n},a||{})));case 1:case"end":return t.stop()}},u)})),z.apply(this,arguments)}function _e(u,n){return y.apply(this,arguments)}function y(){return y=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),y.apply(this,arguments)}function Ce(u,n,a){return at.apply(this,arguments)}function at(){return at=Object(N.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"PUT",data:a,useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),at.apply(this,arguments)}function tt(u,n){return Be.apply(this,arguments)}function Be(){return Be=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Be.apply(this,arguments)}function jt(u,n){return Ze.apply(this,arguments)}function Ze(){return Ze=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),Ze.apply(this,arguments)}function Te(u,n,a,r){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(N.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return l.stop()}},u)})),Ge.apply(this,arguments)}function oe(u,n,a){return je.apply(this,arguments)}function je(){return je=Object(N.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"DELETE"},r||{})));case 1:case"end":return c.stop()}},u)})),je.apply(this,arguments)}var de=i("Vpfc"),ne=i("lanV"),he=i("giR+"),Ke=i("fyUT"),M=i("tJVT"),De=i("14J3"),be=i("BMrR"),me=i("jCWc"),Z=i("kPKH"),w=i("VMEa"),D=i("Qurx"),Re=i("lR9U"),C=i("/y+f"),V=i("2qtc"),R=i("kLXV"),L=i("DYRE"),U=i("zeV3"),J=i("XCrF"),ge=i("1GRj"),ae=i("jrin"),$e=i("oBTY"),$r=i("OaEy"),vt=i("2fM7"),ra=i("+YFz"),na=i("DBJ/"),e=i("nKUr"),it,sa=function(n){var a=n.type,r=n.onDataConverted,t=n.groupSelectDisabled,c=Object(Q.b)(),l=c.semester_subject_id,o=c.teacherSubjectData,m=Object(j.useState)(null),S=Object(M.a)(m,2),p=S[0],g=S[1],v=Object(j.useMemo)(function(){var x;return((x=o==null?void 0:o.groups)!==null&&x!==void 0?x:[]).map(function(O){var E=O.id,T=O.name;return{label:T,value:E}})},[]),d={type:a,group_id:p,semester_subject_id:l},f=Object(j.useCallback)(function(x){if(x.success){var O=x.data.results.filter(function(E){var T=E.user_id;return T!==null});if(!O.length)return;r({exam_results:O,group_id:x.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(w.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(vt.a,{disabled:t,value:p,onChange:function(O){return g(O)},options:v,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(na.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(O){return!O.fileList.length&&r(void 0)},maxFiles:1,data:d,disabled:!p})]})},ua=function(n){var a=n.onDataConverted,r=Object(Q.b)(),t=r.teacherSubjectData,c=r.groupUsers,l=Object(j.useState)(null),o=Object(M.a)(l,2),m=o[0],S=o[1],p=Object(j.useMemo)(function(){var v;return((v=t==null?void 0:t.groups)!==null&&v!==void 0?v:[]).map(function(d){var f=d.id,x=d.name;return{label:x,value:f}})},[]),g=Object(j.useCallback)(function(v){var d;S(v);var f=(d=c.byId)===null||d===void 0?void 0:d[v];if(!!f){var x=f.users.reduce(function(O,E){var T=E.id,_=E.email,B=E.first_name,K=E.last_name,se=E.academic_teacher_id;return se!==null?O:[].concat(Object($e.a)(O),[{email:_,first_name:B,last_name:K,user_id:T,result:0}])},[]);a({group_id:v,exam_results:x})}},[c.byId]);return Object(e.jsx)(vt.a,{value:m,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},Ot=(it={},Object(ae.a)(it,C.c.TestPortal,["/teacher-examples/testPortal.png"]),Object(ae.a)(it,C.c.TeamsForms,["/teacher-examples/teamsForms.png"]),Object(ae.a)(it,C.c.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),Object(ae.a)(it,C.c.Manual,[]),it),ca=function(n){var a=n.images,r=Object(j.useState)(!1),t=Object(M.a)(r,2),c=t[0],l=t[1],o=Object(j.useCallback)(function(){return l(!0)},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"see_file_example_image"}),children:Object(e.jsx)(te.a,{onClick:o,icon:Object(e.jsx)(ra.a,{})})}),Object(e.jsx)(ge.a.PreviewGroup,{preview:{visible:c,onVisibleChange:l},children:a.map(function(m){return Object(e.jsx)(ge.a,{style:{display:"none"},src:m},m)})})]})},ia=function(n){var a,r=n.type,t=n.onOk,c=n.onCancel,l=n.okDisabled,o=(a=Ot==null?void 0:Ot[r])!==null&&a!==void 0?a:Ot[C.c.Manual];return Object(e.jsxs)(U.b,{style:{width:"100%",justifyContent:o.length?"space-between":"flex-end"},children:[!!o.length&&Object(e.jsx)(ca,{images:o}),Object(e.jsxs)(U.b,{children:[Object(e.jsx)(te.a,{onClick:c,children:Object(e.jsx)(s.a,{id:"cancel"})}),Object(e.jsx)(te.a,{type:"primary",disabled:l,onClick:t,children:Object(e.jsx)(s.a,{id:"ok"})})]})]})},da=[C.c.TeamsLecture,C.c.TestPortal,C.c.TeamsForms],la=function(n){var a=n.open,r=n.closeModal,t=n.onSuccess,c=n.type,l=Object(Q.b)(),o=l.teacherSubjectData,m=l.fetchGroupUsers,S=Object(j.useState)(),p=Object(M.a)(S,2),g=p[0],v=p[1];return Object(j.useEffect)(function(){if(c===C.c.Manual&&a){var d;o==null||(d=o.groups)===null||d===void 0||d.forEach(function(f){var x=f.id;return m(x)})}},[c,a]),Object(e.jsxs)(R.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:r,footer:Object(e.jsx)(ia,{type:c,onOk:function(){g&&t(g)},onCancel:r,okDisabled:!g}),children:[da.includes(c)&&Object(e.jsx)(sa,{type:c,onDataConverted:v,groupSelectDisabled:!!g}),c===C.c.Manual&&Object(e.jsx)(ua,{onDataConverted:v})]})},oa=function(n){var a=n.onSelect;return Object(e.jsxs)(be.a,{gutter:[16,16],children:[Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(te.a,{type:"primary",onClick:function(){return a(C.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(te.a,{type:"primary",onClick:function(){return a(C.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(te.a,{type:"primary",onClick:function(){return a(C.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(te.a,{type:"primary",onClick:function(){return a(C.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ja=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ba=function(n){var a,r=n.exam_id,t=w.a.useForm(),c=Object(M.a)(t,1),l=c[0],o=Object(j.useState)(),m=Object(M.a)(o,2),S=m[0],p=m[1],g=Object(j.useState)(),v=Object(M.a)(g,2),d=v[0],f=v[1],x=Object(j.useState)(!1),O=Object(M.a)(x,2),E=O[0],T=O[1],_=Object(Q.b)(),B=_.semester_subject_id,K=_.getGroupById,se=Object(j.useMemo)(function(){var P;return((P=d==null?void 0:d.exam_results)!==null&&P!==void 0?P:[]).map(function($){var F=$.user_id;return F})},[d==null?void 0:d.exam_results]);Object(j.useEffect)(function(){var P=Number(r);r==="new"&&(p(void 0),f(void 0),l.resetFields()),r!=="new"&&!Number.isNaN(P)&&(T(!0),tt(P).then(function($){if($.success){var F=$.data,k=F.type,Pe=F.results,He=F.title,ee=F.weight,re=F.passed_at,H=F.group_id;p(k),f({group_id:H,exam_results:Pe}),l.setFieldsValue({title:He,weight:ee,passed_at:re})}}).finally(function(){return T(!1)}))},[r]);var Me=Object(j.useCallback)(function(){p(void 0),f(void 0)},[]);return E?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[S&&Object(e.jsx)(la,{open:Boolean(S&&!d),type:S,closeModal:Me,onSuccess:f}),Object(e.jsxs)(w.a,{form:l,submitter:S===void 0||!d?!1:void 0,onFinish:function(){var P=Object(N.a)(Object(h.a)().mark(function $(F){var k,Pe,He,ee,re,H,xe,We,Se,Je;return Object(h.a)().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(Pe=d==null||(k=d.exam_results)===null||k===void 0?void 0:k.every(function(Y){var X=Y.result;return typeof X=="number"&&X>=0&&X<=100}),!(d&&Pe&&typeof B=="number")){ue.next=17;break}if(He=F.title,ee=F.passed_at,re=F.weight,H=Number(r),xe=d.exam_results,We=d.group_id,Se={type:S,semester_subject_id:B,title:He,passed_at:ee,weight:re,group_id:We,results:xe},!Number.isNaN(H)){ue.next=12;break}return ue.next=9,_e(Se);case 9:ue.t0=ue.sent,ue.next=15;break;case 12:return ue.next=14,Ce(H,Se);case 14:ue.t0=ue.sent;case 15:Je=ue.t0,Je.success&&s.f.push("/teacher/subjects/".concat(B,"/exams"));case 17:return ue.abrupt("return",!0);case 18:case"end":return ue.stop()}},$)}));return function($){return P.apply(this,arguments)}}(),onReset:Me,children:[Object(e.jsxs)(w.a.Group,{children:[Object(e.jsx)(D.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(Re.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(w.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ke.a,{})})]}),S&&d&&Object(e.jsx)(W.a,{rowKey:"user_id",headerTitle:(a=K(d.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:se,onValuesChange:function($,F){return f({group_id:d.group_id,exam_results:F})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:d.exam_results,pagination:{defaultPageSize:ne.a},columns:ja}),!d&&Object(e.jsx)(oa,{onSelect:p})]})]})},ma=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],fa=function(n){var a=n.exam_id,r=Object(j.useState)(""),t=Object(M.a)(r,2),c=t[0],l=t[1];return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,pagination:{defaultPageSize:ne.a},request:Object(N.a)(Object(h.a)().mark(function o(){var m;return Object(h.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,tt(a);case 2:if(m=p.sent,!m.success){p.next=6;break}return l(m.data.title),p.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},o)})),columns:ma})},va=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,a){return a.passed_at&&Object(Ue.a)(new Date(a.passed_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,a){return a.created_at&&Object(Ue.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,a){return Object(e.jsx)(de.a,{type:"Students",type_id:a.group_id},a.group_id)}}],Oa=function(){var n,a,r=Object(j.useRef)(),t=Object(Q.b)(),c=t.semester_subject_id,l=Object(ce.k)(),o=Object(j.useMemo)(function(){var p,g,v;return{exam_id:(p=(g=l.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(v=l.query)===null||v===void 0?void 0:v.results}},[(n=l.query)===null||n===void 0?void 0:n.exam_id,(a=l.query)===null||a===void 0?void 0:a.results]),m=o.exam_id,S=o.results;return S!==null&&!Number.isNaN(Number(S))?Object(e.jsx)(fa,{exam_id:Number(S)}):m!==null?Object(e.jsx)(ba,{exam_id:m}):Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",pagination:{defaultPageSize:ne.a},request:function(){var p=Object(N.a)(Object(h.a)().mark(function g(v,d){var f,x,O,E;return Object(h.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=v.current,x=v.pageSize,c!==null){_.next=3;break}return _.abrupt("return",{data:[],total:0,success:!1});case 3:return O=d&&Object.entries(d)[0],_.next=6,G({per_page:x,page:f,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:O&&O[0],order:O&&(O[1]==="ascend"?"ASC":"DESC")});case 6:if(E=_.sent,!E.success){_.next=9;break}return _.abrupt("return",{data:E.data,total:E.meta.total,success:!0});case 9:return _.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return _.stop()}},g)}));return function(g,v){return p.apply(this,arguments)}}(),columns:[].concat(va,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,v){return[Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?exam_id=").concat(v.id),children:Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(te.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit"),Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?results=").concat(v.id),children:Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(te.a,{icon:Object(e.jsx)(ct.a,{})})})},"results"),Object(e.jsx)(ut.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(N.a)(Object(h.a)().mark(function d(){var f;return Object(h.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,jt(v.id);case 2:f=O.sent,f.success&&r.current&&r.current.reload();case 4:case"end":return O.stop()}},d)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(te.a,{type:"primary",icon:Object(e.jsx)(ie.a,{}),danger:!0})})},"delete")]}}])})},gt=i("o0Ox"),Pr=i("miYZ"),dt=i("tsqr"),pa=i("4KAj");function ha(u,n){return xt.apply(this,arguments)}function xt(){return xt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),xt.apply(this,arguments)}var ga=function(n){var a=n.student_id,r=Object(j.useState)(!1),t=Object(M.a)(r,2),c=t[0],l=t[1],o=Object(j.useCallback)(Object(N.a)(Object(h.a)().mark(function m(){var S;return Object(h.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l(!0),g.next=3,ha({user_id:a});case 3:if(S=g.sent,S.success){g.next=8;break}return dt.b.error(S.message),l(!1),g.abrupt("return");case 8:window.open(S.data.web_url,"_blank","noopener noreferrer"),l(!1);case 10:case"end":return g.stop()}},m)})),[]);return Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(te.a,{loading:c,type:"primary",icon:Object(e.jsx)(pa.a,{}),onClick:o})})},xa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Sa=function(n){return n.map(function(a){var r=a.id,t=a.name;return{label:t,value:r}})},ya=function(n){return n.reduce(function(a,r){var t,c=r==null||(t=r.users)===null||t===void 0?void 0:t.reduce(function(l,o){return o.academic_teacher_id!==null?l:[].concat(Object($e.a)(l),[{group_id:r.id,group_name:r.name,user_id:o.id,first_name:o.first_name,last_name:o.last_name,email:o.email}])},[]);return[].concat(Object($e.a)(a),Object($e.a)(c))},[])},_a=function(){var n=Object(Q.b)(),a=n.teacherSubjectData,r=Object(j.useMemo)(function(){var t;return Sa((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:ne.a},request:function(){var t=Object(N.a)(Object(h.a)().mark(function c(l){var o,m,S,p,g,v,d,f,x;return Object(h.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=l.groups,m=l.first_name,S=m===void 0?"":m,p=l.last_name,g=p===void 0?"":p,v=l.email,d=v===void 0?"":v,E.next=3,Object(gt.a)({parent_id:a==null?void 0:a.group_id,"id[]":o});case 3:if(f=E.sent,f.success){E.next=6;break}return E.abrupt("return",{data:[],total:0,success:!1});case 6:return x=ya(f.data).filter(function(T){return T.first_name.toLowerCase().includes(S.toLowerCase())&&T.last_name.toLowerCase().includes(g.toLowerCase())&&T.email.toLowerCase().includes(d.toLowerCase())}),E.abrupt("return",{data:x,total:x.length,success:!0});case 8:case"end":return E.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(xa,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,l){return[Object(e.jsx)(ga,{student_id:l.user_id},"teamsChat")]}}])})};function St(u,n){return yt.apply(this,arguments)}function yt(){return yt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),yt.apply(this,arguments)}function Ca(u,n,a,r){return _t.apply(this,arguments)}function _t(){return _t=Object(N.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(b.a)({data:{attendances:[{user_id:a,value:r}]},method:"POST"},t||{})));case 1:case"end":return l.stop()}},u)})),_t.apply(this,arguments)}var Ar=i("sRBo"),Bt=i("kaz8");function Ta(u){var n,a,r=u===null?C.a.ABSENT:u,t=(n={},Object(ae.a)(n,C.a.PRESENT,{ch1:!0,ch2:!1}),Object(ae.a)(n,C.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(ae.a)(n,C.a.ABSENT,{ch1:!1,ch2:!1}),Object(ae.a)(n,C.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),n);return(a=t[r])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function Ea(u){var n,a=u.ch1,r=u.ch2,t="".concat(a,"_").concat(r),c={true_false:C.a.PRESENT,true_true:C.a.PRESENT_NOT_EXERCISING,false_false:C.a.ABSENT,false_true:C.a.EXCUSED_ABSENCE};return(n=c[t])!==null&&n!==void 0?n:C.a.ABSENT}var Ga=function(n){var a=n.groupAttendanceScheduleId,r=n.studentId,t=n.attendance,c=n.onSuccess,l=Object(j.useState)(Ta(t)),o=Object(M.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(!1),g=Object(M.a)(p,2),v=g[0],d=g[1],f=Object(j.useRef)(!0),x=Object(j.useCallback)(function(T){d(!0),Ca(a,r,Ea(T)).then(function(_){_.success&&(c==null||c())}).finally(function(){return d(!1)})},[]),O=Object(j.useCallback)(function(T){return S(T.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),E=Object(j.useCallback)(function(T){return S(function(_){return Object(b.a)(Object(b.a)({},_),{},{ch2:T.target.checked})})},[]);return Object(j.useEffect)(function(){if(f.current){f.current=!1;return}x(m)},[m,x]),Object(e.jsxs)(U.b,{children:[Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Bt.a,{disabled:v,checked:m.ch1,onChange:O})}),Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Bt.a,{disabled:v,checked:m.ch2,onChange:E})})]})},Ct=Ga,Ma=function(){var n=Object(Q.b)(),a=n.teacherSubjectData,r=Object(j.useState)([]),t=Object(M.a)(r,2),c=t[0],l=t[1],o=Object(j.useState)(""),m=Object(M.a)(o,2),S=m[0],p=m[1],g=Object(s.l)(),v=Object(j.useRef)(),d=Object(j.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(O){var E=O.id,T=O.name;return{value:E,label:T}})},[a==null?void 0:a.groups]),f=Object(j.useMemo)(function(){var x;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:d,defaultValue:d==null||(x=d[0])===null||x===void 0?void 0:x.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object($e.a)(c))},[d,c]);return Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(S,")"),request:function(){var x=Object(N.a)(Object(h.a)().mark(function O(E){var T,_,B,K,se,Me,P,$,F,k,Pe;return Object(h.a)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return _=E.group_id,B=_===void 0?d==null||(T=d[0])===null||T===void 0?void 0:T.value:_,K=E.full_name,se=K===void 0?"":K,ee.next=3,Promise.all([Object(gt.b)(B),St(B)]);case 3:if(Me=ee.sent,P=Object(M.a)(Me,2),$=P[0],F=P[1],k=d.find(function(re){var H=re.value;return H===B}),!(!$.success||!F.success||!k)){ee.next=10;break}return ee.abrupt("return",{data:[],total:0,success:!1});case 10:if(F.data.length){ee.next=13;break}return dt.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),ee.abrupt("return",{data:[],total:0,success:!1});case 13:return p(k.label),l(F.data.reduce(function(re,H){return[].concat(Object($e.a)(re),[{title:String(Object(Ue.a)(new Date(H.date_from),A.c)),dataIndex:String(H.date_from),hideInSearch:!0,width:100,align:"center",render:function(We,Se){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:H.id,attendance:Se["".concat(H==null?void 0:H.date_from)],studentId:Se.id})}}])},[])),Pe=$.data.users.reduce(function(re,H){var xe=H.id,We=H.academic_teacher_id,Se=H.first_name,Je=H.last_name,qe="".concat(Je," ").concat(Se);if(We!==null||!qe.toLowerCase().includes(se.toLowerCase()))return re;var ue=F.data.reduce(function(Y,X){var q=X.attendances.find(function(fe){return fe.user_id===xe});return q?Object(b.a)(Object(b.a)({},Y),{},Object(ae.a)({},"".concat(X.date_from),q.value)):Y},{});return[].concat(Object($e.a)(re),[Object(b.a)({id:xe,full_name:qe},ue)])},[]).sort(function(re,H){return re.full_name.localeCompare(H.full_name)}),ee.abrupt("return",{data:Pe,total:Pe.length,success:!0});case 17:case"end":return ee.stop()}},O)}));return function(O){return x.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{defaultPageSize:ne.a,onChange:function(){var O;return(O=v.current)===null||O===void 0?void 0:O.reload()}},scroll:{x:1500},actionRef:v,rowKey:"id"})},wr=i("tU7J"),Ye=i("wFql"),Rr=i("/zsF"),Tt=i("PArb"),Ia=i("Hn4i"),Fa=i("bRQS");function Et(u,n,a){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(N.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),Gt.apply(this,arguments)}function Da(u,n,a,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(N.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"POST",data:r},t||{})));case 1:case"end":return l.stop()}},u)})),Mt.apply(this,arguments)}function Kt(u,n){return It.apply(this,arguments)}function It(){return It=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(b.a)({method:"GET",params:{"groups[]":n},useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),It.apply(this,arguments)}function $a(u,n,a){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(N.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(a),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),Ft.apply(this,arguments)}function Wt(u){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(N.a)(Object(h.a)().mark(function u(n){return Object(h.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},u)})),Dt.apply(this,arguments)}function Vt(u,n){return $t.apply(this,arguments)}function $t(){return $t=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),$t.apply(this,arguments)}function kt(u,n){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(b.a)({method:"POST",data:n},a||{})));case 1:case"end":return t.stop()}},u)})),Pt.apply(this,arguments)}function zt(u,n,a){return At.apply(this,arguments)}function At(){return At=Object(N.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"PATCH",data:a},r||{})));case 1:case"end":return c.stop()}},u)})),At.apply(this,arguments)}function Ht(u,n){return wt.apply(this,arguments)}function wt(){return wt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),wt.apply(this,arguments)}var Pa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Aa=function(n){var a=n.subjectTutorGradeScale,r=n.onFormSubmit,t=Object(j.useState)([]),c=Object(M.a)(t,2),l=c[0],o=c[1],m=Object(j.useRef)(),S=w.a.useForm(),p=Object(M.a)(S,1),g=p[0];return Object(j.useEffect)(function(){var v,d=((v=a.scale)!==null&&v!==void 0?v:[]).map(function(f,x){return Object(b.a)(Object(b.a)({},f),{},{id:String((x+1)*100)})});g.setFieldValue("table",d)},[]),Object(e.jsx)(w.a,{form:g,onFinish:r,submitter:{render:function(d,f){var x=Object(M.a)(f,2),O=x[1];return[O]}},children:Object(e.jsx)(Ia.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Pa,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(d,f){return Object(e.jsx)(te.a,{type:"primary",onClick:function(){var O;return(O=m.current)===null||O===void 0?void 0:O.startEditable(f.id)},icon:Object(e.jsx)(nt.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:l,saveText:Object(e.jsx)(te.a,{type:"primary",icon:Object(e.jsx)(Fa.a,{})}),onChange:o,actionRender:function(d,f,x){return[x.save]}}})})},wa=function(){var n,a,r=Object(s.m)("@@initialState"),t=r.initialState,c=Object(Q.b)(),l=c.semester_subject_id,o=c.tutors,m=Object(j.useState)(),S=Object(M.a)(m,2),p=S[0],g=S[1],v=Object(j.useState)(!1),d=Object(M.a)(v,2),f=d[0],x=d[1],O=Object(j.useState)(null),E=Object(M.a)(O,2),T=E[0],_=E[1],B=Object(j.useMemo)(function(){return!!o.data.find(function(P){var $,F=P.id;return F===(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)})},[o.data,t==null||(n=t.currentUser)===null||n===void 0?void 0:n.id]),K=Object(j.useMemo)(function(){return o.data.map(function(P){var $=P.id,F=P.first_name,k=P.last_name;return{label:"".concat(F," ").concat(k),value:$}})},[o.data]),se=Object(j.useCallback)(function(){l===null||T===null||(x(!0),g(void 0),Et(l,T).then(function(P){P.success&&g(P.data)}).finally(function(){x(!1)}))},[l,T]),Me=Object(j.useCallback)(function(P,$){return function(){var F=Object(N.a)(Object(h.a)().mark(function k(Pe){var He,ee;return Object(h.a)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(l===null||T===null)){H.next=2;break}return H.abrupt("return");case 2:return He=P.reduce(function(xe,We){return We.s_subject_scale_form_id===$?[].concat(Object($e.a)(xe),[{s_subject_scale_form_id:$,scale:Pe.table.map(function(Se){var Je=Se.name,qe=Se.grade,ue=Se.grade_value;return{name:Je,grade:qe,grade_value:ue}})}]):[].concat(Object($e.a)(xe),[We])},[]),H.next=5,Da(l,T,{grade_scale:He});case 5:ee=H.sent,ee.success&&se();case 7:case"end":return H.stop()}},k)}));return function(k){return F.apply(this,arguments)}}()},[T,l]);return Object(j.useEffect)(function(){var P,$;if(!B||!(t!=null&&(P=t.currentUser)!==null&&P!==void 0&&P.id)){var F;if((F=o.data)!==null&&F!==void 0&&F[0]){var k;_((k=o.data)===null||k===void 0?void 0:k[0].id)}return}_(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,B]),Object(j.useEffect)(function(){se()},[se]),o.loading?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(w.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(vt.a,{disabled:B,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:K,value:T,onChange:function($){return _($)}})}),Object(e.jsx)(Tt.a,{}),f&&!p&&Object(e.jsx)(ve.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(P,$){var F;return Object(e.jsxs)(st.a.Fragment,{children:[$>0&&Object(e.jsx)(Tt.a,{}),Object(e.jsx)(Aa,{subjectTutorGradeScale:P,onFormSubmit:Me((F=p.grade_scale)!==null&&F!==void 0?F:[],P.s_subject_scale_form_id)})]},P.s_subject_scale_form_id)}):Object(e.jsx)(Ye.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Lr=i("qbNl"),Ra=i("JBPa"),Nr=i("Awhp"),La=i("KrTs"),Na=i("wd/R"),Qe=i.n(Na);function Ua(u,n){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(b.a)({params:n,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Rt.apply(this,arguments)}var Ur=i("5R/X"),Ba=function(){var n=Object(j.useState)(null),a=Object(M.a)(n,2),r=a[0],t=a[1],c=Object(j.useState)([]),l=Object(M.a)(c,2),o=l[0],m=l[1],S=Object(Q.b)(),p=S.semester_subject_id,g=Qe()(),v=Object(j.useMemo)(function(){return o.map(function(_){return{id:_.id,title:"".concat(_.group.name," (").concat(_.term_status.name,")"),start:Qe()(_.date_from).toDate(),end:Qe()(_.date_to).toDate(),tutor_name:"".concat(_.tutor.first_name," ").concat(_.tutor.last_name),tutor_email:_.tutor.email,semester:_.semester.name,group:_.group.name,subject:_.subject.name,ms_teams_join_url:_.ms_teams_join_url}})},[o]),d=Object(j.useCallback)(function(_,B){Ua({semester_subject_id:p,date_form:_.toDate(),date_to:B.toDate()}).then(function(K){K.success&&m(K.data)})},[p]),f=Object(j.useCallback)(function(_){t(_)},[]),x=Object(j.useCallback)(function(){t(null)},[]),O=Object(j.useCallback)(function(_){return _.isSame(g,"day")?"warning":_.isAfter(g,"day")?"success":"error"},[]),E=Object(j.useCallback)(function(_){var B=v.filter(function(K){return Qe()(K.start).isSame(_,"day")});return Object(e.jsx)("ul",{className:"events",children:B.map(function(K){return Object(e.jsx)("li",{onClick:function(){return f(K)},children:Object(e.jsx)(La.a,{status:O(Qe()(K.start)),text:K.title})},K.id)})})},[o]),T=Object(j.useCallback)(function(_,B){var K=Qe()(_).startOf(B).subtract(1,"month"),se=Qe()(_).endOf(B).add(1,"month");d(K,se)},[]);return Object(j.useEffect)(function(){var _=Qe()().startOf("month"),B=Qe()().endOf("month");d(_,B)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ra.a,{dateCellRender:E,onPanelChange:T}),Object(e.jsxs)(R.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:x,footer:null,children:[Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&Qe()(r.start).format(A.b)]}),Object(e.jsxs)(Ye.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&Qe()(r.end).format(A.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(Ye.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(te.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Jt=i("yj/a"),Yt=i("5Syx"),pt=i("PpiC"),Lt=i("H6aw"),Ka=i("p3I6"),Wa=["results"],Xt=function(n,a){return n.reduce(function(r,t){var c=t.results,l=Object(pt.a)(t,Wa),o=c.find(function(m){return m.user_id===a});return o?[].concat(Object($e.a)(r),[Object(b.a)(Object(b.a)({},l),{},{result:o})]):r},[])},Zt=function(n,a){var r,t=n.reduce(function(d,f){var x=f.result,O=f.weight;return[d[0]+x.result*O,d[1]+O]},[0,0]),c=Object(M.a)(t,2),l=c[0],o=c[1],m=Number.isNaN(l/o)?0:l/o,S=a.sort(function(d,f){return d.grade_value-f.grade_value}).reduce(function(d,f){return[].concat(Object($e.a)(d),[Object(b.a)(Object(b.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(S.every(function(d){var f=d.isWeightedAverageGreater;return f})){var p,g;return(p=(g=S.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var v=S.findIndex(function(d){var f=d.isWeightedAverageGreater;return!f});return v<0?"":(r=S[v-1])===null||r===void 0?void 0:r.name},Qt=function(n,a){var r;return(r=a.find(function(t){return t.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},Va=["attendances"];function ka(u){return function(a){u(function(r){return Object(b.a)(Object(b.a)({},r),{},{loading:a})})}}function qt(u,n){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(N.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n(!0),t.prev=1,t.abrupt("return",a());case 3:return t.prev=3,n(!1),t.finish(3);case 6:case"end":return t.stop()}},u,null,[[1,,3,6]])})),Nt.apply(this,arguments)}function za(u,n){var a=Object(j.useState)({loading:!1}),r=Object(M.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(ka(c),[]),o=Object(j.useCallback)(Object(N.a)(Object(h.a)().mark(function S(){var p;return Object(h.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,$a(u,n);case 2:if(p=v.sent,p.success){v.next=5;break}return v.abrupt("return",p);case 5:return c(function(d){return Object(b.a)(Object(b.a)({},d),{},{data:p.data})}),v.abrupt("return",p);case 7:case"end":return v.stop()}},S)})),[n,u]),m=Object(j.useCallback)(function(S){return qt(l,function(){return Ht(S).then(o)})},[o]);return Object(j.useEffect)(function(){qt(l,o)},[o]),{finalGrades:t,deleteFinalGrade:m}}function Ha(){var u=Object(j.useState)({loading:!1}),n=Object(M.a)(u,2),a=n[0],r=n[1];return Object(j.useEffect)(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!0})}),Wt().then(function(t){t.success&&r(function(c){return Object(b.a)(Object(b.a)({},c),{},{data:t.data})})}).finally(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function Ja(u){var n=Object(j.useState)({loading:!1}),a=Object(M.a)(n,2),r=a[0],t=a[1];return Object(j.useEffect)(function(){u!==void 0&&(t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!0})}),Vt(u).then(function(c){c.success&&t(function(l){return Object(b.a)(Object(b.a)({},l),{},{data:c.data})})}).finally(function(){t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!1})})}))},[u]),{subjectGradeScales:r}}function Ya(u,n,a){var r=Object(j.useState)({loading:!1}),t=Object(M.a)(r,2),c=t[0],l=t[1];return Object(j.useEffect)(function(){typeof u!="number"||typeof n!="number"||typeof a!="number"||(l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),Et(u,n).then(function(o){o.success&&l(function(m){var S,p;return Object(b.a)(Object(b.a)({},m),{},{data:(S=Qt(a,(p=o.data.grade_scale)!==null&&p!==void 0?p:[]))===null||S===void 0?void 0:S.map(function(g,v){return Object(b.a)(Object(b.a)({},g),{},{id:v})})})})}).finally(function(){l(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})}))},[u,n]),{tutorGradeScales:c}}function Xa(u,n){var a=Object(j.useState)({loading:!1}),r=Object(M.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!0})}),St(u).then(function(o){if(o.success){var m=o.data.reduce(function(S,p){var g=p.attendances,v=Object(pt.a)(p,Va),d=g.find(function(f){return f.user_id===n});return d?[].concat(Object($e.a)(S),[Object(b.a)(Object(b.a)({},v),{},{attendance:d})]):S},[]);c(function(S){return Object(b.a)(Object(b.a)({},S),{},{data:m})})}}).finally(function(){c(function(o){return Object(b.a)(Object(b.a)({},o),{},{loading:!1})})})},[u,n]);return Object(j.useEffect)(function(){l()},[l]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:l}}function Za(u,n){var a=Object(j.useState)({loading:!1}),r=Object(M.a)(a,2),t=r[0],c=r[1];return Object(j.useEffect)(function(){!n||(c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!0})}),G({student_id:u,semester_subject_id:n}).then(function(l){if(l.success){var o=Xt(l.data,u);c(function(m){return Object(b.a)(Object(b.a)({},m),{},{data:o})})}}).finally(function(){c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!1})})}))},[u,n]),{studentExams:t}}function Qa(u,n){var a=Object(j.useState)({loading:!1}),r=Object(M.a)(a,2),t=r[0],c=r[1],l=Object(j.useState)({loading:!1}),o=Object(M.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)({loading:!1}),g=Object(M.a)(p,2),v=g[0],d=g[1];return Object(j.useEffect)(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Object(Lt.e)({group_id:u}).then(function(f){f.success&&c(function(x){return Object(b.a)(Object(b.a)({},x),{},{data:f.data})})}).finally(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})})},[u]),Object(j.useEffect)(function(){!t.data||(d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Lt.n)(Number(x))})).then(function(f){f.forEach(function(x){x.success&&d(function(O){return Object(b.a)(Object(b.a)({},O),{},{data:Object(b.a)(Object(b.a)({},O.data),{},Object(ae.a)({},Number(x.data.id),Object(Ka.c)(x.data.lessons)))})})})}).finally(function(){d(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}),S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Lt.l)(Number(x),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(O){if(O.success){var E,T,_=((E=O.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&E!==void 0?E:[]).filter(function(K){return K.id===n}),B=(T=O.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&T!==void 0?T:[];S(function(K){return Object(b.a)(Object(b.a)({},K),{},{data:Object(b.a)(Object(b.a)({},K.data),{},Object(ae.a)({},Number(x),{finishedTopics:_,attendanceList:B}))})})}})})).finally(function(){return S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}))},[t.data,n]),{userCourses:t,userCoursesStats:m,userCoursesTopics:v}}var qa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],er=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(n,a){return Object(Ue.a)(new Date(a.date_from),A.c)}}],tr=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,a){return Object(Ue.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(n,a){return"".concat(a.result.result,"%")}}],ar=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=a.grade)!==null&&r!==void 0&&r.grade_date?Object(Ue.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),A.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&r!==void 0?r:"-"}}],ht=6,rr=function(n){var a,r,t,c,l=n.user_id,o=n.group_id,m=Object(Q.b)(),S=m.semester_subject_id,p=Za(l,S),g=p.studentExams,v=za(o,l),d=v.finalGrades,f=v.deleteFinalGrade,x=Ha(),O=x.gradeTerms,E=Ja((a=d.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),T=E.subjectGradeScales,_=Ya(S,(r=d.data)===null||r===void 0?void 0:r.tutor_id,(t=d.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),B=_.tutorGradeScales,K=Xa(o,l),se=K.userAttendanceSchedules,Me=K.fetchUserAttendanceSchedules,P=Qa(o,l),$=P.userCourses,F=P.userCoursesStats,k=P.userCoursesTopics,Pe=w.a.useForm(),He=Object(M.a)(Pe,1),ee=He[0],re=Object(j.useMemo)(function(){var Y;return((Y=O.data)!==null&&Y!==void 0?Y:[]).map(function(X){var q=X.id,fe=X.name;return{label:fe,value:q}})},[O.data]),H=Object(j.useMemo)(function(){var Y;return((Y=T.data)!==null&&Y!==void 0?Y:[]).map(function(X){var q=X.name,fe=X.id;return{label:q,value:fe}})},[T.data]),xe=Object(j.useMemo)(function(){var Y,X;return Zt((Y=g.data)!==null&&Y!==void 0?Y:[],(X=B.data)!==null&&X!==void 0?X:[])},[g.data,B.data]),We=Object(j.useCallback)(function(){var Y=Object(N.a)(Object(h.a)().mark(function X(q){var fe,Ve,rt,Oe,ke,Ie,ze;return Object(h.a)().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:if(rt=q.grade_scale_id,Oe=q.grade_term_id,((fe=d.data)===null||fe===void 0?void 0:fe.id)!==void 0){Le.next=3;break}return Le.abrupt("return");case 3:if(ke=(Ve=d.data)===null||Ve===void 0?void 0:Ve.grades.find(function(ot){var Ut=ot.grade_term;return Ut.id===Oe}),!ke){Le.next=11;break}return Le.next=7,zt(ke.id,{grade_scale_id:rt});case 7:return Ie=Le.sent,dt.b[Ie.success?"success":"error"](Ie.message),Ie.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades")),Le.abrupt("return");case 11:return Le.next=13,kt({grade_scale_id:rt,grade_term_id:Oe,lesson_group_user_id:d.data.id});case 13:ze=Le.sent,dt.b[ze.success?"success":"error"](ze.message),ze.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades"));case 16:case"end":return Le.stop()}},X)}));return function(X){return Y.apply(this,arguments)}}(),[d.data,S]),Se=Object(j.useMemo)(function(){return[].concat(ar,[{title:Object(e.jsx)(s.a,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(X,q){var fe;return typeof(q==null||(fe=q.grade)===null||fe===void 0?void 0:fe.id)=="number"?[Object(e.jsx)(ut.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return f(q.grade.id)},okText:Object(e.jsx)(s.a,{id:"yes",defaultMessage:"Yes"}),cancelText:Object(e.jsx)(s.a,{id:"no",defaultMessage:"No"}),children:Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(te.a,{type:"primary",icon:Object(e.jsx)(ie.a,{}),danger:!0})})},"delete")]:[]}}])},[]),Je=Object(j.useMemo)(function(){var Y;return((Y=O.data)!==null&&Y!==void 0?Y:[]).map(function(X){var q;return Object(b.a)(Object(b.a)({},X),{},{grade:(q=d.data)===null||q===void 0?void 0:q.grades.find(function(fe){var Ve=fe.grade_term;return Ve.id===X.id})})})},[d.data,O.data]),qe=$.loading&&!$.data||F.loading&&!F.data||k.loading&&!k.data,ue=Boolean($.data&&F.data&&k.data);return d.loading?Object(e.jsx)(ve.a,{}):Object(e.jsxs)(e.Fragment,{children:[d.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Ye.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:d.data.user})}),Object(e.jsx)(Tt.a,{})]}),Object(e.jsxs)(be.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:ht},dataSource:g.data,loading:g.loading,columns:tr,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:ht},dataSource:Je,loading:d.loading||O.loading,columns:Se,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:ht},cardProps:{bodyStyle:{padding:0}},dataSource:se.data,loading:se.loading,columns:[].concat(er,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(X,q){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:q.id,studentId:l,attendance:q.attendance.value,onSuccess:Me})}}])})}),Object(e.jsx)(Z.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:ht},cardProps:{bodyStyle:{padding:0}},dataSource:B.data,loading:B.loading,columns:qa})}),qe&&Object(e.jsx)(ve.a,{}),ue&&((c=$.data)===null||c===void 0?void 0:c.map(function(Y){var X,q,fe,Ve,rt,Oe,ke,Ie,ze=Y.id,lt=Y.title;return Object(e.jsxs)(Z.a,{span:24,children:[Object(e.jsx)(Ye.a.Text,{style:{fontSize:"16px",fontWeight:500},children:lt}),Object(e.jsx)(Yt.c,{course_id:Number(ze),topics:(X=(q=k.data)===null||q===void 0?void 0:q[Number(ze)])!==null&&X!==void 0?X:[],stats:(fe=(Ve=F.data)===null||Ve===void 0||(rt=Ve[Number(ze)])===null||rt===void 0?void 0:rt.finishedTopics)!==null&&fe!==void 0?fe:[]}),Object(e.jsx)(Yt.a,{stats:(Oe=(ke=F.data)===null||ke===void 0||(Ie=ke[Number(ze)])===null||Ie===void 0?void 0:Ie.attendanceList)!==null&&Oe!==void 0?Oe:[]})]},ze)}))]}),Object(e.jsx)(w.a,{form:ee,onFinish:We,children:Object(e.jsxs)(w.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Jt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:re,width:"sm",fieldProps:{loading:O.loading}}),Object(e.jsx)(Jt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:H,fieldProps:{loading:d.loading||T.loading}}),Object(e.jsx)(w.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:xe}})})]})})]})},nr=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(r){var t=r.grade_name,c=r.grade_term,l=r.id;return Object(e.jsxs)(Ye.a.Text,{children:[c.name,": ",t]},l)}):"-"})}}],sr=function(){var n,a,r=Object(ce.k)(),t=Object(j.useMemo)(function(){var g,v,d,f;return{user_id:Number.isNaN(Number((g=r.query)===null||g===void 0?void 0:g.user_id))?null:Number((v=r.query)===null||v===void 0?void 0:v.user_id),group_id:Number.isNaN(Number((d=r.query)===null||d===void 0?void 0:d.group_id))?null:Number((f=r.query)===null||f===void 0?void 0:f.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(a=r.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,l=t.group_id,o=Object(Q.b)(),m=o.teacherSubjectData,S=o.semester_subject_id,p=Object(j.useMemo)(function(){var g;return((g=m==null?void 0:m.groups)!==null&&g!==void 0?g:[]).map(function(v){var d=v.id,f=v.name;return{label:f,value:d}})},[m==null?void 0:m.groups]);return c!==null&&l!==null?Object(e.jsx)(rr,{user_id:c,group_id:l}):Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:ne.a},request:function(){var g=Object(N.a)(Object(h.a)().mark(function v(d){var f,x,O,E,T,_,B,K,se,Me;return Object(h.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return x=d.group_id,O=x===void 0?[]:x,E=d.first_name,T=E===void 0?"":E,_=d.last_name,B=_===void 0?"":_,K=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function(F){var k=F.id;return k}),$.next=4,Kt(O.length===0?K:O);case 4:if(se=$.sent,se.success){$.next=7;break}return $.abrupt("return",{success:!1,total:0,data:[]});case 7:return Me=se.data.filter(function(F){var k=F.user;return k.first_name.toLowerCase().includes(T.toLowerCase())&&k.last_name.toLowerCase().includes(B.toLowerCase())}),$.abrupt("return",{success:!0,total:Me.length,data:Me});case 9:case"end":return $.stop()}},v)}));return function(v){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(v,d){return Object(e.jsx)(de.a,{type:"Students",type_id:d.group_id},d.group_id)}}].concat(nr,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(v,d){return[Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(S,"/final-grades?user_id=").concat(d.user.id,"&group_id=").concat(d.group_id),children:Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(te.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit")]}}])})},ur=i("dF/Y"),cr=i("o+0V"),ea=i("0WSk"),ir=["type","defaultRender"],dr=["type","defaultRender"],lr=function(n){var a=n.url;return Object(e.jsx)(Ne.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(te.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(ur.a,{})})})},or=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,a){return Object(Ue.a)(new Date(a.created_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(pt.a)(a,ir);if(t==="form")return null;var o=r.getFieldValue("state");return Object(e.jsx)(ea.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(n,a){var r,t;return Object(e.jsx)(de.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id,text:a!=null&&(r=a.created_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.created_by)!==null&&t!==void 0&&t.last_name?"".concat(a.created_by.first_name," ").concat(a.created_by.last_name):void 0},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,a){return Object(Ue.a)(new Date(a.exported_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(pt.a)(a,dr);if(t==="form")return null;var o=r.getFieldValue("state");return Object(e.jsx)(ea.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:o}}))},render:function(n,a){var r,t;return Object(e.jsx)(de.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id,text:a!=null&&(r=a.exported_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.exported_by)!==null&&t!==void 0&&t.last_name?"".concat(a.exported_by.first_name," ").concat(a.exported_by.last_name):void 0},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(n,a){return[Object(e.jsx)(lr,{url:a.url},"download")]}}],jr=function(){var n,a,r=Object(Q.b)(),t=r.teacherSubjectData,c=Object(j.useMemo)(function(){var o;return((o=t==null?void 0:t.groups)!==null&&o!==void 0?o:[]).map(function(m){var S=m.id,p=m.name;return{value:S,label:p}})},[t==null?void 0:t.groups]),l=Object(j.useMemo)(function(){var o,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(o=t.groups)===null||o===void 0||(m=o[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(or)},[t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var o=Object(N.a)(Object(h.a)().mark(function m(S){var p,g,v,d,f,x,O;return Object(h.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return v=S.group_id,d=v===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:v,f=S.created_by,x=S.exported_by,T.next=3,Object(cr.a)({group_id:d,created_by:f,exported_by:x});case 3:if(O=T.sent,O.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:O.data,total:O.data.length});case 7:case"end":return T.stop()}},m)}));return function(m){return o.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:ne.a}})},br=function(n,a){var r;return(r=n.find(function(t){return t.name===a}))===null||r===void 0?void 0:r.id},mr=function(n){var a=n.term,r=n.gradeScales,t=n.defaultFinalGrade,c=n.finalGrades,l=Object(j.useState)(t),o=Object(M.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(!1),g=Object(M.a)(p,2),v=g[0],d=g[1],f=Object(j.useMemo)(function(){return r.map(function(O){var E=O.name,T=O.id;return{value:T,label:E}})},[r]),x=Object(j.useCallback)(function(O){if(!!(c!=null&&c.id)){if(O===void 0){if(!m)return;d(!0),Ht(m.id).then(function(E){!E.success||S(void 0)}).finally(function(){return d(!1)});return}if(m){d(!0),zt(m.id,{grade_scale_id:O}).finally(function(){return d(!1)});return}d(!0),kt({grade_term_id:a.id,grade_scale_id:O,lesson_group_user_id:c.id}).then(function(E){if(E.success){var T=E.data.grades.find(function(_){return _.grade_term.id===a.id});S(T)}}).finally(function(){return d(!1)})}},[m,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(vt.a,{allowClear:!0,loading:v,disabled:v,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:x,options:f,defaultValue:br(r,t==null?void 0:t.grade_name)}):null},fr=i("LvDl"),vr=function(n){var a=n.exam_id,r=n.result,t=n.student_id,c=n.onSuccess,l=Object(j.useCallback)(Object(fr.debounce)(function(o){Te(a,t,{result:o!=null?o:0}).then(function(m){m.success&&(c==null||c(m.data))})},300),[a,r,t]);return Object(e.jsx)(Ke.a,{type:"number",min:0,max:100,onChange:l,defaultValue:r})},Or=function(n){var a=n.reduce(function(r,t){return[].concat(Object($e.a)(r),[{title:Object(Ue.a)(new Date(t.date_from),A.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(l,o){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:t.id,attendance:o["attendance-".concat(t==null?void 0:t.date_from)],studentId:o.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},pr=function(n,a){return n.reduce(function(r,t){var c=t.attendances.find(function(l){return l.user_id===a});return c?Object(b.a)(Object(b.a)({},r),{},Object(ae.a)({},"attendance-".concat(t.date_from),c.value)):r},{})},hr=function(n){var a=n.reduce(function(r,t){return[].concat(Object($e.a)(r),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(l,o){var m;return(o==null||(m=o["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(vr,{result:o==null?void 0:o["exam-".concat(t.id)].result,exam_id:t.id,student_id:o.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},gr=function(n){return n.reduce(function(a,r){var t=r.result,c=r.id;return Object(b.a)(Object(b.a)({},a),{},Object(ae.a)({},"exam-".concat(c),t))},{})},xr=function(n,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(c,l){return Object(e.jsx)(mr,{defaultFinalGrade:l["final-grade-".concat(r.id)],finalGrades:l.final_grades,term:r,gradeScales:a})}}})}},Sr=function(n,a){return n.find(function(r){return r.user.id===a})},yr=function(n){var a;return((a=n==null?void 0:n.grades)!==null&&a!==void 0?a:[]).reduce(function(r,t){return Object(b.a)(Object(b.a)({},r),{},Object(ae.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},_r=function(){var n,a,r=Object(Q.b)(),t=r.teacherSubjectData,c=r.semester_subject_id,l=Object(j.useState)([]),o=Object(M.a)(l,2),m=o[0],S=o[1],p=Object(j.useState)(t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.name),g=Object(M.a)(p,2),v=g[0],d=g[1],f=Object(s.l)(),x=Object(j.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(_){var B=_.id,K=_.name;return{value:B,label:K}})},[t==null?void 0:t.groups]),O=Object(j.useRef)(),E=Object(j.useMemo)(function(){var T;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:x,defaultValue:x==null||(T=x[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object($e.a)(m))},[x,m]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var T=Object(N.a)(Object(h.a)().mark(function _(B){var K,se,Me,P,$,F,k,Pe,He,ee,re,H,xe,We,Se,Je,qe,ue,Y,X,q,fe,Ve;return Object(h.a)().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return F=B.group_id,k=F===void 0?(K=x[0])===null||K===void 0?void 0:K.value:F,Pe=B.full_name,He=Pe===void 0?"":Pe,Oe.next=3,Kt(k);case 3:if(ee=Oe.sent,re=x.find(function(ke){var Ie=ke.value;return Ie===k}),!(!ee.success||ee.data[0]===void 0||c===null)){Oe.next=8;break}return dt.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:re==null?void 0:re.label})),Oe.abrupt("return",{data:[],total:0,success:!1});case 8:return Oe.next=10,Promise.all([Object(gt.b)(k),St(k),G({group_id:k,per_page:-1}),Et(c,(se=ee.data)===null||se===void 0||(Me=se[0])===null||Me===void 0?void 0:Me.tutor_id),Wt(),Vt((P=ee.data)===null||P===void 0||($=P[0])===null||$===void 0?void 0:$.s_subject_scale_form_id)]);case 10:if(H=Oe.sent,xe=Object(M.a)(H,6),We=xe[0],Se=xe[1],Je=xe[2],qe=xe[3],ue=xe[4],Y=xe[5],!(!We.success||!Se.success||!Je.success||!qe.success||!ue.success||!Y.success||!re)){Oe.next=21;break}return dt.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:re==null?void 0:re.label})),Oe.abrupt("return",{data:[],total:0,success:!1});case 21:return d(re.label),X=Or(Se.data),q=hr(Je.data),fe=xr(ue.data,Y.data),S([X,q,fe,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Ve=We.data.users.reduce(function(ke,Ie){var ze,lt,Le,ot=Ie.id,Ut=Ie.academic_teacher_id,Tr=Ie.first_name,Er=Ie.last_name,ta="".concat(Er," ").concat(Tr);if(Ut!==null||!ta.toLowerCase().includes(He.toLowerCase()))return ke;var Gr=pr(Se.data,ot),aa=Xt(Je.data,ot),bt=Sr(ee.data,ot),Mr=(ze=Qt((lt=bt==null?void 0:bt.s_subject_scale_form_id)!==null&&lt!==void 0?lt:0,(Le=qe.data.grade_scale)!==null&&Le!==void 0?Le:[]))!==null&&ze!==void 0?ze:[],Ir=Zt(aa,Mr),Fr=gr(aa),Dr=yr(bt);return[].concat(Object($e.a)(ke),[Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({id:ot,full_name:ta},Gr),Fr),Dr),{},{proposed_grade:Ir,final_grades:bt})])},[]).sort(function(ke,Ie){return ke.full_name.localeCompare(Ie.full_name)}),Oe.abrupt("return",{data:Ve,total:Ve.length,success:!0});case 28:case"end":return Oe.stop()}},_)}));return function(_){return T.apply(this,arguments)}}(),columns:E,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:v}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:O,pagination:{defaultPageSize:ne.a,onChange:function(){var _;return(_=O.current)===null||_===void 0?void 0:_.reload()}},rowKey:"id"})},Cr=function(n){var a,r,t=n.tab,c=Object(s.l)(),l=Object(s.m)("@@initialState"),o=l.setInitialState,m=l.initialState,S=Object(Q.b)(),p=S.teacherSubjectData,g=S.semester_subject_id,v=S.tutors,d=Object(j.useCallback)(Object(Ee.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(j.useMemo)(function(){return!!v.data.find(function(x){var O,E=x.id;return E===(m==null||(O=m.currentUser)===null||O===void 0?void 0:O.id)})||d(Xe.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(pe.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(et.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(te.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(g),breadcrumbName:String((r=p.subject)===null||r===void 0?void 0:r.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(le.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(O){o(Object(b.a)({},m)),s.f.push("/teacher/subjects/".concat(g,"/").concat(O))}},children:[Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(ye.a,{})},"groups"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(_a,{})},"students"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(Oa,{})},"exams"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ba,{})},"schedule"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(_r,{})},"class-register"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(Ma,{})},"attendance"),f&&Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(wa,{})},"grades-scale"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(sr,{})},"final-grades"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(jr,{})},"file-exports-history")]})}):Object(e.jsx)(ve.a,{})},Br=Ae.default=function(){var u=Object(ce.l)(),n=u.subjectId,a=u.tab,r=a===void 0?"groups":a;return Object(e.jsx)(Q.a,{semester_subject_id:Number(n),children:Object(e.jsx)(Cr,{tab:r})})}},p3I6:function(mt,Ae,i){"use strict";i.d(Ae,"b",function(){return Ee}),i.d(Ae,"c",function(){return we}),i.d(Ae,"a",function(){return ct});var b=i("miYZ"),Fe=i("tsqr"),te=i("tJVT"),I=i("k1fw"),ve=i("oBTY"),j=i("q1tI"),st=i.n(j),s=i("9kvl"),et=i("Ty5D"),ce=i("H6aw"),le=i("/y+f"),pe=i("nKUr"),Xe=i.n(pe),Ee=st.a.createContext({}),Q=function(){return Math.round(Math.random()*99999)},ye=function ie(W){return W.reduce(function(A,G){return[].concat(Object(ve.a)(A),Object(ve.a)(G.lessons?ie(G.lessons):[]),[G])},[])},we=function ie(W){return W.reduce(function(A,G){var z;return[].concat(Object(ve.a)(A),Object(ve.a)(G.lessons?ie(G.lessons):[]),Object(ve.a)((z=G.topics)!==null&&z!==void 0?z:[]))},[])},ut=function ie(W,A,G){return W.map(function(z){var _e,y;return Object(I.a)(Object(I.a)({},z),{},{lessons:z.lessons?ie(z.lessons,A,G):[],topics:z.id===A?[].concat(Object(ve.a)((_e=z.topics)!==null&&_e!==void 0?_e:[]),[G]):(y=z.topics)!==null&&y!==void 0?y:[]})})},ft=function ie(W,A,G){return G?W.map(function(z){return Object(I.a)(Object(I.a)({},z),{},{lessons:[].concat(Object(ve.a)(z.lessons?ie(z.lessons,A,G):[]),Object(ve.a)(z.id===G?[A]:[]))})}):[].concat(Object(ve.a)(W),[A])},Ne=function ie(W,A,G){return W.map(function(z){return Object(I.a)(Object(I.a)({},z.id===A?G:z),{},{lessons:z.lessons?ie(z.lessons,A,G):[]})})},h=function ie(W,A){return W.map(function(G){return Object(I.a)(Object(I.a)({},G),{},{parent_id:A,lessons:G.lessons?ie(G.lessons,G.id):[]})})},N=function ie(W,A){return W.filter(function(G){return G.id!==A}).map(function(G){return Object(I.a)(Object(I.a)({},G),{},{lessons:G.lessons?ie(G.lessons,A):[]})})},Ue=function ie(W,A){return W.map(function(G){return Object(I.a)(Object(I.a)({},G),{},{lessons:G.lessons?ie(G.lessons,A):[],topics:G.topics?G.topics.filter(function(z){return z.id!==A}):[]})})},nt=function ie(W,A,G,z){return z==null?void 0:z.map(function(_e){if(_e.id===G){var y;return Object(I.a)(Object(I.a)({},_e),{},{topics:(y=_e.topics)===null||y===void 0?void 0:y.map(function(Ce){return Ce.id===W?A.file.response.data:Ce})})}else if(_e.lessons)return Object(I.a)(Object(I.a)({},_e),{},{lessons:ie(W,A,G,_e.lessons||[])});return _e})},ct=function(W){var A=W.children,G=W.id,z=Object(j.useState)(),_e=Object(te.a)(z,2),y=_e[0],Ce=_e[1],at=Object(s.l)(),tt=Object(j.useMemo)(function(){return y&&y.lessons?we(y.lessons):[]},[y]),Be=Object(j.useMemo)(function(){return y&&y.lessons?ye(y.lessons):[]},[y]),jt=Object(j.useState)([]),Ze=Object(te.a)(jt,2),Te=Ze[0],Ge=Ze[1],oe=Object(et.k)();Object(j.useEffect)(function(){Ge([])},[]);var je=Object(j.useCallback)(function(){Object(ce.n)(G).then(function(C){return C.success&&Ce(Object(I.a)(Object(I.a)({},C.data),{},{lessons:h(C.data.lessons)}))})},[G]);Object(j.useEffect)(function(){je()},[je]);var de=Object(j.useCallback)(function(C){var V=Be.find(function(R){var L;return R==null||(L=R.topics)===null||L===void 0?void 0:L.find(function(U){return U.id===C})});return V?V.id:null},[Be]),ne=Object(j.useMemo)(function(){var C,V;return(C=oe.query)!==null&&C!==void 0&&C.lesson?{mode:"lesson",id:Number(oe.query.lesson),value:Be.find(function(R){return R.id===Number(oe.query.lesson)})}:(V=oe.query)!==null&&V!==void 0&&V.topic?{mode:"topic",id:Number(oe.query.topic),value:tt.find(function(R){return R.id===Number(oe.query.topic)})}:{mode:"init"}},[oe.query,y,Be,tt]),he=Object(j.useCallback)(function(C){var V={course_id:G,topics:[],isNew:!0,id:y?y.lessons.length+1:Q(),order:0,title:at.formatMessage({id:"add_title_here"}),active:!0,parent_id:C};return Ce(function(R){var L;return Object(I.a)(Object(I.a)({},R),{},{lessons:ft((L=R==null?void 0:R.lessons)!==null&&L!==void 0?L:[],V,C)})}),V},[G,y]),Ke=Object(j.useCallback)(function(C,V){var R=Be.find(function(U){return U.id===C}),L=R&&R.isNew;return(L?Object(ce.g)(V):Object(ce.v)(C,V)).then(function(U){return Fe.b.success(U.message),je(),U.success&&Ce(function(J){var ge;return Object(I.a)(Object(I.a)({},J),{},{lessons:Ne((ge=J==null?void 0:J.lessons)!==null&&ge!==void 0?ge:[],C,Object(I.a)(Object(I.a)({},U.data),{},{isNew:!1}))})})})},[y]),M=Object(j.useCallback)(function(C){var V=Be.find(function(L){return L.id===C});if(!!V){var R=V.isNew;R?Ce(function(L){var U;return Object(I.a)(Object(I.a)({},L),{},{lessons:N((U=L==null?void 0:L.lessons)!==null&&U!==void 0?U:[],C)})}):Object(ce.p)(C).then(function(L){L.success&&(Fe.b.success(L.message),Ce(function(U){var J;return Object(I.a)(Object(I.a)({},U),{},{lessons:N((J=U==null?void 0:U.lessons)!==null&&J!==void 0?J:[],C)})}))})}},[y]),De=Object(j.useCallback)(function(C,V){var R,L=de(C),U=Be.find(function(ae){return ae.id===L}),J=U&&((R=U.topics)===null||R===void 0?void 0:R.find(function(ae){return ae.id===C})),ge=J==null?void 0:J.isNew;return(ge?Object(ce.h)(V):Object(ce.w)(C,V)).then(function(ae){ae.success&&(Fe.b.success(ae.message),je(),s.f.push("/courses/list/".concat(G,"/program/?topic=").concat(ae.data.id)),(J==null?void 0:J.topicable_type)===le.k.Video&&setTimeout(function(){je()},5e3))})},[de,y,je]),be=Object(j.useCallback)(function(C){var V=de(C),R=Be.find(function(J){return J.id===V});if(!!R){var L=tt==null?void 0:tt.find(function(J){return J.id===C}),U=L==null?void 0:L.isNew;U&&!L.topicable?Ce(function(J){var ge;return Object(I.a)(Object(I.a)({},J),{},{lessons:Ue((ge=J==null?void 0:J.lessons)!==null&&ge!==void 0?ge:[],C)})}):Object(ce.q)(C).then(function(J){J.success&&(Fe.b.success(J.message),Ce(function(ge){var ae;return Object(I.a)(Object(I.a)({},ge),{},{lessons:Ue((ae=ge==null?void 0:ge.lessons)!==null&&ae!==void 0?ae:[],C)})}))})}},[y,de]),me=Object(j.useCallback)(function(C,V){var R={lesson_id:C,isNew:!0,id:Q(),title:at.formatMessage({id:"add_title_here"}),active:!0,topicable_type:V};return Ce(function(L){var U;return Object(I.a)(Object(I.a)({},L),{},{lessons:ut((U=L==null?void 0:L.lessons)!==null&&U!==void 0?U:[],C,R)})}),R},[]),Z=function(V,R){var L=de(V);Ce(function(U){return Object(I.a)(Object(I.a)({},U),{},{lessons:U?nt(V,R,L,U.lessons||[]):[]})}),s.f.push("/courses/list/".concat(G,"/program/?topic=").concat(R.file.response.data.id))},w=Object(j.useCallback)(function(C){return Object(ce.d)(C).then(function(V){if(V.success){Fe.b.success(V.message);var R=de(C);Ce(function(L){var U;return Object(I.a)(Object(I.a)({},L),{},{lessons:L?(U=L.lessons)===null||U===void 0?void 0:U.map(function(J){if(J.id===R){var ge=J.topics||[];return Object(I.a)(Object(I.a)({},J),{},{topics:[].concat(Object(ve.a)(ge),[V.data])})}return J}):[]})})}})},[y,de]),D=Object(j.useCallback)(function(C){return Object(ce.c)(C).then(function(V){V.success&&(Fe.b.success(V.message),Ce(function(R){return Object(I.a)(Object(I.a)({},R),{},{lessons:R?[].concat(Object(ve.a)(R.lessons),[V.data]):[]})}))})},[]),Re={state:y,h5ps:Te,id:G,addNewLesson:he,updateLesson:Ke,updateTopic:De,deleteLesson:M,addNewTopic:me,deleteTopic:be,onTopicUploaded:Z,cloneTopic:w,cloneLesson:D,currentEditMode:ne,getLessons:je};return Object(pe.jsx)(Ee.Provider,{value:Re,children:A})}},"w/VK":function(mt,Ae,i){"use strict";i.d(Ae,"c",function(){return ve}),i.d(Ae,"a",function(){return st}),i.d(Ae,"b",function(){return et});var b=i("qLMh"),Fe=i("k1fw"),te=i("9og8"),I=i("9kvl");function ve(le,pe){return j.apply(this,arguments)}function j(){return j=Object(te.a)(Object(b.a)().mark(function le(pe,Xe){return Object(b.a)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.abrupt("return",Object(I.i)("/api/admin/reports/report",Object(Fe.a)({params:pe,method:"GET",useCache:!1},Xe||{})));case 1:case"end":return Q.stop()}},le)})),j.apply(this,arguments)}function st(le,pe,Xe){return s.apply(this,arguments)}function s(){return s=Object(te.a)(Object(b.a)().mark(function le(pe,Xe,Ee){return Object(b.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",Object(I.i)("/api/admin/stats/course/".concat(pe,"/export"),Object(Fe.a)({params:Xe,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return ye.stop()}},le)})),s.apply(this,arguments)}function et(le,pe,Xe){return ce.apply(this,arguments)}function ce(){return ce=Object(te.a)(Object(b.a)().mark(function le(pe,Xe,Ee){return Object(b.a)().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",Object(I.i)("/api/admin/stats/topic/".concat(pe,"/export"),Object(Fe.a)({method:"GET",useCache:!1,params:{stat:Xe},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return ye.stop()}},le)})),ce.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.610b3359.async.js.map