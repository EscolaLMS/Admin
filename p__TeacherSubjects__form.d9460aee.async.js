(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"/y+f":function(Ot,me,s){"use strict";s.d(me,"f",function(){return d}),s.d(me,"d",function(){return M}),s.d(me,"e",function(){return se}),s.d(me,"c",function(){return Qe}),s.d(me,"a",function(){return u}),s.d(me,"b",function(){return Te});var d;(function(v){v.Unselected="",v.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",v.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",v.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",v.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",v.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",v.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",v.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",v.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",v.Project="EscolaLms\\TopicTypeProject\\Models\\Project",v.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(d||(d={}));var _e;(function(v){v.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",v.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(_e||(_e={}));var je;(function(v){v.draft="draft",v.published="published",v.archived="archived"})(je||(je={}));var M;(function(v){v.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",v.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",v.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(M||(M={}));var se;(function(v){v.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(se||(se={}));var o;(function(v){v.cart_fixed="cart_fixed",v.cart_percent="cart_percent",v.product_fixed="product_fixed",v.product_percent="product_percent"})(o||(o={}));var Qe;(function(v){v.MULTIPLE_CHOICE="multiple_choice",v.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",v.TRUE_FALSE="true_false",v.SHORT_ANSWERS="short_answers",v.MATCHING="matching",v.NUMERICAL_QUESTION="numerical_question",v.ESSAY="essay",v.DESCRIPTION="description"})(Qe||(Qe={}));var u;(function(v){v.PRESENT="present",v.ABSENT="absent"})(u||(u={}));var Te;(function(v){v.Manual="manual",v.TeamsForms="teams_forms",v.TeamsLecture="teams_lecture",v.TestPortal="test_portal"})(Te||(Te={}))},"5R/X":function(Ot,me,s){},"5Syx":function(Ot,me,s){"use strict";s.d(me,"c",function(){return U}),s.d(me,"b",function(){return m}),s.d(me,"a",function(){return Ve});var d=s("OaEy"),_e=s("2fM7"),je=s("g9YV"),M=s("wCAj"),se=s("14J3"),o=s("BMrR"),Qe=s("BoS7"),u=s("Sdc0"),Te=s("jrin"),v=s("k1fw"),K=s("DYRE"),$e=s("zeV3"),Oe=s("+BJd"),ce=s("mr32"),he=s("oBTY"),rt=s("tJVT"),we=s("q1tI"),jt=s.n(we),vt=s("nhC9"),ke=s("LDJE"),S=s("9kvl"),W=s("Vpfc"),He=s("+L6B"),We=s("2/Rp"),it=s("qLMh"),pe=s("9og8"),de=s("4KAj"),k=s("w/VK"),O=s("nKUr"),J=function(le){var De=le.course_id,Me=le.stat,Ge=Me===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Me,ge=Object(we.useState)(!1),ee=Object(rt.a)(ge,2),ye=ee[0],xe=ee[1],Ze=Object(we.useCallback)(function(ze){return Object(pe.a)(Object(it.a)().mark(function Se(){var ue,ie;return Object(it.a)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return xe(!0),L.prev=1,L.next=4,Object(k.a)(ze,{stat:Ge});case 4:ue=L.sent,ue instanceof Blob&&(ie=document.createElement("a"),ie.href=window.URL.createObjectURL(ue),ie.download="finished_topics_".concat(De,".xlsx"),document.body.appendChild(ie),ie.click(),document.body.removeChild(ie)),L.next=11;break;case 8:L.prev=8,L.t0=L.catch(1),console.error(L.t0);case 11:return L.prev=11,xe(!1),L.finish(11);case 14:case"end":return L.stop()}},Se,null,[[1,8,11,14]])}))},[Ge]);return Object(O.jsxs)(We.a,{type:"primary",loading:ye,onClick:Ze(De),children:[Object(O.jsx)(de.a,{})," ",Object(O.jsx)(S.a,{id:"export"})]})},Ie=function(le){return le.topicable.content.contents?Object.values(le.topicable.content.contents)[0].library:"H5P"},U=function(le){var De=le.course_id,Me=le.topics,Ge=le.stats,ge=Object(we.useState)(!1),ee=Object(rt.a)(ge,2),ye=ee[0],xe=ee[1],Ze=Object(we.useMemo)(function(){return[{title:Object(O.jsx)(S.a,{id:"user"}),dataIndex:"id",render:function(ue){return Object(O.jsx)(W.a,{type:"App\\Models\\User",type_id:ue})}},{title:Object(O.jsx)(S.a,{id:"email"}),dataIndex:"email"}].concat(Object(he.a)(Me.map(function(Se){var ue,ie=(ue=Se.topicable_type)===null||ue===void 0?void 0:ue.split("\\").pop();return ie==="H5P"&&(ie=Ie(Se)),{render:function(L){var G=0,X=0;switch(L&&(L.started_at&&L.finished_at?G=1:L.started_at&&(G=2),X=L.seconds/60),G){case 1:return Object(O.jsxs)($e.b,{children:[Object(O.jsx)(ce.a,{color:"success",children:"F"}),ye&&Object(O.jsxs)("small",{children:[X.toFixed(2),"m"]})]});case 2:return Object(O.jsxs)($e.b,{children:[Object(O.jsx)(ce.a,{color:"blue",children:"S"}),ye&&Object(O.jsxs)("small",{children:[X.toFixed(2),"m"]})]});case 0:default:return Object(O.jsx)(jt.a.Fragment,{children:Object(O.jsx)(ce.a,{color:"error",children:"N"})})}},title:Object(O.jsxs)("small",{children:[Object(O.jsx)(ce.a,{children:ie})," ",Se.title]}),dataIndex:Se.id}})))},[Me,ye]),ze=Object(we.useMemo)(function(){return Ge.map(function(Se){return Me.reduce(function(ue,ie){var F=Se.topics.find(function(L){return L.id===ie.id});return Object(v.a)(Object(v.a)({},ue),{},Object(Te.a)({},Number(ie.id),F!=null?F:0))},{email:Se.email,id:Se.id})})},[Ge,Me]);return Object(O.jsx)(M.a,{title:function(){return Object(O.jsxs)(o.a,{justify:"space-between",align:"middle",children:[Object(O.jsxs)($e.b,{children:[Object(O.jsx)(S.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(O.jsx)(ce.a,{color:"success",children:"F"}),Object(O.jsx)(S.a,{id:"Started",defaultMessage:"Started:"})," ",Object(O.jsx)(ce.a,{color:"blue",children:"S"}),Object(O.jsx)(S.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(O.jsx)(ce.a,{color:"error",children:"N"}),Object(O.jsx)(S.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(O.jsx)(u.a,{checked:ye,onChange:function(ie){return xe(ie)}})]}),Object(O.jsx)(J,{course_id:De})]})},columns:Ze,dataSource:ze,size:"small",scroll:{x:1500}})},m=function(le){var De=le.stats,Me=Object(we.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(ee){return Object(O.jsx)(W.a,{type:"App\\Models\\User",type_id:ee})}},{title:"email",dataIndex:"email"},{title:Object(O.jsx)(S.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Ge=Object(we.useMemo)(function(){return De.map(function(ge){var ee=ge.id,ye=ge.email,xe=ge.finished_at;return{id:ee,email:ye,finished_at:xe}})},[De]);return Object(O.jsx)(M.a,{title:function(){return Object(O.jsx)($e.b,{children:Object(O.jsx)(S.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Me,dataSource:Ge,size:"small",scroll:{x:500}})},Ve=function(le){var De=le.stats,Me=Object(we.useState)(null),Ge=Object(rt.a)(Me,2),ge=Ge[0],ee=Ge[1],ye=Object(we.useState)(null),xe=Object(rt.a)(ye,2),Ze=xe[0],ze=xe[1],Se=Object(S.l)(),ue=Object(we.useMemo)(function(){return De.flatMap(function(F){return Object.values(F.attempts).flatMap(function(L){var G=L.dates,X=L.attempt,ft=Object.values(G).flatMap(function(tt){var D=tt.date,I=tt.seconds_total;return{date:D,attempt:X,seconds_total:I,email:F.email}});return ft})})},[De]),ie={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(O.jsx)(vt.a,{title:Object(O.jsxs)($e.b,{children:[Object(O.jsx)(S.a,{id:"course.interactions_time_in_days"}),Object(O.jsx)(_e.a,{showSearch:!0,value:ge,onChange:function(L){ee(L),ze(null)},placeholder:Object(O.jsx)(S.a,{id:"select_person",defaultMessage:"Select a person"}),children:De.map(function(F){var L=F.id,G=F.email;return Object(O.jsx)(_e.a.Option,{value:G,children:G},L)})}),Object(O.jsx)(_e.a,{value:Ze,onChange:function(L){return ze(L)},disabled:ge===null,placeholder:Object(O.jsx)(S.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(he.a)(new Set(ue.filter(function(F){var L=F.email;return L===ge}).map(function(F){var L=F.attempt;return L}))).map(function(F){return Object(O.jsxs)(_e.a.Option,{value:F,children:[Object(O.jsx)(S.a,{id:"attempt",defaultMessage:"Attempt"})," ",F]},F)})})]}),colSpan:12,layout:"center",children:Object(O.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(O.jsx)(ke.a,Object(v.a)(Object(v.a)({},ie),{},{tooltip:{title:"".concat(Se.formatMessage({id:"attempt"})),formatter:function(L){var G=Math.floor(+L.seconds_total/60),X=+L.seconds_total>60?+L.seconds_total-G*60:0;return{name:L.attempt,value:"".concat(G,"m ").concat(X,"s")}}},data:ue.filter(function(F){var L=F.email;return L===ge}).filter(function(F){var L=F.attempt;return Number.isInteger(Ze)?L===Ze:!0})}))})})}},Hn4i:function(Ot,me,s){"use strict";var d=s("y8nQ"),_e=s("Vl3Y"),je=s("+L6B"),M=s("2/Rp"),se=s("rePB"),o=s("ODXe"),Qe=s("Ff2n"),u=s("x+uP"),Te=s("HaE+"),v=s("VTBJ"),K=s("nKUr"),$e=s.n(K),Oe=s("xvlK"),ce=s("WuYN"),he=s("VMEa"),rt=s("LQCs"),we=s("ft2k"),jt=s("uX+g"),vt=s("+i8S"),ke=s("ipCM"),S=s("6cGi"),W=s("ub+h"),He=s("bG1m"),We=s("q1tI"),it=s.n(We),pe=s("mWMg"),de=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],k=["record","position","creatorButtonText","newRecordType","parentKey","style"],O=it.a.createContext(void 0);function J(m){var Ve=m.children,Ue=m.record,le=m.position,De=m.newRecordType,Me=m.parentKey,Ge=Object(We.useContext)(O);return it.a.cloneElement(Ve,Object(v.a)(Object(v.a)({},Ve.props),{},{onClick:function(){var ge=Object(Te.a)(Object(u.a)().mark(function ye(xe){var Ze,ze,Se,ue;return Object(u.a)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,(Ze=(ze=Ve.props).onClick)===null||Ze===void 0?void 0:Ze.call(ze,xe);case 2:if(ue=F.sent,ue!==!1){F.next=5;break}return F.abrupt("return");case 5:Ge==null||(Se=Ge.current)===null||Se===void 0||Se.addEditRecord(Ue,{position:le,newRecordType:De,parentKey:Me});case 6:case"end":return F.stop()}},ye)}));function ee(ye){return ge.apply(this,arguments)}return ee}()}))}function Ie(m){var Ve,Ue,le=Object(rt.d)(),De=m.onTableChange,Me=m.maxLength,Ge=m.formItemProps,ge=m.recordCreatorProps,ee=m.rowKey,ye=m.controlled,xe=m.defaultValue,Ze=m.onChange,ze=m.editableFormRef,Se=Object(Qe.a)(m,de),ue=Object(we.a)(m.value),ie=Object(We.useRef)(),F=Object(We.useRef)();Object(We.useImperativeHandle)(Se.actionRef,function(){return ie.current});var L=Object(S.a)(function(){return m.value||xe||[]},{value:m.value,onChange:m.onChange}),G=Object(o.a)(L,2),X=G[0],ft=G[1],tt=it.a.useMemo(function(){return typeof ee=="function"?ee:function(Le,Q){return Le[ee]||Q}},[ee]),D=function(Q){if(typeof Q=="number"&&!m.name){if(Q>=X.length)return Q;var te=X&&X[Q];return tt==null?void 0:tt(te,Q)}if((typeof Q=="string"||Q>=X.length)&&m.name){var re=X.findIndex(function(oe,Pe){var Fe;return(tt==null||(Fe=tt(oe,Pe))===null||Fe===void 0?void 0:Fe.toString())===(Q==null?void 0:Q.toString())});return re}return Q};Object(We.useImperativeHandle)(ze,function(){var Le=function(re){var oe,Pe;if(re==null)throw new Error("rowIndex is required");var Fe=D(re),ct=[m.name,(oe=Fe==null?void 0:Fe.toString())!==null&&oe!==void 0?oe:""].flat(1).filter(Boolean);return(Pe=F.current)===null||Pe===void 0?void 0:Pe.getFieldValue(ct)},Q=function(){var re,oe=[m.name].flat(1).filter(Boolean);if(Array.isArray(oe)&&oe.length===0){var Pe,Fe=(Pe=F.current)===null||Pe===void 0?void 0:Pe.getFieldsValue();return Array.isArray(Fe)?Fe:Object.keys(Fe).map(function(ct){return Fe[ct]})}return(re=F.current)===null||re===void 0?void 0:re.getFieldValue(oe)};return Object(v.a)(Object(v.a)({},F.current),{},{getRowData:Le,getRowsData:Q,setRowData:function(re,oe){var Pe,Fe,ct,_t;if(re==null)throw new Error("rowIndex is required");var gt=D(re),Zt=[m.name,(Pe=gt==null?void 0:gt.toString())!==null&&Pe!==void 0?Pe:""].flat(1).filter(Boolean),bt=((Fe=F.current)===null||Fe===void 0||(ct=Fe.getFieldsValue)===null||ct===void 0?void 0:ct.call(Fe))||{},Dt=Object(He.a)(bt,Zt,Object(v.a)(Object(v.a)({},Le(re)),oe||{}));return(_t=F.current)===null||_t===void 0?void 0:_t.setFieldsValue(Dt)}})}),Object(We.useEffect)(function(){!m.controlled||X.forEach(function(Le,Q){var te;(te=F.current)===null||te===void 0||te.setFieldsValue(Object(se.a)({},tt(Le,Q),Le))},{})},[X,m.controlled]),Object(We.useEffect)(function(){if(m.name){var Le;F.current=m==null||(Le=m.editable)===null||Le===void 0?void 0:Le.form}},[(Ve=m.editable)===null||Ve===void 0?void 0:Ve.form,m.name]);var I=ge||{},V=I.record,w=I.position,R=I.creatorButtonText,Y=I.newRecordType,Re=I.parentKey,ne=I.style,Yt=Object(Qe.a)(I,k),ht=w==="top",pt=Object(We.useMemo)(function(){return Me&&Me<=(X==null?void 0:X.length)?!1:ge!==!1&&Object(K.jsx)(J,{record:Object(jt.a)(V,X==null?void 0:X.length,X)||{},position:w,parentKey:Object(jt.a)(Re,X==null?void 0:X.length,X),newRecordType:Y,children:Object(K.jsx)(M.a,Object(v.a)(Object(v.a)({type:"dashed",style:Object(v.a)({display:"block",margin:"10px 0",width:"100%"},ne),icon:Object(K.jsx)(Oe.a,{})},Yt),{},{children:R||le.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[ge,Me,X==null?void 0:X.length]),e=Object(We.useMemo)(function(){return pt?ht?{components:{header:{wrapper:function(Q){var te,re=Q.className,oe=Q.children;return Object(K.jsxs)("thead",{className:re,children:[oe,Object(K.jsxs)("tr",{style:{position:"relative"},children:[Object(K.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:pt}),Object(K.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(te=Se.columns)===null||te===void 0?void 0:te.length,children:pt})]})]})}}}}:{tableViewRender:function(Q,te){var re,oe;return Object(K.jsxs)(K.Fragment,{children:[(re=(oe=m.tableViewRender)===null||oe===void 0?void 0:oe.call(m,Q,te))!==null&&re!==void 0?re:te,pt]})}}:{}},[ht,pt]),St=Object(v.a)({},m.editable),It=Object(vt.a)(function(Le,Q){var te,re,oe;if((te=m.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Le,Q),(oe=m.onValuesChange)===null||oe===void 0||oe.call(m,Q,Le),m.controlled){var Pe;m==null||(Pe=m.onChange)===null||Pe===void 0||Pe.call(m,Q)}});return((m==null?void 0:m.onValuesChange)||((Ue=m.editable)===null||Ue===void 0?void 0:Ue.onValuesChange)||m.controlled&&(m==null?void 0:m.onChange))&&(St.onValuesChange=It),Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(O.Provider,{value:ie,children:Object(K.jsx)(pe.a,Object(v.a)(Object(v.a)(Object(v.a)({search:!1,options:!1,pagination:!1,rowKey:ee,revalidateOnFocus:!1},Se),e),{},{tableLayout:"fixed",actionRef:ie,onChange:De,editable:Object(v.a)(Object(v.a)({},St),{},{formProps:Object(v.a)({formRef:F},St.formProps)}),dataSource:X,onDataSourceChange:function(Q){if(ft(Q),m.name&&w==="top"){var te,re=Object(He.a)({},[m.name].flat(1).filter(Boolean),Q);(te=F.current)===null||te===void 0||te.setFieldsValue(re)}}}))}),m.name?Object(K.jsx)(ce.a,{name:[m.name],children:function(Q){var te,re,oe=Object(W.a)(Q,[m.name].flat(1)),Pe=oe==null?void 0:oe.find(function(Fe,ct){return!Object(ke.a)(Fe,ue==null?void 0:ue[ct])});return Pe&&ue&&(m==null||(te=m.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Pe,oe)),null}}):null]})}function U(m){var Ve=he.a.useFormInstance();return m.name?Object(K.jsx)(_e.a.Item,Object(v.a)(Object(v.a)({style:{maxWidth:"100%"}},m==null?void 0:m.formItemProps),{},{name:m.name,children:Object(K.jsx)(Ie,Object(v.a)(Object(v.a)({},m),{},{editable:Object(v.a)(Object(v.a)({},m.editable),{},{form:Ve})}))})):Object(K.jsx)(Ie,Object(v.a)({},m))}U.RecordCreator=J,me.a=U},LDJE:function(Ot,me,s){"use strict";var d=s("q1tI"),_e=s.n(d),je=s("ma/q"),M=s("ZIEt"),se=s("QpZ9"),o=s("GzfL"),Qe=s("Scwr"),u=function(v,K){var $e={};for(var Oe in v)Object.prototype.hasOwnProperty.call(v,Oe)&&K.indexOf(Oe)<0&&($e[Oe]=v[Oe]);if(v!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ce=0,Oe=Object.getOwnPropertySymbols(v);ce<Oe.length;ce++)K.indexOf(Oe[ce])<0&&Object.prototype.propertyIsEnumerable.call(v,Oe[ce])&&($e[Oe[ce]]=v[Oe[ce]]);return $e},Te=Object(d.forwardRef)(function(v,K){var $e=v.chartRef,Oe=v.style,ce=Oe===void 0?{height:"inherit"}:Oe,he=v.className,rt=v.loading,we=v.loadingTemplate,jt=v.errorTemplate,vt=u(v,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ke=Object(M.a)(je.a,vt),S=ke.chart,W=ke.container;return Object(d.useEffect)(function(){Object(se.a)($e,S.current)},[S.current]),Object(d.useImperativeHandle)(K,function(){return{getChart:function(){return S.current}}}),_e.a.createElement(o.a,{errorTemplate:jt},rt&&_e.a.createElement(Qe.a,{loadingTemplate:we,theme:v.theme}),_e.a.createElement("div",{className:he,style:ce,ref:W}))});me.a=Te},olry:function(Ot,me,s){"use strict";s.r(me);var d=s("k1fw"),_e=s("+L6B"),je=s("2/Rp"),M=s("T2oS"),se=s("W9HT"),o=s("q1tI"),Qe=s.n(o),u=s("9kvl"),Te=s("55Ip"),v=s("Ty5D"),K=s("nhC9"),$e=s("tMyG"),Oe=s("my69"),ce=s("huej"),he=s("mJ0o"),rt=s("EhlZ"),we=s("P2fV"),jt=s("NJEC"),vt=s("5Dmo"),ke=s("3S7+"),S=s("qLMh"),W=s("9og8"),He=s("sWYD"),We=s("G3dp"),it=s("VTBJ"),pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},de=pe,k=s("6VBw"),O=function(r,a){return o.createElement(k.a,Object(it.a)(Object(it.a)({},r),{},{ref:a,icon:de}))};O.displayName="LineChartOutlined";var J=o.forwardRef(O),Ie=s("/MfK"),U=s("Qiat"),m=s("mGZj");function Ve(c,r){return Ue.apply(this,arguments)}function Ue(){return Ue=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(d.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},c)})),Ue.apply(this,arguments)}function le(c,r){return De.apply(this,arguments)}function De(){return De=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},c)})),De.apply(this,arguments)}function Me(c,r,a){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(W.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(d.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return i.stop()}},c)})),Ge.apply(this,arguments)}function ge(c,r){return ee.apply(this,arguments)}function ee(){return ee=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),ee.apply(this,arguments)}function ye(c,r){return xe.apply(this,arguments)}function xe(){return xe=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r),Object(d.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},c)})),xe.apply(this,arguments)}function Ze(c,r,a,n){return ze.apply(this,arguments)}function ze(){return ze=Object(W.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return l.stop()}},c)})),ze.apply(this,arguments)}function Se(c,r,a){return ue.apply(this,arguments)}function ue(){return ue=Object(W.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(u.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(d.a)({method:"DELETE"},n||{})));case 1:case"end":return i.stop()}},c)})),ue.apply(this,arguments)}var ie=s("Vpfc"),F=s("giR+"),L=s("fyUT"),G=s("tJVT"),X=s("14J3"),ft=s("BMrR"),tt=s("jCWc"),D=s("kPKH"),I=s("VMEa"),V=s("Qurx"),w=s("lR9U"),R=s("/y+f"),Y=s("2qtc"),Re=s("kLXV"),ne=s("oBTY"),Yt=s("OaEy"),ht=s("2fM7"),pt=s("DBJ/"),e=s("nKUr"),St=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,i=Object(he.b)(),l=i.semester_subject_id,b=i.teacherSubjectData,f=Object(o.useState)(null),E=Object(G.a)(f,2),p=E[0],x=E[1],y=Object(o.useMemo)(function(){var g;return((g=b==null?void 0:b.groups)!==null&&g!==void 0?g:[]).map(function(_){var P=_.id,T=_.name;return{label:T,value:P}})},[]),j={type:a,group_id:p,semester_subject_id:l},h=Object(o.useCallback)(function(g){if(g.success){var _=g.data.results.filter(function(P){var T=P.user_id;return T!==null});if(!_.length)return;n({exam_results:_,group_id:g.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(u.a,{id:"group"}),children:Object(e.jsx)(ht.a,{disabled:t,value:p,onChange:function(_){return x(_)},options:y,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(pt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:h,onChange:function(_){return!_.fileList.length&&n(void 0)},maxFiles:1,data:j,disabled:!p})]})},It=function(r){var a=r.onDataConverted,n=Object(he.b)(),t=n.teacherSubjectData,i=n.groupUsers,l=Object(o.useState)(null),b=Object(G.a)(l,2),f=b[0],E=b[1],p=Object(o.useMemo)(function(){var y;return((y=t==null?void 0:t.groups)!==null&&y!==void 0?y:[]).map(function(j){var h=j.id,g=j.name;return{label:g,value:h}})},[]),x=Object(o.useCallback)(function(y){var j;E(y);var h=(j=i.byId)===null||j===void 0?void 0:j[y];if(!!h){var g=h.users.reduce(function(_,P){var T=P.id,C=P.email,z=P.first_name,H=P.last_name,Ce=P.academic_teacher_id;return Ce!==null?_:[].concat(Object(ne.a)(_),[{email:C,first_name:z,last_name:H,user_id:T,result:0}])},[]);a({group_id:y,exam_results:g})}},[i.byId]);return Object(e.jsx)(ht.a,{value:f,onChange:x,options:p,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})},Le=[R.b.TeamsLecture,R.b.TestPortal,R.b.TeamsForms],Q=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,i=r.type,l=Object(he.b)(),b=l.teacherSubjectData,f=l.fetchGroupUsers,E=Object(o.useState)(),p=Object(G.a)(E,2),x=p[0],y=p[1];return Object(o.useEffect)(function(){if(i===R.b.Manual&&a){var j;b==null||(j=b.groups)===null||j===void 0||j.forEach(function(h){var g=h.id;return f(g)})}},[i,a]),Object(e.jsxs)(Re.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.".concat(i,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){x&&t(x)},okButtonProps:{disabled:!x},children:[Le.includes(i)&&Object(e.jsx)(St,{type:i,onDataConverted:y,groupSelectDisabled:!!x}),i===R.b.Manual&&Object(e.jsx)(It,{onDataConverted:y})]})},te=function(r){var a=r.onSelect;return Object(e.jsxs)(ft.a,{gutter:[16,16],children:[Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(R.b.TeamsForms)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(R.b.TestPortal)},children:Object(e.jsx)(u.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(R.b.TeamsLecture)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(R.b.Manual)},children:Object(e.jsx)(u.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},re=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],oe=function(r){var a,n=r.exam_id,t=I.a.useForm(),i=Object(G.a)(t,1),l=i[0],b=Object(o.useState)(),f=Object(G.a)(b,2),E=f[0],p=f[1],x=Object(o.useState)(),y=Object(G.a)(x,2),j=y[0],h=y[1],g=Object(o.useState)(!1),_=Object(G.a)(g,2),P=_[0],T=_[1],C=Object(he.b)(),z=C.semester_subject_id,H=C.getGroupById,Ce=Object(o.useMemo)(function(){var N;return((N=j==null?void 0:j.exam_results)!==null&&N!==void 0?N:[]).map(function(A){var $=A.user_id;return $})},[j==null?void 0:j.exam_results]);Object(o.useEffect)(function(){var N=Number(n);n==="new"&&(p(void 0),h(void 0),l.resetFields()),n!=="new"&&!Number.isNaN(N)&&(T(!0),ge(N).then(function(A){if(A.success){var $=A.data,q=$.type,Xe=$.results,at=$.title,be=$.weight,ve=$.passed_at,Z=$.group_id;p(q),h({group_id:Z,exam_results:Xe}),l.setFieldsValue({title:at,weight:be,passed_at:ve})}}).finally(function(){return T(!1)}))},[n]);var Ne=Object(o.useCallback)(function(){p(void 0),h(void 0)},[]);return P?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(Q,{open:Boolean(E&&!j),type:E,closeModal:Ne,onSuccess:h}),Object(e.jsxs)(I.a,{form:l,submitter:E===void 0||!j?!1:void 0,onFinish:function(){var N=Object(W.a)(Object(S.a)().mark(function A($){var q,Xe,at,be,ve,Z,Be,et,Ke,nt;return Object(S.a)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Xe=j==null||(q=j.exam_results)===null||q===void 0?void 0:q.every(function(fe){var Ee=fe.result;return typeof Ee=="number"&&Ee>=0&&Ee<=100}),!(j&&Xe&&typeof z=="number")){B.next=17;break}if(at=$.title,be=$.passed_at,ve=$.weight,Z=Number(n),Be=j.exam_results,et=j.group_id,Ke={type:E,semester_subject_id:z,title:at,passed_at:be,weight:ve,group_id:et,results:Be},!Number.isNaN(Z)){B.next=12;break}return B.next=9,le(Ke);case 9:B.t0=B.sent,B.next=15;break;case 12:return B.next=14,Me(Z,Ke);case 14:B.t0=B.sent;case 15:nt=B.t0,nt.success&&u.f.push("/teacher/subjects/".concat(z,"/exams"));case 17:return B.abrupt("return",!0);case 18:case"end":return B.stop()}},A)}));return function(A){return N.apply(this,arguments)}}(),onReset:Ne,children:[Object(e.jsxs)(I.a.Group,{children:[Object(e.jsx)(V.a,{label:Object(e.jsx)(u.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(w.a,{label:Object(e.jsx)(u.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(I.a.Item,{name:"weight",label:Object(e.jsx)(u.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(L.a,{})})]}),E&&j&&Object(e.jsx)(U.a,{rowKey:"user_id",headerTitle:(a=H(j.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:Ce,onValuesChange:function(A,$){return h({group_id:j.group_id,exam_results:$})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:j.exam_results,columns:re}),!j&&Object(e.jsx)(te,{onSelect:p})]})]})},Pe=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Fe=function(r){var a=r.exam_id,n=Object(o.useState)(""),t=Object(G.a)(n,2),i=t[0],l=t[1];return Object(e.jsx)(U.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:i,request:Object(W.a)(Object(S.a)().mark(function b(){var f;return Object(S.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,ge(a);case 2:if(f=p.sent,!f.success){p.next=6;break}return l(f.data.title),p.abrupt("return",{total:f.data.results.length,success:!0,data:f.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},b)})),columns:Pe})},ct=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(u.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(u.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(u.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(He.a)(new Date(a.passed_at),m.c)}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(He.a)(new Date(a.created_at),m.c)}},{title:Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(u.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(ie.a,{type:"Students",type_id:a.group_id},a.group_id)}}],_t=function(){var r,a,n=Object(o.useRef)(),t=Object(he.b)(),i=t.semester_subject_id,l=Object(v.k)(),b=Object(o.useMemo)(function(){var p,x,y;return{exam_id:(p=(x=l.query)===null||x===void 0?void 0:x.exam_id)!==null&&p!==void 0?p:null,results:(y=l.query)===null||y===void 0?void 0:y.results}},[(r=l.query)===null||r===void 0?void 0:r.exam_id,(a=l.query)===null||a===void 0?void 0:a.results]),f=b.exam_id,E=b.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(Fe,{exam_id:Number(E)}):f!==null?Object(e.jsx)(oe,{exam_id:f}):Object(e.jsx)(U.a,{className:"table-standalone",headerTitle:Object(e.jsx)(u.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var p=Object(W.a)(Object(S.a)().mark(function x(y,j){var h,g,_,P;return Object(S.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(h=y.current,g=y.pageSize,i!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return _=j&&Object.entries(j)[0],C.next=6,Ve({per_page:g,page:h,semester_subject_id:Number.isNaN(i)?void 0:i,order_by:_&&_[0],order:_&&(_[1]==="ascend"?"ASC":"DESC")});case 6:if(P=C.sent,!P.success){C.next=9;break}return C.abrupt("return",{data:P.data,total:P.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},x)}));return function(x,y){return p.apply(this,arguments)}}(),columns:[].concat(ct,[{title:Object(e.jsx)(u.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(x,y){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(y.semester_subject_id,"/exams?exam_id=").concat(y.id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(We.a,{})})})},"edit"),Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(y.semester_subject_id,"/exams?results=").concat(y.id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(je.a,{icon:Object(e.jsx)(J,{})})})},"results"),Object(e.jsx)(jt.a,{title:Object(e.jsx)(u.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(W.a)(Object(S.a)().mark(function j(){var h;return Object(S.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,ye(y.id);case 2:h=_.sent,h.success&&n.current&&n.current.reload();case 4:case"end":return _.stop()}},j)})),okText:Object(e.jsx)(u.a,{id:"yes"}),cancelText:Object(e.jsx)(u.a,{id:"no"}),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(Ie.a,{}),danger:!0})})},"delete")]}}])})},gt=s("o0Ox"),Zt=s("miYZ"),bt=s("tsqr"),Dt=s("4KAj");function ja(c,r){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/chats/ms-teams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},c)})),Gt.apply(this,arguments)}var ba=function(r){var a=r.student_id,n=Object(o.useState)(!1),t=Object(G.a)(n,2),i=t[0],l=t[1],b=Object(o.useCallback)(Object(W.a)(Object(S.a)().mark(function f(){var E;return Object(S.a)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return l(!0),x.next=3,ja({user_id:a});case 3:if(E=x.sent,E.success){x.next=8;break}return bt.b.error(E.message),l(!1),x.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),l(!1);case 10:case"end":return x.stop()}},f)})),[]);return Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(je.a,{loading:i,type:"primary",icon:Object(e.jsx)(Dt.a,{}),onClick:b})})},va=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(u.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],fa=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},ma=function(r){return r.reduce(function(a,n){var t,i=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(l,b){return b.academic_teacher_id!==null?l:[].concat(Object(ne.a)(l),[{group_id:n.id,group_name:n.name,user_id:b.id,first_name:b.first_name,last_name:b.last_name,email:b.email}])},[]);return[].concat(Object(ne.a)(a),Object(ne.a)(i))},[])},Oa=function(){var r=Object(he.b)(),a=r.teacherSubjectData,n=Object(o.useMemo)(function(){var t;return fa((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(U.a,{className:"table-standalone",rowKey:function(i){return"".concat(i.group_id,"-").concat(i.user_id)},search:{layout:"vertical"},request:function(){var t=Object(W.a)(Object(S.a)().mark(function i(l){var b,f,E,p,x,y,j,h,g;return Object(S.a)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return b=l.groups,f=l.first_name,E=f===void 0?"":f,p=l.last_name,x=p===void 0?"":p,y=l.email,j=y===void 0?"":y,P.next=3,Object(gt.a)({parent_id:a==null?void 0:a.group_id,"id[]":b});case 3:if(h=P.sent,h.success){P.next=6;break}return P.abrupt("return",{data:[],total:0,success:!1});case 6:return g=ma(h.data).filter(function(T){return T.first_name.toLowerCase().includes(E.toLowerCase())&&T.last_name.toLowerCase().includes(x.toLowerCase())&&T.email.toLowerCase().includes(j.toLowerCase())}),P.abrupt("return",{data:g,total:g.length,success:!0});case 8:case"end":return P.stop()}},i)}));return function(i){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(va,[{hideInSearch:!0,title:Object(e.jsx)(u.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(i,l){return[Object(e.jsx)(ba,{student_id:l.user_id},"teamsChat")]}}])})},xt=s("jrin");function Rt(c,r){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules/groups/".concat(r),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Lt.apply(this,arguments)}function Xt(c,r,a,n){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(W.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(u.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(d.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return l.stop()}},c)})),Ft.apply(this,arguments)}var yn=s("sRBo"),Qt=s("kaz8"),ha=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.defaultChecked,i=r.onSuccess,l=Object(o.useState)(!1),b=Object(G.a)(l,2),f=b[0],E=b[1],p=Object(o.useCallback)(function(x){E(!0),Xt(a,n,x.target.checked?R.a.PRESENT:R.a.ABSENT).then(function(y){y.success&&(i==null||i())}).finally(function(){return E(!1)})},[]);return Object(e.jsx)(Qt.a,{disabled:f,defaultChecked:t,onChange:p})},kt=ha,pa=function(){var r=Object(he.b)(),a=r.teacherSubjectData,n=Object(o.useState)([]),t=Object(G.a)(n,2),i=t[0],l=t[1],b=Object(o.useState)(""),f=Object(G.a)(b,2),E=f[0],p=f[1],x=Object(u.l)(),y=Object(o.useRef)(),j=Object(o.useMemo)(function(){var g;return((g=a==null?void 0:a.groups)!==null&&g!==void 0?g:[]).map(function(_){var P=_.id,T=_.name;return{value:P,label:T}})},[a==null?void 0:a.groups]),h=Object(o.useMemo)(function(){var g;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:j,defaultValue:j==null||(g=j[0])===null||g===void 0?void 0:g.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(i))},[j,i]);return Object(e.jsx)(U.a,{className:"table-standalone",headerTitle:"".concat(x.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(E,")"),request:function(){var g=Object(W.a)(Object(S.a)().mark(function _(P){var T,C,z,H,Ce,Ne,N,A,$,q,Xe;return Object(S.a)().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return C=P.group_id,z=C===void 0?j==null||(T=j[0])===null||T===void 0?void 0:T.value:C,H=P.full_name,Ce=H===void 0?"":H,be.next=3,Promise.all([Object(gt.b)(z),Rt(z)]);case 3:if(Ne=be.sent,N=Object(G.a)(Ne,2),A=N[0],$=N[1],q=j.find(function(ve){var Z=ve.value;return Z===z}),!(!A.success||!$.success||!q)){be.next=10;break}return be.abrupt("return",{data:[],total:0,success:!1});case 10:if($.data.length){be.next=13;break}return bt.b.error(x.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),be.abrupt("return",{data:[],total:0,success:!1});case 13:return p(q.label),l($.data.reduce(function(ve,Z){return[].concat(Object(ne.a)(ve),[{title:String(Object(He.a)(new Date(Z.date_from),m.c)),dataIndex:String(Z.date_from),hideInSearch:!0,width:100,align:"center",render:function(et,Ke){return Object(e.jsx)(kt,{groupAttendanceScheduleId:Z.id,defaultChecked:Ke["".concat(Z==null?void 0:Z.date_from)]===R.a.PRESENT,studentId:Ke.id})}}])},[])),Xe=A.data.users.reduce(function(ve,Z){var Be=Z.id,et=Z.academic_teacher_id,Ke=Z.first_name,nt=Z.last_name,ae="".concat(nt," ").concat(Ke);if(et!==null||!ae.toLowerCase().includes(Ce.toLowerCase()))return ve;var B=$.data.reduce(function(fe,Ee){var Je=Ee.attendances.find(function(ut){return ut.user_id===Be});return Je?Object(d.a)(Object(d.a)({},fe),{},Object(xt.a)({},"".concat(Ee.date_from),Je.value)):fe},{});return[].concat(Object(ne.a)(ve),[Object(d.a)({id:Be,full_name:ae},B)])},[]).sort(function(ve,Z){return ve.full_name.localeCompare(Z.full_name)}),be.abrupt("return",{data:Xe,total:Xe.length,success:!0});case 17:case"end":return be.stop()}},_)}));return function(_){return g.apply(this,arguments)}}(),columns:h,search:{layout:"vertical"},pagination:{onChange:function(){var _;return(_=y.current)===null||_===void 0?void 0:_.reload()}},scroll:{x:1500},actionRef:y,rowKey:"id"})},En=s("tU7J"),st=s("wFql"),Cn=s("/zsF"),At=s("PArb"),ga=s("Hn4i"),xa=s("bRQS");function $t(c,r,a){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(W.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(d.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return i.stop()}},c)})),Ut.apply(this,arguments)}function Sa(c,r,a,n){return wt.apply(this,arguments)}function wt(){return wt=Object(W.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(d.a)({method:"POST",data:n},t||{})));case 1:case"end":return l.stop()}},c)})),wt.apply(this,arguments)}function qt(c,r){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/lesson-group-users",Object(d.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Nt.apply(this,arguments)}function _a(c,r,a){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(W.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(u.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(d.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return i.stop()}},c)})),Bt.apply(this,arguments)}function ea(c){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(W.a)(Object(S.a)().mark(function c(r){return Object(S.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(u.i)("/api/admin/grade-terms",Object(d.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},c)})),Kt.apply(this,arguments)}function ta(c,r){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/grade-scales/".concat(r),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Wt.apply(this,arguments)}function aa(c,r){return Vt.apply(this,arguments)}function Vt(){return Vt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/final-grades",Object(d.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},c)})),Vt.apply(this,arguments)}function na(c,r,a){return Ht.apply(this,arguments)}function Ht(){return Ht=Object(W.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",Object(u.i)("/api/admin/final-grades/".concat(r),Object(d.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return i.stop()}},c)})),Ht.apply(this,arguments)}var ya=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],Ea=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(o.useState)([]),i=Object(G.a)(t,2),l=i[0],b=i[1],f=Object(o.useRef)(),E=I.a.useForm(),p=Object(G.a)(E,1),x=p[0];return Object(o.useEffect)(function(){var y,j=((y=a.scale)!==null&&y!==void 0?y:[]).map(function(h,g){return Object(d.a)(Object(d.a)({},h),{},{id:String((g+1)*100)})});x.setFieldValue("table",j)},[]),Object(e.jsx)(I.a,{form:x,onFinish:n,submitter:{render:function(j,h){var g=Object(G.a)(h,2),_=g[1];return[_]}},children:Object(e.jsx)(ga.a,{name:"table",rowKey:"id",actionRef:f,formItemProps:{label:Object(e.jsx)(u.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(ya,[{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(j,h){return Object(e.jsx)(je.a,{type:"primary",onClick:function(){var _;return(_=f.current)===null||_===void 0?void 0:_.startEditable(h.id)},icon:Object(e.jsx)(We.a,{})})}}]),editable:{form:x,type:"multiple",editableKeys:l,saveText:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(xa.a,{})}),onChange:b,actionRender:function(j,h,g){return[g.save]}}})})},Ca=function(){var r,a,n=Object(u.m)("@@initialState"),t=n.initialState,i=Object(he.b)(),l=i.semester_subject_id,b=i.tutors,f=Object(o.useState)(),E=Object(G.a)(f,2),p=E[0],x=E[1],y=Object(o.useState)(!1),j=Object(G.a)(y,2),h=j[0],g=j[1],_=Object(o.useState)(null),P=Object(G.a)(_,2),T=P[0],C=P[1],z=Object(o.useMemo)(function(){return!!b.data.find(function(N){var A,$=N.id;return $===(t==null||(A=t.currentUser)===null||A===void 0?void 0:A.id)})},[b.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),H=Object(o.useMemo)(function(){return b.data.map(function(N){var A=N.id,$=N.first_name,q=N.last_name;return{label:"".concat($," ").concat(q),value:A}})},[b.data]),Ce=Object(o.useCallback)(function(){l===null||T===null||(g(!0),x(void 0),$t(l,T).then(function(N){N.success&&x(N.data)}).finally(function(){g(!1)}))},[l,T]),Ne=Object(o.useCallback)(function(N,A){return function(){var $=Object(W.a)(Object(S.a)().mark(function q(Xe){var at,be;return Object(S.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(!(l===null||T===null)){Z.next=2;break}return Z.abrupt("return");case 2:return at=N.reduce(function(Be,et){return et.s_subject_scale_form_id===A?[].concat(Object(ne.a)(Be),[{s_subject_scale_form_id:A,scale:Xe.table.map(function(Ke){var nt=Ke.name,ae=Ke.grade,B=Ke.grade_value;return{name:nt,grade:ae,grade_value:B}})}]):[].concat(Object(ne.a)(Be),[et])},[]),Z.next=5,Sa(l,T,{grade_scale:at});case 5:be=Z.sent,be.success&&Ce();case 7:case"end":return Z.stop()}},q)}));return function(q){return $.apply(this,arguments)}}()},[T,l]);return Object(o.useEffect)(function(){var N,A;if(!z||!(t!=null&&(N=t.currentUser)!==null&&N!==void 0&&N.id)){var $;if(($=b.data)!==null&&$!==void 0&&$[0]){var q;C((q=b.data)===null||q===void 0?void 0:q[0].id)}return}C(t==null||(A=t.currentUser)===null||A===void 0?void 0:A.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,z]),Object(o.useEffect)(function(){Ce()},[Ce]),b.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(I.a.Item,{label:Object(e.jsx)(u.a,{id:"menu.Teacher"}),children:Object(e.jsx)(ht.a,{disabled:z,placeholder:Object(e.jsx)(u.a,{id:"select"}),options:H,value:T,onChange:function(A){return C(A)}})}),Object(e.jsx)(At.a,{}),h&&!p&&Object(e.jsx)(se.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(N,A){var $;return Object(e.jsxs)(Qe.a.Fragment,{children:[A>0&&Object(e.jsx)(At.a,{}),Object(e.jsx)(Ea,{subjectTutorGradeScale:N,onFormSubmit:Ne(($=p.grade_scale)!==null&&$!==void 0?$:[],N.s_subject_scale_form_id)})]},N.s_subject_scale_form_id)}):Object(e.jsx)(st.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(u.a,{id:"gradesScalesMissing"})})]})},Tn=s("qbNl"),Ta=s("JBPa"),Mn=s("Awhp"),Ma=s("KrTs"),Pa=s("wd/R"),dt=s.n(Pa);function Ia(c,r){return zt.apply(this,arguments)}function zt(){return zt=Object(W.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules",Object(d.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),zt.apply(this,arguments)}var Pn=s("5R/X"),Da=function(){var r=Object(o.useState)(null),a=Object(G.a)(r,2),n=a[0],t=a[1],i=Object(o.useState)([]),l=Object(G.a)(i,2),b=l[0],f=l[1],E=Object(he.b)(),p=E.semester_subject_id,x=dt()(),y=Object(o.useMemo)(function(){return b.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:dt()(C.date_from).toDate(),end:dt()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[b]),j=Object(o.useCallback)(function(C,z){Ia({semester_subject_id:p,date_form:C.toDate(),date_to:z.toDate()}).then(function(H){H.success&&f(H.data)})},[p]),h=Object(o.useCallback)(function(C){t(C)},[]),g=Object(o.useCallback)(function(){t(null)},[]),_=Object(o.useCallback)(function(C){return C.isSame(x,"day")?"warning":C.isAfter(x,"day")?"success":"error"},[]),P=Object(o.useCallback)(function(C){var z=y.filter(function(H){return dt()(H.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:z.map(function(H){return Object(e.jsx)("li",{onClick:function(){return h(H)},children:Object(e.jsx)(Ma.a,{status:_(dt()(H.start)),text:H.title})},H.id)})})},[b]),T=Object(o.useCallback)(function(C,z){var H=dt()(C).startOf(z).subtract(1,"month"),Ce=dt()(C).endOf(z).add(1,"month");j(H,Ce)},[]);return Object(o.useEffect)(function(){var C=dt()().startOf("month"),z=dt()().endOf("month");j(C,z)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Title,{level:4,children:Object(e.jsx)(u.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ta.a,{dateCellRender:P,onPanelChange:T}),Object(e.jsxs)(Re.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:g,footer:null,children:[Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&dt()(n.start).format(m.b)]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"end_at",defaultMessage:"End date"}),":",n&&dt()(n.end).format(m.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(st.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(je.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"msTeams"})})},"teamsLink")})]})]})},ra=s("yj/a"),sa=s("5Syx"),Tt=s("PpiC"),Jt=s("H6aw"),Ga=s("p3I6"),Ra=["results"],ua=function(r,a){return r.reduce(function(n,t){var i=t.results,l=Object(Tt.a)(t,Ra),b=i.find(function(f){return f.user_id===a});return b?[].concat(Object(ne.a)(n),[Object(d.a)(Object(d.a)({},l),{},{result:b})]):n},[])},ia=function(r,a){var n,t=r.reduce(function(j,h){var g=h.result,_=h.weight;return[j[0]+g.result*_,j[1]+_]},[0,0]),i=Object(G.a)(t,2),l=i[0],b=i[1],f=Number.isNaN(l/b)?0:l/b,E=a.sort(function(j,h){return j.grade_value-h.grade_value}).reduce(function(j,h){return[].concat(Object(ne.a)(j),[Object(d.a)(Object(d.a)({},h),{},{isWeightedAverageGreater:f>=h.grade_value})])},[]);if(E.every(function(j){var h=j.isWeightedAverageGreater;return h})){var p,x;return(p=(x=E.at(-1))===null||x===void 0?void 0:x.name)!==null&&p!==void 0?p:""}var y=E.findIndex(function(j){var h=j.isWeightedAverageGreater;return!h});return y<0?"":(n=E[y-1])===null||n===void 0?void 0:n.name},ca=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},La=["attendances"];function Fa(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],i=n[1];return Object(o.useEffect)(function(){i(function(l){return Object(d.a)(Object(d.a)({},l),{},{loading:!0})}),_a(c,r).then(function(l){l.success&&i(function(b){return Object(d.a)(Object(d.a)({},b),{},{data:l.data})})}).finally(function(){i(function(l){return Object(d.a)(Object(d.a)({},l),{},{loading:!1})})})},[r,c]),{finalGrades:t}}function Aa(){var c=Object(o.useState)({loading:!1}),r=Object(G.a)(c,2),a=r[0],n=r[1];return Object(o.useEffect)(function(){n(function(t){return Object(d.a)(Object(d.a)({},t),{},{loading:!0})}),ea().then(function(t){t.success&&n(function(i){return Object(d.a)(Object(d.a)({},i),{},{data:t.data})})}).finally(function(){n(function(t){return Object(d.a)(Object(d.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function $a(c){var r=Object(o.useState)({loading:!1}),a=Object(G.a)(r,2),n=a[0],t=a[1];return Object(o.useEffect)(function(){c!==void 0&&(t(function(i){return Object(d.a)(Object(d.a)({},i),{},{loading:!0})}),ta(c).then(function(i){i.success&&t(function(l){return Object(d.a)(Object(d.a)({},l),{},{data:i.data})})}).finally(function(){t(function(i){return Object(d.a)(Object(d.a)({},i),{},{loading:!1})})}))},[c]),{subjectGradeScales:n}}function Ua(c,r,a){var n=Object(o.useState)({loading:!1}),t=Object(G.a)(n,2),i=t[0],l=t[1];return Object(o.useEffect)(function(){typeof c!="number"||typeof r!="number"||typeof a!="number"||(l(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!0})}),$t(c,r).then(function(b){b.success&&l(function(f){var E,p;return Object(d.a)(Object(d.a)({},f),{},{data:(E=ca(a,(p=b.data.grade_scale)!==null&&p!==void 0?p:[]))===null||E===void 0?void 0:E.map(function(x,y){return Object(d.a)(Object(d.a)({},x),{},{id:y})})})})}).finally(function(){l(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!1})})}))},[c,r]),{tutorGradeScales:i}}function wa(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],i=n[1],l=Object(o.useCallback)(function(){i(function(f){return Object(d.a)(Object(d.a)({},f),{},{loading:!0})}),Rt(c).then(function(f){if(f.success){var E=f.data.reduce(function(p,x){var y=x.attendances,j=Object(Tt.a)(x,La),h=y.find(function(g){return g.user_id===r});return h?[].concat(Object(ne.a)(p),[Object(d.a)(Object(d.a)({},j),{},{attendance:h})]):p},[]);i(function(p){return Object(d.a)(Object(d.a)({},p),{},{data:E})})}}).finally(function(){i(function(f){return Object(d.a)(Object(d.a)({},f),{},{loading:!1})})})},[c,r]),b=Object(o.useCallback)(function(f,E){i(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!0})}),Xt(f,r,E).then(function(p){p.success?bt.b.success(p.message):bt.b.error(p.message)}).finally(function(){l(),i(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!1})})})},[l,r]);return Object(o.useEffect)(function(){l()},[l]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:l,updateUserAttendanceSchedules:b}}function Na(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],i=n[1];return Object(o.useEffect)(function(){!r||(i(function(l){return Object(d.a)(Object(d.a)({},l),{},{loading:!0})}),Ve({student_id:c,semester_subject_id:r}).then(function(l){if(l.success){var b=ua(l.data,c);i(function(f){return Object(d.a)(Object(d.a)({},f),{},{data:b})})}}).finally(function(){i(function(l){return Object(d.a)(Object(d.a)({},l),{},{loading:!1})})}))},[c,r]),{studentExams:t}}function Ba(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],i=n[1],l=Object(o.useState)({loading:!1}),b=Object(G.a)(l,2),f=b[0],E=b[1],p=Object(o.useState)({loading:!1}),x=Object(G.a)(p,2),y=x[0],j=x[1];return Object(o.useEffect)(function(){i(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!0})}),Object(Jt.e)({group_id:c}).then(function(h){h.success&&i(function(g){return Object(d.a)(Object(d.a)({},g),{},{data:h.data})})}).finally(function(){i(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!1})})})},[c]),Object(o.useEffect)(function(){!t.data||(j(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!0})}),Promise.all(t.data.map(function(h){var g=h.id;return Object(Jt.m)(Number(g))})).then(function(h){h.forEach(function(g){g.success&&j(function(_){return Object(d.a)(Object(d.a)({},_),{},{data:Object(d.a)(Object(d.a)({},_.data),{},Object(xt.a)({},Number(g.data.id),Object(Ga.c)(g.data.lessons)))})})})}).finally(function(){j(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!1})})}),E(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!0})}),Promise.all(t.data.map(function(h){var g=h.id;return Object(Jt.l)(Number(g),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(_){if(_.success){var P,T,C=((P=_.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&P!==void 0?P:[]).filter(function(H){return H.id===r}),z=(T=_.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&T!==void 0?T:[];E(function(H){return Object(d.a)(Object(d.a)({},H),{},{data:Object(d.a)(Object(d.a)({},H.data),{},Object(xt.a)({},Number(g),{finishedTopics:C,attendanceList:z}))})})}})})).finally(function(){return E(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:f,userCoursesTopics:y}}var Ka=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Wa=[{title:Object(e.jsx)(u.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(He.a)(new Date(a.date_from),m.c)}}],Va=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(He.a)(new Date(a.created_at),m.c)}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],Ha=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(He.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),m.c):"-"}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],Mt=6,za=function(r){var a,n,t,i,l=r.user_id,b=r.group_id,f=Object(he.b)(),E=f.semester_subject_id,p=Na(l,E),x=p.studentExams,y=Fa(b,l),j=y.finalGrades,h=Aa(),g=h.gradeTerms,_=$a((a=j.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),P=_.subjectGradeScales,T=Ua(E,(n=j.data)===null||n===void 0?void 0:n.tutor_id,(t=j.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),C=T.tutorGradeScales,z=wa(b,l),H=z.userAttendanceSchedules,Ce=z.updateUserAttendanceSchedules,Ne=Ba(b,l),N=Ne.userCourses,A=Ne.userCoursesStats,$=Ne.userCoursesTopics,q=I.a.useForm(),Xe=Object(G.a)(q,1),at=Xe[0],be=Object(o.useMemo)(function(){var ae;return((ae=g.data)!==null&&ae!==void 0?ae:[]).map(function(B){var fe=B.id,Ee=B.name;return{label:Ee,value:fe}})},[g.data]),ve=Object(o.useMemo)(function(){var ae;return((ae=P.data)!==null&&ae!==void 0?ae:[]).map(function(B){var fe=B.name,Ee=B.id;return{label:fe,value:Ee}})},[P.data]),Z=Object(o.useMemo)(function(){var ae,B;return ia((ae=x.data)!==null&&ae!==void 0?ae:[],(B=C.data)!==null&&B!==void 0?B:[])},[x.data,C.data]),Be=Object(o.useCallback)(function(){var ae=Object(W.a)(Object(S.a)().mark(function B(fe){var Ee,Je,ut,lt,mt,Ae,Ye;return Object(S.a)().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(ut=fe.grade_scale_id,lt=fe.grade_term_id,((Ee=j.data)===null||Ee===void 0?void 0:Ee.id)!==void 0){qe.next=3;break}return qe.abrupt("return");case 3:if(mt=(Je=j.data)===null||Je===void 0?void 0:Je.grades.find(function(yt){var Et=yt.grade_term;return Et.id===lt}),!mt){qe.next=11;break}return qe.next=7,na(mt.id,{grade_scale_id:ut});case 7:return Ae=qe.sent,bt.b[Ae.success?"success":"error"](Ae.message),Ae.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades")),qe.abrupt("return");case 11:return qe.next=13,aa({grade_scale_id:ut,grade_term_id:lt,lesson_group_user_id:j.data.id});case 13:Ye=qe.sent,bt.b[Ye.success?"success":"error"](Ye.message),Ye.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades"));case 16:case"end":return qe.stop()}},B)}));return function(B){return ae.apply(this,arguments)}}(),[j.data,E]),et=Object(o.useMemo)(function(){var ae;return((ae=g.data)!==null&&ae!==void 0?ae:[]).map(function(B){var fe;return Object(d.a)(Object(d.a)({},B),{},{grade:(fe=j.data)===null||fe===void 0?void 0:fe.grades.find(function(Ee){var Je=Ee.grade_term;return Je.id===B.id})})})},[j.data,g.data]),Ke=N.loading&&!N.data||A.loading&&!A.data||$.loading&&!$.data,nt=Boolean(N.data&&A.data&&$.data);return j.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[j.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Student",values:j.data.user})}),Object(e.jsx)(At.a,{})]}),Object(e.jsxs)(ft.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:x.data,loading:x.loading,columns:Va,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:et,loading:j.loading||g.loading,columns:Ha,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:H.data,loading:H.loading,columns:[].concat(Wa,[{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(B,fe){return Object(e.jsx)(Qt.a,{onChange:function(Je){return Ce(fe.id,Je.target.checked?R.a.PRESENT:R.a.ABSENT)},checked:fe.attendance.value===R.a.PRESENT})}}])})}),Object(e.jsx)(D.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:C.data,loading:C.loading,columns:Ka})}),Ke&&Object(e.jsx)(se.a,{}),nt&&((i=N.data)===null||i===void 0?void 0:i.map(function(ae){var B,fe,Ee,Je,ut,lt,mt,Ae,Ye=ae.id,ot=ae.title;return Object(e.jsxs)(D.a,{span:24,children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:ot}),Object(e.jsx)(sa.c,{course_id:Number(Ye),topics:(B=(fe=$.data)===null||fe===void 0?void 0:fe[Number(Ye)])!==null&&B!==void 0?B:[],stats:(Ee=(Je=A.data)===null||Je===void 0||(ut=Je[Number(Ye)])===null||ut===void 0?void 0:ut.finishedTopics)!==null&&Ee!==void 0?Ee:[]}),Object(e.jsx)(sa.a,{stats:(lt=(mt=A.data)===null||mt===void 0||(Ae=mt[Number(Ye)])===null||Ae===void 0?void 0:Ae.attendanceList)!==null&&lt!==void 0?lt:[]})]},Ye)}))]}),Object(e.jsx)(I.a,{form:at,onFinish:Be,children:Object(e.jsxs)(I.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(ra.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:be,width:"sm",fieldProps:{loading:g.loading}}),Object(e.jsx)(ra.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ve,fieldProps:{loading:j.loading||P.loading}}),Object(e.jsx)(I.a.Item,{children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Z}})})]})})]})},Ja=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(u.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,i=n.grade_term,l=n.id;return Object(e.jsxs)(st.a.Text,{children:[i.name,": ",t]},l)}):"-"})}}],Ya=function(){var r,a,n=Object(v.k)(),t=Object(o.useMemo)(function(){var x,y,j,h;return{user_id:Number.isNaN(Number((x=n.query)===null||x===void 0?void 0:x.user_id))?null:Number((y=n.query)===null||y===void 0?void 0:y.user_id),group_id:Number.isNaN(Number((j=n.query)===null||j===void 0?void 0:j.group_id))?null:Number((h=n.query)===null||h===void 0?void 0:h.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),i=t.user_id,l=t.group_id,b=Object(he.b)(),f=b.teacherSubjectData,E=b.semester_subject_id,p=Object(o.useMemo)(function(){var x;return((x=f==null?void 0:f.groups)!==null&&x!==void 0?x:[]).map(function(y){var j=y.id,h=y.name;return{label:h,value:j}})},[f==null?void 0:f.groups]);return i!==null&&l!==null?Object(e.jsx)(za,{user_id:i,group_id:l}):Object(e.jsx)(U.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var x=Object(W.a)(Object(S.a)().mark(function y(j){var h,g,_,P,T,C,z,H,Ce,Ne;return Object(S.a)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return g=j.group_id,_=g===void 0?[]:g,P=j.first_name,T=P===void 0?"":P,C=j.last_name,z=C===void 0?"":C,H=((h=f==null?void 0:f.groups)!==null&&h!==void 0?h:[]).map(function($){var q=$.id;return q}),A.next=4,qt(_.length===0?H:_);case 4:if(Ce=A.sent,Ce.success){A.next=7;break}return A.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ne=Ce.data.filter(function($){var q=$.user;return q.first_name.toLowerCase().includes(T.toLowerCase())&&q.last_name.toLowerCase().includes(z.toLowerCase())}),A.abrupt("return",{success:!0,total:Ne.length,data:Ne});case 9:case"end":return A.stop()}},y)}));return function(y){return x.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(y,j){return Object(e.jsx)(ie.a,{type:"Students",type_id:j.group_id},j.group_id)}}].concat(Ja,[{title:Object(e.jsx)(u.a,{id:"options"}),hideInSearch:!0,render:function(y,j){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(j.user.id,"&group_id=").concat(j.group_id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"edit"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(We.a,{})})})},"edit")]}}])})},Za=s("dF/Y"),Xa=s("o+0V"),da=s("0WSk"),Qa=["type","defaultRender"],ka=["type","defaultRender"],qa=function(r){var a=r.url;return Object(e.jsx)(ke.a,{title:Object(e.jsx)(u.a,{id:"download"}),children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Za.a,{})})})},en=[{title:Object(e.jsx)(u.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(He.a)(new Date(a.created_at),m.a)}},{title:Object(e.jsx)(u.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,i=a.defaultRender,l=Object(Tt.a)(a,Qa);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(da.a,Object(d.a)(Object(d.a)({},l),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(ie.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(u.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(He.a)(new Date(a.exported_at),m.a)}},{title:Object(e.jsx)(u.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,i=a.defaultRender,l=Object(Tt.a)(a,ka);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(da.a,Object(d.a)(Object(d.a)({},l),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(ie.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(u.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(qa,{url:a.url},"download")]}}],tn=function(){var r,a,n=Object(he.b)(),t=n.teacherSubjectData,i=Object(o.useMemo)(function(){var b;return((b=t==null?void 0:t.groups)!==null&&b!==void 0?b:[]).map(function(f){var E=f.id,p=f.name;return{value:E,label:p}})},[t==null?void 0:t.groups]),l=Object(o.useMemo)(function(){var b,f;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:i,defaultValue:t==null||(b=t.groups)===null||b===void 0||(f=b[0])===null||f===void 0?void 0:f.id,allowClear:!1}}].concat(en)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,i]);return Object(e.jsx)(U.a,{className:"table-standalone",request:function(){var b=Object(W.a)(Object(S.a)().mark(function f(E){var p,x,y,j,h,g,_;return Object(S.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return y=E.group_id,j=y===void 0?t==null||(p=t.groups)===null||p===void 0||(x=p[0])===null||x===void 0?void 0:x.id:y,h=E.created_by,g=E.exported_by,T.next=3,Object(Xa.a)({group_id:j,created_by:h,exported_by:g});case 3:if(_=T.sent,_.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:_.data,total:_.data.length});case 7:case"end":return T.stop()}},f)}));return function(f){return b.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500}})},an=function(r,a){var n;return(n=r.find(function(t){return t.name===a}))===null||n===void 0?void 0:n.id},nn=function(r){var a=r.term,n=r.gradeScales,t=r.defaultFinalGrade,i=r.finalGrades,l=Object(o.useState)(t),b=Object(G.a)(l,2),f=b[0],E=b[1],p=Object(o.useState)(!1),x=Object(G.a)(p,2),y=x[0],j=x[1],h=Object(o.useMemo)(function(){return n.map(function(_){var P=_.name,T=_.id;return{value:T,label:P}})},[n]),g=Object(o.useCallback)(function(_){if(!!(i!=null&&i.id)){if(f){j(!0),na(f.id,{grade_scale_id:_}).finally(function(){return j(!1)});return}j(!0),aa({grade_term_id:a.id,grade_scale_id:_,lesson_group_user_id:i.id}).then(function(P){if(P.success){var T=P.data.grades.find(function(C){return C.grade_term.id===a.id});E(T)}}).finally(function(){return j(!1)})}},[f,a.id,i==null?void 0:i.id]);return i?Object(e.jsx)(ht.a,{loading:y,disabled:y,placeholder:Object(e.jsx)(u.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:g,options:h,defaultValue:an(n,t==null?void 0:t.grade_name)}):null},rn=s("LvDl"),sn=function(r){var a=r.exam_id,n=r.result,t=r.student_id,i=r.onSuccess,l=Object(o.useCallback)(Object(rn.debounce)(function(b){Ze(a,t,{result:b!=null?b:0}).then(function(f){f.success&&(i==null||i(f.data))})},300),[a,n,t]);return Object(e.jsx)(L.a,{type:"number",min:0,max:100,onChange:l,defaultValue:n})},un=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{title:Object(He.a)(new Date(t.date_from),m.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(l,b){return Object(e.jsx)(kt,{groupAttendanceScheduleId:t.id,defaultChecked:b["attendance-".concat(t==null?void 0:t.date_from)]===R.a.PRESENT,studentId:b.id})}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},cn=function(r,a){return r.reduce(function(n,t){var i=t.attendances.find(function(l){return l.user_id===a});return i?Object(d.a)(Object(d.a)({},n),{},Object(xt.a)({},"attendance-".concat(t.date_from),i.value)):n},{})},dn=function(r){var a=r.reduce(function(n,t){return[].concat(Object(ne.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(u.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(l,b){var f;return(b==null||(f=b["exam-".concat(t.id)])===null||f===void 0?void 0:f.result)!==void 0?Object(e.jsx)(sn,{result:b==null?void 0:b["exam-".concat(t.id)].result,exam_id:t.id,student_id:b.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},ln=function(r){return r.reduce(function(a,n){var t=n.result,i=n.id;return Object(d.a)(Object(d.a)({},a),{},Object(xt.a)({},"exam-".concat(i),t))},{})},on=function(r,a){return{title:Object(e.jsx)(u.a,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(i,l){return Object(e.jsx)(nn,{defaultFinalGrade:l["final-grade-".concat(n.id)],finalGrades:l.final_grades,term:n,gradeScales:a})}}})}},jn=function(r,a){return r.find(function(n){return n.user.id===a})},bn=function(r){var a;return((a=r==null?void 0:r.grades)!==null&&a!==void 0?a:[]).reduce(function(n,t){return Object(d.a)(Object(d.a)({},n),{},Object(xt.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},vn=function(){var r,a,n=Object(he.b)(),t=n.teacherSubjectData,i=n.semester_subject_id,l=Object(o.useState)([]),b=Object(G.a)(l,2),f=b[0],E=b[1],p=Object(o.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),x=Object(G.a)(p,2),y=x[0],j=x[1],h=Object(u.l)(),g=Object(o.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(C){var z=C.id,H=C.name;return{value:z,label:H}})},[t==null?void 0:t.groups]),_=Object(o.useRef)(),P=Object(o.useMemo)(function(){var T;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:g,defaultValue:g==null||(T=g[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(f))},[g,f]);return Object(e.jsx)(U.a,{className:"table-standalone",request:function(){var T=Object(W.a)(Object(S.a)().mark(function C(z){var H,Ce,Ne,N,A,$,q,Xe,at,be,ve,Z,Be,et,Ke,nt,ae,B,fe,Ee,Je,ut,lt;return Object(S.a)().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return $=z.group_id,q=$===void 0?(H=g[0])===null||H===void 0?void 0:H.value:$,Xe=z.full_name,at=Xe===void 0?"":Xe,Ae.next=3,qt(q);case 3:if(be=Ae.sent,ve=g.find(function(Ye){var ot=Ye.value;return ot===q}),!(!be.success||be.data[0]===void 0||i===null)){Ae.next=8;break}return bt.b.error(h.formatMessage({id:"groupDataMissing"},{group_name:ve==null?void 0:ve.label})),Ae.abrupt("return",{data:[],total:0,success:!1});case 8:return Ae.next=10,Promise.all([Object(gt.b)(q),Rt(q),Ve({group_id:q,per_page:-1}),$t(i,(Ce=be.data)===null||Ce===void 0||(Ne=Ce[0])===null||Ne===void 0?void 0:Ne.tutor_id),ea(),ta((N=be.data)===null||N===void 0||(A=N[0])===null||A===void 0?void 0:A.s_subject_scale_form_id)]);case 10:if(Z=Ae.sent,Be=Object(G.a)(Z,6),et=Be[0],Ke=Be[1],nt=Be[2],ae=Be[3],B=Be[4],fe=Be[5],!(!et.success||!Ke.success||!nt.success||!ae.success||!B.success||!fe.success||!ve)){Ae.next=21;break}return bt.b.error(h.formatMessage({id:"groupDataMissing"},{group_name:ve==null?void 0:ve.label})),Ae.abrupt("return",{data:[],total:0,success:!1});case 21:return j(ve.label),Ee=un(Ke.data),Je=dn(nt.data),ut=on(B.data,fe.data),E([Ee,Je,ut,{title:Object(e.jsx)(u.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),lt=et.data.users.reduce(function(Ye,ot){var qe,yt,Et,Pt=ot.id,mn=ot.academic_teacher_id,On=ot.first_name,hn=ot.last_name,la="".concat(hn," ").concat(On);if(mn!==null||!la.toLowerCase().includes(at.toLowerCase()))return Ye;var pn=cn(Ke.data,Pt),oa=ua(nt.data,Pt),Ct=jn(be.data,Pt),gn=(qe=ca((yt=Ct==null?void 0:Ct.s_subject_scale_form_id)!==null&&yt!==void 0?yt:0,(Et=ae.data.grade_scale)!==null&&Et!==void 0?Et:[]))!==null&&qe!==void 0?qe:[],xn=ia(oa,gn),Sn=ln(oa),_n=bn(Ct);return[].concat(Object(ne.a)(Ye),[Object(d.a)(Object(d.a)(Object(d.a)(Object(d.a)({id:Pt,full_name:la},pn),Sn),_n),{},{proposed_grade:xn,final_grades:Ct})])},[]).sort(function(Ye,ot){return Ye.full_name.localeCompare(ot.full_name)}),Ae.abrupt("return",{data:lt,total:lt.length,success:!0});case 28:case"end":return Ae.stop()}},C)}));return function(C){return T.apply(this,arguments)}}(),columns:P,headerTitle:Object(e.jsx)(u.a,{id:"classRegisterTitleWithGroupName",values:{groupName:y}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:_,pagination:{onChange:function(){var C;return(C=_.current)===null||C===void 0?void 0:C.reload()}},rowKey:"id"})},fn=function(r){var a,n,t=r.tab,i=Object(u.l)(),l=Object(u.m)("@@initialState"),b=l.setInitialState,f=l.initialState,E=Object(he.b)(),p=E.teacherSubjectData,x=E.semester_subject_id,y=E.tutors,j=Object(o.useCallback)(Object(ce.a)(f==null?void 0:f.currentUser),[f==null?void 0:f.currentUser]),h=Object(o.useMemo)(function(){return!!y.data.find(function(g){var _,P=g.id;return P===(f==null||(_=f.currentUser)===null||_===void 0?void 0:_.id)})||j(Oe.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)($e.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(u.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(u.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(x,"/exams?exam_id=new"),children:Object(e.jsx)(je.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:i.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:i.formatMessage({id:"Subjects"})},{path:String(x),breadcrumbName:String((n=p.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:i.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(K.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(_){b(Object(d.a)({},f)),u.f.push("/teacher/subjects/".concat(x,"/").concat(_))}},children:[Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"groups"}),children:Object(e.jsx)(rt.a,{})},"groups"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"students"}),children:Object(e.jsx)(Oa,{})},"students"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"exams"}),children:Object(e.jsx)(_t,{})},"exams"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"schedule"}),children:Object(e.jsx)(Da,{})},"schedule"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"class-register"}),children:Object(e.jsx)(vn,{})},"class-register"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"attendance"}),children:Object(e.jsx)(pa,{})},"attendance"),h&&Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"grades-scale"}),children:Object(e.jsx)(Ca,{})},"grades-scale"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"final-grades"}),children:Object(e.jsx)(Ya,{})},"final-grades"),Object(e.jsx)(K.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"file-exports-history"}),children:Object(e.jsx)(tn,{})},"file-exports-history")]})}):Object(e.jsx)(se.a,{})},In=me.default=function(){var c=Object(v.l)(),r=c.subjectId,a=c.tab,n=a===void 0?"groups":a;return Object(e.jsx)(he.a,{semester_subject_id:Number(r),children:Object(e.jsx)(fn,{tab:n})})}},p3I6:function(Ot,me,s){"use strict";s.d(me,"b",function(){return ce}),s.d(me,"c",function(){return we}),s.d(me,"a",function(){return it});var d=s("miYZ"),_e=s("tsqr"),je=s("tJVT"),M=s("k1fw"),se=s("oBTY"),o=s("q1tI"),Qe=s.n(o),u=s("9kvl"),Te=s("Ty5D"),v=s("H6aw"),K=s("/y+f"),$e=s("nKUr"),Oe=s.n($e),ce=Qe.a.createContext({}),he=function(){return Math.round(Math.random()*99999)},rt=function pe(de){return de.reduce(function(k,O){return[].concat(Object(se.a)(k),Object(se.a)(O.lessons?pe(O.lessons):[]),[O])},[])},we=function pe(de){return de.reduce(function(k,O){var J;return[].concat(Object(se.a)(k),Object(se.a)(O.lessons?pe(O.lessons):[]),Object(se.a)((J=O.topics)!==null&&J!==void 0?J:[]))},[])},jt=function pe(de,k,O){return de.map(function(J){var Ie,U;return Object(M.a)(Object(M.a)({},J),{},{lessons:J.lessons?pe(J.lessons,k,O):[],topics:J.id===k?[].concat(Object(se.a)((Ie=J.topics)!==null&&Ie!==void 0?Ie:[]),[O]):(U=J.topics)!==null&&U!==void 0?U:[]})})},vt=function pe(de,k,O){return O?de.map(function(J){return Object(M.a)(Object(M.a)({},J),{},{lessons:[].concat(Object(se.a)(J.lessons?pe(J.lessons,k,O):[]),Object(se.a)(J.id===O?[k]:[]))})}):[].concat(Object(se.a)(de),[k])},ke=function pe(de,k,O){return de.map(function(J){return Object(M.a)(Object(M.a)({},J.id===k?O:J),{},{lessons:J.lessons?pe(J.lessons,k,O):[]})})},S=function pe(de,k){return de.map(function(O){return Object(M.a)(Object(M.a)({},O),{},{parent_id:k,lessons:O.lessons?pe(O.lessons,O.id):[]})})},W=function pe(de,k){return de.filter(function(O){return O.id!==k}).map(function(O){return Object(M.a)(Object(M.a)({},O),{},{lessons:O.lessons?pe(O.lessons,k):[]})})},He=function pe(de,k){return de.map(function(O){return Object(M.a)(Object(M.a)({},O),{},{lessons:O.lessons?pe(O.lessons,k):[],topics:O.topics?O.topics.filter(function(J){return J.id!==k}):[]})})},We=function pe(de,k,O,J){return J==null?void 0:J.map(function(Ie){if(Ie.id===O){var U;return Object(M.a)(Object(M.a)({},Ie),{},{topics:(U=Ie.topics)===null||U===void 0?void 0:U.map(function(m){return m.id===de?k.file.response.data:m})})}else if(Ie.lessons)return Object(M.a)(Object(M.a)({},Ie),{},{lessons:pe(de,k,O,Ie.lessons||[])});return Ie})},it=function(de){var k=de.children,O=de.id,J=Object(o.useState)(),Ie=Object(je.a)(J,2),U=Ie[0],m=Ie[1],Ve=Object(u.l)(),Ue=Object(o.useMemo)(function(){return U&&U.lessons?we(U.lessons):[]},[U]),le=Object(o.useMemo)(function(){return U&&U.lessons?rt(U.lessons):[]},[U]),De=Object(o.useState)([]),Me=Object(je.a)(De,2),Ge=Me[0],ge=Me[1],ee=Object(Te.k)();Object(o.useEffect)(function(){ge([])},[]);var ye=Object(o.useCallback)(function(){Object(v.m)(O).then(function(D){return D.success&&m(Object(M.a)(Object(M.a)({},D.data),{},{lessons:S(D.data.lessons)}))})},[O]);Object(o.useEffect)(function(){ye()},[ye]);var xe=Object(o.useCallback)(function(D){var I=le.find(function(V){var w;return V==null||(w=V.topics)===null||w===void 0?void 0:w.find(function(R){return R.id===D})});return I?I.id:null},[le]),Ze=Object(o.useMemo)(function(){var D,I;return(D=ee.query)!==null&&D!==void 0&&D.lesson?{mode:"lesson",id:Number(ee.query.lesson),value:le.find(function(V){return V.id===Number(ee.query.lesson)})}:(I=ee.query)!==null&&I!==void 0&&I.topic?{mode:"topic",id:Number(ee.query.topic),value:Ue.find(function(V){return V.id===Number(ee.query.topic)})}:{mode:"init"}},[ee.query,U,le,Ue]),ze=Object(o.useCallback)(function(D){var I={course_id:O,topics:[],isNew:!0,id:U?U.lessons.length+1:he(),order:0,title:Ve.formatMessage({id:"add_title_here"}),active:!0,parent_id:D};return m(function(V){var w;return Object(M.a)(Object(M.a)({},V),{},{lessons:vt((w=V==null?void 0:V.lessons)!==null&&w!==void 0?w:[],I,D)})}),I},[O,U]),Se=Object(o.useCallback)(function(D,I){var V=le.find(function(R){return R.id===D}),w=V&&V.isNew;return(w?Object(v.g)(I):Object(v.u)(D,I)).then(function(R){return _e.b.success(R.message),ye(),R.success&&m(function(Y){var Re;return Object(M.a)(Object(M.a)({},Y),{},{lessons:ke((Re=Y==null?void 0:Y.lessons)!==null&&Re!==void 0?Re:[],D,Object(M.a)(Object(M.a)({},R.data),{},{isNew:!1}))})})})},[U]),ue=Object(o.useCallback)(function(D){var I=le.find(function(w){return w.id===D});if(!!I){var V=I.isNew;V?m(function(w){var R;return Object(M.a)(Object(M.a)({},w),{},{lessons:W((R=w==null?void 0:w.lessons)!==null&&R!==void 0?R:[],D)})}):Object(v.o)(D).then(function(w){w.success&&(_e.b.success(w.message),m(function(R){var Y;return Object(M.a)(Object(M.a)({},R),{},{lessons:W((Y=R==null?void 0:R.lessons)!==null&&Y!==void 0?Y:[],D)})}))})}},[U]),ie=Object(o.useCallback)(function(D,I){var V,w=xe(D),R=le.find(function(ne){return ne.id===w}),Y=R&&((V=R.topics)===null||V===void 0?void 0:V.find(function(ne){return ne.id===D})),Re=Y==null?void 0:Y.isNew;return(Re?Object(v.h)(I):Object(v.v)(D,I)).then(function(ne){ne.success&&(_e.b.success(ne.message),ye(),u.f.push("/courses/list/".concat(O,"/program/?topic=").concat(ne.data.id)),(Y==null?void 0:Y.topicable_type)===K.f.Video&&setTimeout(function(){ye()},5e3))})},[xe,U,ye]),F=Object(o.useCallback)(function(D){var I=xe(D),V=le.find(function(Y){return Y.id===I});if(!!V){var w=Ue==null?void 0:Ue.find(function(Y){return Y.id===D}),R=w==null?void 0:w.isNew;R&&!w.topicable?m(function(Y){var Re;return Object(M.a)(Object(M.a)({},Y),{},{lessons:He((Re=Y==null?void 0:Y.lessons)!==null&&Re!==void 0?Re:[],D)})}):Object(v.p)(D).then(function(Y){Y.success&&(_e.b.success(Y.message),m(function(Re){var ne;return Object(M.a)(Object(M.a)({},Re),{},{lessons:He((ne=Re==null?void 0:Re.lessons)!==null&&ne!==void 0?ne:[],D)})}))})}},[U,xe]),L=Object(o.useCallback)(function(D,I){var V={lesson_id:D,isNew:!0,id:he(),title:Ve.formatMessage({id:"add_title_here"}),active:!0,topicable_type:I};return m(function(w){var R;return Object(M.a)(Object(M.a)({},w),{},{lessons:jt((R=w==null?void 0:w.lessons)!==null&&R!==void 0?R:[],D,V)})}),V},[]),G=function(I,V){var w=xe(I);m(function(R){return Object(M.a)(Object(M.a)({},R),{},{lessons:R?We(I,V,w,R.lessons||[]):[]})}),u.f.push("/courses/list/".concat(O,"/program/?topic=").concat(V.file.response.data.id))},X=Object(o.useCallback)(function(D){return Object(v.d)(D).then(function(I){if(I.success){_e.b.success(I.message);var V=xe(D);m(function(w){var R;return Object(M.a)(Object(M.a)({},w),{},{lessons:w?(R=w.lessons)===null||R===void 0?void 0:R.map(function(Y){if(Y.id===V){var Re=Y.topics||[];return Object(M.a)(Object(M.a)({},Y),{},{topics:[].concat(Object(se.a)(Re),[I.data])})}return Y}):[]})})}})},[U,xe]),ft=Object(o.useCallback)(function(D){return Object(v.c)(D).then(function(I){I.success&&(_e.b.success(I.message),m(function(V){return Object(M.a)(Object(M.a)({},V),{},{lessons:V?[].concat(Object(se.a)(V.lessons),[I.data]):[]})}))})},[]),tt={state:U,h5ps:Ge,id:O,addNewLesson:ze,updateLesson:Se,updateTopic:ie,deleteLesson:ue,addNewTopic:L,deleteTopic:F,onTopicUploaded:G,cloneTopic:X,cloneLesson:ft,currentEditMode:Ze,getLessons:ye};return Object($e.jsx)(ce.Provider,{value:tt,children:k})}},"w/VK":function(Ot,me,s){"use strict";s.d(me,"b",function(){return se}),s.d(me,"a",function(){return Qe});var d=s("qLMh"),_e=s("k1fw"),je=s("9og8"),M=s("9kvl");function se(Te,v){return o.apply(this,arguments)}function o(){return o=Object(je.a)(Object(d.a)().mark(function Te(v,K){return Object(d.a)().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return Oe.abrupt("return",Object(M.i)("/api/admin/reports/report",Object(_e.a)({params:v,method:"GET",useCache:!1},K||{})));case 1:case"end":return Oe.stop()}},Te)})),o.apply(this,arguments)}function Qe(Te,v,K){return u.apply(this,arguments)}function u(){return u=Object(je.a)(Object(d.a)().mark(function Te(v,K,$e){return Object(d.a)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.abrupt("return",Object(M.i)("/api/admin/stats/course/".concat(v,"/export"),Object(_e.a)({params:K,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},$e||{})));case 1:case"end":return ce.stop()}},Te)})),u.apply(this,arguments)}}}]);
