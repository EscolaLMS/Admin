{"version":3,"file":"p__Logs__index.2d53af1c.async.js","mappings":"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","sources":["webpack://ant-design-pro/./src/services/escola-lms/tracker.ts","webpack://ant-design-pro/./src/components/LogsWidget/index.tsx","webpack://ant-design-pro/./src/pages/Logs/index.tsx"],"sourcesContent":["import type { AxiosRequestConfig } from '@umijs/max';\nimport { request } from 'umi';\n\n/**  GET /api/admin/track/routes */\nexport async function track(\n  params: API.PaginationParams & {\n    current?: number;\n    pageSize?: number;\n    date_from?: string;\n    date_to?: string;\n    user_id?: number;\n    path?: string;\n    method: 'string';\n  },\n  options?: AxiosRequestConfig,\n) {\n  return request<API.DefaultMetaResponse<EscolaLms.Tracker.Models.TrackRoute>>(\n    `/api/admin/tracks/routes`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      params: {\n        ...params,\n        per_page: params.pageSize,\n        page: params.current,\n      },\n      ...(options || {}),\n    },\n  );\n}\n","import TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport UserSelect from '@/components/UserSelect';\nimport { DATETIME_FORMAT } from '@/consts/dates';\nimport { track } from '@/services/escola-lms/tracker';\nimport type { ActionType, ProColumns } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { format } from 'date-fns';\nimport React, { useRef, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\n\nexport const TableColumns: ProColumns<EscolaLms.Tracker.Models.TrackRoute>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'id',\n    hideInSearch: true,\n    sorter: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"dateRange\" defaultMessage=\"Date Range\" />,\n    dataIndex: 'dateRange',\n    hideInSearch: false,\n    hideInForm: true,\n    hideInTable: true,\n    valueType: 'dateRange',\n    fieldProps: {\n      allowEmpty: [true, true],\n    },\n  },\n  {\n    title: <FormattedMessage id=\"http_method\" defaultMessage=\"http_method\" />,\n    dataIndex: 'method',\n    hideInSearch: false,\n    sorter: true,\n    valueEnum: {\n      GET: 'GET',\n      POST: 'POST',\n      PUT: 'PUT',\n      DELETE: 'DELETE',\n      PATCH: 'PATCH',\n    },\n  },\n  {\n    title: <FormattedMessage id=\"path\" defaultMessage=\"path\" />,\n    dataIndex: 'path',\n    sorter: true,\n    hideInSearch: false,\n  },\n];\n\nconst LogsWidget: React.FC<{ useAsWidget?: boolean; userID?: number }> = ({\n  useAsWidget,\n  userID,\n}) => {\n  const actionRef = useRef<ActionType>();\n  const [loading, setLoading] = useState(false);\n  const intl = useIntl();\n  return (\n    <ProTable<\n      EscolaLms.Tracker.Models.TrackRoute,\n      API.PageParams & {\n        user_id?: number;\n        method: 'string';\n        dateRange: [string, string];\n        path: string;\n      }\n    >\n      headerTitle={intl.formatMessage({\n        id: 'menu.Analytics.Logs',\n        defaultMessage: 'menu.Analytics.Logs',\n      })}\n      loading={loading}\n      actionRef={actionRef}\n      rowKey=\"id\"\n      search={{\n        layout: 'vertical',\n      }}\n      request={({ user_id, method, dateRange, path, pageSize, current }, sort) => {\n        const sortArr = sort && Object.entries(sort)[0];\n        setLoading(true);\n        const date_from =\n          dateRange && dateRange[0] ? format(new Date(dateRange[0]), DATETIME_FORMAT) : undefined;\n        const date_to =\n          dateRange && dateRange[1] ? format(new Date(dateRange[1]), DATETIME_FORMAT) : undefined;\n\n        return track({\n          user_id: useAsWidget ? userID : user_id,\n          method,\n          pageSize,\n          current,\n          path,\n          date_from,\n          date_to,\n          order_by: sortArr && sortArr[0],\n          order: sortArr ? (sortArr[1] === 'ascend' ? 'ASC' : 'DESC') : undefined,\n        }).then((response) => {\n          setLoading(false);\n          if (response.success) {\n            return {\n              data: response.data,\n              total: response.meta.total,\n              success: true,\n            };\n          }\n          return [];\n        });\n      }}\n      columns={[\n        ...TableColumns,\n        {\n          title: <FormattedMessage id=\"user\" defaultMessage=\"user\" />,\n          dataIndex: 'user_id',\n          key: 'user_id',\n          hideInSearch: useAsWidget,\n          sorter: true,\n          renderFormItem: (item, { type, defaultRender, ...rest }, form) => {\n            if (type === 'form') {\n              return null;\n            }\n            const stateType = form.getFieldValue('state');\n            return (\n              <UserSelect\n                {...rest}\n                state={{\n                  type: stateType,\n                }}\n              />\n            );\n          },\n          render: (_, record) =>\n            record.user && <TypeButtonDrawer type={'App\\\\Models\\\\User'} type_id={record.user.id} />,\n        },\n      ]}\n    />\n  );\n};\n\nexport default LogsWidget;\n","import React from 'react';\n\nimport LogsWidget from '@/components/LogsWidget';\nimport { PageContainer } from '@ant-design/pro-layout';\n\nconst Logs: React.FC = () => {\n  return (\n    <PageContainer>\n      <LogsWidget />\n    </PageContainer>\n  );\n};\n\nexport default Logs;\n"],"names":["track","_x","_x2","_track","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","params","options","wrap","_context","prev","next","abrupt","request","_objectSpread","method","useCache","per_page","pageSize","page","current","stop","TableColumns","title","_jsx","FormattedMessage","id","defaultMessage","dataIndex","hideInSearch","sorter","width","hideInForm","hideInTable","valueType","fieldProps","allowEmpty","valueEnum","GET","POST","PUT","DELETE","PATCH","LogsWidget","_ref","useAsWidget","userID","actionRef","useRef","_useState","useState","_useState2","_slicedToArray","loading","setLoading","intl","useIntl","ProTable","headerTitle","formatMessage","rowKey","search","layout","_ref2","sort","user_id","dateRange","path","sortArr","Object","entries","date_from","format","Date","DATETIME_FORMAT","undefined","date_to","order_by","order","then","response","success","data","total","meta","columns","concat","key","renderFormItem","item","_ref3","form","type","defaultRender","rest","_objectWithoutProperties","_excluded","stateType","getFieldValue","UserSelect","state","render","_","record","user","TypeButtonDrawer","type_id","Logs","PageContainer","children"],"sourceRoot":""}