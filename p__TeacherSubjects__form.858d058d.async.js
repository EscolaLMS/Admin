(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"/y+f":function(ht,ve,s){"use strict";s.d(ve,"g",function(){return d}),s.d(ve,"e",function(){return I}),s.d(ve,"f",function(){return se}),s.d(ve,"d",function(){return Qe}),s.d(ve,"a",function(){return u}),s.d(ve,"c",function(){return Te}),s.d(ve,"b",function(){return T});var d;(function(h){h.Unselected="",h.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",h.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",h.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",h.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",h.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",h.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",h.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",h.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",h.Project="EscolaLms\\TopicTypeProject\\Models\\Project",h.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(d||(d={}));var _e;(function(h){h.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",h.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(_e||(_e={}));var je;(function(h){h.draft="draft",h.published="published",h.archived="archived"})(je||(je={}));var I;(function(h){h.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",h.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",h.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(I||(I={}));var se;(function(h){h.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(se||(se={}));var l;(function(h){h.cart_fixed="cart_fixed",h.cart_percent="cart_percent",h.product_fixed="product_fixed",h.product_percent="product_percent"})(l||(l={}));var Qe;(function(h){h.MULTIPLE_CHOICE="multiple_choice",h.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",h.TRUE_FALSE="true_false",h.SHORT_ANSWERS="short_answers",h.MATCHING="matching",h.NUMERICAL_QUESTION="numerical_question",h.ESSAY="essay",h.DESCRIPTION="description"})(Qe||(Qe={}));var u;(function(h){h.PRESENT="present",h.PRESENT_NOT_EXERCISING="present_not_exercising",h.ABSENT="absent",h.EXCUSED_ABSENCE="excused_absence"})(u||(u={}));var Te;(function(h){h.Manual="manual",h.TeamsForms="teams_forms",h.TeamsLecture="teams_lecture",h.TestPortal="test_portal"})(Te||(Te={}));var T;(function(h){h.Simple="simple",h.Complex="complex"})(T||(T={}))},"5R/X":function(ht,ve,s){},"5Syx":function(ht,ve,s){"use strict";s.d(ve,"c",function(){return U}),s.d(ve,"b",function(){return v}),s.d(ve,"a",function(){return Ve});var d=s("OaEy"),_e=s("2fM7"),je=s("g9YV"),I=s("wCAj"),se=s("14J3"),l=s("BMrR"),Qe=s("BoS7"),u=s("Sdc0"),Te=s("jrin"),T=s("k1fw"),h=s("DYRE"),$e=s("zeV3"),Oe=s("+BJd"),ie=s("mr32"),he=s("oBTY"),rt=s("tJVT"),Ue=s("q1tI"),jt=s.n(Ue),vt=s("nhC9"),He=s("LDJE"),S=s("9kvl"),W=s("Vpfc"),ze=s("+L6B"),We=s("2/Rp"),ct=s("qLMh"),pe=s("9og8"),le=s("4KAj"),k=s("w/VK"),m=s("nKUr"),J=function(de){var De=de.course_id,Me=de.stat,Ge=Me===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Me,ge=Object(Ue.useState)(!1),ee=Object(rt.a)(ge,2),ye=ee[0],xe=ee[1],Xe=Object(Ue.useCallback)(function(Je){return Object(pe.a)(Object(ct.a)().mark(function Se(){var ue,ce;return Object(ct.a)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return xe(!0),F.prev=1,F.next=4,Object(k.a)(Je,{stat:Ge});case 4:ue=F.sent,ue instanceof Blob&&(ce=document.createElement("a"),ce.href=window.URL.createObjectURL(ue),ce.download="finished_topics_".concat(De,".xlsx"),document.body.appendChild(ce),ce.click(),document.body.removeChild(ce)),F.next=11;break;case 8:F.prev=8,F.t0=F.catch(1),console.error(F.t0);case 11:return F.prev=11,xe(!1),F.finish(11);case 14:case"end":return F.stop()}},Se,null,[[1,8,11,14]])}))},[Ge]);return Object(m.jsxs)(We.a,{type:"primary",loading:ye,onClick:Xe(De),children:[Object(m.jsx)(le.a,{})," ",Object(m.jsx)(S.a,{id:"export"})]})},Ie=function(de){return de.topicable.content.contents?Object.values(de.topicable.content.contents)[0].library:"H5P"},U=function(de){var De=de.course_id,Me=de.topics,Ge=de.stats,ge=Object(Ue.useState)(!1),ee=Object(rt.a)(ge,2),ye=ee[0],xe=ee[1],Xe=Object(Ue.useMemo)(function(){return[{title:Object(m.jsx)(S.a,{id:"user"}),dataIndex:"id",render:function(ue){return Object(m.jsx)(W.a,{type:"App\\Models\\User",type_id:ue})}},{title:Object(m.jsx)(S.a,{id:"email"}),dataIndex:"email"}].concat(Object(he.a)(Me.map(function(Se){var ue,ce=(ue=Se.topicable_type)===null||ue===void 0?void 0:ue.split("\\").pop();return ce==="H5P"&&(ce=Ie(Se)),{render:function(F){var G=0,Z=0;switch(F&&(F.started_at&&F.finished_at?G=1:F.started_at&&(G=2),Z=F.seconds/60),G){case 1:return Object(m.jsxs)($e.b,{children:[Object(m.jsx)(ie.a,{color:"success",children:"F"}),ye&&Object(m.jsxs)("small",{children:[Z.toFixed(2),"m"]})]});case 2:return Object(m.jsxs)($e.b,{children:[Object(m.jsx)(ie.a,{color:"blue",children:"S"}),ye&&Object(m.jsxs)("small",{children:[Z.toFixed(2),"m"]})]});case 0:default:return Object(m.jsx)(jt.a.Fragment,{children:Object(m.jsx)(ie.a,{color:"error",children:"N"})})}},title:Object(m.jsxs)("small",{children:[Object(m.jsx)(ie.a,{children:ce})," ",Se.title]}),dataIndex:Se.id}})))},[Me,ye]),Je=Object(Ue.useMemo)(function(){return Ge.map(function(Se){return Me.reduce(function(ue,ce){var A=Se.topics.find(function(F){return F.id===ce.id});return Object(T.a)(Object(T.a)({},ue),{},Object(Te.a)({},Number(ce.id),A!=null?A:0))},{email:Se.email,id:Se.id})})},[Ge,Me]);return Object(m.jsx)(I.a,{title:function(){return Object(m.jsxs)(l.a,{justify:"space-between",align:"middle",children:[Object(m.jsxs)($e.b,{children:[Object(m.jsx)(S.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(m.jsx)(ie.a,{color:"success",children:"F"}),Object(m.jsx)(S.a,{id:"Started",defaultMessage:"Started:"})," ",Object(m.jsx)(ie.a,{color:"blue",children:"S"}),Object(m.jsx)(S.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(m.jsx)(ie.a,{color:"error",children:"N"}),Object(m.jsx)(S.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(m.jsx)(u.a,{checked:ye,onChange:function(ce){return xe(ce)}})]}),Object(m.jsx)(J,{course_id:De})]})},columns:Xe,dataSource:Je,size:"small",scroll:{x:1500}})},v=function(de){var De=de.stats,Me=Object(Ue.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(ee){return Object(m.jsx)(W.a,{type:"App\\Models\\User",type_id:ee})}},{title:"email",dataIndex:"email"},{title:Object(m.jsx)(S.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Ge=Object(Ue.useMemo)(function(){return De.map(function(ge){var ee=ge.id,ye=ge.email,xe=ge.finished_at;return{id:ee,email:ye,finished_at:xe}})},[De]);return Object(m.jsx)(I.a,{title:function(){return Object(m.jsx)($e.b,{children:Object(m.jsx)(S.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Me,dataSource:Ge,size:"small",scroll:{x:500}})},Ve=function(de){var De=de.stats,Me=Object(Ue.useState)(null),Ge=Object(rt.a)(Me,2),ge=Ge[0],ee=Ge[1],ye=Object(Ue.useState)(null),xe=Object(rt.a)(ye,2),Xe=xe[0],Je=xe[1],Se=Object(S.l)(),ue=Object(Ue.useMemo)(function(){return De.flatMap(function(A){return Object.values(A.attempts).flatMap(function(F){var G=F.dates,Z=F.attempt,ft=Object.values(G).flatMap(function(tt){var R=tt.date,D=tt.seconds_total;return{date:R,attempt:Z,seconds_total:D,email:A.email}});return ft})})},[De]),ce={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(m.jsx)(vt.a,{title:Object(m.jsxs)($e.b,{children:[Object(m.jsx)(S.a,{id:"course.interactions_time_in_days"}),Object(m.jsx)(_e.a,{showSearch:!0,value:ge,onChange:function(F){ee(F),Je(null)},placeholder:Object(m.jsx)(S.a,{id:"select_person",defaultMessage:"Select a person"}),children:De.map(function(A){var F=A.id,G=A.email;return Object(m.jsx)(_e.a.Option,{value:G,children:G},F)})}),Object(m.jsx)(_e.a,{value:Xe,onChange:function(F){return Je(F)},disabled:ge===null,placeholder:Object(m.jsx)(S.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(he.a)(new Set(ue.filter(function(A){var F=A.email;return F===ge}).map(function(A){var F=A.attempt;return F}))).map(function(A){return Object(m.jsxs)(_e.a.Option,{value:A,children:[Object(m.jsx)(S.a,{id:"attempt",defaultMessage:"Attempt"})," ",A]},A)})})]}),colSpan:12,layout:"center",children:Object(m.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(m.jsx)(He.a,Object(T.a)(Object(T.a)({},ce),{},{tooltip:{title:"".concat(Se.formatMessage({id:"attempt"})),formatter:function(F){var G=Math.floor(+F.seconds_total/60),Z=+F.seconds_total>60?+F.seconds_total-G*60:0;return{name:F.attempt,value:"".concat(G,"m ").concat(Z,"s")}}},data:ue.filter(function(A){var F=A.email;return F===ge}).filter(function(A){var F=A.attempt;return Number.isInteger(Xe)?F===Xe:!0})}))})})}},Hn4i:function(ht,ve,s){"use strict";var d=s("y8nQ"),_e=s("Vl3Y"),je=s("+L6B"),I=s("2/Rp"),se=s("rePB"),l=s("ODXe"),Qe=s("Ff2n"),u=s("x+uP"),Te=s("HaE+"),T=s("VTBJ"),h=s("nKUr"),$e=s.n(h),Oe=s("xvlK"),ie=s("WuYN"),he=s("VMEa"),rt=s("LQCs"),Ue=s("ft2k"),jt=s("uX+g"),vt=s("+i8S"),He=s("ipCM"),S=s("6cGi"),W=s("ub+h"),ze=s("bG1m"),We=s("q1tI"),ct=s.n(We),pe=s("mWMg"),le=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],k=["record","position","creatorButtonText","newRecordType","parentKey","style"],m=ct.a.createContext(void 0);function J(v){var Ve=v.children,Ne=v.record,de=v.position,De=v.newRecordType,Me=v.parentKey,Ge=Object(We.useContext)(m);return ct.a.cloneElement(Ve,Object(T.a)(Object(T.a)({},Ve.props),{},{onClick:function(){var ge=Object(Te.a)(Object(u.a)().mark(function ye(xe){var Xe,Je,Se,ue;return Object(u.a)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,(Xe=(Je=Ve.props).onClick)===null||Xe===void 0?void 0:Xe.call(Je,xe);case 2:if(ue=A.sent,ue!==!1){A.next=5;break}return A.abrupt("return");case 5:Ge==null||(Se=Ge.current)===null||Se===void 0||Se.addEditRecord(Ne,{position:de,newRecordType:De,parentKey:Me});case 6:case"end":return A.stop()}},ye)}));function ee(ye){return ge.apply(this,arguments)}return ee}()}))}function Ie(v){var Ve,Ne,de=Object(rt.d)(),De=v.onTableChange,Me=v.maxLength,Ge=v.formItemProps,ge=v.recordCreatorProps,ee=v.rowKey,ye=v.controlled,xe=v.defaultValue,Xe=v.onChange,Je=v.editableFormRef,Se=Object(Qe.a)(v,le),ue=Object(Ue.a)(v.value),ce=Object(We.useRef)(),A=Object(We.useRef)();Object(We.useImperativeHandle)(Se.actionRef,function(){return ce.current});var F=Object(S.a)(function(){return v.value||xe||[]},{value:v.value,onChange:v.onChange}),G=Object(l.a)(F,2),Z=G[0],ft=G[1],tt=ct.a.useMemo(function(){return typeof ee=="function"?ee:function(Le,Q){return Le[ee]||Q}},[ee]),R=function(Q){if(typeof Q=="number"&&!v.name){if(Q>=Z.length)return Q;var te=Z&&Z[Q];return tt==null?void 0:tt(te,Q)}if((typeof Q=="string"||Q>=Z.length)&&v.name){var re=Z.findIndex(function(oe,Pe){var Fe;return(tt==null||(Fe=tt(oe,Pe))===null||Fe===void 0?void 0:Fe.toString())===(Q==null?void 0:Q.toString())});return re}return Q};Object(We.useImperativeHandle)(Je,function(){var Le=function(re){var oe,Pe;if(re==null)throw new Error("rowIndex is required");var Fe=R(re),it=[v.name,(oe=Fe==null?void 0:Fe.toString())!==null&&oe!==void 0?oe:""].flat(1).filter(Boolean);return(Pe=A.current)===null||Pe===void 0?void 0:Pe.getFieldValue(it)},Q=function(){var re,oe=[v.name].flat(1).filter(Boolean);if(Array.isArray(oe)&&oe.length===0){var Pe,Fe=(Pe=A.current)===null||Pe===void 0?void 0:Pe.getFieldsValue();return Array.isArray(Fe)?Fe:Object.keys(Fe).map(function(it){return Fe[it]})}return(re=A.current)===null||re===void 0?void 0:re.getFieldValue(oe)};return Object(T.a)(Object(T.a)({},A.current),{},{getRowData:Le,getRowsData:Q,setRowData:function(re,oe){var Pe,Fe,it,_t;if(re==null)throw new Error("rowIndex is required");var xt=R(re),Zt=[v.name,(Pe=xt==null?void 0:xt.toString())!==null&&Pe!==void 0?Pe:""].flat(1).filter(Boolean),mt=((Fe=A.current)===null||Fe===void 0||(it=Fe.getFieldsValue)===null||it===void 0?void 0:it.call(Fe))||{},Dt=Object(ze.a)(mt,Zt,Object(T.a)(Object(T.a)({},Le(re)),oe||{}));return(_t=A.current)===null||_t===void 0?void 0:_t.setFieldsValue(Dt)}})}),Object(We.useEffect)(function(){!v.controlled||Z.forEach(function(Le,Q){var te;(te=A.current)===null||te===void 0||te.setFieldsValue(Object(se.a)({},tt(Le,Q),Le))},{})},[Z,v.controlled]),Object(We.useEffect)(function(){if(v.name){var Le;A.current=v==null||(Le=v.editable)===null||Le===void 0?void 0:Le.form}},[(Ve=v.editable)===null||Ve===void 0?void 0:Ve.form,v.name]);var D=ge||{},V=D.record,w=D.position,L=D.creatorButtonText,Y=D.newRecordType,Re=D.parentKey,ne=D.style,Xt=Object(Qe.a)(D,k),pt=w==="top",gt=Object(We.useMemo)(function(){return Me&&Me<=(Z==null?void 0:Z.length)?!1:ge!==!1&&Object(h.jsx)(J,{record:Object(jt.a)(V,Z==null?void 0:Z.length,Z)||{},position:w,parentKey:Object(jt.a)(Re,Z==null?void 0:Z.length,Z),newRecordType:Y,children:Object(h.jsx)(I.a,Object(T.a)(Object(T.a)({type:"dashed",style:Object(T.a)({display:"block",margin:"10px 0",width:"100%"},ne),icon:Object(h.jsx)(Oe.a,{})},Xt),{},{children:L||de.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[ge,Me,Z==null?void 0:Z.length]),e=Object(We.useMemo)(function(){return gt?pt?{components:{header:{wrapper:function(Q){var te,re=Q.className,oe=Q.children;return Object(h.jsxs)("thead",{className:re,children:[oe,Object(h.jsxs)("tr",{style:{position:"relative"},children:[Object(h.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:gt}),Object(h.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(te=Se.columns)===null||te===void 0?void 0:te.length,children:gt})]})]})}}}}:{tableViewRender:function(Q,te){var re,oe;return Object(h.jsxs)(h.Fragment,{children:[(re=(oe=v.tableViewRender)===null||oe===void 0?void 0:oe.call(v,Q,te))!==null&&re!==void 0?re:te,gt]})}}:{}},[pt,gt]),St=Object(T.a)({},v.editable),It=Object(vt.a)(function(Le,Q){var te,re,oe;if((te=v.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Le,Q),(oe=v.onValuesChange)===null||oe===void 0||oe.call(v,Q,Le),v.controlled){var Pe;v==null||(Pe=v.onChange)===null||Pe===void 0||Pe.call(v,Q)}});return((v==null?void 0:v.onValuesChange)||((Ne=v.editable)===null||Ne===void 0?void 0:Ne.onValuesChange)||v.controlled&&(v==null?void 0:v.onChange))&&(St.onValuesChange=It),Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(m.Provider,{value:ce,children:Object(h.jsx)(pe.a,Object(T.a)(Object(T.a)(Object(T.a)({search:!1,options:!1,pagination:!1,rowKey:ee,revalidateOnFocus:!1},Se),e),{},{tableLayout:"fixed",actionRef:ce,onChange:De,editable:Object(T.a)(Object(T.a)({},St),{},{formProps:Object(T.a)({formRef:A},St.formProps)}),dataSource:Z,onDataSourceChange:function(Q){if(ft(Q),v.name&&w==="top"){var te,re=Object(ze.a)({},[v.name].flat(1).filter(Boolean),Q);(te=A.current)===null||te===void 0||te.setFieldsValue(re)}}}))}),v.name?Object(h.jsx)(ie.a,{name:[v.name],children:function(Q){var te,re,oe=Object(W.a)(Q,[v.name].flat(1)),Pe=oe==null?void 0:oe.find(function(Fe,it){return!Object(He.a)(Fe,ue==null?void 0:ue[it])});return Pe&&ue&&(v==null||(te=v.editable)===null||te===void 0||(re=te.onValuesChange)===null||re===void 0||re.call(te,Pe,oe)),null}}):null]})}function U(v){var Ve=he.a.useFormInstance();return v.name?Object(h.jsx)(_e.a.Item,Object(T.a)(Object(T.a)({style:{maxWidth:"100%"}},v==null?void 0:v.formItemProps),{},{name:v.name,children:Object(h.jsx)(Ie,Object(T.a)(Object(T.a)({},v),{},{editable:Object(T.a)(Object(T.a)({},v.editable),{},{form:Ve})}))})):Object(h.jsx)(Ie,Object(T.a)({},v))}U.RecordCreator=J,ve.a=U},LDJE:function(ht,ve,s){"use strict";var d=s("q1tI"),_e=s.n(d),je=s("ma/q"),I=s("ZIEt"),se=s("QpZ9"),l=s("GzfL"),Qe=s("Scwr"),u=function(T,h){var $e={};for(var Oe in T)Object.prototype.hasOwnProperty.call(T,Oe)&&h.indexOf(Oe)<0&&($e[Oe]=T[Oe]);if(T!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ie=0,Oe=Object.getOwnPropertySymbols(T);ie<Oe.length;ie++)h.indexOf(Oe[ie])<0&&Object.prototype.propertyIsEnumerable.call(T,Oe[ie])&&($e[Oe[ie]]=T[Oe[ie]]);return $e},Te=Object(d.forwardRef)(function(T,h){var $e=T.chartRef,Oe=T.style,ie=Oe===void 0?{height:"inherit"}:Oe,he=T.className,rt=T.loading,Ue=T.loadingTemplate,jt=T.errorTemplate,vt=u(T,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),He=Object(I.a)(je.a,vt),S=He.chart,W=He.container;return Object(d.useEffect)(function(){Object(se.a)($e,S.current)},[S.current]),Object(d.useImperativeHandle)(h,function(){return{getChart:function(){return S.current}}}),_e.a.createElement(l.a,{errorTemplate:jt},rt&&_e.a.createElement(Qe.a,{loadingTemplate:Ue,theme:T.theme}),_e.a.createElement("div",{className:he,style:ie,ref:W}))});ve.a=Te},olry:function(ht,ve,s){"use strict";s.r(ve);var d=s("k1fw"),_e=s("+L6B"),je=s("2/Rp"),I=s("T2oS"),se=s("W9HT"),l=s("q1tI"),Qe=s.n(l),u=s("9kvl"),Te=s("55Ip"),T=s("Ty5D"),h=s("nhC9"),$e=s("tMyG"),Oe=s("my69"),ie=s("huej"),he=s("mJ0o"),rt=s("EhlZ"),Ue=s("P2fV"),jt=s("NJEC"),vt=s("5Dmo"),He=s("3S7+"),S=s("qLMh"),W=s("9og8"),ze=s("sWYD"),We=s("G3dp"),ct=s("VTBJ"),pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},le=pe,k=s("6VBw"),m=function(n,a){return l.createElement(k.a,Object(ct.a)(Object(ct.a)({},n),{},{ref:a,icon:le}))};m.displayName="LineChartOutlined";var J=l.forwardRef(m),Ie=s("/MfK"),U=s("Qiat"),v=s("mGZj");function Ve(i,n){return Ne.apply(this,arguments)}function Ne(){return Ne=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(d.a)({method:"GET",useCache:!1,params:n},a||{})));case 1:case"end":return t.stop()}},i)})),Ne.apply(this,arguments)}function de(i,n){return De.apply(this,arguments)}function De(){return De=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},i)})),De.apply(this,arguments)}function Me(i,n,a){return Ge.apply(this,arguments)}function Ge(){return Ge=Object(W.a)(Object(S.a)().mark(function i(n,a,r){return Object(S.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"PUT",data:a,useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),Ge.apply(this,arguments)}function ge(i,n){return ee.apply(this,arguments)}function ee(){return ee=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),ee.apply(this,arguments)}function ye(i,n){return xe.apply(this,arguments)}function xe(){return xe=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},i)})),xe.apply(this,arguments)}function Xe(i,n,a,r){return Je.apply(this,arguments)}function Je(){return Je=Object(W.a)(Object(S.a)().mark(function i(n,a,r,t){return Object(S.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(u.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return o.stop()}},i)})),Je.apply(this,arguments)}function Se(i,n,a){return ue.apply(this,arguments)}function ue(){return ue=Object(W.a)(Object(S.a)().mark(function i(n,a,r){return Object(S.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(d.a)({method:"DELETE"},r||{})));case 1:case"end":return c.stop()}},i)})),ue.apply(this,arguments)}var ce=s("Vpfc"),A=s("giR+"),F=s("fyUT"),G=s("tJVT"),Z=s("14J3"),ft=s("BMrR"),tt=s("jCWc"),R=s("kPKH"),D=s("VMEa"),V=s("Qurx"),w=s("lR9U"),L=s("/y+f"),Y=s("2qtc"),Re=s("kLXV"),ne=s("oBTY"),Xt=s("OaEy"),pt=s("2fM7"),gt=s("DBJ/"),e=s("nKUr"),St=function(n){var a=n.type,r=n.onDataConverted,t=n.groupSelectDisabled,c=Object(he.b)(),o=c.semester_subject_id,b=c.teacherSubjectData,f=Object(l.useState)(null),E=Object(G.a)(f,2),y=E[0],g=E[1],_=Object(l.useMemo)(function(){var p;return((p=b==null?void 0:b.groups)!==null&&p!==void 0?p:[]).map(function(x){var P=x.id,M=x.name;return{label:M,value:P}})},[]),j={type:a,group_id:y,semester_subject_id:o},O=Object(l.useCallback)(function(p){if(p.success){var x=p.data.results.filter(function(P){var M=P.user_id;return M!==null});if(!x.length)return;r({exam_results:x,group_id:p.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(u.a,{id:"group"}),children:Object(e.jsx)(pt.a,{disabled:t,value:y,onChange:function(x){return g(x)},options:_,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(gt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:O,onChange:function(x){return!x.fileList.length&&r(void 0)},maxFiles:1,data:j,disabled:!y})]})},It=function(n){var a=n.onDataConverted,r=Object(he.b)(),t=r.teacherSubjectData,c=r.groupUsers,o=Object(l.useState)(null),b=Object(G.a)(o,2),f=b[0],E=b[1],y=Object(l.useMemo)(function(){var _;return((_=t==null?void 0:t.groups)!==null&&_!==void 0?_:[]).map(function(j){var O=j.id,p=j.name;return{label:p,value:O}})},[]),g=Object(l.useCallback)(function(_){var j;E(_);var O=(j=c.byId)===null||j===void 0?void 0:j[_];if(!!O){var p=O.users.reduce(function(x,P){var M=P.id,C=P.email,z=P.first_name,H=P.last_name,Ee=P.academic_teacher_id;return Ee!==null?x:[].concat(Object(ne.a)(x),[{email:C,first_name:z,last_name:H,user_id:M,result:0}])},[]);a({group_id:_,exam_results:p})}},[c.byId]);return Object(e.jsx)(pt.a,{value:f,onChange:g,options:y,placeholder:Object(e.jsx)(u.a,{id:"select_group"}),style:{width:"100%"}})},Le=[L.c.TeamsLecture,L.c.TestPortal,L.c.TeamsForms],Q=function(n){var a=n.open,r=n.closeModal,t=n.onSuccess,c=n.type,o=Object(he.b)(),b=o.teacherSubjectData,f=o.fetchGroupUsers,E=Object(l.useState)(),y=Object(G.a)(E,2),g=y[0],_=y[1];return Object(l.useEffect)(function(){if(c===L.c.Manual&&a){var j;b==null||(j=b.groups)===null||j===void 0||j.forEach(function(O){var p=O.id;return f(p)})}},[c,a]),Object(e.jsxs)(Re.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:r,onOk:function(){g&&t(g)},okButtonProps:{disabled:!g},children:[Le.includes(c)&&Object(e.jsx)(St,{type:c,onDataConverted:_,groupSelectDisabled:!!g}),c===L.c.Manual&&Object(e.jsx)(It,{onDataConverted:_})]})},te=function(n){var a=n.onSelect;return Object(e.jsxs)(ft.a,{gutter:[16,16],children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(L.c.TeamsForms)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(L.c.TestPortal)},children:Object(e.jsx)(u.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(L.c.TeamsLecture)},children:Object(e.jsx)(u.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){return a(L.c.Manual)},children:Object(e.jsx)(u.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},re=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],oe=function(n){var a,r=n.exam_id,t=D.a.useForm(),c=Object(G.a)(t,1),o=c[0],b=Object(l.useState)(),f=Object(G.a)(b,2),E=f[0],y=f[1],g=Object(l.useState)(),_=Object(G.a)(g,2),j=_[0],O=_[1],p=Object(l.useState)(!1),x=Object(G.a)(p,2),P=x[0],M=x[1],C=Object(he.b)(),z=C.semester_subject_id,H=C.getGroupById,Ee=Object(l.useMemo)(function(){var B;return((B=j==null?void 0:j.exam_results)!==null&&B!==void 0?B:[]).map(function($){var N=$.user_id;return N})},[j==null?void 0:j.exam_results]);Object(l.useEffect)(function(){var B=Number(r);r==="new"&&(y(void 0),O(void 0),o.resetFields()),r!=="new"&&!Number.isNaN(B)&&(M(!0),ge(B).then(function($){if($.success){var N=$.data,q=N.type,Ze=N.results,at=N.title,be=N.weight,fe=N.passed_at,X=N.group_id;y(q),O({group_id:X,exam_results:Ze}),o.setFieldsValue({title:at,weight:be,passed_at:fe})}}).finally(function(){return M(!1)}))},[r]);var we=Object(l.useCallback)(function(){y(void 0),O(void 0)},[]);return P?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[E&&Object(e.jsx)(Q,{open:Boolean(E&&!j),type:E,closeModal:we,onSuccess:O}),Object(e.jsxs)(D.a,{form:o,submitter:E===void 0||!j?!1:void 0,onFinish:function(){var B=Object(W.a)(Object(S.a)().mark(function $(N){var q,Ze,at,be,fe,X,Be,et,Ke,nt;return Object(S.a)().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(Ze=j==null||(q=j.exam_results)===null||q===void 0?void 0:q.every(function(me){var Ce=me.result;return typeof Ce=="number"&&Ce>=0&&Ce<=100}),!(j&&Ze&&typeof z=="number")){K.next=17;break}if(at=N.title,be=N.passed_at,fe=N.weight,X=Number(r),Be=j.exam_results,et=j.group_id,Ke={type:E,semester_subject_id:z,title:at,passed_at:be,weight:fe,group_id:et,results:Be},!Number.isNaN(X)){K.next=12;break}return K.next=9,de(Ke);case 9:K.t0=K.sent,K.next=15;break;case 12:return K.next=14,Me(X,Ke);case 14:K.t0=K.sent;case 15:nt=K.t0,nt.success&&u.f.push("/teacher/subjects/".concat(z,"/exams"));case 17:return K.abrupt("return",!0);case 18:case"end":return K.stop()}},$)}));return function($){return B.apply(this,arguments)}}(),onReset:we,children:[Object(e.jsxs)(D.a.Group,{children:[Object(e.jsx)(V.a,{label:Object(e.jsx)(u.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(w.a,{label:Object(e.jsx)(u.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(D.a.Item,{name:"weight",label:Object(e.jsx)(u.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(F.a,{})})]}),E&&j&&Object(e.jsx)(U.a,{rowKey:"user_id",headerTitle:(a=H(j.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:Ee,onValuesChange:function($,N){return O({group_id:j.group_id,exam_results:N})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:j.exam_results,columns:re}),!j&&Object(e.jsx)(te,{onSelect:y})]})]})},Pe=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Fe=function(n){var a=n.exam_id,r=Object(l.useState)(""),t=Object(G.a)(r,2),c=t[0],o=t[1];return Object(e.jsx)(U.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(W.a)(Object(S.a)().mark(function b(){var f;return Object(S.a)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,ge(a);case 2:if(f=y.sent,!f.success){y.next=6;break}return o(f.data.title),y.abrupt("return",{total:f.data.results.length,success:!0,data:f.data.results});case 6:return y.abrupt("return",[]);case 7:case"end":return y.stop()}},b)})),columns:Pe})},it=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(u.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(u.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,a){return Object(e.jsx)(u.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,a){return a.passed_at&&Object(ze.a)(new Date(a.passed_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,a){return a.weight+"%"}},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,a){return a.created_at&&Object(ze.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,a){return Object(e.jsx)(u.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,a){return Object(e.jsx)(ce.a,{type:"Students",type_id:a.group_id},a.group_id)}}],_t=function(){var n,a,r=Object(l.useRef)(),t=Object(he.b)(),c=t.semester_subject_id,o=Object(T.k)(),b=Object(l.useMemo)(function(){var y,g,_;return{exam_id:(y=(g=o.query)===null||g===void 0?void 0:g.exam_id)!==null&&y!==void 0?y:null,results:(_=o.query)===null||_===void 0?void 0:_.results}},[(n=o.query)===null||n===void 0?void 0:n.exam_id,(a=o.query)===null||a===void 0?void 0:a.results]),f=b.exam_id,E=b.results;return E!==null&&!Number.isNaN(Number(E))?Object(e.jsx)(Fe,{exam_id:Number(E)}):f!==null?Object(e.jsx)(oe,{exam_id:f}):Object(e.jsx)(U.a,{className:"table-standalone",headerTitle:Object(e.jsx)(u.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var y=Object(W.a)(Object(S.a)().mark(function g(_,j){var O,p,x,P;return Object(S.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(O=_.current,p=_.pageSize,c!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return x=j&&Object.entries(j)[0],C.next=6,Ve({per_page:p,page:O,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:x&&x[0],order:x&&(x[1]==="ascend"?"ASC":"DESC")});case 6:if(P=C.sent,!P.success){C.next=9;break}return C.abrupt("return",{data:P.data,total:P.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},g)}));return function(g,_){return y.apply(this,arguments)}}(),columns:[].concat(it,[{title:Object(e.jsx)(u.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,_){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?exam_id=").concat(_.id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(We.a,{})})})},"edit"),Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?results=").concat(_.id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(je.a,{icon:Object(e.jsx)(J,{})})})},"results"),Object(e.jsx)(jt.a,{title:Object(e.jsx)(u.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(W.a)(Object(S.a)().mark(function j(){var O;return Object(S.a)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,ye(_.id);case 2:O=x.sent,O.success&&r.current&&r.current.reload();case 4:case"end":return x.stop()}},j)})),okText:Object(e.jsx)(u.a,{id:"yes"}),cancelText:Object(e.jsx)(u.a,{id:"no"}),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(Ie.a,{}),danger:!0})})},"delete")]}}])})},xt=s("o0Ox"),Zt=s("miYZ"),mt=s("tsqr"),Dt=s("4KAj");function oa(i,n){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/chats/ms-teams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},i)})),Gt.apply(this,arguments)}var ja=function(n){var a=n.student_id,r=Object(l.useState)(!1),t=Object(G.a)(r,2),c=t[0],o=t[1],b=Object(l.useCallback)(Object(W.a)(Object(S.a)().mark(function f(){var E;return Object(S.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return o(!0),g.next=3,oa({user_id:a});case 3:if(E=g.sent,E.success){g.next=8;break}return mt.b.error(E.message),o(!1),g.abrupt("return");case 8:window.open(E.data.web_url,"_blank","noopener noreferrer"),o(!1);case 10:case"end":return g.stop()}},f)})),[]);return Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(je.a,{loading:c,type:"primary",icon:Object(e.jsx)(Dt.a,{}),onClick:b})})},ba=[{title:Object(e.jsx)(u.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(u.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(u.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(u.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(u.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],va=function(n){return n.map(function(a){var r=a.id,t=a.name;return{label:t,value:r}})},fa=function(n){return n.reduce(function(a,r){var t,c=r==null||(t=r.users)===null||t===void 0?void 0:t.reduce(function(o,b){return b.academic_teacher_id!==null?o:[].concat(Object(ne.a)(o),[{group_id:r.id,group_name:r.name,user_id:b.id,first_name:b.first_name,last_name:b.last_name,email:b.email}])},[]);return[].concat(Object(ne.a)(a),Object(ne.a)(c))},[])},ma=function(){var n=Object(he.b)(),a=n.teacherSubjectData,r=Object(l.useMemo)(function(){var t;return va((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(U.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var t=Object(W.a)(Object(S.a)().mark(function c(o){var b,f,E,y,g,_,j,O,p;return Object(S.a)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return b=o.groups,f=o.first_name,E=f===void 0?"":f,y=o.last_name,g=y===void 0?"":y,_=o.email,j=_===void 0?"":_,P.next=3,Object(xt.a)({parent_id:a==null?void 0:a.group_id,"id[]":b});case 3:if(O=P.sent,O.success){P.next=6;break}return P.abrupt("return",{data:[],total:0,success:!1});case 6:return p=fa(O.data).filter(function(M){return M.first_name.toLowerCase().includes(E.toLowerCase())&&M.last_name.toLowerCase().includes(g.toLowerCase())&&M.email.toLowerCase().includes(j.toLowerCase())}),P.abrupt("return",{data:p,total:p.length,success:!0});case 8:case"end":return P.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(ba,[{hideInSearch:!0,title:Object(e.jsx)(u.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,o){return[Object(e.jsx)(ja,{student_id:o.user_id},"teamsChat")]}}])})},bt=s("jrin");function Rt(i,n){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules/groups/".concat(n),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Lt.apply(this,arguments)}function Oa(i,n,a,r){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(W.a)(Object(S.a)().mark(function i(n,a,r,t){return Object(S.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(u.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(d.a)({data:{attendances:[{user_id:a,value:r}]},method:"POST"},t||{})));case 1:case"end":return o.stop()}},i)})),Ft.apply(this,arguments)}var Tn=s("DYRE"),ha=s("zeV3"),Mn=s("sRBo"),Qt=s("kaz8");function pa(i){var n,a,r=i===null?L.a.ABSENT:i,t=(n={},Object(bt.a)(n,L.a.PRESENT,{ch1:!0,ch2:!1}),Object(bt.a)(n,L.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(bt.a)(n,L.a.ABSENT,{ch1:!1,ch2:!1}),Object(bt.a)(n,L.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),n);return(a=t[r])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function ga(i){var n,a=i.ch1,r=i.ch2,t="".concat(a,"_").concat(r),c={true_false:L.a.PRESENT,true_true:L.a.PRESENT_NOT_EXERCISING,false_false:L.a.ABSENT,false_true:L.a.EXCUSED_ABSENCE};return(n=c[t])!==null&&n!==void 0?n:L.a.ABSENT}var xa=function(n){var a=n.groupAttendanceScheduleId,r=n.studentId,t=n.attendance,c=n.onSuccess,o=Object(l.useState)(pa(t)),b=Object(G.a)(o,2),f=b[0],E=b[1],y=Object(l.useState)(!1),g=Object(G.a)(y,2),_=g[0],j=g[1],O=Object(l.useRef)(!0),p=Object(l.useCallback)(function(M){j(!0),Oa(a,r,ga(M)).then(function(C){C.success&&(c==null||c())}).finally(function(){return j(!1)})},[]),x=Object(l.useCallback)(function(M){return E(M.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),P=Object(l.useCallback)(function(M){return E(function(C){return Object(d.a)(Object(d.a)({},C),{},{ch2:M.target.checked})})},[]);return Object(l.useEffect)(function(){if(O.current){O.current=!1;return}p(f)},[f,p]),Object(e.jsxs)(ha.b,{children:[Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"present"}),children:Object(e.jsx)(Qt.a,{disabled:_,checked:f.ch1,onChange:x})}),Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:f.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Qt.a,{disabled:_,checked:f.ch2,onChange:P})})]})},At=xa,Sa=function(){var n=Object(he.b)(),a=n.teacherSubjectData,r=Object(l.useState)([]),t=Object(G.a)(r,2),c=t[0],o=t[1],b=Object(l.useState)(""),f=Object(G.a)(b,2),E=f[0],y=f[1],g=Object(u.l)(),_=Object(l.useRef)(),j=Object(l.useMemo)(function(){var p;return((p=a==null?void 0:a.groups)!==null&&p!==void 0?p:[]).map(function(x){var P=x.id,M=x.name;return{value:P,label:M}})},[a==null?void 0:a.groups]),O=Object(l.useMemo)(function(){var p;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:j,defaultValue:j==null||(p=j[0])===null||p===void 0?void 0:p.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(c))},[j,c]);return Object(e.jsx)(U.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(E,")"),request:function(){var p=Object(W.a)(Object(S.a)().mark(function x(P){var M,C,z,H,Ee,we,B,$,N,q,Ze;return Object(S.a)().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return C=P.group_id,z=C===void 0?j==null||(M=j[0])===null||M===void 0?void 0:M.value:C,H=P.full_name,Ee=H===void 0?"":H,be.next=3,Promise.all([Object(xt.b)(z),Rt(z)]);case 3:if(we=be.sent,B=Object(G.a)(we,2),$=B[0],N=B[1],q=j.find(function(fe){var X=fe.value;return X===z}),!(!$.success||!N.success||!q)){be.next=10;break}return be.abrupt("return",{data:[],total:0,success:!1});case 10:if(N.data.length){be.next=13;break}return mt.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),be.abrupt("return",{data:[],total:0,success:!1});case 13:return y(q.label),o(N.data.reduce(function(fe,X){return[].concat(Object(ne.a)(fe),[{title:String(Object(ze.a)(new Date(X.date_from),v.c)),dataIndex:String(X.date_from),hideInSearch:!0,width:100,align:"center",render:function(et,Ke){return Object(e.jsx)(At,{groupAttendanceScheduleId:X.id,attendance:Ke["".concat(X==null?void 0:X.date_from)],studentId:Ke.id})}}])},[])),Ze=$.data.users.reduce(function(fe,X){var Be=X.id,et=X.academic_teacher_id,Ke=X.first_name,nt=X.last_name,ae="".concat(nt," ").concat(Ke);if(et!==null||!ae.toLowerCase().includes(Ee.toLowerCase()))return fe;var K=N.data.reduce(function(me,Ce){var ke=Ce.attendances.find(function(ut){return ut.user_id===Be});return ke?Object(d.a)(Object(d.a)({},me),{},Object(bt.a)({},"".concat(Ce.date_from),ke.value)):me},{});return[].concat(Object(ne.a)(fe),[Object(d.a)({id:Be,full_name:ae},K)])},[]).sort(function(fe,X){return fe.full_name.localeCompare(X.full_name)}),be.abrupt("return",{data:Ze,total:Ze.length,success:!0});case 17:case"end":return be.stop()}},x)}));return function(x){return p.apply(this,arguments)}}(),columns:O,search:{layout:"vertical"},pagination:{onChange:function(){var x;return(x=_.current)===null||x===void 0?void 0:x.reload()}},scroll:{x:1500},actionRef:_,rowKey:"id"})},Pn=s("tU7J"),st=s("wFql"),In=s("/zsF"),$t=s("PArb"),_a=s("Hn4i"),ya=s("bRQS");function Nt(i,n,a){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(W.a)(Object(S.a)().mark(function i(n,a,r){return Object(S.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(d.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),Ut.apply(this,arguments)}function Ea(i,n,a,r){return wt.apply(this,arguments)}function wt(){return wt=Object(W.a)(Object(S.a)().mark(function i(n,a,r,t){return Object(S.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(u.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(d.a)({method:"POST",data:r},t||{})));case 1:case"end":return o.stop()}},i)})),wt.apply(this,arguments)}function kt(i,n){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/lesson-group-users",Object(d.a)({method:"GET",params:{"groups[]":n},useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Bt.apply(this,arguments)}function Ca(i,n,a){return Kt.apply(this,arguments)}function Kt(){return Kt=Object(W.a)(Object(S.a)().mark(function i(n,a,r){return Object(S.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(a),Object(d.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),Kt.apply(this,arguments)}function qt(i){return Wt.apply(this,arguments)}function Wt(){return Wt=Object(W.a)(Object(S.a)().mark(function i(n){return Object(S.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(u.i)("/api/admin/grade-terms",Object(d.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},i)})),Wt.apply(this,arguments)}function ea(i,n){return Vt.apply(this,arguments)}function Vt(){return Vt=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/grade-scales/".concat(n),Object(d.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Vt.apply(this,arguments)}function ta(i,n){return Ht.apply(this,arguments)}function Ht(){return Ht=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/final-grades",Object(d.a)({method:"POST",data:n},a||{})));case 1:case"end":return t.stop()}},i)})),Ht.apply(this,arguments)}function aa(i,n,a){return zt.apply(this,arguments)}function zt(){return zt=Object(W.a)(Object(S.a)().mark(function i(n,a,r){return Object(S.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(u.i)("/api/admin/final-grades/".concat(n),Object(d.a)({method:"PATCH",data:a},r||{})));case 1:case"end":return c.stop()}},i)})),zt.apply(this,arguments)}var Ta=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(u.a,{id:"number_between",values:{min:0,max:100}})}]}}],Ma=function(n){var a=n.subjectTutorGradeScale,r=n.onFormSubmit,t=Object(l.useState)([]),c=Object(G.a)(t,2),o=c[0],b=c[1],f=Object(l.useRef)(),E=D.a.useForm(),y=Object(G.a)(E,1),g=y[0];return Object(l.useEffect)(function(){var _,j=((_=a.scale)!==null&&_!==void 0?_:[]).map(function(O,p){return Object(d.a)(Object(d.a)({},O),{},{id:String((p+1)*100)})});g.setFieldValue("table",j)},[]),Object(e.jsx)(D.a,{form:g,onFinish:r,submitter:{render:function(j,O){var p=Object(G.a)(O,2),x=p[1];return[x]}},children:Object(e.jsx)(_a.a,{name:"table",rowKey:"id",actionRef:f,formItemProps:{label:Object(e.jsx)(u.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Ta,[{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(j,O){return Object(e.jsx)(je.a,{type:"primary",onClick:function(){var x;return(x=f.current)===null||x===void 0?void 0:x.startEditable(O.id)},icon:Object(e.jsx)(We.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:o,saveText:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(ya.a,{})}),onChange:b,actionRender:function(j,O,p){return[p.save]}}})})},Pa=function(){var n,a,r=Object(u.m)("@@initialState"),t=r.initialState,c=Object(he.b)(),o=c.semester_subject_id,b=c.tutors,f=Object(l.useState)(),E=Object(G.a)(f,2),y=E[0],g=E[1],_=Object(l.useState)(!1),j=Object(G.a)(_,2),O=j[0],p=j[1],x=Object(l.useState)(null),P=Object(G.a)(x,2),M=P[0],C=P[1],z=Object(l.useMemo)(function(){return!!b.data.find(function(B){var $,N=B.id;return N===(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)})},[b.data,t==null||(n=t.currentUser)===null||n===void 0?void 0:n.id]),H=Object(l.useMemo)(function(){return b.data.map(function(B){var $=B.id,N=B.first_name,q=B.last_name;return{label:"".concat(N," ").concat(q),value:$}})},[b.data]),Ee=Object(l.useCallback)(function(){o===null||M===null||(p(!0),g(void 0),Nt(o,M).then(function(B){B.success&&g(B.data)}).finally(function(){p(!1)}))},[o,M]),we=Object(l.useCallback)(function(B,$){return function(){var N=Object(W.a)(Object(S.a)().mark(function q(Ze){var at,be;return Object(S.a)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(o===null||M===null)){X.next=2;break}return X.abrupt("return");case 2:return at=B.reduce(function(Be,et){return et.s_subject_scale_form_id===$?[].concat(Object(ne.a)(Be),[{s_subject_scale_form_id:$,scale:Ze.table.map(function(Ke){var nt=Ke.name,ae=Ke.grade,K=Ke.grade_value;return{name:nt,grade:ae,grade_value:K}})}]):[].concat(Object(ne.a)(Be),[et])},[]),X.next=5,Ea(o,M,{grade_scale:at});case 5:be=X.sent,be.success&&Ee();case 7:case"end":return X.stop()}},q)}));return function(q){return N.apply(this,arguments)}}()},[M,o]);return Object(l.useEffect)(function(){var B,$;if(!z||!(t!=null&&(B=t.currentUser)!==null&&B!==void 0&&B.id)){var N;if((N=b.data)!==null&&N!==void 0&&N[0]){var q;C((q=b.data)===null||q===void 0?void 0:q[0].id)}return}C(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,z]),Object(l.useEffect)(function(){Ee()},[Ee]),b.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(u.a,{id:"menu.Teacher"}),children:Object(e.jsx)(pt.a,{disabled:z,placeholder:Object(e.jsx)(u.a,{id:"select"}),options:H,value:M,onChange:function($){return C($)}})}),Object(e.jsx)($t.a,{}),O&&!y&&Object(e.jsx)(se.a,{}),y!=null&&y.grade_scale?y.grade_scale.map(function(B,$){var N;return Object(e.jsxs)(Qe.a.Fragment,{children:[$>0&&Object(e.jsx)($t.a,{}),Object(e.jsx)(Ma,{subjectTutorGradeScale:B,onFormSubmit:we((N=y.grade_scale)!==null&&N!==void 0?N:[],B.s_subject_scale_form_id)})]},B.s_subject_scale_form_id)}):Object(e.jsx)(st.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(u.a,{id:"gradesScalesMissing"})})]})},Dn=s("qbNl"),Ia=s("JBPa"),Gn=s("Awhp"),Da=s("KrTs"),Ga=s("wd/R"),lt=s.n(Ga);function Ra(i,n){return Jt.apply(this,arguments)}function Jt(){return Jt=Object(W.a)(Object(S.a)().mark(function i(n,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u.i)("/api/admin/schedules",Object(d.a)({params:n,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Jt.apply(this,arguments)}var Rn=s("5R/X"),La=function(){var n=Object(l.useState)(null),a=Object(G.a)(n,2),r=a[0],t=a[1],c=Object(l.useState)([]),o=Object(G.a)(c,2),b=o[0],f=o[1],E=Object(he.b)(),y=E.semester_subject_id,g=lt()(),_=Object(l.useMemo)(function(){return b.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:lt()(C.date_from).toDate(),end:lt()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[b]),j=Object(l.useCallback)(function(C,z){Ra({semester_subject_id:y,date_form:C.toDate(),date_to:z.toDate()}).then(function(H){H.success&&f(H.data)})},[y]),O=Object(l.useCallback)(function(C){t(C)},[]),p=Object(l.useCallback)(function(){t(null)},[]),x=Object(l.useCallback)(function(C){return C.isSame(g,"day")?"warning":C.isAfter(g,"day")?"success":"error"},[]),P=Object(l.useCallback)(function(C){var z=_.filter(function(H){return lt()(H.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:z.map(function(H){return Object(e.jsx)("li",{onClick:function(){return O(H)},children:Object(e.jsx)(Da.a,{status:x(lt()(H.start)),text:H.title})},H.id)})})},[b]),M=Object(l.useCallback)(function(C,z){var H=lt()(C).startOf(z).subtract(1,"month"),Ee=lt()(C).endOf(z).add(1,"month");j(H,Ee)},[]);return Object(l.useEffect)(function(){var C=lt()().startOf("month"),z=lt()().endOf("month");j(C,z)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Title,{level:4,children:Object(e.jsx)(u.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ia.a,{dateCellRender:P,onPanelChange:M}),Object(e.jsxs)(Re.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:p,footer:null,children:[Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&lt()(r.start).format(v.b)]}),Object(e.jsxs)(st.a.Paragraph,{children:[Object(e.jsx)(u.a,{id:"end_at",defaultMessage:"End date"}),":",r&&lt()(r.end).format(v.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(st.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(je.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"msTeams"})})},"teamsLink")})]})]})},na=s("yj/a"),ra=s("5Syx"),Tt=s("PpiC"),Yt=s("H6aw"),Fa=s("p3I6"),Aa=["results"],sa=function(n,a){return n.reduce(function(r,t){var c=t.results,o=Object(Tt.a)(t,Aa),b=c.find(function(f){return f.user_id===a});return b?[].concat(Object(ne.a)(r),[Object(d.a)(Object(d.a)({},o),{},{result:b})]):r},[])},ua=function(n,a){var r,t=n.reduce(function(j,O){var p=O.result,x=O.weight;return[j[0]+p.result*x,j[1]+x]},[0,0]),c=Object(G.a)(t,2),o=c[0],b=c[1],f=Number.isNaN(o/b)?0:o/b,E=a.sort(function(j,O){return j.grade_value-O.grade_value}).reduce(function(j,O){return[].concat(Object(ne.a)(j),[Object(d.a)(Object(d.a)({},O),{},{isWeightedAverageGreater:f>=O.grade_value})])},[]);if(E.every(function(j){var O=j.isWeightedAverageGreater;return O})){var y,g;return(y=(g=E.at(-1))===null||g===void 0?void 0:g.name)!==null&&y!==void 0?y:""}var _=E.findIndex(function(j){var O=j.isWeightedAverageGreater;return!O});return _<0?"":(r=E[_-1])===null||r===void 0?void 0:r.name},ca=function(n,a){var r;return(r=a.find(function(t){return t.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},$a=["attendances"];function Na(i,n){var a=Object(l.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1];return Object(l.useEffect)(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!0})}),Ca(i,n).then(function(o){o.success&&c(function(b){return Object(d.a)(Object(d.a)({},b),{},{data:o.data})})}).finally(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!1})})})},[n,i]),{finalGrades:t}}function Ua(){var i=Object(l.useState)({loading:!1}),n=Object(G.a)(i,2),a=n[0],r=n[1];return Object(l.useEffect)(function(){r(function(t){return Object(d.a)(Object(d.a)({},t),{},{loading:!0})}),qt().then(function(t){t.success&&r(function(c){return Object(d.a)(Object(d.a)({},c),{},{data:t.data})})}).finally(function(){r(function(t){return Object(d.a)(Object(d.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function wa(i){var n=Object(l.useState)({loading:!1}),a=Object(G.a)(n,2),r=a[0],t=a[1];return Object(l.useEffect)(function(){i!==void 0&&(t(function(c){return Object(d.a)(Object(d.a)({},c),{},{loading:!0})}),ea(i).then(function(c){c.success&&t(function(o){return Object(d.a)(Object(d.a)({},o),{},{data:c.data})})}).finally(function(){t(function(c){return Object(d.a)(Object(d.a)({},c),{},{loading:!1})})}))},[i]),{subjectGradeScales:r}}function Ba(i,n,a){var r=Object(l.useState)({loading:!1}),t=Object(G.a)(r,2),c=t[0],o=t[1];return Object(l.useEffect)(function(){typeof i!="number"||typeof n!="number"||typeof a!="number"||(o(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!0})}),Nt(i,n).then(function(b){b.success&&o(function(f){var E,y;return Object(d.a)(Object(d.a)({},f),{},{data:(E=ca(a,(y=b.data.grade_scale)!==null&&y!==void 0?y:[]))===null||E===void 0?void 0:E.map(function(g,_){return Object(d.a)(Object(d.a)({},g),{},{id:_})})})})}).finally(function(){o(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!1})})}))},[i,n]),{tutorGradeScales:c}}function Ka(i,n){var a=Object(l.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1],o=Object(l.useCallback)(function(){c(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!0})}),Rt(i).then(function(b){if(b.success){var f=b.data.reduce(function(E,y){var g=y.attendances,_=Object(Tt.a)(y,$a),j=g.find(function(O){return O.user_id===n});return j?[].concat(Object(ne.a)(E),[Object(d.a)(Object(d.a)({},_),{},{attendance:j})]):E},[]);c(function(E){return Object(d.a)(Object(d.a)({},E),{},{data:f})})}}).finally(function(){c(function(b){return Object(d.a)(Object(d.a)({},b),{},{loading:!1})})})},[i,n]);return Object(l.useEffect)(function(){o()},[o]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:o}}function Wa(i,n){var a=Object(l.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1];return Object(l.useEffect)(function(){!n||(c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!0})}),Ve({student_id:i,semester_subject_id:n}).then(function(o){if(o.success){var b=sa(o.data,i);c(function(f){return Object(d.a)(Object(d.a)({},f),{},{data:b})})}}).finally(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!1})})}))},[i,n]),{studentExams:t}}function Va(i,n){var a=Object(l.useState)({loading:!1}),r=Object(G.a)(a,2),t=r[0],c=r[1],o=Object(l.useState)({loading:!1}),b=Object(G.a)(o,2),f=b[0],E=b[1],y=Object(l.useState)({loading:!1}),g=Object(G.a)(y,2),_=g[0],j=g[1];return Object(l.useEffect)(function(){c(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!0})}),Object(Yt.e)({group_id:i}).then(function(O){O.success&&c(function(p){return Object(d.a)(Object(d.a)({},p),{},{data:O.data})})}).finally(function(){c(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!1})})})},[i]),Object(l.useEffect)(function(){!t.data||(j(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var p=O.id;return Object(Yt.m)(Number(p))})).then(function(O){O.forEach(function(p){p.success&&j(function(x){return Object(d.a)(Object(d.a)({},x),{},{data:Object(d.a)(Object(d.a)({},x.data),{},Object(bt.a)({},Number(p.data.id),Object(Fa.c)(p.data.lessons)))})})})}).finally(function(){j(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!1})})}),E(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!0})}),Promise.all(t.data.map(function(O){var p=O.id;return Object(Yt.l)(Number(p),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(x){if(x.success){var P,M,C=((P=x.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&P!==void 0?P:[]).filter(function(H){return H.id===n}),z=(M=x.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&M!==void 0?M:[];E(function(H){return Object(d.a)(Object(d.a)({},H),{},{data:Object(d.a)(Object(d.a)({},H.data),{},Object(bt.a)({},Number(p),{finishedTopics:C,attendanceList:z}))})})}})})).finally(function(){return E(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!1})})}))},[t.data,n]),{userCourses:t,userCoursesStats:f,userCoursesTopics:_}}var Ha=[{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(u.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],za=[{title:Object(e.jsx)(u.a,{id:"date"}),dataIndex:"date_from",render:function(n,a){return Object(ze.a)(new Date(a.date_from),v.c)}}],Ja=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(u.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,a){return Object(ze.a)(new Date(a.created_at),v.c)}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"result",render:function(n,a){return"".concat(a.result.result,"%")}}],Ya=[{title:Object(e.jsx)(u.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(u.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=a.grade)!==null&&r!==void 0&&r.grade_date?Object(ze.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),v.c):"-"}},{title:Object(e.jsx)(u.a,{id:"grade"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&r!==void 0?r:"-"}}],Mt=6,Xa=function(n){var a,r,t,c,o=n.user_id,b=n.group_id,f=Object(he.b)(),E=f.semester_subject_id,y=Wa(o,E),g=y.studentExams,_=Na(b,o),j=_.finalGrades,O=Ua(),p=O.gradeTerms,x=wa((a=j.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),P=x.subjectGradeScales,M=Ba(E,(r=j.data)===null||r===void 0?void 0:r.tutor_id,(t=j.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),C=M.tutorGradeScales,z=Ka(b,o),H=z.userAttendanceSchedules,Ee=z.fetchUserAttendanceSchedules,we=Va(b,o),B=we.userCourses,$=we.userCoursesStats,N=we.userCoursesTopics,q=D.a.useForm(),Ze=Object(G.a)(q,1),at=Ze[0],be=Object(l.useMemo)(function(){var ae;return((ae=p.data)!==null&&ae!==void 0?ae:[]).map(function(K){var me=K.id,Ce=K.name;return{label:Ce,value:me}})},[p.data]),fe=Object(l.useMemo)(function(){var ae;return((ae=P.data)!==null&&ae!==void 0?ae:[]).map(function(K){var me=K.name,Ce=K.id;return{label:me,value:Ce}})},[P.data]),X=Object(l.useMemo)(function(){var ae,K;return ua((ae=g.data)!==null&&ae!==void 0?ae:[],(K=C.data)!==null&&K!==void 0?K:[])},[g.data,C.data]),Be=Object(l.useCallback)(function(){var ae=Object(W.a)(Object(S.a)().mark(function K(me){var Ce,ke,ut,dt,Ot,Ae,Ye;return Object(S.a)().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(ut=me.grade_scale_id,dt=me.grade_term_id,((Ce=j.data)===null||Ce===void 0?void 0:Ce.id)!==void 0){qe.next=3;break}return qe.abrupt("return");case 3:if(Ot=(ke=j.data)===null||ke===void 0?void 0:ke.grades.find(function(yt){var Et=yt.grade_term;return Et.id===dt}),!Ot){qe.next=11;break}return qe.next=7,aa(Ot.id,{grade_scale_id:ut});case 7:return Ae=qe.sent,mt.b[Ae.success?"success":"error"](Ae.message),Ae.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades")),qe.abrupt("return");case 11:return qe.next=13,ta({grade_scale_id:ut,grade_term_id:dt,lesson_group_user_id:j.data.id});case 13:Ye=qe.sent,mt.b[Ye.success?"success":"error"](Ye.message),Ye.success&&u.f.push("/teacher/subjects/".concat(E,"/final-grades"));case 16:case"end":return qe.stop()}},K)}));return function(K){return ae.apply(this,arguments)}}(),[j.data,E]),et=Object(l.useMemo)(function(){var ae;return((ae=p.data)!==null&&ae!==void 0?ae:[]).map(function(K){var me;return Object(d.a)(Object(d.a)({},K),{},{grade:(me=j.data)===null||me===void 0?void 0:me.grades.find(function(Ce){var ke=Ce.grade_term;return ke.id===K.id})})})},[j.data,p.data]),Ke=B.loading&&!B.data||$.loading&&!$.data||N.loading&&!N.data,nt=Boolean(B.data&&$.data&&N.data);return j.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[j.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Student",values:j.data.user})}),Object(e.jsx)($t.a,{})]}),Object(e.jsxs)(ft.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:g.data,loading:g.loading,columns:Ja,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Mt},dataSource:et,loading:j.loading||p.loading,columns:Ya,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:H.data,loading:H.loading,columns:[].concat(za,[{title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(K,me){return Object(e.jsx)(At,{groupAttendanceScheduleId:me.id,studentId:o,attendance:me.attendance.value,onSuccess:Ee})}}])})}),Object(e.jsx)(R.a,{span:12,children:Object(e.jsx)(U.a,{rowKey:"id",headerTitle:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Mt},cardProps:{bodyStyle:{padding:0}},dataSource:C.data,loading:C.loading,columns:Ha})}),Ke&&Object(e.jsx)(se.a,{}),nt&&((c=B.data)===null||c===void 0?void 0:c.map(function(ae){var K,me,Ce,ke,ut,dt,Ot,Ae,Ye=ae.id,ot=ae.title;return Object(e.jsxs)(R.a,{span:24,children:[Object(e.jsx)(st.a.Text,{style:{fontSize:"16px",fontWeight:500},children:ot}),Object(e.jsx)(ra.c,{course_id:Number(Ye),topics:(K=(me=N.data)===null||me===void 0?void 0:me[Number(Ye)])!==null&&K!==void 0?K:[],stats:(Ce=(ke=$.data)===null||ke===void 0||(ut=ke[Number(Ye)])===null||ut===void 0?void 0:ut.finishedTopics)!==null&&Ce!==void 0?Ce:[]}),Object(e.jsx)(ra.a,{stats:(dt=(Ot=$.data)===null||Ot===void 0||(Ae=Ot[Number(Ye)])===null||Ae===void 0?void 0:Ae.attendanceList)!==null&&dt!==void 0?dt:[]})]},Ye)}))]}),Object(e.jsx)(D.a,{form:at,onFinish:Be,children:Object(e.jsxs)(D.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(na.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:be,width:"sm",fieldProps:{loading:p.loading}}),Object(e.jsx)(na.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(u.a,{id:"field_required"})}],label:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:fe,fieldProps:{loading:j.loading||P.loading}}),Object(e.jsx)(D.a.Item,{children:Object(e.jsx)(u.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:X}})})]})})]})},Za=[{title:Object(e.jsx)(u.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,a){return a.user.first_name}},{title:Object(e.jsx)(u.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,a){return a.user.last_name}},{title:Object(e.jsx)(u.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(r){var t=r.grade_name,c=r.grade_term,o=r.id;return Object(e.jsxs)(st.a.Text,{children:[c.name,": ",t]},o)}):"-"})}}],Qa=function(){var n,a,r=Object(T.k)(),t=Object(l.useMemo)(function(){var g,_,j,O;return{user_id:Number.isNaN(Number((g=r.query)===null||g===void 0?void 0:g.user_id))?null:Number((_=r.query)===null||_===void 0?void 0:_.user_id),group_id:Number.isNaN(Number((j=r.query)===null||j===void 0?void 0:j.group_id))?null:Number((O=r.query)===null||O===void 0?void 0:O.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(a=r.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,o=t.group_id,b=Object(he.b)(),f=b.teacherSubjectData,E=b.semester_subject_id,y=Object(l.useMemo)(function(){var g;return((g=f==null?void 0:f.groups)!==null&&g!==void 0?g:[]).map(function(_){var j=_.id,O=_.name;return{label:O,value:j}})},[f==null?void 0:f.groups]);return c!==null&&o!==null?Object(e.jsx)(Xa,{user_id:c,group_id:o}):Object(e.jsx)(U.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var g=Object(W.a)(Object(S.a)().mark(function _(j){var O,p,x,P,M,C,z,H,Ee,we;return Object(S.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return p=j.group_id,x=p===void 0?[]:p,P=j.first_name,M=P===void 0?"":P,C=j.last_name,z=C===void 0?"":C,H=((O=f==null?void 0:f.groups)!==null&&O!==void 0?O:[]).map(function(N){var q=N.id;return q}),$.next=4,kt(x.length===0?H:x);case 4:if(Ee=$.sent,Ee.success){$.next=7;break}return $.abrupt("return",{success:!1,total:0,data:[]});case 7:return we=Ee.data.filter(function(N){var q=N.user;return q.first_name.toLowerCase().includes(M.toLowerCase())&&q.last_name.toLowerCase().includes(z.toLowerCase())}),$.abrupt("return",{success:!0,total:we.length,data:we});case 9:case"end":return $.stop()}},_)}));return function(_){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:y,mode:"multiple"},render:function(_,j){return Object(e.jsx)(ce.a,{type:"Students",type_id:j.group_id},j.group_id)}}].concat(Za,[{title:Object(e.jsx)(u.a,{id:"options"}),hideInSearch:!0,render:function(_,j){return[Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(E,"/final-grades?user_id=").concat(j.user.id,"&group_id=").concat(j.group_id),children:Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"edit"}),children:Object(e.jsx)(je.a,{type:"primary",icon:Object(e.jsx)(We.a,{})})})},"edit")]}}])})},ka=s("dF/Y"),qa=s("o+0V"),ia=s("0WSk"),en=["type","defaultRender"],tn=["type","defaultRender"],an=function(n){var a=n.url;return Object(e.jsx)(He.a,{title:Object(e.jsx)(u.a,{id:"download"}),children:Object(e.jsx)(je.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(ka.a,{})})})},nn=[{title:Object(e.jsx)(u.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,a){return Object(ze.a)(new Date(a.created_at),v.a)}},{title:Object(e.jsx)(u.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,o=Object(Tt.a)(a,en);if(t==="form")return null;var b=r.getFieldValue("state");return Object(e.jsx)(ia.a,Object(d.a)(Object(d.a)({},o),{},{state:{type:b}}))},render:function(n,a){return Object(e.jsx)(ce.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(u.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,a){return Object(ze.a)(new Date(a.exported_at),v.a)}},{title:Object(e.jsx)(u.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,o=Object(Tt.a)(a,tn);if(t==="form")return null;var b=r.getFieldValue("state");return Object(e.jsx)(ia.a,Object(d.a)(Object(d.a)({},o),{},{state:{type:b}}))},render:function(n,a){return Object(e.jsx)(ce.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(u.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(u.a,{id:"options"}),valueType:"option",render:function(n,a){return[Object(e.jsx)(an,{url:a.url},"download")]}}],rn=function(){var n,a,r=Object(he.b)(),t=r.teacherSubjectData,c=Object(l.useMemo)(function(){var b;return((b=t==null?void 0:t.groups)!==null&&b!==void 0?b:[]).map(function(f){var E=f.id,y=f.name;return{value:E,label:y}})},[t==null?void 0:t.groups]),o=Object(l.useMemo)(function(){var b,f;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(b=t.groups)===null||b===void 0||(f=b[0])===null||f===void 0?void 0:f.id,allowClear:!1}}].concat(nn)},[t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(U.a,{className:"table-standalone",request:function(){var b=Object(W.a)(Object(S.a)().mark(function f(E){var y,g,_,j,O,p,x;return Object(S.a)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return _=E.group_id,j=_===void 0?t==null||(y=t.groups)===null||y===void 0||(g=y[0])===null||g===void 0?void 0:g.id:_,O=E.created_by,p=E.exported_by,M.next=3,Object(qa.a)({group_id:j,created_by:O,exported_by:p});case 3:if(x=M.sent,x.success){M.next=6;break}return M.abrupt("return",{success:!1,data:[],total:0});case 6:return M.abrupt("return",{success:!0,data:x.data,total:x.data.length});case 7:case"end":return M.stop()}},f)}));return function(f){return b.apply(this,arguments)}}(),columns:o,search:{layout:"vertical"},scroll:{x:1500}})},sn=function(n,a){var r;return(r=n.find(function(t){return t.name===a}))===null||r===void 0?void 0:r.id},un=function(n){var a=n.term,r=n.gradeScales,t=n.defaultFinalGrade,c=n.finalGrades,o=Object(l.useState)(t),b=Object(G.a)(o,2),f=b[0],E=b[1],y=Object(l.useState)(!1),g=Object(G.a)(y,2),_=g[0],j=g[1],O=Object(l.useMemo)(function(){return r.map(function(x){var P=x.name,M=x.id;return{value:M,label:P}})},[r]),p=Object(l.useCallback)(function(x){if(!!(c!=null&&c.id)){if(f){j(!0),aa(f.id,{grade_scale_id:x}).finally(function(){return j(!1)});return}j(!0),ta({grade_term_id:a.id,grade_scale_id:x,lesson_group_user_id:c.id}).then(function(P){if(P.success){var M=P.data.grades.find(function(C){return C.grade_term.id===a.id});E(M)}}).finally(function(){return j(!1)})}},[f,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(pt.a,{loading:_,disabled:_,placeholder:Object(e.jsx)(u.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:p,options:O,defaultValue:sn(r,t==null?void 0:t.grade_name)}):null},cn=s("LvDl"),ln=function(n){var a=n.exam_id,r=n.result,t=n.student_id,c=n.onSuccess,o=Object(l.useCallback)(Object(cn.debounce)(function(b){Xe(a,t,{result:b!=null?b:0}).then(function(f){f.success&&(c==null||c(f.data))})},300),[a,r,t]);return Object(e.jsx)(F.a,{type:"number",min:0,max:100,onChange:o,defaultValue:r})},dn=function(n){var a=n.reduce(function(r,t){return[].concat(Object(ne.a)(r),[{title:Object(ze.a)(new Date(t.date_from),v.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(o,b){return Object(e.jsx)(At,{groupAttendanceScheduleId:t.id,attendance:b["attendance-".concat(t==null?void 0:t.date_from)],studentId:b.id})}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},on=function(n,a){return n.reduce(function(r,t){var c=t.attendances.find(function(o){return o.user_id===a});return c?Object(d.a)(Object(d.a)({},r),{},Object(bt.a)({},"attendance-".concat(t.date_from),c.value)):r},{})},jn=function(n){var a=n.reduce(function(r,t){return[].concat(Object(ne.a)(r),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(u.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(o,b){var f;return(b==null||(f=b["exam-".concat(t.id)])===null||f===void 0?void 0:f.result)!==void 0?Object(e.jsx)(ln,{result:b==null?void 0:b["exam-".concat(t.id)].result,exam_id:t.id,student_id:b.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(u.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},bn=function(n){return n.reduce(function(a,r){var t=r.result,c=r.id;return Object(d.a)(Object(d.a)({},a),{},Object(bt.a)({},"exam-".concat(c),t))},{})},vn=function(n,a){return{title:Object(e.jsx)(u.a,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(c,o){return Object(e.jsx)(un,{defaultFinalGrade:o["final-grade-".concat(r.id)],finalGrades:o.final_grades,term:r,gradeScales:a})}}})}},fn=function(n,a){return n.find(function(r){return r.user.id===a})},mn=function(n){var a;return((a=n==null?void 0:n.grades)!==null&&a!==void 0?a:[]).reduce(function(r,t){return Object(d.a)(Object(d.a)({},r),{},Object(bt.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},On=function(){var n,a,r=Object(he.b)(),t=r.teacherSubjectData,c=r.semester_subject_id,o=Object(l.useState)([]),b=Object(G.a)(o,2),f=b[0],E=b[1],y=Object(l.useState)(t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.name),g=Object(G.a)(y,2),_=g[0],j=g[1],O=Object(u.l)(),p=Object(l.useMemo)(function(){var M;return((M=t==null?void 0:t.groups)!==null&&M!==void 0?M:[]).map(function(C){var z=C.id,H=C.name;return{value:z,label:H}})},[t==null?void 0:t.groups]),x=Object(l.useRef)(),P=Object(l.useMemo)(function(){var M;return[{title:Object(e.jsx)(u.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:p,defaultValue:p==null||(M=p[0])===null||M===void 0?void 0:M.value,allowClear:!1}},{title:Object(e.jsx)(u.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(ne.a)(f))},[p,f]);return Object(e.jsx)(U.a,{className:"table-standalone",request:function(){var M=Object(W.a)(Object(S.a)().mark(function C(z){var H,Ee,we,B,$,N,q,Ze,at,be,fe,X,Be,et,Ke,nt,ae,K,me,Ce,ke,ut,dt;return Object(S.a)().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return N=z.group_id,q=N===void 0?(H=p[0])===null||H===void 0?void 0:H.value:N,Ze=z.full_name,at=Ze===void 0?"":Ze,Ae.next=3,kt(q);case 3:if(be=Ae.sent,fe=p.find(function(Ye){var ot=Ye.value;return ot===q}),!(!be.success||be.data[0]===void 0||c===null)){Ae.next=8;break}return mt.b.error(O.formatMessage({id:"groupDataMissing"},{group_name:fe==null?void 0:fe.label})),Ae.abrupt("return",{data:[],total:0,success:!1});case 8:return Ae.next=10,Promise.all([Object(xt.b)(q),Rt(q),Ve({group_id:q,per_page:-1}),Nt(c,(Ee=be.data)===null||Ee===void 0||(we=Ee[0])===null||we===void 0?void 0:we.tutor_id),qt(),ea((B=be.data)===null||B===void 0||($=B[0])===null||$===void 0?void 0:$.s_subject_scale_form_id)]);case 10:if(X=Ae.sent,Be=Object(G.a)(X,6),et=Be[0],Ke=Be[1],nt=Be[2],ae=Be[3],K=Be[4],me=Be[5],!(!et.success||!Ke.success||!nt.success||!ae.success||!K.success||!me.success||!fe)){Ae.next=21;break}return mt.b.error(O.formatMessage({id:"groupDataMissing"},{group_name:fe==null?void 0:fe.label})),Ae.abrupt("return",{data:[],total:0,success:!1});case 21:return j(fe.label),Ce=dn(Ke.data),ke=jn(nt.data),ut=vn(K.data,me.data),E([Ce,ke,ut,{title:Object(e.jsx)(u.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),dt=et.data.users.reduce(function(Ye,ot){var qe,yt,Et,Pt=ot.id,pn=ot.academic_teacher_id,gn=ot.first_name,xn=ot.last_name,la="".concat(xn," ").concat(gn);if(pn!==null||!la.toLowerCase().includes(at.toLowerCase()))return Ye;var Sn=on(Ke.data,Pt),da=sa(nt.data,Pt),Ct=fn(be.data,Pt),_n=(qe=ca((yt=Ct==null?void 0:Ct.s_subject_scale_form_id)!==null&&yt!==void 0?yt:0,(Et=ae.data.grade_scale)!==null&&Et!==void 0?Et:[]))!==null&&qe!==void 0?qe:[],yn=ua(da,_n),En=bn(da),Cn=mn(Ct);return[].concat(Object(ne.a)(Ye),[Object(d.a)(Object(d.a)(Object(d.a)(Object(d.a)({id:Pt,full_name:la},Sn),En),Cn),{},{proposed_grade:yn,final_grades:Ct})])},[]).sort(function(Ye,ot){return Ye.full_name.localeCompare(ot.full_name)}),Ae.abrupt("return",{data:dt,total:dt.length,success:!0});case 28:case"end":return Ae.stop()}},C)}));return function(C){return M.apply(this,arguments)}}(),columns:P,headerTitle:Object(e.jsx)(u.a,{id:"classRegisterTitleWithGroupName",values:{groupName:_}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:x,pagination:{onChange:function(){var C;return(C=x.current)===null||C===void 0?void 0:C.reload()}},rowKey:"id"})},hn=function(n){var a,r,t=n.tab,c=Object(u.l)(),o=Object(u.m)("@@initialState"),b=o.setInitialState,f=o.initialState,E=Object(he.b)(),y=E.teacherSubjectData,g=E.semester_subject_id,_=E.tutors,j=Object(l.useCallback)(Object(ie.a)(f==null?void 0:f.currentUser),[f==null?void 0:f.currentUser]),O=Object(l.useMemo)(function(){return!!_.data.find(function(p){var x,P=p.id;return P===(f==null||(x=f.currentUser)===null||x===void 0?void 0:x.id)})||j(Oe.a.TeacherListGradeScale)},[]);return y?Object(e.jsx)($e.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(u.a,{id:y==null||(a=y.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(u.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Te.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(je.a,{type:"primary",children:Object(e.jsx)(u.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"Subjects"})},{path:String(g),breadcrumbName:String((r=y.subject)===null||r===void 0?void 0:r.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(h.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(x){b(Object(d.a)({},f)),u.f.push("/teacher/subjects/".concat(g,"/").concat(x))}},children:[Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"groups"}),children:Object(e.jsx)(rt.a,{})},"groups"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"students"}),children:Object(e.jsx)(ma,{})},"students"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"exams"}),children:Object(e.jsx)(_t,{})},"exams"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"schedule"}),children:Object(e.jsx)(La,{})},"schedule"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"class-register"}),children:Object(e.jsx)(On,{})},"class-register"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"attendance"}),children:Object(e.jsx)(Sa,{})},"attendance"),O&&Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"grades-scale"}),children:Object(e.jsx)(Pa,{})},"grades-scale"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"final-grades"}),children:Object(e.jsx)(Qa,{})},"final-grades"),Object(e.jsx)(h.a.TabPane,{tab:Object(e.jsx)(u.a,{id:"file-exports-history"}),children:Object(e.jsx)(rn,{})},"file-exports-history")]})}):Object(e.jsx)(se.a,{})},Ln=ve.default=function(){var i=Object(T.l)(),n=i.subjectId,a=i.tab,r=a===void 0?"groups":a;return Object(e.jsx)(he.a,{semester_subject_id:Number(n),children:Object(e.jsx)(hn,{tab:r})})}},p3I6:function(ht,ve,s){"use strict";s.d(ve,"b",function(){return ie}),s.d(ve,"c",function(){return Ue}),s.d(ve,"a",function(){return ct});var d=s("miYZ"),_e=s("tsqr"),je=s("tJVT"),I=s("k1fw"),se=s("oBTY"),l=s("q1tI"),Qe=s.n(l),u=s("9kvl"),Te=s("Ty5D"),T=s("H6aw"),h=s("/y+f"),$e=s("nKUr"),Oe=s.n($e),ie=Qe.a.createContext({}),he=function(){return Math.round(Math.random()*99999)},rt=function pe(le){return le.reduce(function(k,m){return[].concat(Object(se.a)(k),Object(se.a)(m.lessons?pe(m.lessons):[]),[m])},[])},Ue=function pe(le){return le.reduce(function(k,m){var J;return[].concat(Object(se.a)(k),Object(se.a)(m.lessons?pe(m.lessons):[]),Object(se.a)((J=m.topics)!==null&&J!==void 0?J:[]))},[])},jt=function pe(le,k,m){return le.map(function(J){var Ie,U;return Object(I.a)(Object(I.a)({},J),{},{lessons:J.lessons?pe(J.lessons,k,m):[],topics:J.id===k?[].concat(Object(se.a)((Ie=J.topics)!==null&&Ie!==void 0?Ie:[]),[m]):(U=J.topics)!==null&&U!==void 0?U:[]})})},vt=function pe(le,k,m){return m?le.map(function(J){return Object(I.a)(Object(I.a)({},J),{},{lessons:[].concat(Object(se.a)(J.lessons?pe(J.lessons,k,m):[]),Object(se.a)(J.id===m?[k]:[]))})}):[].concat(Object(se.a)(le),[k])},He=function pe(le,k,m){return le.map(function(J){return Object(I.a)(Object(I.a)({},J.id===k?m:J),{},{lessons:J.lessons?pe(J.lessons,k,m):[]})})},S=function pe(le,k){return le.map(function(m){return Object(I.a)(Object(I.a)({},m),{},{parent_id:k,lessons:m.lessons?pe(m.lessons,m.id):[]})})},W=function pe(le,k){return le.filter(function(m){return m.id!==k}).map(function(m){return Object(I.a)(Object(I.a)({},m),{},{lessons:m.lessons?pe(m.lessons,k):[]})})},ze=function pe(le,k){return le.map(function(m){return Object(I.a)(Object(I.a)({},m),{},{lessons:m.lessons?pe(m.lessons,k):[],topics:m.topics?m.topics.filter(function(J){return J.id!==k}):[]})})},We=function pe(le,k,m,J){return J==null?void 0:J.map(function(Ie){if(Ie.id===m){var U;return Object(I.a)(Object(I.a)({},Ie),{},{topics:(U=Ie.topics)===null||U===void 0?void 0:U.map(function(v){return v.id===le?k.file.response.data:v})})}else if(Ie.lessons)return Object(I.a)(Object(I.a)({},Ie),{},{lessons:pe(le,k,m,Ie.lessons||[])});return Ie})},ct=function(le){var k=le.children,m=le.id,J=Object(l.useState)(),Ie=Object(je.a)(J,2),U=Ie[0],v=Ie[1],Ve=Object(u.l)(),Ne=Object(l.useMemo)(function(){return U&&U.lessons?Ue(U.lessons):[]},[U]),de=Object(l.useMemo)(function(){return U&&U.lessons?rt(U.lessons):[]},[U]),De=Object(l.useState)([]),Me=Object(je.a)(De,2),Ge=Me[0],ge=Me[1],ee=Object(Te.k)();Object(l.useEffect)(function(){ge([])},[]);var ye=Object(l.useCallback)(function(){Object(T.m)(m).then(function(R){return R.success&&v(Object(I.a)(Object(I.a)({},R.data),{},{lessons:S(R.data.lessons)}))})},[m]);Object(l.useEffect)(function(){ye()},[ye]);var xe=Object(l.useCallback)(function(R){var D=de.find(function(V){var w;return V==null||(w=V.topics)===null||w===void 0?void 0:w.find(function(L){return L.id===R})});return D?D.id:null},[de]),Xe=Object(l.useMemo)(function(){var R,D;return(R=ee.query)!==null&&R!==void 0&&R.lesson?{mode:"lesson",id:Number(ee.query.lesson),value:de.find(function(V){return V.id===Number(ee.query.lesson)})}:(D=ee.query)!==null&&D!==void 0&&D.topic?{mode:"topic",id:Number(ee.query.topic),value:Ne.find(function(V){return V.id===Number(ee.query.topic)})}:{mode:"init"}},[ee.query,U,de,Ne]),Je=Object(l.useCallback)(function(R){var D={course_id:m,topics:[],isNew:!0,id:U?U.lessons.length+1:he(),order:0,title:Ve.formatMessage({id:"add_title_here"}),active:!0,parent_id:R};return v(function(V){var w;return Object(I.a)(Object(I.a)({},V),{},{lessons:vt((w=V==null?void 0:V.lessons)!==null&&w!==void 0?w:[],D,R)})}),D},[m,U]),Se=Object(l.useCallback)(function(R,D){var V=de.find(function(L){return L.id===R}),w=V&&V.isNew;return(w?Object(T.g)(D):Object(T.u)(R,D)).then(function(L){return _e.b.success(L.message),ye(),L.success&&v(function(Y){var Re;return Object(I.a)(Object(I.a)({},Y),{},{lessons:He((Re=Y==null?void 0:Y.lessons)!==null&&Re!==void 0?Re:[],R,Object(I.a)(Object(I.a)({},L.data),{},{isNew:!1}))})})})},[U]),ue=Object(l.useCallback)(function(R){var D=de.find(function(w){return w.id===R});if(!!D){var V=D.isNew;V?v(function(w){var L;return Object(I.a)(Object(I.a)({},w),{},{lessons:W((L=w==null?void 0:w.lessons)!==null&&L!==void 0?L:[],R)})}):Object(T.o)(R).then(function(w){w.success&&(_e.b.success(w.message),v(function(L){var Y;return Object(I.a)(Object(I.a)({},L),{},{lessons:W((Y=L==null?void 0:L.lessons)!==null&&Y!==void 0?Y:[],R)})}))})}},[U]),ce=Object(l.useCallback)(function(R,D){var V,w=xe(R),L=de.find(function(ne){return ne.id===w}),Y=L&&((V=L.topics)===null||V===void 0?void 0:V.find(function(ne){return ne.id===R})),Re=Y==null?void 0:Y.isNew;return(Re?Object(T.h)(D):Object(T.v)(R,D)).then(function(ne){ne.success&&(_e.b.success(ne.message),ye(),u.f.push("/courses/list/".concat(m,"/program/?topic=").concat(ne.data.id)),(Y==null?void 0:Y.topicable_type)===h.g.Video&&setTimeout(function(){ye()},5e3))})},[xe,U,ye]),A=Object(l.useCallback)(function(R){var D=xe(R),V=de.find(function(Y){return Y.id===D});if(!!V){var w=Ne==null?void 0:Ne.find(function(Y){return Y.id===R}),L=w==null?void 0:w.isNew;L&&!w.topicable?v(function(Y){var Re;return Object(I.a)(Object(I.a)({},Y),{},{lessons:ze((Re=Y==null?void 0:Y.lessons)!==null&&Re!==void 0?Re:[],R)})}):Object(T.p)(R).then(function(Y){Y.success&&(_e.b.success(Y.message),v(function(Re){var ne;return Object(I.a)(Object(I.a)({},Re),{},{lessons:ze((ne=Re==null?void 0:Re.lessons)!==null&&ne!==void 0?ne:[],R)})}))})}},[U,xe]),F=Object(l.useCallback)(function(R,D){var V={lesson_id:R,isNew:!0,id:he(),title:Ve.formatMessage({id:"add_title_here"}),active:!0,topicable_type:D};return v(function(w){var L;return Object(I.a)(Object(I.a)({},w),{},{lessons:jt((L=w==null?void 0:w.lessons)!==null&&L!==void 0?L:[],R,V)})}),V},[]),G=function(D,V){var w=xe(D);v(function(L){return Object(I.a)(Object(I.a)({},L),{},{lessons:L?We(D,V,w,L.lessons||[]):[]})}),u.f.push("/courses/list/".concat(m,"/program/?topic=").concat(V.file.response.data.id))},Z=Object(l.useCallback)(function(R){return Object(T.d)(R).then(function(D){if(D.success){_e.b.success(D.message);var V=xe(R);v(function(w){var L;return Object(I.a)(Object(I.a)({},w),{},{lessons:w?(L=w.lessons)===null||L===void 0?void 0:L.map(function(Y){if(Y.id===V){var Re=Y.topics||[];return Object(I.a)(Object(I.a)({},Y),{},{topics:[].concat(Object(se.a)(Re),[D.data])})}return Y}):[]})})}})},[U,xe]),ft=Object(l.useCallback)(function(R){return Object(T.c)(R).then(function(D){D.success&&(_e.b.success(D.message),v(function(V){return Object(I.a)(Object(I.a)({},V),{},{lessons:V?[].concat(Object(se.a)(V.lessons),[D.data]):[]})}))})},[]),tt={state:U,h5ps:Ge,id:m,addNewLesson:Je,updateLesson:Se,updateTopic:ce,deleteLesson:ue,addNewTopic:F,deleteTopic:A,onTopicUploaded:G,cloneTopic:Z,cloneLesson:ft,currentEditMode:Xe,getLessons:ye};return Object($e.jsx)(ie.Provider,{value:tt,children:k})}},"w/VK":function(ht,ve,s){"use strict";s.d(ve,"b",function(){return se}),s.d(ve,"a",function(){return Qe});var d=s("qLMh"),_e=s("k1fw"),je=s("9og8"),I=s("9kvl");function se(Te,T){return l.apply(this,arguments)}function l(){return l=Object(je.a)(Object(d.a)().mark(function Te(T,h){return Object(d.a)().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return Oe.abrupt("return",Object(I.i)("/api/admin/reports/report",Object(_e.a)({params:T,method:"GET",useCache:!1},h||{})));case 1:case"end":return Oe.stop()}},Te)})),l.apply(this,arguments)}function Qe(Te,T,h){return u.apply(this,arguments)}function u(){return u=Object(je.a)(Object(d.a)().mark(function Te(T,h,$e){return Object(d.a)().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.abrupt("return",Object(I.i)("/api/admin/stats/course/".concat(T,"/export"),Object(_e.a)({params:h,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},$e||{})));case 1:case"end":return ie.stop()}},Te)})),u.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.858d058d.async.js.map