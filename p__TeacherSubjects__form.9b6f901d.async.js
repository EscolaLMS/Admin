"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803,8047],{56717:function(Tt,qe,u){var Xe=u(1413),m=u(67294),Ke=u(93696),Pe=u(84089),Se=function(g,v){return m.createElement(Pe.Z,(0,Xe.Z)((0,Xe.Z)({},g),{},{ref:v,icon:Ke.Z}))},B=m.forwardRef(Se);qe.Z=B},78677:function(Tt,qe,u){var Xe=u(67294),m=u(46438),Ke=function(){return Ke=Object.assign||function(Se){for(var B,$e=1,g=arguments.length;$e<g;$e++){B=arguments[$e];for(var v in B)Object.prototype.hasOwnProperty.call(B,v)&&(Se[v]=B[v])}return Se},Ke.apply(this,arguments)},Pe=(0,Xe.forwardRef)(function(Se,B){return Xe.createElement(m.P,Ke({},Se,{chartType:"Column",ref:B}))});qe.Z=Pe},88280:function(Tt,qe,u){u.d(qe,{Z:function(){return se}});var Xe=u(4942),m=u(97685),Ke=u(45987),Pe=u(74165),Se=u(15861),B=u(1413),$e=u(87462),g=u(67294),v=u(42110),s=u(78026),Q=function(T,e){return g.createElement(s.Z,(0,$e.Z)({},T,{ref:e,icon:v.Z}))},d=g.forwardRef(Q),P=d,i=u(97462),y=u(952),I=u(10915),te=u(48171),Z=u(53914),H=u(22270),_e=u(60249),he=u(14726),je=u(75842),Ve=u(21770),at=u(88306),pt=u(8880),gt=u(48433),Ze=u(85893),Ft=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],xt=["record","position","creatorButtonText","newRecordType","parentKey","style"],ye=g.createContext(void 0);function C(j){var T=j.children,e=j.record,Ie=j.position,we=j.newRecordType,le=j.parentKey,ke=(0,g.useContext)(ye);return g.cloneElement(T,(0,B.Z)((0,B.Z)({},T.props),{},{onClick:function(){var Oe=(0,Se.Z)((0,Pe.Z)().mark(function Ce(He){var Be,Ae,fe,ce;return(0,Pe.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(Be=(Ae=T.props).onClick)===null||Be===void 0?void 0:Be.call(Ae,He);case 2:if(ce=W.sent,ce!==!1){W.next=5;break}return W.abrupt("return");case 5:ke==null||(fe=ke.current)===null||fe===void 0||fe.addEditRecord(e,{position:Ie,newRecordType:we,parentKey:le});case 6:case"end":return W.stop()}},Ce)}));function Me(Ce){return Oe.apply(this,arguments)}return Me}()}))}function oe(j){var T,e,Ie=(0,I.YB)(),we=j.onTableChange,le=j.maxLength,ke=j.formItemProps,Oe=j.recordCreatorProps,Me=j.rowKey,Ce=j.controlled,He=j.defaultValue,Be=j.onChange,Ae=j.editableFormRef,fe=(0,Ke.Z)(j,Ft),ce=(0,g.useRef)(void 0),ne=(0,g.useRef)(),W=(0,g.useRef)();(0,g.useImperativeHandle)(fe.actionRef,function(){return ne.current},[ne.current]);var w=(0,Ve.Z)(function(){return j.value||He||[]},{value:j.value,onChange:j.onChange}),Ge=(0,m.Z)(w,2),ie=Ge[0],Et=Ge[1],et=g.useMemo(function(){return typeof Me=="function"?Me:function(N,ee){return N[Me]||ee}},[Me]),jt=(0,te.J)(function(N){if(typeof N=="number"&&!j.name){if(N>=ie.length)return N;var ee=ie&&ie[N];return et==null?void 0:et(ee,N)}if((typeof N=="string"||N>=ie.length)&&j.name){var de=ie.findIndex(function(me,ge){var Te;return(et==null||(Te=et(me,ge))===null||Te===void 0?void 0:Te.toString())===(N==null?void 0:N.toString())});if(de!==-1)return de}return N});(0,g.useImperativeHandle)(Ae,function(){var N=function(me){var ge,Te;if(me==null)throw new Error("rowIndex is required");var Ye=jt(me),st=[j.name,(ge=Ye==null?void 0:Ye.toString())!==null&&ge!==void 0?ge:""].flat(1).filter(Boolean);return(Te=W.current)===null||Te===void 0?void 0:Te.getFieldValue(st)},ee=function(){var me,ge=[j.name].flat(1).filter(Boolean);if(Array.isArray(ge)&&ge.length===0){var Te,Ye=(Te=W.current)===null||Te===void 0?void 0:Te.getFieldsValue();return Array.isArray(Ye)?Ye:Object.keys(Ye).map(function(st){return Ye[st]})}return(me=W.current)===null||me===void 0?void 0:me.getFieldValue(ge)};return(0,B.Z)((0,B.Z)({},W.current),{},{getRowData:N,getRowsData:ee,setRowData:function(me,ge){var Te,Ye;if(me==null)throw new Error("rowIndex is required");var st=jt(me),yt=[j.name,(Te=st==null?void 0:st.toString())!==null&&Te!==void 0?Te:""].flat(1).filter(Boolean),wt=Object.assign({},(0,B.Z)((0,B.Z)({},N(me)),ge||{})),tt=(0,pt.Z)({},yt,wt);return(Ye=W.current)===null||Ye===void 0||Ye.setFieldsValue(tt),!0}})},[jt,j.name,W.current]),(0,g.useEffect)(function(){j.controlled&&(ie||[]).forEach(function(N,ee){var de;(de=W.current)===null||de===void 0||de.setFieldsValue((0,Xe.Z)({},"".concat(et(N,ee)),N))},{})},[(0,Z.ZP)(ie),j.controlled]),(0,g.useEffect)(function(){if(j.name){var N;W.current=j==null||(N=j.editable)===null||N===void 0?void 0:N.form}},[(T=j.editable)===null||T===void 0?void 0:T.form,j.name]);var rt=Oe||{},Lt=rt.record,_t=rt.position,Pt=rt.creatorButtonText,Zt=rt.newRecordType,Dt=rt.parentKey,It=rt.style,k=(0,Ke.Z)(rt,xt),Y=_t==="top",V=(0,g.useMemo)(function(){return typeof le=="number"&&le<=(ie==null?void 0:ie.length)?!1:Oe!==!1&&(0,Ze.jsx)(C,{record:(0,H.h)(Lt,ie==null?void 0:ie.length,ie)||{},position:_t,parentKey:(0,H.h)(Dt,ie==null?void 0:ie.length,ie),newRecordType:Zt,children:(0,Ze.jsx)(he.ZP,(0,B.Z)((0,B.Z)({type:"dashed",style:(0,B.Z)({display:"block",margin:"10px 0",width:"100%"},It),icon:(0,Ze.jsx)(P,{})},k),{},{children:Pt||Ie.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Oe,le,ie==null?void 0:ie.length]),X=(0,g.useMemo)(function(){return V?Y?{components:{header:{wrapper:function(ee){var de,me=ee.className,ge=ee.children;return(0,Ze.jsxs)("thead",{className:me,children:[ge,(0,Ze.jsxs)("tr",{style:{position:"relative"},children:[(0,Ze.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:V}),(0,Ze.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(de=fe.columns)===null||de===void 0?void 0:de.length,children:V})]})]})}}}}:{tableViewRender:function(ee,de){var me,ge;return(0,Ze.jsxs)(Ze.Fragment,{children:[(me=(ge=j.tableViewRender)===null||ge===void 0?void 0:ge.call(j,ee,de))!==null&&me!==void 0?me:de,V]})}}:{}},[Y,V]),K=(0,B.Z)({},j.editable),J=(0,te.J)(function(N,ee){var de,me,ge;if((de=j.editable)===null||de===void 0||(me=de.onValuesChange)===null||me===void 0||me.call(de,N,ee),(ge=j.onValuesChange)===null||ge===void 0||ge.call(j,ee,N),j.controlled){var Te;j==null||(Te=j.onChange)===null||Te===void 0||Te.call(j,ee)}});return(j!=null&&j.onValuesChange||(e=j.editable)!==null&&e!==void 0&&e.onValuesChange||j.controlled&&j!==null&&j!==void 0&&j.onChange)&&(K.onValuesChange=J),(0,Ze.jsxs)(Ze.Fragment,{children:[(0,Ze.jsx)(ye.Provider,{value:ne,children:(0,Ze.jsx)(gt.Z,(0,B.Z)((0,B.Z)((0,B.Z)({search:!1,options:!1,pagination:!1,rowKey:Me,revalidateOnFocus:!1},fe),X),{},{tableLayout:"fixed",actionRef:ne,onChange:we,editable:(0,B.Z)((0,B.Z)({},K),{},{formProps:(0,B.Z)({formRef:W},K.formProps)}),dataSource:ie,onDataSourceChange:function(ee){if(Et(ee),j.name&&_t==="top"){var de,me=(0,pt.Z)({},[j.name].flat(1).filter(Boolean),ee);(de=W.current)===null||de===void 0||de.setFieldsValue(me)}}}))}),j.name?(0,Ze.jsx)(i.Z,{name:[j.name],children:function(ee){var de,me;if(!ce.current)return ce.current=ie,null;var ge=(0,at.Z)(ee,[j.name].flat(1)),Te=ge==null?void 0:ge.find(function(Ye,st){var yt;return!(0,_e.A)(Ye,(yt=ce.current)===null||yt===void 0?void 0:yt[st])});return ce.current=ie,Te&&(j==null||(de=j.editable)===null||de===void 0||(me=de.onValuesChange)===null||me===void 0||me.call(de,Te,ge)),null}}):null]})}function R(j){var T=y.ZP.useFormInstance();return j.name?(0,Ze.jsx)(je.Z.Item,(0,B.Z)((0,B.Z)({style:{maxWidth:"100%"}},j==null?void 0:j.formItemProps),{},{name:j.name,shouldUpdate:function(Ie,we){var le=[j.name].flat(1);try{return JSON.stringify((0,at.Z)(Ie,le))!==JSON.stringify((0,at.Z)(we,le))}catch(ke){return!0}},children:(0,Ze.jsx)(oe,(0,B.Z)((0,B.Z)({},j),{},{editable:(0,B.Z)((0,B.Z)({},j.editable),{},{form:T})}))})):(0,Ze.jsx)(oe,(0,B.Z)({},j))}R.RecordCreator=C;var se=R},11312:function(Tt,qe,u){u.d(qe,{nu:function(){return T},rL:function(){return j},Du:function(){return se}});var Xe=u(9783),m=u.n(Xe),Ke=u(97857),Pe=u.n(Ke),Se=u(19632),B=u.n(Se),$e=u(5574),g=u.n($e),v=u(45919),s=u(66419),Q=u(78677),d=u(26271),P=u(78957),i=u(66309),y=u(72051),I=u(71230),te=u(72269),Z=u(74656),H=u(60943),_e=u(67294),he=u(70804),je=u(80854),Ve=u(62235),at=u(15009),pt=u.n(at),gt=u(99289),Ze=u.n(gt),Ft=u(58638),xt=u(14726),ye=u(76841),C=u(85893),oe=function(Ie){var we=Ie.course_id,le=Ie.stat,ke=le===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":le,Oe=(0,_e.useState)(!1),Me=g()(Oe,2),Ce=Me[0],He=Me[1],Be=(0,_e.useCallback)(function(Ae){return Ze()(pt()().mark(function fe(){var ce,ne;return pt()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return He(!0),w.prev=1,w.next=4,(0,ye._g)(Ae,{stat:ke});case 4:ce=w.sent,ce instanceof Blob&&(ne=document.createElement("a"),ne.href=window.URL.createObjectURL(ce),ne.download="finished_topics_".concat(we,".xlsx"),document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)),w.next=11;break;case 8:w.prev=8,w.t0=w.catch(1),console.error(w.t0);case 11:return w.prev=11,He(!1),w.finish(11);case 14:case"end":return w.stop()}},fe,null,[[1,8,11,14]])}))},[ke]);return(0,C.jsxs)(xt.ZP,{type:"primary",loading:Ce,onClick:Be(we),children:[(0,C.jsx)(Ft.Z,{})," ",(0,C.jsx)(je.FormattedMessage,{id:"export"})]})},R=function(Ie){return Ie.topicable.content.contents?Object.values(Ie.topicable.content.contents)[0].library:"H5P"},se=function(Ie){var we=Ie.course_id,le=Ie.topics,ke=Ie.stats,Oe=(0,_e.useState)(!1),Me=g()(Oe,2),Ce=Me[0],He=Me[1],Be=(0,_e.useMemo)(function(){return[{title:(0,C.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(ce){return(0,C.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:ce})}},{title:(0,C.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(B()(le.map(function(fe){var ce,ne=(ce=fe.topicable_type)===null||ce===void 0?void 0:ce.split("\\").pop();return ne==="H5P"&&(ne=R(fe)),{render:function(w){var Ge=0;switch(w&&(w.started_at&&w.finished_at?Ge=1:w.started_at&&(Ge=2)),Ge){case 1:return(0,C.jsxs)(P.Z,{children:[(0,C.jsx)(i.Z,{color:"success",children:"F"}),Ce&&(w==null?void 0:w.seconds)&&(0,C.jsx)("small",{children:(0,s.Im)(w.seconds)})]});case 2:return(0,C.jsxs)(P.Z,{children:[(0,C.jsx)(i.Z,{color:"blue",children:"S"}),Ce&&(w==null?void 0:w.seconds)&&(0,C.jsx)("small",{children:(0,s.Im)(w.seconds)})]});case 0:default:return(0,C.jsx)(_e.Fragment,{children:(0,C.jsx)(i.Z,{color:"error",children:"N"})})}},title:(0,C.jsxs)("small",{children:[(0,C.jsx)(i.Z,{children:ne})," ",fe.title]}),dataIndex:fe.id}})))},[le,Ce]),Ae=(0,_e.useMemo)(function(){return ke.map(function(fe){return le.reduce(function(ce,ne){var W=fe.topics.find(function(w){return w.id===ne.id});return Pe()(Pe()({},ce),{},m()({},Number(ne.id),W!=null?W:0))},{email:fe.email,id:fe.id})})},[ke,le]);return(0,C.jsx)(y.Z,{title:function(){return(0,C.jsxs)(I.Z,{justify:"space-between",align:"middle",children:[(0,C.jsxs)(P.Z,{children:[(0,C.jsx)(je.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,C.jsx)(i.Z,{color:"success",children:"F"}),(0,C.jsx)(je.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,C.jsx)(i.Z,{color:"blue",children:"S"}),(0,C.jsx)(je.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,C.jsx)(i.Z,{color:"error",children:"N"}),(0,C.jsx)(je.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,C.jsx)(te.Z,{checked:Ce,onChange:function(ne){return He(ne)}})]}),(0,C.jsx)(oe,{course_id:we})]})},columns:Be,dataSource:Ae,size:"small",scroll:{x:1500},components:{table:function(ce){return(0,C.jsx)(he.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,C.jsx)("table",Pe()({},ce))})}}})},j=function(Ie){var we=Ie.stats,le=Ie.attempts,ke=(0,_e.useMemo)(function(){return[{title:(0,C.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(Ce){return(0,C.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:Ce})}},{title:(0,C.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,C.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,C.jsx)(je.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Ce){return Ce?(0,H.WU)(new Date(Ce),v.Cu):""}}]},[]),Oe=(0,_e.useMemo)(function(){return we.map(function(Me){var Ce=Me.id,He=Me.email,Be=Me.finished_at,Ae=le==null?void 0:le.find(function(ce){return ce.id===Ce}),fe=Array.isArray(Ae==null?void 0:Ae.attempts)?Ae==null?void 0:Ae.attempts.length:0;return{id:Ce,email:He,finished_at:Be,attempt:fe}})},[we]);return(0,C.jsx)(y.Z,{title:function(){return(0,C.jsx)(P.Z,{children:(0,C.jsx)(je.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:ke,dataSource:Oe,size:"small",scroll:{x:500}})},T=function(Ie){var we=Ie.stats,le=(0,_e.useState)(null),ke=g()(le,2),Oe=ke[0],Me=ke[1],Ce=(0,_e.useState)(null),He=g()(Ce,2),Be=He[0],Ae=He[1],fe=(0,je.useIntl)(),ce=(0,_e.useMemo)(function(){return we.flatMap(function(W){return Object.values(W.attempts).flatMap(function(w){var Ge=w.dates,ie=w.attempt,Et=Object.values(Ge).flatMap(function(et){var jt=et.date,rt=et.seconds_total;return{date:jt,attempt:ie,seconds_total:rt,email:W.email}});return Et})})},[we]),ne={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,C.jsx)(d.ZP,{title:(0,C.jsxs)(P.Z,{children:[(0,C.jsx)(je.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,C.jsx)(Z.default,{showSearch:!0,value:Oe,onChange:function(w){Me(w),Ae(null)},placeholder:(0,C.jsx)(je.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:we.map(function(W){var w=W.id,Ge=W.email;return(0,C.jsx)(Z.default.Option,{value:Ge,children:Ge},w)})}),(0,C.jsx)(Z.default,{value:Be,onChange:function(w){return Ae(w)},disabled:Oe===null,placeholder:(0,C.jsx)(je.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:B()(new Set(ce.filter(function(W){var w=W.email;return w===Oe}).map(function(W){var w=W.attempt;return w}))).map(function(W){return(0,C.jsxs)(Z.default.Option,{value:W,children:[(0,C.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",W]},W)})})]}),colSpan:12,layout:"center",children:(0,C.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,C.jsx)(Q.Z,Pe()(Pe()({},ne),{},{tooltip:{title:"".concat(fe.formatMessage({id:"attempt"})),formatter:function(w){var Ge=Math.floor(+w.seconds_total/60),ie=+w.seconds_total>60?+w.seconds_total-Ge*60:0;return{name:w.attempt,value:"".concat(Ge,"m ").concat(ie,"s")}}},data:ce.filter(function(W){var w=W.email;return w===Oe}).filter(function(W){var w=W.attempt;return Number.isInteger(Be)?w===Be:!0})}))})})}},87366:function(Tt,qe,u){u.d(qe,{Il:function(){return xt},_y:function(){return Z},uS:function(){return he}});var Xe=u(15009),m=u.n(Xe),Ke=u(99289),Pe=u.n(Ke),Se=u(5574),B=u.n(Se),$e=u(97857),g=u.n($e),v=u(19632),s=u.n(v),Q=u(2453),d=u(67294),P=u(80854),i=u(99100),y=u(31472),I=u(36309),te=u(85893),Z=d.createContext({}),H=function(){return Math.round(Math.random()*99999)},_e=function ye(C){return C.reduce(function(oe,R){return[].concat(s()(oe),s()(R.lessons?ye(R.lessons):[]),[R])},[])},he=function ye(C){return C.reduce(function(oe,R){var se;return[].concat(s()(oe),s()(R.lessons?ye(R.lessons):[]),s()((se=R.topics)!==null&&se!==void 0?se:[]))},[])},je=function ye(C,oe,R){return C.map(function(se){var j,T;return g()(g()({},se),{},{lessons:se.lessons?ye(se.lessons,oe,R):[],topics:se.id===oe?[].concat(s()((j=se.topics)!==null&&j!==void 0?j:[]),[R]):(T=se.topics)!==null&&T!==void 0?T:[]})})},Ve=function ye(C,oe,R){return R?C.map(function(se){return g()(g()({},se),{},{lessons:[].concat(s()(se.lessons?ye(se.lessons,oe,R):[]),s()(se.id===R?[oe]:[]))})}):[].concat(s()(C),[oe])},at=function ye(C,oe,R){return C.map(function(se){return g()(g()({},se.id===oe?R:se),{},{lessons:se.lessons?ye(se.lessons,oe,R):[]})})},pt=function ye(C,oe){return C.map(function(R){return g()(g()({},R),{},{parent_id:oe,lessons:R.lessons?ye(R.lessons,R.id):[]})})},gt=function ye(C,oe){return C.filter(function(R){return R.id!==oe}).map(function(R){return g()(g()({},R),{},{lessons:R.lessons?ye(R.lessons,oe):[]})})},Ze=function ye(C,oe){return C.map(function(R){return g()(g()({},R),{},{lessons:R.lessons?ye(R.lessons,oe):[],topics:R.topics?R.topics.filter(function(se){return se.id!==oe}):[]})})},Ft=function ye(C,oe,R,se){return se==null?void 0:se.map(function(j){if(j.id===R){var T;return g()(g()({},j),{},{topics:(T=j.topics)===null||T===void 0?void 0:T.map(function(e){return e.id===C?oe.file.response.data:e})})}else if(j.lessons)return g()(g()({},j),{},{lessons:ye(C,oe,R,j.lessons||[])});return j})},xt=function(C){var oe=C.children,R=C.id,se=(0,d.useState)(),j=B()(se,2),T=j[0],e=j[1],Ie=(0,P.useIntl)(),we=(0,d.useMemo)(function(){return T&&T.lessons?he(T.lessons):[]},[T]),le=(0,d.useMemo)(function(){return T&&T.lessons?_e(T.lessons):[]},[T]),ke=(0,d.useState)([]),Oe=B()(ke,2),Me=Oe[0],Ce=Oe[1],He=(0,d.useState)(!1),Be=B()(He,2),Ae=Be[0],fe=Be[1],ce=(0,P.useLocation)(),ne=(0,d.useMemo)(function(){var k=new URLSearchParams(ce.search);return{lesson:k.get("lesson"),topic:k.get("topic")}},[ce]),W=(0,d.useCallback)(Pe()(m()().mark(function k(){var Y,V;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,(0,I.XU)({class_type:"EscolaLms\\Courses\\Models\\Lesson"});case 2:Y=K.sent,Y.success&&(V=Y.data.find(function(J){var N=J.name;return N==="assistant_id"}),fe(!!(V!=null&&V.id)));case 4:case"end":return K.stop()}},k)})),[]);(0,d.useEffect)(function(){W(),Ce([])},[]);var w=(0,d.useCallback)(function(){(0,i.Nx)(R).then(function(k){return k.success&&e(g()(g()({},k.data),{},{lessons:pt(k.data.lessons)}))})},[R]);(0,d.useEffect)(function(){w()},[w]);var Ge=(0,d.useCallback)(function(k){var Y=le.find(function(V){var X;return V==null||(X=V.topics)===null||X===void 0?void 0:X.find(function(K){return K.id===k})});return Y?Y.id:null},[le]),ie=(0,d.useMemo)(function(){return ne.lesson?{mode:"lesson",id:Number(ne.lesson),value:le.find(function(k){return k.id===Number(ne.lesson)})}:ne.topic?{mode:"topic",id:Number(ne.topic),value:we.find(function(k){return k.id===Number(ne.topic)})}:{mode:"init"}},[ne,T,le,we]),Et=(0,d.useCallback)(function(k){var Y={course_id:R,topics:[],isNew:!0,id:T?T.lessons.length+1:H(),order:0,title:Ie.formatMessage({id:"add_title_here"}),active:!0,parent_id:k};return e(function(V){var X;return g()(g()({},V),{},{lessons:Ve((X=V==null?void 0:V.lessons)!==null&&X!==void 0?X:[],Y,k)})}),Y},[R,T]),et=(0,d.useCallback)(function(k,Y){var V=le.find(function(K){return K.id===k}),X=V&&V.isNew;return(X?(0,i.aA)(Y):(0,i.sI)(k,Y)).then(function(K){return Q.ZP.success(K.message),w(),K.success&&e(function(J){var N;return g()(g()({},J),{},{lessons:at((N=J==null?void 0:J.lessons)!==null&&N!==void 0?N:[],k,g()(g()({},K.data),{},{isNew:!1}))})})})},[T]),jt=(0,d.useCallback)(function(k){var Y=le.find(function(X){return X.id===k});if(Y){var V=Y.isNew;V?e(function(X){var K;return g()(g()({},X),{},{lessons:gt((K=X==null?void 0:X.lessons)!==null&&K!==void 0?K:[],k)})}):(0,i.iI)(k).then(function(X){X.success&&(Q.ZP.success(X.message),e(function(K){var J;return g()(g()({},K),{},{lessons:gt((J=K==null?void 0:K.lessons)!==null&&J!==void 0?J:[],k)})}))})}},[T]),rt=(0,d.useCallback)(function(k,Y){var V,X=Ge(k),K=le.find(function(ee){return ee.id===X}),J=K&&((V=K.topics)===null||V===void 0?void 0:V.find(function(ee){return ee.id===k})),N=J==null?void 0:J.isNew;return(N?(0,i.HV)(Y):(0,i.Cn)(k,Y)).then(function(ee){ee.success&&(Q.ZP.success(ee.message),w(),P.history.push("/courses/list/".concat(R,"/program/?topic=").concat(ee.data.id)),(J==null?void 0:J.topicable_type)===y.oz.Video&&setTimeout(function(){w()},5e3))})},[Ge,T,w]),Lt=(0,d.useCallback)(function(k){var Y=Ge(k),V=le.find(function(J){return J.id===Y});if(V){var X=we==null?void 0:we.find(function(J){return J.id===k}),K=X==null?void 0:X.isNew;K&&!X.topicable?e(function(J){var N;return g()(g()({},J),{},{lessons:Ze((N=J==null?void 0:J.lessons)!==null&&N!==void 0?N:[],k)})}):(0,i.vJ)(k).then(function(J){J.success&&(Q.ZP.success(J.message),e(function(N){var ee;return g()(g()({},N),{},{lessons:Ze((ee=N==null?void 0:N.lessons)!==null&&ee!==void 0?ee:[],k)})}))})}},[T,Ge]),_t=(0,d.useCallback)(function(k,Y){var V={lesson_id:k,isNew:!0,id:H(),title:Ie.formatMessage({id:"add_title_here"}),active:!0,topicable_type:Y};return e(function(X){var K;return g()(g()({},X),{},{lessons:je((K=X==null?void 0:X.lessons)!==null&&K!==void 0?K:[],k,V)})}),V},[]),Pt=function(Y,V){var X=Ge(Y);e(function(K){return g()(g()({},K),{},{lessons:K?Ft(Y,V,X,K.lessons||[]):[]})}),P.history.push("/courses/list/".concat(R,"/program/?topic=").concat(V.file.response.data.id))},Zt=(0,d.useCallback)(function(k){return(0,i.Cx)(k).then(function(Y){if(Y.success){Q.ZP.success(Y.message);var V=Ge(k);e(function(X){var K;return g()(g()({},X),{},{lessons:X?(K=X.lessons)===null||K===void 0?void 0:K.map(function(J){if(J.id===V){var N=J.topics||[];return g()(g()({},J),{},{topics:[].concat(s()(N),[Y.data])})}return J}):[]})})}})},[T,Ge]),Dt=(0,d.useCallback)(function(k){return(0,i.if)(k).then(function(Y){Y.success&&(Q.ZP.success(Y.message),e(function(V){return g()(g()({},V),{},{lessons:V?[].concat(s()(V.lessons),[Y.data]):[]})}))})},[]),It={state:T,h5ps:Me,id:R,addNewLesson:Et,updateLesson:et,updateTopic:rt,deleteLesson:jt,addNewTopic:_t,deleteTopic:Lt,onTopicUploaded:Pt,cloneTopic:Zt,cloneLesson:Dt,currentEditMode:ie,getLessons:w,isAssistant:Ae};return(0,te.jsx)(Z.Provider,{value:It,children:oe})}},88030:function(Tt,qe,u){u.r(qe),u.d(qe,{default:function(){return Wr}});var Xe=u(97857),m=u.n(Xe),Ke=u(91115),Pe=u(26114),Se=u(26271),B=u(74453),$e=u(75081),g=u(14726),v=u(67294),s=u(80854),Q=u(15009),d=u.n(Q),P=u(99289),i=u.n(P),y=u(19632),I=u.n(y),te=u(5574),Z=u.n(te),H=u(16894),_e=u(28248),he=u(83062),je=u(2453),Ve=u(96746),at=u(78957),pt=u(2487),gt=u(55102),Ze=u(75842);function Ft(o,n){return xt.apply(this,arguments)}function xt(){return xt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"GET",params:n},t||{})));case 1:case"end":return a.stop()}},o)})),xt.apply(this,arguments)}function ye(o,n){return C.apply(this,arguments)}function C(){return C=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),C.apply(this,arguments)}function oe(o,n,t){return R.apply(this,arguments)}function R(){return R=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),m()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},o)})),R.apply(this,arguments)}function se(o,n,t){return j.apply(this,arguments)}function j(){return j=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),m()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},o)})),j.apply(this,arguments)}var T=u(31472),e=u(85893),Ie=function(n){var t=n.visible,r=n.onClose,a=n.user,l=Ve.Z.Text,c=a.name,f=a.groupId,h=a.userId,_=(0,v.useState)(""),b=Z()(_,2),S=b[0],F=b[1],p=(0,v.useState)(!1),x=Z()(p,2),M=x[0],E=x[1],U=(0,v.useState)([]),G=Z()(U,2),$=G[0],ae=G[1],ue=(0,v.useState)(null),ve=Z()(ue,2),O=ve[0],L=ve[1],D=(0,v.useState)({current_page:1,per_page:5,last_page:1,total:0}),A=Z()(D,2),q=A[0],Le=A[1],Ne=function(){var De=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,Ft({bookmarkable_id:f,bookmarkable_type:T.h5.Group,user_id:h,page:pe,per_page:q.per_page});case 2:z=xe.sent,z.success&&(ae(z.data),Le(z.meta));case 4:case"end":return xe.stop()}},re)}));return function(pe){return De.apply(this,arguments)}}(),ze=function(){var De=i()(d()().mark(function re(){var pe;return d()().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:return Je.next=2,ye({value:S,bookmarkable_id:f,bookmarkable_type:T.h5.Group,user_id:h});case 2:pe=Je.sent,pe.success&&(Ne(),E(!1),F(""));case 4:case"end":return Je.stop()}},re)}));return function(){return De.apply(this,arguments)}}(),it=function(){var De=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,se(pe);case 2:z=xe.sent,z.success&&Ne();case 4:case"end":return xe.stop()}},re)}));return function(pe){return De.apply(this,arguments)}}(),Ue=function(){var De=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,oe(pe,{value:(O==null?void 0:O.currentText)||"",bookmarkable_id:f,bookmarkable_type:T.h5.Group,user_id:h});case 2:z=xe.sent,z.success&&(Ne(),L(null));case 4:case"end":return xe.stop()}},re)}));return function(pe){return De.apply(this,arguments)}}();return(0,v.useEffect)(function(){Ne()},[]),(0,e.jsxs)(_e.Z,{title:(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(c,")")})]}),open:t,onCancel:r,footer:[(0,e.jsx)(g.ZP,{onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(pt.Z,{dataSource:$,pagination:{onChange:function(re){return Ne(re)},pageSize:q.per_page,total:q.total,current:q.current_page},renderItem:function(re){return(0,e.jsx)(pt.Z.Item,{actions:[(0,e.jsx)(g.ZP,{danger:!0,onClick:function(){return it(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},re.id),(O==null?void 0:O.currentNoteId)===re.id?(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{onClick:function(){return Ue(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(g.ZP,{onClick:function(){return L(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(g.ZP,{onClick:function(){return L({currentNoteId:re.id,currentText:re.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},re.id)],children:(O==null?void 0:O.currentNoteId)===re.id&&(O==null?void 0:O.currentText)!==null?(0,e.jsx)(gt.Z.TextArea,{value:O==null?void 0:O.currentText,onChange:function(z){return L(function(Je){return m()(m()({},Je),{},{currentText:z.target.value})})}}):re.value})}}),M?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ze.Z,{layout:"vertical",children:(0,e.jsx)(Ze.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(gt.Z.TextArea,{value:S,onChange:function(re){return F(re.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{type:"primary",onClick:ze,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return E(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return E(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},we=Ie,le=u(54464);function ke(o,n){return Oe.apply(this,arguments)}function Oe(){return Oe=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),Oe.apply(this,arguments)}function Me(o,n,t,r){return Ce.apply(this,arguments)}function Ce(){return Ce=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n,"/attendances"),m()({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return c.stop()}},o)})),Ce.apply(this,arguments)}function He(o,n){return Be.apply(this,arguments)}function Be(){return Be=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),Be.apply(this,arguments)}function Ae(o,n){return fe.apply(this,arguments)}function fe(){return fe=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},o)})),fe.apply(this,arguments)}function ce(o,n){return ne.apply(this,arguments)}function ne(){return ne=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),ne.apply(this,arguments)}function W(o,n,t){return w.apply(this,arguments)}function w(){return w=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),w.apply(this,arguments)}function Ge(o,n){return ie.apply(this,arguments)}function ie(){return ie=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),ie.apply(this,arguments)}function Et(o,n){return et.apply(this,arguments)}function et(){return et=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),et.apply(this,arguments)}function jt(o,n,t,r){return rt.apply(this,arguments)}function rt(){return rt=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n,"/users/").concat(t),m()({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return c.stop()}},o)})),rt.apply(this,arguments)}function Lt(o,n,t){return _t.apply(this,arguments)}function _t(){return _t=_asyncToGenerator(_regeneratorRuntime().mark(function o(n,t,r){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(n,"/users/").concat(t),_objectSpread({method:"DELETE"},r||{})));case 1:case"end":return l.stop()}},o)})),_t.apply(this,arguments)}function Pt(o,n,t){return Zt.apply(this,arguments)}function Zt(){return Zt=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),m()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),Zt.apply(this,arguments)}function Dt(o,n,t,r){return It.apply(this,arguments)}function It(){return It=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),m()({method:"POST",data:r},a||{})));case 1:case"end":return c.stop()}},o)})),It.apply(this,arguments)}function k(o,n){return Y.apply(this,arguments)}function Y(){return Y=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",m()({method:"GET",params:{groups:n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),Y.apply(this,arguments)}function V(o,n,t){return X.apply(this,arguments)}function X(){return X=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),m()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),X.apply(this,arguments)}function K(o){return J.apply(this,arguments)}function J(){return J=i()(d()().mark(function o(n){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-terms",m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},o)})),J.apply(this,arguments)}function N(o,n){return ee.apply(this,arguments)}function ee(){return ee=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),ee.apply(this,arguments)}function de(o,n){return me.apply(this,arguments)}function me(){return me=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades",m()({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},o)})),me.apply(this,arguments)}function ge(o,n,t){return Te.apply(this,arguments)}function Te(){return Te=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),m()({method:"PATCH",data:t},r||{})));case 1:case"end":return l.stop()}},o)})),Te.apply(this,arguments)}function Ye(o,n){return st.apply(this,arguments)}function st(){return st=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),st.apply(this,arguments)}var yt=u(95213),wt=u(47389),tt=u(7092),va=u(13769),Rt=u.n(va),pa=["results"],Jt=function(n,t){return n.reduce(function(r,a){var l=a.results,c=Rt()(a,pa),f=l.find(function(h){return h.user_id===t});return f?[].concat(I()(r),[m()(m()({},c),{},{result:f})]):r},[])},Qt=function(n,t){var r,a=n.reduce(function(p,x){var M=x.result,E=x.weight;return E&&typeof M.result=="number"?[p[0]+M.result*E,p[1]+E]:p},[0,0]),l=Z()(a,2),c=l[0],f=l[1],h=Number.isNaN(c/f)?0:c/f,_=t.sort(function(p,x){return p.grade_value-x.grade_value}).reduce(function(p,x){return[].concat(I()(p),[m()(m()({},x),{},{isWeightedAverageGreater:h>=x.grade_value})])},[]);if(_.every(function(p){var x=p.isWeightedAverageGreater;return x})){var b,S;return(b=(S=_.at(-1))===null||S===void 0?void 0:S.name)!==null&&b!==void 0?b:""}var F=_.findIndex(function(p){var x=p.isWeightedAverageGreater;return!x});return F<0?"":(r=_[F-1])===null||r===void 0?void 0:r.name},qt=function(n,t){var r;return(r=t.find(function(a){return a.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},dt=u(73199),ha=u(9783),nt=u.n(ha),ea=u(84567);function ga(o){var n,t=o===null?T.cX.ABSENT:o,r=nt()(nt()(nt()(nt()({},T.cX.PRESENT,{ch1:!0,ch2:!1}),T.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),T.cX.ABSENT,{ch1:!1,ch2:!1}),T.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(n=r[t])!==null&&n!==void 0?n:{ch1:!1,ch2:!1}}function xa(o){var n,t=o.ch1,r=o.ch2,a="".concat(t,"_").concat(r),l={true_false:T.cX.PRESENT,true_true:T.cX.PRESENT_NOT_EXERCISING,false_false:T.cX.ABSENT,false_true:T.cX.EXCUSED_ABSENCE};return(n=l[a])!==null&&n!==void 0?n:T.cX.ABSENT}var ja=function(n){var t=n.groupAttendanceScheduleId,r=n.studentId,a=n.attendance,l=n.onSuccess,c=(0,v.useState)(ga(a)),f=Z()(c,2),h=f[0],_=f[1],b=(0,v.useState)(!1),S=Z()(b,2),F=S[0],p=S[1],x=(0,v.useRef)(!0),M=(0,v.useCallback)(function(G){p(!0),Me(t,r,xa(G)).then(function($){$.success&&(l==null||l())}).finally(function(){return p(!1)})},[]),E=(0,v.useCallback)(function(G){return _(G.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),U=(0,v.useCallback)(function(G){return _(function($){return m()(m()({},$),{},{ch2:G.target.checked})})},[]);return(0,v.useEffect)(function(){if(x.current){x.current=!1;return}M(h)},[h,M]),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(ea.Z,{disabled:F,checked:h.ch1,onChange:E})}),(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:h.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(ea.Z,{disabled:F,checked:h.ch2,onChange:U})})]})},ta=ja,ct=u(45919),kt=u(82061),bt=u(60943),Gt=u(74656),aa=u(8925),_a=u(96486),ba=function(n){var t=n.exam_id,r=n.result,a=n.student_id,l=n.type,c=n.onSuccess,f=(0,s.useIntl)(),h=(0,v.useCallback)((0,_a.debounce)(function(b){jt(t,a,{result:b}).then(function(S){S.success&&(c==null||c(S.data))})},300),[t,r,a]),_=function(){switch(l){case T.UL.ManualPass:return(0,e.jsx)(Gt.default,{allowClear:!0,style:{width:"100%"},onChange:h,options:dt.FW,defaultValue:r!=null?r:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});case T.UL.ManualGrades:return(0,e.jsx)(Gt.default,{allowClear:!0,style:{width:"100%"},onChange:h,options:dt.BP,defaultValue:r!=null?r:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});default:return(0,e.jsx)(aa.Z,{type:"number",min:0,max:100,onChange:h,defaultValue:r!=null?r:void 0,placeholder:f.formatMessage({id:"select_grade"})})}};return _()},Sa=function(n,t){var r;return(r=n.find(function(a){return a.name===t}))===null||r===void 0?void 0:r.id},ya=function(n){var t=n.term,r=n.gradeScales,a=n.defaultFinalGrade,l=n.finalGrades,c=(0,v.useState)(a),f=Z()(c,2),h=f[0],_=f[1],b=(0,v.useState)(!1),S=Z()(b,2),F=S[0],p=S[1],x=(0,v.useState)(!1),M=Z()(x,2),E=M[0],U=M[1],G=(0,s.useIntl)(),$=(0,v.useMemo)(function(){return r.map(function(ve){var O=ve.name,L=ve.id;return{value:L,label:O}})},[r]),ae=function(O){U(!0),je.ZP.error(G.formatMessage({id:O.data.message}))},ue=(0,v.useCallback)(function(ve){if(l!=null&&l.id){if(ve===void 0){if(!h)return;p(!0),Ye(h.id).then(function(O){O.success&&_(void 0)}).finally(function(){return p(!1)});return}if(h){p(!0),ge(h.id,{grade_scale_id:ve}).catch(function(O){var L;O!=null&&(L=O.data)!==null&&L!==void 0&&L.message&&ae(O)}).finally(function(){return p(!1)});return}p(!0),de({grade_term_id:t.id,grade_scale_id:ve,lesson_group_user_id:l.id}).then(function(O){if(O.success){var L=O.data.grades.find(function(D){return D.grade_term.id===t.id});_(L),E&&U(!1)}}).catch(function(O){var L;O!=null&&(L=O.data)!==null&&L!==void 0&&L.message&&ae(O)}).finally(function(){return p(!1)})}},[h,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(Gt.default,{allowClear:!0,status:E?"error":"",loading:F,disabled:F,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:ue,options:$,defaultValue:Sa(r,a==null?void 0:a.grade_name)}):null},Ma=function(n){var t=n.groupAttendanceSchedule,r=n.handleDeleteColumn,a=n.scheduleDeletePermission,l=a===void 0?!1:a,c=t.reduce(function(f,h){return[].concat(I()(f),[{title:(0,e.jsxs)(at.Z,{children:[(0,bt.WU)(new Date(h.date_from),ct.GC),l&&h.is_outdated&&(0,e.jsx)(kt.Z,{onClick:function(b){b.stopPropagation(),r(h.id,(0,bt.WU)(new Date(h.date_from),ct.GC))}})]}),dataIndex:"attendance-".concat(h.id),hideInSearch:!0,width:100,align:"center",render:function(b,S){return(0,e.jsx)(ta,{groupAttendanceScheduleId:h.id,attendance:S["attendance-".concat(h==null?void 0:h.id)],studentId:S.id})}}])},[]);return c.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:c}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Ca=function(n,t){return n.reduce(function(r,a){var l=a.attendances.find(function(c){return c.user_id===t});return l?m()(m()({},r),{},nt()({},"attendance-".concat(a.id),l.value)):r},{})},Ta=function(n){var t=n.reduce(function(r,a){return[].concat(I()(r),[{dataIndex:"exam-".concat(a.id),title:a.type===T.UL.Manual?(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:a}):(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithoutWeight",values:a}),hideInSearch:!0,width:100,render:function(c,f){var h;return(0,e.jsx)(ba,{type:a.type,result:f==null||(h=f["exam-".concat(a.id)])===null||h===void 0?void 0:h.result,exam_id:a.id,student_id:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},Fa=function(n){return n.reduce(function(t,r){var a=r.result,l=r.id;return m()(m()({},t),{},nt()({},"exam-".concat(l),a))},{})},Ea=function(n,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(l,c){var f;return(0,e.jsx)(ya,{defaultFinalGrade:c["final-grade-".concat(r.id)],finalGrades:c.final_grades,term:r,gradeScales:t},"".concat(c==null||(f=c.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(r.id))}}})}},Pa=function(n,t){return n.find(function(r){return r.user.id===t})},Za=function(n){var t;return((t=n==null?void 0:n.grades)!==null&&t!==void 0?t:[]).reduce(function(r,a){return m()(m()({},r),{},nt()({},"final-grade-".concat(a.grade_term.id),a))},{})},Ia=function(){var n,t=(0,tt.Z)(),r=t.teacherSubjectData,a=t.semester_subject_id,l=(0,v.useState)([]),c=Z()(l,2),f=c[0],h=c[1],_=(0,v.useState)(r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.name),b=Z()(_,2),S=b[0],F=b[1],p=(0,v.useState)(null),x=Z()(p,2),M=x[0],E=x[1],U=(0,s.useIntl)(),G=(0,v.useRef)(),$=(0,le.T)(),ae=$.checkPermission,ue=function(A,q){_e.Z.confirm({title:U.formatMessage({id:"scheduleDeleteConfirm"},{columnId:A}),okText:U.formatMessage({id:"delete"}),cancelText:U.formatMessage({id:"cancel"}),onOk:q})},ve=function(A,q){ue(q,function(){var Le;He(A),(Le=G.current)===null||Le===void 0||Le.reload()})},O=(0,v.useMemo)(function(){var D;return((D=r==null?void 0:r.groups)!==null&&D!==void 0?D:[]).map(function(A){var q=A.id,Le=A.name;return{value:q,label:Le}})},[r==null?void 0:r.groups]),L=(0,v.useMemo)(function(){var D;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:O,defaultValue:O==null||(D=O[0])===null||D===void 0?void 0:D.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(I()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(q,Le){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(wt.Z,{}),onClick:function(){return E({userName:Le.full_name,userId:Le.id,groupId:Le.final_grades.group_id})}})})})}}])},[O,f]);return(0,e.jsxs)(e.Fragment,{children:[(M==null?void 0:M.userId)&&(0,e.jsx)(we,{visible:!!M.userId,onClose:function(){return E(null)},user:{name:M.userName,userId:M.userId,groupId:M.groupId}}),(0,e.jsx)(H.ZP,{sticky:!0,className:"table-standalone",request:function(){var D=i()(d()().mark(function A(q){var Le,Ne,ze,it,Ue,De,re,pe,z,Je,xe,Fe,Ee,be,We,Qe,vt,ut,lt,St,Mt;return d()().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return it=q.group_id,Ue=it===void 0?(Le=O[0])===null||Le===void 0?void 0:Le.value:it,De=q.full_name,re=De===void 0?"":De,Re.next=3,k([Ue]);case 3:if(pe=Re.sent,z=O.find(function(Ct){var ht=Ct.value;return ht===Ue}),!(!pe.success||pe.data[0]===void 0||a===null)){Re.next=8;break}return je.ZP.error(U.formatMessage({id:"groupDataMissing"},{group_name:z==null?void 0:z.label})),Re.abrupt("return",{data:[],total:0,success:!1});case 8:return Re.next=10,Promise.all([(0,yt.X)(Ue),ke(Ue),Ae({group_id:Ue,per_page:-1}),Pt(a,(Ne=pe.data)===null||Ne===void 0||(Ne=Ne[0])===null||Ne===void 0?void 0:Ne.tutor_id),K(),N((ze=pe.data)===null||ze===void 0||(ze=ze[0])===null||ze===void 0?void 0:ze.s_subject_scale_form_id)]);case 10:if(Je=Re.sent,xe=Z()(Je,6),Fe=xe[0],Ee=xe[1],be=xe[2],We=xe[3],Qe=xe[4],vt=xe[5],!(!Fe.success||!Ee.success||!be.success||!We.success||!Qe.success||!vt.success||!z)){Re.next=21;break}return je.ZP.error(U.formatMessage({id:"groupDataMissing"},{group_name:z==null?void 0:z.label})),Re.abrupt("return",{data:[],total:0,success:!1});case 21:return F(z.label),ut=Ma({groupAttendanceSchedule:Ee.data,handleDeleteColumn:ve,scheduleDeletePermission:ae(Ke.Z.PCGSchedulesDelete)||ae(Ke.Z.PCGSchedulesDeleteOwn)}),lt=Ta(be.data),St=Ea(Qe.data,vt.data),h([ut,lt,St,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Mt=Fe.data.users.reduce(function(Ct,ht){var zt,Ht,Yt,Ut=ht.id,Vr=ht.academic_teacher_id,Xr=ht.first_name,zr=ht.last_name,ma="".concat(zr," ").concat(Xr);if(Vr!==null||!ma.toLowerCase().includes(re.toLowerCase()))return Ct;var Hr=Ca(Ee.data,Ut),fa=Jt(be.data,Ut),At=Pa(pe.data,Ut),Yr=(zt=qt((Ht=At==null?void 0:At.s_subject_scale_form_id)!==null&&Ht!==void 0?Ht:0,(Yt=We.data.grade_scale)!==null&&Yt!==void 0?Yt:[]))!==null&&zt!==void 0?zt:[],Jr=Qt(fa,Yr),Qr=Fa(fa),qr=Za(At);return[].concat(I()(Ct),[m()(m()(m()(m()({id:Ut,full_name:ma},Hr),Qr),qr),{},{proposed_grade:Jr,final_grades:At})])},[]).sort(function(Ct,ht){return Ct.full_name.localeCompare(ht.full_name)}),Re.abrupt("return",{data:Mt,total:Mt.length,success:!0});case 28:case"end":return Re.stop()}},A)}));return function(A){return D.apply(this,arguments)}}(),columns:L,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:S}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:G,pagination:{defaultPageSize:dt.Sl,onChange:function(){var A;return(A=G.current)===null||A===void 0?void 0:A.reload()}},rowKey:"id"})]})},ra=u(1413),wa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ga=wa,Da=u(84089),Aa=function(n,t){return v.createElement(Da.Z,(0,ra.Z)((0,ra.Z)({},n),{},{ref:t,icon:Ga}))},La=v.forwardRef(Aa),Ra=La,na=u(86738),$t=u(62235),ot=u(952),$a=u(5966),Oa=u(50335),sa=u(71230),mt=u(15746),Na=u(56717),ia=u(95830),Ua=u(29477),ua=function(n){return n===T.UL.Manual||n===T.UL.ManualPass||n===T.UL.ManualGrades},ka=function(n){var t=n.type,r=n.onDataConverted,a=n.groupSelectDisabled,l=(0,tt.Z)(),c=l.semester_subject_id,f=l.teacherSubjectData,h=(0,v.useState)(null),_=Z()(h,2),b=_[0],S=_[1],F=(0,v.useMemo)(function(){var M;return((M=f==null?void 0:f.groups)!==null&&M!==void 0?M:[]).map(function(E){var U=E.id,G=E.name;return{label:G,value:U}})},[]),p={type:t,group_id:b,semester_subject_id:c},x=(0,v.useCallback)(function(M){if(M.success){var E=M.data.results.filter(function(U){var G=U.user_id;return G!==null});if(!E.length)return;r({exam_results:E,group_id:M.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(Gt.default,{disabled:a,value:b,onChange:function(E){return S(E)},options:F,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Ua.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:x,onChange:function(E){return!E.fileList.length&&r(void 0)},maxFiles:1,data:p,disabled:!b})]})},Ba=function(n){var t=n.onDataConverted,r=(0,tt.Z)(),a=r.teacherSubjectData,l=r.groupUsers,c=(0,v.useState)(null),f=Z()(c,2),h=f[0],_=f[1],b=(0,v.useMemo)(function(){var F;return((F=a==null?void 0:a.groups)!==null&&F!==void 0?F:[]).map(function(p){var x=p.id,M=p.name;return{label:M,value:x}})},[]),S=(0,v.useCallback)(function(F){var p;_(F);var x=(p=l.byId)===null||p===void 0?void 0:p[F];if(x){var M=x.users.reduce(function(E,U){var G=U.id,$=U.email,ae=U.first_name,ue=U.last_name,ve=U.academic_teacher_id;return ve!==null?E:[].concat(I()(E),[{email:$,first_name:ae,last_name:ue,user_id:G,result:null}])},[]);t({group_id:F,exam_results:M})}},[l.byId]);return(0,e.jsx)(Gt.default,{value:h,onChange:S,options:b,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Ot=nt()(nt()(nt()(nt()(nt()(nt()({},T.UL.TestPortal,["/teacher-examples/testPortal.png"]),T.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),T.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),T.UL.Manual,[]),T.UL.ManualPass,[]),T.UL.ManualGrades,[]),Wa=function(n){var t=n.images,r=(0,v.useState)(!1),a=Z()(r,2),l=a[0],c=a[1],f=(0,v.useCallback)(function(){return c(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(g.ZP,{onClick:f,icon:(0,e.jsx)(Na.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:c},children:t.map(function(h){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:h},h)})})]})},Ka=function(n){var t,r=n.type,a=n.onOk,l=n.onCancel,c=n.okDisabled,f=(t=Ot==null?void 0:Ot[r])!==null&&t!==void 0?t:Ot[T.UL.Manual];return(0,e.jsxs)(at.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)(Wa,{images:f}),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(g.ZP,{type:"primary",disabled:c,onClick:a,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Va=[T.UL.TeamsLecture,T.UL.TestPortal,T.UL.TeamsForms],Xa=function(n){var t=n.open,r=n.closeModal,a=n.onSuccess,l=n.type,c=(0,tt.Z)(),f=c.teacherSubjectData,h=c.fetchGroupUsers,_=(0,v.useState)(),b=Z()(_,2),S=b[0],F=b[1];return(0,v.useEffect)(function(){if(ua(l)&&t){var p;f==null||(p=f.groups)===null||p===void 0||p.forEach(function(x){var M=x.id;return h(M)})}},[l,t]),(0,e.jsxs)(_e.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:r,footer:(0,e.jsx)(Ka,{type:l,onOk:function(){S&&a(S)},onCancel:r,okDisabled:!S}),children:[Va.includes(l)&&(0,e.jsx)(ka,{type:l,onDataConverted:F,groupSelectDisabled:!!S}),ua(l)&&(0,e.jsx)(Ba,{onDataConverted:F,examType:l})]})},za=function(n){var t=n.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.ManualPass)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyPass",defaultMessage:"uploadGradesManuallyPass"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(T.UL.ManualGrades)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyGrades",defaultMessage:"uploadGradesManuallyGrades"})})})]})},Ha=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1}],Ya=function(n){var t,r=n.exam_id,a=ot.ZP.useForm(),l=Z()(a,1),c=l[0],f=(0,v.useState)(),h=Z()(f,2),_=h[0],b=h[1],S=(0,v.useState)(),F=Z()(S,2),p=F[0],x=F[1],M=(0,v.useState)(!1),E=Z()(M,2),U=E[0],G=E[1],$=(0,tt.Z)(),ae=$.semester_subject_id,ue=$.getGroupById,ve=(0,v.useMemo)(function(){var L;return((L=p==null?void 0:p.exam_results)!==null&&L!==void 0?L:[]).map(function(D){var A=D.user_id;return A})},[p==null?void 0:p.exam_results]);(0,v.useEffect)(function(){var L=Number(r);r==="new"&&(b(void 0),x(void 0),c.resetFields()),r!=="new"&&!Number.isNaN(L)&&(G(!0),Ge(L).then(function(D){if(D.success){var A=D.data,q=A.type,Le=A.results,Ne=A.title,ze=A.weight,it=A.passed_at,Ue=A.group_id;b(q),x({group_id:Ue,exam_results:Le}),c.setFieldsValue({title:Ne,weight:ze,passed_at:it})}}).finally(function(){return G(!1)}))},[r]);var O=(0,v.useCallback)(function(){b(void 0),x(void 0)},[]);return U?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[_&&(0,e.jsx)(Xa,{open:!!(_&&!p),type:_,closeModal:O,onSuccess:x}),(0,e.jsxs)(ot.ZP,{form:c,submitter:_===void 0||!p?!1:void 0,onFinish:function(){var L=i()(d()().mark(function D(A){var q,Le,Ne,ze,it,Ue,De,re;return d()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(p&&typeof ae=="number")){z.next=16;break}if(q=A.title,Le=A.passed_at,Ne=A.weight,ze=Number(r),it=p.exam_results,Ue=p.group_id,De={type:_,semester_subject_id:ae,title:q,passed_at:Le,weight:Ne,group_id:Ue,results:it},!Number.isNaN(ze)){z.next=11;break}return z.next=8,ce(De);case 8:z.t0=z.sent,z.next=14;break;case 11:return z.next=13,W(ze,De);case 13:z.t0=z.sent;case 14:re=z.t0,re.success&&s.history.push("/teacher/subjects/".concat(ae,"/exams"));case 16:return z.abrupt("return",!0);case 17:case"end":return z.stop()}},D)}));return function(D){return L.apply(this,arguments)}}(),onReset:O,children:[(0,e.jsxs)(ot.ZP.Group,{children:[(0,e.jsx)($a.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(Oa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),_!==T.UL.ManualGrades&&_!==T.UL.ManualPass&&(0,e.jsx)(ot.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(aa.Z,{})})]}),_&&p&&(0,e.jsx)(H.ZP,{rowKey:"user_id",headerTitle:(t=ue(p.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:ve,onValuesChange:function(D,A){return x({group_id:p.group_id,exam_results:A})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:p.exam_results.sort(function(L,D){return L.last_name.localeCompare(D.last_name)}),pagination:{defaultPageSize:dt.Sl},columns:[].concat(Ha,[function(){switch(_){case T.UL.ManualPass:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.FW}};case T.UL.ManualGrades:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.BP}};default:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}}}()])}),!p&&(0,e.jsx)(za,{onSelect:b})]})]})},Ja=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Qa=function(n){var t=n.exam_id,r=(0,v.useState)(""),a=Z()(r,2),l=a[0],c=a[1];return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:dt.Sl},request:i()(d()().mark(function f(){var h;return d()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,Ge(t);case 2:if(h=b.sent,!h.success){b.next=6;break}return c(h.data.title),b.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return b.abrupt("return",[]);case 7:case"end":return b.stop()}},f)})),columns:Ja})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&(0,bt.WU)(new Date(t.passed_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight?t.weight+"%":""}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&(0,bt.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return(0,e.jsx)($t.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],er=function(){var n,t=(0,v.useRef)(),r=(0,tt.Z)(),a=r.semester_subject_id,l=(0,s.useLocation)(),c=new URLSearchParams(l.search),f=(n=c.get("exam_id"))!==null&&n!==void 0?n:null,h=c.get("results");return h!==null&&!Number.isNaN(Number(h))?(0,e.jsx)(Qa,{exam_id:Number(h)}):f!==null?(0,e.jsx)(Ya,{exam_id:f}):(0,e.jsx)(H.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:dt.Sl},request:function(){var _=i()(d()().mark(function b(S,F){var p,x,M,E;return d()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(p=S.current,x=S.pageSize,a!==null){G.next=3;break}return G.abrupt("return",{data:[],total:0,success:!1});case 3:return M=F&&Object.entries(F)[0],G.next=6,Ae({per_page:x,page:p,semester_subject_id:Number.isNaN(a)?void 0:a,order_by:M&&M[0],order:M&&(M[1]==="ascend"?"ASC":"DESC")});case 6:if(E=G.sent,!E.success){G.next=9;break}return G.abrupt("return",{data:E.data,total:E.meta.total,success:!0});case 9:return G.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return G.stop()}},b)}));return function(b,S){return _.apply(this,arguments)}}(),columns:[].concat(qa,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(b,S){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?exam_id=").concat(S.id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(wt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?results=").concat(S.id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(g.ZP,{icon:(0,e.jsx)(Ra,{})})})},"results"),(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:i()(d()().mark(function F(){var p;return d()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Et(S.id);case 2:p=M.sent,p.success&&t.current&&t.current.reload();case 4:case"end":return M.stop()}},F)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(kt.Z,{}),danger:!0})})},"delete")]}}])})},tr=u(69753),oa=u(44167),ar=u(84665),rr=["type","defaultRender"],nr=["type","defaultRender"],sr=function(n){var t=n.url;return(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(tr.Z,{})})})},ir=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return(0,bt.WU)(new Date(t.created_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,c=Rt()(t,rr);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},c),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)($t.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(r=t.created_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.created_by)!==null&&a!==void 0&&a.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return(0,bt.WU)(new Date(t.exported_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,c=Rt()(t,nr);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},c),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)($t.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(r=t.exported_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.exported_by)!==null&&a!==void 0&&a.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(n,t){return[(0,e.jsx)(sr,{url:t.url},"download")]}}],ur=function(){var n,t=(0,tt.Z)(),r=t.teacherSubjectData,a=(0,v.useMemo)(function(){var c;return((c=r==null?void 0:r.groups)!==null&&c!==void 0?c:[]).map(function(f){var h=f.id,_=f.name;return{value:h,label:_}})},[r==null?void 0:r.groups]),l=(0,v.useMemo)(function(){var c;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:a,defaultValue:r==null||(c=r.groups)===null||c===void 0||(c=c[0])===null||c===void 0?void 0:c.id,allowClear:!1}}].concat(ir)},[r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.id,a]);return(0,e.jsx)(H.ZP,{className:"table-standalone",request:function(){var c=i()(d()().mark(function f(h){var _,b,S,F,p,x;return d()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return b=h.group_id,S=b===void 0?r==null||(_=r.groups)===null||_===void 0||(_=_[0])===null||_===void 0?void 0:_.id:b,F=h.created_by,p=h.exported_by,E.next=3,(0,ar.v)({group_id:S,created_by:F,exported_by:p});case 3:if(x=E.sent,x.success){E.next=6;break}return E.abrupt("return",{success:!1,data:[],total:0});case 6:return E.abrupt("return",{success:!0,data:x.data,total:x.data.length});case 7:case"end":return E.stop()}},f)}));return function(f){return c.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:dt.Sl}})},la=u(64317),Bt=u(96074),da=u(11312),or=u(87366),Wt=u(99100),lr=["attendances"];function dr(o){return function(t){o(function(r){return m()(m()({},r),{},{loading:t})})}}function ca(o,n){return Kt.apply(this,arguments)}function Kt(){return Kt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n(!0),a.prev=1,a.abrupt("return",t());case 3:return a.prev=3,n(!1),a.finish(3);case 6:case"end":return a.stop()}},o,null,[[1,,3,6]])})),Kt.apply(this,arguments)}function cr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useCallback)(dr(l),[]),f=(0,v.useCallback)(i()(d()().mark(function _(){var b;return d()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,V(o,n);case 2:if(b=F.sent,b.success){F.next=5;break}return F.abrupt("return",b);case 5:return l(function(p){return m()(m()({},p),{},{data:b.data})}),F.abrupt("return",b);case 7:case"end":return F.stop()}},_)})),[n,o]),h=(0,v.useCallback)(function(_){return ca(c,function(){return Ye(_).then(f)})},[f]);return(0,v.useEffect)(function(){ca(c,f)},[f]),{finalGrades:a,deleteFinalGrade:h}}function mr(){var o=(0,v.useState)({loading:!1}),n=Z()(o,2),t=n[0],r=n[1];return(0,v.useEffect)(function(){r(function(a){return m()(m()({},a),{},{loading:!0})}),K().then(function(a){a.success&&r(function(l){return m()(m()({},l),{},{data:a.data})})}).finally(function(){r(function(a){return m()(m()({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function fr(o){var n=(0,v.useState)({loading:!1}),t=Z()(n,2),r=t[0],a=t[1];return(0,v.useEffect)(function(){o!==void 0&&(a(function(l){return m()(m()({},l),{},{loading:!0})}),N(o).then(function(l){l.success&&a(function(c){return m()(m()({},c),{},{data:l.data})})}).finally(function(){a(function(l){return m()(m()({},l),{},{loading:!1})})}))},[o]),{subjectGradeScales:r}}function vr(o,n,t){var r=(0,v.useState)({loading:!1}),a=Z()(r,2),l=a[0],c=a[1];return(0,v.useEffect)(function(){typeof o!="number"||typeof n!="number"||typeof t!="number"||(c(function(f){return m()(m()({},f),{},{loading:!0})}),Pt(o,n).then(function(f){f.success&&c(function(h){var _,b;return m()(m()({},h),{},{data:(_=qt(t,(b=f.data.grade_scale)!==null&&b!==void 0?b:[]))===null||_===void 0?void 0:_.map(function(S,F){return m()(m()({},S),{},{id:F})})})})}).finally(function(){c(function(f){return m()(m()({},f),{},{loading:!1})})}))},[o,n]),{tutorGradeScales:l}}function pr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useCallback)(function(){l(function(f){return m()(m()({},f),{},{loading:!0})}),ke(o).then(function(f){if(f.success){var h=f.data.reduce(function(_,b){var S=b.attendances,F=Rt()(b,lr),p=S.find(function(x){return x.user_id===n});return p?[].concat(I()(_),[m()(m()({},F),{},{attendance:p})]):_},[]);l(function(_){return m()(m()({},_),{},{data:h})})}}).finally(function(){l(function(f){return m()(m()({},f),{},{loading:!1})})})},[o,n]);return(0,v.useEffect)(function(){c()},[c]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:c}}function hr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1];return(0,v.useEffect)(function(){n&&(l(function(c){return m()(m()({},c),{},{loading:!0})}),Ae({student_id:o,semester_subject_id:n}).then(function(c){if(c.success){var f=Jt(c.data,o);l(function(h){return m()(m()({},h),{},{data:f})})}}).finally(function(){l(function(c){return m()(m()({},c),{},{loading:!1})})}))},[o,n]),{studentExams:a}}function gr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useState)({loading:!1}),f=Z()(c,2),h=f[0],_=f[1],b=(0,v.useState)({loading:!1}),S=Z()(b,2),F=S[0],p=S[1];return(0,v.useEffect)(function(){l(function(x){return m()(m()({},x),{},{loading:!0})}),(0,Wt.N7)({group_id:o}).then(function(x){x.success&&l(function(M){return m()(m()({},M),{},{data:x.data})})}).finally(function(){l(function(x){return m()(m()({},x),{},{loading:!1})})})},[o]),(0,v.useEffect)(function(){a.data&&(p(function(x){return m()(m()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var M=x.id;return(0,Wt.Nx)(Number(M))})).then(function(x){x.forEach(function(M){M.success&&p(function(E){return m()(m()({},E),{},{data:m()(m()({},E.data),{},nt()({},Number(M.data.id),(0,or.uS)(M.data.lessons)))})})})}).finally(function(){p(function(x){return m()(m()({},x),{},{loading:!1})})}),_(function(x){return m()(m()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var M=x.id;return(0,Wt.ue)(Number(M),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(E){if(E.success){var U,G,$=((U=E.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&U!==void 0?U:[]).filter(function(ue){return ue.id===n}),ae=(G=E.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&G!==void 0?G:[];_(function(ue){return m()(m()({},ue),{},{data:m()(m()({},ue.data),{},nt()({},Number(M),{finishedTopics:$,attendanceList:ae}))})})}})})).finally(function(){return _(function(x){return m()(m()({},x),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:h,userCoursesTopics:F}}var xr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],jr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(n,t){return(0,bt.WU)(new Date(t.date_from),ct.GC)}}],_r=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return(0,bt.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result," ").concat(t.weight?"%":"")}}],br=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?(0,bt.WU)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),ct.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],Nt=6,Sr=function(n){var t,r,a,l,c=n.user_id,f=n.group_id,h=(0,tt.Z)(),_=h.semester_subject_id,b=hr(c,_),S=b.studentExams,F=cr(f,c),p=F.finalGrades,x=F.deleteFinalGrade,M=mr(),E=M.gradeTerms,U=fr((t=p.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),G=U.subjectGradeScales,$=vr(_,(r=p.data)===null||r===void 0?void 0:r.tutor_id,(a=p.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),ae=$.tutorGradeScales,ue=pr(f,c),ve=ue.userAttendanceSchedules,O=ue.fetchUserAttendanceSchedules,L=gr(f,c),D=L.userCourses,A=L.userCoursesStats,q=L.userCoursesTopics,Le=ot.ZP.useForm(),Ne=Z()(Le,1),ze=Ne[0],it=(0,v.useMemo)(function(){var Fe;return((Fe=E.data)!==null&&Fe!==void 0?Fe:[]).map(function(Ee){var be=Ee.id,We=Ee.name;return{label:We,value:be}})},[E.data]),Ue=(0,v.useMemo)(function(){var Fe;return((Fe=G.data)!==null&&Fe!==void 0?Fe:[]).map(function(Ee){var be=Ee.name,We=Ee.id;return{label:be,value:We}})},[G.data]),De=(0,v.useMemo)(function(){var Fe,Ee;return Qt((Fe=S.data)!==null&&Fe!==void 0?Fe:[],(Ee=ae.data)!==null&&Ee!==void 0?Ee:[])},[S.data,ae.data]),re=(0,v.useCallback)(function(){var Fe=i()(d()().mark(function Ee(be){var We,Qe,vt,ut,lt,St,Mt;return d()().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(vt=be.grade_scale_id,ut=be.grade_term_id,((We=p.data)===null||We===void 0?void 0:We.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(lt=(Qe=p.data)===null||Qe===void 0?void 0:Qe.grades.find(function(Ct){var ht=Ct.grade_term;return ht.id===ut}),!lt){Re.next=11;break}return Re.next=7,ge(lt.id,{grade_scale_id:vt});case 7:return St=Re.sent,je.ZP[St.success?"success":"error"](St.message),St.success&&s.history.push("/teacher/subjects/".concat(_,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,de({grade_scale_id:vt,grade_term_id:ut,lesson_group_user_id:p.data.id});case 13:Mt=Re.sent,je.ZP[Mt.success?"success":"error"](Mt.message),Mt.success&&s.history.push("/teacher/subjects/".concat(_,"/final-grades"));case 16:case"end":return Re.stop()}},Ee)}));return function(Ee){return Fe.apply(this,arguments)}}(),[p.data,_]),pe=(0,v.useMemo)(function(){return[].concat(br,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Ee,be){var We;return typeof(be==null||(We=be.grade)===null||We===void 0?void 0:We.id)=="number"?[(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return x(be.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(kt.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),z=(0,v.useMemo)(function(){var Fe;return((Fe=E.data)!==null&&Fe!==void 0?Fe:[]).map(function(Ee){var be;return m()(m()({},Ee),{},{grade:(be=p.data)===null||be===void 0?void 0:be.grades.find(function(We){var Qe=We.grade_term;return Qe.id===Ee.id})})})},[p.data,E.data]),Je=D.loading&&!D.data||A.loading&&!A.data||q.loading&&!q.data,xe=!!(D.data&&A.data&&q.data);return p.loading?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[p.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:p.data.user})}),(0,e.jsx)(Bt.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Nt},dataSource:S.data,loading:S.loading,columns:_r,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Nt},dataSource:z,loading:p.loading||E.loading,columns:pe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Nt},cardProps:{bodyStyle:{padding:0}},dataSource:ve.data,loading:ve.loading,columns:[].concat(jr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Ee,be){return(0,e.jsx)(ta,{groupAttendanceScheduleId:be.id,studentId:c,attendance:be.attendance.value,onSuccess:O})}}])})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Nt},cardProps:{bodyStyle:{padding:0}},dataSource:ae.data,loading:ae.loading,columns:xr})}),Je&&(0,e.jsx)($e.Z,{}),xe&&((l=D.data)===null||l===void 0?void 0:l.map(function(Fe){var Ee,be,We,Qe,vt,ut,lt=Fe.id,St=Fe.title;return(0,e.jsxs)(mt.Z,{span:24,children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:St}),(0,e.jsx)(da.Du,{course_id:Number(lt),topics:(Ee=(be=q.data)===null||be===void 0?void 0:be[Number(lt)])!==null&&Ee!==void 0?Ee:[],stats:(We=(Qe=A.data)===null||Qe===void 0||(Qe=Qe[Number(lt)])===null||Qe===void 0?void 0:Qe.finishedTopics)!==null&&We!==void 0?We:[]}),(0,e.jsx)(da.nu,{stats:(vt=(ut=A.data)===null||ut===void 0||(ut=ut[Number(lt)])===null||ut===void 0?void 0:ut.attendanceList)!==null&&vt!==void 0?vt:[]})]},lt)}))]}),(0,e.jsx)(ot.ZP,{form:ze,onFinish:re,children:(0,e.jsxs)(ot.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(la.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:it,width:"sm",fieldProps:{loading:E.loading}}),(0,e.jsx)(la.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Ue,fieldProps:{loading:p.loading||G.loading}}),(0,e.jsx)(ot.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:De}})})]})})]})},yr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,l=r.grade_term,c=r.id;return(0,e.jsxs)(Ve.Z.Text,{children:[l.name,": ",a]},c)}):"-"})}}],Mr=function(){var n,t,r=(0,s.useLocation)(),a=new URLSearchParams(r.search),l=(n=a.get("user_id"))!==null&&n!==void 0?n:null,c=(t=a.get("group_id"))!==null&&t!==void 0?t:null,f=(0,tt.Z)(),h=f.teacherSubjectData,_=f.semester_subject_id,b=(0,v.useMemo)(function(){var S;return((S=h==null?void 0:h.groups)!==null&&S!==void 0?S:[]).map(function(F){var p=F.id,x=F.name;return{label:x,value:p}})},[h==null?void 0:h.groups]);return l!==null&&c!==null?(0,e.jsx)(Sr,{user_id:Number(l),group_id:Number(c)}):(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var S=i()(d()().mark(function F(p){var x,M,E,U,G,$,ae,ue,ve,O;return d()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return M=p.group_id,E=M===void 0?[]:M,U=p.first_name,G=U===void 0?"":U,$=p.last_name,ae=$===void 0?"":$,ue=((x=h==null?void 0:h.groups)!==null&&x!==void 0?x:[]).map(function(A){var q=A.id;return q}),D.next=4,k(E.length===0?ue:E);case 4:if(ve=D.sent,ve.success){D.next=7;break}return D.abrupt("return",{success:!1,total:0,data:[]});case 7:return O=ve.data.filter(function(A){var q=A.user;return q.first_name.toLowerCase().includes(G.toLowerCase())&&q.last_name.toLowerCase().includes(ae.toLowerCase())}),D.abrupt("return",{success:!0,total:O.length,data:O});case 9:case"end":return D.stop()}},F)}));return function(F){return S.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:b,mode:"multiple"},render:function(F,p){return(0,e.jsx)($t.Z,{type:"Students",type_id:p.group_id},p.group_id)}}].concat(yr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(F,p){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(_,"/final-grades?user_id=").concat(p.user.id,"&group_id=").concat(p.group_id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(wt.Z,{})})})},"edit")]}}])})},Cr=u(88284),Tr=u(88280),Fr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Er=function(n){var t=n.subjectTutorGradeScale,r=n.onFormSubmit,a=(0,v.useState)([]),l=Z()(a,2),c=l[0],f=l[1],h=(0,v.useRef)(),_=ot.ZP.useForm(),b=Z()(_,1),S=b[0];return(0,v.useEffect)(function(){var F,p=((F=t.scale)!==null&&F!==void 0?F:[]).map(function(x,M){return m()(m()({},x),{},{id:String((M+1)*100)})});S.setFieldValue("table",p)},[]),(0,e.jsx)(ot.ZP,{form:S,onFinish:r,submitter:{render:function(p,x){var M=Z()(x,2),E=M[1];return[E]}},children:(0,e.jsx)(Tr.Z,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Fr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(p,x){return(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){var E;return(E=h.current)===null||E===void 0?void 0:E.startEditable(x.id)},icon:(0,e.jsx)(wt.Z,{})})}}]),editable:{form:S,type:"multiple",editableKeys:c,saveText:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(Cr.Z,{})}),onChange:f,actionRender:function(p,x,M){return[M.save]}}})})},Pr=function(){var n,t,r=(0,s.useModel)("@@initialState"),a=r.initialState,l=(0,tt.Z)(),c=l.semester_subject_id,f=l.tutors,h=(0,v.useState)(),_=Z()(h,2),b=_[0],S=_[1],F=(0,v.useState)(!1),p=Z()(F,2),x=p[0],M=p[1],E=(0,v.useState)(null),U=Z()(E,2),G=U[0],$=U[1],ae=(0,v.useMemo)(function(){return!!f.data.find(function(L){var D,A=L.id;return A===(a==null||(D=a.currentUser)===null||D===void 0?void 0:D.id)})},[f.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),ue=(0,v.useMemo)(function(){return f.data.map(function(L){var D=L.id,A=L.first_name,q=L.last_name;return{label:"".concat(A," ").concat(q),value:D}})},[f.data]),ve=(0,v.useCallback)(function(){c===null||G===null||(M(!0),S(void 0),Pt(c,G).then(function(L){L.success&&S(L.data)}).finally(function(){M(!1)}))},[c,G]),O=(0,v.useCallback)(function(L,D){return function(){var A=i()(d()().mark(function q(Le){var Ne,ze;return d()().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if(!(c===null||G===null)){Ue.next=2;break}return Ue.abrupt("return");case 2:return Ne=L.reduce(function(De,re){return re.s_subject_scale_form_id===D?[].concat(I()(De),[{s_subject_scale_form_id:D,scale:Le.table.map(function(pe){var z=pe.name,Je=pe.grade,xe=pe.grade_value;return{name:z,grade:Je,grade_value:xe}})}]):[].concat(I()(De),[re])},[]),Ue.next=5,Dt(c,G,{grade_scale:Ne});case 5:ze=Ue.sent,ze.success&&ve();case 7:case"end":return Ue.stop()}},q)}));return function(q){return A.apply(this,arguments)}}()},[G,c]);return(0,v.useEffect)(function(){var L,D;if(!ae||!(a!=null&&(L=a.currentUser)!==null&&L!==void 0&&L.id)){var A;if((A=f.data)!==null&&A!==void 0&&A[0]){var q;$((q=f.data)===null||q===void 0?void 0:q[0].id)}return}$(a==null||(D=a.currentUser)===null||D===void 0?void 0:D.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,ae]),(0,v.useEffect)(function(){ve()},[ve]),f.loading?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(Gt.default,{disabled:ae,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:ue,value:G,onChange:function(D){return $(D)}})}),(0,e.jsx)(Bt.Z,{}),x&&!b&&(0,e.jsx)($e.Z,{}),b!=null&&b.grade_scale?b.grade_scale.map(function(L,D){var A;return(0,e.jsxs)(v.Fragment,{children:[D>0&&(0,e.jsx)(Bt.Z,{}),(0,e.jsx)(Er,{subjectTutorGradeScale:L,onFormSubmit:O((A=b.grade_scale)!==null&&A!==void 0?A:[],L.s_subject_scale_form_id)})]},L.s_subject_scale_form_id)}):(0,e.jsx)(Ve.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},Zr=u(30814),Ir=u(40411),wr=u(31156),Gr=u(27484),ft=u.n(Gr);function Dr(o,n){return Vt.apply(this,arguments)}function Vt(){return Vt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules",m()({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),Vt.apply(this,arguments)}var Ar=function(){var n=(0,v.useState)(null),t=Z()(n,2),r=t[0],a=t[1],l=(0,v.useState)([]),c=Z()(l,2),f=c[0],h=c[1],_=(0,tt.Z)(),b=_.semester_subject_id,S=ft()(),F=(0,v.useMemo)(function(){return f.map(function($){return{id:$.id,title:"".concat($.group.name," (").concat($.term_status.name,")"),start:ft()($.date_from).toDate(),end:ft()($.date_to).toDate(),tutor_name:"".concat($.tutor.first_name," ").concat($.tutor.last_name),tutor_email:$.tutor.email,semester:$.semester.name,group:$.group.name,subject:$.subject.name,ms_teams_join_url:$.ms_teams_join_url}})},[f]),p=(0,v.useCallback)(function($,ae){Dr({semester_subject_id:b,date_form:$.toDate(),date_to:ae.toDate()}).then(function(ue){ue.success&&h(ue.data)})},[b]),x=(0,v.useCallback)(function($){a($)},[]),M=(0,v.useCallback)(function(){a(null)},[]),E=(0,v.useCallback)(function($){return $.isSame(S,"day")?"warning":$.isAfter(S,"day")?"success":"error"},[]),U=(0,v.useCallback)(function($){var ae=F.filter(function(ue){return ft()(ue.start).isSame($,"day")});return(0,e.jsx)("ul",{className:"events",children:ae.map(function(ue){return(0,e.jsx)("li",{onClick:function(){return x(ue)},children:(0,e.jsx)(Ir.Z,{status:E(ft()(ue.start)),text:ue.title})},ue.id)})})},[f]),G=(0,v.useCallback)(function($,ae){var ue=ft()($).startOf(ae).subtract(1,"month"),ve=ft()($).endOf(ae).add(1,"month");p(ue,ve)},[]);return(0,v.useEffect)(function(){var $=ft()().startOf("month"),ae=ft()().endOf("month");p($,ae)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(wr.Z,{dateCellRender:U,onPanelChange:G}),(0,e.jsxs)(_e.Z,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:M,footer:null,children:[(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",r&&ft()(r.start).format(ct.E)]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",r&&ft()(r.end).format(ct.E)]}),(r==null?void 0:r.ms_teams_join_url)&&(0,e.jsx)(Ve.Z.Paragraph,{children:(0,e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(g.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},Lr=u(58638);function Rr(o,n){return Xt.apply(this,arguments)}function Xt(){return Xt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),Xt.apply(this,arguments)}var $r=function(n){var t=n.student_id,r=(0,v.useState)(!1),a=Z()(r,2),l=a[0],c=a[1],f=(0,v.useCallback)(i()(d()().mark(function h(){var _;return d()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return c(!0),S.next=3,Rr({user_id:t});case 3:if(_=S.sent,_.success){S.next=8;break}return je.ZP.error(_.message),c(!1),S.abrupt("return");case 8:window.open(_.data.web_url,"_blank","noopener noreferrer"),c(!1);case 10:case"end":return S.stop()}},h)})),[]);return(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(g.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(Lr.Z,{}),onClick:f})})},Or=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Nr=function(n){return n.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},Ur=function(n){return n.reduce(function(t,r){var a,l=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(c,f){return f.academic_teacher_id!==null?c:[].concat(I()(c),[{group_id:r.id,group_name:r.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(I()(t),I()(l))},[])},kr=function(){var n=(0,tt.Z)(),t=n.teacherSubjectData,r=(0,v.useMemo)(function(){var a;return Nr((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var a=i()(d()().mark(function l(c){var f,h,_,b,S,F,p,x,M;return d()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return f=c.groups,h=c.first_name,_=h===void 0?"":h,b=c.last_name,S=b===void 0?"":b,F=c.email,p=F===void 0?"":F,U.next=3,(0,yt.Z)({parent_id:t==null?void 0:t.group_id,id:f});case 3:if(x=U.sent,x.success){U.next=6;break}return U.abrupt("return",{data:[],total:0,success:!1});case 6:return M=Ur(x.data).filter(function(G){return G.first_name.toLowerCase().includes(_.toLowerCase())&&G.last_name.toLowerCase().includes(S.toLowerCase())&&G.email.toLowerCase().includes(p.toLowerCase())}),U.abrupt("return",{data:M,total:M.length,success:!0});case 8:case"end":return U.stop()}},l)}));return function(l){return a.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(Or,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,c){return[(0,e.jsx)($r,{student_id:c.user_id},"teamsChat")]}}])})},Br=function(n){var t,r,a=n.tab,l=(0,s.useIntl)(),c=(0,s.useModel)("@@initialState"),f=c.setInitialState,h=c.initialState,_=(0,tt.Z)(),b=_.teacherSubjectData,S=_.semester_subject_id,F=_.tutors,p=(0,v.useCallback)((0,Pe.X)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),x=(0,v.useMemo)(function(){return!!F.data.find(function(M){var E,U=M.id;return U===(h==null||(E=h.currentUser)===null||E===void 0?void 0:E.id)})||p(Ke.Z.TeacherListGradeScale)},[]);return b?(0,e.jsx)(B._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:b==null||(t=b.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:a})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S,"/exams?exam_id=new"),children:(0,e.jsx)(g.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(S),breadcrumbName:String((r=b.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:l.formatMessage({id:a,defaultMessage:String(a)})}]}},children:(0,e.jsxs)(Se.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(E){f(m()({},h)),s.history.push("/teacher/subjects/".concat(S,"/").concat(E))}},children:[(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(Zr.F,{})},"groups"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(kr,{})},"students"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(er,{})},"exams"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Ar,{})},"schedule"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(Ia,{})},"class-register"),x&&(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(Pr,{})},"grades-scale"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(Mr,{})},"final-grades"),(0,e.jsx)(Se.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(ur,{})},"file-exports-history")]})}):(0,e.jsx)($e.Z,{})},Wr=function(){var o=(0,s.useParams)(),n=o.subjectId,t=o.tab,r=t===void 0?"groups":t;return(0,e.jsx)(tt.p,{semester_subject_id:Number(n),children:(0,e.jsx)(Br,{tab:r})})}},76841:function(Tt,qe,u){u.d(qe,{Gm:function(){return g},Sx:function(){return d},_g:function(){return s}});var Xe=u(15009),m=u.n(Xe),Ke=u(97857),Pe=u.n(Ke),Se=u(99289),B=u.n(Se),$e=u(80854);function g(i,y){return v.apply(this,arguments)}function v(){return v=B()(m()().mark(function i(y,I){return m()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",(0,$e.request)("/api/admin/reports/report",Pe()({params:y,method:"GET",useCache:!1},I||{})));case 1:case"end":return Z.stop()}},i)})),v.apply(this,arguments)}function s(i,y,I){return Q.apply(this,arguments)}function Q(){return Q=B()(m()().mark(function i(y,I,te){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,$e.request)("/api/admin/stats/course/".concat(y,"/export"),Pe()({params:I,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},te||{})));case 1:case"end":return H.stop()}},i)})),Q.apply(this,arguments)}function d(i,y,I){return P.apply(this,arguments)}function P(){return P=B()(m()().mark(function i(y,I,te){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,$e.request)("/api/admin/stats/topic/".concat(y,"/export"),Pe()({method:"GET",useCache:!1,params:{stat:I},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},te||{})));case 1:case"end":return H.stop()}},i)})),P.apply(this,arguments)}},70804:function(Tt,qe,u){var Xe=u(67294);var m=function(Q,d){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,i){P.__proto__=i}||function(P,i){for(var y in i)i.hasOwnProperty(y)&&(P[y]=i[y])})(Q,d)},Ke,Pe,Se=(function(Q){(function(){var d={}.hasOwnProperty;function P(){for(var i=[],y=0;y<arguments.length;y++){var I=arguments[y];if(I){var te=typeof I;if(te==="string"||te==="number")i.push(I);else if(Array.isArray(I)&&I.length){var Z=P.apply(null,I);Z&&i.push(Z)}else if(te==="object")for(var H in I)d.call(I,H)&&I[H]&&i.push(H)}}return i.join(" ")}Q.exports?(P.default=P,Q.exports=P):window.classNames=P})()}(Pe={path:Ke,exports:{},require:function(Q,d){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(d==null&&Pe.path)}},Pe.exports),Pe.exports);function B(Q,d,P){var i,y,I,te,Z;function H(){var he=Date.now()-te;he<d&&he>=0?i=setTimeout(H,d-he):(i=null,P||(Z=Q.apply(I,y),I=y=null))}d==null&&(d=100);var _e=function(){I=this,y=arguments,te=Date.now();var he=P&&!i;return i||(i=setTimeout(H,d)),he&&(Z=Q.apply(I,y),I=y=null),Z};return _e.clear=function(){i&&(clearTimeout(i),i=null)},_e.flush=function(){i&&(Z=Q.apply(I,y),I=y=null,clearTimeout(i),i=null)},_e}B.debounce=B;var $e=B;(function(Q,d){d===void 0&&(d={});var P=d.insertAt;if(Q&&typeof document!="undefined"){var i=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",P==="top"&&i.firstChild?i.insertBefore(y,i.firstChild):i.appendChild(y),y.styleSheet?y.styleSheet.cssText=Q:y.appendChild(document.createTextNode(Q))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var g,v=(g="indiana-scroll-container",function(Q,d){if(!Q)return g;var P;typeof Q=="string"?P=Q:d=Q;var i=g;return P&&(i+="__"+P),i+(d?Object.keys(d).reduce(function(y,I){var te=d[I];return te&&(y+=" "+(typeof te=="boolean"?i+"--"+I:i+"--"+I+"_"+te)),y},""):"")}),s=function(Q){function d(P){var i=Q.call(this,P)||this;return i.onEndScroll=function(){i.scrolling=!1,!i.pressed&&i.started&&i.processEnd()},i.onScroll=function(y){var I=i.container.current;I.scrollLeft===i.scrollLeft&&I.scrollTop===i.scrollTop||(i.scrolling=!0,i.processScroll(y),i.onEndScroll())},i.onTouchStart=function(y){var I=i.props.nativeMobileScroll;if(i.isDraggable(y.target))if(i.internal=!0,I&&i.scrolling)i.pressed=!0;else{var te=y.touches[0];i.processClick(y,te.clientX,te.clientY),!I&&i.props.stopPropagation&&y.stopPropagation()}},i.onTouchEnd=function(y){var I=i.props.nativeMobileScroll;i.pressed&&(!i.started||i.scrolling&&I?i.pressed=!1:i.processEnd(),i.forceUpdate())},i.onTouchMove=function(y){var I=i.props.nativeMobileScroll;if(i.pressed&&(!I||!i.isMobile)){var te=y.touches[0];te&&i.processMove(y,te.clientX,te.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation()}},i.onMouseDown=function(y){i.isDraggable(y.target)&&i.isScrollable()&&(i.internal=!0,i.props.buttons.indexOf(y.button)!==-1&&(i.processClick(y,y.clientX,y.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation()))},i.onMouseMove=function(y){i.pressed&&(i.processMove(y,y.clientX,y.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation())},i.onMouseUp=function(y){i.pressed&&(i.started?i.processEnd():(i.internal=!1,i.pressed=!1,i.forceUpdate(),i.props.onClick&&i.props.onClick(y)),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation())},i.container=Xe.createRef(),i.onEndScroll=$e(i.onEndScroll,300),i.scrolling=!1,i.started=!1,i.pressed=!1,i.internal=!1,i.getRef=i.getRef.bind(i),i}return function(P,i){function y(){this.constructor=P}m(P,i),P.prototype=i===null?Object.create(i):(y.prototype=i.prototype,new y)}(d,Q),d.prototype.componentDidMount=function(){var P=this.props.nativeMobileScroll,i=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),i.addEventListener("touchstart",this.onTouchStart,{passive:!1}),i.addEventListener("mousedown",this.onMouseDown,{passive:!1}),P&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},d.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},d.prototype.getElement=function(){return this.container.current},d.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},d.prototype.isDraggable=function(P){var i=this.props.ignoreElements;if(i){var y=P.closest(i);return y===null||y.contains(this.getElement())}return!0},d.prototype.isScrollable=function(){var P=this.container.current;return P&&(P.scrollWidth>P.clientWidth||P.scrollHeight>P.clientHeight)},d.prototype.processClick=function(P,i,y){var I=this.container.current;this.scrollLeft=I.scrollLeft,this.scrollTop=I.scrollTop,this.clientX=i,this.clientY=y,this.pressed=!0},d.prototype.processStart=function(P){P===void 0&&(P=!0);var i=this.props.onStartScroll;this.started=!0,P&&document.body.classList.add("indiana-dragging"),i&&i({external:!this.internal}),this.forceUpdate()},d.prototype.processScroll=function(P){if(this.started){var i=this.props.onScroll;i&&i({external:!this.internal})}else this.processStart(!1)},d.prototype.processMove=function(P,i,y){var I=this.props,te=I.horizontal,Z=I.vertical,H=I.activationDistance,_e=I.onScroll,he=this.container.current;this.started?(te&&(he.scrollLeft-=i-this.clientX),Z&&(he.scrollTop-=y-this.clientY),_e&&_e({external:!this.internal}),this.clientX=i,this.clientY=y,this.scrollLeft=he.scrollLeft,this.scrollTop=he.scrollTop):(te&&Math.abs(i-this.clientX)>H||Z&&Math.abs(y-this.clientY)>H)&&(this.clientX=i,this.clientY=y,this.processStart())},d.prototype.processEnd=function(){var P=this.props.onEndScroll;this.container.current&&P&&P({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},d.prototype.getRef=function(P){[this.container,this.props.innerRef].forEach(function(i){i&&(typeof i=="function"?i(P):i.current=P)})},d.prototype.render=function(){var P=this.props,i=P.children,y=P.draggingClassName,I=P.className,te=P.style,Z=P.hideScrollbars,H=P.component;return Xe.createElement(H,{className:Se(I,this.pressed&&y,v({dragging:this.pressed,"hide-scrollbars":Z,"native-scroll":this.isMobile})),style:te,ref:this.getRef,onScroll:this.onScroll},i)},d.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},d}(Xe.PureComponent);qe.Z=s}}]);
