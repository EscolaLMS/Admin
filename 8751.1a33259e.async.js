"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8751],{38751:function(je,de,n){n.d(de,{i:function(){return hr}});var ce=n(19632),p=n.n(ce),me=n(15009),x=n.n(me),ve=n(99289),I=n.n(ve),G=n(13769),V=n.n(G),Z=n(5574),W=n.n(Z),ie=n(97857),C=n.n(ie),z=n(53682),w=n(64789),H=n(58638),ee=n(7807),K=n(49252),re=n(85265),R=n(14726),te=n(2453),ne=n(62748),M=n(67294),ae=n(43443),t=n(80854),y=n(29477),P=n(62235),F=n(3598),l=n(952),L=n(37476),fe=n(64317),e=n(85893),$=function(r){var a=r.quiz_id,s=r.quizQuestions,i=r.visible,d=r.onVisibleChange,o=l.ZP.useForm(),g=W()(o,1),_=g[0],E=(0,t.useIntl)(),v=(0,M.useCallback)(function(){var A=I()(x()().mark(function c(k){var b,Y,q;return x()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return b=k.ids,S.prev=1,S.next=4,(0,F.qp)({quiz_id:a,ids:b});case 4:Y=S.sent,Y instanceof Blob&&(q=document.createElement("a"),q.href=window.URL.createObjectURL(Y),q.download="quiz_questions_".concat(a,".xlsx"),document.body.appendChild(q),q.click(),document.body.removeChild(q)),S.next=11;break;case 8:S.prev=8,S.t0=S.catch(1),console.error(S.t0);case 11:return S.prev=11,d(!1),S.finish(11);case 14:case"end":return S.stop()}},c,null,[[1,8,11,14]])}));return function(c){return A.apply(this,arguments)}}(),[a]),h=(0,M.useMemo)(function(){return s.map(function(A){var c=A.id,k=A.value;try{var b=(0,K.parse)(k);if(!(b!=null&&b[0])||!("stem"in b[0]))return{value:c,label:E.formatMessage({id:"ExportQuestions.questionTitle"},{id:c})};var Y=b[0].stem.text;return{value:c,label:Y}}catch(q){return console.error(q),{value:c,label:E.formatMessage({id:"ExportQuestions.questionTitle"},{id:c})}}})},[s]);return(0,e.jsx)(L.Y,{title:(0,e.jsx)(t.FormattedMessage,{id:"exportQuestions"}),form:_,visible:i,onVisibleChange:d,onFinish:v,children:(0,e.jsx)(fe.Z,{mode:"multiple",options:h,name:"ids",label:(0,e.jsx)(t.FormattedMessage,{id:"questions"}),required:!0,rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}]})})},ge=n(52677),X=n.n(ge),T=n(31199),Q=n(78957),f=n(96074),N=n(89974),j=n(31472),ye=n(90672),_e=function(){return(0,e.jsx)(ye.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0})},J=n(5966),U=n(5155),Le=[{firstOfPair:"",secondOfPair:""}],Qe=function(){var r=(0,t.useIntl)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(U.u,{name:"answers",creatorButtonProps:{creatorButtonText:r.formatMessage({id:"Questions.addMatchingPair",defaultMessage:"Add Matching Pair"})},deleteIconProps:{tooltipText:r.formatMessage({id:"Questions.deletePair"})},actionRender:function(s,i,d){var o=W()(d,2),g=o[1];return[g]},min:1,initialValue:Le,children:function(s,i){return(0,e.jsxs)(l.ZP.Group,{direction:"horizontal",align:"baseline",size:"small",spaceProps:{style:{flexWrap:"nowrap"}},title:(0,e.jsx)(t.FormattedMessage,{id:"Questions.pair",values:{ordinalNumber:i+1},defaultMessage:"Pair ".concat(i+1)}),children:[(0,e.jsx)(J.Z,{name:"firstOfPair",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}]}),(0,e.jsx)(J.Z,{name:"secondOfPair",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}]})]})}})]})},Re=n(9783),xe=n.n(Re),Te=n(82061),Pe=n(63434),Ae=n(83062),Ne=xe()(xe()({},j.ce.MULTIPLE_CHOICE,[{isCorrect:!1,value:"",feedback:""},{isCorrect:!1,value:"",feedback:""}]),j.ce.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS,[{value:"",weight:""},{value:"",weight:""}]),Ue=function(r){var a,s=r.type,i=(0,t.useIntl)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(U.u,{name:"answers",creatorButtonProps:{creatorButtonText:i.formatMessage({id:"Questions.addAnswer"})},actionRender:function(){return[]},initialValue:(a=Ne[s])!==null&&a!==void 0?a:[],children:function(o,g,_,E){return(0,e.jsxs)(l.ZP.Group,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.FormattedMessage,{id:"Questions.answer",values:{ordinalNumber:g+1}}),E>2&&(0,e.jsx)(Ae.Z,{title:i.formatMessage({id:"Questions.deleteAnswer"}),children:(0,e.jsx)(R.ZP,{type:"text",icon:(0,e.jsx)(Te.Z,{}),onClick:function(){return _.remove(o.name)}})})]}),titleStyle:{width:"100%",display:"flex",justifyContent:"space-between"},children:[s===j.ce.MULTIPLE_CHOICE&&(0,e.jsx)(Pe.Z,{name:"isCorrect",label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.correctAnswer",defaultMessage:"Is Correct Answer?"}),rules:[function(v){var h=v.getFieldValue;return{validator:function(){var c,k=(c=h("answers"))!==null&&c!==void 0?c:[];return k.filter(function(b){return b==null?void 0:b.isCorrect}).length>1?Promise.reject("Only one answer can be correct"):Promise.resolve()},message:(0,e.jsx)(t.FormattedMessage,{id:"Questions.onlyOneAnswerIsCorrect"})}}]}),(0,e.jsx)(J.Z,{name:"value",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(t.FormattedMessage,{id:"content",defaultMessage:"Content"})}),s===j.ce.MULTIPLE_CHOICE&&(0,e.jsx)(J.Z,{name:"feedback",label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.answerFeedback",defaultMessage:"Answer feedback"})}),s===j.ce.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS&&(0,e.jsx)(T.Z,{name:"weight",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],fieldProps:{min:-Number.MAX_SAFE_INTEGER,addonAfter:"%"},label:(0,e.jsx)(t.FormattedMessage,{id:"weight",defaultMessage:"Weight"})})]})}})]})},qe=function(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(T.Z,{name:"answer",label:(0,e.jsx)(t.FormattedMessage,{id:"answer"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(T.Z,{name:"errorMargin",fieldProps:{addonAfter:"+/-"},label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.errorMargin"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0})]})},Ze=[{value:"",feedback:""}],We=function(){var r=(0,t.useIntl)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(U.u,{name:"answers",creatorButtonProps:{creatorButtonText:r.formatMessage({id:"Questions.addAnswer"})},actionRender:function(){return[]},initialValue:Ze,children:function(s,i,d,o){return(0,e.jsxs)(l.ZP.Group,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.FormattedMessage,{id:"Questions.answer",values:{ordinalNumber:i+1}}),o>1&&(0,e.jsx)(Ae.Z,{title:r.formatMessage({id:"Questions.deleteAnswer"}),children:(0,e.jsx)(R.ZP,{type:"text",icon:(0,e.jsx)(Te.Z,{}),onClick:function(){return d.remove(s.name)}})})]}),titleStyle:{width:"100%",display:"flex",justifyContent:"space-between"},children:[(0,e.jsx)(J.Z,{name:"value",rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(t.FormattedMessage,{id:"content",defaultMessage:"Content"})}),(0,e.jsx)(J.Z,{name:"feedback",label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.answerFeedback",defaultMessage:"Answer feedback"})})]})}})]})},ze=function(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z,{name:"question",label:(0,e.jsx)(t.FormattedMessage,{id:"question"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(Pe.Z,{name:"isCorrect",label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.correctAnswer"})})]})},Be=function(r){var a=r.type;if(!a)return null;switch(a){case j.ce.MULTIPLE_CHOICE:case j.ce.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS:return(0,e.jsx)(Ue,{type:a});case j.ce.TRUE_FALSE:return(0,e.jsx)(ze,{});case j.ce.SHORT_ANSWERS:return(0,e.jsx)(We,{});case j.ce.MATCHING:return(0,e.jsx)(Qe,{});case j.ce.NUMERICAL_QUESTION:return(0,e.jsx)(qe,{});case j.ce.ESSAY:case j.ce.DESCRIPTION:return(0,e.jsx)(_e,{});default:return(0,e.jsxs)("pre",{children:["Unsupported type ",a]})}},Ge=n(64599),Me=n.n(Ge),He=["question"],le=function(r){for(var a=["~","=","#","{","}",":"],s="",i=0;i<r.length;i++){var d=r[i];a.includes(d)?s+="\\".concat(d):s+=d}return s},Ke=function(r){var a=r.question,s=r.answers;if(s.length===0)return"".concat(a,"{}");var i=s.map(function(c){var k=c.isCorrect,b=c.value,Y=c.feedback;return{isCorrect:k,feedback:le(Y!=null?Y:""),value:le(b)}}),d="".concat(a,"{"),o=Me()(i),g;try{for(o.s();!(g=o.n()).done;){var _=g.value,E=_.isCorrect,v=_.value,h=_.feedback,A=E?"=":"~";d+=h?"".concat(A).concat(v,"#").concat(h):"".concat(A).concat(v)}}catch(c){o.e(c)}finally{o.f()}return d+="}",d.trim()},$e=function(r){var a=r.question,s=r.answers;if(s.length==0)return"".concat(a,"{}");var i="".concat(a,"{"),d=s.map(function(h){var A=h.weight,c=h.value;return{weight:A,value:le(c)}}),o=Me()(d),g;try{for(o.s();!(g=o.n()).done;){var _=g.value,E=_.value,v=_.weight;i+="~%".concat(v,"%").concat(E)}}catch(h){o.e(h)}finally{o.f()}return i+="}",i.trim()},ke=function(r){var a=r.question,s=r.isCorrect;return"".concat(a,"{").concat(s?"T":"F","}")},Ye=function(r){var a=r.question,s=r.answers;if(s.length===0)return"".concat(a,"{}");var i="".concat(a,"{"),d=s.map(function(h){var A=h.value,c=h.feedback;return{value:le(A),feedback:le(c!=null?c:"")}}),o=Me()(d),g;try{for(o.s();!(g=o.n()).done;){var _=g.value,E=_.value,v=_.feedback;i+=v?"=".concat(E,"#").concat(v):"=".concat(E)}}catch(h){o.e(h)}finally{o.f()}return i+="}",i.trim()},Xe=function(r){var a=r.question,s=r.answers;if(s.length===0)return"".concat(a,"{}");var i="".concat(a,"{"),d=s.map(function(h){var A=h.firstOfPair,c=h.secondOfPair;return{firstOfPair:le(A),secondOfPair:le(c)}}),o=Me()(d),g;try{for(o.s();!(g=o.n()).done;){var _=g.value,E=_.firstOfPair,v=_.secondOfPair;i+="=".concat(E,"->").concat(v)}}catch(h){o.e(h)}finally{o.f()}return i+="}",i.trim()},Je=function(r){var a=r.question,s=r.answer,i=r.errorMargin;return"".concat(a,"{#").concat(s,":").concat(i,"}")},Ve=function(r){var a=r.question;return"".concat(a,"{}")},er=function(r){var a=r.question;return a},rr=function(r){var a=r.question,s=V()(r,He),i=C()({question:le(a)},s);switch(i.type){case j.ce.MULTIPLE_CHOICE:return Ke(i);case j.ce.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS:return $e(i);case j.ce.TRUE_FALSE:return ke(i);case j.ce.SHORT_ANSWERS:return Ye(i);case j.ce.MATCHING:return Xe(i);case j.ce.NUMERICAL_QUESTION:return Je(i);case j.ce.ESSAY:return Ve(i);case j.ce.DESCRIPTION:return er(i);default:throw new Error("Unsupported type: ".concat(i==null?void 0:i.type))}},tr=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text,g=r.choices.every(function(v){var h=v.weight;return h===null});if(g){var _=r.choices.map(function(v){var h=v.isCorrect,A=v.text,c=v.feedback;return{isCorrect:h,value:A.text,feedback:c==null?void 0:c.text}});return{type:s,score:i,category_id:d,question:o,answers:_}}var E=r.choices.reduce(function(v,h){var A=h.weight,c=h.text;return A!==null?[].concat(p()(v),[{weight:A,value:c.text}]):v},[]);return{type:s,score:i,category_id:d,question:o,answers:E}},nr=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text,g=r.isTrue;return{type:s,score:i,category_id:d,question:o,isCorrect:g}},ar=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text,g=r.choices.map(function(_){var E=_.text,v=_.feedback;return{value:E.text,feedback:v==null?void 0:v.text}});return{type:s,score:i,category_id:d,question:o,answers:g}},sr=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text,g=r.matchPairs.map(function(_){var E=_.subquestion,v=_.subanswer;return{firstOfPair:E.text,secondOfPair:v}});return{type:s,score:i,category_id:d,question:o,answers:g}},ir=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text;if(Array.isArray(r==null?void 0:r.choices))throw new Error("Unsupported choices type: array");var g=r==null?void 0:r.choices.number,_=r==null?void 0:r.choices.range;if(g===void 0||_===void 0)throw new Error("Value undefined - answer: ".concat(g," errorMargin: ").concat(_));return{type:s,score:i,category_id:d,question:o,answer:g,errorMargin:_}},or=function(r,a){var s=a.type,i=a.score,d=a.category_id,o=r==null?void 0:r.stem.text;return{type:s,score:i,category_id:d,question:o}};function ur(u){if(u)try{var r=(0,K.parse)(u.value),a=W()(r,1),s=a[0];switch(s.type){case"MC":return tr(s,u);case"TF":return nr(s,u);case"Short":return ar(s,u);case"Matching":return sr(s,u);case"Numerical":return ir(s,u);case"Description":case"Essay":return or(s,u);default:throw new Error("Unsupported type: ".concat(s==null?void 0:s.type))}}catch(i){console.error(i);return}}var lr=["type","score","category"],dr=Object.values(j.ce).reduce(function(u,r){return r?[].concat(p()(u),[{value:r,label:(0,e.jsx)(t.FormattedMessage,{id:"gift_type.".concat(r)})}]):u},[]),Ie=function(r){var a=r.onSubmit,s=r.values,i=r.competencyChallengeCategoryTreeProps,d=i===void 0?!1:i,o=(0,t.useIntl)(),g=l.ZP.useForm(),_=W()(g,1),E=_[0],v=l.ZP.useWatch("type",E),h=(0,M.useMemo)(function(){return ur(s)},[s]),A=(0,M.useCallback)(function(){var c=I()(x()().mark(function k(b){var Y,q,Ce,S;return x()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return Y=rr(b),q=b.score,Ce=b.category_id,oe.next=4,a({value:Y,score:q!=null?q:0,category_id:Ce});case 4:if(S=oe.sent,S){oe.next=7;break}return oe.abrupt("return");case 7:E.resetFields();case 8:case"end":return oe.stop()}},k)}));return function(k){return c.apply(this,arguments)}}(),[]);return(0,M.useEffect)(function(){E.resetFields()},[h]),(0,M.useEffect)(function(){if(v){var c=E.getFieldsValue(),k=Object.keys(c).filter(function(b){return!lr.includes(b)});E.resetFields(k)}},[v]),(0,e.jsxs)(Q.Z,{direction:"vertical",style:{display:"flex"},children:[(0,e.jsx)(f.Z,{children:(0,e.jsx)(t.FormattedMessage,{id:h?"Questions.edit":"addNewQuestion"})}),(0,e.jsxs)(l.ZP,{layout:"horizontal",form:E,onFinish:A,initialValues:h,children:[(0,e.jsx)(fe.Z,{name:"type",placeholder:o.formatMessage({id:"selectNewQuestionType",defaultMessage:"Select new question type"}),label:(0,e.jsx)(t.FormattedMessage,{id:"type",defaultMessage:"Type:"}),options:dr,rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0}),(0,e.jsx)(Be,{type:v}),v!==j.ce.DESCRIPTION&&(0,e.jsx)(T.Z,{name:"score",label:(0,e.jsx)(t.FormattedMessage,{id:"Questions.score",defaultMessage:"Score"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}]}),d&&(0,e.jsx)(l.ZP.Item,{name:"category_id",label:(0,e.jsx)(t.FormattedMessage,{id:"category",defaultMessage:"Category"}),rules:[{required:!0,message:(0,e.jsx)(t.FormattedMessage,{id:"field_required"})}],required:!0,children:(0,e.jsx)(N.b,C()({},X()(d)==="object"?d:{}))})]})]})},cr=["className","style"],mr=(0,ae.W6)(function(){return(0,e.jsx)(z.Z,{style:{cursor:"grab",color:"#999"}})}),vr=(0,ae.W8)(function(u){return(0,e.jsx)("tr",C()({},u))}),fr=(0,ae.JN)(function(u){return(0,e.jsx)("tbody",C()({},u))}),pr=[{title:(0,e.jsx)(t.FormattedMessage,{id:"sort",defaultMessage:"sort"}),dataIndex:"id",width:60,className:"drag-visible",render:function(){return(0,e.jsx)(mr,{})}},{title:(0,e.jsx)(t.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInForm:!0,hideInSearch:!0,hideInSetting:!0,render:function(r,a){return(0,e.jsx)(t.FormattedMessage,{id:"gift_type.".concat(a.type)})}},{title:(0,e.jsx)(t.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"question",hideInForm:!0,hideInSearch:!0,hideInSetting:!0,render:function(r,a){try{var s=(0,K.parse)(a.value);return s!=null&&s[0]&&"stem"in s[0]?s[0].stem.text:"question"}catch(i){return console.error(i),"question"}}}],gr={title:(0,e.jsx)(t.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"category_id",hideInForm:!0,hideInSearch:!0,hideInSetting:!0,render:function(r,a){return typeof a.category_id=="number"?(0,e.jsx)(P.Z,{type:"Category",type_id:a.category_id}):"-"}},hr=function(r){var a=r.questions,s=r.onAdded,i=r.onRemoved,d=r.onEdited,o=r.quizId,g=r.tableLoading,_=r.tableHeader,E=r.questionsCategory,v=r.customToolbarElements,h=v===void 0?[]:v,A=(0,M.useState)(!1),c=W()(A,2),k=c[0],b=c[1],Y=(0,M.useState)(!1),q=W()(Y,2),Ce=q[0],S=q[1],Fe=(0,M.useState)(),oe=W()(Fe,2),ue=oe[0],be=oe[1],yr=(0,M.useState)(!1),Se=W()(yr,2),_r=Se[0],Oe=Se[1],Cr=(0,M.useState)(a),De=W()(Cr,2),Ee=De[0],we=De[1],Er=(0,t.useIntl)(),Mr=(0,M.useRef)();(0,M.useEffect)(function(){var B;(B=Mr.current)===null||B===void 0||B.reload(),we(a)},[a]);var jr=function(O){var D=O.oldIndex,se=O.newIndex;if(D!==se){var pe=(0,ne.q)(Ee.slice(),D,se).filter(Boolean).map(function(m,he){return C()(C()({},m),{},{order:he})});pe.forEach(function(m,he){m.id!==Ee[he].id&&(0,F.Ds)(m.id,C()(C()({},m),{},{order:he+1,topic_gift_quiz_id:o}))}),we(pe)}},br=function(O){return(0,e.jsx)(fr,C()({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:jr},O))},xr=function(O){var D=O.className,se=O.style,pe=V()(O,cr),m=Ee.findIndex(function(he){return he.id===pe["data-row-key"]});return(0,e.jsx)(vr,C()({index:m},pe))},Tr=(0,M.useCallback)(function(){var B=I()(x()().mark(function O(D){var se;return x()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.prev=0,b(!0),m.next=4,(0,F.CB)(C()({topic_gift_quiz_id:o},D));case 4:return se=m.sent,S(!1),s==null||s(),m.abrupt("return",se.success);case 10:return m.prev=10,m.t0=m.catch(0),console.log(m.t0),m.abrupt("return",!1);case 14:return m.prev=14,b(!1),m.finish(14);case 17:case"end":return m.stop()}},O,null,[[0,10,14,17]])}));return function(O){return B.apply(this,arguments)}}(),[o]),Pr=(0,M.useCallback)(function(){var B=I()(x()().mark(function O(D){var se;return x()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if((ue==null?void 0:ue.id)!==void 0){m.next=2;break}return m.abrupt("return",!1);case 2:return m.prev=2,b(!0),m.next=6,(0,F.Ds)(ue.id,C()({topic_gift_quiz_id:o},D));case 6:return se=m.sent,be(void 0),d==null||d(),m.abrupt("return",se.success);case 12:return m.prev=12,m.t0=m.catch(2),console.log(m.t0),m.abrupt("return",!1);case 16:return m.prev=16,b(!1),m.finish(16);case 19:case"end":return m.stop()}},O,null,[[2,12,16,19]])}));return function(O){return B.apply(this,arguments)}}(),[ue==null?void 0:ue.id,o]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(re.Z,{open:Ce,onClose:function(){return S(!1)},children:(0,e.jsx)(Ie,{onSubmit:Tr,competencyChallengeCategoryTreeProps:E})}),(0,e.jsx)(re.Z,{open:!!ue,onClose:function(){return be(void 0)},destroyOnClose:!0,children:(0,e.jsx)(Ie,{onSubmit:Pr,competencyChallengeCategoryTreeProps:E,values:ue})}),(0,e.jsx)($,{quiz_id:o,quizQuestions:Ee,visible:_r,onVisibleChange:Oe}),(0,e.jsx)(ee.Z,{search:!1,cardProps:{bodyStyle:{padding:0}},loading:g,headerTitle:_,toolbar:{settings:[]},toolBarRender:function(){return[(0,e.jsxs)(R.ZP,{icon:(0,e.jsx)(w.Z,{}),type:"primary",onClick:function(){return S(!0)},children:[" ",(0,e.jsx)(t.FormattedMessage,{id:"addNewQuestion",defaultMessage:"Add new question"})]},"add"),(0,e.jsx)(y.Z,{title:Er.formatMessage({id:"importQuestions"}),hideLabel:!0,showUploadList:!1,url:"/api/admin/gift-questions/import",name:"file",accept:".xlsx",data:{topic_gift_quiz_id:o},onChange:function(D){D.file.status==="done"&&D.file.response&&D.file.response.success&&(te.ZP.success(D.file.response.message),s==null||s()),D.file.response&&D.file.status==="error"&&(te.ZP.error(D.file.response.message),console.error(D.file.response))}},"import"),(0,e.jsxs)(R.ZP,{icon:(0,e.jsx)(H.Z,{}),type:"primary",onClick:function(){return Oe(!0)},children:[" ",(0,e.jsx)(t.FormattedMessage,{id:"exportQuestions"})]},"export")].concat(p()(h))},columns:[].concat(pr,p()(E?[gr]:[]),[{title:(0,e.jsx)(t.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),dataIndex:"address",valueType:"option",render:function(O,D){return[(0,e.jsx)(R.ZP,{size:"small",type:"primary",onClick:function(){be(D)},children:(0,e.jsx)(t.FormattedMessage,{id:"Questions.edit",defaultMessage:"Edit Question"})},"edit"),(0,e.jsx)(R.ZP,{loading:k,size:"small",danger:!0,onClick:function(){b(!0),(0,F.Km)(D.id).then(function(){i&&i()}).finally(function(){b(!1)})},children:(0,e.jsx)(t.FormattedMessage,{id:"Questions.delete",defaultMessage:"Delete Question"})},"delete")]}}]),rowKey:function(O){return O.id},pagination:!1,dataSource:Ee,components:{body:{wrapper:br,row:xr}}})]})}},89974:function(je,de,n){n.d(de,{b:function(){return W}});var ce=n(5574),p=n.n(ce),me=n(17572),x=n(67294),ve=n(80854),I=n(94116),G=n(7014),V=n(85893),Z=function ie(C,z,w){var H,ee=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;return(H=C.subcategories)!==null&&H!==void 0&&H.length?{title:C.name,value:C.id,disabled:ee!==w||z.includes(C.id),children:C.subcategories.map(function(K){return ie(K,z,w,ee+1)})}:{title:C.name,value:C.id,disabled:ee!==w||z.includes(C.id)}},W=function(C){var z,w,H=C.value,ee=C.onChange,K=C.type,re=K===void 0?"scale":K,R=C.disabledNodes,te=R===void 0?[]:R,ne=C.multiple,M=ne===void 0?!1:ne,ae=(0,x.useState)([]),t=p()(ae,2),y=t[0],P=t[1],F=(0,G.O)(),l=F.categoryDepths,L=F.competencyChallenge,fe=(0,x.useMemo)(function(){var $;return(($=L.data)===null||$===void 0?void 0:$.type)==="simple"?y.filter(function(ge){var X;return ge.id===((X=L.data)===null||X===void 0||(X=X.category)===null||X===void 0?void 0:X.id)}):y},[y,(z=L.data)===null||z===void 0?void 0:z.type,(w=L.data)===null||w===void 0||(w=w.category)===null||w===void 0?void 0:w.id]),e=(0,x.useMemo)(function(){return fe.map(function($){return Z($,te,l[re])})},[fe,te,re]);return(0,x.useEffect)(function(){(0,I.CL)().then(function($){$.success&&P($.data)})},[]),(0,V.jsx)(me.Z,{loading:y.length===0,showSearch:!0,multiple:M,value:H,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:(0,V.jsx)(ve.FormattedMessage,{id:"select",defaultMessage:"Please select"}),allowClear:!0,treeDefaultExpandAll:!0,onChange:ee,treeData:e,disabled:y.length===0})}},7014:function(je,de,n){n.d(de,{F:function(){return K},O:function(){return ee}});var ce=n(97857),p=n.n(ce),me=n(5574),x=n.n(me),ve=n(15009),I=n.n(ve),G=n(99289),V=n.n(G),Z=n(67294),W=n(80854),ie=n(21711),C=n(43564),z=n(85893),w={categoryDepths:{scale:2,question:1,role:0},competencyChallenge:{data:null,loading:!1},refreshData:function(){var re=V()(I()().mark(function te(){return I()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.abrupt("return",console.warn("CONTEXT INIT"));case 1:case"end":return M.stop()}},te)}));function R(){return re.apply(this,arguments)}return R}()},H=Z.createContext(w),ee=function(){return(0,Z.useContext)(H)},K=function(R){var te=R.children,ne=(0,Z.useState)(w.competencyChallenge),M=x()(ne,2),ae=M[0],t=M[1],y=(0,Z.useState)(w.categoryDepths),P=x()(y,2),F=P[0],l=P[1],L=(0,W.useParams)(),fe=L.id,e=Number(fe),$=(0,Z.useCallback)(V()(I()().mark(function X(){var T;return I()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!Number.isNaN(e)){f.next=2;break}return f.abrupt("return");case 2:return f.prev=2,t(function(N){return p()(p()({},N),{},{loading:!0})}),f.next=6,(0,ie.PE)(e);case 6:if(T=f.sent,T.success){f.next=10;break}return t(function(N){return p()(p()({},N),{},{error:T.errors})}),f.abrupt("return");case 10:t(function(N){return p()(p()({},N),{},{data:T.data})}),f.next=16;break;case 13:f.prev=13,f.t0=f.catch(2),t(function(N){return p()(p()({},N),{},{error:f.t0})});case 16:return f.prev=16,t(function(N){return p()(p()({},N),{},{loading:!1})}),f.finish(16);case 19:case"end":return f.stop()}},X,null,[[2,13,16,19]])})),[e]),ge=(0,Z.useCallback)(V()(I()().mark(function X(){var T,Q,f,N,j,ye,_e;return I()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.prev=0,U.next=3,(0,C.rH)();case 3:if(N=U.sent,N.success){U.next=6;break}return U.abrupt("return");case 6:j=Number((T=N.data)===null||T===void 0||(T=T.escolalms_competency_challenge)===null||T===void 0||(T=T.category)===null||T===void 0||(T=T.scale)===null||T===void 0||(T=T.depth)===null||T===void 0?void 0:T.value),ye=Number((Q=N.data)===null||Q===void 0||(Q=Q.escolalms_competency_challenge)===null||Q===void 0||(Q=Q.category)===null||Q===void 0||(Q=Q.question)===null||Q===void 0||(Q=Q.depth)===null||Q===void 0?void 0:Q.value),_e=Number((f=N.data)===null||f===void 0||(f=f.escolalms_competency_challenge)===null||f===void 0||(f=f.category)===null||f===void 0||(f=f.role)===null||f===void 0||(f=f.depth)===null||f===void 0?void 0:f.value),l({scale:Number.isNaN(j)?2:j,question:Number.isNaN(ye)?1:ye,role:Number.isNaN(_e)?0:_e}),U.next=15;break;case 12:U.prev=12,U.t0=U.catch(0),console.error(U.t0);case 15:case"end":return U.stop()}},X,null,[[0,12]])})),[]);return(0,Z.useEffect)(function(){$(),ge()},[$,ge]),(0,z.jsx)(H.Provider,{value:{categoryDepths:F,competencyChallenge:ae,refreshData:$},children:te})}},21711:function(je,de,n){n.d(de,{HC:function(){return ee},PE:function(){return W},Qd:function(){return re},U_:function(){return te},b3:function(){return V},dA:function(){return w},sm:function(){return M},v8:function(){return C}});var ce=n(15009),p=n.n(ce),me=n(97857),x=n.n(me),ve=n(99289),I=n.n(ve),G=n(80854);function V(t,y){return Z.apply(this,arguments)}function Z(){return Z=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges",x()({method:"GET",useCache:!1,params:y},P||{})));case 1:case"end":return l.stop()}},t)})),Z.apply(this,arguments)}function W(t,y){return ie.apply(this,arguments)}function ie(){return ie=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges/".concat(y),x()({method:"GET",useCache:!1},P||{})));case 1:case"end":return l.stop()}},t)})),ie.apply(this,arguments)}function C(t,y){return z.apply(this,arguments)}function z(){return z=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges",x()({method:"POST",headers:{"Content-Type":"application/json"},data:y},P||{})));case 1:case"end":return l.stop()}},t)})),z.apply(this,arguments)}function w(t,y,P){return H.apply(this,arguments)}function H(){return H=I()(p()().mark(function t(y,P,F){return p()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",(0,G.request)("/api/admin/competency-challenges/".concat(y),x()({method:"PUT",headers:{"Content-Type":"application/json"},data:P},F||{})));case 1:case"end":return L.stop()}},t)})),H.apply(this,arguments)}function ee(t,y){return K.apply(this,arguments)}function K(){return K=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges/".concat(y),x()({method:"DELETE"},P||{})));case 1:case"end":return l.stop()}},t)})),K.apply(this,arguments)}function re(t,y){return R.apply(this,arguments)}function R(){return R=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges/scales",x()({method:"POST",headers:{"Content-Type":"application/json"},data:y},P||{})));case 1:case"end":return l.stop()}},t)})),R.apply(this,arguments)}function te(t,y,P){return ne.apply(this,arguments)}function ne(){return ne=I()(p()().mark(function t(y,P,F){return p()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",(0,G.request)("/api/admin/competency-challenges/scales/".concat(y),x()({method:"PATCH",headers:{"Content-Type":"application/json"},data:P},F||{})));case 1:case"end":return L.stop()}},t)})),ne.apply(this,arguments)}function M(t,y){return ae.apply(this,arguments)}function ae(){return ae=I()(p()().mark(function t(y,P){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,G.request)("/api/admin/competency-challenges/scales/".concat(y),x()({method:"DELETE"},P||{})));case 1:case"end":return l.stop()}},t)})),ae.apply(this,arguments)}}}]);
