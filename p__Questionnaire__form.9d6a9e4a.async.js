"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7480,2803,8047],{78677:function(ye,te,t){var ae=t(67294),G=t(2759),k=function(){return k=Object.assign||function(X){for(var l,w=1,I=arguments.length;w<I;w++){l=arguments[w];for(var Y in l)Object.prototype.hasOwnProperty.call(l,Y)&&(X[Y]=l[Y])}return X},k.apply(this,arguments)},J=(0,ae.forwardRef)(function(X,l){return ae.createElement(G.P,k({},X,{chartType:"Column",ref:l}))});te.Z=J},58664:function(ye,te,t){t.d(te,{T:function(){return R}});var ae=t(19632),G=t.n(ae),k=t(5574),J=t.n(k),X=t(74656),l=t(74330),w=t(67294),I=t(51490),Y=t(99100),K=t(32283),je=t(80854),O=t(85893),fe=function(U){return U.map(function(_){return"name"in _?{id:Number(_.id),name:_.name}:{id:Number(_.id),name:_.title?_.title:""}})},R=function(U){var _=U.value,re=U.onChange,ne=U.multiple,ve=ne===void 0?!1:ne,be=U.defaultValue,ie=U.modelType,z=ie===void 0?"COURSE":ie,W=(0,w.useState)([]),oe=J()(W,2),ee=oe[0],m=oe[1],a=(0,w.useState)(!1),ge=J()(a,2),xe=ge[0],ue=ge[1],x=(0,w.useRef)(),Ce=(0,w.useCallback)(function(M){var A,$,Q,H;switch(z){case"COURSE":return(0,Y.N7)(M,{signal:x==null||(A=x.current)===null||A===void 0?void 0:A.signal});case"WEBINAR":return(0,K.i5)(M,{signal:x==null||($=x.current)===null||$===void 0?void 0:$.signal});case"CONSULTATIONS":return(0,I.sL)(M,{signal:x==null||(Q=x.current)===null||Q===void 0?void 0:Q.signal});default:return(0,Y.N7)(M,{signal:x==null||(H=x.current)===null||H===void 0?void 0:H.signal})}},[z,x]),he=(0,w.useCallback)(function(M){var A,$,Q,H;switch(z){case"COURSE":return(0,Y.XR)(Number(M),{signal:(A=x.current)===null||A===void 0?void 0:A.signal});case"WEBINAR":return(0,K.tz)(Number(M),{signal:($=x.current)===null||$===void 0?void 0:$.signal});case"CONSULTATIONS":return(0,I.hW)(Number(M),{signal:(Q=x.current)===null||Q===void 0?void 0:Q.signal});default:return(0,Y.XR)(Number(M),{signal:(H=x.current)===null||H===void 0?void 0:H.signal})}},[z,x]),le=(0,w.useCallback)(function(M){ue(!0),x.current&&x.current.abort(),x.current=new AbortController,Ce(M?{title:M}:{}).then(function(A){A.success&&m(fe(A.data)),ue(!1)}).catch(function(){return ue(!1)})},[z]),e=(0,w.useCallback)(function(M){le(M)},[le]);return(0,w.useEffect)(function(){return x.current=new AbortController,_&&he(Number(_)).then(function(M){M&&M.success&&m(function(A){return[].concat(G()(A),G()(fe([M.data])))})}),function(){x.current&&x.current.abort()}},[_,z]),(0,O.jsx)(X.default,{defaultValue:be,onFocus:function(){return le()},allowClear:!0,style:{width:"100%"},value:_,onChange:re,mode:ve?"multiple":void 0,showSearch:!0,onSearch:e,placeholder:(0,O.jsx)(je.FormattedMessage,{id:"select_content",defaultMessage:"select_content"}),optionFilterProp:"children",filterOption:function(A,$){if($&&$.children){var Q;return($==null||(Q=$.children)===null||Q===void 0?void 0:Q.toString().toLowerCase().indexOf(A.toLowerCase()))>=0}return!0},notFoundContent:xe?(0,O.jsx)(l.Z,{size:"small"}):null,optionLabelProp:"label",children:ee.map(function(M){return(0,O.jsx)(X.default.Option,{value:M.id,label:M.name,children:M.name},M.id)})})}},92008:function(ye,te,t){t.r(te),t.d(te,{QuestionareForm:function(){return Ze},default:function(){return ke}});var ae=t(19632),G=t.n(ae),k=t(9783),J=t.n(k),X=t(97857),l=t.n(X),w=t(15009),I=t.n(w),Y=t(99289),K=t.n(Y),je=t(5574),O=t.n(je),fe=t(58664),R=t(95020),q=t(78715),U=t(952),_=t(5966),re=t(52688),ne=t(64317),ve=t(31199),be=t(74453),ie=t(71471),z=t(75842),W=t(2453),oe=t(74330),ee=t(14726),m=t(67294),a=t(80854),ge=t(13769),xe=t.n(ge),ue=t(62235),x=t(44167),Ce=t(45919),he=t(16894),le=t(60943),e=t(85893),M=["type"],A=function(P){var i=P.record,Z=z.Z.useForm(),S=O()(Z,1),F=S[0],d=(0,a.useIntl)(),B=(0,m.useMemo)(function(){return{onValuesChange:function(j,c){var C=c,v=C.visible_on_front;(0,R.lt)(i.id,{visible_on_front:v}).then(function(L){W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"question_answer_visibility_changed",defaultMessage:L.message}))}).catch(function(){return W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}))})},submitter:{render:function(){return null}}}},[]);return(0,e.jsx)(U.ZP,l()(l()({form:F},B),{},{children:(0,e.jsx)(re.Z,{name:"visible_on_front",initialValue:i.visible_on_front,checkedChildren:d.formatMessage({id:"visible",defaultMessage:"visible"}),unCheckedChildren:d.formatMessage({id:"hidden",defaultMessage:"hidden"})})}))},$=function(P){var i=P.questionnaireId,Z=P.questions,S=(0,m.useMemo)(function(){return Z&&Z.reduce(function(E,j){return l()(l()({},E),{},J()({},j.id,j.title))},{})},[Z]),F=[{title:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),dataIndex:"question_id",hideInSearch:!1,valueEnum:S,valueType:"select"}],d=(0,a.useIntl)(),B=[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"updated_at",defaultMessage:"updated_at"}),dataIndex:"updated_at",hideInSearch:!0,render:function(j,c){return c.updated_at?new Date(c.updated_at).toLocaleString():"-"},sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"updated_at",defaultMessage:"updated_at"}),dataIndex:"date",hideInSearch:!1,hideInForm:!0,hideInTable:!0,valueType:"date"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"question_title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"note",defaultMessage:"note"}),dataIndex:"note",hideInSearch:!0,sorter:!0,render:function(j,c){var C,v;return c.note&&((C=c.note)===null||C===void 0?void 0:C.length)>64?((v=c.note)===null||v===void 0?void 0:v.slice(0,64))+"...":c.note}},{title:(0,e.jsx)(a.FormattedMessage,{id:"user",defaultMessage:"user"}),dataIndex:"user_id",hideInSearch:!1,render:function(j,c){var C,v;return(0,e.jsxs)("div",{children:[(0,e.jsx)(ue.Z,{type:"App\\Models\\User",type_id:c.user_id}),(0,e.jsx)("p",{className:"list-paragraph",children:(C=c.user)===null||C===void 0?void 0:C.name}),(0,e.jsx)("p",{className:"list-paragraph",children:(v=c.user)===null||v===void 0?void 0:v.email})]})},renderFormItem:function(j,c,C){var v=c.type,L=xe()(c,M);if(v==="form")return null;var y=C.getFieldValue("state");return(0,e.jsx)(x.Z,l()(l()({},L),{},{state:{type:y}}))}},{title:(0,e.jsx)(a.FormattedMessage,{id:"sum_rate",defaultMessage:"sum_rate"}),dataIndex:"rate",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"}),dataIndex:"visible_on_front",hideInSearch:!0,sorter:!1,render:function(j,c){return(0,e.jsx)(A,{record:c})}}];return(0,e.jsx)(he.ZP,{headerTitle:d.formatMessage({id:"answers",defaultMessage:"answers"}),search:{layout:"vertical"},rowKey:"id",request:function(j,c){var C=j.pageSize,v=j.current,L=j.question_id,y=j.user_id,r=j.date,b=c&&Object.entries(c)[0];return(0,R.l)(i,{per_page:C,page:v,question_id:L,user_id:y,updated_at:r?(0,le.WU)(new Date(r),Ce.Cu):void 0,order_by:b&&b[0],order:b?b[1]==="ascend"?"ASC":"DESC":void 0}).then(function(u){return u.success?{data:u.data,success:!0}:[]})},columns:[].concat(B,F)})},Q=$,H=t(66419),$e=t(51042),we=t(47389),Le=t(82061),Se=t(83062),Ve=t(86738),pe=t(31472),Ue=t(37476),Qe=function(P){var i=(0,a.useIntl)(),Z=P.visible,S=P.onVisibleChange,F=P.onFinish,d=P.id,B=P.questionsList,E=z.Z.useForm(),j=O()(E,1),c=j[0];(0,m.useEffect)(function(){typeof d=="number"&&d>0?(0,R.a5)(d).then(function(v){v.success&&c.setFieldsValue(v.data)}):c.resetFields()},[d,c]);var C=Object.values(pe.Yo).map(function(v){return{name:v,label:i.formatMessage({id:"QuestionType.".concat(v)}),value:v,disabled:v===pe.Yo.Review&&B.findIndex(function(L){var y=L.type;return y===pe.Yo.Review})!==-1}});return(0,e.jsxs)(Ue.Y,{form:c,title:i.formatMessage({id:typeof d=="number"&&d>0?"question_edit":"question_add",defaultMessage:typeof d=="number"&&d>0?"question_edit":"question_add"}),width:"400px",visible:Z,onVisibleChange:S,onFinish:F,children:[(0,e.jsx)(ne.Z,{name:"type",options:C,label:(0,e.jsx)(a.FormattedMessage,{id:"type"}),initialValue:pe.Yo.Rate}),(0,e.jsx)(_.Z,{width:"lg",name:"title",label:(0,e.jsx)(a.FormattedMessage,{id:"title"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"title"}),placeholder:i.formatMessage({id:"title"})}),(0,e.jsx)(_.Z,{width:"lg",name:"description",label:(0,e.jsx)(a.FormattedMessage,{id:"description"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"description"}),placeholder:i.formatMessage({id:"description"})}),(0,e.jsx)(ve.Z,{width:"lg",name:"position",label:(0,e.jsx)(a.FormattedMessage,{id:"position"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"position"}),placeholder:i.formatMessage({id:"position",defaultMessage:"position"}),min:0,max:9999,fieldProps:{step:1}}),(0,e.jsx)(re.Z,{initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})}),(0,e.jsx)(re.Z,{initialValue:!0,name:"public_answers",label:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"})})]})},We=Qe,Be=function(P){var i=P.questionnaireId,Z=P.questions,S=P.fetchData,F=(0,a.useIntl)(),d=(0,m.useState)(!1),B=O()(d,2),E=B[0],j=B[1],c=(0,m.useMemo)(function(){return[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!1,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",hideInSearch:!0,sorter:!0,renderText:function(r,b){return F.formatMessage({id:"QuestionType.".concat(b.type)})}},{title:(0,e.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"description"}),dataIndex:"description",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"position",defaultMessage:"position"}),dataIndex:"position",hideInSearch:!0,sorter:!0}]},[]),C=(0,m.useRef)(),v=function(){var y=K()(I()().mark(function r(b,u){var T;return I()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return T=W.ZP.loading(F.formatMessage({id:"loading"})),g.prev=1,g.next=4,u&&u!==-1?(0,R.WW)(u,l()(l()({},b),{},{questionnaire_id:i})):(0,R.xL)(l()(l()({},b),{},{questionnaire_id:i}));case 4:return T(),S(),W.ZP.success(F.formatMessage({id:"success"})),g.abrupt("return",!0);case 10:return g.prev=10,g.t0=g.catch(1),T(),W.ZP.error(F.formatMessage({id:"error"})),g.abrupt("return",!1);case 15:case"end":return g.stop()}},r,null,[[1,10]])}));return function(b,u){return y.apply(this,arguments)}}(),L=(0,m.useCallback)(function(){var y=K()(I()().mark(function r(b){var u;return I()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return u=W.ZP.loading(F.formatMessage({id:"loading"})),h.prev=1,h.next=4,(0,R.Km)(b);case 4:return u(),S(),h.abrupt("return",!0);case 9:return h.prev=9,h.t0=h.catch(1),u(),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"})),h.abrupt("return",!1);case 14:case"end":return h.stop()}},r,null,[[1,9]])}));return function(r){return y.apply(this,arguments)}}(),[C,F]);return(0,m.useEffect)(function(){var y;(y=C.current)===null||y===void 0||y.reload()},[Z,S]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.ZP,{headerTitle:F.formatMessage({id:"question_list",defaultMessage:"question_list"}),actionRef:C,rowKey:"id",search:{layout:"vertical"},toolBarRender:function(){return[(0,e.jsxs)(ee.ZP,{type:"primary",onClick:function(){j(-1)},children:[(0,e.jsx)($e.Z,{})," ",(0,e.jsx)(a.FormattedMessage,{id:"pages.searchTable.new",defaultMessage:"\u65B0\u5EFA"})]},"primary")]},columns:[].concat(G()(c),[{title:(0,e.jsx)(a.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(r,b){return[(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)(we.Z,{}),onClick:function(){return b.id&&j(b.id)}})},"edit"),(0,e.jsx)(Ve.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return b.id&&L(b.id)},okText:(0,e.jsx)(a.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(a.FormattedMessage,{id:"no"}),children:(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)(Le.Z,{}),danger:!0})})},"delete")]}}]),request:function(r,b){var u=r.title,T=b&&Object.entries(b)[0];return new Promise(function(h){var g=Z?G()(Z):[];u&&(g=g.filter(function(de){return de.title.toLowerCase().includes(u.toLowerCase())})),T&&(g=(0,H.Pf)(g,T[0],T[1]!=="ascend")),h({data:g,success:!0,total:g.length})})}}),(0,e.jsx)(We,{id:E,visible:Number.isInteger(E),onVisibleChange:function(r){return r===!1&&j(!1)},questionsList:Z!=null?Z:[],onFinish:function(){var y=K()(I()().mark(function r(b){var u;return I()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,v(b,Number(E));case 2:u=h.sent,u&&j(!1);case 4:case"end":return h.stop()}},r)}));return function(r){return y.apply(this,arguments)}}()})]})},Ke=Be,Pe=t(74656),qe=t(78677),ze=t(38925),Ge={isGroup:!0,xField:"label",yField:"value",seriesField:"type",marginRatio:0},Ye=function(P){var i=P.state,Z=(0,a.useIntl)();return(0,e.jsxs)(q.ZP,{headerBordered:!0,style:{height:"500px"},children:[i.mode==="loading"&&(0,e.jsx)(oe.Z,{}),i.mode==="loaded"&&i.value.length>0?(0,e.jsx)(qe.Z,l()(l()({},Ge),{},{data:[].concat(G()(i.value),G()(i.value)).map(function(S,F){return{label:S.title,value:F>i.value.length-1?S.count_answers:Number(S.avg_rate),type:F>i.value.length-1?Z.formatMessage({id:"answers"}):"Rating"}})})):i.mode!=="loading"&&(0,e.jsx)("p",{children:(0,e.jsx)(a.FormattedMessage,{id:"no_data",defaultMessage:"no_data"})}),i.mode==="error"&&(0,e.jsx)(ze.Z,{message:i.error.data.message,type:"error"})]})},Xe=Ye,He=function(P){var i=P.questionnaireId,Z=P.models,S=(0,m.useState)(""),F=O()(S,2),d=F[0],B=F[1],E=(0,m.useState)({mode:"init"}),j=O()(E,2),c=j[0],C=j[1],v=(0,m.useState)(!1),L=O()(v,2),y=L[0],r=L[1],b=(0,m.useCallback)(K()(I()().mark(function u(){var T,h,g;return I()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return T=d.split("/"),r(!0),o.prev=2,o.next=5,(0,R.Hp)(T[2],Number(T[1]),Number(i));case 5:h=o.sent,h instanceof Blob&&(g=document.createElement("a"),g.href=window.URL.createObjectURL(h),g.download="raport_questionaire_".concat(T[2],"_").concat(i,".xlsx"),document.body.appendChild(g),g.click(),document.body.removeChild(g)),o.next=12;break;case 9:o.prev=9,o.t0=o.catch(2),C({mode:"error",error:o.t0});case 12:return o.prev=12,r(!1),o.finish(12);case 15:case"end":return o.stop()}},u,null,[[2,9,12,15]])})),[d,i]);return(0,m.useEffect)(function(){C({mode:"loading"});var u=function(){var T=K()(I()().mark(function h(){var g;return I()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,!d){o.next=7;break}return o.next=4,(0,R.Cq)(i,Number(d.split("/")[0]),Number(d.split("/")[1]));case 4:o.t0=o.sent,o.next=10;break;case 7:return o.next=9,(0,R.Cq)(i);case 9:o.t0=o.sent;case 10:g=o.t0,g.success&&C({mode:"loaded",value:g.data}),o.next=17;break;case 14:o.prev=14,o.t1=o.catch(0),C({mode:"error",error:o.t1});case 17:case"end":return o.stop()}},h,null,[[0,14]])}));return function(){return T.apply(this,arguments)}}();u()},[i,Z,d]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ie.Z.Title,{level:5,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.raports.filter",defaultMessage:"questionnaire.raports.filter"})}),(0,e.jsx)(Pe.default,{allowClear:!0,style:{minWidth:"400px"},onChange:function(T){return B(T)},children:Z.map(function(u){return(0,e.jsxs)(Pe.default.Option,{value:"".concat(u.model_type_id,"/").concat(u.model_id,"/").concat(u.model_type_title),children:[(0,e.jsx)(a.FormattedMessage,{id:u.model_type_title,defaultMessage:u.model_type_title})," ","- ",u.model_title]},u.id)})}),d&&(0,e.jsxs)("div",{children:[(0,e.jsx)("br",{}),(0,e.jsx)(ee.ZP,{onClick:b,loading:y,children:(0,e.jsx)(a.FormattedMessage,{id:"download"})})]}),(0,e.jsx)("hr",{}),(0,e.jsx)(q.ZP,{split:"vertical",children:(0,e.jsx)(q.ZP,{colSpan:24,layout:"center",children:(0,e.jsx)(Xe,{state:c})})})]})},Je=He,Ie=ie.Z.Title,Ze=function(){var P,i,Z=(0,a.useParams)(),S=Z.questionnaireId,F=(0,a.useIntl)(),d=S==="new",B=z.Z.useForm(),E=O()(B,1),j=E[0],c=z.Z.useForm(),C=O()(c,1),v=C[0],L=(0,m.useState)(),y=O()(L,2),r=y[0],b=y[1],u=(0,m.useState)("questionnaire"),T=O()(u,2),h=T[0],g=T[1],de=(0,m.useState)(),o=O()(de,2),Te=o[0],et=o[1],tt=(0,m.useState)({}),Ee=O()(tt,2),ce=Ee[0],Oe=Ee[1],at=(0,m.useState)({}),Ae=O()(at,2),De=Ae[0],rt=Ae[1],Ne=(0,m.useCallback)(K()(I()().mark(function s(){var n;return I()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.xR)();case 2:n=f.sent,n.success&&et(n.data);case 4:case"end":return f.stop()}},s)})),[]),Re=(0,m.useCallback)(function(s,n){return s.reduce(function(p,f){return(p[f[n]]=p[f[n]]||[]).push(f.model_id),p},{})},[]),me=(0,m.useCallback)(K()(I()().mark(function s(){var n;return I()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.Iu)(Number(S));case 2:n=f.sent,n.success&&(b(l()({},n.data)),n.data.models&&Oe(Re(n.data.models,"model_type_id")));case 4:case"end":return f.stop()}},s)})),[S,Re]);(0,m.useEffect)(function(){if(Ne(),d){b({title:"new"});return}me()},[S,me,Ne,d]);var st=(0,m.useCallback)(function(s,n){Oe(function(p){return l()(l()({},p),{},J()({},n,s))})},[]),Fe=(0,m.useCallback)(function(s){var n=[];return Object.keys(s).map(function(p){n.push.apply(n,G()(s[p].map(function(f){return{model_id:Number(f),model_type_id:Number(p),target_group:v.getFieldValue("models.".concat(Number(p),".").concat(Number(f),".target_group")),display_frequency_minutes:v.getFieldValue("models.".concat(Number(p),".").concat(Number(f),".display_frequency_minutes"))}})))}),n},[v]),nt=(0,m.useMemo)(function(){return{onFinish:function(){var s=K()(I()().mark(function p(f){var V,D;return I()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(N.prev=0,!d){N.next=9;break}return N.next=4,(0,R.wW)(l()(l()({},f),{},{models:Fe(ce)}));case 4:V=N.sent,V.success&&a.history.push("/other/questionnaire/".concat(V.data.id)),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"})),N.next=14;break;case 9:return N.next=11,(0,R.xN)(Number(r==null?void 0:r.id),l()(l()({},f),{},{models:Fe(ce)}));case 11:D=N.sent,D.success&&me(),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"}));case 14:N.next=19;break;case 16:N.prev=16,N.t0=N.catch(0),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}));case 19:case"end":return N.stop()}},p,null,[[0,16]])}));function n(p){return s.apply(this,arguments)}return n}(),initialValues:r}},[r,ce,me,Fe,d]),_e=(0,m.useCallback)(function(s){var n;return r&&((n=r.models)===null||n===void 0?void 0:n.filter(function(p){return p.model_type_title===s}))},[r]),it=(0,m.useCallback)(function(s,n,p,f){var V;return((V=_e(n))===null||V===void 0||(V=V.find(function(D){return D.model_id===Number(s)}))===null||V===void 0?void 0:V.model_title)||De[f][p]},[_e,De]),ot=(0,m.useMemo)(function(){var s;return r==null||(s=r.models)===null||s===void 0?void 0:s.reduce(function(n,p){var f="models.".concat(p.model_type_id,".").concat(p.model_id);return n["".concat(f,".target_group")]=p.target_group,n["".concat(f,".display_frequency_minutes")]=p.display_frequency_minutes,n},{})},[r==null?void 0:r.models]);if(!r)return(0,e.jsx)(oe.Z,{});var ut=[{label:(0,e.jsx)(a.FormattedMessage,{id:"author"}),value:"author"},{label:(0,e.jsx)(a.FormattedMessage,{id:"users"}),value:"user"}];return(0,e.jsx)(be._z,{title:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(a.FormattedMessage,{id:r!=null&&r.title?"questionnaire":"new_questionnaire"})}),header:{breadcrumb:{routes:[{path:"other/questionnaire",breadcrumbName:F.formatMessage({id:"menu.Other activities.Questionnaire"})},{path:String(S),breadcrumbName:F.formatMessage({id:"form"})},{path:"/",breadcrumbName:String(r==null?void 0:r.title)}]}},children:(0,e.jsxs)(q.ZP,{tabs:{type:"card",defaultActiveKey:"questionnaire",activeKey:h,onChange:function(n){return g(n)}},children:[(0,e.jsxs)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"}),children:[(0,e.jsx)(Ie,{level:3,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"})}),(0,e.jsx)(U.ZP,l()(l()({},nt),{},{form:j,children:(0,e.jsxs)(U.ZP.Group,{children:[(0,e.jsx)(_.Z,{label:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),rules:[{required:!0}],width:"md",name:"title"}),(0,e.jsx)(re.Z,{width:"md",initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})})]})}))]},"questionnaire"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),disabled:d,children:(0,e.jsx)(Ke,{questionnaireId:Number(S),questions:r.questions||[],fetchData:me})},"questions"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"answers",defaultMessage:"answers"}),disabled:d,children:(0,e.jsx)(Q,{questionnaireId:Number(S),questions:r.questions||[]})},"answers"),Te&&Te.map(function(s){var n,p,f,V;return(0,e.jsxs)(q.ZP.TabPane,{tab:"".concat(F.formatMessage({id:"assign"})," ").concat(F.formatMessage({id:"to"})," ").concat(F.formatMessage({id:(n=s.title)===null||n===void 0?void 0:n.replace(s.title.charAt(0),s.title.charAt(0).toUpperCase())})),disabled:d,children:[(0,e.jsx)(fe.T,{defaultValue:((p=r.models)===null||p===void 0?void 0:p.filter(function(D){return D.model_type_title===s.title}).map(function(D){return{value:D.model_id,label:D.model_title}}))||[],multiple:!0,onChange:function(Me,N){return[st(Me,s.id),rt(function(lt){return l()(l()({},lt),{},J()({},s.id,N.map(function(dt){return dt.label})))})]},modelType:(f=s.title)===null||f===void 0?void 0:f.toUpperCase()}),(0,e.jsx)(U.ZP,{form:v,submitter:!1,initialValues:ot,style:{marginTop:"20px"},children:ce[s.id]&&((V=ce[s.id])===null||V===void 0?void 0:V.map(function(D,Me){return(0,e.jsxs)("div",{children:[(0,e.jsx)(Ie,{level:5,children:it(Number(D),s.title,Me,s.id)}),(0,e.jsxs)(U.ZP.Group,{children:[(0,e.jsx)(ne.Z,{width:"md",name:"models.".concat(s.id,".").concat(D,".target_group"),label:(0,e.jsx)(a.FormattedMessage,{id:"target_group",defaultMessage:"target_group"}),initialValue:"user",options:ut}),(0,e.jsx)(ve.Z,{width:"md",name:"models.".concat(s.id,".").concat(D,".display_frequency_minutes"),label:(0,e.jsx)(a.FormattedMessage,{id:"display_frequency_minutes",defaultMessage:"display_frequency_minutes"})})]})]},String(D))}))}),(0,e.jsx)(ee.ZP,{className:"submit-btn",type:"primary",onClick:function(){return j.submit()},children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.submit",defaultMessage:"questionnaire.submit"})})]},String(s.id))}),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"menu.reports",defaultMessage:"menu.reports"}),disabled:d||((P=r.models)===null||P===void 0?void 0:P.length)===0,children:(r==null?void 0:r.models)&&(r==null||(i=r.models)===null||i===void 0?void 0:i.length)>0&&(0,e.jsx)(Je,{questionnaireId:Number(S),models:r.models})},"raport")]})})},ke=Ze}}]);
