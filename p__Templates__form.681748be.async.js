(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{BOG6:function(q,x,t){"use strict";t.r(x);var S=t("DYRE"),P=t("zeV3"),_=t("tU7J"),j=t("wFql"),D=t("+BJd"),J=t("mr32"),R=t("/zsF"),G=t("PArb"),z=t("T2oS"),Q=t("W9HT"),Y=t("miYZ"),Z=t("tsqr"),w=t("9og8"),$=t("tJVT"),I=t("oBTY"),L=t("jrin"),v=t("k1fw"),X=t("WmNS"),h=t.n(X),a=t("q1tI"),r=t.n(a),u=t("VMEa"),p=t("Qurx"),s=t("yj/a"),K=t("tneF"),se=t("nhC9"),N=t("rWUb"),le=t("tMyG"),xe=t("fOrg"),ee=t("+KLJ"),Te=t("+L6B"),ce=t("2/Rp"),o=t("9kvl"),e=t("nKUr"),ie=function(d){var l=d.disabled,n=l===void 0?!1:l,f=d.id,U=Object(a.useState)({state:"ready"}),V=Object($.a)(U,2),b=V[0],c=V[1],T=Object(a.useCallback)(function(){c({state:"loading"}),Object(N.c)(f).then(function(i){i.success?i.data.sent&&i.data.to?c({state:"loaded",data:i.data,message:"email sent to ".concat(i.data.to)}):i.data.url?c({state:"loaded",data:i.data,message:Object(e.jsxs)(r.a.Fragment,{children:["Download"," ",Object(e.jsx)("a",{target:"_blank",href:i.data.url,children:i.data.filename})]})}):c({state:"loaded",data:i.data,message:i.message}):c({state:"error",error:i.message})}).catch(function(){c({state:"error",error:"error"})})},[f]);return Object(e.jsxs)(r.a.Fragment,{children:[Object(e.jsx)(ce.a,{type:"primary",loading:b.state==="loading",disabled:n,onClick:T,children:Object(e.jsx)(o.a,{id:"preview"})}),b.state==="loaded"&&Object(e.jsx)(ee.a,{message:b.message,type:"success",closable:!0,onClose:function(){return c({state:"ready"})}}),b.state==="error"&&Object(e.jsx)(ee.a,{message:b.error,type:"error",closable:!0,onClose:function(){return c({state:"ready"})}})]})},ue=ie,oe=t("Ty5D"),de=t("BiO0"),Ee=t("JAl+"),me=function(d){var l=d.name,n=d.field,f=Object(a.useCallback)(function(b){if(b.length)return Object(e.jsx)(P.b,{children:Object(e.jsxs)(j.a,{children:[Object(e.jsx)(o.a,{id:"templates.required_variables"}),":"," ",b.map(function(c){return Object(e.jsx)(J.a,{color:"red",children:c},c)})]})})},[n,l]),U=Object(a.useCallback)(function(b,c){return b&&c.every(function(T){return b.includes(T)})?Promise.resolve():Promise.reject(new Error("No required variable  used"))},[n,l]),V=Object(a.useCallback)(function(){switch(n.type){case"text":case"url":return Object(e.jsxs)(r.a.Fragment,{children:[Object(e.jsx)(p.a,{shouldUpdate:!0,width:"lg",name:l,label:Object(e.jsx)(o.a,{id:l}),rules:[{required:n.required,message:Object(e.jsx)(o.a,{id:"templates.this_required"})},{validator:function(){var b=Object(w.a)(h.a.mark(function T(i,A){return h.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",U(A,n.required_variables));case 1:case"end":return g.stop()}},T)}));function c(T,i){return b.apply(this,arguments)}return c}()}]}),f(n.required_variables)]});case"html":return Object(e.jsxs)(r.a.Fragment,{children:[Object(e.jsxs)("p",{children:[Object(e.jsx)(o.a,{id:"templates.to_create_template"})," ",Object(e.jsx)("a",{target:"_blank",href:"https://mjml.io/try-it-live",children:"https://mjml.io/try-it-live"})]}),Object(e.jsx)(de.a,{shouldUpdate:!0,width:"lg",label:Object(e.jsx)(o.a,{id:l}),name:l,tooltip:Object(e.jsx)(o.a,{id:"templates.mjml_tooltip"}),rules:[{required:n.required,message:Object(e.jsx)(o.a,{id:"templates.this_required"})},{validator:function(){var b=Object(w.a)(h.a.mark(function T(i,A){return h.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",U(A,n.required_variables));case 1:case"end":return g.stop()}},T)}));function c(T,i){return b.apply(this,arguments)}return c}()}]}),f(n.required_variables)]});default:return}},[n,l]);return Object(e.jsx)(r.a.Fragment,{children:V()})},je=me,be=function(d){return d?Object.keys(d).reduce(function(l,n){return Object(v.a)(Object(v.a)({},l),{},Object(L.a)({},n,n))},{}):{}},fe=function(d){return Object.entries(d).map(function(l){return{key:l[0],content:l[1]}})},te=function(d){return Object.assign.apply(Object,[{}].concat(Object(I.a)(d)))},Oe=function(d){var l=["name","event","default"];return Object.keys(d).filter(function(n){return!l.includes(n)}).reduce(function(n,f){return n[f]=d[f],n},{})},ae={email:"EscolaLms\\TemplatesEmail\\Core\\EmailChannel"},Ce=x.default=function(){var B=Object(o.i)(),d=Object(oe.g)(),l=d.template,n=d.id,f=n==="new",U=Object(a.useState)(!1),V=Object($.a)(U,2),b=V[0],c=V[1],T=u.b.useForm(),i=Object($.a)(T,1),A=i[0],k=Object(a.useState)(),g=Object($.a)(k,2),M=g[0],pe=g[1],ve=Object(a.useState)(void 0),re=Object($.a)(ve,2),E=re[0],he=re[1];Object(a.useEffect)(function(){Object(N.g)().then(function(O){pe(O.success?O.data:{})})},[]),Object(a.useEffect)(function(){var O=A.getFieldsValue(),m=E&&Object.keys(E.sections).map(function(C){return Object(L.a)({},C,E.sections[C].default_content)});m&&f&&A.setFieldsValue(Object(v.a)(Object(v.a)({},O),te(m)))},[E]);var ne=Object(a.useCallback)(function(O){if(O&&l){var m=M&&M[O][ae[l]];he(m)}},[M,n]),ge=Object(a.useCallback)(Object(w.a)(h.a.mark(function O(){var m,C,F;return h.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,Object(N.d)(Number(n));case 2:m=W.sent,m.success&&(C=m.data.sections&&m.data.sections.map(function(y){return Object(L.a)({},y.key,y.content)}),F=C&&te(C),A.setFieldsValue(Object(v.a)(Object(v.a)({},m.data),F)),ne(String(m.data.event)),c(!0));case 4:case"end":return W.stop()}},O)})),[n,M]),ye=Object(a.useCallback)(function(){var O=Object(w.a)(h.a.mark(function m(C){var F,H;return h.a.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(H=Object(v.a)(Object(v.a)({},C),{},{channel:ae[l],sections:fe(Oe(C))}),!f){y.next=8;break}return y.next=4,Object(N.a)(H);case 4:F=y.sent,F.success&&o.d.push("/templates/".concat(F.data.id)),y.next=11;break;case 8:return y.next=10,Object(N.f)(Number(n),H);case 10:F=y.sent;case 11:c(!0),Z.default.success(F.message);case 13:case"end":return y.stop()}},m)}));return function(m){return O.apply(this,arguments)}}(),[M,n]);return Object(a.useEffect)(function(){f||ge()},[n,M]),Object(e.jsx)(le.a,{title:f?Object(e.jsx)(o.a,{id:"new_template"}):Object(e.jsx)(o.a,{id:"new_template"}),children:Object(e.jsx)(se.a,{size:"small",children:Object(e.jsxs)(u.b,{initialValues:{},onFinish:ye,form:A,onValuesChange:function(){var m=A.getFieldsValue();ne(m.event),c(!1)},children:[Object(e.jsxs)(u.b.Group,{children:[Object(e.jsx)(p.a,{width:"sm",name:"name",label:Object(e.jsx)(o.a,{id:"name"}),placeholder:B.formatMessage({id:"name"}),rules:[{required:!0,message:Object(e.jsx)(o.a,{id:"select"})}]}),Object(e.jsx)(s.a,{name:"event",width:"lg",label:Object(e.jsx)(o.a,{id:"event"}),valueEnum:M?be(M):{},placeholder:B.formatMessage({id:"event"}),rules:[{required:!0,message:Object(e.jsx)(o.a,{id:"select"})}]}),Object(e.jsx)(u.b.Item,{label:Object(e.jsx)(o.a,{id:"templates.set_as_default_template"}),children:Object(e.jsx)(K.a,{name:"default"})}),!f&&Object(e.jsx)(u.b.Item,{label:Object(e.jsx)(o.a,{id:"preview"}),children:Object(e.jsx)(ue,{disabled:!b,id:Number(l)})})]}),!E&&!f?Object(e.jsx)(Q.a,{}):E&&E.sections&&Object.keys(E.sections).map(function(O,m){var C=E.sections&&E.sections[O];return Object(e.jsxs)(r.a.Fragment,{children:[m===0&&Object(e.jsxs)(r.a.Fragment,{children:[Object(e.jsx)(G.a,{children:Object(e.jsx)(o.a,{id:"templates.tokens"})}),Object(e.jsx)(P.b,{children:Object(e.jsx)(j.a,{children:E.variables.map(function(F){return Object(e.jsx)(J.a,{color:"orange",children:F},F)})})})]}),Object(e.jsx)(G.a,{}),Object(e.jsx)(je,{name:O,field:C})]})}),Object(e.jsx)(G.a,{})]})})})}},"JAl+":function(q,x,t){},rWUb:function(q,x,t){"use strict";t.d(x,"e",function(){return J}),t.d(x,"d",function(){return G}),t.d(x,"a",function(){return Q}),t.d(x,"f",function(){return Z}),t.d(x,"b",function(){return $}),t.d(x,"g",function(){return L}),t.d(x,"c",function(){return X});var S=t("k1fw"),P=t("9og8"),_=t("WmNS"),j=t.n(_),D=t("9kvl");function J(a,r){return R.apply(this,arguments)}function R(){return R=Object(P.a)(j.a.mark(function a(r,u){return j.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(D.f)("/api/admin/templates",Object(S.a)({method:"GET",useCache:!1,params:Object(S.a)(Object(S.a)({},r),{},{per_page:r.pageSize&&r.pageSize,page:r.current&&r.current})},u||{})));case 1:case"end":return s.stop()}},a)})),R.apply(this,arguments)}function G(a,r){return z.apply(this,arguments)}function z(){return z=Object(P.a)(j.a.mark(function a(r,u){return j.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(D.f)("/api/admin/templates/".concat(r),Object(S.a)({method:"GET"},u||{})));case 1:case"end":return s.stop()}},a)})),z.apply(this,arguments)}function Q(a,r){return Y.apply(this,arguments)}function Y(){return Y=Object(P.a)(j.a.mark(function a(r,u){return j.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(D.f)("/api/admin/templates",Object(S.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},u||{})));case 1:case"end":return s.stop()}},a)})),Y.apply(this,arguments)}function Z(a,r,u){return w.apply(this,arguments)}function w(){return w=Object(P.a)(j.a.mark(function a(r,u,p){return j.a.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.abrupt("return",Object(D.f)("/api/admin/templates/".concat(r),Object(S.a)({method:"PATCH",headers:{"Content-Type":"application/json"},data:u},p||{})));case 1:case"end":return K.stop()}},a)})),w.apply(this,arguments)}function $(a,r){return I.apply(this,arguments)}function I(){return I=Object(P.a)(j.a.mark(function a(r,u){return j.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(D.f)("/api/admin/templates/".concat(r),Object(S.a)({method:"DELETE",headers:{"Content-Type":"application/json"}},u||{})));case 1:case"end":return s.stop()}},a)})),I.apply(this,arguments)}function L(a){return v.apply(this,arguments)}function v(){return v=Object(P.a)(j.a.mark(function a(r){return j.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",Object(D.f)("/api/admin/templates/variables",Object(S.a)({method:"GET"},r||{})));case 1:case"end":return p.stop()}},a)})),v.apply(this,arguments)}function X(a,r){return h.apply(this,arguments)}function h(){return h=Object(P.a)(j.a.mark(function a(r,u){return j.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(D.f)("/api/admin/templates/".concat(r,"/preview"),Object(S.a)({method:"GET"},u||{})));case 1:case"end":return s.stop()}},a)})),h.apply(this,arguments)}}}]);
