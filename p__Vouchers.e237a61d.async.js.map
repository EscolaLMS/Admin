{"version":3,"sources":["webpack:///./src/pages/Vouchers/index.tsx","webpack:///./src/services/escola-lms/vouchers.ts"],"names":["TableColumns","title","dataIndex","hideInSearch","sorter","width","hideInForm","hideInTable","valueType","fieldProps","allowEmpty","render","_","record","max_cart_price","roundTo","min_cart_price","active_from","format","Date","DAY_FORMAT","active_to","Vouchers","actionRef","useRef","useState","loading","setLoading","intl","useIntl","handleRemove","useCallback","id","hide","deleteVoucher","then","response","success","message","current","reload","error","formatMessage","defaultMessage","layout","sort","pageSize","name","code","dateRange","DATETIME_FORMAT","undefined","vouchers","per_page","page","createTableOrderObject","data","total","meta","params","options","request","method","useCache","body","headers"],"mappings":"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","file":"p__Vouchers.e237a61d.async.js","sourcesContent":["import React, { useCallback, useRef, useState } from 'react';\nimport { useIntl, FormattedMessage, Link } from 'umi';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { PageContainer } from '@ant-design/pro-layout';\nimport { format } from 'date-fns';\nimport { PlusOutlined, DeleteOutlined, EditOutlined } from '@ant-design/icons';\nimport { Button, Tooltip, Popconfirm, message } from 'antd';\n\nimport { deleteVoucher } from '@/services/escola-lms/vouchers';\n\nimport { vouchers } from '@/services/escola-lms/vouchers';\nimport { DATETIME_FORMAT, DAY_FORMAT } from '@/consts/dates';\nimport { createTableOrderObject, roundTo } from '@/utils/utils';\n\nexport const TableColumns: ProColumns<EscolaLms.Vouchers.Models.Coupon>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'id',\n    hideInSearch: true,\n    sorter: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"name\" defaultMessage=\"name\" />,\n    dataIndex: 'name',\n    hideInSearch: false,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"vouchers.code\" defaultMessage=\"vouchers.code\" />,\n    dataIndex: 'code',\n    hideInSearch: false,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"dateRange\" defaultMessage=\"Date Range\" />,\n    dataIndex: 'dateRange',\n    hideInSearch: false,\n    hideInForm: true,\n    hideInTable: true,\n    valueType: 'dateRange',\n    fieldProps: {\n      allowEmpty: [true, true],\n    },\n  },\n  {\n    title: <FormattedMessage id=\"amount\" defaultMessage=\"amount\" />,\n    dataIndex: 'amount',\n    hideInSearch: true,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"limit_per_user\" defaultMessage=\"limit_per_user\" />,\n    dataIndex: 'limit_per_user',\n    hideInSearch: true,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"vouchers.limit_usage\" defaultMessage=\"vouchers.limit_usage\" />,\n    dataIndex: 'limit_usage',\n    hideInSearch: true,\n    sorter: true,\n  },\n  {\n    title: (\n      <FormattedMessage id=\"vouchers.max_cart_price\" defaultMessage=\"vouchers.max_cart_price\" />\n    ),\n    dataIndex: 'max_cart_price',\n    hideInSearch: true,\n    sorter: true,\n    render: (_, record) => (record.max_cart_price ? roundTo(record.max_cart_price, 2, 100) : ''),\n  },\n  {\n    title: (\n      <FormattedMessage id=\"vouchers.min_cart_price\" defaultMessage=\"vouchers.min_cart_price\" />\n    ),\n    dataIndex: 'min_cart_price',\n    hideInSearch: true,\n    sorter: true,\n    render: (_, record) => (record.min_cart_price ? roundTo(record.min_cart_price, 2, 100) : ''),\n  },\n  {\n    title: <FormattedMessage id=\"active_from\" defaultMessage=\"active_from\" />,\n    dataIndex: 'active_from',\n    hideInSearch: true,\n    sorter: true,\n    render: (_, record) => record.active_from && format(new Date(record.active_from), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"active_to\" defaultMessage=\"active_to\" />,\n    dataIndex: 'active_to',\n    hideInSearch: true,\n    sorter: true,\n    render: (_, record) => record.active_to && format(new Date(record.active_to), DAY_FORMAT),\n  },\n];\n\nconst Vouchers: React.FC = () => {\n  const actionRef = useRef<ActionType>();\n  const [loading, setLoading] = useState<boolean>(false);\n  const intl = useIntl();\n\n  const handleRemove = useCallback(\n    async (id: number) => {\n      setLoading(true);\n      const hide = message.loading(<FormattedMessage id=\"loading\" defaultMessage=\"loading\" />);\n      try {\n        await deleteVoucher(id).then((response) => {\n          setLoading(false);\n          if (response.success) {\n            message.success(response.message);\n          }\n        });\n        hide();\n        setLoading(false);\n        actionRef.current?.reload();\n        return true;\n      } catch (error) {\n        hide();\n        message.error(<FormattedMessage id=\"error\" defaultMessage=\"error\" />);\n        setLoading(false);\n        return false;\n      }\n    },\n    [actionRef],\n  );\n\n  return (\n    <PageContainer>\n      <ProTable<EscolaLms.Vouchers.Models.Coupon, API.Vouchers>\n        headerTitle={intl.formatMessage({\n          id: 'menu.Sales.Vouchers',\n          defaultMessage: 'Vouchers',\n        })}\n        loading={loading}\n        actionRef={actionRef}\n        rowKey=\"id\"\n        search={{\n          layout: 'vertical',\n        }}\n        toolBarRender={() => [\n          <Link key=\"addnew\" to=\"/sales/vouchers/new\">\n            <Button type=\"primary\" key=\"primary\">\n              <PlusOutlined /> <FormattedMessage id=\"new\" defaultMessage=\"new\" />\n            </Button>\n          </Link>,\n        ]}\n        request={({ pageSize, current, name, code, dateRange }, sort) => {\n          setLoading(true);\n          const active_from =\n            dateRange && dateRange[0] ? format(new Date(dateRange[0]), DATETIME_FORMAT) : undefined;\n          const active_to =\n            dateRange && dateRange[1] ? format(new Date(dateRange[1]), DATETIME_FORMAT) : undefined;\n\n          return vouchers({\n            per_page: pageSize,\n            page: current,\n            name: name || undefined,\n            code: code || undefined,\n            active_from,\n            active_to,\n            ...createTableOrderObject(sort, 'created_at'),\n          }).then((response) => {\n            setLoading(false);\n            if (response.success) {\n              return {\n                data: response.data,\n                total: response.meta.total,\n                success: true,\n              };\n            }\n            return {\n              success: false,\n            };\n          });\n        }}\n        columns={[\n          ...TableColumns,\n          {\n            title: <FormattedMessage id=\"options\" defaultMessage=\"options\" />,\n            dataIndex: 'option',\n            valueType: 'option',\n            width: '10%',\n            render: (_, record) => [\n              <Link key=\"edit\" to={`/sales/vouchers/${record.id}`}>\n                <Tooltip title={<FormattedMessage id=\"edit\" defaultMessage=\"edit\" />}>\n                  <Button type=\"primary\" icon={<EditOutlined />} />\n                </Tooltip>\n              </Link>,\n              <Popconfirm\n                key=\"delete\"\n                title={\n                  <FormattedMessage\n                    id=\"deleteQuestion\"\n                    defaultMessage=\"Are you sure to delete this record?\"\n                  />\n                }\n                onConfirm={() => record.id && handleRemove(record.id)}\n                okText={<FormattedMessage id=\"yes\" defaultMessage=\"Yes\" />}\n                cancelText={<FormattedMessage id=\"no\" defaultMessage=\"No\" />}\n              >\n                <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n                  <Button type=\"primary\" icon={<DeleteOutlined />} danger />\n                </Tooltip>\n              </Popconfirm>,\n            ],\n          },\n        ]}\n      />\n    </PageContainer>\n  );\n};\n\nexport default Vouchers;\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/vouchers */\nexport async function vouchers(params?: API.Vouchers, options?: RequestOptionsInit) {\n  return request<API.DefaultMetaResponse<EscolaLms.Vouchers.Models.Coupon>>(`/api/admin/vouchers`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    params,\n    ...(options || {}),\n  });\n}\n\n/**  POST /api/admin/vouchers */\nexport async function createVoucher(body?: Record<string, any>, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<EscolaLms.Vouchers.Models.Coupon>>(`/api/admin/vouchers`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/**  GET /api/admin/vouchers/:id */\nexport async function getVoucher(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<EscolaLms.Vouchers.Models.Coupon>>(\n    `/api/admin/vouchers/${id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  PATCH /api/admin/vouchers */\nexport async function updateVoucher(\n  id: number,\n  body?: EscolaLms.Vouchers.Http.Requests.UpdateCouponRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<EscolaLms.Vouchers.Models.Coupon>>(\n    `/api/admin/vouchers/${id}`,\n    {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  DELETE /api/admin/vouchers/:id */\nexport async function deleteVoucher(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<EscolaLms.Vouchers.Http.Requests.DeleteCouponRequest>>(\n    `/api/admin/vouchers/${id}`,\n    {\n      method: 'DELETE',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n"],"sourceRoot":""}