(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"/y+f":function(mt,ye,i){"use strict";i.d(ye,"f",function(){return l}),i.d(ye,"d",function(){return R}),i.d(ye,"e",function(){return Oe}),i.d(ye,"c",function(){return r}),i.d(ye,"a",function(){return Ce}),i.d(ye,"b",function(){return Qe});var l;(function(d){d.Unselected="",d.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",d.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",d.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",d.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",d.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",d.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",d.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",d.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",d.Project="EscolaLms\\TopicTypeProject\\Models\\Project",d.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(l||(l={}));var Le;(function(d){d.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",d.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(Le||(Le={}));var _e;(function(d){d.draft="draft",d.published="published",d.archived="archived"})(_e||(_e={}));var R;(function(d){d.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",d.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",d.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(R||(R={}));var Oe;(function(d){d.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(Oe||(Oe={}));var j;(function(d){d.cart_fixed="cart_fixed",d.cart_percent="cart_percent",d.product_fixed="product_fixed",d.product_percent="product_percent"})(j||(j={}));var r;(function(d){d.MULTIPLE_CHOICE="multiple_choice",d.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",d.TRUE_FALSE="true_false",d.SHORT_ANSWERS="short_answers",d.MATCHING="matching",d.NUMERICAL_QUESTION="numerical_question",d.ESSAY="essay",d.DESCRIPTION="description"})(r||(r={}));var Ce;(function(d){d.PRESENT="present",d.ABSENT="absent"})(Ce||(Ce={}));var Qe;(function(d){d.Manual="manual",d.TeamsForms="teams_forms",d.TeamsLecture="teams_lecture",d.TestPortal="test_portal"})(Qe||(Qe={}))},"5R/X":function(mt,ye,i){},"5Syx":function(mt,ye,i){"use strict";i.d(ye,"c",function(){return Je}),i.d(ye,"b",function(){return it}),i.d(ye,"a",function(){return pe});var l=i("OaEy"),Le=i("2fM7"),_e=i("g9YV"),R=i("wCAj"),Oe=i("BoS7"),j=i("Sdc0"),r=i("jrin"),Ce=i("k1fw"),Qe=i("DYRE"),d=i("zeV3"),de=i("+BJd"),Be=i("mr32"),Ae=i("oBTY"),Q=i("tJVT"),Ve=i("q1tI"),dt=i.n(Ve),Te=i("9kvl"),st=i("Vpfc"),ke=i("nhC9"),x=i("LDJE"),h=i("nKUr"),ze=i.n(h),tt=function(U){return U.topicable.content.contents?Object.values(U.topicable.content.contents)[0].library:"H5P"},Je=function(U){var T=U.topics,B=U.stats,H=Object(Ve.useState)(!1),I=Object(Q.a)(H,2),b=I[0],Me=I[1],Ne=Object(Ve.useMemo)(function(){return[{title:Object(h.jsx)(Te.a,{id:"user"}),dataIndex:"id",render:function(Se){return Object(h.jsx)(st.a,{type:"App\\Models\\User",type_id:Se})}},{title:Object(h.jsx)(Te.a,{id:"email"}),dataIndex:"email"}].concat(Object(Ae.a)(T.map(function(Ge){var Se,Fe=(Se=Ge.topicable_type)===null||Se===void 0?void 0:Se.split("\\").pop();return Fe==="H5P"&&(Fe=tt(Ge)),{render:function(A){var N=0,ge=0;switch(A&&(A.started_at&&A.finished_at?N=1:A.started_at&&(N=2),ge=A.seconds/60),N){case 1:return Object(h.jsxs)(d.b,{children:[Object(h.jsx)(Be.a,{color:"success",children:"F"}),b&&Object(h.jsxs)("small",{children:[ge.toFixed(2),"m"]})]});case 2:return Object(h.jsxs)(d.b,{children:[Object(h.jsx)(Be.a,{color:"blue",children:"S"}),b&&Object(h.jsxs)("small",{children:[ge.toFixed(2),"m"]})]});case 0:default:return Object(h.jsx)(dt.a.Fragment,{children:Object(h.jsx)(Be.a,{color:"error",children:"N"})})}},title:Object(h.jsxs)("small",{children:[Object(h.jsx)(Be.a,{children:Fe})," ",Ge.title]}),dataIndex:Ge.id}})))},[T,b]),Pe=Object(Ve.useMemo)(function(){return B.map(function(Ge){return T.reduce(function(Se,Fe){var He=Ge.topics.find(function(A){return A.id===Fe.id});return Object(Ce.a)(Object(Ce.a)({},Se),{},Object(r.a)({},Number(Fe.id),He!=null?He:0))},{email:Ge.email,id:Ge.id})})},[B,T]);return Object(h.jsx)(R.a,{title:function(){return Object(h.jsxs)(d.b,{children:[Object(h.jsx)(Te.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(h.jsx)(Be.a,{color:"success",children:"F"}),Object(h.jsx)(Te.a,{id:"Started",defaultMessage:"Started:"})," ",Object(h.jsx)(Be.a,{color:"blue",children:"S"}),Object(h.jsx)(Te.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(h.jsx)(Be.a,{color:"error",children:"N"}),Object(h.jsx)(Te.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(h.jsx)(j.a,{checked:b,onChange:function(Fe){return Me(Fe)}})]})},columns:Ne,dataSource:Pe,size:"small",scroll:{x:1500}})},it=function(U){var T=U.stats,B=Object(Ve.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(b){return Object(h.jsx)(st.a,{type:"App\\Models\\User",type_id:b})}},{title:"email",dataIndex:"email"},{title:Object(h.jsx)(Te.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),H=Object(Ve.useMemo)(function(){return T.map(function(I){var b=I.id,Me=I.email,Ne=I.finished_at;return{id:b,email:Me,finished_at:Ne}})},[T]);return Object(h.jsx)(R.a,{title:function(){return Object(h.jsx)(d.b,{children:Object(h.jsx)(Te.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:B,dataSource:H,size:"small",scroll:{x:500}})},pe=function(U){var T=U.stats,B=Object(Ve.useState)(null),H=Object(Q.a)(B,2),I=H[0],b=H[1],Me=Object(Ve.useState)(null),Ne=Object(Q.a)(Me,2),Pe=Ne[0],Ge=Ne[1],Se=Object(Te.l)(),Fe=Object(Ve.useMemo)(function(){return T.flatMap(function(A){return Object.values(A.attempts).flatMap(function(N){var ge=N.dates,qe=N.attempt,ut=Object.values(ge).flatMap(function(Ze){var Xe=Ze.date,ct=Ze.seconds_total;return{date:Xe,attempt:qe,seconds_total:ct,email:A.email}});return ut})})},[T]),He={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(h.jsx)(ke.a,{title:Object(h.jsxs)(d.b,{children:[Object(h.jsx)(Te.a,{id:"course.interactions_time_in_days"}),Object(h.jsx)(Le.a,{showSearch:!0,value:I,onChange:function(N){b(N),Ge(null)},placeholder:Object(h.jsx)(Te.a,{id:"select_person",defaultMessage:"Select a person"}),children:T.map(function(A){var N=A.id,ge=A.email;return Object(h.jsx)(Le.a.Option,{value:ge,children:ge},N)})}),Object(h.jsx)(Le.a,{value:Pe,onChange:function(N){return Ge(N)},disabled:I===null,placeholder:Object(h.jsx)(Te.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Ae.a)(new Set(Fe.filter(function(A){var N=A.email;return N===I}).map(function(A){var N=A.attempt;return N}))).map(function(A){return Object(h.jsxs)(Le.a.Option,{value:A,children:[Object(h.jsx)(Te.a,{id:"attempt",defaultMessage:"Attempt"})," ",A]},A)})})]}),colSpan:12,layout:"center",children:Object(h.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(h.jsx)(x.a,Object(Ce.a)(Object(Ce.a)({},He),{},{tooltip:{title:"".concat(Se.formatMessage({id:"attempt"})),formatter:function(N){var ge=Math.floor(+N.seconds_total/60),qe=+N.seconds_total>60?+N.seconds_total-ge*60:0;return{name:N.attempt,value:"".concat(ge,"m ").concat(qe,"s")}}},data:Fe.filter(function(A){var N=A.email;return N===I}).filter(function(A){var N=A.attempt;return Number.isInteger(Pe)?N===Pe:!0})}))})})}},Hn4i:function(mt,ye,i){"use strict";var l=i("y8nQ"),Le=i("Vl3Y"),_e=i("+L6B"),R=i("2/Rp"),Oe=i("rePB"),j=i("ODXe"),r=i("Ff2n"),Ce=i("x+uP"),Qe=i("HaE+"),d=i("VTBJ"),de=i("nKUr"),Be=i.n(de),Ae=i("xvlK"),Q=i("WuYN"),Ve=i("VMEa"),dt=i("LQCs"),Te=i("ft2k"),st=i("uX+g"),ke=i("+i8S"),x=i("ipCM"),h=i("6cGi"),ze=i("ub+h"),tt=i("bG1m"),Je=i("q1tI"),it=i.n(Je),pe=i("mWMg"),se=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],U=["record","position","creatorButtonText","newRecordType","parentKey","style"],T=it.a.createContext(void 0);function B(b){var Me=b.children,Ne=b.record,Pe=b.position,Ge=b.newRecordType,Se=b.parentKey,Fe=Object(Je.useContext)(T);return it.a.cloneElement(Me,Object(d.a)(Object(d.a)({},Me.props),{},{onClick:function(){var He=Object(Qe.a)(Object(Ce.a)().mark(function N(ge){var qe,ut,Ze,Xe;return Object(Ce.a)().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,(qe=(ut=Me.props).onClick)===null||qe===void 0?void 0:qe.call(ut,ge);case 2:if(Xe=Ee.sent,Xe!==!1){Ee.next=5;break}return Ee.abrupt("return");case 5:Fe==null||(Ze=Fe.current)===null||Ze===void 0||Ze.addEditRecord(Ne,{position:Pe,newRecordType:Ge,parentKey:Se});case 6:case"end":return Ee.stop()}},N)}));function A(N){return He.apply(this,arguments)}return A}()}))}function H(b){var Me,Ne,Pe=Object(dt.d)(),Ge=b.onTableChange,Se=b.maxLength,Fe=b.formItemProps,He=b.recordCreatorProps,A=b.rowKey,N=b.controlled,ge=b.defaultValue,qe=b.onChange,ut=b.editableFormRef,Ze=Object(r.a)(b,se),Xe=Object(Te.a)(b.value),ct=Object(Je.useRef)(),Ee=Object(Je.useRef)();Object(Je.useImperativeHandle)(Ze.actionRef,function(){return ct.current});var W=Object(h.a)(function(){return b.value||ge||[]},{value:b.value,onChange:b.onChange}),ft=Object(j.a)(W,2),ve=ft[0],gt=ft[1],we=it.a.useMemo(function(){return typeof A=="function"?A:function($e,q){return $e[A]||q}},[A]),D=function(q){if(typeof q=="number"&&!b.name){if(q>=ve.length)return q;var ne=ve&&ve[q];return we==null?void 0:we(ne,q)}if((typeof q=="string"||q>=ve.length)&&b.name){var ie=ve.findIndex(function(oe,De){var Ue;return(we==null||(Ue=we(oe,De))===null||Ue===void 0?void 0:Ue.toString())===(q==null?void 0:q.toString())});return ie}return q};Object(Je.useImperativeHandle)(ut,function(){var $e=function(ie){var oe,De;if(ie==null)throw new Error("rowIndex is required");var Ue=D(ie),at=[b.name,(oe=Ue==null?void 0:Ue.toString())!==null&&oe!==void 0?oe:""].flat(1).filter(Boolean);return(De=Ee.current)===null||De===void 0?void 0:De.getFieldValue(at)},q=function(){var ie,oe=[b.name].flat(1).filter(Boolean);if(Array.isArray(oe)&&oe.length===0){var De,Ue=(De=Ee.current)===null||De===void 0?void 0:De.getFieldsValue();return Array.isArray(Ue)?Ue:Object.keys(Ue).map(function(at){return Ue[at]})}return(ie=Ee.current)===null||ie===void 0?void 0:ie.getFieldValue(oe)};return Object(d.a)(Object(d.a)({},Ee.current),{},{getRowData:$e,getRowsData:q,setRowData:function(ie,oe){var De,Ue,at,jt;if(ie==null)throw new Error("rowIndex is required");var xt=D(ie),ot=[b.name,(De=xt==null?void 0:xt.toString())!==null&&De!==void 0?De:""].flat(1).filter(Boolean),Tt=((Ue=Ee.current)===null||Ue===void 0||(at=Ue.getFieldsValue)===null||at===void 0?void 0:at.call(Ue))||{},Mt=Object(tt.a)(Tt,ot,Object(d.a)(Object(d.a)({},$e(ie)),oe||{}));return(jt=Ee.current)===null||jt===void 0?void 0:jt.setFieldsValue(Mt)}})}),Object(Je.useEffect)(function(){!b.controlled||ve.forEach(function($e,q){var ne;(ne=Ee.current)===null||ne===void 0||ne.setFieldsValue(Object(Oe.a)({},we($e,q),$e))},{})},[ve,b.controlled]),Object(Je.useEffect)(function(){if(b.name){var $e;Ee.current=b==null||($e=b.editable)===null||$e===void 0?void 0:$e.form}},[(Me=b.editable)===null||Me===void 0?void 0:Me.form,b.name]);var F=He||{},V=F.record,P=F.position,Y=F.creatorButtonText,z=F.newRecordType,k=F.parentKey,et=F.style,Ot=Object(r.a)(F,U),_t=P==="top",e=Object(Je.useMemo)(function(){return Se&&Se<=(ve==null?void 0:ve.length)?!1:He!==!1&&Object(de.jsx)(B,{record:Object(st.a)(V,ve==null?void 0:ve.length,ve)||{},position:P,parentKey:Object(st.a)(k,ve==null?void 0:ve.length,ve),newRecordType:z,children:Object(de.jsx)(R.a,Object(d.a)(Object(d.a)({type:"dashed",style:Object(d.a)({display:"block",margin:"10px 0",width:"100%"},et),icon:Object(de.jsx)(Ae.a,{})},Ot),{},{children:Y||Pe.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[He,Se,ve==null?void 0:ve.length]),yt=Object(Je.useMemo)(function(){return e?_t?{components:{header:{wrapper:function(q){var ne,ie=q.className,oe=q.children;return Object(de.jsxs)("thead",{className:ie,children:[oe,Object(de.jsxs)("tr",{style:{position:"relative"},children:[Object(de.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:e}),Object(de.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ne=Ze.columns)===null||ne===void 0?void 0:ne.length,children:e})]})]})}}}}:{tableViewRender:function(q,ne){var ie,oe;return Object(de.jsxs)(de.Fragment,{children:[(ie=(oe=b.tableViewRender)===null||oe===void 0?void 0:oe.call(b,q,ne))!==null&&ie!==void 0?ie:ne,e]})}}:{}},[_t,e]),ht=Object(d.a)({},b.editable),Ct=Object(ke.a)(function($e,q){var ne,ie,oe;if((ne=b.editable)===null||ne===void 0||(ie=ne.onValuesChange)===null||ie===void 0||ie.call(ne,$e,q),(oe=b.onValuesChange)===null||oe===void 0||oe.call(b,q,$e),b.controlled){var De;b==null||(De=b.onChange)===null||De===void 0||De.call(b,q)}});return((b==null?void 0:b.onValuesChange)||((Ne=b.editable)===null||Ne===void 0?void 0:Ne.onValuesChange)||b.controlled&&(b==null?void 0:b.onChange))&&(ht.onValuesChange=Ct),Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)(T.Provider,{value:ct,children:Object(de.jsx)(pe.a,Object(d.a)(Object(d.a)(Object(d.a)({search:!1,options:!1,pagination:!1,rowKey:A,revalidateOnFocus:!1},Ze),yt),{},{tableLayout:"fixed",actionRef:ct,onChange:Ge,editable:Object(d.a)(Object(d.a)({},ht),{},{formProps:Object(d.a)({formRef:Ee},ht.formProps)}),dataSource:ve,onDataSourceChange:function(q){if(gt(q),b.name&&P==="top"){var ne,ie=Object(tt.a)({},[b.name].flat(1).filter(Boolean),q);(ne=Ee.current)===null||ne===void 0||ne.setFieldsValue(ie)}}}))}),b.name?Object(de.jsx)(Q.a,{name:[b.name],children:function(q){var ne,ie,oe=Object(ze.a)(q,[b.name].flat(1)),De=oe==null?void 0:oe.find(function(Ue,at){return!Object(x.a)(Ue,Xe==null?void 0:Xe[at])});return De&&Xe&&(b==null||(ne=b.editable)===null||ne===void 0||(ie=ne.onValuesChange)===null||ie===void 0||ie.call(ne,De,oe)),null}}):null]})}function I(b){var Me=Ve.a.useFormInstance();return b.name?Object(de.jsx)(Le.a.Item,Object(d.a)(Object(d.a)({style:{maxWidth:"100%"}},b==null?void 0:b.formItemProps),{},{name:b.name,children:Object(de.jsx)(H,Object(d.a)(Object(d.a)({},b),{},{editable:Object(d.a)(Object(d.a)({},b.editable),{},{form:Me})}))})):Object(de.jsx)(H,Object(d.a)({},b))}I.RecordCreator=B,ye.a=I},LDJE:function(mt,ye,i){"use strict";var l=i("q1tI"),Le=i.n(l),_e=i("ma/q"),R=i("ZIEt"),Oe=i("QpZ9"),j=i("GzfL"),r=i("Scwr"),Ce=function(d,de){var Be={};for(var Ae in d)Object.prototype.hasOwnProperty.call(d,Ae)&&de.indexOf(Ae)<0&&(Be[Ae]=d[Ae]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Q=0,Ae=Object.getOwnPropertySymbols(d);Q<Ae.length;Q++)de.indexOf(Ae[Q])<0&&Object.prototype.propertyIsEnumerable.call(d,Ae[Q])&&(Be[Ae[Q]]=d[Ae[Q]]);return Be},Qe=Object(l.forwardRef)(function(d,de){var Be=d.chartRef,Ae=d.style,Q=Ae===void 0?{height:"inherit"}:Ae,Ve=d.className,dt=d.loading,Te=d.loadingTemplate,st=d.errorTemplate,ke=Ce(d,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),x=Object(R.a)(_e.a,ke),h=x.chart,ze=x.container;return Object(l.useEffect)(function(){Object(Oe.a)(Be,h.current)},[h.current]),Object(l.useImperativeHandle)(de,function(){return{getChart:function(){return h.current}}}),Le.a.createElement(j.a,{errorTemplate:st},dt&&Le.a.createElement(r.a,{loadingTemplate:Te,theme:d.theme}),Le.a.createElement("div",{className:Ve,style:Q,ref:ze}))});ye.a=Qe},olry:function(mt,ye,i){"use strict";i.r(ye);var l=i("k1fw"),Le=i("+L6B"),_e=i("2/Rp"),R=i("T2oS"),Oe=i("W9HT"),j=i("q1tI"),r=i("9kvl"),Ce=i("55Ip"),Qe=i("Ty5D"),d=i("nhC9"),de=i("tMyG"),Be=i("my69"),Ae=i("huej"),Q=i("mJ0o"),Ve=i("EhlZ"),dt=i("P2fV"),Te=i("NJEC"),st=i("5Dmo"),ke=i("3S7+"),x=i("qLMh"),h=i("9og8"),ze=i("sWYD"),tt=i("G3dp"),Je=i("VTBJ"),it={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},pe=it,se=i("6VBw"),U=function(n,t){return j.createElement(se.a,Object(Je.a)(Object(Je.a)({},n),{},{ref:t,icon:pe}))};U.displayName="LineChartOutlined";var T=j.forwardRef(U),B=i("/MfK"),H=i("Qiat"),I=i("mGZj");function b(c,n){return Me.apply(this,arguments)}function Me(){return Me=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/exams",Object(l.a)({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},c)})),Me.apply(this,arguments)}function Ne(c,n){return Pe.apply(this,arguments)}function Pe(){return Pe=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/exams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},c)})),Pe.apply(this,arguments)}function Ge(c,n,t){return Se.apply(this,arguments)}function Se(){return Se=Object(h.a)(Object(x.a)().mark(function c(n,t,s){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(r.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"PUT",data:t,useCache:!1},s||{})));case 1:case"end":return u.stop()}},c)})),Se.apply(this,arguments)}function Fe(c,n){return He.apply(this,arguments)}function He(){return He=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},c)})),He.apply(this,arguments)}function A(c,n){return N.apply(this,arguments)}function N(){return N=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/exams/".concat(n),Object(l.a)({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},c)})),N.apply(this,arguments)}function ge(c,n,t,s){return qe.apply(this,arguments)}function qe(){return qe=Object(h.a)(Object(x.a)().mark(function c(n,t,s,a){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(r.i)("/api/admin/exams/".concat(n,"/users/").concat(t),Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:s},a||{})));case 1:case"end":return o.stop()}},c)})),qe.apply(this,arguments)}function ut(c,n,t){return Ze.apply(this,arguments)}function Ze(){return Ze=Object(h.a)(Object(x.a)().mark(function c(n,t,s){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(r.i)("/api/admin/exams/".concat(n,"/users/").concat(t),Object(l.a)({method:"DELETE"},s||{})));case 1:case"end":return u.stop()}},c)})),Ze.apply(this,arguments)}var Xe=i("Vpfc"),ct=i("giR+"),Ee=i("fyUT"),W=i("tJVT"),ft=i("14J3"),ve=i("BMrR"),gt=i("jCWc"),we=i("kPKH"),D=i("VMEa"),F=i("Qurx"),V=i("lR9U"),P=i("/y+f"),Y=i("2qtc"),z=i("kLXV"),k=i("oBTY"),et=i("OaEy"),Ot=i("2fM7"),_t=i("DBJ/"),e=i("nKUr"),yt=function(n){var t=n.type,s=n.onDataConverted,a=n.groupSelectDisabled,u=Object(Q.b)(),o=u.semester_subject_id,v=u.teacherSubjectData,f=Object(j.useState)(null),y=Object(W.a)(f,2),p=y[0],O=y[1],S=Object(j.useMemo)(function(){var E;return((E=v==null?void 0:v.groups)!==null&&E!==void 0?E:[]).map(function(g){var M=g.id,L=g.name;return{label:L,value:M}})},[]),m={type:t,group_id:p,semester_subject_id:o},_=Object(j.useCallback)(function(E){if(E.success){var g=E.data.results.filter(function(M){var L=M.user_id;return L!==null});if(!g.length)return;s({exam_results:g,group_id:E.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(r.a,{id:"group"}),children:Object(e.jsx)(Ot.a,{disabled:a,value:p,onChange:function(g){return O(g)},options:S,placeholder:Object(e.jsx)(r.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(_t.a,{name:"file",url:"/api/admin/exams/parse",onUpload:_,onChange:function(g){return!g.fileList.length&&s(void 0)},maxFiles:1,data:m,disabled:!p})]})},ht=function(n){var t=n.onDataConverted,s=Object(Q.b)(),a=s.teacherSubjectData,u=s.groupUsers,o=Object(j.useState)(null),v=Object(W.a)(o,2),f=v[0],y=v[1],p=Object(j.useMemo)(function(){var S;return((S=a==null?void 0:a.groups)!==null&&S!==void 0?S:[]).map(function(m){var _=m.id,E=m.name;return{label:E,value:_}})},[]),O=Object(j.useCallback)(function(S){var m;y(S);var _=(m=u.byId)===null||m===void 0?void 0:m[S];if(!!_){var E=_.users.reduce(function(g,M){var L=M.id,C=M.email,te=M.first_name,w=M.last_name,ue=M.academic_teacher_id;return ue!==null?g:[].concat(Object(k.a)(g),[{email:C,first_name:te,last_name:w,user_id:L,result:0}])},[]);t({group_id:S,exam_results:E})}},[u.byId]);return Object(e.jsx)(Ot.a,{value:f,onChange:O,options:p,placeholder:Object(e.jsx)(r.a,{id:"select_group"}),style:{width:"100%"}})},Ct=[P.b.TeamsLecture,P.b.TestPortal,P.b.TeamsForms],$e=function(n){var t=n.open,s=n.closeModal,a=n.onSuccess,u=n.type,o=Object(Q.b)(),v=o.teacherSubjectData,f=o.fetchGroupUsers,y=Object(j.useState)(),p=Object(W.a)(y,2),O=p[0],S=p[1];return Object(j.useEffect)(function(){if(u===P.b.Manual&&t){var m;v==null||(m=v.groups)===null||m===void 0||m.forEach(function(_){var E=_.id;return f(E)})}},[u,t]),Object(e.jsxs)(z.a,{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.Exams.".concat(u,"Convert")}),width:"40vw",open:t,onCancel:s,onOk:function(){O&&a(O)},okButtonProps:{disabled:!O},children:[Ct.includes(u)&&Object(e.jsx)(yt,{type:u,onDataConverted:S,groupSelectDisabled:!!O}),u===P.b.Manual&&Object(e.jsx)(ht,{onDataConverted:S})]})},q=function(n){var t=n.onSelect;return Object(e.jsxs)(ve.a,{gutter:[16,16],children:[Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(_e.a,{type:"primary",onClick:function(){return t(P.b.TeamsForms)},children:Object(e.jsx)(r.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(_e.a,{type:"primary",onClick:function(){return t(P.b.TestPortal)},children:Object(e.jsx)(r.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(_e.a,{type:"primary",onClick:function(){return t(P.b.TeamsLecture)},children:Object(e.jsx)(r.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(_e.a,{type:"primary",onClick:function(){return t(P.b.Manual)},children:Object(e.jsx)(r.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ne=[{title:Object(e.jsx)(r.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(r.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(r.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(r.a,{id:"number_between",values:{min:0,max:100}})}]}}],ie=function(n){var t,s=n.exam_id,a=D.a.useForm(),u=Object(W.a)(a,1),o=u[0],v=Object(j.useState)(),f=Object(W.a)(v,2),y=f[0],p=f[1],O=Object(j.useState)(),S=Object(W.a)(O,2),m=S[0],_=S[1],E=Object(j.useState)(!1),g=Object(W.a)(E,2),M=g[0],L=g[1],C=Object(Q.b)(),te=C.semester_subject_id,w=C.getGroupById,ue=Object(j.useMemo)(function(){var he;return((he=m==null?void 0:m.exam_results)!==null&&he!==void 0?he:[]).map(function(ce){var ae=ce.user_id;return ae})},[m==null?void 0:m.exam_results]);Object(j.useEffect)(function(){var he=Number(s);s==="new"&&(p(void 0),_(void 0),o.resetFields()),s!=="new"&&!Number.isNaN(he)&&(L(!0),Fe(he).then(function(ce){if(ce.success){var ae=ce.data,K=ae.type,J=ae.results,je=ae.title,X=ae.weight,ee=ae.passed_at,fe=ae.group_id;p(K),_({group_id:fe,exam_results:J}),o.setFieldsValue({title:je,weight:X,passed_at:ee})}}).finally(function(){return L(!1)}))},[s]);var Ie=Object(j.useCallback)(function(){p(void 0),_(void 0)},[]);return M?Object(e.jsx)(Oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)($e,{open:Boolean(y&&!m),type:y,closeModal:Ie,onSuccess:_}),Object(e.jsxs)(D.a,{form:o,submitter:y===void 0||!m?!1:void 0,onFinish:function(){var he=Object(h.a)(Object(x.a)().mark(function ce(ae){var K,J,je,X,ee,fe,le,Z,$,G;return Object(x.a)().wrap(function(re){for(;;)switch(re.prev=re.next){case 0:if(J=m==null||(K=m.exam_results)===null||K===void 0?void 0:K.every(function(be){var Re=be.result;return typeof Re=="number"&&Re>=0&&Re<=100}),!(m&&J&&typeof te=="number")){re.next=17;break}if(je=ae.title,X=ae.passed_at,ee=ae.weight,fe=Number(s),le=m.exam_results,Z=m.group_id,$={type:y,semester_subject_id:te,title:je,passed_at:X,weight:ee,group_id:Z,results:le},!Number.isNaN(fe)){re.next=12;break}return re.next=9,Ne($);case 9:re.t0=re.sent,re.next=15;break;case 12:return re.next=14,Ge(fe,$);case 14:re.t0=re.sent;case 15:G=re.t0,G.success&&r.f.push("/teacher/subjects/".concat(te,"/exams"));case 17:return re.abrupt("return",!0);case 18:case"end":return re.stop()}},ce)}));return function(ce){return he.apply(this,arguments)}}(),onReset:Ie,children:[Object(e.jsxs)(D.a.Group,{children:[Object(e.jsx)(F.a,{label:Object(e.jsx)(r.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(V.a,{label:Object(e.jsx)(r.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(D.a.Item,{name:"weight",label:Object(e.jsx)(r.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(r.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ee.a,{})})]}),y&&m&&Object(e.jsx)(H.a,{rowKey:"user_id",headerTitle:(t=w(m.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:ue,onValuesChange:function(ce,ae){return _({group_id:m.group_id,exam_results:ae})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:m.exam_results,columns:ne}),!m&&Object(e.jsx)(q,{onSelect:p})]})]})},oe=[{title:Object(e.jsx)(r.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(r.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(r.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],De=function(n){var t=n.exam_id,s=Object(j.useState)(""),a=Object(W.a)(s,2),u=a[0],o=a[1];return Object(e.jsx)(H.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:u,request:Object(h.a)(Object(x.a)().mark(function v(){var f;return Object(x.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Fe(t);case 2:if(f=p.sent,!f.success){p.next=6;break}return o(f.data.title),p.abrupt("return",{total:f.data.results.length,success:!0,data:f.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},v)})),columns:oe})},Ue=[{title:Object(e.jsx)(r.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(r.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(r.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return Object(e.jsx)(r.a,{id:"ExamGradeType.".concat(t.type)})}},{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&Object(ze.a)(new Date(t.passed_at),I.c)}},{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight+"%"}},{title:Object(e.jsx)(r.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&Object(ze.a)(new Date(t.created_at),I.c)}},{title:Object(e.jsx)(r.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return Object(e.jsx)(r.a,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:Object(e.jsx)(r.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return Object(e.jsx)(Xe.a,{type:"Students",type_id:t.group_id},t.group_id)}}],at=function(){var n,t,s=Object(j.useRef)(),a=Object(Q.b)(),u=a.semester_subject_id,o=Object(Qe.k)(),v=Object(j.useMemo)(function(){var p,O,S;return{exam_id:(p=(O=o.query)===null||O===void 0?void 0:O.exam_id)!==null&&p!==void 0?p:null,results:(S=o.query)===null||S===void 0?void 0:S.results}},[(n=o.query)===null||n===void 0?void 0:n.exam_id,(t=o.query)===null||t===void 0?void 0:t.results]),f=v.exam_id,y=v.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(De,{exam_id:Number(y)}):f!==null?Object(e.jsx)(ie,{exam_id:f}):Object(e.jsx)(H.a,{className:"table-standalone",headerTitle:Object(e.jsx)(r.a,{id:"exams"}),actionRef:s,search:!1,rowKey:"id",request:function(){var p=Object(h.a)(Object(x.a)().mark(function O(S,m){var _,E,g,M;return Object(x.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(_=S.current,E=S.pageSize,u!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return g=m&&Object.entries(m)[0],C.next=6,b({per_page:E,page:_,semester_subject_id:Number.isNaN(u)?void 0:u,order_by:g&&g[0],order:g&&(g[1]==="ascend"?"ASC":"DESC")});case 6:if(M=C.sent,!M.success){C.next=9;break}return C.abrupt("return",{data:M.data,total:M.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},O)}));return function(O,S){return p.apply(this,arguments)}}(),columns:[].concat(Ue,[{title:Object(e.jsx)(r.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(O,S){return[Object(e.jsx)(Ce.a,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?exam_id=").concat(S.id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(_e.a,{type:"primary",icon:Object(e.jsx)(tt.a,{})})})},"edit"),Object(e.jsx)(Ce.a,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?results=").concat(S.id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(_e.a,{icon:Object(e.jsx)(T,{})})})},"results"),Object(e.jsx)(Te.a,{title:Object(e.jsx)(r.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(h.a)(Object(x.a)().mark(function m(){var _;return Object(x.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,A(S.id);case 2:_=g.sent,_.success&&s.current&&s.current.reload();case 4:case"end":return g.stop()}},m)})),okText:Object(e.jsx)(r.a,{id:"yes"}),cancelText:Object(e.jsx)(r.a,{id:"no"}),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(_e.a,{type:"primary",icon:Object(e.jsx)(B.a,{}),danger:!0})})},"delete")]}}])})},jt=i("o0Ox"),xt=i("miYZ"),ot=i("tsqr"),Tt=i("4KAj");function Mt(c,n){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/chats/ms-teams",Object(l.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},c)})),Pt.apply(this,arguments)}var Qt=function(n){var t=n.student_id,s=Object(j.useState)(!1),a=Object(W.a)(s,2),u=a[0],o=a[1],v=Object(j.useCallback)(Object(h.a)(Object(x.a)().mark(function f(){var y;return Object(x.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return o(!0),O.next=3,Mt({user_id:t});case 3:if(y=O.sent,y.success){O.next=8;break}return ot.b.error(y.message),o(!1),O.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),o(!1);case 10:case"end":return O.stop()}},f)})),[]);return Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(_e.a,{loading:u,type:"primary",icon:Object(e.jsx)(Tt.a,{}),onClick:v})})},kt=[{title:Object(e.jsx)(r.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(r.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(r.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(r.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(r.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],qt=function(n){return n.map(function(t){var s=t.id,a=t.name;return{label:a,value:s}})},ea=function(n){return n.reduce(function(t,s){var a,u=s==null||(a=s.users)===null||a===void 0?void 0:a.reduce(function(o,v){return v.academic_teacher_id!==null?o:[].concat(Object(k.a)(o),[{group_id:s.id,group_name:s.name,user_id:v.id,first_name:v.first_name,last_name:v.last_name,email:v.email}])},[]);return[].concat(Object(k.a)(t),Object(k.a)(u))},[])},ta=function(){var n=Object(Q.b)(),t=n.teacherSubjectData,s=Object(j.useMemo)(function(){var a;return qt((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return Object(e.jsx)(H.a,{className:"table-standalone",rowKey:function(u){return"".concat(u.group_id,"-").concat(u.user_id)},search:{layout:"vertical"},request:function(){var a=Object(h.a)(Object(x.a)().mark(function u(o){var v,f,y,p,O,S,m,_,E;return Object(x.a)().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return v=o.groups,f=o.first_name,y=f===void 0?"":f,p=o.last_name,O=p===void 0?"":p,S=o.email,m=S===void 0?"":S,M.next=3,Object(jt.a)({parent_id:t==null?void 0:t.group_id,"id[]":v});case 3:if(_=M.sent,_.success){M.next=6;break}return M.abrupt("return",{data:[],total:0,success:!1});case 6:return E=ea(_.data).filter(function(L){return L.first_name.toLowerCase().includes(y.toLowerCase())&&L.last_name.toLowerCase().includes(O.toLowerCase())&&L.email.toLowerCase().includes(m.toLowerCase())}),M.abrupt("return",{data:E,total:E.length,success:!0});case 8:case"end":return M.stop()}},u)}));return function(u){return a.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(r.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:s,mode:"multiple"}}].concat(kt,[{hideInSearch:!0,title:Object(e.jsx)(r.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(u,o){return[Object(e.jsx)(Qt,{student_id:o.user_id},"teamsChat")]}}])})},pt=i("jrin");function Dt(c,n){return It.apply(this,arguments)}function It(){return It=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/schedules/groups/".concat(n),Object(l.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},c)})),It.apply(this,arguments)}function Wt(c,n,t,s){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(h.a)(Object(x.a)().mark(function c(n,t,s,a){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(r.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(l.a)({data:{attendances:[{user_id:t,value:s}]},method:"POST"},a||{})));case 1:case"end":return o.stop()}},c)})),Rt.apply(this,arguments)}var Ya=i("sRBo"),Vt=i("kaz8"),aa=function(n){var t=n.groupAttendanceScheduleId,s=n.studentId,a=n.defaultChecked,u=n.onSuccess,o=Object(j.useState)(!1),v=Object(W.a)(o,2),f=v[0],y=v[1],p=Object(j.useCallback)(function(O){y(!0),Wt(t,s,O.target.checked?P.a.PRESENT:P.a.ABSENT).then(function(S){S.success&&(u==null||u())}).finally(function(){return y(!1)})},[]);return Object(e.jsx)(Vt.a,{disabled:f,defaultChecked:a,onChange:p})},Ht=aa,na=function(){var n=Object(Q.b)(),t=n.teacherSubjectData,s=Object(j.useState)([]),a=Object(W.a)(s,2),u=a[0],o=a[1],v=Object(j.useState)(""),f=Object(W.a)(v,2),y=f[0],p=f[1],O=Object(r.l)(),S=Object(j.useRef)(),m=Object(j.useMemo)(function(){var E;return((E=t==null?void 0:t.groups)!==null&&E!==void 0?E:[]).map(function(g){var M=g.id,L=g.name;return{value:M,label:L}})},[t==null?void 0:t.groups]),_=Object(j.useMemo)(function(){var E;return[{title:Object(e.jsx)(r.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:m,defaultValue:m==null||(E=m[0])===null||E===void 0?void 0:E.value,allowClear:!1}},{title:Object(e.jsx)(r.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(k.a)(u))},[m,u]);return Object(e.jsx)(H.a,{className:"table-standalone",headerTitle:"".concat(O.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var E=Object(h.a)(Object(x.a)().mark(function g(M){var L,C,te,w,ue,Ie,he,ce,ae,K,J;return Object(x.a)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return C=M.group_id,te=C===void 0?m==null||(L=m[0])===null||L===void 0?void 0:L.value:C,w=M.full_name,ue=w===void 0?"":w,X.next=3,Promise.all([Object(jt.b)(te),Dt(te)]);case 3:if(Ie=X.sent,he=Object(W.a)(Ie,2),ce=he[0],ae=he[1],K=m.find(function(ee){var fe=ee.value;return fe===te}),!(!ce.success||!ae.success||!K)){X.next=10;break}return X.abrupt("return",{data:[],total:0,success:!1});case 10:if(p(K.label),ae.data.length){X.next=15;break}return ot.b.warn(Object(e.jsx)(r.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),o([]),X.abrupt("return",{data:[],total:0,success:!0});case 15:return o(ae.data.reduce(function(ee,fe){return[].concat(Object(k.a)(ee),[{title:String(Object(ze.a)(new Date(fe.date_from),I.c)),dataIndex:String(fe.date_from),hideInSearch:!0,width:100,align:"center",render:function(Z,$){return Object(e.jsx)(Ht,{groupAttendanceScheduleId:fe.id,defaultChecked:$["".concat(fe==null?void 0:fe.date_from)]===P.a.PRESENT,studentId:$.id})}}])},[])),J=ce.data.users.reduce(function(ee,fe){var le=fe.id,Z=fe.academic_teacher_id,$=fe.first_name,G=fe.last_name,xe="".concat(G," ").concat($);if(Z!==null||!xe.toLowerCase().includes(ue.toLowerCase()))return ee;var re=ae.data.reduce(function(be,Re){var Ke=Re.attendances.find(function(Ye){return Ye.user_id===le});return Ke?Object(l.a)(Object(l.a)({},be),{},Object(pt.a)({},"".concat(Re.date_from),Ke.value)):be},{});return[].concat(Object(k.a)(ee),[Object(l.a)({id:le,full_name:xe},re)])},[]).sort(function(ee,fe){return ee.full_name.localeCompare(fe.full_name)}),X.abrupt("return",{data:J,total:J.length,success:!0});case 18:case"end":return X.stop()}},g)}));return function(g){return E.apply(this,arguments)}}(),columns:_,search:{layout:"vertical"},pagination:{onChange:function(){var g;return(g=S.current)===null||g===void 0?void 0:g.reload()}},scroll:{x:1500},actionRef:S,rowKey:"id"})},Za=i("/zsF"),zt=i("PArb"),ra=i("Hn4i"),sa=i("bRQS");function Jt(c,n,t){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(h.a)(Object(x.a)().mark(function c(n,t,s){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(r.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),Object(l.a)({method:"GET",useCache:!1},s||{})));case 1:case"end":return u.stop()}},c)})),Lt.apply(this,arguments)}function ia(c,n,t,s){return At.apply(this,arguments)}function At(){return At=Object(h.a)(Object(x.a)().mark(function c(n,t,s,a){return Object(x.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(r.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),Object(l.a)({method:"POST",data:s},a||{})));case 1:case"end":return o.stop()}},c)})),At.apply(this,arguments)}function ua(c,n){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/lesson-group-users",Object(l.a)({method:"GET",params:{"groups[]":n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},c)})),Gt.apply(this,arguments)}function ca(c,n,t){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(h.a)(Object(x.a)().mark(function c(n,t,s){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(r.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),Object(l.a)({method:"GET",useCache:!1},s||{})));case 1:case"end":return u.stop()}},c)})),Ft.apply(this,arguments)}function la(c){return $t.apply(this,arguments)}function $t(){return $t=Object(h.a)(Object(x.a)().mark(function c(n){return Object(x.a)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",Object(r.i)("/api/admin/grade-terms",Object(l.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return s.stop()}},c)})),$t.apply(this,arguments)}function da(c,n){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/grade-scales/".concat(n),Object(l.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},c)})),Ut.apply(this,arguments)}function oa(c,n){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/final-grades",Object(l.a)({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},c)})),Nt.apply(this,arguments)}function ja(c,n,t){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(h.a)(Object(x.a)().mark(function c(n,t,s){return Object(x.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(r.i)("/api/admin/final-grades/".concat(n),Object(l.a)({method:"PATCH",data:t},s||{})));case 1:case"end":return u.stop()}},c)})),Bt.apply(this,arguments)}var ba=[{title:Object(e.jsx)(r.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(r.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(r.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(r.a,{id:"number_between",values:{min:0,max:100}})}]}}],ma=function(){var n,t,s=Object(r.m)("@@initialState"),a=s.initialState,u=Object(Q.b)(),o=u.semester_subject_id,v=u.tutors,f=D.a.useForm(),y=Object(W.a)(f,1),p=y[0],O=Object(j.useState)([]),S=Object(W.a)(O,2),m=S[0],_=S[1],E=Object(j.useRef)(),g=Object(j.useState)(!1),M=Object(W.a)(g,2),L=M[0],C=M[1],te=Object(j.useState)(null),w=Object(W.a)(te,2),ue=w[0],Ie=w[1],he=Object(j.useMemo)(function(){return!!v.data.find(function(K){var J,je=K.id;return je===(a==null||(J=a.currentUser)===null||J===void 0?void 0:J.id)})},[v.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),ce=Object(j.useMemo)(function(){return v.data.map(function(K){var J=K.id,je=K.first_name,X=K.last_name;return{label:"".concat(je," ").concat(X),value:J}})},[v.data]);Object(j.useEffect)(function(){var K,J;if(!he||!(a!=null&&(K=a.currentUser)!==null&&K!==void 0&&K.id)){var je;if((je=v.data)!==null&&je!==void 0&&je[0]){var X;Ie((X=v.data)===null||X===void 0?void 0:X[0].id)}return}Ie(a==null||(J=a.currentUser)===null||J===void 0?void 0:J.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,he]),Object(j.useEffect)(function(){o===null||ue===null||(C(!0),Jt(o,ue).then(function(K){if(K.success){var J,je=((J=K.data.grade_scale)!==null&&J!==void 0?J:[]).map(function(X,ee){return Object(l.a)(Object(l.a)({},X),{},{id:String((ee+1)*100)})});p.setFieldValue("table",je)}}).finally(function(){C(!1)}))},[o,ue]);var ae=Object(j.useCallback)(function(){var K=Object(h.a)(Object(x.a)().mark(function J(je){return Object(x.a)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:if(!(o===null||ue===null)){ee.next=2;break}return ee.abrupt("return");case 2:return ee.next=4,ia(o,ue,{grade_scale:je.table});case 4:case"end":return ee.stop()}},J)}));return function(J){return K.apply(this,arguments)}}(),[ue,o]);return v.loading?Object(e.jsx)(Oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(r.a,{id:"menu.Teacher"}),children:Object(e.jsx)(Ot.a,{disabled:he,placeholder:Object(e.jsx)(r.a,{id:"select"}),options:ce,value:ue,onChange:function(J){return Ie(J)}})}),Object(e.jsx)(zt.a,{}),Object(e.jsx)(D.a,{form:p,onFinish:ae,submitter:{render:function(J,je){var X=Object(W.a)(je,2),ee=X[1];return[ee]}},children:Object(e.jsx)(ra.a,{name:"table",rowKey:"id",actionRef:E,formItemProps:{label:Object(e.jsx)(r.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,loading:L,columns:[].concat(ba,[{title:Object(e.jsx)(r.a,{id:"options"}),valueType:"option",render:function(J,je){return Object(e.jsx)(_e.a,{type:"primary",onClick:function(){var ee;return(ee=E.current)===null||ee===void 0?void 0:ee.startEditable(je.id)},icon:Object(e.jsx)(tt.a,{})})}}]),editable:{form:p,type:"multiple",editableKeys:m,saveText:Object(e.jsx)(_e.a,{type:"primary",icon:Object(e.jsx)(sa.a,{})}),onChange:_,actionRender:function(J,je,X){return[X.save]}}})})]})},Xa=i("qbNl"),va=i("JBPa"),Qa=i("tU7J"),nt=i("wFql"),ka=i("Awhp"),fa=i("KrTs"),Oa=i("wd/R"),rt=i.n(Oa);function ha(c,n){return wt.apply(this,arguments)}function wt(){return wt=Object(h.a)(Object(x.a)().mark(function c(n,t){return Object(x.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(r.i)("/api/admin/schedules",Object(l.a)({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},c)})),wt.apply(this,arguments)}var qa=i("5R/X"),pa=function(){var n=Object(j.useState)(null),t=Object(W.a)(n,2),s=t[0],a=t[1],u=Object(j.useState)([]),o=Object(W.a)(u,2),v=o[0],f=o[1],y=Object(Q.b)(),p=y.semester_subject_id,O=rt()(),S=Object(j.useMemo)(function(){return v.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:rt()(C.date_from).toDate(),end:rt()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[v]),m=Object(j.useCallback)(function(C,te){ha({semester_subject_id:p,date_form:C.toDate(),date_to:te.toDate()}).then(function(w){w.success&&f(w.data)})},[p]),_=Object(j.useCallback)(function(C){a(C)},[]),E=Object(j.useCallback)(function(){a(null)},[]),g=Object(j.useCallback)(function(C){return C.isSame(O,"day")?"warning":C.isAfter(O,"day")?"success":"error"},[]),M=Object(j.useCallback)(function(C){var te=S.filter(function(w){return rt()(w.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:te.map(function(w){return Object(e.jsx)("li",{onClick:function(){return _(w)},children:Object(e.jsx)(fa.a,{status:g(rt()(w.start)),text:w.title})},w.id)})})},[v]),L=Object(j.useCallback)(function(C,te){var w=rt()(C).startOf(te).subtract(1,"month"),ue=rt()(C).endOf(te).add(1,"month");m(w,ue)},[]);return Object(j.useEffect)(function(){var C=rt()().startOf("month"),te=rt()().endOf("month");m(C,te)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(nt.a.Title,{level:4,children:Object(e.jsx)(r.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(va.a,{dateCellRender:M,onPanelChange:L}),Object(e.jsxs)(z.a,{open:s!==null,title:"".concat(s==null?void 0:s.subject,": ").concat(s==null?void 0:s.title),onCancel:E,footer:null,children:[Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",s==null?void 0:s.tutor_name]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"email",defaultMessage:"Email"}),": ",s==null?void 0:s.tutor_email]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"group",defaultMessage:"Group"}),": ",s==null?void 0:s.group]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"semester",defaultMessage:"Semester"}),": ",s==null?void 0:s.semester]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"started_at",defaultMessage:"Start date"}),":",s&&rt()(s.start).format(I.b)]}),Object(e.jsxs)(nt.a.Paragraph,{children:[Object(e.jsx)(r.a,{id:"end_at",defaultMessage:"End date"}),":",s&&rt()(s.end).format(I.b)]}),(s==null?void 0:s.ms_teams_join_url)&&Object(e.jsx)(nt.a.Paragraph,{children:Object(e.jsx)("a",{href:s.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(_e.a,{type:"primary",children:Object(e.jsx)(r.a,{id:"msTeams"})})},"teamsLink")})]})]})},Yt=i("yj/a"),Zt=i("5Syx"),St=i("PpiC"),Kt=i("H6aw"),ga=i("p3I6"),_a=["attendances"],xa=["results"];function Sa(c,n){var t=Object(j.useState)({loading:!1}),s=Object(W.a)(t,2),a=s[0],u=s[1];return Object(j.useEffect)(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!0})}),ca(c,n).then(function(o){o.success&&u(function(v){return Object(l.a)(Object(l.a)({},v),{},{data:o.data})})}).finally(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!1})})})},[n,c]),{finalGrades:a}}function Ea(){var c=Object(j.useState)({loading:!1}),n=Object(W.a)(c,2),t=n[0],s=n[1];return Object(j.useEffect)(function(){s(function(a){return Object(l.a)(Object(l.a)({},a),{},{loading:!0})}),la().then(function(a){a.success&&s(function(u){return Object(l.a)(Object(l.a)({},u),{},{data:a.data})})}).finally(function(){s(function(a){return Object(l.a)(Object(l.a)({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function ya(c){var n=Object(j.useState)({loading:!1}),t=Object(W.a)(n,2),s=t[0],a=t[1];return Object(j.useEffect)(function(){c!==void 0&&(a(function(u){return Object(l.a)(Object(l.a)({},u),{},{loading:!0})}),da(c).then(function(u){u.success&&a(function(o){return Object(l.a)(Object(l.a)({},o),{},{data:u.data})})}).finally(function(){a(function(u){return Object(l.a)(Object(l.a)({},u),{},{loading:!1})})}))},[c]),{subjectGradeScales:s}}function Ca(c,n){var t=Object(j.useState)({loading:!1}),s=Object(W.a)(t,2),a=s[0],u=s[1];return Object(j.useEffect)(function(){typeof c!="number"||typeof n!="number"||(u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!0})}),Jt(c,n).then(function(o){o.success&&u(function(v){return Object(l.a)(Object(l.a)({},v),{},{data:o.data.grade_scale.map(function(f,y){return Object(l.a)(Object(l.a)({},f),{},{id:y})})})})}).finally(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!1})})}))},[c,n]),{tutorGradeScales:a}}function Ta(c,n){var t=Object(j.useState)({loading:!1}),s=Object(W.a)(t,2),a=s[0],u=s[1],o=Object(j.useCallback)(function(){u(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!0})}),Dt(c).then(function(f){if(f.success){var y=f.data.reduce(function(p,O){var S=O.attendances,m=Object(St.a)(O,_a),_=S.find(function(E){return E.user_id===n});return _?[].concat(Object(k.a)(p),[Object(l.a)(Object(l.a)({},m),{},{attendance:_})]):p},[]);u(function(p){return Object(l.a)(Object(l.a)({},p),{},{data:y})})}}).finally(function(){u(function(f){return Object(l.a)(Object(l.a)({},f),{},{loading:!1})})})},[c,n]),v=Object(j.useCallback)(function(f,y){u(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!0})}),Wt(f,n,y).then(function(p){p.success?ot.b.success(p.message):ot.b.error(p.message)}).finally(function(){o(),u(function(p){return Object(l.a)(Object(l.a)({},p),{},{loading:!1})})})},[o,n]);return Object(j.useEffect)(function(){o()},[o]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:o,updateUserAttendanceSchedules:v}}function Ma(c,n){var t=Object(j.useState)({loading:!1}),s=Object(W.a)(t,2),a=s[0],u=s[1];return Object(j.useEffect)(function(){!n||(u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!0})}),b({student_id:c,semester_subject_id:n}).then(function(o){if(o.success){var v=o.data.reduce(function(f,y){var p=Object(W.a)(y.results,1),O=p[0],S=Object(St.a)(y,xa);return O?[].concat(Object(k.a)(f),[Object(l.a)(Object(l.a)({},S),{},{result:O})]):f},[]);u(function(f){return Object(l.a)(Object(l.a)({},f),{},{data:v})})}}).finally(function(){u(function(o){return Object(l.a)(Object(l.a)({},o),{},{loading:!1})})}))},[c,n]),{studentExams:a}}function Pa(c,n){var t=Object(j.useState)({loading:!1}),s=Object(W.a)(t,2),a=s[0],u=s[1],o=Object(j.useState)({loading:!1}),v=Object(W.a)(o,2),f=v[0],y=v[1],p=Object(j.useState)({loading:!1}),O=Object(W.a)(p,2),S=O[0],m=O[1];return Object(j.useEffect)(function(){u(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!0})}),Object(Kt.e)({group_id:c}).then(function(_){_.success&&u(function(E){return Object(l.a)(Object(l.a)({},E),{},{data:_.data})})}).finally(function(){u(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!1})})})},[c]),Object(j.useEffect)(function(){!a.data||(m(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!0})}),Promise.all(a.data.map(function(_){var E=_.id;return Object(Kt.m)(Number(E))})).then(function(_){_.forEach(function(E){E.success&&m(function(g){return Object(l.a)(Object(l.a)({},g),{},{data:Object(l.a)(Object(l.a)({},g.data),{},Object(pt.a)({},Number(E.data.id),Object(ga.c)(E.data.lessons)))})})})}).finally(function(){m(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!1})})}),y(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!0})}),Promise.all(a.data.map(function(_){var E=_.id;return Object(Kt.l)(Number(E),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(g){if(g.success){var M,L,C=((M=g.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&M!==void 0?M:[]).filter(function(w){return w.id===n}),te=(L=g.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&L!==void 0?L:[];y(function(w){return Object(l.a)(Object(l.a)({},w),{},{data:Object(l.a)(Object(l.a)({},w.data),{},Object(pt.a)({},Number(E),{finishedTopics:C,attendanceList:te}))})})}})})).finally(function(){return y(function(_){return Object(l.a)(Object(l.a)({},_),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:f,userCoursesTopics:S}}var Da=[{title:Object(e.jsx)(r.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(r.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(r.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ia=[{title:Object(e.jsx)(r.a,{id:"date"}),dataIndex:"date_from",render:function(n,t){return Object(ze.a)(new Date(t.date_from),I.c)}}],Ra=[{title:Object(e.jsx)(r.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(r.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return Object(ze.a)(new Date(t.created_at),I.c)}},{title:Object(e.jsx)(r.a,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result,"%")}}],La=[{title:Object(e.jsx)(r.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(r.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var s,a;return(s=t.grade)!==null&&s!==void 0&&s.grade_date?Object(ze.a)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),I.c):"-"}},{title:Object(e.jsx)(r.a,{id:"grade"}),dataIndex:"grade",render:function(n,t){var s,a;return(s=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&s!==void 0?s:"-"}}],Et=6,Aa=function(n){var t,s,a=n.user_id,u=n.group_id,o=Object(Q.b)(),v=o.semester_subject_id,f=Ma(a,v),y=f.studentExams,p=Sa(u,a),O=p.finalGrades,S=Ea(),m=S.gradeTerms,_=ya((t=O.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),E=_.subjectGradeScales,g=Ca(v,(s=O.data)===null||s===void 0?void 0:s.tutor_id),M=g.tutorGradeScales,L=Ta(u,a),C=L.userAttendanceSchedules,te=L.updateUserAttendanceSchedules,w=Pa(u,a),ue=w.userCourses,Ie=w.userCoursesStats,he=w.userCoursesTopics,ce=D.a.useForm(),ae=Object(W.a)(ce,1),K=ae[0],J=Object(j.useMemo)(function(){var le;return((le=m.data)!==null&&le!==void 0?le:[]).map(function(Z){var $=Z.id,G=Z.name;return{label:G,value:$}})},[m.data]),je=Object(j.useMemo)(function(){var le;return((le=E.data)!==null&&le!==void 0?le:[]).map(function(Z){var $=Z.name,G=Z.id;return{label:$,value:G}})},[E.data]),X=Object(j.useMemo)(function(){var le,Z,$,G=((le=y.data)!==null&&le!==void 0?le:[]).reduce(function(me,We){var lt=We.result,vt=We.weight;return[me[0]+lt.result*vt,me[1]+vt]},[0,0]),xe=Object(W.a)(G,2),re=xe[0],be=xe[1],Re=Number.isNaN(re/be)?0:re/be,Ke=((Z=M.data)!==null&&Z!==void 0?Z:[]).sort(function(me,We){return me.grade_value-We.grade_value}).reduce(function(me,We){return[].concat(Object(k.a)(me),[Object(l.a)(Object(l.a)({},We),{},{isWeightedAverageGreater:Re>=We.grade_value})])},[]);if(Ke.every(function(me){var We=me.isWeightedAverageGreater;return We})){var Ye;return(Ye=Ke.at(-1))===null||Ye===void 0?void 0:Ye.name}var bt=Ke.findIndex(function(me){var We=me.isWeightedAverageGreater;return!We});return bt<0?"":($=Ke[bt-1])===null||$===void 0?void 0:$.name},[y.data,M.data]),ee=Object(j.useCallback)(function(){var le=Object(h.a)(Object(x.a)().mark(function Z($){var G,xe,re,be,Re,Ke,Ye;return Object(x.a)().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(re=$.grade_scale_id,be=$.grade_term_id,((G=O.data)===null||G===void 0?void 0:G.id)!==void 0){me.next=3;break}return me.abrupt("return");case 3:if(Re=(xe=O.data)===null||xe===void 0?void 0:xe.grades.find(function(We){var lt=We.grade_term;return lt.id===be}),!Re){me.next=11;break}return me.next=7,ja(Re.id,{grade_scale_id:re});case 7:return Ke=me.sent,ot.b[Ke.success?"success":"error"](Ke.message),Ke.success&&r.f.push("/teacher/subjects/".concat(v,"/final-grades")),me.abrupt("return");case 11:return me.next=13,oa({grade_scale_id:re,grade_term_id:be,lesson_group_user_id:O.data.id});case 13:Ye=me.sent,ot.b[Ye.success?"success":"error"](Ye.message),Ye.success&&r.f.push("/teacher/subjects/".concat(v,"/final-grades"));case 16:case"end":return me.stop()}},Z)}));return function(Z){return le.apply(this,arguments)}}(),[O.data,v]),fe=Object(j.useMemo)(function(){var le;return((le=m.data)!==null&&le!==void 0?le:[]).map(function(Z){var $;return Object(l.a)(Object(l.a)({},Z),{},{grade:($=O.data)===null||$===void 0?void 0:$.grades.find(function(G){var xe=G.grade_term;return xe.id===Z.id})})})},[O.data,m.data]);return O.loading?Object(e.jsx)(Oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[O.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(nt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.Student",values:O.data.user})}),Object(e.jsx)(zt.a,{})]}),Object(e.jsxs)(ve.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Et},dataSource:y.data,loading:y.loading,columns:Ra,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Et},dataSource:fe,loading:O.loading||m.loading,columns:La,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:C.data,loading:C.loading,columns:[].concat(Ia,[{title:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Z,$){return Object(e.jsx)(Vt.a,{onChange:function(xe){return te($.id,xe.target.checked?P.a.PRESENT:P.a.ABSENT)},checked:$.attendance.value===P.a.PRESENT})}}])})}),Object(e.jsx)(we.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:M.data,loading:M.loading,columns:Da})}),ue.loading&&!ue.data||Ie.loading&&!Ie.data||he.loading&&!he.data&&Object(e.jsx)(Oe.a,{}),ue.data&&Ie.data&&he.data&&ue.data.map(function(le){var Z,$,G,xe,re,be,Re,Ke,Ye=le.id,bt=le.title;return Object(e.jsxs)(we.a,{span:24,children:[Object(e.jsx)(nt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:bt}),Object(e.jsx)(Zt.c,{topics:(Z=($=he.data)===null||$===void 0?void 0:$[Number(Ye)])!==null&&Z!==void 0?Z:[],stats:(G=(xe=Ie.data)===null||xe===void 0||(re=xe[Number(Ye)])===null||re===void 0?void 0:re.finishedTopics)!==null&&G!==void 0?G:[]}),Object(e.jsx)(Zt.a,{stats:(be=(Re=Ie.data)===null||Re===void 0||(Ke=Re[Number(Ye)])===null||Ke===void 0?void 0:Ke.attendanceList)!==null&&be!==void 0?be:[]})]},Ye)})]}),Object(e.jsx)(D.a,{form:K,onFinish:ee,children:Object(e.jsxs)(D.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Yt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})}],label:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:J,width:"sm",fieldProps:{loading:m.loading}}),Object(e.jsx)(Yt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(r.a,{id:"field_required"})}],label:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:je,fieldProps:{loading:O.loading||E.loading}}),Object(e.jsx)(D.a.Item,{children:Object(e.jsx)(r.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:X}})})]})})]})},Ga=[{title:Object(e.jsx)(r.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:Object(e.jsx)(r.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:Object(e.jsx)(r.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(s){var a=s.grade_name,u=s.grade_term,o=s.id;return Object(e.jsxs)(nt.a.Text,{children:[u.name,": ",a]},o)}):"-"})}}],Fa=function(){var n,t,s=Object(Qe.k)(),a=Object(j.useMemo)(function(){var O,S,m,_;return{user_id:Number.isNaN(Number((O=s.query)===null||O===void 0?void 0:O.user_id))?null:Number((S=s.query)===null||S===void 0?void 0:S.user_id),group_id:Number.isNaN(Number((m=s.query)===null||m===void 0?void 0:m.group_id))?null:Number((_=s.query)===null||_===void 0?void 0:_.group_id)}},[(n=s.query)===null||n===void 0?void 0:n.user_id,(t=s.query)===null||t===void 0?void 0:t.group_id]),u=a.user_id,o=a.group_id,v=Object(Q.b)(),f=v.teacherSubjectData,y=v.semester_subject_id,p=Object(j.useMemo)(function(){var O;return((O=f==null?void 0:f.groups)!==null&&O!==void 0?O:[]).map(function(S){var m=S.id,_=S.name;return{label:_,value:m}})},[f==null?void 0:f.groups]);return u!==null&&o!==null?Object(e.jsx)(Aa,{user_id:u,group_id:o}):Object(e.jsx)(H.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var O=Object(h.a)(Object(x.a)().mark(function S(m){var _,E,g,M,L,C,te,w,ue,Ie;return Object(x.a)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return E=m.group_id,g=E===void 0?[]:E,M=m.first_name,L=M===void 0?"":M,C=m.last_name,te=C===void 0?"":C,w=((_=f==null?void 0:f.groups)!==null&&_!==void 0?_:[]).map(function(ae){var K=ae.id;return K}),ce.next=4,ua(g.length===0?w:g);case 4:if(ue=ce.sent,ue.success){ce.next=7;break}return ce.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ie=ue.data.filter(function(ae){var K=ae.user;return K.first_name.toLowerCase().includes(L.toLowerCase())&&K.last_name.toLowerCase().includes(te.toLowerCase())}),ce.abrupt("return",{success:!0,total:Ie.length,data:Ie});case 9:case"end":return ce.stop()}},S)}));return function(S){return O.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(r.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(S,m){return Object(e.jsx)(Xe.a,{type:"Students",type_id:m.group_id},m.group_id)}}].concat(Ga,[{title:Object(e.jsx)(r.a,{id:"options"}),hideInSearch:!0,render:function(S,m){return[Object(e.jsx)(Ce.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(m.user.id,"&group_id=").concat(m.group_id),children:Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"edit"}),children:Object(e.jsx)(_e.a,{type:"primary",icon:Object(e.jsx)(tt.a,{})})})},"edit")]}}])})},$a=i("dF/Y"),Ua=i("o+0V"),Xt=i("0WSk"),Na=["type","defaultRender"],Ba=["type","defaultRender"],wa=function(n){var t=n.url;return Object(e.jsx)(ke.a,{title:Object(e.jsx)(r.a,{id:"download"}),children:Object(e.jsx)(_e.a,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:Object(e.jsx)($a.a,{})})})},Ka=[{title:Object(e.jsx)(r.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(r.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return Object(ze.a)(new Date(t.created_at),I.a)}},{title:Object(e.jsx)(r.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,s){var a=t.type,u=t.defaultRender,o=Object(St.a)(t,Na);if(a==="form")return null;var v=s.getFieldValue("state");return Object(e.jsx)(Xt.a,Object(l.a)(Object(l.a)({},o),{},{state:{type:v}}))},render:function(n,t){return Object(e.jsx)(Xe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id},t.created_by.id)}},{title:Object(e.jsx)(r.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return Object(ze.a)(new Date(t.exported_at),I.a)}},{title:Object(e.jsx)(r.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,s){var a=t.type,u=t.defaultRender,o=Object(St.a)(t,Ba);if(a==="form")return null;var v=s.getFieldValue("state");return Object(e.jsx)(Xt.a,Object(l.a)(Object(l.a)({},o),{},{state:{type:v}}))},render:function(n,t){return Object(e.jsx)(Xe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id},t.exported_by.id)}},{title:Object(e.jsx)(r.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(r.a,{id:"options"}),valueType:"option",render:function(n,t){return[Object(e.jsx)(wa,{url:t.url},"download")]}}],Wa=function(){var n,t,s=Object(Q.b)(),a=s.teacherSubjectData,u=Object(j.useMemo)(function(){var v;return((v=a==null?void 0:a.groups)!==null&&v!==void 0?v:[]).map(function(f){var y=f.id,p=f.name;return{value:y,label:p}})},[a==null?void 0:a.groups]),o=Object(j.useMemo)(function(){var v,f;return[{title:Object(e.jsx)(r.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:u,defaultValue:a==null||(v=a.groups)===null||v===void 0||(f=v[0])===null||f===void 0?void 0:f.id,allowClear:!1}}].concat(Ka)},[a==null||(n=a.groups)===null||n===void 0||(t=n[0])===null||t===void 0?void 0:t.id,u]);return Object(e.jsx)(H.a,{className:"table-standalone",request:function(){var v=Object(h.a)(Object(x.a)().mark(function f(y){var p,O,S,m,_,E,g;return Object(x.a)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return S=y.group_id,m=S===void 0?a==null||(p=a.groups)===null||p===void 0||(O=p[0])===null||O===void 0?void 0:O.id:S,_=y.created_by,E=y.exported_by,L.next=3,Object(Ua.a)({group_id:m,created_by:_,exported_by:E});case 3:if(g=L.sent,g.success){L.next=6;break}return L.abrupt("return",{success:!1,data:[],total:0});case 6:return L.abrupt("return",{success:!0,data:g.data,total:g.data.length});case 7:case"end":return L.stop()}},f)}));return function(f){return v.apply(this,arguments)}}(),columns:o,search:{layout:"vertical"},scroll:{x:1500}})},Va=i("LvDl"),Ha=function(n){var t=n.exam_id,s=n.result,a=n.student_id,u=n.onSuccess,o=Object(j.useCallback)(Object(Va.debounce)(function(v){ge(t,a,{result:v!=null?v:0}).then(function(f){f.success&&(u==null||u(f.data))})},300),[t,s,a]);return Object(e.jsx)(Ee.a,{type:"number",min:0,max:100,onChange:o,defaultValue:s})},za=function(){var n,t,s=Object(Q.b)(),a=s.teacherSubjectData,u=Object(j.useState)([]),o=Object(W.a)(u,2),v=o[0],f=o[1],y=Object(j.useState)(a==null||(n=a.groups)===null||n===void 0||(t=n[0])===null||t===void 0?void 0:t.name),p=Object(W.a)(y,2),O=p[0],S=p[1],m=Object(j.useMemo)(function(){var g;return((g=a==null?void 0:a.groups)!==null&&g!==void 0?g:[]).map(function(M){var L=M.id,C=M.name;return{value:L,label:C}})},[a==null?void 0:a.groups]),_=Object(j.useRef)(),E=Object(j.useMemo)(function(){var g;return[{title:Object(e.jsx)(r.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:m,defaultValue:m==null||(g=m[0])===null||g===void 0?void 0:g.value,allowClear:!1}},{title:Object(e.jsx)(r.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(k.a)(v))},[m,v]);return Object(e.jsx)(H.a,{className:"table-standalone",request:function(){var g=Object(h.a)(Object(x.a)().mark(function M(L){var C,te,w,ue,Ie,he,ce,ae,K,J,je,X,ee,fe;return Object(x.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return te=L.group_id,w=te===void 0?(C=m[0])===null||C===void 0?void 0:C.value:te,ue=L.full_name,Ie=ue===void 0?"":ue,Z.next=3,Promise.all([Object(jt.b)(w),Dt(w),b({group_id:w,per_page:-1})]);case 3:if(he=Z.sent,ce=Object(W.a)(he,3),ae=ce[0],K=ce[1],J=ce[2],je=m.find(function($){var G=$.value;return G===w}),!(!ae.success||!K.success||!J.success||!je)){Z.next=11;break}return Z.abrupt("return",{data:[],total:0,success:!1});case 11:return X=K.data.reduce(function($,G){return[].concat(Object(k.a)($),[{title:String(Object(ze.a)(new Date(G.date_from),I.c)),dataIndex:String(G.date_from),hideInSearch:!0,width:100,align:"center",render:function(re,be){return Object(e.jsx)(Ht,{groupAttendanceScheduleId:G.id,defaultChecked:be["".concat(G==null?void 0:G.date_from)]===P.a.PRESENT,studentId:be.id})}}])},[]),ee=J.data.reduce(function($,G){return[].concat(Object(k.a)($),[{dataIndex:"exam-".concat(G.id),title:Object(e.jsx)(r.a,{id:"examTitleWithWeight",values:G}),hideInSearch:!0,width:100,render:function(re,be){var Re;return(be==null||(Re=be["exam-".concat(G.id)])===null||Re===void 0?void 0:Re.result)!==void 0?Object(e.jsx)(Ha,{result:be==null?void 0:be["exam-".concat(G.id)].result,exam_id:G.id,student_id:be.id}):"-"}}])},[]),S(je.label),f([{title:Object(e.jsx)(r.a,{id:"attendance"}),children:X},{title:Object(e.jsx)(r.a,{id:"exams"}),children:ee}].filter(function($){var G=$.children;return G.length})),fe=ae.data.users.reduce(function($,G){var xe=G.id,re=G.academic_teacher_id,be=G.first_name,Re=G.last_name,Ke="".concat(Re," ").concat(be);if(re!==null||!Ke.toLowerCase().includes(Ie.toLowerCase()))return $;var Ye=K.data.reduce(function(me,We){var lt=We.attendances.find(function(vt){return vt.user_id===xe});return lt?Object(l.a)(Object(l.a)({},me),{},Object(pt.a)({},"".concat(We.date_from),lt.value)):me},{}),bt=J.data.reduce(function(me,We){var lt=We.results.find(function(vt){return vt.user_id===xe});return lt?Object(l.a)(Object(l.a)({},me),{},Object(pt.a)({},"exam-".concat(We.id),lt)):me},{});return[].concat(Object(k.a)($),[Object(l.a)(Object(l.a)({id:xe,full_name:Ke},Ye),bt)])},[]).sort(function($,G){return $.full_name.localeCompare(G.full_name)}),Z.abrupt("return",{data:fe,total:fe.length,success:!0});case 17:case"end":return Z.stop()}},M)}));return function(M){return g.apply(this,arguments)}}(),columns:E,headerTitle:Object(e.jsx)(r.a,{id:"classRegisterTitleWithGroupName",values:{groupName:O}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:_,pagination:{onChange:function(){var M;return(M=_.current)===null||M===void 0?void 0:M.reload()}},rowKey:"id"})},Ja=function(n){var t,s,a=n.tab,u=Object(r.l)(),o=Object(r.m)("@@initialState"),v=o.setInitialState,f=o.initialState,y=Object(Q.b)(),p=y.teacherSubjectData,O=y.semester_subject_id,S=y.tutors,m=Object(j.useCallback)(Object(Ae.a)(f==null?void 0:f.currentUser),[f==null?void 0:f.currentUser]),_=Object(j.useMemo)(function(){return!!S.data.find(function(E){var g,M=E.id;return M===(f==null||(g=f.currentUser)===null||g===void 0?void 0:g.id)})||m(Be.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(de.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(r.a,{id:p==null||(t=p.subject)===null||t===void 0?void 0:t.name}),", ",Object(e.jsx)(r.a,{id:a})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Ce.a,{to:"/teacher/subjects/".concat(O,"/exams?exam_id=new"),children:Object(e.jsx)(_e.a,{type:"primary",children:Object(e.jsx)(r.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:u.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:u.formatMessage({id:"Subjects"})},{path:String(O),breadcrumbName:String((s=p.subject)===null||s===void 0?void 0:s.name)},{path:String(a),breadcrumbName:u.formatMessage({id:a,defaultMessage:String(a)})}]}},children:Object(e.jsxs)(d.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(g){v(Object(l.a)({},f)),r.f.push("/teacher/subjects/".concat(O,"/").concat(g))}},children:[Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"groups"}),children:Object(e.jsx)(Ve.a,{})},"groups"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"students"}),children:Object(e.jsx)(ta,{})},"students"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"exams"}),children:Object(e.jsx)(at,{})},"exams"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"schedule"}),children:Object(e.jsx)(pa,{})},"schedule"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"class-register"}),children:Object(e.jsx)(za,{})},"class-register"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"attendance"}),children:Object(e.jsx)(na,{})},"attendance"),_&&Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"grades-scale"}),children:Object(e.jsx)(ma,{})},"grades-scale"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"final-grades"}),children:Object(e.jsx)(Fa,{})},"final-grades"),Object(e.jsx)(d.a.TabPane,{tab:Object(e.jsx)(r.a,{id:"file-exports-history"}),children:Object(e.jsx)(Wa,{})},"file-exports-history")]})}):Object(e.jsx)(Oe.a,{})},en=ye.default=function(){var c=Object(Qe.l)(),n=c.subjectId,t=c.tab,s=t===void 0?"groups":t;return Object(e.jsx)(Q.a,{semester_subject_id:Number(n),children:Object(e.jsx)(Ja,{tab:s})})}},p3I6:function(mt,ye,i){"use strict";i.d(ye,"b",function(){return Q}),i.d(ye,"c",function(){return Te}),i.d(ye,"a",function(){return it});var l=i("miYZ"),Le=i("tsqr"),_e=i("tJVT"),R=i("k1fw"),Oe=i("oBTY"),j=i("q1tI"),r=i.n(j),Ce=i("9kvl"),Qe=i("Ty5D"),d=i("H6aw"),de=i("/y+f"),Be=i("nKUr"),Ae=i.n(Be),Q=r.a.createContext({}),Ve=function(){return Math.round(Math.random()*99999)},dt=function pe(se){return se.reduce(function(U,T){return[].concat(Object(Oe.a)(U),Object(Oe.a)(T.lessons?pe(T.lessons):[]),[T])},[])},Te=function pe(se){return se.reduce(function(U,T){var B;return[].concat(Object(Oe.a)(U),Object(Oe.a)(T.lessons?pe(T.lessons):[]),Object(Oe.a)((B=T.topics)!==null&&B!==void 0?B:[]))},[])},st=function pe(se,U,T){return se.map(function(B){var H,I;return Object(R.a)(Object(R.a)({},B),{},{lessons:B.lessons?pe(B.lessons,U,T):[],topics:B.id===U?[].concat(Object(Oe.a)((H=B.topics)!==null&&H!==void 0?H:[]),[T]):(I=B.topics)!==null&&I!==void 0?I:[]})})},ke=function pe(se,U,T){return T?se.map(function(B){return Object(R.a)(Object(R.a)({},B),{},{lessons:[].concat(Object(Oe.a)(B.lessons?pe(B.lessons,U,T):[]),Object(Oe.a)(B.id===T?[U]:[]))})}):[].concat(Object(Oe.a)(se),[U])},x=function pe(se,U,T){return se.map(function(B){return Object(R.a)(Object(R.a)({},B.id===U?T:B),{},{lessons:B.lessons?pe(B.lessons,U,T):[]})})},h=function pe(se,U){return se.map(function(T){return Object(R.a)(Object(R.a)({},T),{},{parent_id:U,lessons:T.lessons?pe(T.lessons,T.id):[]})})},ze=function pe(se,U){return se.filter(function(T){return T.id!==U}).map(function(T){return Object(R.a)(Object(R.a)({},T),{},{lessons:T.lessons?pe(T.lessons,U):[]})})},tt=function pe(se,U){return se.map(function(T){return Object(R.a)(Object(R.a)({},T),{},{lessons:T.lessons?pe(T.lessons,U):[],topics:T.topics?T.topics.filter(function(B){return B.id!==U}):[]})})},Je=function pe(se,U,T,B){return B==null?void 0:B.map(function(H){if(H.id===T){var I;return Object(R.a)(Object(R.a)({},H),{},{topics:(I=H.topics)===null||I===void 0?void 0:I.map(function(b){return b.id===se?U.file.response.data:b})})}else if(H.lessons)return Object(R.a)(Object(R.a)({},H),{},{lessons:pe(se,U,T,H.lessons||[])});return H})},it=function(se){var U=se.children,T=se.id,B=Object(j.useState)(),H=Object(_e.a)(B,2),I=H[0],b=H[1],Me=Object(Ce.l)(),Ne=Object(j.useMemo)(function(){return I&&I.lessons?Te(I.lessons):[]},[I]),Pe=Object(j.useMemo)(function(){return I&&I.lessons?dt(I.lessons):[]},[I]),Ge=Object(j.useState)([]),Se=Object(_e.a)(Ge,2),Fe=Se[0],He=Se[1],A=Object(Qe.k)();Object(j.useEffect)(function(){He([])},[]);var N=Object(j.useCallback)(function(){Object(d.m)(T).then(function(D){return D.success&&b(Object(R.a)(Object(R.a)({},D.data),{},{lessons:h(D.data.lessons)}))})},[T]);Object(j.useEffect)(function(){N()},[N]);var ge=Object(j.useCallback)(function(D){var F=Pe.find(function(V){var P;return V==null||(P=V.topics)===null||P===void 0?void 0:P.find(function(Y){return Y.id===D})});return F?F.id:null},[Pe]),qe=Object(j.useMemo)(function(){var D,F;return(D=A.query)!==null&&D!==void 0&&D.lesson?{mode:"lesson",id:Number(A.query.lesson),value:Pe.find(function(V){return V.id===Number(A.query.lesson)})}:(F=A.query)!==null&&F!==void 0&&F.topic?{mode:"topic",id:Number(A.query.topic),value:Ne.find(function(V){return V.id===Number(A.query.topic)})}:{mode:"init"}},[A.query,I,Pe,Ne]),ut=Object(j.useCallback)(function(D){var F={course_id:T,topics:[],isNew:!0,id:I?I.lessons.length+1:Ve(),order:0,title:Me.formatMessage({id:"add_title_here"}),active:!0,parent_id:D};return b(function(V){var P;return Object(R.a)(Object(R.a)({},V),{},{lessons:ke((P=V==null?void 0:V.lessons)!==null&&P!==void 0?P:[],F,D)})}),F},[T,I]),Ze=Object(j.useCallback)(function(D,F){var V=Pe.find(function(Y){return Y.id===D}),P=V&&V.isNew;return(P?Object(d.g)(F):Object(d.u)(D,F)).then(function(Y){return Le.b.success(Y.message),N(),Y.success&&b(function(z){var k;return Object(R.a)(Object(R.a)({},z),{},{lessons:x((k=z==null?void 0:z.lessons)!==null&&k!==void 0?k:[],D,Object(R.a)(Object(R.a)({},Y.data),{},{isNew:!1}))})})})},[I]),Xe=Object(j.useCallback)(function(D){var F=Pe.find(function(P){return P.id===D});if(!!F){var V=F.isNew;V?b(function(P){var Y;return Object(R.a)(Object(R.a)({},P),{},{lessons:ze((Y=P==null?void 0:P.lessons)!==null&&Y!==void 0?Y:[],D)})}):Object(d.o)(D).then(function(P){P.success&&(Le.b.success(P.message),b(function(Y){var z;return Object(R.a)(Object(R.a)({},Y),{},{lessons:ze((z=Y==null?void 0:Y.lessons)!==null&&z!==void 0?z:[],D)})}))})}},[I]),ct=Object(j.useCallback)(function(D,F){var V,P=ge(D),Y=Pe.find(function(et){return et.id===P}),z=Y&&((V=Y.topics)===null||V===void 0?void 0:V.find(function(et){return et.id===D})),k=z==null?void 0:z.isNew;return(k?Object(d.h)(F):Object(d.v)(D,F)).then(function(et){et.success&&(Le.b.success(et.message),N(),Ce.f.push("/courses/list/".concat(T,"/program/?topic=").concat(et.data.id)),(z==null?void 0:z.topicable_type)===de.f.Video&&setTimeout(function(){N()},5e3))})},[ge,I,N]),Ee=Object(j.useCallback)(function(D){var F=ge(D),V=Pe.find(function(z){return z.id===F});if(!!V){var P=Ne==null?void 0:Ne.find(function(z){return z.id===D}),Y=P==null?void 0:P.isNew;Y&&!P.topicable?b(function(z){var k;return Object(R.a)(Object(R.a)({},z),{},{lessons:tt((k=z==null?void 0:z.lessons)!==null&&k!==void 0?k:[],D)})}):Object(d.p)(D).then(function(z){z.success&&(Le.b.success(z.message),b(function(k){var et;return Object(R.a)(Object(R.a)({},k),{},{lessons:tt((et=k==null?void 0:k.lessons)!==null&&et!==void 0?et:[],D)})}))})}},[I,ge]),W=Object(j.useCallback)(function(D,F){var V={lesson_id:D,isNew:!0,id:Ve(),title:Me.formatMessage({id:"add_title_here"}),active:!0,topicable_type:F};return b(function(P){var Y;return Object(R.a)(Object(R.a)({},P),{},{lessons:st((Y=P==null?void 0:P.lessons)!==null&&Y!==void 0?Y:[],D,V)})}),V},[]),ft=function(F,V){var P=ge(F);b(function(Y){return Object(R.a)(Object(R.a)({},Y),{},{lessons:Y?Je(F,V,P,Y.lessons||[]):[]})}),Ce.f.push("/courses/list/".concat(T,"/program/?topic=").concat(V.file.response.data.id))},ve=Object(j.useCallback)(function(D){return Object(d.d)(D).then(function(F){if(F.success){Le.b.success(F.message);var V=ge(D);b(function(P){var Y;return Object(R.a)(Object(R.a)({},P),{},{lessons:P?(Y=P.lessons)===null||Y===void 0?void 0:Y.map(function(z){if(z.id===V){var k=z.topics||[];return Object(R.a)(Object(R.a)({},z),{},{topics:[].concat(Object(Oe.a)(k),[F.data])})}return z}):[]})})}})},[I,ge]),gt=Object(j.useCallback)(function(D){return Object(d.c)(D).then(function(F){F.success&&(Le.b.success(F.message),b(function(V){return Object(R.a)(Object(R.a)({},V),{},{lessons:V?[].concat(Object(Oe.a)(V.lessons),[F.data]):[]})}))})},[]),we={state:I,h5ps:Fe,id:T,addNewLesson:ut,updateLesson:Ze,updateTopic:ct,deleteLesson:Xe,addNewTopic:W,deleteTopic:Ee,onTopicUploaded:ft,cloneTopic:ve,cloneLesson:gt,currentEditMode:qe,getLessons:N};return Object(Be.jsx)(Q.Provider,{value:we,children:U})}}}]);
