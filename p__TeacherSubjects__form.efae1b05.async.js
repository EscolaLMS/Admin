(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{"/y+f":function(ft,pe,u){"use strict";u.d(pe,"f",function(){return d}),u.d(pe,"d",function(){return P}),u.d(pe,"e",function(){return ie}),u.d(pe,"c",function(){return Je}),u.d(pe,"a",function(){return s}),u.d(pe,"b",function(){return We});var d;(function(m){m.Unselected="",m.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",m.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",m.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",m.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",m.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",m.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",m.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",m.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",m.Project="EscolaLms\\TopicTypeProject\\Models\\Project",m.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(d||(d={}));var ye;(function(m){m.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",m.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(ye||(ye={}));var ve;(function(m){m.draft="draft",m.published="published",m.archived="archived"})(ve||(ve={}));var P;(function(m){m.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",m.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",m.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(P||(P={}));var ie;(function(m){m.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(ie||(ie={}));var j;(function(m){m.cart_fixed="cart_fixed",m.cart_percent="cart_percent",m.product_fixed="product_fixed",m.product_percent="product_percent"})(j||(j={}));var Je;(function(m){m.MULTIPLE_CHOICE="multiple_choice",m.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",m.TRUE_FALSE="true_false",m.SHORT_ANSWERS="short_answers",m.MATCHING="matching",m.NUMERICAL_QUESTION="numerical_question",m.ESSAY="essay",m.DESCRIPTION="description"})(Je||(Je={}));var s;(function(m){m.PRESENT="present",m.ABSENT="absent"})(s||(s={}));var We;(function(m){m.Manual="manual",m.TeamsForms="teams_forms",m.TeamsLecture="teams_lecture",m.TestPortal="test_portal"})(We||(We={}))},"5R/X":function(ft,pe,u){},"5Syx":function(ft,pe,u){"use strict";u.d(pe,"c",function(){return Ue}),u.d(pe,"b",function(){return it}),u.d(pe,"a",function(){return be});var d=u("OaEy"),ye=u("2fM7"),ve=u("g9YV"),P=u("wCAj"),ie=u("BoS7"),j=u("Sdc0"),Je=u("jrin"),s=u("k1fw"),We=u("DYRE"),m=u("zeV3"),J=u("+BJd"),Le=u("mr32"),Ee=u("oBTY"),Ae=u("tJVT"),ee=u("q1tI"),dt=u.n(ee),Te=u("9kvl"),nt=u("Vpfc"),jt=u("nhC9"),Ve=u("LDJE"),b=u("nKUr"),W=u.n(b),$e=function(w){return w.topicable.content.contents?Object.values(w.topicable.content.contents)[0].library:"H5P"},Ue=function(w){var T=w.topics,K=w.stats,je=Object(ee.useState)(!1),M=Object(Ae.a)(je,2),v=M[0],ge=M[1],_e=Object(ee.useMemo)(function(){return[{title:Object(b.jsx)(Te.a,{id:"user"}),dataIndex:"id",render:function(Ce){return Object(b.jsx)(nt.a,{type:"App\\Models\\User",type_id:Ce})}},{title:Object(b.jsx)(Te.a,{id:"email"}),dataIndex:"email"}].concat(Object(Ee.a)(T.map(function(fe){var Ce,xe=(Ce=fe.topicable_type)===null||Ce===void 0?void 0:Ce.split("\\").pop();return xe==="H5P"&&(xe=$e(fe)),{render:function(G){var V=0,le=0;switch(G&&(G.started_at&&G.finished_at?V=1:G.started_at&&(V=2),le=G.seconds/60),V){case 1:return Object(b.jsxs)(m.b,{children:[Object(b.jsx)(Le.a,{color:"success",children:"F"}),v&&Object(b.jsxs)("small",{children:[le.toFixed(2),"m"]})]});case 2:return Object(b.jsxs)(m.b,{children:[Object(b.jsx)(Le.a,{color:"blue",children:"S"}),v&&Object(b.jsxs)("small",{children:[le.toFixed(2),"m"]})]});case 0:default:return Object(b.jsx)(dt.a.Fragment,{children:Object(b.jsx)(Le.a,{color:"error",children:"N"})})}},title:Object(b.jsxs)("small",{children:[Object(b.jsx)(Le.a,{children:xe})," ",fe.title]}),dataIndex:fe.id}})))},[T,v]),Re=Object(ee.useMemo)(function(){return K.map(function(fe){return T.reduce(function(Ce,xe){var Ne=fe.topics.find(function(G){return G.id===xe.id});return Object(s.a)(Object(s.a)({},Ce),{},Object(Je.a)({},Number(xe.id),Ne!=null?Ne:0))},{email:fe.email,id:fe.id})})},[K,T]);return Object(b.jsx)(P.a,{title:function(){return Object(b.jsxs)(m.b,{children:[Object(b.jsx)(Te.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(b.jsx)(Le.a,{color:"success",children:"F"}),Object(b.jsx)(Te.a,{id:"Started",defaultMessage:"Started:"})," ",Object(b.jsx)(Le.a,{color:"blue",children:"S"}),Object(b.jsx)(Te.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(b.jsx)(Le.a,{color:"error",children:"N"}),Object(b.jsx)(Te.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(b.jsx)(j.a,{checked:v,onChange:function(xe){return ge(xe)}})]})},columns:_e,dataSource:Re,size:"small",scroll:{x:1500}})},it=function(w){var T=w.stats,K=Object(ee.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(v){return Object(b.jsx)(nt.a,{type:"App\\Models\\User",type_id:v})}},{title:"email",dataIndex:"email"},{title:Object(b.jsx)(Te.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),je=Object(ee.useMemo)(function(){return T.map(function(M){var v=M.id,ge=M.email,_e=M.finished_at;return{id:v,email:ge,finished_at:_e}})},[T]);return Object(b.jsx)(P.a,{title:function(){return Object(b.jsx)(m.b,{children:Object(b.jsx)(Te.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:K,dataSource:je,size:"small",scroll:{x:500}})},be=function(w){var T=w.stats,K=Object(ee.useState)(null),je=Object(Ae.a)(K,2),M=je[0],v=je[1],ge=Object(ee.useState)(null),_e=Object(Ae.a)(ge,2),Re=_e[0],fe=_e[1],Ce=Object(Te.l)(),xe=Object(ee.useMemo)(function(){return T.flatMap(function(G){return Object.values(G.attempts).flatMap(function(V){var le=V.dates,qe=V.attempt,et=Object.values(le).flatMap(function(Xe){var He=Xe.date,Qe=Xe.seconds_total;return{date:He,attempt:qe,seconds_total:Qe,email:G.email}});return et})})},[T]),Ne={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(b.jsx)(jt.a,{title:Object(b.jsxs)(m.b,{children:[Object(b.jsx)(Te.a,{id:"course.interactions_time_in_days"}),Object(b.jsx)(ye.a,{showSearch:!0,value:M,onChange:function(V){v(V),fe(null)},placeholder:Object(b.jsx)(Te.a,{id:"select_person",defaultMessage:"Select a person"}),children:T.map(function(G){var V=G.id,le=G.email;return Object(b.jsx)(ye.a.Option,{value:le,children:le},V)})}),Object(b.jsx)(ye.a,{value:Re,onChange:function(V){return fe(V)},disabled:M===null,placeholder:Object(b.jsx)(Te.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Ee.a)(new Set(xe.filter(function(G){var V=G.email;return V===M}).map(function(G){var V=G.attempt;return V}))).map(function(G){return Object(b.jsxs)(ye.a.Option,{value:G,children:[Object(b.jsx)(Te.a,{id:"attempt",defaultMessage:"Attempt"})," ",G]},G)})})]}),colSpan:12,layout:"center",children:Object(b.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(b.jsx)(Ve.a,Object(s.a)(Object(s.a)({},Ne),{},{tooltip:{title:"".concat(Ce.formatMessage({id:"attempt"})),formatter:function(V){var le=Math.floor(+V.seconds_total/60),qe=+V.seconds_total>60?+V.seconds_total-le*60:0;return{name:V.attempt,value:"".concat(le,"m ").concat(qe,"s")}}},data:xe.filter(function(G){var V=G.email;return V===M}).filter(function(G){var V=G.attempt;return Number.isInteger(Re)?V===Re:!0})}))})})}},Hn4i:function(ft,pe,u){"use strict";var d=u("y8nQ"),ye=u("Vl3Y"),ve=u("+L6B"),P=u("2/Rp"),ie=u("rePB"),j=u("ODXe"),Je=u("Ff2n"),s=u("x+uP"),We=u("HaE+"),m=u("VTBJ"),J=u("nKUr"),Le=u.n(J),Ee=u("xvlK"),Ae=u("WuYN"),ee=u("VMEa"),dt=u("LQCs"),Te=u("ft2k"),nt=u("uX+g"),jt=u("+i8S"),Ve=u("ipCM"),b=u("6cGi"),W=u("ub+h"),$e=u("bG1m"),Ue=u("q1tI"),it=u.n(Ue),be=u("mWMg"),ne=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],w=["record","position","creatorButtonText","newRecordType","parentKey","style"],T=it.a.createContext(void 0);function K(v){var ge=v.children,_e=v.record,Re=v.position,fe=v.newRecordType,Ce=v.parentKey,xe=Object(Ue.useContext)(T);return it.a.cloneElement(ge,Object(m.a)(Object(m.a)({},ge.props),{},{onClick:function(){var Ne=Object(We.a)(Object(s.a)().mark(function V(le){var qe,et,Xe,He;return Object(s.a)().wrap(function(Me){for(;;)switch(Me.prev=Me.next){case 0:return Me.next=2,(qe=(et=ge.props).onClick)===null||qe===void 0?void 0:qe.call(et,le);case 2:if(He=Me.sent,He!==!1){Me.next=5;break}return Me.abrupt("return");case 5:xe==null||(Xe=xe.current)===null||Xe===void 0||Xe.addEditRecord(_e,{position:Re,newRecordType:fe,parentKey:Ce});case 6:case"end":return Me.stop()}},V)}));function G(V){return Ne.apply(this,arguments)}return G}()}))}function je(v){var ge,_e,Re=Object(dt.d)(),fe=v.onTableChange,Ce=v.maxLength,xe=v.formItemProps,Ne=v.recordCreatorProps,G=v.rowKey,V=v.controlled,le=v.defaultValue,qe=v.onChange,et=v.editableFormRef,Xe=Object(Je.a)(v,ne),He=Object(Te.a)(v.value),Qe=Object(Ue.useRef)(),Me=Object(Ue.useRef)();Object(Ue.useImperativeHandle)(Xe.actionRef,function(){return Qe.current});var Ot=Object(b.a)(function(){return v.value||le||[]},{value:v.value,onChange:v.onChange}),N=Object(j.a)(Ot,2),me=N[0],ht=N[1],lt=it.a.useMemo(function(){return typeof G=="function"?G:function(De,k){return De[G]||k}},[G]),I=function(k){if(typeof k=="number"&&!v.name){if(k>=me.length)return k;var ae=me&&me[k];return lt==null?void 0:lt(ae,k)}if((typeof k=="string"||k>=me.length)&&v.name){var se=me.findIndex(function(ce,Se){var Ie;return(lt==null||(Ie=lt(ce,Se))===null||Ie===void 0?void 0:Ie.toString())===(k==null?void 0:k.toString())});return se}return k};Object(Ue.useImperativeHandle)(et,function(){var De=function(se){var ce,Se;if(se==null)throw new Error("rowIndex is required");var Ie=I(se),rt=[v.name,(ce=Ie==null?void 0:Ie.toString())!==null&&ce!==void 0?ce:""].flat(1).filter(Boolean);return(Se=Me.current)===null||Se===void 0?void 0:Se.getFieldValue(rt)},k=function(){var se,ce=[v.name].flat(1).filter(Boolean);if(Array.isArray(ce)&&ce.length===0){var Se,Ie=(Se=Me.current)===null||Se===void 0?void 0:Se.getFieldsValue();return Array.isArray(Ie)?Ie:Object.keys(Ie).map(function(rt){return Ie[rt]})}return(se=Me.current)===null||se===void 0?void 0:se.getFieldValue(ce)};return Object(m.a)(Object(m.a)({},Me.current),{},{getRowData:De,getRowsData:k,setRowData:function(se,ce){var Se,Ie,rt,xt;if(se==null)throw new Error("rowIndex is required");var vt=I(se),Vt=[v.name,(Se=vt==null?void 0:vt.toString())!==null&&Se!==void 0?Se:""].flat(1).filter(Boolean),bt=((Ie=Me.current)===null||Ie===void 0||(rt=Ie.getFieldsValue)===null||rt===void 0?void 0:rt.call(Ie))||{},Ct=Object($e.a)(bt,Vt,Object(m.a)(Object(m.a)({},De(se)),ce||{}));return(xt=Me.current)===null||xt===void 0?void 0:xt.setFieldsValue(Ct)}})}),Object(Ue.useEffect)(function(){!v.controlled||me.forEach(function(De,k){var ae;(ae=Me.current)===null||ae===void 0||ae.setFieldsValue(Object(ie.a)({},lt(De,k),De))},{})},[me,v.controlled]),Object(Ue.useEffect)(function(){if(v.name){var De;Me.current=v==null||(De=v.editable)===null||De===void 0?void 0:De.form}},[(ge=v.editable)===null||ge===void 0?void 0:ge.form,v.name]);var D=Ne||{},H=D.record,$=D.position,R=D.creatorButtonText,Y=D.newRecordType,Pe=D.parentKey,re=D.style,Wt=Object(Je.a)(D,w),pt=$==="top",mt=Object(Ue.useMemo)(function(){return Ce&&Ce<=(me==null?void 0:me.length)?!1:Ne!==!1&&Object(J.jsx)(K,{record:Object(nt.a)(H,me==null?void 0:me.length,me)||{},position:$,parentKey:Object(nt.a)(Pe,me==null?void 0:me.length,me),newRecordType:Y,children:Object(J.jsx)(P.a,Object(m.a)(Object(m.a)({type:"dashed",style:Object(m.a)({display:"block",margin:"10px 0",width:"100%"},re),icon:Object(J.jsx)(Ee.a,{})},Wt),{},{children:R||Re.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ne,Ce,me==null?void 0:me.length]),e=Object(Ue.useMemo)(function(){return mt?pt?{components:{header:{wrapper:function(k){var ae,se=k.className,ce=k.children;return Object(J.jsxs)("thead",{className:se,children:[ce,Object(J.jsxs)("tr",{style:{position:"relative"},children:[Object(J.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:mt}),Object(J.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ae=Xe.columns)===null||ae===void 0?void 0:ae.length,children:mt})]})]})}}}}:{tableViewRender:function(k,ae){var se,ce;return Object(J.jsxs)(J.Fragment,{children:[(se=(ce=v.tableViewRender)===null||ce===void 0?void 0:ce.call(v,k,ae))!==null&&se!==void 0?se:ae,mt]})}}:{}},[pt,mt]),_t=Object(m.a)({},v.editable),Tt=Object(jt.a)(function(De,k){var ae,se,ce;if((ae=v.editable)===null||ae===void 0||(se=ae.onValuesChange)===null||se===void 0||se.call(ae,De,k),(ce=v.onValuesChange)===null||ce===void 0||ce.call(v,k,De),v.controlled){var Se;v==null||(Se=v.onChange)===null||Se===void 0||Se.call(v,k)}});return((v==null?void 0:v.onValuesChange)||((_e=v.editable)===null||_e===void 0?void 0:_e.onValuesChange)||v.controlled&&(v==null?void 0:v.onChange))&&(_t.onValuesChange=Tt),Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)(T.Provider,{value:Qe,children:Object(J.jsx)(be.a,Object(m.a)(Object(m.a)(Object(m.a)({search:!1,options:!1,pagination:!1,rowKey:G,revalidateOnFocus:!1},Xe),e),{},{tableLayout:"fixed",actionRef:Qe,onChange:fe,editable:Object(m.a)(Object(m.a)({},_t),{},{formProps:Object(m.a)({formRef:Me},_t.formProps)}),dataSource:me,onDataSourceChange:function(k){if(ht(k),v.name&&$==="top"){var ae,se=Object($e.a)({},[v.name].flat(1).filter(Boolean),k);(ae=Me.current)===null||ae===void 0||ae.setFieldsValue(se)}}}))}),v.name?Object(J.jsx)(Ae.a,{name:[v.name],children:function(k){var ae,se,ce=Object(W.a)(k,[v.name].flat(1)),Se=ce==null?void 0:ce.find(function(Ie,rt){return!Object(Ve.a)(Ie,He==null?void 0:He[rt])});return Se&&He&&(v==null||(ae=v.editable)===null||ae===void 0||(se=ae.onValuesChange)===null||se===void 0||se.call(ae,Se,ce)),null}}):null]})}function M(v){var ge=ee.a.useFormInstance();return v.name?Object(J.jsx)(ye.a.Item,Object(m.a)(Object(m.a)({style:{maxWidth:"100%"}},v==null?void 0:v.formItemProps),{},{name:v.name,children:Object(J.jsx)(je,Object(m.a)(Object(m.a)({},v),{},{editable:Object(m.a)(Object(m.a)({},v.editable),{},{form:ge})}))})):Object(J.jsx)(je,Object(m.a)({},v))}M.RecordCreator=K,pe.a=M},LDJE:function(ft,pe,u){"use strict";var d=u("q1tI"),ye=u.n(d),ve=u("ma/q"),P=u("ZIEt"),ie=u("QpZ9"),j=u("GzfL"),Je=u("Scwr"),s=function(m,J){var Le={};for(var Ee in m)Object.prototype.hasOwnProperty.call(m,Ee)&&J.indexOf(Ee)<0&&(Le[Ee]=m[Ee]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ae=0,Ee=Object.getOwnPropertySymbols(m);Ae<Ee.length;Ae++)J.indexOf(Ee[Ae])<0&&Object.prototype.propertyIsEnumerable.call(m,Ee[Ae])&&(Le[Ee[Ae]]=m[Ee[Ae]]);return Le},We=Object(d.forwardRef)(function(m,J){var Le=m.chartRef,Ee=m.style,Ae=Ee===void 0?{height:"inherit"}:Ee,ee=m.className,dt=m.loading,Te=m.loadingTemplate,nt=m.errorTemplate,jt=s(m,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),Ve=Object(P.a)(ve.a,jt),b=Ve.chart,W=Ve.container;return Object(d.useEffect)(function(){Object(ie.a)(Le,b.current)},[b.current]),Object(d.useImperativeHandle)(J,function(){return{getChart:function(){return b.current}}}),ye.a.createElement(j.a,{errorTemplate:nt},dt&&ye.a.createElement(Je.a,{loadingTemplate:Te,theme:m.theme}),ye.a.createElement("div",{className:ee,style:Ae,ref:W}))});pe.a=We},olry:function(ft,pe,u){"use strict";u.r(pe);var d=u("k1fw"),ye=u("+L6B"),ve=u("2/Rp"),P=u("T2oS"),ie=u("W9HT"),j=u("q1tI"),Je=u.n(j),s=u("9kvl"),We=u("55Ip"),m=u("Ty5D"),J=u("nhC9"),Le=u("tMyG"),Ee=u("my69"),Ae=u("huej"),ee=u("mJ0o"),dt=u("EhlZ"),Te=u("P2fV"),nt=u("NJEC"),jt=u("5Dmo"),Ve=u("3S7+"),b=u("qLMh"),W=u("9og8"),$e=u("sWYD"),Ue=u("G3dp"),it=u("VTBJ"),be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},ne=be,w=u("6VBw"),T=function(n,t){return j.createElement(w.a,Object(it.a)(Object(it.a)({},n),{},{ref:t,icon:ne}))};T.displayName="LineChartOutlined";var K=j.forwardRef(T),je=u("/MfK"),M=u("Qiat"),v=u("mGZj");function ge(i,n){return _e.apply(this,arguments)}function _e(){return _e=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(d.a)({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},i)})),_e.apply(this,arguments)}function Re(i,n){return fe.apply(this,arguments)}function fe(){return fe=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),fe.apply(this,arguments)}function Ce(i,n,t){return xe.apply(this,arguments)}function xe(){return xe=Object(W.a)(Object(b.a)().mark(function i(n,t,r){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),xe.apply(this,arguments)}function Ne(i,n){return G.apply(this,arguments)}function G(){return G=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),G.apply(this,arguments)}function V(i,n){return le.apply(this,arguments)}function le(){return le=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(d.a)({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),le.apply(this,arguments)}function qe(i,n,t,r){return et.apply(this,arguments)}function et(){return et=Object(W.a)(Object(b.a)().mark(function i(n,t,r,a){return Object(b.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(t),Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return o.stop()}},i)})),et.apply(this,arguments)}function Xe(i,n,t){return He.apply(this,arguments)}function He(){return He=Object(W.a)(Object(b.a)().mark(function i(n,t,r){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(t),Object(d.a)({method:"DELETE"},r||{})));case 1:case"end":return c.stop()}},i)})),He.apply(this,arguments)}var Qe=u("Vpfc"),Me=u("giR+"),Ot=u("fyUT"),N=u("tJVT"),me=u("14J3"),ht=u("BMrR"),lt=u("jCWc"),I=u("kPKH"),D=u("VMEa"),H=u("Qurx"),$=u("lR9U"),R=u("/y+f"),Y=u("2qtc"),Pe=u("kLXV"),re=u("oBTY"),Wt=u("OaEy"),pt=u("2fM7"),mt=u("DBJ/"),e=u("nKUr"),_t=function(n){var t=n.type,r=n.onDataConverted,a=n.groupSelectDisabled,c=Object(ee.b)(),o=c.semester_subject_id,f=c.teacherSubjectData,h=Object(j.useState)(null),y=Object(N.a)(h,2),O=y[0],_=y[1],x=Object(j.useMemo)(function(){var S;return((S=f==null?void 0:f.groups)!==null&&S!==void 0?S:[]).map(function(g){var C=g.id,L=g.name;return{label:L,value:C}})},[]),l={type:t,group_id:O,semester_subject_id:o},p=Object(j.useCallback)(function(S){if(S.success){var g=S.data.results.filter(function(C){var L=C.user_id;return L!==null});if(!g.length)return;r({exam_results:g,group_id:S.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(pt.a,{disabled:a,value:O,onChange:function(g){return _(g)},options:x,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(mt.a,{name:"file",url:"/api/admin/exams/parse",onUpload:p,onChange:function(g){return!g.fileList.length&&r(void 0)},maxFiles:1,data:l,disabled:!O})]})},Tt=function(n){var t=n.onDataConverted,r=Object(ee.b)(),a=r.teacherSubjectData,c=r.groupUsers,o=Object(j.useState)(null),f=Object(N.a)(o,2),h=f[0],y=f[1],O=Object(j.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(l){var p=l.id,S=l.name;return{label:S,value:p}})},[]),_=Object(j.useCallback)(function(x){var l;y(x);var p=(l=c.byId)===null||l===void 0?void 0:l[x];if(!!p){var S=p.users.reduce(function(g,C){var L=C.id,E=C.email,Z=C.first_name,z=C.last_name,Oe=C.academic_teacher_id;return Oe!==null?g:[].concat(Object(re.a)(g),[{email:E,first_name:Z,last_name:z,user_id:L,result:0}])},[]);t({group_id:x,exam_results:S})}},[c.byId]);return Object(e.jsx)(pt.a,{value:h,onChange:_,options:O,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},De=[R.b.TeamsLecture,R.b.TestPortal,R.b.TeamsForms],k=function(n){var t=n.open,r=n.closeModal,a=n.onSuccess,c=n.type,o=Object(ee.b)(),f=o.teacherSubjectData,h=o.fetchGroupUsers,y=Object(j.useState)(),O=Object(N.a)(y,2),_=O[0],x=O[1];return Object(j.useEffect)(function(){if(c===R.b.Manual&&t){var l;f==null||(l=f.groups)===null||l===void 0||l.forEach(function(p){var S=p.id;return h(S)})}},[c,t]),Object(e.jsxs)(Pe.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:t,onCancel:r,onOk:function(){_&&a(_)},okButtonProps:{disabled:!_},children:[De.includes(c)&&Object(e.jsx)(_t,{type:c,onDataConverted:x,groupSelectDisabled:!!_}),c===R.b.Manual&&Object(e.jsx)(Tt,{onDataConverted:x})]})},ae=function(n){var t=n.onSelect;return Object(e.jsxs)(ht.a,{gutter:[16,16],children:[Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(ve.a,{type:"primary",onClick:function(){return t(R.b.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(ve.a,{type:"primary",onClick:function(){return t(R.b.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(ve.a,{type:"primary",onClick:function(){return t(R.b.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(ve.a,{type:"primary",onClick:function(){return t(R.b.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},se=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ce=function(n){var t,r=n.exam_id,a=D.a.useForm(),c=Object(N.a)(a,1),o=c[0],f=Object(j.useState)(),h=Object(N.a)(f,2),y=h[0],O=h[1],_=Object(j.useState)(),x=Object(N.a)(_,2),l=x[0],p=x[1],S=Object(j.useState)(!1),g=Object(N.a)(S,2),C=g[0],L=g[1],E=Object(ee.b)(),Z=E.semester_subject_id,z=E.getGroupById,Oe=Object(j.useMemo)(function(){var B;return((B=l==null?void 0:l.exam_results)!==null&&B!==void 0?B:[]).map(function(A){var F=A.user_id;return F})},[l==null?void 0:l.exam_results]);Object(j.useEffect)(function(){var B=Number(r);r==="new"&&(O(void 0),p(void 0),o.resetFields()),r!=="new"&&!Number.isNaN(B)&&(L(!0),Ne(B).then(function(A){if(A.success){var F=A.data,ue=F.type,we=F.results,Ye=F.title,he=F.weight,Ge=F.passed_at,X=F.group_id;O(ue),p({group_id:X,exam_results:we}),o.setFieldsValue({title:Ye,weight:he,passed_at:Ge})}}).finally(function(){return L(!1)}))},[r]);var Be=Object(j.useCallback)(function(){O(void 0),p(void 0)},[]);return C?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(k,{open:Boolean(y&&!l),type:y,closeModal:Be,onSuccess:p}),Object(e.jsxs)(D.a,{form:o,submitter:y===void 0||!l?!1:void 0,onFinish:function(){var B=Object(W.a)(Object(b.a)().mark(function A(F){var ue,we,Ye,he,Ge,X,at,Fe,de,te;return Object(b.a)().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(we=l==null||(ue=l.exam_results)===null||ue===void 0?void 0:ue.every(function(Q){var oe=Q.result;return typeof oe=="number"&&oe>=0&&oe<=100}),!(l&&we&&typeof Z=="number")){U.next=17;break}if(Ye=F.title,he=F.passed_at,Ge=F.weight,X=Number(r),at=l.exam_results,Fe=l.group_id,de={type:y,semester_subject_id:Z,title:Ye,passed_at:he,weight:Ge,group_id:Fe,results:at},!Number.isNaN(X)){U.next=12;break}return U.next=9,Re(de);case 9:U.t0=U.sent,U.next=15;break;case 12:return U.next=14,Ce(X,de);case 14:U.t0=U.sent;case 15:te=U.t0,te.success&&s.f.push("/teacher/subjects/".concat(Z,"/exams"));case 17:return U.abrupt("return",!0);case 18:case"end":return U.stop()}},A)}));return function(A){return B.apply(this,arguments)}}(),onReset:Be,children:[Object(e.jsxs)(D.a.Group,{children:[Object(e.jsx)(H.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)($.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(D.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ot.a,{})})]}),y&&l&&Object(e.jsx)(M.a,{rowKey:"user_id",headerTitle:(t=z(l.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:Oe,onValuesChange:function(A,F){return p({group_id:l.group_id,exam_results:F})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:l.exam_results,columns:se}),!l&&Object(e.jsx)(ae,{onSelect:O})]})]})},Se=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Ie=function(n){var t=n.exam_id,r=Object(j.useState)(""),a=Object(N.a)(r,2),c=a[0],o=a[1];return Object(e.jsx)(M.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,request:Object(W.a)(Object(b.a)().mark(function f(){var h;return Object(b.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,Ne(t);case 2:if(h=O.sent,!h.success){O.next=6;break}return o(h.data.title),O.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return O.abrupt("return",[]);case 7:case"end":return O.stop()}},f)})),columns:Se})},rt=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(t.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&Object($e.a)(new Date(t.passed_at),v.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&Object($e.a)(new Date(t.created_at),v.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return Object(e.jsx)(Qe.a,{type:"Students",type_id:t.group_id},t.group_id)}}],xt=function(){var n,t,r=Object(j.useRef)(),a=Object(ee.b)(),c=a.semester_subject_id,o=Object(m.k)(),f=Object(j.useMemo)(function(){var O,_,x;return{exam_id:(O=(_=o.query)===null||_===void 0?void 0:_.exam_id)!==null&&O!==void 0?O:null,results:(x=o.query)===null||x===void 0?void 0:x.results}},[(n=o.query)===null||n===void 0?void 0:n.exam_id,(t=o.query)===null||t===void 0?void 0:t.results]),h=f.exam_id,y=f.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(Ie,{exam_id:Number(y)}):h!==null?Object(e.jsx)(ce,{exam_id:h}):Object(e.jsx)(M.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",request:function(){var O=Object(W.a)(Object(b.a)().mark(function _(x,l){var p,S,g,C;return Object(b.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=x.current,S=x.pageSize,c!==null){E.next=3;break}return E.abrupt("return",{data:[],total:0,success:!1});case 3:return g=l&&Object.entries(l)[0],E.next=6,ge({per_page:S,page:p,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:g&&g[0],order:g&&(g[1]==="ascend"?"ASC":"DESC")});case 6:if(C=E.sent,!C.success){E.next=9;break}return E.abrupt("return",{data:C.data,total:C.meta.total,success:!0});case 9:return E.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return E.stop()}},_)}));return function(_,x){return O.apply(this,arguments)}}(),columns:[].concat(rt,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(_,x){return[Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?exam_id=").concat(x.id),children:Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(ve.a,{type:"primary",icon:Object(e.jsx)(Ue.a,{})})})},"edit"),Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(x.semester_subject_id,"/exams?results=").concat(x.id),children:Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(ve.a,{icon:Object(e.jsx)(K,{})})})},"results"),Object(e.jsx)(nt.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(W.a)(Object(b.a)().mark(function l(){var p;return Object(b.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,V(x.id);case 2:p=g.sent,p.success&&r.current&&r.current.reload();case 4:case"end":return g.stop()}},l)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ve.a,{type:"primary",icon:Object(e.jsx)(je.a,{}),danger:!0})})},"delete")]}}])})},vt=u("o0Ox"),Vt=u("miYZ"),bt=u("tsqr"),Ct=u("4KAj");function kt(i,n){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(d.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Mt.apply(this,arguments)}var qt=function(n){var t=n.student_id,r=Object(j.useState)(!1),a=Object(N.a)(r,2),c=a[0],o=a[1],f=Object(j.useCallback)(Object(W.a)(Object(b.a)().mark(function h(){var y;return Object(b.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return o(!0),_.next=3,kt({user_id:t});case 3:if(y=_.sent,y.success){_.next=8;break}return bt.b.error(y.message),o(!1),_.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),o(!1);case 10:case"end":return _.stop()}},h)})),[]);return Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(ve.a,{loading:c,type:"primary",icon:Object(e.jsx)(Ct.a,{}),onClick:f})})},ea=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ta=function(n){return n.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},aa=function(n){return n.reduce(function(t,r){var a,c=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(o,f){return f.academic_teacher_id!==null?o:[].concat(Object(re.a)(o),[{group_id:r.id,group_name:r.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(Object(re.a)(t),Object(re.a)(c))},[])},na=function(){var n=Object(ee.b)(),t=n.teacherSubjectData,r=Object(j.useMemo)(function(){var a;return ta((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return Object(e.jsx)(M.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},request:function(){var a=Object(W.a)(Object(b.a)().mark(function c(o){var f,h,y,O,_,x,l,p,S;return Object(b.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return f=o.groups,h=o.first_name,y=h===void 0?"":h,O=o.last_name,_=O===void 0?"":O,x=o.email,l=x===void 0?"":x,C.next=3,Object(vt.a)({parent_id:t==null?void 0:t.group_id,"id[]":f});case 3:if(p=C.sent,p.success){C.next=6;break}return C.abrupt("return",{data:[],total:0,success:!1});case 6:return S=aa(p.data).filter(function(L){return L.first_name.toLowerCase().includes(y.toLowerCase())&&L.last_name.toLowerCase().includes(_.toLowerCase())&&L.email.toLowerCase().includes(l.toLowerCase())}),C.abrupt("return",{data:S,total:S.length,success:!0});case 8:case"end":return C.stop()}},c)}));return function(c){return a.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(ea,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,o){return[Object(e.jsx)(qt,{student_id:o.user_id},"teamsChat")]}}])})},St=u("jrin");function Pt(i,n){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(n),Object(d.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Dt.apply(this,arguments)}function Ht(i,n,t,r){return It.apply(this,arguments)}function It(){return It=Object(W.a)(Object(b.a)().mark(function i(n,t,r,a){return Object(b.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(d.a)({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return o.stop()}},i)})),It.apply(this,arguments)}var tn=u("sRBo"),zt=u("kaz8"),ra=function(n){var t=n.groupAttendanceScheduleId,r=n.studentId,a=n.defaultChecked,c=n.onSuccess,o=Object(j.useState)(!1),f=Object(N.a)(o,2),h=f[0],y=f[1],O=Object(j.useCallback)(function(_){y(!0),Ht(t,r,_.target.checked?R.a.PRESENT:R.a.ABSENT).then(function(x){x.success&&(c==null||c())}).finally(function(){return y(!1)})},[]);return Object(e.jsx)(zt.a,{disabled:h,defaultChecked:a,onChange:O})},Jt=ra,sa=function(){var n=Object(ee.b)(),t=n.teacherSubjectData,r=Object(j.useState)([]),a=Object(N.a)(r,2),c=a[0],o=a[1],f=Object(j.useState)(""),h=Object(N.a)(f,2),y=h[0],O=h[1],_=Object(s.l)(),x=Object(j.useRef)(),l=Object(j.useMemo)(function(){var S;return((S=t==null?void 0:t.groups)!==null&&S!==void 0?S:[]).map(function(g){var C=g.id,L=g.name;return{value:C,label:L}})},[t==null?void 0:t.groups]),p=Object(j.useMemo)(function(){var S;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:l,defaultValue:l==null||(S=l[0])===null||S===void 0?void 0:S.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(re.a)(c))},[l,c]);return Object(e.jsx)(M.a,{className:"table-standalone",headerTitle:"".concat(_.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var S=Object(W.a)(Object(b.a)().mark(function g(C){var L,E,Z,z,Oe,Be,B,A,F,ue,we;return Object(b.a)().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return E=C.group_id,Z=E===void 0?l==null||(L=l[0])===null||L===void 0?void 0:L.value:E,z=C.full_name,Oe=z===void 0?"":z,he.next=3,Promise.all([Object(vt.b)(Z),Pt(Z)]);case 3:if(Be=he.sent,B=Object(N.a)(Be,2),A=B[0],F=B[1],ue=l.find(function(Ge){var X=Ge.value;return X===Z}),!(!A.success||!F.success||!ue)){he.next=10;break}return he.abrupt("return",{data:[],total:0,success:!1});case 10:if(O(ue.label),F.data.length){he.next=15;break}return bt.b.warn(Object(e.jsx)(s.a,{id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),o([]),he.abrupt("return",{data:[],total:0,success:!0});case 15:return o(F.data.reduce(function(Ge,X){return[].concat(Object(re.a)(Ge),[{title:String(Object($e.a)(new Date(X.date_from),v.c)),dataIndex:String(X.date_from),hideInSearch:!0,width:100,align:"center",render:function(Fe,de){return Object(e.jsx)(Jt,{groupAttendanceScheduleId:X.id,defaultChecked:de["".concat(X==null?void 0:X.date_from)]===R.a.PRESENT,studentId:de.id})}}])},[])),we=A.data.users.reduce(function(Ge,X){var at=X.id,Fe=X.academic_teacher_id,de=X.first_name,te=X.last_name,q="".concat(te," ").concat(de);if(Fe!==null||!q.toLowerCase().includes(Oe.toLowerCase()))return Ge;var U=F.data.reduce(function(Q,oe){var Ke=oe.attendances.find(function(ut){return ut.user_id===at});return Ke?Object(d.a)(Object(d.a)({},Q),{},Object(St.a)({},"".concat(oe.date_from),Ke.value)):Q},{});return[].concat(Object(re.a)(Ge),[Object(d.a)({id:at,full_name:q},U)])},[]).sort(function(Ge,X){return Ge.full_name.localeCompare(X.full_name)}),he.abrupt("return",{data:we,total:we.length,success:!0});case 18:case"end":return he.stop()}},g)}));return function(g){return S.apply(this,arguments)}}(),columns:p,search:{layout:"vertical"},pagination:{onChange:function(){var g;return(g=x.current)===null||g===void 0?void 0:g.reload()}},scroll:{x:1500},actionRef:x,rowKey:"id"})},an=u("tU7J"),tt=u("wFql"),nn=u("/zsF"),Rt=u("PArb"),ua=u("Hn4i"),ca=u("bRQS");function Yt(i,n,t){return Lt.apply(this,arguments)}function Lt(){return Lt=Object(W.a)(Object(b.a)().mark(function i(n,t,r){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),Object(d.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),Lt.apply(this,arguments)}function ia(i,n,t,r){return At.apply(this,arguments)}function At(){return At=Object(W.a)(Object(b.a)().mark(function i(n,t,r,a){return Object(b.a)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),Object(d.a)({method:"POST",data:r},a||{})));case 1:case"end":return o.stop()}},i)})),At.apply(this,arguments)}function la(i,n){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(d.a)({method:"GET",params:{"groups[]":n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Gt.apply(this,arguments)}function da(i,n,t){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(W.a)(Object(b.a)().mark(function i(n,t,r){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),Object(d.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},i)})),Ft.apply(this,arguments)}function oa(i){return $t.apply(this,arguments)}function $t(){return $t=Object(W.a)(Object(b.a)().mark(function i(n){return Object(b.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(d.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},i)})),$t.apply(this,arguments)}function ja(i,n){return Ut.apply(this,arguments)}function Ut(){return Ut=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(n),Object(d.a)({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Ut.apply(this,arguments)}function ba(i,n){return Bt.apply(this,arguments)}function Bt(){return Bt=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(d.a)({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Bt.apply(this,arguments)}function ma(i,n,t){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(W.a)(Object(b.a)().mark(function i(n,t,r){return Object(b.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(d.a)({method:"PATCH",data:t},r||{})));case 1:case"end":return c.stop()}},i)})),Nt.apply(this,arguments)}var va=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],fa=function(n){var t=n.subjectTutorGradeScale,r=n.onFormSubmit,a=Object(j.useState)([]),c=Object(N.a)(a,2),o=c[0],f=c[1],h=Object(j.useRef)(),y=D.a.useForm(),O=Object(N.a)(y,1),_=O[0];return Object(j.useEffect)(function(){var x,l=((x=t.scale)!==null&&x!==void 0?x:[]).map(function(p,S){return Object(d.a)(Object(d.a)({},p),{},{id:String((S+1)*100)})});_.setFieldValue("table",l)},[]),Object(e.jsx)(D.a,{form:_,onFinish:r,submitter:{render:function(l,p){var S=Object(N.a)(p,2),g=S[1];return[g]}},children:Object(e.jsx)(ua.a,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(va,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(l,p){return Object(e.jsx)(ve.a,{type:"primary",onClick:function(){var g;return(g=h.current)===null||g===void 0?void 0:g.startEditable(p.id)},icon:Object(e.jsx)(Ue.a,{})})}}]),editable:{form:_,type:"multiple",editableKeys:o,saveText:Object(e.jsx)(ve.a,{type:"primary",icon:Object(e.jsx)(ca.a,{})}),onChange:f,actionRender:function(l,p,S){return[S.save]}}})})},Oa=function(){var n,t,r=Object(s.m)("@@initialState"),a=r.initialState,c=Object(ee.b)(),o=c.semester_subject_id,f=c.tutors,h=Object(j.useState)(),y=Object(N.a)(h,2),O=y[0],_=y[1],x=Object(j.useState)(!1),l=Object(N.a)(x,2),p=l[0],S=l[1],g=Object(j.useState)(null),C=Object(N.a)(g,2),L=C[0],E=C[1],Z=Object(j.useMemo)(function(){return!!f.data.find(function(B){var A,F=B.id;return F===(a==null||(A=a.currentUser)===null||A===void 0?void 0:A.id)})},[f.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),z=Object(j.useMemo)(function(){return f.data.map(function(B){var A=B.id,F=B.first_name,ue=B.last_name;return{label:"".concat(F," ").concat(ue),value:A}})},[f.data]),Oe=Object(j.useCallback)(function(){o===null||L===null||(S(!0),_(void 0),Yt(o,L).then(function(B){B.success&&_(B.data)}).finally(function(){S(!1)}))},[o,L]),Be=Object(j.useCallback)(function(B,A){return function(){var F=Object(W.a)(Object(b.a)().mark(function ue(we){var Ye,he;return Object(b.a)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(o===null||L===null)){X.next=2;break}return X.abrupt("return");case 2:return Ye=B.reduce(function(at,Fe){return Fe.s_subject_scale_form_id===A?[].concat(Object(re.a)(at),[{s_subject_scale_form_id:A,scale:we.table.map(function(de){var te=de.name,q=de.grade,U=de.grade_value;return{name:te,grade:q,grade_value:U}})}]):[].concat(Object(re.a)(at),[Fe])},[]),X.next=5,ia(o,L,{grade_scale:Ye});case 5:he=X.sent,he.success&&Oe();case 7:case"end":return X.stop()}},ue)}));return function(ue){return F.apply(this,arguments)}}()},[L,o]);return Object(j.useEffect)(function(){var B,A;if(!Z||!(a!=null&&(B=a.currentUser)!==null&&B!==void 0&&B.id)){var F;if((F=f.data)!==null&&F!==void 0&&F[0]){var ue;E((ue=f.data)===null||ue===void 0?void 0:ue[0].id)}return}E(a==null||(A=a.currentUser)===null||A===void 0?void 0:A.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,Z]),Object(j.useEffect)(function(){Oe()},[Oe]),f.loading?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(D.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(pt.a,{disabled:Z,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:z,value:L,onChange:function(A){return E(A)}})}),Object(e.jsx)(Rt.a,{}),p&&!O&&Object(e.jsx)(ie.a,{}),O!=null&&O.grade_scale?O.grade_scale.map(function(B,A){var F;return Object(e.jsxs)(Je.a.Fragment,{children:[A>0&&Object(e.jsx)(Rt.a,{}),Object(e.jsx)(fa,{subjectTutorGradeScale:B,onFormSubmit:Be((F=O.grade_scale)!==null&&F!==void 0?F:[],B.s_subject_scale_form_id)})]},B.s_subject_scale_form_id)}):Object(e.jsx)(tt.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},rn=u("qbNl"),ha=u("JBPa"),sn=u("Awhp"),pa=u("KrTs"),ga=u("wd/R"),st=u.n(ga);function _a(i,n){return wt.apply(this,arguments)}function wt(){return wt=Object(W.a)(Object(b.a)().mark(function i(n,t){return Object(b.a)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Object(s.i)("/api/admin/schedules",Object(d.a)({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),wt.apply(this,arguments)}var un=u("5R/X"),xa=function(){var n=Object(j.useState)(null),t=Object(N.a)(n,2),r=t[0],a=t[1],c=Object(j.useState)([]),o=Object(N.a)(c,2),f=o[0],h=o[1],y=Object(ee.b)(),O=y.semester_subject_id,_=st()(),x=Object(j.useMemo)(function(){return f.map(function(E){return{id:E.id,title:"".concat(E.group.name," (").concat(E.term_status.name,")"),start:st()(E.date_from).toDate(),end:st()(E.date_to).toDate(),tutor_name:"".concat(E.tutor.first_name," ").concat(E.tutor.last_name),tutor_email:E.tutor.email,semester:E.semester.name,group:E.group.name,subject:E.subject.name,ms_teams_join_url:E.ms_teams_join_url}})},[f]),l=Object(j.useCallback)(function(E,Z){_a({semester_subject_id:O,date_form:E.toDate(),date_to:Z.toDate()}).then(function(z){z.success&&h(z.data)})},[O]),p=Object(j.useCallback)(function(E){a(E)},[]),S=Object(j.useCallback)(function(){a(null)},[]),g=Object(j.useCallback)(function(E){return E.isSame(_,"day")?"warning":E.isAfter(_,"day")?"success":"error"},[]),C=Object(j.useCallback)(function(E){var Z=x.filter(function(z){return st()(z.start).isSame(E,"day")});return Object(e.jsx)("ul",{className:"events",children:Z.map(function(z){return Object(e.jsx)("li",{onClick:function(){return p(z)},children:Object(e.jsx)(pa.a,{status:g(st()(z.start)),text:z.title})},z.id)})})},[f]),L=Object(j.useCallback)(function(E,Z){var z=st()(E).startOf(Z).subtract(1,"month"),Oe=st()(E).endOf(Z).add(1,"month");l(z,Oe)},[]);return Object(j.useEffect)(function(){var E=st()().startOf("month"),Z=st()().endOf("month");l(E,Z)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(tt.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(ha.a,{dateCellRender:C,onPanelChange:L}),Object(e.jsxs)(Pe.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:S,footer:null,children:[Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&st()(r.start).format(v.b)]}),Object(e.jsxs)(tt.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&st()(r.end).format(v.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(tt.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(ve.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Zt=u("yj/a"),Xt=u("5Syx"),yt=u("PpiC"),Kt=u("H6aw"),Sa=u("p3I6"),ya=function(n,t){var r,a=n.reduce(function(l,p){var S=p.result,g=p.weight;return[l[0]+S.result*g,l[1]+g]},[0,0]),c=Object(N.a)(a,2),o=c[0],f=c[1],h=Number.isNaN(o/f)?0:o/f,y=t.sort(function(l,p){return l.grade_value-p.grade_value}).reduce(function(l,p){return[].concat(Object(re.a)(l),[Object(d.a)(Object(d.a)({},p),{},{isWeightedAverageGreater:h>=p.grade_value})])},[]);if(y.every(function(l){var p=l.isWeightedAverageGreater;return p})){var O,_;return(O=(_=y.at(-1))===null||_===void 0?void 0:_.name)!==null&&O!==void 0?O:""}var x=y.findIndex(function(l){var p=l.isWeightedAverageGreater;return!p});return x<0?"":(r=y[x-1])===null||r===void 0?void 0:r.name},Ea=function(n,t){var r;return(r=t.find(function(a){return a.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},Ta=["attendances"],Ca=["results"];function Ma(i,n){var t=Object(j.useState)({loading:!1}),r=Object(N.a)(t,2),a=r[0],c=r[1];return Object(j.useEffect)(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!0})}),da(i,n).then(function(o){o.success&&c(function(f){return Object(d.a)(Object(d.a)({},f),{},{data:o.data})})}).finally(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!1})})})},[n,i]),{finalGrades:a}}function Pa(){var i=Object(j.useState)({loading:!1}),n=Object(N.a)(i,2),t=n[0],r=n[1];return Object(j.useEffect)(function(){r(function(a){return Object(d.a)(Object(d.a)({},a),{},{loading:!0})}),oa().then(function(a){a.success&&r(function(c){return Object(d.a)(Object(d.a)({},c),{},{data:a.data})})}).finally(function(){r(function(a){return Object(d.a)(Object(d.a)({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function Da(i){var n=Object(j.useState)({loading:!1}),t=Object(N.a)(n,2),r=t[0],a=t[1];return Object(j.useEffect)(function(){i!==void 0&&(a(function(c){return Object(d.a)(Object(d.a)({},c),{},{loading:!0})}),ja(i).then(function(c){c.success&&a(function(o){return Object(d.a)(Object(d.a)({},o),{},{data:c.data})})}).finally(function(){a(function(c){return Object(d.a)(Object(d.a)({},c),{},{loading:!1})})}))},[i]),{subjectGradeScales:r}}function Ia(i,n,t){var r=Object(j.useState)({loading:!1}),a=Object(N.a)(r,2),c=a[0],o=a[1];return Object(j.useEffect)(function(){typeof i!="number"||typeof n!="number"||typeof t!="number"||(o(function(f){return Object(d.a)(Object(d.a)({},f),{},{loading:!0})}),Yt(i,n).then(function(f){f.success&&o(function(h){var y,O;return Object(d.a)(Object(d.a)({},h),{},{data:(y=Ea(t,(O=f.data.grade_scale)!==null&&O!==void 0?O:[]))===null||y===void 0?void 0:y.map(function(_,x){return Object(d.a)(Object(d.a)({},_),{},{id:x})})})})}).finally(function(){o(function(f){return Object(d.a)(Object(d.a)({},f),{},{loading:!1})})}))},[i,n]),{tutorGradeScales:c}}function Ra(i,n){var t=Object(j.useState)({loading:!1}),r=Object(N.a)(t,2),a=r[0],c=r[1],o=Object(j.useCallback)(function(){c(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!0})}),Pt(i).then(function(h){if(h.success){var y=h.data.reduce(function(O,_){var x=_.attendances,l=Object(yt.a)(_,Ta),p=x.find(function(S){return S.user_id===n});return p?[].concat(Object(re.a)(O),[Object(d.a)(Object(d.a)({},l),{},{attendance:p})]):O},[]);c(function(O){return Object(d.a)(Object(d.a)({},O),{},{data:y})})}}).finally(function(){c(function(h){return Object(d.a)(Object(d.a)({},h),{},{loading:!1})})})},[i,n]),f=Object(j.useCallback)(function(h,y){c(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!0})}),Ht(h,n,y).then(function(O){O.success?bt.b.success(O.message):bt.b.error(O.message)}).finally(function(){o(),c(function(O){return Object(d.a)(Object(d.a)({},O),{},{loading:!1})})})},[o,n]);return Object(j.useEffect)(function(){o()},[o]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:o,updateUserAttendanceSchedules:f}}function La(i,n){var t=Object(j.useState)({loading:!1}),r=Object(N.a)(t,2),a=r[0],c=r[1];return Object(j.useEffect)(function(){!n||(c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!0})}),ge({student_id:i,semester_subject_id:n}).then(function(o){if(o.success){var f=o.data.reduce(function(h,y){var O=Object(N.a)(y.results,1),_=O[0],x=Object(yt.a)(y,Ca);return _?[].concat(Object(re.a)(h),[Object(d.a)(Object(d.a)({},x),{},{result:_})]):h},[]);c(function(h){return Object(d.a)(Object(d.a)({},h),{},{data:f})})}}).finally(function(){c(function(o){return Object(d.a)(Object(d.a)({},o),{},{loading:!1})})}))},[i,n]),{studentExams:a}}function Aa(i,n){var t=Object(j.useState)({loading:!1}),r=Object(N.a)(t,2),a=r[0],c=r[1],o=Object(j.useState)({loading:!1}),f=Object(N.a)(o,2),h=f[0],y=f[1],O=Object(j.useState)({loading:!1}),_=Object(N.a)(O,2),x=_[0],l=_[1];return Object(j.useEffect)(function(){c(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!0})}),Object(Kt.e)({group_id:i}).then(function(p){p.success&&c(function(S){return Object(d.a)(Object(d.a)({},S),{},{data:p.data})})}).finally(function(){c(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!1})})})},[i]),Object(j.useEffect)(function(){!a.data||(l(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!0})}),Promise.all(a.data.map(function(p){var S=p.id;return Object(Kt.m)(Number(S))})).then(function(p){p.forEach(function(S){S.success&&l(function(g){return Object(d.a)(Object(d.a)({},g),{},{data:Object(d.a)(Object(d.a)({},g.data),{},Object(St.a)({},Number(S.data.id),Object(Sa.c)(S.data.lessons)))})})})}).finally(function(){l(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!1})})}),y(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!0})}),Promise.all(a.data.map(function(p){var S=p.id;return Object(Kt.l)(Number(S),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(g){if(g.success){var C,L,E=((C=g.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&C!==void 0?C:[]).filter(function(z){return z.id===n}),Z=(L=g.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&L!==void 0?L:[];y(function(z){return Object(d.a)(Object(d.a)({},z),{},{data:Object(d.a)(Object(d.a)({},z.data),{},Object(St.a)({},Number(S),{finishedTopics:E,attendanceList:Z}))})})}})})).finally(function(){return y(function(p){return Object(d.a)(Object(d.a)({},p),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:h,userCoursesTopics:x}}var Ga=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Fa=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(n,t){return Object($e.a)(new Date(t.date_from),v.c)}}],$a=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return Object($e.a)(new Date(t.created_at),v.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result,"%")}}],Ua=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?Object($e.a)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),v.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],Et=6,Ba=function(n){var t,r,a,c,o=n.user_id,f=n.group_id,h=Object(ee.b)(),y=h.semester_subject_id,O=La(o,y),_=O.studentExams,x=Ma(f,o),l=x.finalGrades,p=Pa(),S=p.gradeTerms,g=Da((t=l.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),C=g.subjectGradeScales,L=Ia(y,(r=l.data)===null||r===void 0?void 0:r.tutor_id,(a=l.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),E=L.tutorGradeScales,Z=Ra(f,o),z=Z.userAttendanceSchedules,Oe=Z.updateUserAttendanceSchedules,Be=Aa(f,o),B=Be.userCourses,A=Be.userCoursesStats,F=Be.userCoursesTopics,ue=D.a.useForm(),we=Object(N.a)(ue,1),Ye=we[0],he=Object(j.useMemo)(function(){var q;return((q=S.data)!==null&&q!==void 0?q:[]).map(function(U){var Q=U.id,oe=U.name;return{label:oe,value:Q}})},[S.data]),Ge=Object(j.useMemo)(function(){var q;return((q=C.data)!==null&&q!==void 0?q:[]).map(function(U){var Q=U.name,oe=U.id;return{label:Q,value:oe}})},[C.data]),X=Object(j.useMemo)(function(){var q,U;return ya((q=_.data)!==null&&q!==void 0?q:[],(U=E.data)!==null&&U!==void 0?U:[])},[_.data,E.data]),at=Object(j.useCallback)(function(){var q=Object(W.a)(Object(b.a)().mark(function U(Q){var oe,Ke,ut,ot,ke,Ze,ze;return Object(b.a)().wrap(function(ct){for(;;)switch(ct.prev=ct.next){case 0:if(ut=Q.grade_scale_id,ot=Q.grade_term_id,((oe=l.data)===null||oe===void 0?void 0:oe.id)!==void 0){ct.next=3;break}return ct.abrupt("return");case 3:if(ke=(Ke=l.data)===null||Ke===void 0?void 0:Ke.grades.find(function(qa){var en=qa.grade_term;return en.id===ot}),!ke){ct.next=11;break}return ct.next=7,ma(ke.id,{grade_scale_id:ut});case 7:return Ze=ct.sent,bt.b[Ze.success?"success":"error"](Ze.message),Ze.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades")),ct.abrupt("return");case 11:return ct.next=13,ba({grade_scale_id:ut,grade_term_id:ot,lesson_group_user_id:l.data.id});case 13:ze=ct.sent,bt.b[ze.success?"success":"error"](ze.message),ze.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades"));case 16:case"end":return ct.stop()}},U)}));return function(U){return q.apply(this,arguments)}}(),[l.data,y]),Fe=Object(j.useMemo)(function(){var q;return((q=S.data)!==null&&q!==void 0?q:[]).map(function(U){var Q;return Object(d.a)(Object(d.a)({},U),{},{grade:(Q=l.data)===null||Q===void 0?void 0:Q.grades.find(function(oe){var Ke=oe.grade_term;return Ke.id===U.id})})})},[l.data,S.data]),de=B.loading&&!B.data||A.loading&&!A.data||F.loading&&!F.data,te=Boolean(B.data&&A.data&&F.data);return l.loading?Object(e.jsx)(ie.a,{}):Object(e.jsxs)(e.Fragment,{children:[l.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(tt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:l.data.user})}),Object(e.jsx)(Rt.a,{})]}),Object(e.jsxs)(ht.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(M.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Et},dataSource:_.data,loading:_.loading,columns:$a,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(M.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Et},dataSource:Fe,loading:l.loading||S.loading,columns:Ua,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(M.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:z.data,loading:z.loading,columns:[].concat(Fa,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(U,Q){return Object(e.jsx)(zt.a,{onChange:function(Ke){return Oe(Q.id,Ke.target.checked?R.a.PRESENT:R.a.ABSENT)},checked:Q.attendance.value===R.a.PRESENT})}}])})}),Object(e.jsx)(I.a,{span:12,children:Object(e.jsx)(M.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Et},cardProps:{bodyStyle:{padding:0}},dataSource:E.data,loading:E.loading,columns:Ga})}),de&&Object(e.jsx)(ie.a,{}),te&&((c=B.data)===null||c===void 0?void 0:c.map(function(q){var U,Q,oe,Ke,ut,ot,ke,Ze,ze=q.id,gt=q.title;return Object(e.jsxs)(I.a,{span:24,children:[Object(e.jsx)(tt.a.Text,{style:{fontSize:"16px",fontWeight:500},children:gt}),Object(e.jsx)(Xt.c,{topics:(U=(Q=F.data)===null||Q===void 0?void 0:Q[Number(ze)])!==null&&U!==void 0?U:[],stats:(oe=(Ke=A.data)===null||Ke===void 0||(ut=Ke[Number(ze)])===null||ut===void 0?void 0:ut.finishedTopics)!==null&&oe!==void 0?oe:[]}),Object(e.jsx)(Xt.a,{stats:(ot=(ke=A.data)===null||ke===void 0||(Ze=ke[Number(ze)])===null||Ze===void 0?void 0:Ze.attendanceList)!==null&&ot!==void 0?ot:[]})]},ze)}))]}),Object(e.jsx)(D.a,{form:Ye,onFinish:at,children:Object(e.jsxs)(D.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Zt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:he,width:"sm",fieldProps:{loading:S.loading}}),Object(e.jsx)(Zt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Ge,fieldProps:{loading:l.loading||C.loading}}),Object(e.jsx)(D.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:X}})})]})})]})},Na=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,c=r.grade_term,o=r.id;return Object(e.jsxs)(tt.a.Text,{children:[c.name,": ",a]},o)}):"-"})}}],wa=function(){var n,t,r=Object(m.k)(),a=Object(j.useMemo)(function(){var _,x,l,p;return{user_id:Number.isNaN(Number((_=r.query)===null||_===void 0?void 0:_.user_id))?null:Number((x=r.query)===null||x===void 0?void 0:x.user_id),group_id:Number.isNaN(Number((l=r.query)===null||l===void 0?void 0:l.group_id))?null:Number((p=r.query)===null||p===void 0?void 0:p.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(t=r.query)===null||t===void 0?void 0:t.group_id]),c=a.user_id,o=a.group_id,f=Object(ee.b)(),h=f.teacherSubjectData,y=f.semester_subject_id,O=Object(j.useMemo)(function(){var _;return((_=h==null?void 0:h.groups)!==null&&_!==void 0?_:[]).map(function(x){var l=x.id,p=x.name;return{label:p,value:l}})},[h==null?void 0:h.groups]);return c!==null&&o!==null?Object(e.jsx)(Ba,{user_id:c,group_id:o}):Object(e.jsx)(M.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var _=Object(W.a)(Object(b.a)().mark(function x(l){var p,S,g,C,L,E,Z,z,Oe,Be;return Object(b.a)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return S=l.group_id,g=S===void 0?[]:S,C=l.first_name,L=C===void 0?"":C,E=l.last_name,Z=E===void 0?"":E,z=((p=h==null?void 0:h.groups)!==null&&p!==void 0?p:[]).map(function(F){var ue=F.id;return ue}),A.next=4,la(g.length===0?z:g);case 4:if(Oe=A.sent,Oe.success){A.next=7;break}return A.abrupt("return",{success:!1,total:0,data:[]});case 7:return Be=Oe.data.filter(function(F){var ue=F.user;return ue.first_name.toLowerCase().includes(L.toLowerCase())&&ue.last_name.toLowerCase().includes(Z.toLowerCase())}),A.abrupt("return",{success:!0,total:Be.length,data:Be});case 9:case"end":return A.stop()}},x)}));return function(x){return _.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:O,mode:"multiple"},render:function(x,l){return Object(e.jsx)(Qe.a,{type:"Students",type_id:l.group_id},l.group_id)}}].concat(Na,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(x,l){return[Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(l.user.id,"&group_id=").concat(l.group_id),children:Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(ve.a,{type:"primary",icon:Object(e.jsx)(Ue.a,{})})})},"edit")]}}])})},Ka=u("dF/Y"),Wa=u("o+0V"),Qt=u("0WSk"),Va=["type","defaultRender"],Ha=["type","defaultRender"],za=function(n){var t=n.url;return Object(e.jsx)(Ve.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(ve.a,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:Object(e.jsx)(Ka.a,{})})})},Ja=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return Object($e.a)(new Date(t.created_at),v.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,r){var a=t.type,c=t.defaultRender,o=Object(yt.a)(t,Va);if(a==="form")return null;var f=r.getFieldValue("state");return Object(e.jsx)(Qt.a,Object(d.a)(Object(d.a)({},o),{},{state:{type:f}}))},render:function(n,t){return Object(e.jsx)(Qe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id},t.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return Object($e.a)(new Date(t.exported_at),v.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,r){var a=t.type,c=t.defaultRender,o=Object(yt.a)(t,Ha);if(a==="form")return null;var f=r.getFieldValue("state");return Object(e.jsx)(Qt.a,Object(d.a)(Object(d.a)({},o),{},{state:{type:f}}))},render:function(n,t){return Object(e.jsx)(Qe.a,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id},t.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(n,t){return[Object(e.jsx)(za,{url:t.url},"download")]}}],Ya=function(){var n,t,r=Object(ee.b)(),a=r.teacherSubjectData,c=Object(j.useMemo)(function(){var f;return((f=a==null?void 0:a.groups)!==null&&f!==void 0?f:[]).map(function(h){var y=h.id,O=h.name;return{value:y,label:O}})},[a==null?void 0:a.groups]),o=Object(j.useMemo)(function(){var f,h;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:a==null||(f=a.groups)===null||f===void 0||(h=f[0])===null||h===void 0?void 0:h.id,allowClear:!1}}].concat(Ja)},[a==null||(n=a.groups)===null||n===void 0||(t=n[0])===null||t===void 0?void 0:t.id,c]);return Object(e.jsx)(M.a,{className:"table-standalone",request:function(){var f=Object(W.a)(Object(b.a)().mark(function h(y){var O,_,x,l,p,S,g;return Object(b.a)().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return x=y.group_id,l=x===void 0?a==null||(O=a.groups)===null||O===void 0||(_=O[0])===null||_===void 0?void 0:_.id:x,p=y.created_by,S=y.exported_by,L.next=3,Object(Wa.a)({group_id:l,created_by:p,exported_by:S});case 3:if(g=L.sent,g.success){L.next=6;break}return L.abrupt("return",{success:!1,data:[],total:0});case 6:return L.abrupt("return",{success:!0,data:g.data,total:g.data.length});case 7:case"end":return L.stop()}},h)}));return function(h){return f.apply(this,arguments)}}(),columns:o,search:{layout:"vertical"},scroll:{x:1500}})},Za=u("LvDl"),Xa=function(n){var t=n.exam_id,r=n.result,a=n.student_id,c=n.onSuccess,o=Object(j.useCallback)(Object(Za.debounce)(function(f){qe(t,a,{result:f!=null?f:0}).then(function(h){h.success&&(c==null||c(h.data))})},300),[t,r,a]);return Object(e.jsx)(Ot.a,{type:"number",min:0,max:100,onChange:o,defaultValue:r})},Qa=function(){var n,t,r=Object(ee.b)(),a=r.teacherSubjectData,c=Object(j.useState)([]),o=Object(N.a)(c,2),f=o[0],h=o[1],y=Object(j.useState)(a==null||(n=a.groups)===null||n===void 0||(t=n[0])===null||t===void 0?void 0:t.name),O=Object(N.a)(y,2),_=O[0],x=O[1],l=Object(j.useMemo)(function(){var g;return((g=a==null?void 0:a.groups)!==null&&g!==void 0?g:[]).map(function(C){var L=C.id,E=C.name;return{value:L,label:E}})},[a==null?void 0:a.groups]),p=Object(j.useRef)(),S=Object(j.useMemo)(function(){var g;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:l,defaultValue:l==null||(g=l[0])===null||g===void 0?void 0:g.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(re.a)(f))},[l,f]);return Object(e.jsx)(M.a,{className:"table-standalone",request:function(){var g=Object(W.a)(Object(b.a)().mark(function C(L){var E,Z,z,Oe,Be,B,A,F,ue,we,Ye,he,Ge,X;return Object(b.a)().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return Z=L.group_id,z=Z===void 0?(E=l[0])===null||E===void 0?void 0:E.value:Z,Oe=L.full_name,Be=Oe===void 0?"":Oe,Fe.next=3,Promise.all([Object(vt.b)(z),Pt(z),ge({group_id:z,per_page:-1})]);case 3:if(B=Fe.sent,A=Object(N.a)(B,3),F=A[0],ue=A[1],we=A[2],Ye=l.find(function(de){var te=de.value;return te===z}),!(!F.success||!ue.success||!we.success||!Ye)){Fe.next=11;break}return Fe.abrupt("return",{data:[],total:0,success:!1});case 11:return he=ue.data.reduce(function(de,te){return[].concat(Object(re.a)(de),[{title:String(Object($e.a)(new Date(te.date_from),v.c)),dataIndex:String(te.date_from),hideInSearch:!0,width:100,align:"center",render:function(U,Q){return Object(e.jsx)(Jt,{groupAttendanceScheduleId:te.id,defaultChecked:Q["".concat(te==null?void 0:te.date_from)]===R.a.PRESENT,studentId:Q.id})}}])},[]),Ge=we.data.reduce(function(de,te){return[].concat(Object(re.a)(de),[{dataIndex:"exam-".concat(te.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:te}),hideInSearch:!0,width:100,render:function(U,Q){var oe;return(Q==null||(oe=Q["exam-".concat(te.id)])===null||oe===void 0?void 0:oe.result)!==void 0?Object(e.jsx)(Xa,{result:Q==null?void 0:Q["exam-".concat(te.id)].result,exam_id:te.id,student_id:Q.id}):"-"}}])},[]),x(Ye.label),h([{title:Object(e.jsx)(s.a,{id:"attendance"}),children:he},{title:Object(e.jsx)(s.a,{id:"exams"}),children:Ge}].filter(function(de){var te=de.children;return te.length})),X=F.data.users.reduce(function(de,te){var q=te.id,U=te.academic_teacher_id,Q=te.first_name,oe=te.last_name,Ke="".concat(oe," ").concat(Q);if(U!==null||!Ke.toLowerCase().includes(Be.toLowerCase()))return de;var ut=ue.data.reduce(function(ke,Ze){var ze=Ze.attendances.find(function(gt){return gt.user_id===q});return ze?Object(d.a)(Object(d.a)({},ke),{},Object(St.a)({},"".concat(Ze.date_from),ze.value)):ke},{}),ot=we.data.reduce(function(ke,Ze){var ze=Ze.results.find(function(gt){return gt.user_id===q});return ze?Object(d.a)(Object(d.a)({},ke),{},Object(St.a)({},"exam-".concat(Ze.id),ze)):ke},{});return[].concat(Object(re.a)(de),[Object(d.a)(Object(d.a)({id:q,full_name:Ke},ut),ot)])},[]).sort(function(de,te){return de.full_name.localeCompare(te.full_name)}),Fe.abrupt("return",{data:X,total:X.length,success:!0});case 17:case"end":return Fe.stop()}},C)}));return function(C){return g.apply(this,arguments)}}(),columns:S,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:_}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:p,pagination:{onChange:function(){var C;return(C=p.current)===null||C===void 0?void 0:C.reload()}},rowKey:"id"})},ka=function(n){var t,r,a=n.tab,c=Object(s.l)(),o=Object(s.m)("@@initialState"),f=o.setInitialState,h=o.initialState,y=Object(ee.b)(),O=y.teacherSubjectData,_=y.semester_subject_id,x=y.tutors,l=Object(j.useCallback)(Object(Ae.a)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),p=Object(j.useMemo)(function(){return!!x.data.find(function(S){var g,C=S.id;return C===(h==null||(g=h.currentUser)===null||g===void 0?void 0:g.id)})||l(Ee.a.TeacherListGradeScale)},[]);return O?Object(e.jsx)(Le.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:O==null||(t=O.subject)===null||t===void 0?void 0:t.name}),", ",Object(e.jsx)(s.a,{id:a})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(We.a,{to:"/teacher/subjects/".concat(_,"/exams?exam_id=new"),children:Object(e.jsx)(ve.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"Subjects"})},{path:String(_),breadcrumbName:String((r=O.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:c.formatMessage({id:a,defaultMessage:String(a)})}]}},children:Object(e.jsxs)(J.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(g){f(Object(d.a)({},h)),s.f.push("/teacher/subjects/".concat(_,"/").concat(g))}},children:[Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(dt.a,{})},"groups"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(na,{})},"students"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(xt,{})},"exams"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(xa,{})},"schedule"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(Qa,{})},"class-register"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(sa,{})},"attendance"),p&&Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(Oa,{})},"grades-scale"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(wa,{})},"final-grades"),Object(e.jsx)(J.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(Ya,{})},"file-exports-history")]})}):Object(e.jsx)(ie.a,{})},cn=pe.default=function(){var i=Object(m.l)(),n=i.subjectId,t=i.tab,r=t===void 0?"groups":t;return Object(e.jsx)(ee.a,{semester_subject_id:Number(n),children:Object(e.jsx)(ka,{tab:r})})}},p3I6:function(ft,pe,u){"use strict";u.d(pe,"b",function(){return Ae}),u.d(pe,"c",function(){return Te}),u.d(pe,"a",function(){return it});var d=u("miYZ"),ye=u("tsqr"),ve=u("tJVT"),P=u("k1fw"),ie=u("oBTY"),j=u("q1tI"),Je=u.n(j),s=u("9kvl"),We=u("Ty5D"),m=u("H6aw"),J=u("/y+f"),Le=u("nKUr"),Ee=u.n(Le),Ae=Je.a.createContext({}),ee=function(){return Math.round(Math.random()*99999)},dt=function be(ne){return ne.reduce(function(w,T){return[].concat(Object(ie.a)(w),Object(ie.a)(T.lessons?be(T.lessons):[]),[T])},[])},Te=function be(ne){return ne.reduce(function(w,T){var K;return[].concat(Object(ie.a)(w),Object(ie.a)(T.lessons?be(T.lessons):[]),Object(ie.a)((K=T.topics)!==null&&K!==void 0?K:[]))},[])},nt=function be(ne,w,T){return ne.map(function(K){var je,M;return Object(P.a)(Object(P.a)({},K),{},{lessons:K.lessons?be(K.lessons,w,T):[],topics:K.id===w?[].concat(Object(ie.a)((je=K.topics)!==null&&je!==void 0?je:[]),[T]):(M=K.topics)!==null&&M!==void 0?M:[]})})},jt=function be(ne,w,T){return T?ne.map(function(K){return Object(P.a)(Object(P.a)({},K),{},{lessons:[].concat(Object(ie.a)(K.lessons?be(K.lessons,w,T):[]),Object(ie.a)(K.id===T?[w]:[]))})}):[].concat(Object(ie.a)(ne),[w])},Ve=function be(ne,w,T){return ne.map(function(K){return Object(P.a)(Object(P.a)({},K.id===w?T:K),{},{lessons:K.lessons?be(K.lessons,w,T):[]})})},b=function be(ne,w){return ne.map(function(T){return Object(P.a)(Object(P.a)({},T),{},{parent_id:w,lessons:T.lessons?be(T.lessons,T.id):[]})})},W=function be(ne,w){return ne.filter(function(T){return T.id!==w}).map(function(T){return Object(P.a)(Object(P.a)({},T),{},{lessons:T.lessons?be(T.lessons,w):[]})})},$e=function be(ne,w){return ne.map(function(T){return Object(P.a)(Object(P.a)({},T),{},{lessons:T.lessons?be(T.lessons,w):[],topics:T.topics?T.topics.filter(function(K){return K.id!==w}):[]})})},Ue=function be(ne,w,T,K){return K==null?void 0:K.map(function(je){if(je.id===T){var M;return Object(P.a)(Object(P.a)({},je),{},{topics:(M=je.topics)===null||M===void 0?void 0:M.map(function(v){return v.id===ne?w.file.response.data:v})})}else if(je.lessons)return Object(P.a)(Object(P.a)({},je),{},{lessons:be(ne,w,T,je.lessons||[])});return je})},it=function(ne){var w=ne.children,T=ne.id,K=Object(j.useState)(),je=Object(ve.a)(K,2),M=je[0],v=je[1],ge=Object(s.l)(),_e=Object(j.useMemo)(function(){return M&&M.lessons?Te(M.lessons):[]},[M]),Re=Object(j.useMemo)(function(){return M&&M.lessons?dt(M.lessons):[]},[M]),fe=Object(j.useState)([]),Ce=Object(ve.a)(fe,2),xe=Ce[0],Ne=Ce[1],G=Object(We.k)();Object(j.useEffect)(function(){Ne([])},[]);var V=Object(j.useCallback)(function(){Object(m.m)(T).then(function(I){return I.success&&v(Object(P.a)(Object(P.a)({},I.data),{},{lessons:b(I.data.lessons)}))})},[T]);Object(j.useEffect)(function(){V()},[V]);var le=Object(j.useCallback)(function(I){var D=Re.find(function(H){var $;return H==null||($=H.topics)===null||$===void 0?void 0:$.find(function(R){return R.id===I})});return D?D.id:null},[Re]),qe=Object(j.useMemo)(function(){var I,D;return(I=G.query)!==null&&I!==void 0&&I.lesson?{mode:"lesson",id:Number(G.query.lesson),value:Re.find(function(H){return H.id===Number(G.query.lesson)})}:(D=G.query)!==null&&D!==void 0&&D.topic?{mode:"topic",id:Number(G.query.topic),value:_e.find(function(H){return H.id===Number(G.query.topic)})}:{mode:"init"}},[G.query,M,Re,_e]),et=Object(j.useCallback)(function(I){var D={course_id:T,topics:[],isNew:!0,id:M?M.lessons.length+1:ee(),order:0,title:ge.formatMessage({id:"add_title_here"}),active:!0,parent_id:I};return v(function(H){var $;return Object(P.a)(Object(P.a)({},H),{},{lessons:jt(($=H==null?void 0:H.lessons)!==null&&$!==void 0?$:[],D,I)})}),D},[T,M]),Xe=Object(j.useCallback)(function(I,D){var H=Re.find(function(R){return R.id===I}),$=H&&H.isNew;return($?Object(m.g)(D):Object(m.u)(I,D)).then(function(R){return ye.b.success(R.message),V(),R.success&&v(function(Y){var Pe;return Object(P.a)(Object(P.a)({},Y),{},{lessons:Ve((Pe=Y==null?void 0:Y.lessons)!==null&&Pe!==void 0?Pe:[],I,Object(P.a)(Object(P.a)({},R.data),{},{isNew:!1}))})})})},[M]),He=Object(j.useCallback)(function(I){var D=Re.find(function($){return $.id===I});if(!!D){var H=D.isNew;H?v(function($){var R;return Object(P.a)(Object(P.a)({},$),{},{lessons:W((R=$==null?void 0:$.lessons)!==null&&R!==void 0?R:[],I)})}):Object(m.o)(I).then(function($){$.success&&(ye.b.success($.message),v(function(R){var Y;return Object(P.a)(Object(P.a)({},R),{},{lessons:W((Y=R==null?void 0:R.lessons)!==null&&Y!==void 0?Y:[],I)})}))})}},[M]),Qe=Object(j.useCallback)(function(I,D){var H,$=le(I),R=Re.find(function(re){return re.id===$}),Y=R&&((H=R.topics)===null||H===void 0?void 0:H.find(function(re){return re.id===I})),Pe=Y==null?void 0:Y.isNew;return(Pe?Object(m.h)(D):Object(m.v)(I,D)).then(function(re){re.success&&(ye.b.success(re.message),V(),s.f.push("/courses/list/".concat(T,"/program/?topic=").concat(re.data.id)),(Y==null?void 0:Y.topicable_type)===J.f.Video&&setTimeout(function(){V()},5e3))})},[le,M,V]),Me=Object(j.useCallback)(function(I){var D=le(I),H=Re.find(function(Y){return Y.id===D});if(!!H){var $=_e==null?void 0:_e.find(function(Y){return Y.id===I}),R=$==null?void 0:$.isNew;R&&!$.topicable?v(function(Y){var Pe;return Object(P.a)(Object(P.a)({},Y),{},{lessons:$e((Pe=Y==null?void 0:Y.lessons)!==null&&Pe!==void 0?Pe:[],I)})}):Object(m.p)(I).then(function(Y){Y.success&&(ye.b.success(Y.message),v(function(Pe){var re;return Object(P.a)(Object(P.a)({},Pe),{},{lessons:$e((re=Pe==null?void 0:Pe.lessons)!==null&&re!==void 0?re:[],I)})}))})}},[M,le]),Ot=Object(j.useCallback)(function(I,D){var H={lesson_id:I,isNew:!0,id:ee(),title:ge.formatMessage({id:"add_title_here"}),active:!0,topicable_type:D};return v(function($){var R;return Object(P.a)(Object(P.a)({},$),{},{lessons:nt((R=$==null?void 0:$.lessons)!==null&&R!==void 0?R:[],I,H)})}),H},[]),N=function(D,H){var $=le(D);v(function(R){return Object(P.a)(Object(P.a)({},R),{},{lessons:R?Ue(D,H,$,R.lessons||[]):[]})}),s.f.push("/courses/list/".concat(T,"/program/?topic=").concat(H.file.response.data.id))},me=Object(j.useCallback)(function(I){return Object(m.d)(I).then(function(D){if(D.success){ye.b.success(D.message);var H=le(I);v(function($){var R;return Object(P.a)(Object(P.a)({},$),{},{lessons:$?(R=$.lessons)===null||R===void 0?void 0:R.map(function(Y){if(Y.id===H){var Pe=Y.topics||[];return Object(P.a)(Object(P.a)({},Y),{},{topics:[].concat(Object(ie.a)(Pe),[D.data])})}return Y}):[]})})}})},[M,le]),ht=Object(j.useCallback)(function(I){return Object(m.c)(I).then(function(D){D.success&&(ye.b.success(D.message),v(function(H){return Object(P.a)(Object(P.a)({},H),{},{lessons:H?[].concat(Object(ie.a)(H.lessons),[D.data]):[]})}))})},[]),lt={state:M,h5ps:xe,id:T,addNewLesson:et,updateLesson:Xe,updateTopic:Qe,deleteLesson:He,addNewTopic:Ot,deleteTopic:Me,onTopicUploaded:N,cloneTopic:me,cloneLesson:ht,currentEditMode:qe,getLessons:V};return Object(Le.jsx)(Ae.Provider,{value:lt,children:w})}}}]);
