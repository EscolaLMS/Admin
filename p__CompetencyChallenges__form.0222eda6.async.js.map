{"version":3,"sources":["webpack:///./src/pages/CompetencyChallenges/components/MainForm.tsx","webpack:///./src/pages/CompetencyChallenges/components/Scales.tsx","webpack:///./src/pages/CompetencyChallenges/components/DiagnosticTest.tsx","webpack:///./src/pages/CompetencyChallenges/form.tsx","webpack:///./src/services/escola-lms/competency-challenges.ts","webpack:///./src/pages/CompetencyChallenges/components/CompetencyChallengeCategoryTree.tsx","webpack:///./src/components/WysiwygMarkdown/index.tsx","webpack:///./src/pages/CompetencyChallenges/context.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/MultipleChoice.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/TrueFalse.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/ShortAnswers.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/Matching.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/Numerical.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/Essay.tsx","webpack:///./src/components/GiftQuizQuestions/editor/question/index.tsx","webpack:///./src/components/GiftQuizQuestions/editor/utils.ts","webpack:///./src/components/GiftQuizQuestions/editor/index.tsx","webpack:///./src/components/GiftQuizQuestions/table.tsx"],"names":["typeOptions","Object","values","CompetencyChallengeType","map","value","label","MainForm","useCompetencyChallengeContext","competencyChallenge","categoryDepths","refreshData","params","useParams","competency_challenge_id","Number","id","intl","useIntl","ProForm","useForm","form","selectedType","useWatch","isNew","isNaN","initialValues","useMemo","data","authors","category","restValues","category_id","addCompetencyChallenge","useCallback","name","type","is_active","is_highlighted","createCompetencyChallenge","res","success","error","message","formatMessage","history","push","changeCompetencyChallenge","formValues","getFieldsValue","image_url","image_path","updateCompetencyChallenge","changedValues","setFieldValue","required","role","width","maxWidth","info","file","response","paths","setFieldsValue","staticColumns","title","dataIndex","editable","render","_n","record","split","state","valueType","formItemProps","rules","min","max","fieldProps","category_name","renderFormItem","_s","_c","disabledNodes","getFieldValue","getDefaultData","scales","scale_min","name_with_breadcrumbs","Scales","useState","editableKeys","setEditableRowKeys","formRef","useRef","editableFormRef","actionRef","defaultData","columns","_i","action","startEditable","idStr","currentData","current","filter","deleteCompetencyChallengeScale","table","r","creatorButtonText","disabled","length","index","onlyOneLineEditorAlertMessage","onSave","_k","createCompetencyChallengeScale","updateCompetencyChallengeScale","deletePopconfirmMessage","actionRender","dom","save","delete","cancel","onChange","DiagnosticTest","loading","setLoading","quizData","setQuizData","fetchQuiz","quiz_id","undefined","getGiftQuiz","then","finally","onFormFinish","formData","updateGiftQuiz","useEffect","position","paddingBottom","_p","reset","submit","bottom","left","defaultMessage","questions","CompetencyChallengeContent","tab","pageTitle","breadcrumb","routes","path","breadcrumbName","String","padding","cardProps","activeKey","key","CompetencyChallenge","options","request","method","useCache","body","headers","competency_challenge_scale_id","treeConvert","enabledDepth","depth","subcategories","includes","children","cat","CompetencyChallengeCategoryTree","categories","setCategories","categoriesToShow","treeData","categoryTree","maxHeight","overflow","EmbedUploaded","attrs","href","filename","pop","FormWysiwyg","directory","matcher","url","component","upload","result","resizePath","resizedImage","Error","v","scale","question","console","warn","Context","React","createContext","useContext","CompetencyChallengeContextProvider","setCompetencyChallenge","setCategoryDepths","prev","getCompetencyChallenge","errors","fetchCategoryDepths","getConfig","escolalms_competency_challenge","INITIAL_VALUES","QuestionType","MULTIPLE_CHOICE","isCorrect","MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS","weight","GiftQuizQuestionMultipleChoiceEditor","field","i","count","ordinalNumber","remove","display","justifyContent","validator","answers","answer","Promise","reject","resolve","MAX_SAFE_INTEGER","addonAfter","GiftQuizQuestionTrueFalseEditor","GiftQuizQuestionShortEditor","tooltipText","_f","_a","deleteButton","firstOfPair","secondOfPair","GiftQuizQuestionMatchingEditor","style","flexWrap","GiftQuizQuestionNumericalEditor","GiftQuizQuestionEssayEditor","GiftQuizQuestion","TRUE_FALSE","SHORT_ANSWERS","MATCHING","NUMERICAL_QUESTION","ESSAY","DESCRIPTION","escapeQuestionSpecialChars","inputString","charsToEscape","escapedString","currentChar","parseMultipleChoice","giftString","sign","trim","parseMultipleChoiceWithMultipleRightAnswers","parseTrueFalse","parseShortAnswers","parseMatching","parseNumerical","errorMargin","parseEssay","parseDescription","parseToGIFT","safeFormData","parseMultipleChoiceToFormData","parsedValue","score","stem","text","isMultipleChoice","choices","every","reduce","acc","parseTrueFalseToFormData","isTrue","parseShortAnswersToFormData","parseMatchingToFormData","matchPairs","subquestion","subanswer","parseNumericalToFormData","Array","isArray","number","range","parseDescriptionEssayToFormData","questionBase","parse","VALUES_NOT_TO_RESET","TYPE_OPTIONS","q","GiftQuizQuestionEditor","onSubmit","competencyChallengeCategoryTreeProps","parseToFormData","onFinish","status","resetFields","fields","fieldsToReset","keys","DragHandle","SortableHandle","cursor","color","SortableItem","SortableElement","props","SortContainer","SortableContainer","className","hideInForm","hideInSearch","hideInSetting","_","row","obj","categoryColumn","Table","onAdded","onRemoved","onEdited","quizId","tableLoading","tableHeader","questionsCategory","newQuestion","setNewQuestion","editQuestion","setEditQuestion","debug","setDebug","dataSource","setDataSource","reload","onSortEnd","oldIndex","newIndex","newData","arrayMoveImmutable","slice","Boolean","order","forEach","newRow","updateQuestion","topic_gift_quiz_id","DraggableContainer","DraggableBodyRow","restProps","findIndex","x","onNewQuestionSubmit","createQuestion","log","onEditQuestionSubmit","bodyStyle","settings","deleteQuestion","wrapper","marginTop"],"mappings":"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","file":"p__CompetencyChallenges__form.0222eda6.async.js","sourcesContent":["import React, { useCallback, useMemo } from 'react';\nimport { FormattedMessage, history, useIntl, useParams } from 'umi';\nimport { message } from 'antd';\nimport ProForm, {\n  ProFormSelect,\n  ProFormSwitch,\n  ProFormText,\n  ProFormTextArea,\n} from '@ant-design/pro-form';\n\nimport CategoryTree from '@/components/CategoryTree';\nimport UserSelect from '@/components/UserSelect';\nimport ProFormImageUpload from '@/components/ProFormImageUpload';\nimport WysiwygMarkdown from '@/components/WysiwygMarkdown';\nimport {\n  createCompetencyChallenge,\n  updateCompetencyChallenge,\n} from '@/services/escola-lms/competency-challenges';\nimport { CompetencyChallengeType } from '@/services/escola-lms/enums';\nimport { useCompetencyChallengeContext } from '../context';\n\nconst typeOptions = Object.values(CompetencyChallengeType).map((value) => ({\n  value,\n  label: <FormattedMessage id={`CompetencyChallenges.types.${value}`} />,\n}));\n\nexport const MainForm: React.FC = () => {\n  const { competencyChallenge, categoryDepths, refreshData } = useCompetencyChallengeContext();\n  const params = useParams<{ id?: string }>();\n  const competency_challenge_id = Number(params.id);\n\n  const intl = useIntl();\n  const [form] = ProForm.useForm();\n  const selectedType = ProForm.useWatch('type', form);\n\n  const isNew = Number.isNaN(competency_challenge_id);\n\n  const initialValues = useMemo(() => {\n    if (!competencyChallenge?.data) return {};\n    const { authors, category, ...restValues } = competencyChallenge?.data;\n\n    return { ...restValues, authors: authors.map(({ id }) => id), category_id: category?.id };\n  }, [competencyChallenge?.data]);\n\n  const addCompetencyChallenge = useCallback(\n    async ({\n      name,\n      type,\n      is_active = false,\n      is_highlighted = false,\n      category_id,\n    }: API.CreateCompetencyChallenge) => {\n      try {\n        const res = await createCompetencyChallenge({\n          name,\n          is_active,\n          is_highlighted,\n          type,\n          category_id,\n        });\n\n        if (!res.success) {\n          message.error(res.message);\n          return;\n        }\n\n        message.success(intl.formatMessage({ id: res.message }));\n        history.push(`/competency-challenges/${res.data.id}/main`);\n        await refreshData();\n      } catch {\n        message.error(intl.formatMessage({ id: 'error' }));\n      }\n    },\n    [],\n  );\n\n  const changeCompetencyChallenge = useCallback(\n    async (formValues: API.UpdateCompetencyChallenge) => {\n      try {\n        // those values don't have inputs, so we have to do it manually\n        const { image_url, image_path }: { image_url: string; image_path: string } =\n          form.getFieldsValue(['image_url', 'image_path']);\n\n        const res = await updateCompetencyChallenge(competency_challenge_id, {\n          ...formValues,\n          image_url,\n          image_path,\n        });\n\n        if (!res.success) {\n          message.error(res.message);\n          return;\n        }\n\n        message.success(intl.formatMessage({ id: res.message }));\n        await refreshData();\n      } catch {\n        message.error(intl.formatMessage({ id: 'error' }));\n      }\n    },\n    [competency_challenge_id],\n  );\n\n  return (\n    <ProForm\n      form={form}\n      initialValues={initialValues}\n      onFinish={isNew ? addCompetencyChallenge : changeCompetencyChallenge}\n      onValuesChange={(changedValues) => {\n        if (changedValues?.type === 'complex') {\n          form.setFieldValue('category', null);\n        }\n      }}\n    >\n      <ProForm.Group title={<FormattedMessage id=\"CompetencyChallenges.base\" />}>\n        <ProFormText\n          width=\"md\"\n          name=\"name\"\n          label={<FormattedMessage id=\"name\" />}\n          placeholder={intl.formatMessage({ id: 'name' })}\n          required\n          rules={[{ required: true, message: intl.formatMessage({ id: 'field_required' }) }]}\n        />\n        <ProFormSelect\n          width=\"md\"\n          name=\"type\"\n          label={<FormattedMessage id=\"type\" />}\n          options={typeOptions}\n          required\n          rules={[{ required: true, message: intl.formatMessage({ id: 'field_required' }) }]}\n        />\n        {selectedType === 'simple' && (\n          <ProForm.Item\n            name=\"category_id\"\n            required\n            label={<FormattedMessage id=\"category\" />}\n            rules={[{ required: true, message: intl.formatMessage({ id: 'field_required' }) }]}\n          >\n            <CategoryTree enabledDepth={categoryDepths.role} />\n          </ProForm.Item>\n        )}\n        <ProFormSwitch name=\"is_active\" label={<FormattedMessage id=\"is_active\" />} />\n        <ProFormSwitch\n          name=\"is_highlighted\"\n          label={<FormattedMessage id=\"is_highlighted\" />}\n          tooltip={<FormattedMessage id=\"CompetencyChallenges.highlighted\" />}\n        />\n      </ProForm.Group>\n      {!isNew && (\n        <>\n          <ProForm.Group title={<FormattedMessage id=\"CompetencyChallenges.additional\" />}>\n            <ProForm.Item\n              name=\"description\"\n              label={<FormattedMessage id=\"description\" />}\n              valuePropName=\"value\"\n              style={{\n                width: 440,\n              }}\n            >\n              <WysiwygMarkdown directory={`competency-challenges/${competency_challenge_id}`} />\n            </ProForm.Item>\n            <ProFormTextArea width=\"lg\" name=\"summary\" label={<FormattedMessage id=\"summary\" />} />\n            <ProForm.Item\n              name=\"authors\"\n              label={<FormattedMessage id=\"author\" />}\n              style={{ width: '100%', maxWidth: 440 }}\n            >\n              <UserSelect multiple />\n            </ProForm.Item>\n          </ProForm.Group>\n          <ProFormImageUpload\n            wrapInForm={false}\n            folder={`/competency-challenges/${competency_challenge_id}`}\n            title=\"image\"\n            action={`/api/admin/competency-challenges/${competency_challenge_id}?_method=PATCH`}\n            src_name=\"image_url\"\n            form_name=\"image\"\n            getUploadedSrcField={(info) => info.file.response.data.image_url}\n            setPath={(paths) => form.setFieldsValue(paths)}\n          />\n        </>\n      )}\n    </ProForm>\n  );\n};\n","import React, { useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useIntl, useParams } from 'umi';\nimport { Button, Popconfirm, Tooltip } from 'antd';\nimport { DeleteOutlined, EditOutlined } from '@ant-design/icons';\nimport ProForm, { type ProFormInstance } from '@ant-design/pro-form';\nimport { EditableProTable } from '@ant-design/pro-table';\nimport type { ActionType, EditableFormInstance, ProColumns } from '@ant-design/pro-table';\n\nimport {\n  createCompetencyChallengeScale,\n  deleteCompetencyChallengeScale,\n  updateCompetencyChallengeScale,\n} from '@/services/escola-lms/competency-challenges';\nimport { CompetencyChallengeCategoryTree } from './CompetencyChallengeCategoryTree';\nimport { useCompetencyChallengeContext } from '../context';\n\ntype DataSourceType = {\n  id: React.Key;\n  scale_min: number;\n  category_id: number;\n  category_name: string;\n};\n\nconst staticColumns: ProColumns<DataSourceType>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" />,\n    dataIndex: 'id',\n    editable: false,\n    render: (_n, record) => {\n      if (typeof record.id !== 'string') return '-';\n      const [state, id] = record.id.split('-');\n\n      if (state === 'new') return '-';\n\n      return id;\n    },\n  },\n  {\n    title: <FormattedMessage id=\"min_points\" />,\n    dataIndex: 'scale_min',\n    valueType: 'digit',\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n        {\n          type: 'number',\n          min: 0,\n          max: 100,\n          message: <FormattedMessage id=\"number_between\" values={{ min: 0 }} />,\n        },\n      ],\n    },\n    fieldProps: {\n      min: 0,\n    },\n  },\n  {\n    title: <FormattedMessage id=\"category\" />,\n    dataIndex: 'category_id',\n    render: (_n, record) => record.category_name,\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n      ],\n    },\n    renderFormItem: (_s, _c, form) => {\n      const disabledNodes: number[] = (form.getFieldValue('table') ?? []).map(\n        (record: DataSourceType) => record.category_id,\n      );\n\n      return <CompetencyChallengeCategoryTree disabledNodes={disabledNodes} />;\n    },\n  },\n];\n\nconst getDefaultData = (scales: API.CompetencyChallengeScale[]): DataSourceType[] =>\n  scales.map(({ id, scale_min, category }) => ({\n    // due to key errors\n    id: `old-${id}`,\n    scale_min,\n    category_id: category.id,\n    category_name: category.name_with_breadcrumbs,\n  }));\n\nexport const Scales: React.FC = () => {\n  const { competencyChallenge, refreshData } = useCompetencyChallengeContext();\n  const params = useParams<{ id?: string }>();\n  const competency_challenge_id = Number(params.id);\n  const scales = competencyChallenge?.data?.scales ?? [];\n\n  const [editableKeys, setEditableRowKeys] = useState<React.Key[]>([]);\n\n  const intl = useIntl();\n  const formRef = useRef<ProFormInstance>();\n  const editableFormRef = useRef<EditableFormInstance>();\n  const actionRef = useRef<ActionType>();\n\n  const defaultData = useMemo(() => getDefaultData(scales), [scales]);\n\n  const columns: ProColumns<DataSourceType>[] = useMemo(() => {\n    return [\n      ...staticColumns,\n\n      {\n        valueType: 'option',\n        title: <FormattedMessage id=\"options\" />,\n        render: (_n, record, _i, action) => [\n          <Tooltip key=\"edit\" title={<FormattedMessage id=\"edit\" defaultMessage=\"edit\" />}>\n            <Button\n              type=\"primary\"\n              icon={<EditOutlined />}\n              onClick={() => action?.startEditable(record.id)}\n            />\n          </Tooltip>,\n          <Popconfirm\n            key=\"delete\"\n            title={\n              <FormattedMessage\n                id=\"deleteQuestion\"\n                defaultMessage=\"Are you sure to delete this record?\"\n              />\n            }\n            onConfirm={async () => {\n              if (typeof record.id !== 'string') return;\n              const [state, idStr] = record.id.split('-');\n\n              if (state === 'new') {\n                const currentData: DataSourceType[] = formRef.current?.getFieldValue('table');\n\n                formRef.current?.setFieldValue(\n                  'table',\n                  currentData.filter(({ id }) => id !== record.id),\n                );\n                return;\n              }\n\n              const response = await deleteCompetencyChallengeScale(+idStr);\n              if (response.success) {\n                await refreshData();\n              }\n            }}\n            okText={<FormattedMessage id=\"ok\" />}\n            cancelText={<FormattedMessage id=\"cancel\" />}\n          >\n            <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n              <Button type=\"primary\" icon={<DeleteOutlined />} danger />\n            </Tooltip>\n          </Popconfirm>,\n        ],\n      },\n    ];\n  }, []);\n\n  return (\n    <ProForm<{\n      table: DataSourceType[];\n    }>\n      formRef={formRef}\n      initialValues={{\n        table: defaultData,\n      }}\n      submitter={false}\n    >\n      <EditableProTable<DataSourceType>\n        rowKey={(r) => r.id}\n        editableFormRef={editableFormRef}\n        controlled\n        actionRef={actionRef}\n        name=\"table\"\n        columns={columns}\n        recordCreatorProps={{\n          creatorButtonText: <FormattedMessage id=\"CompetencyChallenges.addNewRow\" />,\n          disabled: editableKeys.length > 0,\n          record: (index) => ({ id: `new-${index}` } as DataSourceType),\n        }}\n        editable={{\n          onlyOneLineEditorAlertMessage: intl.formatMessage({\n            id: 'CompetencyChallenges.onlyOneRowIsEditable',\n          }),\n          onSave: async (_k, { scale_min, category_id, ...record }) => {\n            if (typeof record.id !== 'string') return;\n\n            const [state, idStr] = record.id.split('-');\n            if (state === 'new') {\n              const res = await createCompetencyChallengeScale({\n                scale_min,\n                category_id,\n                competency_challenge_id,\n              });\n\n              if (res.success) {\n                await refreshData();\n              }\n\n              return;\n            }\n\n            const res = await updateCompetencyChallengeScale(+idStr, {\n              scale_min,\n              category_id,\n              competency_challenge_id,\n            });\n            if (res.success) {\n              await refreshData();\n            }\n            return;\n          },\n          deletePopconfirmMessage: <FormattedMessage id=\"deleteQuestion\" />,\n          actionRender: (record, _c, dom) => {\n            if (typeof record.id !== 'string') return [];\n\n            const [state] = record.id.split('-');\n            if (state === 'new') return [dom.save, dom.delete];\n\n            return [dom.save, dom.cancel];\n          },\n          type: 'single',\n          editableKeys,\n          onChange: setEditableRowKeys,\n        }}\n      />\n    </ProForm>\n  );\n};\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { useIntl, FormattedMessage } from 'umi';\nimport { Divider, Space, Spin } from 'antd';\nimport ProForm, { ProFormDigit, ProFormGroup } from '@ant-design/pro-form';\n\nimport { Table } from '@/components/GiftQuizQuestions/table';\nimport { getGiftQuiz, updateGiftQuiz } from '@/services/escola-lms/gift_quiz';\nimport { useCompetencyChallengeContext } from '../context';\n\ninterface FormData {\n  max_attempts: number;\n  max_execution_time: number;\n}\n\nexport const DiagnosticTest: React.FC = () => {\n  const {\n    competencyChallenge: { data },\n  } = useCompetencyChallengeContext();\n\n  const [loading, setLoading] = useState(false);\n  const [quizData, setQuizData] = useState<API.GiftQuiz>();\n  const intl = useIntl();\n\n  const fetchQuiz = useCallback(() => {\n    if (data?.quiz_id === undefined) return;\n\n    setLoading(true);\n    getGiftQuiz(data?.quiz_id)\n      .then((res) => {\n        if (res.success) {\n          setQuizData(res.data);\n        }\n      })\n      .finally(() => setLoading(false));\n  }, [data?.quiz_id]);\n\n  const onFormFinish = useCallback(async (formData: FormData) => {\n    if (data?.quiz_id === undefined) return;\n\n    setLoading(true);\n    updateGiftQuiz(data?.quiz_id, { ...formData, value: 'diagnostic-test' })\n      .then((res) => {\n        if (res.success) {\n          setQuizData(res.data);\n        }\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  useEffect(() => {\n    fetchQuiz();\n  }, [fetchQuiz]);\n\n  if (!quizData) return <Spin />;\n\n  return (\n    <div style={{ position: 'relative', paddingBottom: '64px' }}>\n      <ProForm<FormData>\n        submitter={{\n          render: (_p, [reset, submit]) => (\n            <Space style={{ position: 'absolute', bottom: 0, left: 0 }}>\n              {reset}\n              {submit}\n            </Space>\n          ),\n        }}\n        initialValues={quizData}\n        onFinish={onFormFinish}\n      >\n        <ProFormGroup>\n          <ProFormDigit\n            name=\"max_attempts\"\n            label={<FormattedMessage id=\"max_attempts\" />}\n            tooltip={<FormattedMessage id=\"max_attempts\" />}\n            placeholder={intl.formatMessage({\n              id: 'max_attempts',\n              defaultMessage: 'max_attempts',\n            })}\n          />\n          <ProFormDigit\n            name=\"max_execution_time\"\n            label={<FormattedMessage id=\"max_execution_time\" />}\n            tooltip={<FormattedMessage id=\"max_execution_time\" />}\n            placeholder={intl.formatMessage({\n              id: 'max_execution_time',\n              defaultMessage: 'max_execution_time',\n            })}\n          />\n        </ProFormGroup>\n      </ProForm>\n      <Divider />\n      <Table\n        questions={quizData.questions}\n        quizId={quizData.id}\n        onAdded={fetchQuiz}\n        onEdited={fetchQuiz}\n        onRemoved={fetchQuiz}\n        tableHeader={<FormattedMessage id=\"questions\" />}\n        tableLoading={loading}\n        questionsCategory={{ type: 'question' }}\n      />\n    </div>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { history, FormattedMessage, useIntl, useParams } from 'umi';\nimport { Spin } from 'antd';\nimport { PageContainer } from '@ant-design/pro-layout';\nimport ProCard from '@ant-design/pro-card';\n\nimport { CompetencyChallengeContextProvider, useCompetencyChallengeContext } from './context';\nimport { MainForm } from './components/MainForm';\nimport { Scales } from './components/Scales';\nimport { DiagnosticTest } from './components/DiagnosticTest';\n\nconst CompetencyChallengeContent: React.FC = () => {\n  const { competencyChallenge } = useCompetencyChallengeContext();\n  const intl = useIntl();\n  const { id, tab = 'main' } = useParams<{ id?: string; tab?: string }>();\n  const isNew = id === 'new';\n\n  const pageTitle = useMemo(() => {\n    if (isNew) return intl.formatMessage({ id: 'CompetencyChallenges.new_challenge' });\n    if (competencyChallenge.data?.name) return competencyChallenge.data.name;\n\n    return intl.formatMessage({ id: 'menu.Competency challenges' });\n  }, [intl, competencyChallenge.data?.name]);\n\n  return (\n    <PageContainer\n      title={pageTitle}\n      header={{\n        breadcrumb: {\n          routes: [\n            {\n              path: 'competency-challenges',\n              breadcrumbName: intl.formatMessage({\n                id: 'menu.Competency challenges',\n              }),\n            },\n            {\n              path: String(id),\n              breadcrumbName: pageTitle,\n            },\n            {\n              path: tab,\n              breadcrumbName: intl.formatMessage({ id: `CompetencyChallenges.${tab}` }),\n            },\n          ],\n        },\n      }}\n    >\n      <ProCard\n        bodyStyle={{ padding: '24px' }}\n        tabs={{\n          type: 'card',\n          cardProps: { loading: competencyChallenge.loading && <Spin /> },\n          activeKey: tab,\n          onChange: (key) => {\n            history.push(`/competency-challenges/${id}/${key}`);\n          },\n        }}\n      >\n        <ProCard.TabPane key=\"main\" tab={<FormattedMessage id=\"CompetencyChallenges.main\" />}>\n          <MainForm />\n        </ProCard.TabPane>\n        <ProCard.TabPane\n          key=\"scales\"\n          tab={<FormattedMessage id=\"CompetencyChallenges.scales\" />}\n          disabled={isNew}\n        >\n          <Scales />\n        </ProCard.TabPane>\n        <ProCard.TabPane\n          key=\"diagnostic-test\"\n          tab={<FormattedMessage id=\"CompetencyChallenges.diagnostic-test\" />}\n          disabled={isNew}\n        >\n          <DiagnosticTest />\n        </ProCard.TabPane>\n      </ProCard>\n    </PageContainer>\n  );\n};\n\nconst CompetencyChallenge: React.FC = () => (\n  <CompetencyChallengeContextProvider>\n    <CompetencyChallengeContent />\n  </CompetencyChallengeContextProvider>\n);\n\nexport default CompetencyChallenge;\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/competency-challenges */\nexport async function getCompetencyChallenges(\n  params?: API.CompetencyChallengesParams,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultMetaResponse<API.CompetencyChallenge>>(\n    `/api/admin/competency-challenges`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      params,\n      ...(options || {}),\n    },\n  );\n}\n\n/** GET /api/admin/competency-challenges/:competency_challenge_id */\nexport async function getCompetencyChallenge(\n  competency_challenge_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.CompetencyChallenge>>(\n    `/api/admin/competency-challenges/${competency_challenge_id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/** POST /api/admin/competency-challenges */\nexport async function createCompetencyChallenge(\n  body: API.CreateCompetencyChallenge,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.CompetencyChallenge>>(`/api/admin/competency-challenges`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/** PUT /api/admin/competency-challenges/:competency_challenge_id */\nexport async function updateCompetencyChallenge(\n  competency_challenge_id: number,\n  body: API.UpdateCompetencyChallenge,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.CompetencyChallenge>>(\n    `/api/admin/competency-challenges/${competency_challenge_id}`,\n    {\n      method: 'PUT',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  DELETE /api/admin/competency-challenges/:competency_challenge_id */\nexport async function deleteCompetencyChallenge(\n  competency_challenge_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DeleteResponse>(\n    `/api/admin/competency-challenges/${competency_challenge_id}`,\n    {\n      method: 'DELETE',\n      ...(options || {}),\n    },\n  );\n}\n\n/** POST /api/admin/competency-challenges/scales */\nexport async function createCompetencyChallengeScale(\n  body: API.CreateCompetencyChallengeScale,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.CompetencyChallengeScale>>(\n    `/api/admin/competency-challenges/scales`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/** PATCH /api/admin/competency-challenges/scales/:competency_challenge_scale_id */\nexport async function updateCompetencyChallengeScale(\n  competency_challenge_scale_id: number,\n  body: API.CreateCompetencyChallengeScale,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.CompetencyChallengeScale>>(\n    `/api/admin/competency-challenges/scales/${competency_challenge_scale_id}`,\n    {\n      method: 'PATCH',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  DELETE /api/admin/competency-challenges/scales/:competency_challenge_scale_id */\nexport async function deleteCompetencyChallengeScale(\n  competency_challenge_scale_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DeleteResponse>(\n    `/api/admin/competency-challenges/scales/${competency_challenge_scale_id}`,\n    {\n      method: 'DELETE',\n      ...(options || {}),\n    },\n  );\n}\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { TreeSelect } from 'antd';\n\nimport { categoryTree } from '@/services/escola-lms/category';\nimport { useCompetencyChallengeContext } from '../context';\n\ntype TreeNodeType = {\n  title: string;\n  value: number;\n  disabled?: boolean;\n  children?: TreeNodeType[];\n};\n\nconst treeConvert = (\n  category: API.Category,\n  disabledNodes: number[],\n  enabledDepth: number,\n  depth: number = 0,\n): TreeNodeType => {\n  return category.subcategories?.length\n    ? {\n        title: category.name,\n        value: category.id,\n        disabled: depth !== enabledDepth || disabledNodes.includes(category.id),\n        children: category.subcategories.map((cat) =>\n          treeConvert(cat, disabledNodes, enabledDepth, depth + 1),\n        ),\n      }\n    : {\n        title: category.name,\n        value: category.id,\n        disabled: depth !== enabledDepth || disabledNodes.includes(category.id),\n      };\n};\n\nexport interface CompetencyChallengeCategoryTreeProps {\n  value?: string | string[] | number | number[];\n  onChange?: (value: string | string[] | number | number[]) => void;\n  type?: 'scale' | 'question';\n  disabledNodes?: number[]; // categories id arr\n}\n\nexport const CompetencyChallengeCategoryTree: React.FC<CompetencyChallengeCategoryTreeProps> = ({\n  value,\n  onChange,\n  type = 'scale',\n  disabledNodes = [],\n}) => {\n  const [categories, setCategories] = useState<API.Category[]>([]);\n  const { categoryDepths, competencyChallenge } = useCompetencyChallengeContext();\n\n  const categoriesToShow = useMemo(\n    () =>\n      competencyChallenge.data?.type === 'simple'\n        ? categories.filter((category) => category.id === competencyChallenge.data?.category?.id)\n        : categories,\n    [categories, competencyChallenge.data?.type, competencyChallenge.data?.category?.id],\n  );\n\n  const treeData = useMemo(\n    () => categoriesToShow.map((cat) => treeConvert(cat, disabledNodes, categoryDepths[type])),\n    [categoriesToShow, disabledNodes, type],\n  );\n\n  useEffect(() => {\n    categoryTree().then((response) => {\n      if (response.success) {\n        setCategories(response.data);\n      }\n    });\n  }, []);\n\n  return (\n    <TreeSelect<string | string[] | number | number[]>\n      loading={categories.length === 0}\n      showSearch\n      value={value}\n      dropdownStyle={{ maxHeight: 400, overflow: 'auto' }}\n      placeholder={<FormattedMessage id=\"select\" defaultMessage=\"Please select\" />}\n      allowClear\n      treeDefaultExpandAll\n      onChange={onChange}\n      treeData={treeData}\n      disabled={categories.length === 0}\n    />\n  );\n};\n","import React from 'react';\nimport RichMarkdownEditor2 from 'traverse-markdown-editor';\nimport { upload, resizedImage } from '@/services/escola-lms/files';\nimport './index.css';\nimport { useIntl } from 'umi';\n\ninterface FormWysiwygProps {\n  value?: string;\n  defaultValue?: string;\n  onChange?: (value: string) => void;\n  directory?: string;\n}\n\nexport const EmbedUploaded: React.FC<{ attrs: { href: string } }> = ({ attrs }) => {\n  const href = attrs.href;\n  const filename = href.split('/').pop();\n  return (\n    <p>\n      <a rel=\"noreferrer\" href={href} target=\"_blank\">\n        {filename}\n      </a>\n    </p>\n  );\n};\n\nexport const FormWysiwyg: React.FC<FormWysiwygProps> = ({\n  value,\n  onChange,\n  directory = '/wysiwyg',\n}) => {\n  const intl = useIntl();\n\n  return (\n    <div className=\"form-wysiwyg-markdown\">\n      <RichMarkdownEditor2\n        excludeBlockMenuItems={['Sketch']}\n        embeds={[\n          {\n            matcher: (url) => {\n              return true;\n            },\n            component: EmbedUploaded,\n          },\n        ]}\n        uploadImage={async (file) => {\n          const result = await upload(file, directory);\n\n          if (result.success) {\n            if (file.type.includes('image/')) {\n              const resizePath = result.data[0].name.includes('/')\n                ? result.data[0].name\n                : `${directory}${result.data[0].name}`;\n              return resizedImage(resizePath, 1000);\n            }\n            return result.data[0].url;\n          }\n          throw new Error('Error while uploading');\n        }}\n        defaultValue={value || ''}\n        onChange={(v) => onChange && onChange(v())}\n        placeholder={intl.formatMessage({\n          id: 'wysiwyg_placeholder',\n        })}\n      />\n    </div>\n  );\n};\n\nexport default FormWysiwyg;\n","import React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { useParams } from 'umi';\n\nimport { getCompetencyChallenge } from '@/services/escola-lms/competency-challenges';\nimport { configs as getConfig } from '@/services/escola-lms/settings';\n\ninterface CategoryDepths {\n  role: number;\n  scale: number;\n  question: number;\n}\n\ninterface CompetencyChallengeContextData {\n  data: API.CompetencyChallenge | null;\n  loading: boolean;\n  error?: unknown;\n}\n\nexport interface CompetencyChallengeContext {\n  categoryDepths: CategoryDepths;\n  competencyChallenge: CompetencyChallengeContextData;\n  refreshData: () => Promise<void>;\n}\n\nconst initialValues: CompetencyChallengeContext = {\n  categoryDepths: { scale: 2, question: 1, role: 0 },\n  competencyChallenge: { data: null, loading: false },\n  refreshData: async () => console.warn('CONTEXT INIT'),\n};\n\nconst Context = React.createContext<CompetencyChallengeContext>(initialValues);\n\nexport const useCompetencyChallengeContext = () => useContext(Context);\n\nexport const CompetencyChallengeContextProvider: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const [competencyChallenge, setCompetencyChallenge] = useState<CompetencyChallengeContextData>(\n    initialValues.competencyChallenge,\n  );\n  const [categoryDepths, setCategoryDepths] = useState<CategoryDepths>(\n    initialValues.categoryDepths,\n  );\n\n  const { id } = useParams<{ id?: string }>();\n  const competency_challenge_id = Number(id);\n\n  const refreshData = useCallback(async () => {\n    if (Number.isNaN(competency_challenge_id)) return;\n\n    try {\n      setCompetencyChallenge((prev) => ({ ...prev, loading: true }));\n      const res = await getCompetencyChallenge(competency_challenge_id);\n\n      if (!res.success) {\n        setCompetencyChallenge((prev) => ({ ...prev, error: res.errors }));\n        return;\n      }\n\n      setCompetencyChallenge((prev) => ({ ...prev, data: res.data }));\n    } catch (error) {\n      setCompetencyChallenge((prev) => ({ ...prev, error }));\n    } finally {\n      setCompetencyChallenge((prev) => ({ ...prev, loading: false }));\n    }\n  }, [competency_challenge_id]);\n\n  const fetchCategoryDepths = useCallback(async () => {\n    try {\n      const res = await getConfig();\n      if (!res.success) return;\n\n      const scale = Number(\n        (res.data?.escolalms_competency_challenge as any)?.category?.scale?.depth?.value,\n      );\n      const question = Number(\n        (res.data?.escolalms_competency_challenge as any)?.category?.question?.depth?.value,\n      );\n      const role = Number(\n        (res.data?.escolalms_competency_challenge as any)?.category?.role?.depth?.value,\n      );\n\n      setCategoryDepths({\n        scale: Number.isNaN(scale) ? 2 : scale,\n        question: Number.isNaN(question) ? 1 : question,\n        role: Number.isNaN(role) ? 0 : role,\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }, []);\n\n  useEffect(() => {\n    refreshData();\n    fetchCategoryDepths();\n  }, [refreshData, fetchCategoryDepths]);\n\n  return (\n    <Context.Provider value={{ categoryDepths, competencyChallenge, refreshData }}>\n      {children}\n    </Context.Provider>\n  );\n};\n","import React from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { Button, Tooltip } from 'antd';\nimport ProForm, {\n  ProFormCheckbox,\n  ProFormDigit,\n  ProFormList,\n  ProFormText,\n} from '@ant-design/pro-form';\nimport { DeleteOutlined } from '@ant-design/icons';\n\nimport { QuestionType } from '@/services/escola-lms/enums';\n\nconst INITIAL_VALUES = {\n  [QuestionType.MULTIPLE_CHOICE]: [\n    { isCorrect: false, value: '' },\n    { isCorrect: false, value: '' },\n  ],\n  [QuestionType.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS]: [\n    { value: '', weight: '' },\n    { value: '', weight: '' },\n  ],\n};\n\ninterface Props {\n  type: QuestionType.MULTIPLE_CHOICE | QuestionType.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS;\n}\n\nexport const GiftQuizQuestionMultipleChoiceEditor: React.FC<Props> = ({ type }) => {\n  const intl = useIntl();\n\n  return (\n    <>\n      <ProFormText\n        name=\"question\"\n        label={<FormattedMessage id=\"question\" />}\n        rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n        required\n      />\n      <ProFormList\n        name=\"answers\"\n        creatorButtonProps={{\n          creatorButtonText: intl.formatMessage({ id: 'Questions.addAnswer' }),\n        }}\n        actionRender={() => []}\n        initialValue={INITIAL_VALUES[type] ?? []}\n      >\n        {(field, i, action, count) => (\n          <ProForm.Group\n            title={\n              <>\n                <FormattedMessage id=\"Questions.answer\" values={{ ordinalNumber: i + 1 }} />\n                {count > 2 && (\n                  <Tooltip title={intl.formatMessage({ id: 'Questions.deleteAnswer' })}>\n                    <Button\n                      type=\"text\"\n                      icon={<DeleteOutlined />}\n                      onClick={() => action.remove(field.name)}\n                    />\n                  </Tooltip>\n                )}\n              </>\n            }\n            titleStyle={{ width: '100%', display: 'flex', justifyContent: 'space-between' }}\n          >\n            {type === QuestionType.MULTIPLE_CHOICE && (\n              <ProFormCheckbox\n                name=\"isCorrect\"\n                label={\n                  <FormattedMessage\n                    id=\"Questions.correctAnswer\"\n                    defaultMessage=\"Is Correct Answer?\"\n                  />\n                }\n                rules={[\n                  ({ getFieldValue }) => ({\n                    validator: () => {\n                      const answers = getFieldValue('answers') ?? [];\n                      if (\n                        answers.filter((answer: { isCorrect: boolean }) => answer?.isCorrect)\n                          .length > 1\n                      ) {\n                        return Promise.reject('Only one answer can be correct');\n                      }\n\n                      return Promise.resolve();\n                    },\n                    message: <FormattedMessage id=\"Questions.onlyOneAnswerIsCorrect\" />,\n                  }),\n                ]}\n              />\n            )}\n            <ProFormText\n              name=\"value\"\n              rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n              label={<FormattedMessage id=\"content\" defaultMessage=\"Content\" />}\n            />\n            {type === QuestionType.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS && (\n              <ProFormDigit\n                name=\"weight\"\n                rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n                fieldProps={{ min: -Number.MAX_SAFE_INTEGER, addonAfter: '%' }}\n                label={<FormattedMessage id=\"weight\" defaultMessage=\"Weight\" />}\n              />\n            )}\n          </ProForm.Group>\n        )}\n      </ProFormList>\n    </>\n  );\n};\n","import React from 'react';\nimport { FormattedMessage } from 'umi';\nimport { ProFormCheckbox, ProFormText } from '@ant-design/pro-form';\n\nexport const GiftQuizQuestionTrueFalseEditor: React.FC = () => (\n  <>\n    <ProFormText\n      name=\"question\"\n      label={<FormattedMessage id=\"question\" />}\n      rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n      required\n    />\n    <ProFormCheckbox name=\"isCorrect\" label={<FormattedMessage id=\"Questions.correctAnswer\" />} />\n  </>\n);\n","import React from 'react';\nimport { useIntl, FormattedMessage } from 'umi';\nimport { ProFormList, ProFormText } from '@ant-design/pro-form';\n\nconst INITIAL_VALUES = [{ value: '' }];\n\nexport const GiftQuizQuestionShortEditor: React.FC = () => {\n  const intl = useIntl();\n\n  return (\n    <>\n      <ProFormText\n        name=\"question\"\n        label={<FormattedMessage id=\"question\" />}\n        rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n        required\n      />\n      <ProFormList\n        name=\"answers\"\n        creatorButtonProps={{\n          creatorButtonText: intl.formatMessage({ id: 'Questions.addAnswer' }),\n        }}\n        deleteIconProps={{ tooltipText: intl.formatMessage({ id: 'Questions.deleteAnswer' }) }}\n        actionRender={(_f, _a, [, deleteButton]) => [deleteButton]}\n        min={1}\n        initialValue={INITIAL_VALUES}\n      >\n        {(_f, i) => (\n          <ProFormText\n            name=\"value\"\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            label={\n              <FormattedMessage\n                id=\"Questions.answer\"\n                values={{ ordinalNumber: i + 1 }}\n                defaultMessage={`Answer ${i + 1}`}\n              />\n            }\n          />\n        )}\n      </ProFormList>\n    </>\n  );\n};\n","import React from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\nimport ProForm, { ProFormList, ProFormText } from '@ant-design/pro-form';\n\nconst INITIAL_VALUES = [\n  {\n    firstOfPair: '',\n    secondOfPair: '',\n  },\n];\n\nexport const GiftQuizQuestionMatchingEditor: React.FC = () => {\n  const intl = useIntl();\n\n  return (\n    <>\n      <ProFormText\n        name=\"question\"\n        label={<FormattedMessage id=\"question\" />}\n        rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n        required\n      />\n      <ProFormList\n        name=\"answers\"\n        creatorButtonProps={{\n          creatorButtonText: intl.formatMessage({\n            id: 'Questions.addMatchingPair',\n            defaultMessage: 'Add Matching Pair',\n          }),\n        }}\n        deleteIconProps={{ tooltipText: intl.formatMessage({ id: 'Questions.deletePair' }) }}\n        actionRender={(_f, _a, [, deleteButton]) => [deleteButton]}\n        min={1}\n        initialValue={INITIAL_VALUES}\n      >\n        {(_f, i) => (\n          <ProForm.Group\n            direction=\"horizontal\"\n            align=\"baseline\"\n            size=\"small\"\n            spaceProps={{ style: { flexWrap: 'nowrap' } }}\n            title={\n              <FormattedMessage\n                id=\"Questions.pair\"\n                values={{ ordinalNumber: i + 1 }}\n                defaultMessage={`Pair ${i + 1}`}\n              />\n            }\n          >\n            <ProFormText\n              name=\"firstOfPair\"\n              rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            />\n            <ProFormText\n              name=\"secondOfPair\"\n              rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            />\n          </ProForm.Group>\n        )}\n      </ProFormList>\n    </>\n  );\n};\n","import React from 'react';\nimport { FormattedMessage } from 'umi';\nimport { ProFormDigit, ProFormText } from '@ant-design/pro-form';\n\nexport const GiftQuizQuestionNumericalEditor: React.FC = () => (\n  <>\n    <ProFormText\n      name=\"question\"\n      label={<FormattedMessage id=\"question\" />}\n      rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n      required\n    />\n    <ProFormDigit\n      name=\"answer\"\n      label={<FormattedMessage id=\"answer\" />}\n      rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n      required\n    />\n    <ProFormDigit\n      name=\"errorMargin\"\n      fieldProps={{ addonAfter: '+/-' }}\n      label={<FormattedMessage id=\"Questions.errorMargin\" />}\n      rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n      required\n    />\n  </>\n);\n","import React from 'react';\nimport { FormattedMessage } from 'umi';\nimport { ProFormTextArea } from '@ant-design/pro-form';\n\nexport const GiftQuizQuestionEssayEditor: React.FC = () => (\n  <ProFormTextArea\n    name=\"question\"\n    label={<FormattedMessage id=\"question\" />}\n    rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n    required\n  />\n);\n","import React from 'react';\n\nimport { QuestionType } from '@/services/escola-lms/enums';\nimport { GiftQuizQuestionMultipleChoiceEditor } from './MultipleChoice';\nimport { GiftQuizQuestionTrueFalseEditor } from './TrueFalse';\nimport { GiftQuizQuestionShortEditor } from './ShortAnswers';\nimport { GiftQuizQuestionMatchingEditor } from './Matching';\nimport { GiftQuizQuestionNumericalEditor } from './Numerical';\nimport { GiftQuizQuestionEssayEditor } from './Essay';\n\ninterface Props {\n  type: QuestionType | undefined;\n}\n\nexport const GiftQuizQuestion: React.FC<Props> = ({ type }) => {\n  if (!type) return null;\n\n  switch (type) {\n    case QuestionType.MULTIPLE_CHOICE:\n    case QuestionType.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS:\n      return <GiftQuizQuestionMultipleChoiceEditor type={type} />;\n    case QuestionType.TRUE_FALSE:\n      return <GiftQuizQuestionTrueFalseEditor />;\n    case QuestionType.SHORT_ANSWERS:\n      return <GiftQuizQuestionShortEditor />;\n    case QuestionType.MATCHING:\n      return <GiftQuizQuestionMatchingEditor />;\n    case QuestionType.NUMERICAL_QUESTION:\n      return <GiftQuizQuestionNumericalEditor />;\n    case QuestionType.ESSAY:\n    case QuestionType.DESCRIPTION:\n      return <GiftQuizQuestionEssayEditor />;\n  }\n\n  return <pre>Unsupported type {type}</pre>;\n};\n","import { parse } from '@escolalms/gift-pegjs';\nimport type {\n  Description,\n  Essay,\n  Matching,\n  Numerical,\n  ShortAnswer,\n  TrueFalse,\n  MultipleChoice,\n} from '@escolalms/gift-pegjs';\n\nimport { QuestionType } from '@/services/escola-lms/enums';\nimport type {\n  DescriptionFormData,\n  EssayFormData,\n  GiftQuizFormData,\n  MatchingFormData,\n  MultipleChoiceFormData,\n  MultipleChoiceWithMultipleRightAnswersFormData,\n  NumericalFormData,\n  ShortAnswersFormData,\n  TrueFalseFormData,\n} from './types';\n\nconst escapeQuestionSpecialChars = (inputString: string): string => {\n  const charsToEscape = ['~', '=', '#', '{', '}', ':'];\n  let escapedString = '';\n\n  for (let i = 0; i < inputString.length; i++) {\n    const currentChar = inputString[i];\n    if (charsToEscape.includes(currentChar)) {\n      escapedString += `\\\\${currentChar}`;\n    } else {\n      escapedString += currentChar;\n    }\n  }\n\n  return escapedString;\n};\n\nconst parseMultipleChoice = ({ question, answers }: MultipleChoiceFormData): string => {\n  if (answers.length === 0) return `${question}{}`;\n\n  let giftString = `${question}{`;\n\n  for (const { isCorrect, value } of answers) {\n    const sign = isCorrect ? '=' : '~';\n\n    giftString += `${sign}${value}`;\n  }\n\n  giftString += '}';\n\n  return giftString.trim();\n};\n\nconst parseMultipleChoiceWithMultipleRightAnswers = ({\n  question,\n  answers,\n}: MultipleChoiceWithMultipleRightAnswersFormData): string => {\n  if (answers.length == 0) return `${question}{}`;\n\n  let giftString = `${question}{`;\n\n  for (const { value, weight } of answers) {\n    giftString += `~%${weight}%${value}`;\n  }\n\n  giftString += '}';\n\n  return giftString.trim();\n};\n\nconst parseTrueFalse = ({ question, isCorrect }: TrueFalseFormData): string =>\n  `${question}{${isCorrect ? 'T' : 'F'}}`;\n\nconst parseShortAnswers = ({ question, answers }: ShortAnswersFormData): string => {\n  if (answers.length === 0) return `${question}{}`;\n\n  let giftString = `${question}{`;\n\n  for (const { value } of answers) {\n    giftString += `=${value}`;\n  }\n\n  giftString += '}';\n\n  return giftString.trim();\n};\n\nconst parseMatching = ({ question, answers }: MatchingFormData): string => {\n  if (answers.length === 0) return `${question}{}`;\n\n  let giftString = `${question}{`;\n\n  for (const { firstOfPair, secondOfPair } of answers) {\n    giftString += `=${firstOfPair}->${secondOfPair}`;\n  }\n\n  giftString += '}';\n\n  return giftString.trim();\n};\n\nconst parseNumerical = ({ question, answer, errorMargin }: NumericalFormData): string =>\n  `${question}{#${answer}:${errorMargin}}`;\n\nconst parseEssay = ({ question }: EssayFormData): string => `${question}{}`;\n\nconst parseDescription = ({ question }: DescriptionFormData): string => question;\n\nexport const parseToGIFT = ({ question, ...formData }: GiftQuizFormData): string => {\n  const safeFormData = { question: escapeQuestionSpecialChars(question), ...formData };\n\n  switch (safeFormData.type) {\n    case QuestionType.MULTIPLE_CHOICE:\n      return parseMultipleChoice(safeFormData);\n    case QuestionType.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS:\n      return parseMultipleChoiceWithMultipleRightAnswers(safeFormData);\n    case QuestionType.TRUE_FALSE:\n      return parseTrueFalse(safeFormData);\n    case QuestionType.SHORT_ANSWERS:\n      return parseShortAnswers(safeFormData);\n    case QuestionType.MATCHING:\n      return parseMatching(safeFormData);\n    case QuestionType.NUMERICAL_QUESTION:\n      return parseNumerical(safeFormData);\n    case QuestionType.ESSAY:\n      return parseEssay(safeFormData);\n    case QuestionType.DESCRIPTION:\n      return parseDescription(safeFormData);\n    default:\n      throw new Error(`Unsupported type: ${(safeFormData as GiftQuizFormData).type}`);\n  }\n};\n\nconst parseMultipleChoiceToFormData = (\n  parsedValue: MultipleChoice,\n  { type, score, category_id }: API.QuizQuestion,\n): MultipleChoiceFormData | MultipleChoiceWithMultipleRightAnswersFormData => {\n  const question = parsedValue?.stem.text;\n\n  const isMultipleChoice = parsedValue.choices.every(({ weight }) => weight === null);\n\n  if (isMultipleChoice) {\n    const answers: MultipleChoiceFormData['answers'] = parsedValue.choices.map(\n      ({ isCorrect, text }) => ({\n        isCorrect,\n        value: text.text,\n      }),\n    );\n\n    return { type, score, category_id, question, answers };\n  }\n\n  const answers = parsedValue.choices.reduce<\n    MultipleChoiceWithMultipleRightAnswersFormData['answers']\n  >(\n    (acc, { weight, text }) => (weight !== null ? [...acc, { weight, value: text.text }] : acc),\n    [],\n  );\n\n  return { type, score, category_id, question, answers };\n};\n\nconst parseTrueFalseToFormData = (\n  parsedValue: TrueFalse,\n  { type, score, category_id }: API.QuizQuestion,\n): TrueFalseFormData => {\n  const question = parsedValue?.stem.text;\n  const isCorrect = parsedValue.isTrue;\n\n  return { type, score, category_id, question, isCorrect };\n};\n\nconst parseShortAnswersToFormData = (\n  parsedValue: ShortAnswer,\n  { type, score, category_id }: API.QuizQuestion,\n): ShortAnswersFormData => {\n  const question = parsedValue?.stem.text;\n\n  const answers: ShortAnswersFormData['answers'] = parsedValue.choices.map(({ text }) => ({\n    value: text.text,\n  }));\n\n  return { type, score, category_id, question, answers };\n};\n\nconst parseMatchingToFormData = (\n  parsedValue: Matching,\n  { type, score, category_id }: API.QuizQuestion,\n): MatchingFormData => {\n  const question = parsedValue?.stem.text;\n  const answers: MatchingFormData['answers'] = parsedValue.matchPairs.map(\n    ({ subquestion, subanswer }) => ({ firstOfPair: subquestion.text, secondOfPair: subanswer }),\n  );\n\n  return { type, score, category_id, question, answers };\n};\n\nconst parseNumericalToFormData = (\n  parsedValue: Numerical,\n  { type, score, category_id }: API.QuizQuestion,\n): NumericalFormData => {\n  const question = parsedValue?.stem.text;\n\n  // TODO\n  if (Array.isArray(parsedValue?.choices)) {\n    throw new Error('Unsupported choices type: array');\n  }\n\n  const answer = parsedValue?.choices.number;\n  const errorMargin = parsedValue?.choices.range;\n\n  if (answer === undefined || errorMargin === undefined) {\n    throw new Error(`Value undefined - answer: ${answer} errorMargin: ${errorMargin}`);\n  }\n\n  return { type, score, category_id, question, answer, errorMargin };\n};\n\nconst parseDescriptionEssayToFormData = (\n  parsedValue: Description | Essay,\n  { type, score, category_id }: API.QuizQuestion,\n): DescriptionFormData | EssayFormData => {\n  const question = parsedValue?.stem.text;\n\n  return { type, score, category_id, question };\n};\n\nexport function parseToFormData(\n  questionBase: API.QuizQuestion | undefined,\n): GiftQuizFormData | undefined {\n  if (!questionBase) return;\n\n  const [parsedValue] = parse(questionBase.value);\n\n  switch (parsedValue.type) {\n    case 'MC':\n      return parseMultipleChoiceToFormData(parsedValue, questionBase);\n    case 'TF':\n      return parseTrueFalseToFormData(parsedValue, questionBase);\n    case 'Short':\n      return parseShortAnswersToFormData(parsedValue, questionBase);\n    case 'Matching':\n      return parseMatchingToFormData(parsedValue, questionBase);\n    case 'Numerical':\n      return parseNumericalToFormData(parsedValue, questionBase);\n    case 'Description':\n    case 'Essay':\n      return parseDescriptionEssayToFormData(parsedValue, questionBase);\n    default:\n      throw new Error(`Unsupported type: ${parsedValue?.type}`);\n  }\n}\n","import React, { useCallback, useEffect, useMemo } from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { Space, Divider } from 'antd';\nimport ProForm, { ProFormDigit, ProFormSelect } from '@ant-design/pro-form';\n\nimport { QuestionType } from '@/services/escola-lms/enums';\nimport {\n  CompetencyChallengeCategoryTree,\n  type CompetencyChallengeCategoryTreeProps,\n} from '@/pages/CompetencyChallenges/components/CompetencyChallengeCategoryTree';\nimport { GiftQuizQuestion } from './question';\nimport type { QuizQuestionSubmitData, GiftQuizFormData } from './types';\nimport { parseToFormData, parseToGIFT } from './utils';\n\nconst VALUES_NOT_TO_RESET = ['type', 'score', 'category'];\n\nconst TYPE_OPTIONS = Object.values(QuestionType).reduce<\n  { value: QuestionType; label: React.ReactNode }[]\n>(\n  (acc, q) => (q ? [...acc, { value: q, label: <FormattedMessage id={`gift_type.${q}`} /> }] : acc),\n  [],\n);\n\ninterface Props {\n  onSubmit: (quizQuestion: QuizQuestionSubmitData) => Promise<boolean>;\n  values?: API.QuizQuestion;\n  competencyChallengeCategoryTreeProps?:\n    | boolean\n    | Omit<CompetencyChallengeCategoryTreeProps, 'value' | 'onChange'>;\n}\n\nexport const GiftQuizQuestionEditor: React.FC<Props> = ({\n  onSubmit,\n  values,\n  competencyChallengeCategoryTreeProps = false,\n}) => {\n  const intl = useIntl();\n\n  const [form] = ProForm.useForm<GiftQuizFormData>();\n  const type: API.QuestionType | undefined = ProForm.useWatch('type', form);\n\n  const initialValues = useMemo(() => parseToFormData(values), [values]);\n\n  const onFinish = useCallback(async (formData: GiftQuizFormData) => {\n    const value = parseToGIFT(formData);\n\n    const { score, category_id } = formData;\n    const status = await onSubmit({ value, score, category_id });\n\n    if (!status) {\n      return;\n    }\n\n    form.resetFields();\n  }, []);\n\n  useEffect(() => {\n    form.resetFields();\n  }, [initialValues]);\n\n  useEffect(() => {\n    if (type) {\n      const fields = form.getFieldsValue();\n      const fieldsToReset = Object.keys(fields).filter((key) => !VALUES_NOT_TO_RESET.includes(key));\n\n      form.resetFields(fieldsToReset);\n    }\n  }, [type]);\n\n  return (\n    <Space direction=\"vertical\" style={{ display: 'flex' }}>\n      <Divider>\n        <FormattedMessage id={initialValues ? 'Questions.edit' : 'addNewQuestion'} />\n      </Divider>\n      <ProForm layout=\"horizontal\" form={form} onFinish={onFinish} initialValues={initialValues}>\n        <ProFormSelect\n          name=\"type\"\n          placeholder={intl.formatMessage({\n            id: 'selectNewQuestionType',\n            defaultMessage: 'Select new question type',\n          })}\n          label={<FormattedMessage id=\"type\" defaultMessage=\"Type:\" />}\n          options={TYPE_OPTIONS}\n          rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n          required\n        />\n        <GiftQuizQuestion type={type} />\n        <ProFormDigit\n          name=\"score\"\n          label={<FormattedMessage id=\"Questions.score\" defaultMessage=\"Score\" />}\n          rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n        />\n        {competencyChallengeCategoryTreeProps && (\n          <ProForm.Item\n            name=\"category_id\"\n            label={<FormattedMessage id=\"category\" defaultMessage=\"Category\" />}\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            required\n          >\n            <CompetencyChallengeCategoryTree\n              {...(typeof competencyChallengeCategoryTreeProps === 'object'\n                ? competencyChallengeCategoryTreeProps\n                : {})}\n            />\n          </ProForm.Item>\n        )}\n      </ProForm>\n    </Space>\n  );\n};\n","import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { SortableContainer, SortableElement, SortableHandle } from 'react-sortable-hoc';\nimport { arrayMoveImmutable } from 'array-move';\nimport { parse } from '@escolalms/gift-pegjs';\nimport { Button, Drawer, Typography, Switch } from 'antd';\nimport { MenuOutlined, PlusCircleOutlined } from '@ant-design/icons';\nimport { ProTable } from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\n\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport type { CompetencyChallengeCategoryTreeProps } from '@/pages/CompetencyChallenges/components/CompetencyChallengeCategoryTree';\nimport { createQuestion, deleteQuestion, updateQuestion } from '@/services/escola-lms/gift_quiz';\nimport { GiftQuizQuestionEditor } from './editor';\nimport type { QuizQuestionSubmitData } from './editor/types';\nimport './index.css';\n\nconst DragHandle = SortableHandle(() => <MenuOutlined style={{ cursor: 'grab', color: '#999' }} />);\nconst SortableItem = SortableElement((props: React.HTMLAttributes<HTMLTableRowElement>) => (\n  <tr {...props} />\n));\nconst SortContainer = SortableContainer((props: React.HTMLAttributes<HTMLTableSectionElement>) => (\n  <tbody {...props} />\n));\n\nconst staticColumns: ProColumns<API.QuizQuestion>[] = [\n  {\n    title: <FormattedMessage id=\"sort\" defaultMessage=\"sort\" />,\n    dataIndex: 'id',\n    width: 60,\n    className: 'drag-visible',\n    render: () => <DragHandle />,\n  },\n  {\n    title: <FormattedMessage id=\"type\" defaultMessage=\"Type\" />,\n    dataIndex: 'type',\n    hideInForm: true,\n    hideInSearch: true,\n    hideInSetting: true,\n    render: (_, row) => <FormattedMessage id={`gift_type.${row.type}`} />,\n  },\n  {\n    title: <FormattedMessage id=\"question\" defaultMessage=\"Question\" />,\n    dataIndex: 'question',\n    hideInForm: true,\n    hideInSearch: true,\n    hideInSetting: true,\n    render: (_, row) => {\n      const obj = parse(row.value);\n\n      if (obj?.[0] && 'stem' in obj[0]) {\n        return obj[0].stem.text;\n      }\n      return 'question';\n    },\n  },\n];\n\nconst categoryColumn: ProColumns<API.QuizQuestion> = {\n  title: <FormattedMessage id=\"category\" defaultMessage=\"Category\" />,\n  dataIndex: 'category_id',\n  hideInForm: true,\n  hideInSearch: true,\n  hideInSetting: true,\n  render: (_, row) =>\n    typeof row.category_id === 'number' ? (\n      <TypeButtonDrawer type=\"Category\" type_id={row.category_id} />\n    ) : (\n      '-'\n    ),\n};\n\ninterface OnSortEndParams {\n  oldIndex: number;\n  newIndex: number;\n}\n\ninterface Props {\n  quizId: number;\n  questions: API.QuizQuestion[];\n  onAdded?: () => void;\n  onRemoved?: () => void;\n  onEdited?: () => void;\n  tableHeader?: React.ReactNode;\n  tableLoading?: boolean;\n  questionsCategory?: boolean | Omit<CompetencyChallengeCategoryTreeProps, 'value' | 'onChange'>;\n}\n\nexport const Table: React.FC<Props> = ({\n  questions,\n  onAdded,\n  onRemoved,\n  onEdited,\n  quizId,\n  tableLoading,\n  tableHeader,\n  questionsCategory,\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [newQuestion, setNewQuestion] = useState(false);\n  const [editQuestion, setEditQuestion] = useState<API.QuizQuestion>();\n\n  const [debug, setDebug] = useState(false);\n\n  const [dataSource, setDataSource] = useState(questions);\n\n  const actionRef = useRef<ActionType>();\n\n  useEffect(() => {\n    actionRef.current?.reload();\n    setDataSource(questions);\n  }, [questions]);\n\n  const onSortEnd = ({ oldIndex, newIndex }: OnSortEndParams) => {\n    if (oldIndex !== newIndex) {\n      const newData = arrayMoveImmutable(dataSource.slice(), oldIndex, newIndex)\n        .filter(Boolean)\n        .map((row, index) => ({ ...row, order: index }));\n\n      newData.forEach((newRow, index) => {\n        if (newRow.id !== dataSource[index].id) {\n          updateQuestion(newRow.id, { ...newRow, order: index + 1, topic_gift_quiz_id: quizId });\n        }\n      });\n\n      setDataSource(newData);\n    }\n  };\n\n  // TODO types & refactor https://react.dev/learn/your-first-component#nesting-and-organizing-components\n  const DraggableContainer = (props: any) => (\n    <SortContainer\n      useDragHandle\n      disableAutoscroll\n      helperClass=\"row-dragging\"\n      onSortEnd={onSortEnd}\n      {...props}\n    />\n  );\n\n  // TODO types & refactor https://react.dev/learn/your-first-component#nesting-and-organizing-components\n  const DraggableBodyRow = (props: any) => {\n    const { className, style, ...restProps } = props;\n    // function findIndex base on Table rowKey props and should always be a right array index\n    const index = dataSource.findIndex((x) => x.id === restProps['data-row-key']);\n    return <SortableItem index={index} {...restProps} />;\n  };\n\n  const onNewQuestionSubmit = useCallback(\n    async (data: QuizQuestionSubmitData) => {\n      try {\n        setLoading(true);\n\n        const response = await createQuestion({ topic_gift_quiz_id: quizId, ...data });\n        setNewQuestion(false);\n        onAdded?.();\n        return response.success;\n      } catch (err) {\n        console.log(err);\n        return false;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [newQuestion, quizId],\n  );\n\n  const onEditQuestionSubmit = useCallback(\n    async (data: QuizQuestionSubmitData) => {\n      if (editQuestion?.id === undefined) return false;\n\n      try {\n        setLoading(true);\n\n        const response = await updateQuestion(editQuestion.id, {\n          topic_gift_quiz_id: quizId,\n          ...data,\n        });\n        setEditQuestion(undefined);\n        onEdited?.();\n        return response.success;\n      } catch (err) {\n        console.log(err);\n        return false;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [editQuestion?.id, quizId],\n  );\n\n  return (\n    <>\n      <Drawer open={newQuestion} onClose={() => setNewQuestion(false)}>\n        <GiftQuizQuestionEditor\n          onSubmit={onNewQuestionSubmit}\n          competencyChallengeCategoryTreeProps={questionsCategory}\n        />\n      </Drawer>\n      <Drawer open={!!editQuestion} onClose={() => setEditQuestion(undefined)}>\n        <GiftQuizQuestionEditor\n          onSubmit={onEditQuestionSubmit}\n          competencyChallengeCategoryTreeProps={questionsCategory}\n          values={editQuestion}\n        />\n      </Drawer>\n      <ProTable\n        search={false}\n        cardProps={{ bodyStyle: { padding: 0 } }}\n        loading={tableLoading}\n        headerTitle={tableHeader}\n        toolbar={{ settings: [] }}\n        toolBarRender={() => [\n          <Button\n            key=\"add\"\n            icon={<PlusCircleOutlined />}\n            type=\"primary\"\n            onClick={() => setNewQuestion(true)}\n          >\n            {' '}\n            <FormattedMessage id=\"addNewQuestion\" defaultMessage=\"Add new question\" />\n          </Button>,\n        ]}\n        columns={[\n          ...staticColumns,\n          ...(questionsCategory ? [categoryColumn] : []),\n          {\n            title: <FormattedMessage id=\"actions\" defaultMessage=\"Actions\" />,\n            dataIndex: 'address',\n            valueType: 'option',\n            render: (_, row) => [\n              <Button\n                key=\"edit\"\n                size=\"small\"\n                type=\"primary\"\n                onClick={() => {\n                  setEditQuestion(row);\n                }}\n              >\n                <FormattedMessage id=\"Questions.edit\" defaultMessage=\"Edit Question\" />\n              </Button>,\n              <Button\n                loading={loading}\n                key=\"delete\"\n                size=\"small\"\n                danger\n                onClick={() => {\n                  setLoading(true);\n                  deleteQuestion(row.id)\n                    .then(() => {\n                      if (onRemoved) {\n                        onRemoved();\n                      }\n                    })\n                    .finally(() => {\n                      setLoading(false);\n                    });\n                }}\n              >\n                <FormattedMessage id=\"Questions.delete\" defaultMessage=\"Delete Question\" />\n              </Button>,\n            ],\n          },\n        ]}\n        rowKey={(record) => record.id}\n        pagination={false}\n        dataSource={dataSource}\n        components={{\n          body: {\n            wrapper: DraggableContainer,\n            row: DraggableBodyRow,\n          },\n        }}\n      />\n      <Typography style={{ marginTop: '3em' }}>\n        Debug GIFT: <Switch checked={debug} onChange={(v) => setDebug(v)} />\n      </Typography>\n    </>\n  );\n};\n"],"sourceRoot":""}