"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803,8047],{56717:function(Tt,et,o){var ze=o(1413),m=o(67294),Ke=o(93696),Ze=o(84089),ye=function(h,v){return m.createElement(Ze.Z,(0,ze.Z)((0,ze.Z)({},h),{},{ref:v,icon:Ke.Z}))},B=m.forwardRef(ye);et.Z=B},78677:function(Tt,et,o){var ze=o(67294),m=o(76390),Ke=function(){return Ke=Object.assign||function(ye){for(var B,Oe=1,h=arguments.length;Oe<h;Oe++){B=arguments[Oe];for(var v in B)Object.prototype.hasOwnProperty.call(B,v)&&(ye[v]=B[v])}return ye},Ke.apply(this,arguments)},Ze=(0,ze.forwardRef)(function(ye,B){return ze.createElement(m.P,Ke({},ye,{chartType:"Column",ref:B}))});et.Z=Ze},88280:function(Tt,et,o){o.d(et,{Z:function(){return ie}});var ze=o(4942),m=o(97685),Ke=o(45987),Ze=o(74165),ye=o(15861),B=o(1413),Oe=o(87462),h=o(67294),v=o(42110),s=o(78026),ee=function(E,e){return h.createElement(s.Z,(0,Oe.Z)({},E,{ref:e,icon:v.Z}))},c=h.forwardRef(ee),P=c,i=o(97462),_=o(952),w=o(10915),ae=o(48171),Z=o(53914),H=o(22270),be=o(60249),ge=o(14726),je=o(75842),Ve=o(21770),nt=o(88306),pt=o(8880),ht=o(48433),we=o(85893),Ft=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],xt=["record","position","creatorButtonText","newRecordType","parentKey","style"],_e=h.createContext(void 0);function F(y){var E=y.children,e=y.record,De=y.position,Ie=y.newRecordType,de=y.parentKey,Ue=(0,h.useContext)(_e);return h.cloneElement(E,(0,B.Z)((0,B.Z)({},E.props),{},{onClick:function(){var Ne=(0,ye.Z)((0,Ze.Z)().mark(function Ce(Ye){var Be,Re,ve,me;return(0,Ze.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(Be=(Re=E.props).onClick)===null||Be===void 0?void 0:Be.call(Re,Ye);case 2:if(me=W.sent,me!==!1){W.next=5;break}return W.abrupt("return");case 5:Ue==null||(ve=Ue.current)===null||ve===void 0||ve.addEditRecord(e,{position:De,newRecordType:Ie,parentKey:de});case 6:case"end":return W.stop()}},Ce)}));function Me(Ce){return Ne.apply(this,arguments)}return Me}()}))}function le(y){var E,e,De=(0,w.YB)(),Ie=y.onTableChange,de=y.maxLength,Ue=y.formItemProps,Ne=y.recordCreatorProps,Me=y.rowKey,Ce=y.controlled,Ye=y.defaultValue,Be=y.onChange,Re=y.editableFormRef,ve=(0,Ke.Z)(y,Ft),me=(0,h.useRef)(void 0),re=(0,h.useRef)(),W=(0,h.useRef)();(0,h.useImperativeHandle)(ve.actionRef,function(){return re.current},[re.current]);var I=(0,Ve.Z)(function(){return y.value||Ye||[]},{value:y.value,onChange:y.onChange}),Ge=(0,m.Z)(I,2),ue=Ge[0],Et=Ge[1],tt=h.useMemo(function(){return typeof Me=="function"?Me:function(k,te){return k[Me]||te}},[Me]),jt=(0,ae.J)(function(k){if(typeof k=="number"&&!y.name){if(k>=ue.length)return k;var te=ue&&ue[k];return tt==null?void 0:tt(te,k)}if((typeof k=="string"||k>=ue.length)&&y.name){var ce=ue.findIndex(function(fe,he){var Te;return(tt==null||(Te=tt(fe,he))===null||Te===void 0?void 0:Te.toString())===(k==null?void 0:k.toString())});if(ce!==-1)return ce}return k});(0,h.useImperativeHandle)(Re,function(){var k=function(fe){var he,Te;if(fe==null)throw new Error("rowIndex is required");var Je=jt(fe),it=[y.name,(he=Je==null?void 0:Je.toString())!==null&&he!==void 0?he:""].flat(1).filter(Boolean);return(Te=W.current)===null||Te===void 0?void 0:Te.getFieldValue(it)},te=function(){var fe,he=[y.name].flat(1).filter(Boolean);if(Array.isArray(he)&&he.length===0){var Te,Je=(Te=W.current)===null||Te===void 0?void 0:Te.getFieldsValue();return Array.isArray(Je)?Je:Object.keys(Je).map(function(it){return Je[it]})}return(fe=W.current)===null||fe===void 0?void 0:fe.getFieldValue(he)};return(0,B.Z)((0,B.Z)({},W.current),{},{getRowData:k,getRowsData:te,setRowData:function(fe,he){var Te,Je;if(fe==null)throw new Error("rowIndex is required");var it=jt(fe),_t=[y.name,(Te=it==null?void 0:it.toString())!==null&&Te!==void 0?Te:""].flat(1).filter(Boolean),Dt=Object.assign({},(0,B.Z)((0,B.Z)({},k(fe)),he||{})),at=(0,pt.Z)({},_t,Dt);return(Je=W.current)===null||Je===void 0||Je.setFieldsValue(at),!0}})},[jt,y.name,W.current]),(0,h.useEffect)(function(){y.controlled&&(ue||[]).forEach(function(k,te){var ce;(ce=W.current)===null||ce===void 0||ce.setFieldsValue((0,ze.Z)({},"".concat(tt(k,te)),k))},{})},[(0,Z.ZP)(ue),y.controlled]),(0,h.useEffect)(function(){if(y.name){var k;W.current=y==null||(k=y.editable)===null||k===void 0?void 0:k.form}},[(E=y.editable)===null||E===void 0?void 0:E.form,y.name]);var rt=Ne||{},Rt=rt.record,bt=rt.position,Pt=rt.creatorButtonText,Zt=rt.newRecordType,Gt=rt.parentKey,wt=rt.style,N=(0,Ke.Z)(rt,xt),J=bt==="top",V=(0,h.useMemo)(function(){return typeof de=="number"&&de<=(ue==null?void 0:ue.length)?!1:Ne!==!1&&(0,we.jsx)(F,{record:(0,H.h)(Rt,ue==null?void 0:ue.length,ue)||{},position:bt,parentKey:(0,H.h)(Gt,ue==null?void 0:ue.length,ue),newRecordType:Zt,children:(0,we.jsx)(ge.ZP,(0,B.Z)((0,B.Z)({type:"dashed",style:(0,B.Z)({display:"block",margin:"10px 0",width:"100%"},wt),icon:(0,we.jsx)(P,{})},N),{},{children:Pt||De.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ne,de,ue==null?void 0:ue.length]),z=(0,h.useMemo)(function(){return V?J?{components:{header:{wrapper:function(te){var ce,fe=te.className,he=te.children;return(0,we.jsxs)("thead",{className:fe,children:[he,(0,we.jsxs)("tr",{style:{position:"relative"},children:[(0,we.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:V}),(0,we.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ce=ve.columns)===null||ce===void 0?void 0:ce.length,children:V})]})]})}}}}:{tableViewRender:function(te,ce){var fe,he;return(0,we.jsxs)(we.Fragment,{children:[(fe=(he=y.tableViewRender)===null||he===void 0?void 0:he.call(y,te,ce))!==null&&fe!==void 0?fe:ce,V]})}}:{}},[J,V]),K=(0,B.Z)({},y.editable),Q=(0,ae.J)(function(k,te){var ce,fe,he;if((ce=y.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,k,te),(he=y.onValuesChange)===null||he===void 0||he.call(y,te,k),y.controlled){var Te;y==null||(Te=y.onChange)===null||Te===void 0||Te.call(y,te)}});return(y!=null&&y.onValuesChange||(e=y.editable)!==null&&e!==void 0&&e.onValuesChange||y.controlled&&y!==null&&y!==void 0&&y.onChange)&&(K.onValuesChange=Q),(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(_e.Provider,{value:re,children:(0,we.jsx)(ht.Z,(0,B.Z)((0,B.Z)((0,B.Z)({search:!1,options:!1,pagination:!1,rowKey:Me,revalidateOnFocus:!1},ve),z),{},{tableLayout:"fixed",actionRef:re,onChange:Ie,editable:(0,B.Z)((0,B.Z)({},K),{},{formProps:(0,B.Z)({formRef:W},K.formProps)}),dataSource:ue,onDataSourceChange:function(te){if(Et(te),y.name&&bt==="top"){var ce,fe=(0,pt.Z)({},[y.name].flat(1).filter(Boolean),te);(ce=W.current)===null||ce===void 0||ce.setFieldsValue(fe)}}}))}),y.name?(0,we.jsx)(i.Z,{name:[y.name],children:function(te){var ce,fe;if(!me.current)return me.current=ue,null;var he=(0,nt.Z)(te,[y.name].flat(1)),Te=he==null?void 0:he.find(function(Je,it){var _t;return!(0,be.A)(Je,(_t=me.current)===null||_t===void 0?void 0:_t[it])});return me.current=ue,Te&&(y==null||(ce=y.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,Te,he)),null}}):null]})}function O(y){var E=_.ZP.useFormInstance();return y.name?(0,we.jsx)(je.Z.Item,(0,B.Z)((0,B.Z)({style:{maxWidth:"100%"}},y==null?void 0:y.formItemProps),{},{name:y.name,shouldUpdate:function(De,Ie){var de=[y.name].flat(1);try{return JSON.stringify((0,nt.Z)(De,de))!==JSON.stringify((0,nt.Z)(Ie,de))}catch(Ue){return!0}},children:(0,we.jsx)(le,(0,B.Z)((0,B.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},y),{},{editable:(0,B.Z)((0,B.Z)({},y.editable),{},{form:E})}))})):(0,we.jsx)(le,(0,B.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},y))}O.RecordCreator=F;var ie=O},11312:function(Tt,et,o){o.d(et,{nu:function(){return E},rL:function(){return y},Du:function(){return ie}});var ze=o(9783),m=o.n(ze),Ke=o(97857),Ze=o.n(Ke),ye=o(19632),B=o.n(ye),Oe=o(5574),h=o.n(Oe),v=o(45919),s=o(66419),ee=o(78677),c=o(26271),P=o(78957),i=o(66309),_=o(72051),w=o(71230),ae=o(72269),Z=o(74656),H=o(60943),be=o(67294),ge=o(70804),je=o(80854),Ve=o(62235),nt=o(15009),pt=o.n(nt),ht=o(99289),we=o.n(ht),Ft=o(58638),xt=o(14726),_e=o(76841),F=o(85893),le=function(De){var Ie=De.course_id,de=De.stat,Ue=de===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":de,Ne=(0,be.useState)(!1),Me=h()(Ne,2),Ce=Me[0],Ye=Me[1],Be=(0,be.useCallback)(function(Re){return we()(pt()().mark(function ve(){var me,re;return pt()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return Ye(!0),I.prev=1,I.next=4,(0,_e._g)(Re,{stat:Ue});case 4:me=I.sent,me instanceof Blob&&(re=document.createElement("a"),re.href=window.URL.createObjectURL(me),re.download="finished_topics_".concat(Ie,".xlsx"),document.body.appendChild(re),re.click(),document.body.removeChild(re)),I.next=11;break;case 8:I.prev=8,I.t0=I.catch(1),console.error(I.t0);case 11:return I.prev=11,Ye(!1),I.finish(11);case 14:case"end":return I.stop()}},ve,null,[[1,8,11,14]])}))},[Ue]);return(0,F.jsxs)(xt.ZP,{type:"primary",loading:Ce,onClick:Be(Ie),children:[(0,F.jsx)(Ft.Z,{})," ",(0,F.jsx)(je.FormattedMessage,{id:"export"})]})},O=function(De){return De.topicable.content.contents?Object.values(De.topicable.content.contents)[0].library:"H5P"},ie=function(De){var Ie=De.course_id,de=De.topics,Ue=De.stats,Ne=(0,be.useState)(!1),Me=h()(Ne,2),Ce=Me[0],Ye=Me[1],Be=(0,be.useMemo)(function(){return[{title:(0,F.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(me){return(0,F.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:me})}},{title:(0,F.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(B()(de.map(function(ve){var me,re=(me=ve.topicable_type)===null||me===void 0?void 0:me.split("\\").pop();return re==="H5P"&&(re=O(ve)),{render:function(I){var Ge=0;switch(I&&(I.started_at&&I.finished_at?Ge=1:I.started_at&&(Ge=2)),Ge){case 1:return(0,F.jsxs)(P.Z,{children:[(0,F.jsx)(i.Z,{color:"success",children:"F"}),Ce&&(I==null?void 0:I.seconds)&&(0,F.jsx)("small",{children:(0,s.Im)(I.seconds)})]});case 2:return(0,F.jsxs)(P.Z,{children:[(0,F.jsx)(i.Z,{color:"blue",children:"S"}),Ce&&(I==null?void 0:I.seconds)&&(0,F.jsx)("small",{children:(0,s.Im)(I.seconds)})]});case 0:default:return(0,F.jsx)(be.Fragment,{children:(0,F.jsx)(i.Z,{color:"error",children:"N"})})}},title:(0,F.jsxs)("small",{children:[(0,F.jsx)(i.Z,{children:re})," ",ve.title]}),dataIndex:ve.id}})))},[de,Ce]),Re=(0,be.useMemo)(function(){return Ue.map(function(ve){return de.reduce(function(me,re){var W=ve.topics.find(function(I){return I.id===re.id});return Ze()(Ze()({},me),{},m()({},Number(re.id),W!=null?W:0))},{email:ve.email,id:ve.id})})},[Ue,de]);return(0,F.jsx)(_.Z,{title:function(){return(0,F.jsxs)(w.Z,{justify:"space-between",align:"middle",children:[(0,F.jsxs)(P.Z,{children:[(0,F.jsx)(je.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,F.jsx)(i.Z,{color:"success",children:"F"}),(0,F.jsx)(je.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,F.jsx)(i.Z,{color:"blue",children:"S"}),(0,F.jsx)(je.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,F.jsx)(i.Z,{color:"error",children:"N"}),(0,F.jsx)(je.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,F.jsx)(ae.Z,{checked:Ce,onChange:function(re){return Ye(re)}})]}),(0,F.jsx)(le,{course_id:Ie})]})},columns:Be,dataSource:Re,size:"small",scroll:{x:1500},components:{table:function(me){return(0,F.jsx)(ge.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,F.jsx)("table",Ze()({},me))})}}})},y=function(De){var Ie=De.stats,de=De.attempts,Ue=(0,be.useMemo)(function(){return[{title:(0,F.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(Ce){return(0,F.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:Ce})}},{title:(0,F.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,F.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,F.jsx)(je.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Ce){return Ce?(0,H.WU)(new Date(Ce),v.Cu):""}}]},[]),Ne=(0,be.useMemo)(function(){return Ie.map(function(Me){var Ce=Me.id,Ye=Me.email,Be=Me.finished_at,Re=de==null?void 0:de.find(function(me){return me.id===Ce}),ve=Array.isArray(Re==null?void 0:Re.attempts)?Re==null?void 0:Re.attempts.length:0;return{id:Ce,email:Ye,finished_at:Be,attempt:ve}})},[Ie]);return(0,F.jsx)(_.Z,{title:function(){return(0,F.jsx)(P.Z,{children:(0,F.jsx)(je.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ue,dataSource:Ne,size:"small",scroll:{x:500}})},E=function(De){var Ie=De.stats,de=(0,be.useState)(null),Ue=h()(de,2),Ne=Ue[0],Me=Ue[1],Ce=(0,be.useState)(null),Ye=h()(Ce,2),Be=Ye[0],Re=Ye[1],ve=(0,je.useIntl)(),me=(0,be.useMemo)(function(){return Ie.flatMap(function(W){return Object.values(W.attempts).flatMap(function(I){var Ge=I.dates,ue=I.attempt,Et=Object.values(Ge).flatMap(function(tt){var jt=tt.date,rt=tt.seconds_total;return{date:jt,attempt:ue,seconds_total:rt,email:W.email}});return Et})})},[Ie]),re={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,F.jsx)(c.ZP,{title:(0,F.jsxs)(P.Z,{children:[(0,F.jsx)(je.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,F.jsx)(Z.default,{showSearch:!0,value:Ne,onChange:function(I){Me(I),Re(null)},placeholder:(0,F.jsx)(je.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:Ie.map(function(W){var I=W.id,Ge=W.email;return(0,F.jsx)(Z.default.Option,{value:Ge,children:Ge},I)})}),(0,F.jsx)(Z.default,{value:Be,onChange:function(I){return Re(I)},disabled:Ne===null,placeholder:(0,F.jsx)(je.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:B()(new Set(me.filter(function(W){var I=W.email;return I===Ne}).map(function(W){var I=W.attempt;return I}))).map(function(W){return(0,F.jsxs)(Z.default.Option,{value:W,children:[(0,F.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",W]},W)})})]}),colSpan:12,layout:"center",children:(0,F.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,F.jsx)(ee.Z,Ze()(Ze()({},re),{},{tooltip:{title:"".concat(ve.formatMessage({id:"attempt"})),formatter:function(I){var Ge=Math.floor(+I.seconds_total/60),ue=+I.seconds_total>60?+I.seconds_total-Ge*60:0;return{name:I.attempt,value:"".concat(Ge,"m ").concat(ue,"s")}}},data:me.filter(function(W){var I=W.email;return I===Ne}).filter(function(W){var I=W.attempt;return Number.isInteger(Be)?I===Be:!0})}))})})}},87366:function(Tt,et,o){o.d(et,{Il:function(){return xt},_y:function(){return Z},uS:function(){return ge}});var ze=o(15009),m=o.n(ze),Ke=o(99289),Ze=o.n(Ke),ye=o(5574),B=o.n(ye),Oe=o(97857),h=o.n(Oe),v=o(19632),s=o.n(v),ee=o(2453),c=o(67294),P=o(80854),i=o(99100),_=o(31472),w=o(36309),ae=o(85893),Z=c.createContext({}),H=function(){return Math.round(Math.random()*99999)},be=function _e(F){return F.reduce(function(le,O){return[].concat(s()(le),s()(O.lessons?_e(O.lessons):[]),[O])},[])},ge=function _e(F){return F.reduce(function(le,O){var ie;return[].concat(s()(le),s()(O.lessons?_e(O.lessons):[]),s()((ie=O.topics)!==null&&ie!==void 0?ie:[]))},[])},je=function _e(F,le,O){return F.map(function(ie){var y,E;return h()(h()({},ie),{},{lessons:ie.lessons?_e(ie.lessons,le,O):[],topics:ie.id===le?[].concat(s()((y=ie.topics)!==null&&y!==void 0?y:[]),[O]):(E=ie.topics)!==null&&E!==void 0?E:[]})})},Ve=function _e(F,le,O){return O?F.map(function(ie){return h()(h()({},ie),{},{lessons:[].concat(s()(ie.lessons?_e(ie.lessons,le,O):[]),s()(ie.id===O?[le]:[]))})}):[].concat(s()(F),[le])},nt=function _e(F,le,O){return F.map(function(ie){return h()(h()({},ie.id===le?O:ie),{},{lessons:ie.lessons?_e(ie.lessons,le,O):[]})})},pt=function _e(F,le){return F.map(function(O){return h()(h()({},O),{},{parent_id:le,lessons:O.lessons?_e(O.lessons,O.id):[]})})},ht=function _e(F,le){return F.filter(function(O){return O.id!==le}).map(function(O){return h()(h()({},O),{},{lessons:O.lessons?_e(O.lessons,le):[]})})},we=function _e(F,le){return F.map(function(O){return h()(h()({},O),{},{lessons:O.lessons?_e(O.lessons,le):[],topics:O.topics?O.topics.filter(function(ie){return ie.id!==le}):[]})})},Ft=function _e(F,le,O,ie){return ie==null?void 0:ie.map(function(y){if(y.id===O){var E;return h()(h()({},y),{},{topics:(E=y.topics)===null||E===void 0?void 0:E.map(function(e){return e.id===F?le.file.response.data:e})})}else if(y.lessons)return h()(h()({},y),{},{lessons:_e(F,le,O,y.lessons||[])});return y})},xt=function(F){var le=F.children,O=F.id,ie=(0,c.useState)(),y=B()(ie,2),E=y[0],e=y[1],De=(0,P.useIntl)(),Ie=(0,c.useMemo)(function(){return E&&E.lessons?ge(E.lessons):[]},[E]),de=(0,c.useMemo)(function(){return E&&E.lessons?be(E.lessons):[]},[E]),Ue=(0,c.useState)([]),Ne=B()(Ue,2),Me=Ne[0],Ce=Ne[1],Ye=(0,c.useState)(!1),Be=B()(Ye,2),Re=Be[0],ve=Be[1],me=(0,P.useLocation)(),re=(0,c.useMemo)(function(){var N=new URLSearchParams(me.search);return{lesson:N.get("lesson"),topic:N.get("topic")}},[me]),W=(0,c.useCallback)(Ze()(m()().mark(function N(){var J,V;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,(0,w.XU)({class_type:"EscolaLms\\Courses\\Models\\Lesson"});case 2:J=K.sent,J.success&&(V=J.data.find(function(Q){var k=Q.name;return k==="assistant_id"}),ve(!!(V!=null&&V.id)));case 4:case"end":return K.stop()}},N)})),[]);(0,c.useEffect)(function(){W(),Ce([])},[]);var I=(0,c.useCallback)(function(){(0,i.Nx)(O).then(function(N){return N.success&&e(h()(h()({},N.data),{},{lessons:pt(N.data.lessons)}))})},[O]);(0,c.useEffect)(function(){I()},[I]);var Ge=(0,c.useCallback)(function(N){var J=de.find(function(V){var z;return V==null||(z=V.topics)===null||z===void 0?void 0:z.find(function(K){return K.id===N})});return J?J.id:null},[de]),ue=(0,c.useMemo)(function(){return re.lesson?{mode:"lesson",id:Number(re.lesson),value:de.find(function(N){return N.id===Number(re.lesson)})}:re.topic?{mode:"topic",id:Number(re.topic),value:Ie.find(function(N){return N.id===Number(re.topic)})}:{mode:"init"}},[re,E,de,Ie]),Et=(0,c.useCallback)(function(N){var J={course_id:O,topics:[],isNew:!0,id:E?E.lessons.length+1:H(),order:0,title:De.formatMessage({id:"add_title_here"}),active:!0,parent_id:N};return e(function(V){var z;return h()(h()({},V),{},{lessons:Ve((z=V==null?void 0:V.lessons)!==null&&z!==void 0?z:[],J,N)})}),J},[O,E]),tt=(0,c.useCallback)(function(N,J){var V=de.find(function(K){return K.id===N}),z=V&&V.isNew;return(z?(0,i.aA)(J):(0,i.sI)(N,J)).then(function(K){return ee.ZP.success(K.message),I(),K.success&&e(function(Q){var k;return h()(h()({},Q),{},{lessons:nt((k=Q==null?void 0:Q.lessons)!==null&&k!==void 0?k:[],N,h()(h()({},K.data),{},{isNew:!1}))})})})},[E]),jt=(0,c.useCallback)(function(N){var J=de.find(function(z){return z.id===N});if(J){var V=J.isNew;V?e(function(z){var K;return h()(h()({},z),{},{lessons:ht((K=z==null?void 0:z.lessons)!==null&&K!==void 0?K:[],N)})}):(0,i.iI)(N).then(function(z){z.success&&(ee.ZP.success(z.message),e(function(K){var Q;return h()(h()({},K),{},{lessons:ht((Q=K==null?void 0:K.lessons)!==null&&Q!==void 0?Q:[],N)})}))})}},[E]),rt=(0,c.useCallback)(function(N,J){var V,z=Ge(N),K=de.find(function(te){return te.id===z}),Q=K&&((V=K.topics)===null||V===void 0?void 0:V.find(function(te){return te.id===N})),k=Q==null?void 0:Q.isNew;return(k?(0,i.HV)(J):(0,i.Cn)(N,J)).then(function(te){te.success&&(ee.ZP.success(te.message),I(),P.history.push("/courses/list/".concat(O,"/program/?topic=").concat(te.data.id)),(Q==null?void 0:Q.topicable_type)===_.oz.Video&&setTimeout(function(){I()},5e3))})},[Ge,E,I]),Rt=(0,c.useCallback)(function(N){var J=Ge(N),V=de.find(function(Q){return Q.id===J});if(V){var z=Ie==null?void 0:Ie.find(function(Q){return Q.id===N}),K=z==null?void 0:z.isNew;K&&!z.topicable?e(function(Q){var k;return h()(h()({},Q),{},{lessons:we((k=Q==null?void 0:Q.lessons)!==null&&k!==void 0?k:[],N)})}):(0,i.vJ)(N).then(function(Q){Q.success&&(ee.ZP.success(Q.message),e(function(k){var te;return h()(h()({},k),{},{lessons:we((te=k==null?void 0:k.lessons)!==null&&te!==void 0?te:[],N)})}))})}},[E,Ge]),bt=(0,c.useCallback)(function(N,J){var V={lesson_id:N,isNew:!0,id:H(),title:De.formatMessage({id:"add_title_here"}),active:!0,topicable_type:J};return e(function(z){var K;return h()(h()({},z),{},{lessons:je((K=z==null?void 0:z.lessons)!==null&&K!==void 0?K:[],N,V)})}),V},[]),Pt=function(J,V){var z=Ge(J);e(function(K){return h()(h()({},K),{},{lessons:K?Ft(J,V,z,K.lessons||[]):[]})}),P.history.push("/courses/list/".concat(O,"/program/?topic=").concat(V.file.response.data.id))},Zt=(0,c.useCallback)(function(N){return(0,i.Cx)(N).then(function(J){if(J.success){ee.ZP.success(J.message);var V=Ge(N);e(function(z){var K;return h()(h()({},z),{},{lessons:z?(K=z.lessons)===null||K===void 0?void 0:K.map(function(Q){if(Q.id===V){var k=Q.topics||[];return h()(h()({},Q),{},{topics:[].concat(s()(k),[J.data])})}return Q}):[]})})}})},[E,Ge]),Gt=(0,c.useCallback)(function(N){return(0,i.if)(N).then(function(J){J.success&&(ee.ZP.success(J.message),e(function(V){return h()(h()({},V),{},{lessons:V?[].concat(s()(V.lessons),[J.data]):[]})}))})},[]),wt={state:E,h5ps:Me,id:O,addNewLesson:Et,updateLesson:tt,updateTopic:rt,deleteLesson:jt,addNewTopic:bt,deleteTopic:Rt,onTopicUploaded:Pt,cloneTopic:Zt,cloneLesson:Gt,currentEditMode:ue,getLessons:I,isAssistant:Re};return(0,ae.jsx)(Z.Provider,{value:wt,children:le})}},93321:function(Tt,et,o){o.r(et),o.d(et,{default:function(){return Hn}});var ze=o(97857),m=o.n(ze),Ke=o(91115),Ze=o(26114),ye=o(26271),B=o(74453),Oe=o(74330),h=o(14726),v=o(67294),s=o(80854),ee=o(15009),c=o.n(ee),P=o(99289),i=o.n(P),_=o(19632),w=o.n(_),ae=o(5574),Z=o.n(ae),H=o(16894),be=o(28248),ge=o(83062),je=o(2453),Ve=o(96746),nt=o(78957),pt=o(2487),ht=o(55102),we=o(75842);function Ft(u,a){return xt.apply(this,arguments)}function xt(){return xt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"GET",params:a},t||{})));case 1:case"end":return r.stop()}},u)})),xt.apply(this,arguments)}function _e(u,a){return F.apply(this,arguments)}function F(){return F=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),F.apply(this,arguments)}function le(u,a,t){return O.apply(this,arguments)}function O(){return O=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(a),m()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},u)})),O.apply(this,arguments)}function ie(u,a,t){return y.apply(this,arguments)}function y(){return y=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(a),m()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},u)})),y.apply(this,arguments)}var E=o(31472),e=o(85893),De=function(a){var t=a.visible,n=a.onClose,r=a.user,l=Ve.Z.Text,d=r.name,f=r.groupId,p=r.userId,x=(0,v.useState)(""),b=Z()(x,2),S=b[0],T=b[1],g=(0,v.useState)(!1),j=Z()(g,2),M=j[0],C=j[1],Y=(0,v.useState)([]),D=Z()(Y,2),A=D[0],U=D[1],se=(0,v.useState)(null),oe=Z()(se,2),$=oe[0],R=oe[1],G=(0,v.useState)({current_page:1,per_page:5,last_page:1,total:0}),L=Z()(G,2),q=L[0],Fe=L[1],Ae=function(){var Le=i()(c()().mark(function ne(pe){var X;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,Ft({bookmarkable_id:f,bookmarkable_type:E.h5.Group,user_id:p,page:pe,per_page:q.per_page});case 2:X=xe.sent,X.success&&(U(X.data),Fe(X.meta));case 4:case"end":return xe.stop()}},ne)}));return function(pe){return Le.apply(this,arguments)}}(),Xe=function(){var Le=i()(c()().mark(function ne(){var pe;return c()().wrap(function(Qe){for(;;)switch(Qe.prev=Qe.next){case 0:return Qe.next=2,_e({value:S,bookmarkable_id:f,bookmarkable_type:E.h5.Group,user_id:p});case 2:pe=Qe.sent,pe.success&&(Ae(),C(!1),T(""));case 4:case"end":return Qe.stop()}},ne)}));return function(){return Le.apply(this,arguments)}}(),ut=function(){var Le=i()(c()().mark(function ne(pe){var X;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,ie(pe);case 2:X=xe.sent,X.success&&Ae();case 4:case"end":return xe.stop()}},ne)}));return function(pe){return Le.apply(this,arguments)}}(),ke=function(){var Le=i()(c()().mark(function ne(pe){var X;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,le(pe,{value:($==null?void 0:$.currentText)||"",bookmarkable_id:f,bookmarkable_type:E.h5.Group,user_id:p});case 2:X=xe.sent,X.success&&(Ae(),R(null));case 4:case"end":return xe.stop()}},ne)}));return function(pe){return Le.apply(this,arguments)}}();return(0,v.useEffect)(function(){Ae()},[]),(0,e.jsxs)(be.Z,{title:(0,e.jsxs)(nt.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(d,")")})]}),open:t,onCancel:n,footer:[(0,e.jsx)(h.ZP,{onClick:n,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(pt.Z,{dataSource:A,pagination:{onChange:function(ne){return Ae(ne)},pageSize:q.per_page,total:q.total,current:q.current_page},renderItem:function(ne){return(0,e.jsx)(pt.Z.Item,{actions:[(0,e.jsx)(h.ZP,{danger:!0,onClick:function(){return ut(ne.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},ne.id),($==null?void 0:$.currentNoteId)===ne.id?(0,e.jsxs)(nt.Z,{children:[(0,e.jsx)(h.ZP,{onClick:function(){return ke(ne.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(h.ZP,{onClick:function(){return R(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(h.ZP,{onClick:function(){return R({currentNoteId:ne.id,currentText:ne.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},ne.id)],children:($==null?void 0:$.currentNoteId)===ne.id&&($==null?void 0:$.currentText)!==null?(0,e.jsx)(ht.Z.TextArea,{value:$==null?void 0:$.currentText,onChange:function(X){return R(function(Qe){return m()(m()({},Qe),{},{currentText:X.target.value})})}}):ne.value})}}),M?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(we.Z,{layout:"vertical",children:(0,e.jsx)(we.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(ht.Z.TextArea,{value:S,onChange:function(ne){return T(ne.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(nt.Z,{children:[(0,e.jsx)(h.ZP,{type:"primary",onClick:Xe,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return C(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return C(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},Ie=De,de=o(54464);function Ue(u,a){return Ne.apply(this,arguments)}function Ne(){return Ne=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),Ne.apply(this,arguments)}function Me(u,a,t,n){return Ce.apply(this,arguments)}function Ce(){return Ce=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(a,"/attendances"),m()({data:{attendances:[{user_id:t,value:n}]},method:"POST"},r||{})));case 1:case"end":return d.stop()}},u)})),Ce.apply(this,arguments)}function Ye(u,a){return Be.apply(this,arguments)}function Be(){return Be=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),Be.apply(this,arguments)}function Re(u,a){return ve.apply(this,arguments)}function ve(){return ve=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"GET",useCache:!1,params:a},t||{})));case 1:case"end":return r.stop()}},u)})),ve.apply(this,arguments)}function me(u,a){return re.apply(this,arguments)}function re(){return re=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),re.apply(this,arguments)}function W(u,a,t){return I.apply(this,arguments)}function I(){return I=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"PUT",data:t,useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),I.apply(this,arguments)}function Ge(u,a){return ue.apply(this,arguments)}function ue(){return ue=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),ue.apply(this,arguments)}function Et(u,a){return tt.apply(this,arguments)}function tt(){return tt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),tt.apply(this,arguments)}function jt(u,a,t,n){return rt.apply(this,arguments)}function rt(){return rt=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a,"/users/").concat(t),m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},r||{})));case 1:case"end":return d.stop()}},u)})),rt.apply(this,arguments)}function Rt(u,a,t){return bt.apply(this,arguments)}function bt(){return bt=_asyncToGenerator(_regeneratorRuntime().mark(function u(a,t,n){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(a,"/users/").concat(t),_objectSpread({method:"DELETE"},n||{})));case 1:case"end":return l.stop()}},u)})),bt.apply(this,arguments)}function Pt(u,a,t){return Zt.apply(this,arguments)}function Zt(){return Zt=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(a,"/tutors/").concat(t,"/grades"),m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),Zt.apply(this,arguments)}function Gt(u,a,t,n){return wt.apply(this,arguments)}function wt(){return wt=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(a,"/tutors/").concat(t,"/grades"),m()({method:"POST",data:n},r||{})));case 1:case"end":return d.stop()}},u)})),wt.apply(this,arguments)}function N(u,a){return J.apply(this,arguments)}function J(){return J=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",m()({method:"GET",params:{groups:a},useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),J.apply(this,arguments)}function V(u,a,t){return z.apply(this,arguments)}function z(){return z=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(a,"/users/").concat(t),m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),z.apply(this,arguments)}function K(u){return Q.apply(this,arguments)}function Q(){return Q=i()(c()().mark(function u(a){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,s.request)("/api/admin/grade-terms",m()({method:"GET",useCache:!1},a||{})));case 1:case"end":return n.stop()}},u)})),Q.apply(this,arguments)}function k(u,a){return te.apply(this,arguments)}function te(){return te=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),te.apply(this,arguments)}function ce(u,a){return fe.apply(this,arguments)}function fe(){return fe=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/final-grades",m()({method:"POST",data:a},t||{})));case 1:case"end":return r.stop()}},u)})),fe.apply(this,arguments)}function he(u,a,t){return Te.apply(this,arguments)}function Te(){return Te=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(a),m()({method:"PATCH",data:t},n||{})));case 1:case"end":return l.stop()}},u)})),Te.apply(this,arguments)}function Je(u,a){return it.apply(this,arguments)}function it(){return it=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),it.apply(this,arguments)}var _t=o(95213),Dt=o(47389),at=o(7092),va=o(13769),$t=o.n(va),pa=["results"],Jt=function(a,t){return a.reduce(function(n,r){var l=r.results,d=$t()(r,pa),f=l.find(function(p){return p.user_id===t});return f?[].concat(w()(n),[m()(m()({},d),{},{result:f})]):n},[])},Qt=function(a,t){var n,r=a.reduce(function(g,j){var M=j.result,C=j.weight;return C&&typeof M.result=="number"?[g[0]+M.result*C,g[1]+C]:g},[0,0]),l=Z()(r,2),d=l[0],f=l[1],p=Number.isNaN(d/f)?0:d/f,x=t.sort(function(g,j){return g.grade_value-j.grade_value}).reduce(function(g,j){return[].concat(w()(g),[m()(m()({},j),{},{isWeightedAverageGreater:p>=j.grade_value})])},[]);if(x.every(function(g){var j=g.isWeightedAverageGreater;return j})){var b,S;return(b=(S=x.at(-1))===null||S===void 0?void 0:S.name)!==null&&b!==void 0?b:""}var T=x.findIndex(function(g){var j=g.isWeightedAverageGreater;return!j});return T<0?"":(n=x[T-1])===null||n===void 0?void 0:n.name},qt=function(a,t){var n;return(n=t.find(function(r){return r.s_subject_scale_form_id===a}))===null||n===void 0?void 0:n.scale},ct=o(73199),ga=o(9783),st=o.n(ga),ea=o(84567);function ha(u){var a,t=u===null?E.cX.ABSENT:u,n=st()(st()(st()(st()({},E.cX.PRESENT,{ch1:!0,ch2:!1}),E.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),E.cX.ABSENT,{ch1:!1,ch2:!1}),E.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(a=n[t])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function xa(u){var a,t=u.ch1,n=u.ch2,r="".concat(t,"_").concat(n),l={true_false:E.cX.PRESENT,true_true:E.cX.PRESENT_NOT_EXERCISING,false_false:E.cX.ABSENT,false_true:E.cX.EXCUSED_ABSENCE};return(a=l[r])!==null&&a!==void 0?a:E.cX.ABSENT}var ja=function(a){var t=a.groupAttendanceScheduleId,n=a.studentId,r=a.attendance,l=a.onSuccess,d=(0,v.useState)(ha(r)),f=Z()(d,2),p=f[0],x=f[1],b=(0,v.useState)(!1),S=Z()(b,2),T=S[0],g=S[1],j=(0,v.useRef)(!0),M=(0,v.useCallback)(function(D){g(!0),Me(t,n,xa(D)).then(function(A){A.success&&(l==null||l())}).finally(function(){return g(!1)})},[]),C=(0,v.useCallback)(function(D){return x(D.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),Y=(0,v.useCallback)(function(D){return x(function(A){return m()(m()({},A),{},{ch2:D.target.checked})})},[]);return(0,v.useEffect)(function(){if(j.current){j.current=!1;return}M(p)},[p,M]),(0,e.jsxs)(nt.Z,{children:[(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(ea.Z,{disabled:T,checked:p.ch1,onChange:C})}),(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:p.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(ea.Z,{disabled:T,checked:p.ch2,onChange:Y})})]})},ta=ja,mt=o(45919),Ut=o(82061),St=o(60943),It=o(74656),aa=o(37804),ba=o(96486),Sa=function(a){var t=a.exam_id,n=a.result,r=a.student_id,l=a.type,d=a.onSuccess,f=(0,s.useIntl)(),p=(0,v.useCallback)((0,ba.debounce)(function(b){jt(t,r,{result:b}).then(function(S){S.success&&(d==null||d(S.data))})},300),[t,n,r]),x=function(){switch(l){case E.UL.ManualPass:return(0,e.jsx)(It.default,{allowClear:!0,style:{width:"100%"},onChange:p,options:ct.FW,defaultValue:n!=null?n:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});case E.UL.ManualGrades:return(0,e.jsx)(It.default,{allowClear:!0,style:{width:"100%"},onChange:p,options:ct.BP,defaultValue:n!=null?n:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});default:return(0,e.jsx)(aa.Z,{type:"number",min:0,max:100,onChange:p,defaultValue:n!=null?n:void 0,placeholder:f.formatMessage({id:"select_grade"})})}};return x()},ya=function(a,t){var n;return(n=a.find(function(r){return r.name===t}))===null||n===void 0?void 0:n.id},_a=function(a){var t=a.term,n=a.gradeScales,r=a.defaultFinalGrade,l=a.finalGrades,d=(0,v.useState)(r),f=Z()(d,2),p=f[0],x=f[1],b=(0,v.useState)(!1),S=Z()(b,2),T=S[0],g=S[1],j=(0,v.useState)(!1),M=Z()(j,2),C=M[0],Y=M[1],D=(0,s.useIntl)(),A=(0,v.useMemo)(function(){return n.map(function(oe){var $=oe.name,R=oe.id;return{value:R,label:$}})},[n]),U=function($){Y(!0),je.ZP.error(D.formatMessage({id:$.data.message}))},se=(0,v.useCallback)(function(oe){if(l!=null&&l.id){if(oe===void 0){if(!p)return;g(!0),Je(p.id).then(function($){$.success&&x(void 0)}).finally(function(){return g(!1)});return}if(p){g(!0),he(p.id,{grade_scale_id:oe}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&U($)}).finally(function(){return g(!1)});return}g(!0),ce({grade_term_id:t.id,grade_scale_id:oe,lesson_group_user_id:l.id}).then(function($){if($.success){var R=$.data.grades.find(function(G){return G.grade_term.id===t.id});x(R),C&&Y(!1)}}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&U($)}).finally(function(){return g(!1)})}},[p,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(It.default,{allowClear:!0,status:C?"error":"",loading:T,disabled:T,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:se,options:A,defaultValue:ya(n,r==null?void 0:r.grade_name)}):null},Ma=function(a){var t=a.groupAttendanceSchedule,n=a.handleDeleteColumn,r=a.scheduleDeletePermission,l=r===void 0?!1:r,d=t.reduce(function(f,p){return[].concat(w()(f),[{title:(0,e.jsxs)(nt.Z,{children:[(0,St.WU)(new Date(p.date_from),mt.GC),l&&p.is_outdated&&(0,e.jsx)(Ut.Z,{onClick:function(b){b.stopPropagation(),n(p.id,(0,St.WU)(new Date(p.date_from),mt.GC))}})]}),dataIndex:"attendance-".concat(p.id),hideInSearch:!0,width:100,align:"center",render:function(b,S){return(0,e.jsx)(ta,{groupAttendanceScheduleId:p.id,attendance:S["attendance-".concat(p==null?void 0:p.id)],studentId:S.id})}}])},[]);return d.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:d}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Ca=function(a,t){return a.reduce(function(n,r){var l=r.attendances.find(function(d){return d.user_id===t});return l?m()(m()({},n),{},st()({},"attendance-".concat(r.id),l.value)):n},{})},Ta=function(a){var t=a.reduce(function(n,r){return[].concat(w()(n),[{dataIndex:"exam-".concat(r.id),title:r.type===E.UL.Manual?(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:r}):(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithoutWeight",values:r}),hideInSearch:!0,width:100,render:function(d,f){var p;return(0,e.jsx)(Sa,{type:r.type,result:f==null||(p=f["exam-".concat(r.id)])===null||p===void 0?void 0:p.result,exam_id:r.id,student_id:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},Fa=function(a){return a.reduce(function(t,n){var r=n.result,l=n.id;return m()(m()({},t),{},st()({},"exam-".concat(l),r))},{})},Ea=function(a,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:a.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(l,d){var f;return(0,e.jsx)(_a,{defaultFinalGrade:d["final-grade-".concat(n.id)],finalGrades:d.final_grades,term:n,gradeScales:t},"".concat(d==null||(f=d.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(n.id))}}})}},Pa=function(a,t){return a.find(function(n){return n.user.id===t})},Za=function(a){var t;return((t=a==null?void 0:a.grades)!==null&&t!==void 0?t:[]).reduce(function(n,r){return m()(m()({},n),{},st()({},"final-grade-".concat(r.grade_term.id),r))},{})},wa=function(){var a,t=(0,at.Z)(),n=t.teacherSubjectData,r=t.semester_subject_id,l=(0,v.useState)([]),d=Z()(l,2),f=d[0],p=d[1],x=(0,v.useState)(n==null||(a=n.groups)===null||a===void 0||(a=a[0])===null||a===void 0?void 0:a.name),b=Z()(x,2),S=b[0],T=b[1],g=(0,v.useState)(null),j=Z()(g,2),M=j[0],C=j[1],Y=(0,s.useIntl)(),D=(0,v.useRef)(),A=(0,de.T)(),U=A.checkPermission,se=function(L,q){be.Z.confirm({title:Y.formatMessage({id:"scheduleDeleteConfirm"},{columnId:L}),okText:Y.formatMessage({id:"delete"}),cancelText:Y.formatMessage({id:"cancel"}),onOk:q})},oe=function(L,q){se(q,function(){var Fe;Ye(L),(Fe=D.current)===null||Fe===void 0||Fe.reload()})},$=(0,v.useMemo)(function(){var G;return((G=n==null?void 0:n.groups)!==null&&G!==void 0?G:[]).map(function(L){var q=L.id,Fe=L.name;return{value:q,label:Fe}})},[n==null?void 0:n.groups]),R=(0,v.useMemo)(function(){var G;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:$,defaultValue:$==null||(G=$[0])===null||G===void 0?void 0:G.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(w()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(q,Fe){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{}),onClick:function(){return C({userName:Fe.full_name,userId:Fe.id,groupId:Fe.final_grades.group_id})}})})})}}])},[$,f]);return(0,e.jsxs)(e.Fragment,{children:[(M==null?void 0:M.userId)&&(0,e.jsx)(Ie,{visible:!!M.userId,onClose:function(){return C(null)},user:{name:M.userName,userId:M.userId,groupId:M.groupId}}),(0,e.jsx)(H.ZP,{sticky:!0,className:"table-standalone",request:function(){var G=i()(c()().mark(function L(q){var Fe,Ae,Xe,ut,ke,Le,ne,pe,X,Qe,xe,Ee,Pe,Se,We,qe,vt,ot,dt,yt,Mt;return c()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return ut=q.group_id,ke=ut===void 0?(Fe=$[0])===null||Fe===void 0?void 0:Fe.value:ut,Le=q.full_name,ne=Le===void 0?"":Le,$e.next=3,N([ke]);case 3:if(pe=$e.sent,X=$.find(function(Ct){var gt=Ct.value;return gt===ke}),!(!pe.success||pe.data[0]===void 0||r===null)){$e.next=8;break}return je.ZP.error(Y.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 8:return $e.next=10,Promise.all([(0,_t.X)(ke),Ue(ke),Re({group_id:ke,per_page:-1}),Pt(r,(Ae=pe.data)===null||Ae===void 0||(Ae=Ae[0])===null||Ae===void 0?void 0:Ae.tutor_id),K(),k((Xe=pe.data)===null||Xe===void 0||(Xe=Xe[0])===null||Xe===void 0?void 0:Xe.s_subject_scale_form_id)]);case 10:if(Qe=$e.sent,xe=Z()(Qe,6),Ee=xe[0],Pe=xe[1],Se=xe[2],We=xe[3],qe=xe[4],vt=xe[5],!(!Ee.success||!Pe.success||!Se.success||!We.success||!qe.success||!vt.success||!X)){$e.next=21;break}return je.ZP.error(Y.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 21:return T(X.label),ot=Ma({groupAttendanceSchedule:Pe.data,handleDeleteColumn:oe,scheduleDeletePermission:U(Ke.Z.PCGSchedulesDelete)||U(Ke.Z.PCGSchedulesDeleteOwn)}),dt=Ta(Se.data),yt=Ea(qe.data,vt.data),p([ot,dt,yt,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Mt=Ee.data.users.reduce(function(Ct,gt){var Xt,Ht,Yt,At=gt.id,Jn=gt.academic_teacher_id,Qn=gt.first_name,qn=gt.last_name,ma="".concat(qn," ").concat(Qn),er=pe.data.some(function(ir){return ir.user.id===At});if(Jn!==null&&!er||!ma.toLowerCase().includes(ne.toLowerCase()))return Ct;var tr=Ca(Pe.data,At),fa=Jt(Se.data,At),Lt=Pa(pe.data,At),ar=(Xt=qt((Ht=Lt==null?void 0:Lt.s_subject_scale_form_id)!==null&&Ht!==void 0?Ht:0,(Yt=We.data.grade_scale)!==null&&Yt!==void 0?Yt:[]))!==null&&Xt!==void 0?Xt:[],nr=Qt(fa,ar),rr=Fa(fa),sr=Za(Lt);return[].concat(w()(Ct),[m()(m()(m()(m()({id:At,full_name:ma},tr),rr),sr),{},{proposed_grade:nr,final_grades:Lt})])},[]).sort(function(Ct,gt){return Ct.full_name.localeCompare(gt.full_name)}),$e.abrupt("return",{data:Mt,total:Mt.length,success:!0});case 28:case"end":return $e.stop()}},L)}));return function(L){return G.apply(this,arguments)}}(),columns:R,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:S}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:D,pagination:{defaultPageSize:ct.Sl,onChange:function(){var L;return(L=D.current)===null||L===void 0?void 0:L.reload()}},rowKey:"id"})]})},na=o(1413),Da={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ia=Da,Ga=o(84089),Aa=function(a,t){return v.createElement(Ga.Z,(0,na.Z)((0,na.Z)({},a),{},{ref:t,icon:Ia}))},La=v.forwardRef(Aa),Ra=La,ra=o(86738),Ot=o(62235),lt=o(952),$a=o(5966),Oa=o(50335),sa=o(71230),ft=o(15746),Na=o(29477),ka=o(56717),ia=o(95830),ua=function(a){return a===E.UL.Manual||a===E.UL.ManualPass||a===E.UL.ManualGrades},Ua=function(a){var t=a.type,n=a.onDataConverted,r=a.groupSelectDisabled,l=(0,at.Z)(),d=l.semester_subject_id,f=l.teacherSubjectData,p=(0,v.useState)(null),x=Z()(p,2),b=x[0],S=x[1],T=(0,v.useMemo)(function(){var M;return((M=f==null?void 0:f.groups)!==null&&M!==void 0?M:[]).map(function(C){var Y=C.id,D=C.name;return{label:D,value:Y}})},[]),g={type:t,group_id:b,semester_subject_id:d},j=(0,v.useCallback)(function(M){if(M.success){var C=M.data.results.filter(function(Y){var D=Y.user_id;return D!==null});if(!C.length)return;n({exam_results:C,group_id:M.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(lt.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(It.default,{disabled:r,value:b,onChange:function(C){return S(C)},options:T,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Na.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:j,onChange:function(C){return!C.fileList.length&&n(void 0)},maxFiles:1,data:g,disabled:!b})]})},Ba=function(a){var t=a.onDataConverted,n=(0,at.Z)(),r=n.teacherSubjectData,l=n.groupUsers,d=(0,v.useState)(null),f=Z()(d,2),p=f[0],x=f[1],b=(0,v.useMemo)(function(){var T;return((T=r==null?void 0:r.groups)!==null&&T!==void 0?T:[]).map(function(g){var j=g.id,M=g.name;return{label:M,value:j}})},[]),S=(0,v.useCallback)(function(){var T=i()(c()().mark(function g(j){var M,C,Y,D;return c()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(x(j),C=(M=l.byId)===null||M===void 0?void 0:M[j],C){U.next=4;break}return U.abrupt("return");case 4:return U.prev=4,U.next=7,N([j]);case 7:if(Y=U.sent,Y.success){U.next=10;break}return U.abrupt("return");case 10:D=C.users.reduce(function(se,oe){var $=oe.id,R=oe.email,G=oe.first_name,L=oe.last_name,q=oe.academic_teacher_id,Fe=Y.data.some(function(Ae){return Ae.user.id===$});return q!==null&&!Fe?se:[].concat(w()(se),[{email:R,first_name:G,last_name:L,user_id:$,result:null}])},[]),t({group_id:j,exam_results:D}),U.next=17;break;case 14:U.prev=14,U.t0=U.catch(4),console.error("Error fetching final grades:",U.t0);case 17:case"end":return U.stop()}},g,null,[[4,14]])}));return function(g){return T.apply(this,arguments)}}(),[l.byId]);return(0,e.jsx)(It.default,{value:p,onChange:S,options:b,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Nt=st()(st()(st()(st()(st()(st()({},E.UL.TestPortal,["/teacher-examples/testPortal.png"]),E.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),E.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),E.UL.Manual,[]),E.UL.ManualPass,[]),E.UL.ManualGrades,[]),Wa=function(a){var t=a.images,n=(0,v.useState)(!1),r=Z()(n,2),l=r[0],d=r[1],f=(0,v.useCallback)(function(){return d(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(h.ZP,{onClick:f,icon:(0,e.jsx)(ka.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:d},children:t.map(function(p){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:p},p)})})]})},Ka=function(a){var t,n=a.type,r=a.onOk,l=a.onCancel,d=a.okDisabled,f=(t=Nt==null?void 0:Nt[n])!==null&&t!==void 0?t:Nt[E.UL.Manual];return(0,e.jsxs)(nt.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)(Wa,{images:f}),(0,e.jsxs)(nt.Z,{children:[(0,e.jsx)(h.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(h.ZP,{type:"primary",disabled:d,onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Va=[E.UL.TeamsLecture,E.UL.TestPortal,E.UL.TeamsForms],za=function(a){var t=a.open,n=a.closeModal,r=a.onSuccess,l=a.type,d=(0,at.Z)(),f=d.teacherSubjectData,p=d.fetchGroupUsers,x=(0,v.useState)(),b=Z()(x,2),S=b[0],T=b[1];return(0,v.useEffect)(function(){if(ua(l)&&t){var g;f==null||(g=f.groups)===null||g===void 0||g.forEach(function(j){var M=j.id;return p(M)})}},[l,t]),(0,e.jsxs)(be.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:n,footer:(0,e.jsx)(Ka,{type:l,onOk:function(){S&&r(S)},onCancel:n,okDisabled:!S}),children:[Va.includes(l)&&(0,e.jsx)(Ua,{type:l,onDataConverted:T,groupSelectDisabled:!!S}),ua(l)&&(0,e.jsx)(Ba,{onDataConverted:T,examType:l})]})},Xa=function(a){var t=a.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.ManualPass)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyPass",defaultMessage:"uploadGradesManuallyPass"})})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){return t(E.UL.ManualGrades)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyGrades",defaultMessage:"uploadGradesManuallyGrades"})})})]})},Ha=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1}],Ya=function(a){var t,n=a.exam_id,r=lt.ZP.useForm(),l=Z()(r,1),d=l[0],f=(0,v.useState)(),p=Z()(f,2),x=p[0],b=p[1],S=(0,v.useState)(),T=Z()(S,2),g=T[0],j=T[1],M=(0,v.useState)(!1),C=Z()(M,2),Y=C[0],D=C[1],A=(0,at.Z)(),U=A.semester_subject_id,se=A.getGroupById,oe=(0,v.useMemo)(function(){var R;return((R=g==null?void 0:g.exam_results)!==null&&R!==void 0?R:[]).map(function(G){var L=G.user_id;return L})},[g==null?void 0:g.exam_results]);(0,v.useEffect)(function(){var R=Number(n);n==="new"&&(b(void 0),j(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(R)&&(D(!0),Ge(R).then(function(G){if(G.success){var L=G.data,q=L.type,Fe=L.results,Ae=L.title,Xe=L.weight,ut=L.passed_at,ke=L.group_id;b(q),j({group_id:ke,exam_results:Fe}),d.setFieldsValue({title:Ae,weight:Xe,passed_at:ut})}}).finally(function(){return D(!1)}))},[n]);var $=(0,v.useCallback)(function(){b(void 0),j(void 0)},[]);return Y?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[x&&(0,e.jsx)(za,{open:!!(x&&!g),type:x,closeModal:$,onSuccess:j}),(0,e.jsxs)(lt.ZP,{form:d,submitter:x===void 0||!g?!1:void 0,onFinish:function(){var R=i()(c()().mark(function G(L){var q,Fe,Ae,Xe,ut,ke,Le,ne;return c()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(g&&typeof U=="number")){X.next=16;break}if(q=L.title,Fe=L.passed_at,Ae=L.weight,Xe=Number(n),ut=g.exam_results,ke=g.group_id,Le={type:x,semester_subject_id:U,title:q,passed_at:Fe,weight:Ae,group_id:ke,results:ut},!Number.isNaN(Xe)){X.next=11;break}return X.next=8,me(Le);case 8:X.t0=X.sent,X.next=14;break;case 11:return X.next=13,W(Xe,Le);case 13:X.t0=X.sent;case 14:ne=X.t0,ne.success&&s.history.push("/teacher/subjects/".concat(U,"/exams"));case 16:return X.abrupt("return",!0);case 17:case"end":return X.stop()}},G)}));return function(G){return R.apply(this,arguments)}}(),onReset:$,children:[(0,e.jsxs)(lt.ZP.Group,{children:[(0,e.jsx)($a.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(Oa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),x!==E.UL.ManualGrades&&x!==E.UL.ManualPass&&(0,e.jsx)(lt.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(aa.Z,{})})]}),x&&g&&(0,e.jsx)(H.ZP,{rowKey:"user_id",headerTitle:(t=se(g.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:oe,onValuesChange:function(G,L){return j({group_id:g.group_id,exam_results:L})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:g.exam_results.sort(function(R,G){return R.last_name.localeCompare(G.last_name)}),pagination:{defaultPageSize:ct.Sl},columns:[].concat(Ha,[function(){switch(x){case E.UL.ManualPass:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:ct.FW}};case E.UL.ManualGrades:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:ct.BP}};default:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}}}()])}),!g&&(0,e.jsx)(Xa,{onSelect:b})]})]})},Ja=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Qa=function(a){var t=a.exam_id,n=(0,v.useState)(""),r=Z()(n,2),l=r[0],d=r[1];return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:ct.Sl},request:i()(c()().mark(function f(){var p;return c()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,Ge(t);case 2:if(p=b.sent,!p.success){b.next=6;break}return d(p.data.title),b.abrupt("return",{total:p.data.results.length,success:!0,data:p.data.results});case 6:return b.abrupt("return",[]);case 7:case"end":return b.stop()}},f)})),columns:Ja})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(a,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(a,t){return t.passed_at&&(0,St.WU)(new Date(t.passed_at),mt.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(a,t){return t.weight?t.weight+"%":""}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(a,t){return t.created_at&&(0,St.WU)(new Date(t.created_at),mt.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(a,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(a,t){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],en=function(){var a,t=(0,v.useRef)(),n=(0,at.Z)(),r=n.semester_subject_id,l=(0,s.useLocation)(),d=new URLSearchParams(l.search),f=(a=d.get("exam_id"))!==null&&a!==void 0?a:null,p=d.get("results");return p!==null&&!Number.isNaN(Number(p))?(0,e.jsx)(Qa,{exam_id:Number(p)}):f!==null?(0,e.jsx)(Ya,{exam_id:f}):(0,e.jsx)(H.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:ct.Sl},request:function(){var x=i()(c()().mark(function b(S,T){var g,j,M,C;return c()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(g=S.current,j=S.pageSize,r!==null){D.next=3;break}return D.abrupt("return",{data:[],total:0,success:!1});case 3:return M=T&&Object.entries(T)[0],D.next=6,Re({per_page:j,page:g,semester_subject_id:Number.isNaN(r)?void 0:r,order_by:M&&M[0],order:M&&(M[1]==="ascend"?"ASC":"DESC")});case 6:if(C=D.sent,!C.success){D.next=9;break}return D.abrupt("return",{data:C.data,total:C.meta.total,success:!0});case 9:return D.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return D.stop()}},b)}));return function(b,S){return x.apply(this,arguments)}}(),columns:[].concat(qa,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(b,S){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?exam_id=").concat(S.id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S.semester_subject_id,"/exams?results=").concat(S.id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(h.ZP,{icon:(0,e.jsx)(Ra,{})})})},"results"),(0,e.jsx)(ra.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:i()(c()().mark(function T(){var g;return c()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Et(S.id);case 2:g=M.sent,g.success&&t.current&&t.current.reload();case 4:case"end":return M.stop()}},T)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Ut.Z,{}),danger:!0})})},"delete")]}}])})},tn=o(69753),oa=o(44167),an=o(84665),nn=["type","defaultRender"],rn=["type","defaultRender"],sn=function(a){var t=a.url;return(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(tn.Z,{})})})},un=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(a,t){return(0,St.WU)(new Date(t.created_at),mt.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(a,t,n){var r=t.type,l=t.defaultRender,d=$t()(t,nn);if(r==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},d),{},{state:{type:f}}))},render:function(a,t){var n,r;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(n=t.created_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(r=t.created_by)!==null&&r!==void 0&&r.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(a,t){return(0,St.WU)(new Date(t.exported_at),mt.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(a,t,n){var r=t.type,l=t.defaultRender,d=$t()(t,rn);if(r==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},d),{},{state:{type:f}}))},render:function(a,t){var n,r;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(n=t.exported_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(r=t.exported_by)!==null&&r!==void 0&&r.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(a,t){return[(0,e.jsx)(sn,{url:t.url},"download")]}}],on=function(){var a,t=(0,at.Z)(),n=t.teacherSubjectData,r=(0,v.useMemo)(function(){var d;return((d=n==null?void 0:n.groups)!==null&&d!==void 0?d:[]).map(function(f){var p=f.id,x=f.name;return{value:p,label:x}})},[n==null?void 0:n.groups]),l=(0,v.useMemo)(function(){var d;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:r,defaultValue:n==null||(d=n.groups)===null||d===void 0||(d=d[0])===null||d===void 0?void 0:d.id,allowClear:!1}}].concat(un)},[n==null||(a=n.groups)===null||a===void 0||(a=a[0])===null||a===void 0?void 0:a.id,r]);return(0,e.jsx)(H.ZP,{className:"table-standalone",request:function(){var d=i()(c()().mark(function f(p){var x,b,S,T,g,j;return c()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return b=p.group_id,S=b===void 0?n==null||(x=n.groups)===null||x===void 0||(x=x[0])===null||x===void 0?void 0:x.id:b,T=p.created_by,g=p.exported_by,C.next=3,(0,an.v)({group_id:S,created_by:T,exported_by:g});case 3:if(j=C.sent,j.success){C.next=6;break}return C.abrupt("return",{success:!1,data:[],total:0});case 6:return C.abrupt("return",{success:!0,data:j.data,total:j.data.length});case 7:case"end":return C.stop()}},f)}));return function(f){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:ct.Sl}})},la=o(64317),Bt=o(96074),da=o(11312),ln=o(87366),Wt=o(99100),dn=["attendances"];function cn(u){return function(t){u(function(n){return m()(m()({},n),{},{loading:t})})}}function ca(u,a){return Kt.apply(this,arguments)}function Kt(){return Kt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a(!0),r.prev=1,r.abrupt("return",t());case 3:return r.prev=3,a(!1),r.finish(3);case 6:case"end":return r.stop()}},u,null,[[1,,3,6]])})),Kt.apply(this,arguments)}function mn(u,a){var t=(0,v.useState)({loading:!1}),n=Z()(t,2),r=n[0],l=n[1],d=(0,v.useCallback)(cn(l),[]),f=(0,v.useCallback)(i()(c()().mark(function x(){var b;return c()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,V(u,a);case 2:if(b=T.sent,b.success){T.next=5;break}return T.abrupt("return",b);case 5:return l(function(g){return m()(m()({},g),{},{data:b.data})}),T.abrupt("return",b);case 7:case"end":return T.stop()}},x)})),[a,u]),p=(0,v.useCallback)(function(x){return ca(d,function(){return Je(x).then(f)})},[f]);return(0,v.useEffect)(function(){ca(d,f)},[f]),{finalGrades:r,deleteFinalGrade:p}}function fn(){var u=(0,v.useState)({loading:!1}),a=Z()(u,2),t=a[0],n=a[1];return(0,v.useEffect)(function(){n(function(r){return m()(m()({},r),{},{loading:!0})}),K().then(function(r){r.success&&n(function(l){return m()(m()({},l),{},{data:r.data})})}).finally(function(){n(function(r){return m()(m()({},r),{},{loading:!1})})})},[]),{gradeTerms:t}}function vn(u){var a=(0,v.useState)({loading:!1}),t=Z()(a,2),n=t[0],r=t[1];return(0,v.useEffect)(function(){u!==void 0&&(r(function(l){return m()(m()({},l),{},{loading:!0})}),k(u).then(function(l){l.success&&r(function(d){return m()(m()({},d),{},{data:l.data})})}).finally(function(){r(function(l){return m()(m()({},l),{},{loading:!1})})}))},[u]),{subjectGradeScales:n}}function pn(u,a,t){var n=(0,v.useState)({loading:!1}),r=Z()(n,2),l=r[0],d=r[1];return(0,v.useEffect)(function(){typeof u!="number"||typeof a!="number"||typeof t!="number"||(d(function(f){return m()(m()({},f),{},{loading:!0})}),Pt(u,a).then(function(f){f.success&&d(function(p){var x,b;return m()(m()({},p),{},{data:(x=qt(t,(b=f.data.grade_scale)!==null&&b!==void 0?b:[]))===null||x===void 0?void 0:x.map(function(S,T){return m()(m()({},S),{},{id:T})})})})}).finally(function(){d(function(f){return m()(m()({},f),{},{loading:!1})})}))},[u,a]),{tutorGradeScales:l}}function gn(u,a){var t=(0,v.useState)({loading:!1}),n=Z()(t,2),r=n[0],l=n[1],d=(0,v.useCallback)(function(){l(function(f){return m()(m()({},f),{},{loading:!0})}),Ue(u).then(function(f){if(f.success){var p=f.data.reduce(function(x,b){var S=b.attendances,T=$t()(b,dn),g=S.find(function(j){return j.user_id===a});return g?[].concat(w()(x),[m()(m()({},T),{},{attendance:g})]):x},[]);l(function(x){return m()(m()({},x),{},{data:p})})}}).finally(function(){l(function(f){return m()(m()({},f),{},{loading:!1})})})},[u,a]);return(0,v.useEffect)(function(){d()},[d]),{userAttendanceSchedules:r,fetchUserAttendanceSchedules:d}}function hn(u,a){var t=(0,v.useState)({loading:!1}),n=Z()(t,2),r=n[0],l=n[1];return(0,v.useEffect)(function(){a&&(l(function(d){return m()(m()({},d),{},{loading:!0})}),Re({student_id:u,semester_subject_id:a}).then(function(d){if(d.success){var f=Jt(d.data,u);l(function(p){return m()(m()({},p),{},{data:f})})}}).finally(function(){l(function(d){return m()(m()({},d),{},{loading:!1})})}))},[u,a]),{studentExams:r}}function xn(u,a){var t=(0,v.useState)({loading:!1}),n=Z()(t,2),r=n[0],l=n[1],d=(0,v.useState)({loading:!1}),f=Z()(d,2),p=f[0],x=f[1],b=(0,v.useState)({loading:!1}),S=Z()(b,2),T=S[0],g=S[1];return(0,v.useEffect)(function(){l(function(j){return m()(m()({},j),{},{loading:!0})}),(0,Wt.N7)({group_id:u}).then(function(j){j.success&&l(function(M){return m()(m()({},M),{},{data:j.data})})}).finally(function(){l(function(j){return m()(m()({},j),{},{loading:!1})})})},[u]),(0,v.useEffect)(function(){r.data&&(g(function(j){return m()(m()({},j),{},{loading:!0})}),Promise.all(r.data.map(function(j){var M=j.id;return(0,Wt.Nx)(Number(M))})).then(function(j){j.forEach(function(M){M.success&&g(function(C){return m()(m()({},C),{},{data:m()(m()({},C.data),{},st()({},Number(M.data.id),(0,ln.uS)(M.data.lessons)))})})})}).finally(function(){g(function(j){return m()(m()({},j),{},{loading:!1})})}),x(function(j){return m()(m()({},j),{},{loading:!0})}),Promise.all(r.data.map(function(j){var M=j.id;return(0,Wt.ue)(Number(M),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(C){if(C.success){var Y,D,A=((Y=C.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&Y!==void 0?Y:[]).filter(function(se){return se.id===a}),U=(D=C.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&D!==void 0?D:[];x(function(se){return m()(m()({},se),{},{data:m()(m()({},se.data),{},st()({},Number(M),{finishedTopics:A,attendanceList:U}))})})}})})).finally(function(){return x(function(j){return m()(m()({},j),{},{loading:!1})})}))},[r.data,a]),{userCourses:r,userCoursesStats:p,userCoursesTopics:T}}var jn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],bn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(a,t){return(0,St.WU)(new Date(t.date_from),mt.GC)}}],Sn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(a,t){return(0,St.WU)(new Date(t.created_at),mt.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(a,t){return"".concat(t.result.result," ").concat(t.weight?"%":"")}}],yn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(a,t){var n,r;return(n=t.grade)!==null&&n!==void 0&&n.grade_date?(0,St.WU)(new Date((r=t.grade)===null||r===void 0?void 0:r.grade_date),mt.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(a,t){var n,r;return(n=(r=t.grade)===null||r===void 0?void 0:r.grade_name)!==null&&n!==void 0?n:"-"}}],kt=6,_n=function(a){var t,n,r,l,d=a.user_id,f=a.group_id,p=(0,at.Z)(),x=p.semester_subject_id,b=hn(d,x),S=b.studentExams,T=mn(f,d),g=T.finalGrades,j=T.deleteFinalGrade,M=fn(),C=M.gradeTerms,Y=vn((t=g.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),D=Y.subjectGradeScales,A=pn(x,(n=g.data)===null||n===void 0?void 0:n.tutor_id,(r=g.data)===null||r===void 0?void 0:r.s_subject_scale_form_id),U=A.tutorGradeScales,se=gn(f,d),oe=se.userAttendanceSchedules,$=se.fetchUserAttendanceSchedules,R=xn(f,d),G=R.userCourses,L=R.userCoursesStats,q=R.userCoursesTopics,Fe=lt.ZP.useForm(),Ae=Z()(Fe,1),Xe=Ae[0],ut=(0,v.useMemo)(function(){var Ee;return((Ee=C.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se=Pe.id,We=Pe.name;return{label:We,value:Se}})},[C.data]),ke=(0,v.useMemo)(function(){var Ee;return((Ee=D.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se=Pe.name,We=Pe.id;return{label:Se,value:We}})},[D.data]),Le=(0,v.useMemo)(function(){var Ee,Pe;return Qt((Ee=S.data)!==null&&Ee!==void 0?Ee:[],(Pe=U.data)!==null&&Pe!==void 0?Pe:[])},[S.data,U.data]),ne=(0,v.useCallback)(function(){var Ee=i()(c()().mark(function Pe(Se){var We,qe,vt,ot,dt,yt,Mt;return c()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(vt=Se.grade_scale_id,ot=Se.grade_term_id,((We=g.data)===null||We===void 0?void 0:We.id)!==void 0){$e.next=3;break}return $e.abrupt("return");case 3:if(dt=(qe=g.data)===null||qe===void 0?void 0:qe.grades.find(function(Ct){var gt=Ct.grade_term;return gt.id===ot}),!dt){$e.next=11;break}return $e.next=7,he(dt.id,{grade_scale_id:vt});case 7:return yt=$e.sent,je.ZP[yt.success?"success":"error"](yt.message),yt.success&&s.history.push("/teacher/subjects/".concat(x,"/final-grades")),$e.abrupt("return");case 11:return $e.next=13,ce({grade_scale_id:vt,grade_term_id:ot,lesson_group_user_id:g.data.id});case 13:Mt=$e.sent,je.ZP[Mt.success?"success":"error"](Mt.message),Mt.success&&s.history.push("/teacher/subjects/".concat(x,"/final-grades"));case 16:case"end":return $e.stop()}},Pe)}));return function(Pe){return Ee.apply(this,arguments)}}(),[g.data,x]),pe=(0,v.useMemo)(function(){return[].concat(yn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Pe,Se){var We;return typeof(Se==null||(We=Se.grade)===null||We===void 0?void 0:We.id)=="number"?[(0,e.jsx)(ra.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return j(Se.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Ut.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),X=(0,v.useMemo)(function(){var Ee;return((Ee=C.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se;return m()(m()({},Pe),{},{grade:(Se=g.data)===null||Se===void 0?void 0:Se.grades.find(function(We){var qe=We.grade_term;return qe.id===Pe.id})})})},[g.data,C.data]),Qe=G.loading&&!G.data||L.loading&&!L.data||q.loading&&!q.data,xe=!!(G.data&&L.data&&q.data);return g.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[g.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:g.data.user})}),(0,e.jsx)(Bt.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:kt},dataSource:S.data,loading:S.loading,columns:Sn,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:kt},dataSource:X,loading:g.loading||C.loading,columns:pe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:kt},cardProps:{bodyStyle:{padding:0}},dataSource:oe.data,loading:oe.loading,columns:[].concat(bn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Pe,Se){return(0,e.jsx)(ta,{groupAttendanceScheduleId:Se.id,studentId:d,attendance:Se.attendance.value,onSuccess:$})}}])})}),(0,e.jsx)(ft.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:kt},cardProps:{bodyStyle:{padding:0}},dataSource:U.data,loading:U.loading,columns:jn})}),Qe&&(0,e.jsx)(Oe.Z,{}),xe&&((l=G.data)===null||l===void 0?void 0:l.map(function(Ee){var Pe,Se,We,qe,vt,ot,dt=Ee.id,yt=Ee.title;return(0,e.jsxs)(ft.Z,{span:24,children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:yt}),(0,e.jsx)(da.Du,{course_id:Number(dt),topics:(Pe=(Se=q.data)===null||Se===void 0?void 0:Se[Number(dt)])!==null&&Pe!==void 0?Pe:[],stats:(We=(qe=L.data)===null||qe===void 0||(qe=qe[Number(dt)])===null||qe===void 0?void 0:qe.finishedTopics)!==null&&We!==void 0?We:[]}),(0,e.jsx)(da.nu,{stats:(vt=(ot=L.data)===null||ot===void 0||(ot=ot[Number(dt)])===null||ot===void 0?void 0:ot.attendanceList)!==null&&vt!==void 0?vt:[]})]},dt)}))]}),(0,e.jsx)(lt.ZP,{form:Xe,onFinish:ne,children:(0,e.jsxs)(lt.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(la.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ut,width:"sm",fieldProps:{loading:C.loading}}),(0,e.jsx)(la.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ke,fieldProps:{loading:g.loading||D.loading}}),(0,e.jsx)(lt.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Le}})})]})})]})},Mn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(a,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(a,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(a,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(n){var r=n.grade_name,l=n.grade_term,d=n.id;return(0,e.jsxs)(Ve.Z.Text,{children:[l.name,": ",r]},d)}):"-"})}}],Cn=function(){var a,t,n=(0,s.useLocation)(),r=new URLSearchParams(n.search),l=(a=r.get("user_id"))!==null&&a!==void 0?a:null,d=(t=r.get("group_id"))!==null&&t!==void 0?t:null,f=(0,at.Z)(),p=f.teacherSubjectData,x=f.semester_subject_id,b=(0,v.useMemo)(function(){var S;return((S=p==null?void 0:p.groups)!==null&&S!==void 0?S:[]).map(function(T){var g=T.id,j=T.name;return{label:j,value:g}})},[p==null?void 0:p.groups]);return l!==null&&d!==null?(0,e.jsx)(_n,{user_id:Number(l),group_id:Number(d)}):(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:ct.Sl},request:function(){var S=i()(c()().mark(function T(g){var j,M,C,Y,D,A,U,se,oe,$;return c()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return M=g.group_id,C=M===void 0?[]:M,Y=g.first_name,D=Y===void 0?"":Y,A=g.last_name,U=A===void 0?"":A,se=((j=p==null?void 0:p.groups)!==null&&j!==void 0?j:[]).map(function(L){var q=L.id;return q}),G.next=4,N(C.length===0?se:C);case 4:if(oe=G.sent,oe.success){G.next=7;break}return G.abrupt("return",{success:!1,total:0,data:[]});case 7:return $=oe.data.filter(function(L){var q=L.user;return q.first_name.toLowerCase().includes(D.toLowerCase())&&q.last_name.toLowerCase().includes(U.toLowerCase())}),G.abrupt("return",{success:!0,total:$.length,data:$});case 9:case"end":return G.stop()}},T)}));return function(T){return S.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:b,mode:"multiple"},render:function(T,g){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:g.group_id},g.group_id)}}].concat(Mn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(T,g){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(x,"/final-grades?user_id=").concat(g.user.id,"&group_id=").concat(g.group_id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{})})})},"edit")]}}])})},Tn=o(88284),Fn=o(88280),En=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Pn=function(a){var t=a.subjectTutorGradeScale,n=a.onFormSubmit,r=(0,v.useState)([]),l=Z()(r,2),d=l[0],f=l[1],p=(0,v.useRef)(),x=lt.ZP.useForm(),b=Z()(x,1),S=b[0];return(0,v.useEffect)(function(){var T,g=((T=t.scale)!==null&&T!==void 0?T:[]).map(function(j,M){return m()(m()({},j),{},{id:String((M+1)*100)})});S.setFieldValue("table",g)},[]),(0,e.jsx)(lt.ZP,{form:S,onFinish:n,submitter:{render:function(g,j){var M=Z()(j,2),C=M[1];return[C]}},children:(0,e.jsx)(Fn.Z,{name:"table",rowKey:"id",actionRef:p,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(En,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(g,j){return(0,e.jsx)(h.ZP,{type:"primary",onClick:function(){var C;return(C=p.current)===null||C===void 0?void 0:C.startEditable(j.id)},icon:(0,e.jsx)(Dt.Z,{})})}}]),editable:{form:S,type:"multiple",editableKeys:d,saveText:(0,e.jsx)(h.ZP,{type:"primary",icon:(0,e.jsx)(Tn.Z,{})}),onChange:f,actionRender:function(g,j,M){return[M.save]}}})})},Zn=function(){var a,t,n=(0,s.useModel)("@@initialState"),r=n.initialState,l=(0,at.Z)(),d=l.semester_subject_id,f=l.tutors,p=(0,v.useState)(),x=Z()(p,2),b=x[0],S=x[1],T=(0,v.useState)(!1),g=Z()(T,2),j=g[0],M=g[1],C=(0,v.useState)(null),Y=Z()(C,2),D=Y[0],A=Y[1],U=(0,v.useMemo)(function(){return!!f.data.find(function(R){var G,L=R.id;return L===(r==null||(G=r.currentUser)===null||G===void 0?void 0:G.id)})},[f.data,r==null||(a=r.currentUser)===null||a===void 0?void 0:a.id]),se=(0,v.useMemo)(function(){return f.data.map(function(R){var G=R.id,L=R.first_name,q=R.last_name;return{label:"".concat(L," ").concat(q),value:G}})},[f.data]),oe=(0,v.useCallback)(function(){d===null||D===null||(M(!0),S(void 0),Pt(d,D).then(function(R){R.success&&S(R.data)}).finally(function(){M(!1)}))},[d,D]),$=(0,v.useCallback)(function(R,G){return function(){var L=i()(c()().mark(function q(Fe){var Ae,Xe;return c()().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:if(!(d===null||D===null)){ke.next=2;break}return ke.abrupt("return");case 2:return Ae=R.reduce(function(Le,ne){return ne.s_subject_scale_form_id===G?[].concat(w()(Le),[{s_subject_scale_form_id:G,scale:Fe.table.map(function(pe){var X=pe.name,Qe=pe.grade,xe=pe.grade_value;return{name:X,grade:Qe,grade_value:xe}})}]):[].concat(w()(Le),[ne])},[]),ke.next=5,Gt(d,D,{grade_scale:Ae});case 5:Xe=ke.sent,Xe.success&&oe();case 7:case"end":return ke.stop()}},q)}));return function(q){return L.apply(this,arguments)}}()},[D,d]);return(0,v.useEffect)(function(){var R,G;if(!U||!(r!=null&&(R=r.currentUser)!==null&&R!==void 0&&R.id)){var L;if((L=f.data)!==null&&L!==void 0&&L[0]){var q;A((q=f.data)===null||q===void 0?void 0:q[0].id)}return}A(r==null||(G=r.currentUser)===null||G===void 0?void 0:G.id)},[r==null||(t=r.currentUser)===null||t===void 0?void 0:t.id,U]),(0,v.useEffect)(function(){oe()},[oe]),f.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(lt.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(It.default,{disabled:U,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:se,value:D,onChange:function(G){return A(G)}})}),(0,e.jsx)(Bt.Z,{}),j&&!b&&(0,e.jsx)(Oe.Z,{}),b!=null&&b.grade_scale?b.grade_scale.map(function(R,G){var L;return(0,e.jsxs)(v.Fragment,{children:[G>0&&(0,e.jsx)(Bt.Z,{}),(0,e.jsx)(Pn,{subjectTutorGradeScale:R,onFormSubmit:$((L=b.grade_scale)!==null&&L!==void 0?L:[],R.s_subject_scale_form_id)})]},R.s_subject_scale_form_id)}):(0,e.jsx)(Ve.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},wn=o(30814),Dn=o(40411),In=o(98101),Gn=o(27484),He=o.n(Gn),An=o(80334),Ln={getNow:function(){return He()()},getFixedDate:function(a){return He()(a,"YYYY-MM-DD")},getEndDate:function(a){var t=a.clone();return t.endOf("month")},getWeekDay:function(a){var t=a.clone().locale("en_US");return t.weekday()+t.localeData().firstDayOfWeek()},getYear:function(a){return a.year()},getMonth:function(a){return a.month()},getDate:function(a){return a.date()},getHour:function(a){return a.hour()},getMinute:function(a){return a.minute()},getSecond:function(a){return a.second()},getMillisecond:function(a){return a.millisecond()},addYear:function(a,t){var n=a.clone();return n.add(t,"year")},addMonth:function(a,t){var n=a.clone();return n.add(t,"month")},addDate:function(a,t){var n=a.clone();return n.add(t,"day")},setYear:function(a,t){var n=a.clone();return n.year(t)},setMonth:function(a,t){var n=a.clone();return n.month(t)},setDate:function(a,t){var n=a.clone();return n.date(t)},setHour:function(a,t){var n=a.clone();return n.hour(t)},setMinute:function(a,t){var n=a.clone();return n.minute(t)},setSecond:function(a,t){var n=a.clone();return n.second(t)},setMillisecond:function(a,t){var n=a.clone();return n.millisecond(t)},isAfter:function(a,t){return a.isAfter(t)},isValidate:function(a){return a.isValid()},locale:{getWeekFirstDay:function(a){var t=He()().locale(a);return t.localeData().firstDayOfWeek()},getWeekFirstDate:function(a,t){var n=t.clone(),r=n.locale(a);return r.weekday(0)},getWeek:function(a,t){var n=t.clone(),r=n.locale(a);return r.week()},getShortWeekDays:function(a){var t=He()().locale(a);return t.localeData().weekdaysMin()},getShortMonths:function(a){var t=He()().locale(a);return t.localeData().monthsShort()},format:function(a,t,n){var r=t.clone(),l=r.locale(a);return l.format(n)},parse:function(a,t,n){for(var r=[],l=0;l<n.length;l+=1){var d=n[l],f=t;if(d.includes("wo")||d.includes("Wo")){d=d.replace(/wo/g,"w").replace(/Wo/g,"W");var p=d.match(/[-YyMmDdHhSsWwGg]+/g),x=f.match(/[-\d]+/g);p&&x?(d=p.join(""),f=x.join("")):r.push(d.replace(/o/g,""))}var b=He()(f,d,a,!0);if(b.isValid())return b}for(var S=0;S<r.length;S+=1){var T=He()(t,r[S],a,!1);if(T.isValid())return(0,An.ET)(!1,"Not match any format strictly and fallback to fuzzy match. Please help to fire a issue about this."),T}return null}}},Rn=Ln;function $n(u,a){return Vt.apply(this,arguments)}function Vt(){return Vt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules",m()({params:a,method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),Vt.apply(this,arguments)}var On=(0,In.Z)(Rn),Nn=function(){var a=(0,v.useState)(null),t=Z()(a,2),n=t[0],r=t[1],l=(0,v.useState)([]),d=Z()(l,2),f=d[0],p=d[1],x=(0,at.Z)(),b=x.semester_subject_id,S=He()(),T=(0,v.useMemo)(function(){return f.map(function(A){return{id:A.id,title:"".concat(A.group.name," (").concat(A.term_status.name,")"),start:He()(A.date_from).toDate(),end:He()(A.date_to).toDate(),tutor_name:"".concat(A.tutor.first_name," ").concat(A.tutor.last_name),tutor_email:A.tutor.email,semester:A.semester.name,group:A.group.name,subject:A.subject.name,ms_teams_join_url:A.ms_teams_join_url}})},[f]),g=(0,v.useCallback)(function(A,U){$n({semester_subject_id:b,date_form:A.toDate(),date_to:U.toDate()}).then(function(se){se.success&&p(se.data)})},[b]),j=(0,v.useCallback)(function(A){r(A)},[]),M=(0,v.useCallback)(function(){r(null)},[]),C=(0,v.useCallback)(function(A){return A.isSame(S,"day")?"warning":A.isAfter(S,"day")?"success":"error"},[]),Y=(0,v.useCallback)(function(A){var U=T.filter(function(se){return He()(se.start).isSame(A,"day")});return(0,e.jsx)("ul",{className:"events",children:U.map(function(se){return(0,e.jsx)("li",{onClick:function(){return j(se)},children:(0,e.jsx)(Dn.Z,{status:C(He()(se.start)),text:se.title})},se.id)})})},[f]),D=(0,v.useCallback)(function(A,U){var se=He()(A).startOf(U).subtract(1,"month"),oe=He()(A).endOf(U).add(1,"month");g(se,oe)},[]);return(0,v.useEffect)(function(){var A=He()().startOf("month"),U=He()().endOf("month");g(A,U)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(On,{cellRender:Y,onPanelChange:D}),(0,e.jsxs)(be.Z,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:M,footer:null,children:[(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",n&&He()(n.start).format(mt.E)]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",n&&He()(n.end).format(mt.E)]}),(n==null?void 0:n.ms_teams_join_url)&&(0,e.jsx)(Ve.Z.Paragraph,{children:(0,e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(h.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},kn=o(58638);function Un(u,a){return zt.apply(this,arguments)}function zt(){return zt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),zt.apply(this,arguments)}var Bn=function(a){var t=a.student_id,n=(0,v.useState)(!1),r=Z()(n,2),l=r[0],d=r[1],f=(0,v.useCallback)(i()(c()().mark(function p(){var x;return c()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return d(!0),S.next=3,Un({user_id:t});case 3:if(x=S.sent,x.success){S.next=8;break}return je.ZP.error(x.message),d(!1),S.abrupt("return");case 8:window.open(x.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return S.stop()}},p)})),[]);return(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(h.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(kn.Z,{}),onClick:f})})},Wn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Kn=function(a){return a.map(function(t){var n=t.id,r=t.name;return{label:r,value:n}})},Vn=function(a,t){return a.reduce(function(n,r){if(!(r!=null&&r.users))return n;var l=r.users.reduce(function(d,f){var p=t.some(function(x){return x.user.id===f.id});return f.academic_teacher_id!==null&&!p?d:[].concat(w()(d),[{group_id:r.id,group_name:r.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(w()(n),w()(l))},[])},zn=function(){var a=(0,at.Z)(),t=a.teacherSubjectData,n=(0,v.useMemo)(function(){var r;return Kn((r=t==null?void 0:t.groups)!==null&&r!==void 0?r:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:ct.Sl},request:function(){var r=i()(c()().mark(function l(d){var f,p,x,b,S,T,g,j,M,C;return c()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return f=d.groups,p=d.first_name,x=p===void 0?"":p,b=d.last_name,S=b===void 0?"":b,T=d.email,g=T===void 0?"":T,D.next=3,(0,_t.Z)({parent_id:t==null?void 0:t.group_id,id:f});case 3:if(j=D.sent,j.success){D.next=6;break}return D.abrupt("return",{data:[],total:0,success:!1});case 6:return D.next=8,N(j.data.map(function(A){return A.id}));case 8:if(M=D.sent,M.success){D.next=11;break}return D.abrupt("return",{data:[],success:!1});case 11:return C=Vn(j.data,M.data).filter(function(A){return A.first_name.toLowerCase().includes(x.toLowerCase())&&A.last_name.toLowerCase().includes(S.toLowerCase())&&A.email.toLowerCase().includes(g.toLowerCase())}),D.abrupt("return",{data:C,total:C.length,success:!0});case 13:case"end":return D.stop()}},l)}));return function(l){return r.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(Wn,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,d){return[(0,e.jsx)(Bn,{student_id:d.user_id},"teamsChat")]}}])})},Xn=function(a){var t,n,r=a.tab,l=(0,s.useIntl)(),d=(0,s.useModel)("@@initialState"),f=d.setInitialState,p=d.initialState,x=(0,at.Z)(),b=x.teacherSubjectData,S=x.semester_subject_id,T=x.tutors,g=(0,v.useCallback)((0,Ze.X)(p==null?void 0:p.currentUser),[p==null?void 0:p.currentUser]),j=(0,v.useMemo)(function(){return!!T.data.find(function(M){var C,Y=M.id;return Y===(p==null||(C=p.currentUser)===null||C===void 0?void 0:C.id)})||g(Ke.Z.TeacherListGradeScale)},[]);return b?(0,e.jsx)(B._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:b==null||(t=b.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:r})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(S,"/exams?exam_id=new"),children:(0,e.jsx)(h.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(S),breadcrumbName:String((n=b.subject)===null||n===void 0?void 0:n.name)},{path:String(r),breadcrumbName:l.formatMessage({id:r,defaultMessage:String(r)})}]}},children:(0,e.jsxs)(ye.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:r,onChange:function(C){f(m()({},p)),s.history.push("/teacher/subjects/".concat(S,"/").concat(C))}},children:[(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(wn.F,{})},"groups"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(zn,{})},"students"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(en,{})},"exams"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Nn,{})},"schedule"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(wa,{})},"class-register"),j&&(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(Zn,{})},"grades-scale"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(Cn,{})},"final-grades"),(0,e.jsx)(ye.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(on,{})},"file-exports-history")]})}):(0,e.jsx)(Oe.Z,{})},Hn=function(){var u=(0,s.useParams)(),a=u.subjectId,t=u.tab,n=t===void 0?"groups":t;return(0,e.jsx)(at.p,{semester_subject_id:Number(a),children:(0,e.jsx)(Xn,{tab:n})})}},76841:function(Tt,et,o){o.d(et,{Gm:function(){return h},Sx:function(){return c},_g:function(){return s}});var ze=o(15009),m=o.n(ze),Ke=o(97857),Ze=o.n(Ke),ye=o(99289),B=o.n(ye),Oe=o(80854);function h(i,_){return v.apply(this,arguments)}function v(){return v=B()(m()().mark(function i(_,w){return m()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",(0,Oe.request)("/api/admin/reports/report",Ze()({params:_,method:"GET",useCache:!1},w||{})));case 1:case"end":return Z.stop()}},i)})),v.apply(this,arguments)}function s(i,_,w){return ee.apply(this,arguments)}function ee(){return ee=B()(m()().mark(function i(_,w,ae){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,Oe.request)("/api/admin/stats/course/".concat(_,"/export"),Ze()({params:w,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ae||{})));case 1:case"end":return H.stop()}},i)})),ee.apply(this,arguments)}function c(i,_,w){return P.apply(this,arguments)}function P(){return P=B()(m()().mark(function i(_,w,ae){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,Oe.request)("/api/admin/stats/topic/".concat(_,"/export"),Ze()({method:"GET",useCache:!1,params:{stat:w},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ae||{})));case 1:case"end":return H.stop()}},i)})),P.apply(this,arguments)}},70804:function(Tt,et,o){var ze=o(67294);var m=function(ee,c){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,i){P.__proto__=i}||function(P,i){for(var _ in i)i.hasOwnProperty(_)&&(P[_]=i[_])})(ee,c)},Ke,Ze,ye=(function(ee){(function(){var c={}.hasOwnProperty;function P(){for(var i=[],_=0;_<arguments.length;_++){var w=arguments[_];if(w){var ae=typeof w;if(ae==="string"||ae==="number")i.push(w);else if(Array.isArray(w)&&w.length){var Z=P.apply(null,w);Z&&i.push(Z)}else if(ae==="object")for(var H in w)c.call(w,H)&&w[H]&&i.push(H)}}return i.join(" ")}ee.exports?(P.default=P,ee.exports=P):window.classNames=P})()}(Ze={path:Ke,exports:{},require:function(ee,c){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(c==null&&Ze.path)}},Ze.exports),Ze.exports);function B(ee,c,P){var i,_,w,ae,Z;function H(){var ge=Date.now()-ae;ge<c&&ge>=0?i=setTimeout(H,c-ge):(i=null,P||(Z=ee.apply(w,_),w=_=null))}c==null&&(c=100);var be=function(){w=this,_=arguments,ae=Date.now();var ge=P&&!i;return i||(i=setTimeout(H,c)),ge&&(Z=ee.apply(w,_),w=_=null),Z};return be.clear=function(){i&&(clearTimeout(i),i=null)},be.flush=function(){i&&(Z=ee.apply(w,_),w=_=null,clearTimeout(i),i=null)},be}B.debounce=B;var Oe=B;(function(ee,c){c===void 0&&(c={});var P=c.insertAt;if(ee&&typeof document!="undefined"){var i=document.head||document.getElementsByTagName("head")[0],_=document.createElement("style");_.type="text/css",P==="top"&&i.firstChild?i.insertBefore(_,i.firstChild):i.appendChild(_),_.styleSheet?_.styleSheet.cssText=ee:_.appendChild(document.createTextNode(ee))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var h,v=(h="indiana-scroll-container",function(ee,c){if(!ee)return h;var P;typeof ee=="string"?P=ee:c=ee;var i=h;return P&&(i+="__"+P),i+(c?Object.keys(c).reduce(function(_,w){var ae=c[w];return ae&&(_+=" "+(typeof ae=="boolean"?i+"--"+w:i+"--"+w+"_"+ae)),_},""):"")}),s=function(ee){function c(P){var i=ee.call(this,P)||this;return i.onEndScroll=function(){i.scrolling=!1,!i.pressed&&i.started&&i.processEnd()},i.onScroll=function(_){var w=i.container.current;w.scrollLeft===i.scrollLeft&&w.scrollTop===i.scrollTop||(i.scrolling=!0,i.processScroll(_),i.onEndScroll())},i.onTouchStart=function(_){var w=i.props.nativeMobileScroll;if(i.isDraggable(_.target))if(i.internal=!0,w&&i.scrolling)i.pressed=!0;else{var ae=_.touches[0];i.processClick(_,ae.clientX,ae.clientY),!w&&i.props.stopPropagation&&_.stopPropagation()}},i.onTouchEnd=function(_){var w=i.props.nativeMobileScroll;i.pressed&&(!i.started||i.scrolling&&w?i.pressed=!1:i.processEnd(),i.forceUpdate())},i.onTouchMove=function(_){var w=i.props.nativeMobileScroll;if(i.pressed&&(!w||!i.isMobile)){var ae=_.touches[0];ae&&i.processMove(_,ae.clientX,ae.clientY),_.preventDefault(),i.props.stopPropagation&&_.stopPropagation()}},i.onMouseDown=function(_){i.isDraggable(_.target)&&i.isScrollable()&&(i.internal=!0,i.props.buttons.indexOf(_.button)!==-1&&(i.processClick(_,_.clientX,_.clientY),_.preventDefault(),i.props.stopPropagation&&_.stopPropagation()))},i.onMouseMove=function(_){i.pressed&&(i.processMove(_,_.clientX,_.clientY),_.preventDefault(),i.props.stopPropagation&&_.stopPropagation())},i.onMouseUp=function(_){i.pressed&&(i.started?i.processEnd():(i.internal=!1,i.pressed=!1,i.forceUpdate(),i.props.onClick&&i.props.onClick(_)),_.preventDefault(),i.props.stopPropagation&&_.stopPropagation())},i.container=ze.createRef(),i.onEndScroll=Oe(i.onEndScroll,300),i.scrolling=!1,i.started=!1,i.pressed=!1,i.internal=!1,i.getRef=i.getRef.bind(i),i}return function(P,i){function _(){this.constructor=P}m(P,i),P.prototype=i===null?Object.create(i):(_.prototype=i.prototype,new _)}(c,ee),c.prototype.componentDidMount=function(){var P=this.props.nativeMobileScroll,i=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),i.addEventListener("touchstart",this.onTouchStart,{passive:!1}),i.addEventListener("mousedown",this.onMouseDown,{passive:!1}),P&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},c.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},c.prototype.getElement=function(){return this.container.current},c.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},c.prototype.isDraggable=function(P){var i=this.props.ignoreElements;if(i){var _=P.closest(i);return _===null||_.contains(this.getElement())}return!0},c.prototype.isScrollable=function(){var P=this.container.current;return P&&(P.scrollWidth>P.clientWidth||P.scrollHeight>P.clientHeight)},c.prototype.processClick=function(P,i,_){var w=this.container.current;this.scrollLeft=w.scrollLeft,this.scrollTop=w.scrollTop,this.clientX=i,this.clientY=_,this.pressed=!0},c.prototype.processStart=function(P){P===void 0&&(P=!0);var i=this.props.onStartScroll;this.started=!0,P&&document.body.classList.add("indiana-dragging"),i&&i({external:!this.internal}),this.forceUpdate()},c.prototype.processScroll=function(P){if(this.started){var i=this.props.onScroll;i&&i({external:!this.internal})}else this.processStart(!1)},c.prototype.processMove=function(P,i,_){var w=this.props,ae=w.horizontal,Z=w.vertical,H=w.activationDistance,be=w.onScroll,ge=this.container.current;this.started?(ae&&(ge.scrollLeft-=i-this.clientX),Z&&(ge.scrollTop-=_-this.clientY),be&&be({external:!this.internal}),this.clientX=i,this.clientY=_,this.scrollLeft=ge.scrollLeft,this.scrollTop=ge.scrollTop):(ae&&Math.abs(i-this.clientX)>H||Z&&Math.abs(_-this.clientY)>H)&&(this.clientX=i,this.clientY=_,this.processStart())},c.prototype.processEnd=function(){var P=this.props.onEndScroll;this.container.current&&P&&P({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},c.prototype.getRef=function(P){[this.container,this.props.innerRef].forEach(function(i){i&&(typeof i=="function"?i(P):i.current=P)})},c.prototype.render=function(){var P=this.props,i=P.children,_=P.draggingClassName,w=P.className,ae=P.style,Z=P.hideScrollbars,H=P.component;return ze.createElement(H,{className:ye(w,this.pressed&&_,v({dragging:this.pressed,"hide-scrollbars":Z,"native-scroll":this.isMobile})),style:ae,ref:this.getRef,onScroll:this.onScroll},i)},c.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},c}(ze.PureComponent);et.Z=s}}]);
