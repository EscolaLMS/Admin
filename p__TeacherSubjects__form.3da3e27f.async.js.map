{"version":3,"sources":["webpack:///./src/services/escola-lms/enums.ts","webpack:///./src/components/CourseStatistics/ExportStatsButton.tsx","webpack:///./src/components/CourseStatistics/userProgress.tsx","webpack:///./src/services/escola-lms/exams.ts","webpack:///./src/pages/TeacherSubjects/components/ConvertGradesModal.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamForm.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamResults.tsx","webpack:///./src/pages/TeacherSubjects/components/Exams.tsx","webpack:///./src/services/escola-lms/chats.ts","webpack:///./src/pages/TeacherSubjects/components/CreateTeamsChatButton.tsx","webpack:///./src/pages/TeacherSubjects/components/Students.tsx","webpack:///./src/services/escola-lms/attendances.ts","webpack:///./src/components/AttendanceCheckbox/utils.ts","webpack:///./src/components/AttendanceCheckbox/index.tsx","webpack:///./src/pages/TeacherSubjects/components/Attendances.tsx","webpack:///./src/services/escola-lms/grades.ts","webpack:///./src/pages/TeacherSubjects/components/GradesScale.tsx","webpack:///./src/services/escola-lms/schedules.ts","webpack:///./src/pages/TeacherSubjects/components/Schedule.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/utils.ts","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/hooks.ts","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/index.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradesList.tsx","webpack:///./src/pages/TeacherSubjects/components/FileExportsHistory.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradeSelect.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamGradeInput.tsx","webpack:///./src/pages/TeacherSubjects/components/ClassRegister/utils.tsx","webpack:///./src/pages/TeacherSubjects/components/ClassRegister/index.tsx","webpack:///./src/pages/TeacherSubjects/form.tsx","webpack:///./src/components/ProgramForm/Context/index.tsx","webpack:///./src/services/escola-lms/reports.ts"],"names":["TopicType","EventTypes","CourseStatus","TemplateChannelValue","TemplateEvents","VouchersTypes","QuestionType","AttendanceValue","ExamGradeType","CompetencyChallengeType","TopicStatsKey","ExportStatsButton","course_id","stat","useState","loading","setLoading","onClickFactory","useCallback","courseId","exportStatForCourse","response","Blob","downloadLink","document","createElement","href","window","URL","createObjectURL","download","body","appendChild","click","removeChild","console","error","findH5PType","topic","topicable","content","contents","Object","values","library","UserProgress","topics","stats","showSeconds","setShowSeconds","columns","useMemo","title","dataIndex","render","id","map","type","topicable_type","split","pop","row","result","minutes","started_at","finished_at","seconds","toFixed","dataSource","userStat","reduce","acc","find","userStatTopic","Number","email","v","x","table","props","maxWidth","UserCourseFinish","UserCourseAttempts","choosenUserEmail","setChoosenUserEmail","choosenAttempt","setChoosenAttempt","intl","useIntl","flatMap","userStats","attempts","dates","attempt","datesValue","date","seconds_total","config","xField","yField","seriesField","isStack","xAxis","label","autoHide","autoRotate","slider","start","end","position","layout","newValue","Set","filter","overflow","minHeight","width","formatMessage","formatter","datum","Math","floor","name","value","isInteger","params","options","request","method","useCache","headers","data","exam_id","user_id","FileExamGradeType","onDataConverted","groupSelectDisabled","useTeacherSubject","semester_subject_id","teacherSubjectData","selectedGroup","setSelectedGroup","groupOptions","groups","reqData","group_id","onUploadFile","success","exam_results","results","length","info","fileList","undefined","ManualExamGradeType","groupUsers","onSelectedGroupChange","currGroup","byId","users","first_name","last_name","academic_teacher_id","FILE_TYPES","TeamsLecture","TestPortal","TeamsForms","ConvertGradesModal","open","closeModal","onSuccess","fetchGroupUsers","convertedData","setConvertedData","useEffect","Manual","forEach","disabled","includes","SelectTypeButtonsGroup","onSelect","staticColumns","editable","valueType","formItemProps","rules","required","message","min","max","ExamForm","ProForm","useForm","form","selectedType","setSelectedType","fetching","setFetching","getGroupById","editableKeys","numExamId","resetFields","isNaN","getExam","then","res","weight","passed_at","setFieldsValue","finally","resetState","Boolean","formData","areExamResultsValid","every","createExam","updateExam","history","push","onValuesChange","record","bodyStyle","paddingInline","hideInSearch","ExamResults","setTitle","total","sorter","_","format","Date","DAY_FORMAT","created_at","semester","year","Exams","actionRef","useRef","location","useLocation","query","sort","current","pageSize","sortArr","entries","getExams","per_page","page","order_by","order","meta","deleteExam","reload","CreateTeamsChatButton","student_id","onClick","createTeamsChat","web_url","TableColumns","getGroupsOptions","subjectGroups","getTableData","studentUserGroups","curr","userTable","innerAcc","currentUser","group_name","Students","fetchAllStudentsAndGroups","parent_id","tableData","toLowerCase","hideInTable","filterMultiple","fieldProps","mode","_n","attendances","attendance","attendanceMapped","ABSENT","attendanceMap","PRESENT","ch1","ch2","PRESENT_NOT_EXERCISING","EXCUSED_ABSENCE","statusStr","statusMap","true_false","true_true","false_false","false_true","AttendanceCheckbox","groupAttendanceScheduleId","studentId","parseToStatus","status","setStatus","firstMount","handleChangeAttendance","changeStudentAttendance","parseToAttendanceValue","onCh1Change","e","target","checked","onCh2Change","prev","Attendances","dynamicCols","setDynamicCols","selectedGroupName","setSelectedGroupName","defaultValue","allowClear","fixed","defaultMessage","full_name","Promise","all","fetchStudentUserGroup","fetchGroupAttendanceSchedule","studentUserGroupRes","groupAttendanceScheduleRes","String","date_from","align","studentFullName","studentAttendances","groupAttendanceSchedule","studentAttendance","a","b","localeCompare","onChange","tutor_id","s_subject_scale_form_id","final_grade_id","GradeScaleTable","subjectTutorGradeScale","onFormSubmit","setEditableKeys","gradeScaleWithIds","scale","i","setFieldValue","_p","submit","padding","startEditable","saveText","actionRender","_r","_c","dom","save","GradesScale","useModel","initialState","tutors","subjectTutorGrades","setSubjectTutorGrades","selectedTutor","setSelectedTutor","tutorViewing","tutorsSelectOptions","refreshSubjectTutorGrades","getSubjectTutorGrades","onFormSubmitFactory","subjectTutorGradeScales","grade_scale","tutorGradeScale","grade","grade_value","createSubjectTutorGrades","textAlign","Schedule","selectedEvent","setSelectedEvent","eventData","setEventData","now","moment","events","event","group","term_status","toDate","date_to","tutor_name","tutor","tutor_email","subject","ms_teams_join_url","fetchEvents","fetchAllSchedules","date_form","handleEventClick","handleModalClose","checkDate","isSame","isAfter","dateCellRender","filteredEvents","handlePanelChange","startOf","subtract","endOf","add","initialStartDate","initialEndDate","DAYTIME_FORMAT","getStudentExamsFromExams","exams","exam","examResult","getProposedGrade","studentExams","tutorGradeScales","sum","weightsSum","weightedAverage","sortedGradeScales","isWeightedAverageGreater","at","firstFalseIndex","findIndex","getScalesBySubjectScaleFormId","tutorGrades","finalGrades","setFinalGrades","getUserFinalGrades","gradeTerms","setGradeTerms","getGradeTerms","subjectGradeScales","setSubjectGradeScales","getSubjectGradeScales","setTutorGradeScales","userAttendanceSchedules","setUserAttendanceSchedules","fetchUserAttendanceSchedules","filteredSchedules","rest","attendanceItem","setStudentExams","userCourses","setUserCourses","userCoursesStats","setUserCoursesStats","userCoursesTopics","setUserCoursesTopics","course","program","responses","getFlatTopics","lessons","getCourseStats","finishedTopics","attendanceList","tutorGradeScalesColumns","userAttendanceColumns","studentExamsColumns","finalGradesColumns","grade_date","grade_name","TABLE_PAGE_SIZE","FinalGradesDetails","useStudentExams","useFinalGrades","useGradeTerms","useSubjectGradeScales","useTutorGradeScales","useUserAttendanceSchedules","useUserCoursesStats","gradeTermsSelectOptions","gradesSelectOptions","proposedGrade","onFinalGradeSubmit","grade_scale_id","grade_term_id","existingFinalGrade","grades","grade_term","updateFinalGrade","createFinalGrade","lesson_group_user_id","finalGradesTableData","term","areStatisticsLoading","isStatisticDataPresent","fontSize","fontWeight","user","display","flexDirection","paddingTop","flex","gap","FinalGradesList","group_ids","allGroups","getGroupFinalGrades","DownloadButton","url","DATETIME_FORMAT","renderFormItem","item","defaultRender","stateType","getFieldValue","created_by","exported_at","exported_by","FileExportsHistory","getPCGExportsHistory","getGradeScaleId","gradeScales","FinalGradeSelect","defaultFinalGrade","createdGrade","setCreatedGrade","recentGrade","ExamGradeInput","debounce","createExamResult","getAttendanceCols","children","getStudentAttendances","groupAttendanceSchedules","getExamsCols","getStudentExamResults","getFinalGradesCols","final_grades","getStudentFinalGrades","finalGradeItem","getFinalGrades","studentFinalGrade","ClassRegister","fetchGroupFinalGrades","finalGradesRes","fetchExams","fetchSubjectTutorGrades","fetchGradeTerms","fetchSubjectGradeScales","examsRes","tutorGradesRes","gradeTermsRes","subjectGradeScalesRes","attendanceCols","examsCols","finalGradeCols","studentFinalGrades","tutorScales","proposed_grade","studentExamResults","groupName","TeacherSubjectsFormContent","tab","setInitialState","currentUserHasPermissions","isUserHavePermissions","showGradeScale","PERMISSIONS","TeacherListGradeScale","breadcrumb","routes","path","breadcrumbName","activeKey","key","useParams","subjectId","Context","React","createContext","getRandomId","round","random","getFlatLessons","recursiveAddTopicToLessons","lessonId","lesson","recursiveAddLessonToLessons","newLesson","recursiveEditLesson","updatedLesson","appendParentIdToLessons","lessonParentId","recursiveDeleteLesson","recursiveDeleteTopic","topicId","recursiveTopicUploaded","prevTopicId","lesson_id","file","AppContext","state","setState","flatTopics","flatLessons","h5ps","setH5ps","l","getLessons","getLessonIdByTopicId","topic_id","lesson_item","currentEditMode","t","addNewLesson","parentId","isNew","active","prevState","updateLesson","apiCreateLesson","apiUpdateLesson","deleteLesson","apiRemoveLesson","updateTopic","topic_item","apiCreateTopic","apiUpdateTopic","Video","setTimeout","deleteTopic","apiRemoveTopic","addNewTopic","newTopic","onTopicUploaded","cloneTopic","apiCloneTopic","cloneLesson","apiCloneLesson","responseType","accept"],"mappings":"gGAAA,4QAAO,GAAKA,G,UAAAA,E,CAAAA,E,cAAAA,E,iEAAAA,E,6DAAAA,E,2DAAAA,E,2DAAAA,E,uDAAAA,E,2DAAAA,E,uDAAAA,E,8DAAAA,E,uDAAAA,E,wDAAAA,M,KAcL,GAAKC,I,UAAAA,E,CAAAA,E,+CAAAA,E,mDAAAA,Q,KAKL,GAAKC,I,UAAAA,E,CAAAA,E,cAAAA,E,sBAAAA,E,sBAAAA,Q,KAML,GAAKC,G,UAAAA,E,CAAAA,E,sDAAAA,E,gDAAAA,E,kDAAAA,M,KAML,GAAKC,I,UAAAA,E,CAAAA,E,gFAAAA,Q,KAIL,GAAKC,G,UAAAA,E,CAAAA,E,wBAAAA,E,4BAAAA,E,8BAAAA,E,oCAAAA,M,KAiBL,GAAKC,I,UAAAA,E,CAAAA,E,kCAAAA,E,0FAAAA,E,wBAAAA,E,8BAAAA,E,oBAAAA,E,wCAAAA,E,cAAAA,E,4BAAAA,Q,KAWL,GAAKC,G,UAAAA,E,CAAAA,E,kBAAAA,E,gDAAAA,E,gBAAAA,E,oCAAAA,M,KAOL,GAAKC,I,UAAAA,E,CAAAA,E,gBAAAA,E,yBAAAA,E,6BAAAA,E,2BAAAA,Q,KAOL,GAAKC,G,UAAAA,E,CAAAA,E,gBAAAA,E,oBAAAA,M,KAKL,GAAKC,I,UAAAA,E,CAAAA,E,8EAAAA,Q,wiBCtECC,GAAqC,SAAC,GAG7C,IAFJC,IAEI,GAFJA,UAEI,MADJC,QACI,YADG,oDACH,GACJ,GAA8BC,oBAAS,IAAvC,sBAAOC,GAAP,MAAgBC,GAAhB,MAEMC,GAAiBC,uBACrB,SAACC,EAAD,wCAAsB,mGACpBH,UAAW,IADS,kBAGKI,YAAoBD,EAAU,CACnDN,cAJgB,GAGZQ,GAHY,OAOdA,aAAoBC,OAChBC,IAAeC,SAASC,cAAc,KAC5CF,GAAaG,KAAOC,OAAOC,IAAIC,gBAAgBR,IAC/CE,GAAaO,SAAb,0BAA2ClB,GAA3C,SACAY,SAASO,KAAKC,YAAYT,IAC1BA,GAAaU,QACbT,SAASO,KAAKG,YAAYX,KAbV,gDAgBlBY,QAAQC,MAAR,UAhBkB,qBAkBlBpB,GAAW,IAlBO,4EAqBtB,CAACH,KAGH,MACE,sBAAQ,KAAK,UAAU,QAASE,GAAS,QAASE,GAAeL,IAAjE,UACE,cAAC,IAAD,IADF,IACqB,cAAC,IAAD,CAAkB,GAAG,eC7BxCyB,EAAc,SAACC,GAAwB,CAC3C,MAAIA,IAAMC,UAAUC,QAAQC,SACnBC,OAAOC,OAAOL,GAAMC,UAAUC,QAAQC,UAAU,GAAGG,QAErD,OAGIC,GAIR,SAAC,GAAiC,IAA/BjC,IAA+B,GAA/BA,UAAWkC,GAAoB,GAApBA,OAAQC,GAAY,GAAZA,MACzB,GAAsCjC,oBAAS,IAA/C,sBAAOkC,GAAP,MAAoBC,GAApB,MACMC,GAAuCC,mBAAQ,UAAM,CACzD,MAAO,CACL,CACEC,MAAO,cAAC,IAAD,CAAkB,GAAG,SAC5BC,UAAW,KACXC,OAAQ,SAACC,GAAD,OAAgB,eAAC,KAAD,CAAkB,KAAK,oBAAkB,QAASA,OAE5E,CACEH,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,UARf,mBAUKP,GAAOU,IAAI,SAAClB,GAAU,QACnBmB,GAAwB,IAAGnB,GAAMoB,kBAAT,yBAAG,GAAsBC,MAAM,MAAMC,MAEjE,MAAIH,MAAS,OACXA,IAAOpB,EAAYC,KAGd,CACLgB,OAAQ,SAACO,EAAgD,CACvD,GAAIC,IAAS,EACTC,GAAU,EAUd,OATIF,GACF,CAAIA,EAAIG,YAAcH,EAAII,YACxBH,GAAS,EACAD,EAAIG,YACbF,IAAS,GAEXC,GAAUF,EAAIK,QAAU,IAGlBJ,QACD,GACH,MACE,+BACE,oBAAK,MAAM,UAAX,eACCd,IAAe,kCAAQe,GAAQI,QAAQ,GAAxB,cAGjB,GACH,MACE,+BACE,oBAAK,MAAM,OAAX,eACCnB,IAAe,kCAAQe,GAAQI,QAAQ,GAAxB,cAGjB,WAEH,MACE,eAAC,KAAM,SAAP,UACE,oBAAK,MAAM,QAAX,mBAMVf,MACE,kCACE,6BAAMK,KADR,IACqBnB,GAAMc,SAG7BC,UAAWf,GAAMiB,SAItB,CAACT,GAAQE,KAENoB,EAA+BjB,mBAAQ,UAAM,CACjD,MAAOJ,IAAMS,IAAI,SAACa,GAAD,OACfvB,IAAOwB,OACL,SAACC,GAAKjC,GAAU,CACd,GAAMwB,GAASO,GAASvB,OAAO0B,KAAK,SAACC,EAAD,OAAmBA,GAAclB,KAAOjB,GAAMiB,KAClF,MAAO,4BAAKgB,IAAZ,mBAAkBG,OAAOpC,GAAMiB,IAAMO,GAArC,KAAqCA,EAAU,KAEjD,CAAEa,MAAON,GAASM,MAAOpB,GAAIc,GAASd,QAGzC,CAACR,GAAOD,KAEX,MACE,oBACE,MAAO,iBACL,qBAAK,QAAQ,gBAAgB,MAAM,SAAnC,UACE,8BACE,cAAC,IAAD,CAAkB,GAAG,WAAW,eAAe,cAAe,IAC9D,oBAAK,MAAM,UAAX,eACA,cAAC,IAAD,CAAkB,GAAG,UAAU,eAAe,aAHhD,IAG8D,oBAAK,MAAM,OAAX,eAC5D,cAAC,IAAD,CAAkB,GAAG,aAAa,eAAe,iBAAkB,IACnE,oBAAK,MAAM,QAAX,eACA,cAAC,IAAD,CAAkB,GAAG,cAAc,eAAe,iCAAkC,IACpF,mBAAQ,QAASE,GAAa,SAAU,SAAC4B,GAAD,OAAO3B,IAAe2B,UAEhE,cAAC,GAAD,CAAmB,UAAWhE,SAGlC,QAASsC,GACT,WAAYkB,EACZ,KAAK,QACL,OAAQ,CAAES,EAAG,MACb,WAAY,CACVC,MAAO,SAACC,GAAD,OACL,eAAC,IAAD,CAAiB,WAAY,GAAM,MAAO,CAAEC,SAAU,QAAU,eAAgB,GAAhF,SACE,qCAAWD,YAQVE,GAAuE,SAAC,GAAc,IAAZlC,IAAY,GAAZA,MAC/EG,GAAsEC,mBAAQ,UAAM,CACxF,MAAO,CACL,CACEC,MAAO,OACPC,UAAW,KACXC,OAAQ,SAACC,GAAD,OAAgB,eAAC,KAAD,CAAkB,KAAK,oBAAkB,QAASA,OAE5E,CACEH,MAAO,QACPC,UAAW,SAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,cAAc,eAAe,gBACzDC,UAAW,iBAGd,IAEGe,GAA8DjB,mBAAQ,UAAM,CAChF,MAAOJ,IAAMS,IAAI,gBAAGD,IAAH,GAAGA,GAAIoB,GAAP,GAAOA,MAAOV,GAAd,GAAcA,YAAd,MAAiC,CAChDV,MACAoB,SACAV,mBAED,CAAClB,KAEJ,MACE,oBACE,MAAO,iBACL,6BACE,cAAC,IAAD,CAAkB,GAAG,kBAAkB,eAAe,gBAG1D,QAASG,GACT,WAAYkB,GACZ,KAAK,QACL,OAAQ,CAAES,EAAG,QAKNK,GAAgE,SAAC,GAAc,IAAZnC,IAAY,GAAZA,MAC9E,GAAgDjC,oBAAwB,MAAxE,sBAAOqE,GAAP,MAAyBC,GAAzB,MACA,GAA4CtE,oBAAwB,MAApE,sBAAOuE,GAAP,MAAuBC,EAAvB,MACMC,GAAOC,cAEPpB,GAAajB,mBAAQ,UAAM,CAC/B,MAAOJ,IAAM0C,QAAQ,SAACC,EAAD,OACnBhD,QAAOC,OAAO+C,EAAUC,UAAUF,QAAQ,WAAwB,IAArBG,IAAqB,EAArBA,MAAOC,GAAc,EAAdA,QAC5CC,GAAapD,OAAOC,OAAOiD,IAAOH,QAAQ,WAA6B,IAA1BM,GAA0B,EAA1BA,KAAMC,EAAoB,EAApBA,cACvD,MAAO,CACLD,OACAF,WACAG,gBACArB,MAAOe,EAAUf,SAIrB,MAAOmB,SAGV,CAAC/C,KAEEkD,GAAc,CAClBC,OAAQ,OACRC,OAAQ,gBACRC,YAAa,UACbC,QAAS,GACTC,MAAO,CACLC,MAAO,CACLC,SAAU,GACVC,WAAY,KAGhBC,OAAQ,CACNC,MAAO,EACPC,IAAK,GAEPL,MAAO,CACLM,SAAU,SACVC,OAAQ,CACN,CACErD,KAAM,4BAER,CACEA,KAAM,yBAER,CACEA,KAAM,mBAMd,MACE,eAAC,KAAD,CACE,MACE,8BACE,cAAC,IAAD,CAAkB,GAAG,qCACrB,oBACE,WAAU,GACV,MAAO0B,GACP,SAAU,SAAC4B,EAAa,CACtB3B,GAAoB2B,GACpBzB,EAAkB,OAEpB,YAAa,cAAC,IAAD,CAAkB,GAAG,gBAAgB,eAAe,oBAPnE,SASGvC,GAAMS,IAAI,eAAGD,GAAH,EAAGA,GAAIoB,GAAP,EAAOA,MAAP,MACT,oBAAQ,OAAR,CAAwB,MAAOA,GAA/B,SACGA,IADiBpB,OAKxB,oBACE,MAAO8B,GACP,SAAU,SAAC0B,EAAD,OAAczB,GAAkByB,IAC1C,SAAU5B,KAAqB,KAC/B,YAAa,cAAC,IAAD,CAAkB,GAAG,iBAAiB,eAAe,mBAJpE,SAMG,YACI,GAAI6B,KACL5C,GACG6C,OAAO,eAAGtC,GAAH,EAAGA,MAAH,MAAeA,KAAUQ,KAChC3B,IAAI,eAAGqC,GAAH,EAAGA,QAAH,MAAiBA,OAE1BrC,IAAI,SAACqC,EAAD,OACJ,qBAAQ,OAAR,CAAe,MAAOA,EAAtB,UACE,cAAC,IAAD,CAAkB,GAAG,UAAU,eAAe,YADhD,IAC8DA,IAD1BA,UAO5C,QAAS,GACT,OAAO,SAxCT,SA0CE,qBAAK,MAAO,CAAEqB,SAAU,OAAQC,UAAW,QAASC,MAAO,QAA3D,SACE,cAAC,KAAD,2BACMnB,IADN,IAEE,QAAS,CACP7C,MAAO,GAAF,OAAKmC,GAAK8B,cAAc,CAAE9D,GAAI,aACnC+D,UAAW,SAACC,EAAU,CACpB,GAAMxD,IAAUyD,KAAKC,MAAM,CAACF,EAAMvB,cAAgB,IAC5C9B,GAAU,CAACqD,EAAMvB,cAAgB,GAAK,CAACuB,EAAMvB,cAAgBjC,GAAU,GAAK,EAElF,MAAO,CACL2D,KAAMH,EAAM1B,QACZ8B,MAAO,GAAF,OAAK5D,GAAL,aAAiBG,GAAjB,QAIX,KAAME,GACH6C,OAAO,eAAGtC,GAAH,EAAGA,MAAH,MAAeA,KAAUQ,KAChC8B,OAAO,eAAGpB,GAAH,EAAGA,QAAH,MACNnB,QAAOkD,UAAUvC,IAAkBQ,IAAYR,GAAiB,c,8YCnSvE,WAAP,oC,qDAAO,WAAwBwC,EAA0BC,EAAlD,oGACEC,YAAO,gCACZC,OAAQ,MACaC,SAAU,GAC/BJ,UACIC,GAAW,UALZ,qC,wBAUA,YAAP,oC,qDAAO,WAA0B/F,EAA8B+F,EAAxD,oGACEC,YAAO,gCACZC,OAAQ,OACRE,QAAS,CACP,eAAgB,oBAElBC,KAAMpG,GACF+F,GAAW,UAPZ,qC,wBAYA,YAAP,uC,uDAAO,WACLvE,EACAxB,EACA+F,EAHK,oGAKEC,YAAO,2BAAoDxE,GAApD,aACZyE,OAAQ,MACRG,KAAMpG,EACekG,SAAU,IAC3BH,GAAW,UATZ,qC,yBAcA,YAAP,qC,uDAAO,WAAuBvE,EAAYuE,EAAnC,oGACEC,YAAO,2BAAoDxE,GAApD,aACZyE,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAJZ,qC,yBASA,YAAP,qC,uDAAO,WAA0BvE,EAAYuE,EAAtC,oGACEC,YAAO,2BAAqDxE,GAArD,aACZyE,OAAQ,UACJF,GAAW,UAHZ,qC,yBAQA,YAAP,yC,uDAAO,WACLM,EACAC,EACAtG,EACA+F,EAJK,oGAMEC,YAAO,2BAAoDK,EAApD,kBAAqEC,GAArE,aACZL,OAAQ,OACRE,QAAS,CACP,eAAgB,oBAElBC,KAAMpG,GACF+F,GAAW,UAZZ,qC,yBAiBA,YAAP,uC,uDAAO,WACLM,EACAC,EACAP,EAHK,oGAKEC,YAAO,2BAAqDK,EAArD,kBAAsEC,GAAtE,aACZL,OAAQ,UACJF,GAAW,UAPZ,qC,0QCjEDQ,GAID,SAAC,EAAmD,IAAjD7E,GAAiD,EAAjDA,KAAM8E,EAA2C,EAA3CA,gBAAiBC,EAA0B,EAA1BA,oBAC7B,EAAoDC,cAA5CC,EAAR,EAAQA,oBAAqBC,EAA7B,EAA6BA,mBAC7B,EAA0C7H,mBAAwB,MAAlE,mBAAO8H,EAAP,KAAsBC,EAAtB,KAEMC,EAAoC3F,kBACxC,uBACE,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CACxDnB,MAAOmB,EACPC,MAAOpE,MAGX,IAEIyF,EAAoC,CACxCvF,OACAwF,SAAUL,EACVF,oBAAqBA,GAGjBQ,EAAehI,sBAAY,SAACG,EAA4C,CAC5E,GAAIA,EAAS8H,QAAS,CAGpB,GAAMC,GAAe/H,EAAS8G,KAAKkB,QAAQpC,OAAO,eAAGoB,GAAH,EAAGA,QAAH,MAAiBA,KAAY,OAC/E,GAAI,CAACe,EAAaE,OAAQ,OAE1Bf,EAAgB,CAAEa,eAAcH,SAAU5H,EAAS8G,KAAKc,aAEzD,IAEH,MACE,sCACE,cAAC,IAAQ,KAAT,CAAc,MAAO,cAAC,IAAD,CAAkB,GAAG,UAA1C,SACE,mBACE,SAAUT,EACV,MAAOI,EACP,SAAU,SAAChE,EAAD,OAAOiE,GAAiBjE,IAClC,QAASkE,EACT,YAAa,cAAC,IAAD,CAAkB,GAAG,iBAClC,MAAO,CAAE1B,MAAO,YAGpB,cAAC,IAAD,CACE,KAAK,OACL,IAAI,yBACJ,SAAU8B,EACV,SAAU,SAACK,EAAD,OAAU,CAACA,EAAKC,SAASF,QAAUf,EAAgBkB,SAC7D,SAAU,EACV,KAAMT,EACN,SAAU,CAACJ,QAMbc,GAED,SAAC,EAAwB,IAAtBnB,GAAsB,EAAtBA,gBACN,EAA2CE,cAAnCE,EAAR,EAAQA,mBAAoBgB,EAA5B,EAA4BA,WAC5B,EAA0C7I,mBAAwB,MAAlE,mBAAO8H,EAAP,KAAsBC,EAAtB,KAEMC,EAAoC3F,kBACxC,uBACE,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CACxDnB,MAAOmB,EACPC,MAAOpE,MAGX,IAGIqG,EAAwB1I,sBAC5B,SAAC+H,EAAqB,OACpBJ,EAAiBI,GACjB,GAAMY,GAAS,GAAGF,EAAWG,QAAd,wBAAG,EAAkBb,GACpC,GAAI,EAACY,EAEL,IAAMT,GAAeS,EAAUE,MAAMzF,OACnC,SAACC,EAAD,EAAoE,IAA5DhB,GAA4D,EAA5DA,GAAIoB,EAAwD,EAAxDA,MAAOqF,EAAiD,EAAjDA,WAAYC,EAAqC,EAArCA,UAAWC,GAA0B,EAA1BA,oBAExC,MAAIA,MAAwB,KAAa3F,EAElC,GAAP,mBACKA,GADL,CAEE,CACEI,QACAqF,aACAC,YACA5B,QAAS9E,EACTO,OAAQ,MAId,IAGFyE,EAAgB,CAAEU,WAAUG,mBAE9B,CAACO,EAAWG,OAGd,MACE,oBACE,MAAOlB,EACP,SAAUgB,EACV,QAASd,EACT,YAAa,cAAC,IAAD,CAAkB,GAAG,iBAClC,MAAO,CAAE1B,MAAO,WAiBhB+C,GAAa,CAAC3J,KAAc4J,aAAc5J,KAAc6J,WAAY7J,KAAc8J,YAE3EC,GAAsC,SAAC,EAA0C,IAAxCC,GAAwC,EAAxCA,KAAMC,EAAkC,EAAlCA,WAAYC,EAAsB,EAAtBA,UAAWjH,EAAW,EAAXA,KACjF,EAAgDgF,cAAxCE,EAAR,EAAQA,mBAAoBgC,EAA5B,EAA4BA,gBAC5B,EAA0C7J,qBAA1C,mBAAO8J,EAAP,KAAsBC,EAAtB,KAEAC,2BAAU,UAAM,CACd,GAAIrH,IAASjD,KAAcuK,QAAUP,EAAM,OACzC7B,GAAkB,MAAlB,GAAAA,EAAoBI,UAApB,oBAA4BiC,QAAQ,eAAGzH,GAAH,EAAGA,GAAH,MAAYoH,GAAgBpH,OAEjE,CAACE,EAAM+G,IAGR,oBACE,MAAO,cAAC,IAAD,CAAkB,GAAE,gCAA2B/G,EAA3B,aAC3B,MAAM,OACN,KAAM+G,EACN,SAAUC,EACV,KAAM,UAAM,CACNG,GACFF,EAAUE,IAGd,cAAe,CAAEK,SAAU,CAACL,GAV9B,UAYGT,GAAWe,SAASzH,IACnB,cAAC,GAAD,CACE,KAAMA,EACN,gBAAiBoH,EACjB,oBAAqB,CAAC,CAACD,IAG1BnH,IAASjD,KAAcuK,QAAU,cAAC,GAAD,CAAqB,gBAAiBF,QC9JxEM,GAAgF,SAAC,EAAD,IACpFC,GADoF,EACpFA,SADoF,MAGpF,sBAAK,OAAQ,CAAC,GAAI,IAAlB,UACE,mBAAK,KAAM,GAAX,SACE,oBAAQ,KAAK,UAAU,QAAS,iBAAMA,GAAS5K,KAAc8J,aAA7D,SACE,cAAC,IAAD,CAAkB,GAAG,0BAA0B,eAAe,gCAGlE,mBAAK,KAAM,GAAX,SACE,oBAAQ,KAAK,UAAU,QAAS,iBAAMc,GAAS5K,KAAc6J,aAA7D,SACE,cAAC,IAAD,CAAkB,GAAG,wBAAwB,eAAe,8BAGhE,mBAAK,KAAM,GAAX,SACE,oBAAQ,KAAK,UAAU,QAAS,iBAAMe,GAAS5K,KAAc4J,eAA7D,SACE,cAAC,IAAD,CAAkB,GAAG,qBAAqB,eAAe,2BAG7D,mBAAK,KAAM,GAAX,SACE,oBAAQ,KAAK,UAAU,QAAS,iBAAMgB,GAAS5K,KAAcuK,SAA7D,SACE,cAAC,IAAD,CAAkB,GAAG,uBAAuB,eAAe,iCAM7DM,GAA8C,CAClD,CAAEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,eAAiBC,UAAW,aAAciI,SAAU,IAClF,CAAElI,MAAO,cAAC,IAAD,CAAkB,GAAG,cAAgBC,UAAW,YAAaiI,SAAU,IAChF,CACElI,MAAO,cAAC,IAAD,CAAkB,GAAG,eAC5BC,UAAW,SACXkI,UAAW,UACXC,cAAe,CACbC,MAAO,CACL,CACEC,SAAU,GACVC,QAAS,cAAC,IAAD,CAAkB,GAAG,oBAEhC,CACElI,KAAM,SACNmI,IAAK,EACLC,IAAK,IACLF,QAAS,cAAC,IAAD,CAAkB,GAAG,iBAAiB,OAAQ,CAAEC,IAAK,EAAGC,IAAK,YAgBnEC,GAA4B,SAAC,EAAgB,OAAd1D,EAAc,EAAdA,QAC1C,EAAe2D,IAAQC,UAAvB,mBAAOC,EAAP,KACA,EAAwCnL,qBAAxC,mBAAOoL,EAAP,KAAqBC,EAArB,KACA,EAA0CrL,qBAA1C,mBAAO8J,EAAP,KAAsBC,EAAtB,KACA,EAAgC/J,mBAAS,IAAzC,mBAAOsL,EAAP,KAAiBC,EAAjB,KACA,EAA8C5D,cAAtCC,EAAR,EAAQA,oBAAqB4D,EAA7B,EAA6BA,aAEvBC,GAAepJ,kBACnB,uBAAM,IAACyH,GAAD,YAACA,EAAexB,gBAAhB,mBAAgC,IAAI5F,IAAI,eAAG6E,GAAH,EAAGA,QAAH,MAAiBA,MAC/D,CAACuC,GAAD,YAACA,EAAexB,eAGlB0B,oBAAU,UAAM,CACd,GAAM0B,GAAY9H,OAAO0D,GAErBA,IAAY,OACd+D,GAAgB1C,QAChBoB,EAAiBpB,QACjBwC,EAAKQ,eAGHrE,IAAY,OAAS,CAAC1D,OAAOgI,MAAMF,IACrCH,GAAY,IACZM,GAAQH,GACLI,KAAK,SAACC,EAAQ,CACb,GAAIA,EAAI1D,QAAS,CACf,MAA8D0D,EAAI1E,KAA1D1E,EAAR,EAAQA,KAAM4F,GAAd,EAAcA,QAASjG,GAAvB,EAAuBA,MAAO0J,GAA9B,EAA8BA,OAAQC,GAAtC,EAAsCA,UAAW9D,EAAjD,EAAiDA,SACjDkD,EAAgB1I,GAChBoH,EAAiB,CAAE5B,WAAUG,aAAcC,KAC3C4C,EAAKe,eAAe,CAAE5J,SAAO0J,UAAQC,kBAGxCE,QAAQ,iBAAMZ,GAAY,QAE9B,CAACjE,IAEJ,GAAM8E,IAAahM,sBAAY,UAAM,CACnCiL,EAAgB1C,QAChBoB,EAAiBpB,SAChB,IAEH,MAAI2C,GACK,uBAIP,qCACGF,GACC,cAAC,GAAD,CACE,KAAMiB,QAAQjB,GAAgB,CAACtB,GAC/B,KAAMsB,EACN,WAAYgB,GACZ,UAAWrC,IAGf,eAAC,IAAD,CACE,KAAMoB,EACN,UAAWC,IAAiBzC,QAAa,CAACmB,EAAgB,GAAQnB,OAClE,SAAQ,gDAAE,WAAO2D,EAAP,8GAEFC,GAAsBzC,GAFpB,SAEoBA,EAAexB,gBAFnC,wBAEoB,EAA6BkE,MACvD,gBAAGxJ,IAAH,GAAGA,OAAH,MAAgB,OAAOA,KAAW,UAAYA,IAAU,GAAKA,IAAU,MAHjE,CAMJ8G,IAAiByC,IAAuB,MAAO3E,IAAwB,UANnE,oBAOEtF,GAA6BgK,EAA7BhK,MAAO2J,GAAsBK,EAAtBL,UAAWD,GAAWM,EAAXN,OACpBN,EAAY9H,OAAO0D,GACjBgB,GAA2BwB,EAA3BxB,aAAcH,GAAa2B,EAAb3B,SAEhBD,GAAiC,CACrCvF,KAAMyI,EACNxD,sBACAtF,SACA2J,aACAD,UACA7D,YACAI,QAASD,IAlBL,CAqBW1E,OAAOgI,MAAMF,GArBxB,iCAsBIe,GAAWvE,QAtBf,wDAuBIwE,GAAWhB,EAAWxD,QAvB1B,wBAqBA3H,GArBA,KAwBFA,GAAS8H,SACXsE,IAAQC,KAAR,4BAAkChF,EAAlC,eAzBI,6BA4BD,QA5BC,sCAAF,sDA8BR,QAASwE,GAjCX,UAmCE,eAAC,IAAQ,MAAT,WACE,cAAC,KAAD,CACE,MAAO,cAAC,IAAD,CAAkB,GAAG,YAAY,eAAe,cACvD,MAAO,CACL,CACExB,SAAU,GACVC,QAAS,cAAC,IAAD,CAAkB,GAAG,qBAGlC,MAAM,KACN,KAAK,UAEP,cAAC,KAAD,CACE,MAAO,cAAC,IAAD,CAAkB,GAAG,kBAAkB,eAAe,oBAC7D,MAAO,CACL,CACED,SAAU,GACVC,QAAS,cAAC,IAAD,CAAkB,GAAG,qBAGlC,MAAM,KACN,KAAK,cAEP,cAAC,IAAQ,KAAT,CACE,KAAK,SACL,MAAO,cAAC,IAAD,CAAkB,GAAG,iBAAiB,eAAe,mBAC5D,MAAO,CACL,CAAED,SAAU,GAAMC,QAAS,cAAC,IAAD,CAAkB,GAAG,oBAChD,CACElI,KAAM,SACNmI,IAAK,EACLC,IAAK,IACLF,QAAS,cAAC,IAAD,CAAkB,GAAG,iBAAiB,OAAQ,CAAEC,IAAK,EAAGC,IAAK,SAT5E,SAaE,4BAGHK,GAAgBtB,GACf,cAAC,IAAD,CACE,OAAO,UACP,YAAW,GAAE0B,EAAa1B,EAAc3B,aAA7B,wBAAE,EAAsCvB,KACnD,SAAU,CACRjE,KAAM,SACN8I,gBACAoB,eAAgB,SAACC,EAAQxJ,EAAT,OACdyG,GAAiB,CAAE5B,SAAU2B,EAAc3B,SAAUG,aAAchF,MAEvE,UAAW,CAAEyJ,UAAW,CAAEC,cAAe,IACzC,OAAQ,GACR,WAAYlD,EAAcxB,aAC1B,QAASiC,KAGZ,CAACT,GAAiB,cAAC,GAAD,CAAwB,SAAUuB,WC7MvDjJ,GAAwC,CAC5C,CAAEE,MAAO,cAAC,IAAD,CAAkB,GAAG,eAAiBC,UAAW,cAC1D,CAAED,MAAO,cAAC,IAAD,CAAkB,GAAG,cAAgBC,UAAW,aACzD,CAAED,MAAO,cAAC,IAAD,CAAkB,GAAG,eAAiBC,UAAW,SAAU0K,aAAc,KAGvEC,GAA+B,SAAC,EAAgB,IAAd5F,GAAc,EAAdA,QAC7C,EAA0BtH,mBAAS,IAAnC,mBAAOsC,EAAP,KAAc6K,EAAd,KAEA,MACE,eAAC,IAAD,CACE,UAAU,mBACV,OAAO,UACP,OAAQ,GACR,YAAa7K,EACb,QAAO,+BAAE,6GACgBuJ,GAAQvE,OADxB,MACD/G,EADC,QAGHA,EAAS8H,QAHN,gBAIL8E,SAAS5M,EAAS8G,KAAK/E,OAJlB,kBAME,CACL8K,MAAO7M,EAAS8G,KAAKkB,QAAQC,OAC7BH,QAAS,GACThB,KAAM9G,EAAS8G,KAAKkB,cATjB,4BAaA,QAbA,qCAeT,QAASnG,MCzBTmI,GAAwC,CAC5C,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,KAAK,eAAe,OAChDC,UAAW,KACX8K,OAAQ,GACR/G,MAAO,QAET,CACEhE,MAAO,cAAC,IAAD,CAAkB,GAAG,QAAQ,eAAe,UACnDC,UAAW,QACX0K,aAAc,GACdI,OAAQ,IAEV,CACE/K,MAAO,cAAC,IAAD,CAAkB,GAAG,OAAO,eAAe,SAClDC,UAAW,OACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OAAe,eAAC,IAAD,CAAkB,GAAE,wBAAmBA,EAAOnK,UAEvE,CACEL,MAAO,cAAC,IAAD,CAAkB,GAAG,kCAAkC,eAAe,cAC7EC,UAAW,YACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OAAeA,GAAOb,WAAasB,aAAO,GAAIC,MAAKV,EAAOb,WAAYwB,OAEhF,CACEnL,MAAO,cAAC,IAAD,CAAkB,GAAG,qCAAqC,eAAe,WAChFC,UAAW,SACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OAAeA,GAAOd,OAAS,MAEzC,CACE1J,MAAO,cAAC,IAAD,CAAkB,GAAG,aAAa,eAAe,eACxDC,UAAW,aACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OAAeA,GAAOY,YAAcH,aAAO,GAAIC,MAAKV,EAAOY,YAAaD,OAElF,CACEnL,MAAO,cAAC,IAAD,CAAkB,GAAG,WAAW,eAAe,aACtDC,UAAW,WACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OACN,eAAC,IAAD,CACE,GAAE,uBAAkBA,EAAOa,SAAShL,MACpC,OAAQ,CAAEiL,KAAMd,EAAOa,SAASC,UAItC,CACEtL,MAAO,cAAC,IAAD,CAAkB,GAAG,QAAQ,eAAe,UACnDC,UAAW,WACX8K,OAAQ,GACR7K,OAAQ,SAAC8K,EAAGR,EAAJ,OACN,eAAC,KAAD,CAAwC,KAAK,WAAW,QAASA,EAAO3E,UAAjD2E,EAAO3E,aAKvB0F,GAAkB,UAAM,SAC7BC,EAAYC,mBAClB,EAAgCpG,cAAxBC,EAAR,EAAQA,oBACFoG,EAAWC,cAEjB,EAA6B5L,kBAC3B,2BAAO,CAAEiF,QAAO,MAAE0G,EAASE,SAAX,wBAAE,EAAgB5G,WAAlB,mBAA6B,KAAMiB,QAAO,GAAEyF,EAASE,SAAX,wBAAE,EAAgB3F,UAC5E,IAACyF,EAASE,SAAV,wBAAC,EAAgB5G,QAAjB,GAA0B0G,EAASE,SAAnC,wBAA0B,EAAgB3F,UAFpCjB,EAAR,EAAQA,QAASiB,EAAjB,EAAiBA,QAKjB,MAAIA,KAAY,MAAQ,CAAC3E,OAAOgI,MAAMhI,OAAO2E,IACpC,cAAC,GAAD,CAAa,QAAS3E,OAAO2E,KAGlCjB,IAAY,KACP,cAAC,GAAD,CAAU,QAASA,IAI1B,cAAC,IAAD,CACE,UAAU,mBACV,YAAa,cAAC,IAAD,CAAkB,GAAG,UAClC,UAAWwG,EACX,OAAQ,GACR,OAAO,KACP,QAAO,gDAAE,aAA8BK,EAA9B,0FAASC,EAAT,EAASA,QAASC,EAAlB,EAAkBA,SACrBzG,IAAwB,KADrB,yCAEE,CACLP,KAAM,GACN+F,MAAO,EACP/E,QAAS,SALN,GAODiG,SAAUH,GAAQvM,OAAO2M,QAAQJ,GAAM,GAPtC,SASgBK,EAAS,CAC9BC,SAAUJ,EACVK,KAAMN,EACNxG,oBAAsBhE,OAAOgI,MAAMhE,GAA6Ce,OAAtBf,EAC1D+G,SAAUL,GAAWA,EAAQ,GAC7BM,MAAON,GAAYA,GAAQ,KAAO,SAAW,MAAQ,cAdhD,MASD/N,EATC,QAiBHA,EAAS8H,QAjBN,yCAkBE,CACLhB,KAAM9G,EAAS8G,KACf+F,MAAO7M,EAASsO,KAAKzB,MACrB/E,QAAS,SArBN,4BAyBA,CACLhB,KAAM,GACN+F,MAAO,EACP/E,QAAS,SA5BJ,sCAAF,wDA+BP,QAAO,UACFkC,GADE,CAEL,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,kCAC5BC,UAAW,SACXkI,UAAW,SACXjI,OAAQ,SAAC8K,EAAGR,EAAJ,OAAe,CACrB,cAAC,KAAD,CACE,GAAE,4BAAuBA,EAAOlF,oBAA9B,0BAAmEkF,EAAOrK,IAD9E,SAIE,oBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,OAAO,eAAe,SAA3D,SACE,oBAAQ,KAAK,UAAU,KAAM,cAAC,KAAD,SAH3B,QAMN,cAAC,KAAD,CACE,GAAE,4BAAuBqK,EAAOlF,oBAA9B,0BAAmEkF,EAAOrK,IAD9E,SAIE,oBACE,MACE,cAAC,IAAD,CAAkB,GAAG,gCAAgC,eAAe,YAFxE,SAKE,oBAAQ,KAAM,cAAC,KAAD,SAPZ,WAUN,oBAEE,MACE,cAAC,IAAD,CACE,GAAG,iBACH,eAAe,wCAGnB,UAAS,+BAAE,6GACcqM,GAAWhC,EAAOrK,QADhC,GACHlC,EADG,OAGLA,EAAS8H,SAAWyF,EAAUM,SAChCN,EAAUM,QAAQW,aAJX,qCAOX,OAAQ,cAAC,IAAD,CAAkB,GAAG,QAC7B,WAAY,cAAC,IAAD,CAAkB,GAAG,OAhBnC,SAkBE,oBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,SAAS,eAAe,WAA7D,SACE,oBAAQ,KAAK,UAAU,KAAM,cAAC,KAAD,IAAoB,OAAM,QAlBrD,kB,oDC1JX,YAAP,qC,uDAAO,WACL9N,EACA+F,EAFK,oGAIEC,YAAO,yCACZC,OAAQ,OACRE,QAAS,CACP,eAAgB,oBAElBC,KAAMpG,GACF+F,GAAW,UAVZ,qC,yBCOA,GAAMgI,IAAyC,SAAC,EAAmB,IAAjBC,GAAiB,EAAjBA,WACvD,EAA8BjP,mBAAS,IAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KAEMgP,EAAU9O,sBAAW,+BAAC,6FAC1BF,SAAW,IADe,SAEHiP,GAAgB,CAAE5H,QAAS0H,QAFxB,MAEpB1O,EAFoB,OAGrBA,EAAS8H,QAHY,gBAIxB,YAAQ/G,MAAMf,EAASsK,SACvB3K,EAAW,IALa,0BAS1BW,OAAO6I,KAAKnJ,EAAS8G,KAAK+H,QAAS,SAAU,uBAC7ClP,EAAW,QAVe,sCAWzB,IAEH,MACE,qBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,UAAU,eAAe,UAA9D,SACE,oBAAQ,QAASD,EAAS,KAAK,UAAU,KAAM,cAAC,KAAD,IAAoB,QAASiP,OCJrEG,GAA6C,CACxD,CACE/M,MAAO,cAAC,IAAD,CAAkB,GAAG,KAAK,eAAe,OAChDC,UAAW,UACX0K,aAAc,GACd3G,MAAO,QAET,CACEhE,MAAO,cAAC,IAAD,CAAkB,GAAG,aAAa,eAAe,eACxDC,UAAW,cAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,YAAY,eAAe,cACvDC,UAAW,aAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,QAAQ,eAAe,UACnDC,UAAW,SAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,YAAY,eAAe,eACvDC,UAAW,aACX0K,aAAc,KAIZqC,GAAmB,SAACC,EAAD,OACvBA,GAAc7M,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CACnCnB,MAAOmB,EACPC,MAAOpE,MAGL+M,GAAe,SAACC,EAAD,OACnBA,GAAkBjM,OAAyB,SAACC,EAAKiM,EAAS,OAClDC,EAAYD,GAAH,SAAGA,EAAMzG,SAAT,wBAAG,EAAazF,OAC7B,SAACoM,EAAUC,EAAX,OACEA,GAAYzG,sBAAwB,KAChCwG,EADJ,sBAGSA,GAHT,CAIM,CACEzH,SAAUuH,EAAKjN,GACfqN,WAAYJ,EAAK9I,KACjBW,QAASsI,EAAYpN,GACrByG,WAAY2G,EAAY3G,WACxBC,UAAW0G,EAAY1G,UACvBtF,MAAOgM,EAAYhM,UAG7B,IAGF,MAAO,GAAP,mBAAWJ,GAAX,YAAmBkM,KAClB,KAEQI,GAAqB,UAAM,CACtC,MAA+BpI,cAAvBE,EAAR,EAAQA,mBAEFG,EAAe3F,kBACnB,uBAAMiN,IAAgB,GAACzH,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,KACrD,CAACJ,GAAD,YAACA,EAAoBI,SAGvB,MACE,eAAC,IAAD,CACE,UAAU,mBACV,OAAQ,SAAC6E,EAAD,iBAAeA,EAAO3E,SAAtB,YAAkC2E,EAAOvF,UACjD,OAAQ,CAAEvB,OAAQ,YAClB,QAAO,gDAAE,8GAASiC,SAAT,EAASA,OAAT,IAAiBiB,aAAjB,WAA8B,GAA9B,MAAkCC,YAAlC,WAA8C,GAA9C,MAAkDtF,QAAlD,WAA0D,GAA1D,WACgBmM,aAA0B,CAC/CC,UAAWpI,GAAF,YAAEA,EAAoBM,SAC/B,OAAQF,QAHH,MACD1H,EADC,OAMFA,EAAS8H,QANP,yCAOE,CAAEhB,KAAM,GAAI+F,MAAO,EAAG/E,QAAS,SAPjC,GAUD6H,SAAYV,GAAajP,EAAS8G,MAAMlB,OAC5C,SAAC2G,EAAD,OACEA,GAAO5D,WAAWiH,cAAc/F,SAASlB,EAAWiH,gBACpDrD,EAAO3D,UAAUgH,cAAc/F,SAASjB,EAAUgH,gBAClDrD,EAAOjJ,MAAMsM,cAAc/F,SAASvG,EAAMsM,iBAdvC,kBAiBA,CAAE9I,KAAM6I,EAAW9C,MAAO8C,EAAU1H,OAAQH,QAAS,SAjBrD,qCAAF,sDAmBP,QAAO,CACL,CACE/F,MAAO,cAAC,IAAD,CAAkB,GAAG,SAAS,eAAe,WACpDC,UAAW,SACX6N,YAAa,GACbC,eAAgB,GAChB5F,UAAW,SACX6F,WAAY,CACVtJ,QAASgB,EACTuI,KAAM,cATL,OAYFlB,GAZE,CAaL,CACEpC,aAAc,GACd3K,MAAO,cAAC,IAAD,CAAkB,GAAG,YAC5BC,UAAW,YACXkI,UAAW,SACXjI,OAAQ,SAACgO,EAAI1D,EAAL,OAAgB,CACtB,cAAC,GAAD,CAAuC,WAAYA,EAAOvF,SAA/B,qB,aC/HhC,YAAP,qC,uDAAO,WAAuCY,EAAkBnB,EAAzD,oGACEC,YAAO,sCAA4DkB,GAA5D,aACZjB,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAJZ,qC,yBAQA,YAAP,yC,uDAAO,WACLvE,EACA8E,EACAV,EACAG,EAJK,oGAMEC,YAAO,+BAAsDxE,EAAtD,6BACZ4E,KAAM,CACJoJ,YAAa,CACX,CACElJ,UACAV,WAINK,OAAQ,QACJF,GAAW,UAhBZ,qC,iFCTA,YAAuB0J,EAA4C,SAClEC,EAAmBD,IAAe,KAAOjR,KAAgBmR,OAASF,EAElEG,EAA4B,qBAC/BpR,KAAgBqR,QAAU,CAAEC,IAAK,GAAMC,IAAK,KADb,eAE/BvR,KAAgBwR,uBAAyB,CAAEF,IAAK,GAAMC,IAAK,KAF5B,eAG/BvR,KAAgBmR,OAAS,CAAEG,IAAK,GAAOC,IAAK,KAHb,eAI/BvR,KAAgByR,gBAAkB,CAAEH,IAAK,GAAOC,IAAK,KAJtB,GAOlC,SAAOH,EAAcF,MAArB,mBAA0C,CAAEI,IAAK,GAAOC,IAAK,IAGxD,cAAuE,OAArCD,EAAqC,EAArCA,IAAKC,EAAgC,EAAhCA,IACtCG,EAAY,GAAH,OAAMJ,EAAN,YAAaC,GAEtBI,EAAY,CAChBC,WAAY5R,KAAgBqR,QAC5BQ,UAAW7R,KAAgBwR,uBAC3BM,YAAa9R,KAAgBmR,OAC7BY,WAAY/R,KAAgByR,iBAG9B,SAAOE,EAAUD,MAAjB,mBAA+B1R,KAAgBmR,OCVjD,GAAMa,IAAwD,SAAC,EAKzD,IAJJC,GAII,EAJJA,0BACAC,EAGI,EAHJA,UACAjB,EAEI,EAFJA,WACA9G,EACI,EADJA,UAEA,EAA4B5J,mBAAiB4R,GAAclB,IAA3D,mBAAOmB,EAAP,KAAeC,EAAf,KAEA,EAA8B9R,mBAAS,IAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KACM6R,EAAahE,iBAAO,IAEpBiE,EAAyB5R,sBAAY,SAACL,EAAiB,CAC3DG,EAAW,IACX+R,GAAwBP,EAA2BC,EAAWO,GAAuBnS,IAClF+L,KAAK,SAACC,EAAQ,CACTA,EAAI1D,SACNuB,IAAS,MAATA,OAGHuC,QAAQ,iBAAMjM,GAAW,OAC3B,IAEGiS,EAAc/R,sBAClB,SAACgS,EAAD,OACEN,GAAUM,EAAEC,OAAOC,QAAU,CAAEvB,IAAK,GAAMC,IAAK,IAAU,CAAED,IAAK,GAAOC,IAAK,MAC9E,IAGIuB,EAAcnS,sBAClB,SAACgS,EAAD,OAA4BN,GAAU,SAACU,EAAD,oBAAC,eAAeA,GAAhB,IAAsBxB,IAAKoB,EAAEC,OAAOC,aAC1E,IAGFtI,2BAAU,UAAM,CACd,GAAI+H,EAAW3D,QAAS,CACtB2D,EAAW3D,QAAU,GACrB,OAGF4D,EAAuBH,IACtB,CAACA,EAAQG,IAGV,+BACE,oBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,YAArC,SACE,oBAAU,SAAU/R,EAAS,QAAS4R,EAAOd,IAAK,SAAUoB,MAE9D,oBAAS,MAAO,cAAC,IAAD,CAAkB,GAAIN,EAAOd,IAAM,iBAAmB,oBAAtE,SACE,oBAAU,SAAU9Q,EAAS,QAAS4R,EAAOb,IAAK,SAAUuB,UAMrDd,MClDFgB,GAAwB,UAAM,CACzC,MAA+B9K,cAAvBE,EAAR,EAAQA,mBACR,EAAsC7H,mBAA4C,IAAlF,mBAAO0S,EAAP,KAAoBC,EAApB,KACA,EAAkD3S,mBAAS,IAA3D,mBAAO4S,EAAP,KAA0BC,EAA1B,KACMpO,EAAOC,cAEPoJ,EAAYC,mBAEZ/F,EAAe3F,kBACnB,uBAAM,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CAAEC,MAAOpE,EAAIgD,MAAOmB,MACpF,CAACiB,GAAD,YAACA,EAAoBI,SAGjB7F,EAA6CC,kBACjD,wBACE,CACEC,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,WACX6N,YAAa,GACb3F,UAAW,SACX6F,WAAY,CACVtJ,QAASgB,EACT8K,aAAc9K,GAAF,SAAEA,EAAe,MAAjB,wBAAE,EAAmBnB,MACjCkM,WAAY,KAGhB,CACEzQ,MAAO,cAAC,IAAD,CAAkB,GAAG,iBAAiB,eAAe,qBAC5DC,UAAW,YACXyQ,MAAO,SAfX,mBAiBKN,KAEL,CAAC1K,EAAc0K,IAGjB,MACE,eAAC,IAAD,CACE,UAAU,mBACV,YAAW,UAAKjO,EAAK8B,cAAc,CACjC9D,GAAI,cACJwQ,eAAgB,gBAFP,aAGJL,EAHI,KAIX,QAAO,gDAAE,mIAASzK,WAAT,WAAoBH,GAApB,SAAoBA,EAAe,MAAnC,wBAAoB,EAAmBnB,MAAvC,MAA8CqM,aAA9C,WAA0D,GAA1D,YACyDC,QAAQC,IAAI,CAC1EC,aAAsBlL,GACtBmL,GAA6BnL,SAHxB,qCACAoL,EADA,KACqBC,EADrB,KAKD1L,EAAgBE,EAAatE,KAAK,gBAAGmD,GAAH,GAAGA,MAAH,MAAeA,KAAUsB,IAL1D,CAOH,EAACoL,EAAoBlL,SAAW,CAACmL,EAA2BnL,SAAW,CAACP,GAPrE,4CAQE,CAAET,KAAM,GAAI+F,MAAO,EAAG/E,QAAS,SARjC,OAUFmL,EAA2BnM,KAAKmB,OAV9B,kBAWL,YAAQlH,MACNmD,EAAK8B,cAAc,CACjB9D,GAAI,uBACJwQ,eAAgB,8CAdf,mBAkBE,CAAE5L,KAAM,GAAI+F,MAAO,EAAG/E,QAAS,SAlBjC,IAqBPwK,SAAqB/K,EAAcrC,OACnCkN,EACEa,EAA2BnM,KAAK7D,OAC9B,SAACC,GAAKiM,EAAN,6BACKjM,IADL,CAEE,CACEnB,MAAOmR,OAAOlG,aAAO,GAAIC,MAAKkC,EAAKgE,WAAYjG,MAC/ClL,UAAWkR,OAAO/D,EAAKgE,WACvBzG,aAAc,GACd3G,MAAO,IACPqN,MAAO,SACPnR,OAAQ,SAAC8K,GAAGR,GAAJ,OACN,eAAC,GAAD,CACE,0BAA2B4C,EAAKjN,GAChC,WAAYqK,GAAO,GAAD,OAAI4C,GAAJ,YAAIA,EAAMgE,YAC5B,UAAW5G,GAAOrK,UAK1B,KAIE4E,GAAOkM,EAAoBlM,KAAK4B,MACnCzF,OACC,SAACC,GAAD,EAA6D,IAArDhB,IAAqD,EAArDA,GAAI2G,GAAiD,EAAjDA,oBAAqBF,GAA4B,EAA5BA,WAAYC,GAAgB,EAAhBA,UACrCyK,EAAkB,GAAH,OAAMzK,GAAN,YAAmBD,IAExC,GACEE,KAAwB,MACxB,CAACwK,EAAgBzD,cAAc/F,SAAS8I,GAAU/C,eAElD,MAAO1M,IAET,GAAMoQ,GAAqBL,EAA2BnM,KAAK7D,OAEzD,SAACoM,GAAUkE,GAA4B,CACvC,GAAMC,IAAoBD,GAAwBrD,YAAY/M,KAC5D,SAACgN,GAAD,OAAgBA,IAAWnJ,UAAY9E,KAEzC,MAAKsR,IAEE,2BACFnE,IADL,6BAEMkE,GAAwBJ,WAAcK,GAAkBlN,QAJ/B+I,IAM9B,IAEH,MAAO,GAAP,mBAAWnM,IAAX,cAAkBhB,MAAIyQ,UAAWU,GAAoBC,MAEvD,IAED1F,KAAK,SAAC6F,GAAGC,EAAJ,OAAUD,IAAEd,UAAUgB,cAAcD,EAAEf,aA1EvC,mBA4EA,CAAE7L,QAAM+F,MAAO/F,GAAKmB,OAAQH,QAAS,SA5ErC,uCAAF,sDA8EP,QAASjG,EACT,OAAQ,CAAE4D,OAAQ,YAClB,WAAY,CAAEmO,SAAU,0BAAMrG,EAAUM,WAAhB,wBAAM,EAAmBW,WACjD,OAAQ,CAAEhL,EAAG,MACb,UAAW+J,EACX,OAAO,Q,8EC9IN,YAAP,uC,uDAAO,WACLlG,EACAwM,EACApN,EAHK,oGAKEC,YAAO,uCACoBW,EADpB,mBACkDwM,EADlD,wBAGVlN,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAVd,qC,yBAgBA,YAAP,yC,uDAAO,WACLY,EACAwM,EACAnT,EACA+F,EAJK,oGAMEC,YAAO,uCACoBW,EADpB,mBACkDwM,EADlD,wBAGVlN,OAAQ,OACRG,KAAMpG,GACF+F,GAAW,UAXd,qC,yBAiBA,YAAP,qC,uDAAO,WACLmB,EACAnB,EAFK,oGAIEC,YAAO,6CACZC,OAAQ,MACRH,OAAQ,CAAE,WAAYoB,GACDhB,SAAU,IAC3BH,GAAW,UARZ,qC,yBAaA,YAAP,uC,uDAAO,WACLmB,EACAZ,EACAP,EAHK,oGAKEC,YAAO,+CAC4BkB,EAD5B,kBAC8CZ,GAD9C,aAGVL,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAVd,qC,yBAgBA,YAAP,mC,uDAAO,WAA6BA,EAA7B,oGACEC,YAAO,sCACZC,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAJZ,qC,yBASA,YAAP,qC,uDAAO,WACLqN,EACArN,EAFK,oGAIEC,YAAO,kCACeoN,GADf,aAGVnN,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UATd,qC,yBAeA,YAAP,qC,uDAAO,WACL/F,EACA+F,EAFK,oGAIEC,YAAO,uCACZC,OAAQ,OACRG,KAAMpG,GACF+F,GAAW,UAPZ,qC,yBAYA,YAAP,uC,uDAAO,WACLsN,EACArT,EACA+F,EAHK,oGAKEC,YAAO,kCACeqN,GADf,aAGVpN,OAAQ,QACRG,KAAMpG,GACF+F,GAAW,UAVd,qC,yBCrFP,GAAMuD,IAA+C,CACnD,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,QACXiI,SAAU,IAEZ,CACElI,MAAO,cAAC,IAAD,CAAkB,GAAG,WAC5BC,UAAW,OACXiI,SAAU,IAEZ,CACElI,MAAO,cAAC,IAAD,CAAkB,GAAG,gBAC5BC,UAAW,cACXkI,UAAW,UACXC,cAAe,CACbC,MAAO,CACL,CACEC,SAAU,GACVC,QAAS,cAAC,IAAD,CAAkB,GAAG,oBAEhC,CACElI,KAAM,SACNmI,IAAK,EACLC,IAAK,IACLF,QAAS,cAAC,IAAD,CAAkB,GAAG,iBAAiB,OAAQ,CAAEC,IAAK,EAAGC,IAAK,YAY1EwJ,GAAkD,SAAC,EAGnD,IAFJC,GAEI,EAFJA,uBACAC,EACI,EADJA,aAEA,EAAwCzU,mBAAsB,IAA9D,mBAAOyL,EAAP,KAAqBiJ,EAArB,KACM5G,EAAYC,mBAElB,EAAe9C,IAAQC,UAAvB,mBAAOC,EAAP,KAEAnB,2BAAU,UAAM,OACR2K,EAAoB,IAACH,EAAuBI,SAAxB,mBAAiC,IAAIlS,IAAI,SAACb,EAAQgT,EAAT,oBAAC,eAC/DhT,GAD8D,IAEjEY,GAAIgR,OAAQoB,GAAI,GAAK,SAGvB1J,EAAK2J,cAAc,QAASH,IAC3B,IAGD,cAAC,IAAD,CACE,KAAMxJ,EACN,SAAUsJ,EACV,UAAW,CAAEjS,OAAQ,SAACuS,EAAD,0BAAQC,EAAR,WAAoB,CAACA,KAH5C,SAKE,cAAC,KAAD,CACE,KAAK,QACL,OAAO,KACP,UAAWlH,EACX,cAAe,CAAErI,MAAO,cAAC,IAAD,CAAkB,GAAG,kBAC7C,UAAW,CAAEsH,UAAW,CAAEkI,QAAS,IACnC,mBAAoB,GACpB,QAAO,UACF1K,GADE,CAEL,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,YAC5BmI,UAAW,SACXjI,OAAQ,SAACgO,EAAIzN,EAAL,OACN,qBACE,KAAK,UACL,QAAS,0BAAM+K,EAAUM,WAAhB,wBAAM,EAAmB8G,cAAcnS,EAAIN,KACpD,KAAM,cAAC,KAAD,UAKd,SAAU,CACR0I,OACAxI,KAAM,WACN8I,eACA0J,SAAU,oBAAQ,KAAK,UAAU,KAAM,cAAC,KAAD,MACvChB,SAAUO,EACVU,aAAc,SAACC,EAAIC,EAAIC,EAAT,OAAiB,CAACA,EAAIC,aAOjCC,GAAwB,UAAM,SACzC,EAAyBC,YAAS,kBAA1BC,EAAR,EAAQA,aACR,EAAwChO,cAAhCC,EAAR,EAAQA,oBAAqBgO,EAA7B,EAA6BA,OAE7B,EAAoD5V,qBAApD,mBAAO6V,EAAP,KAA2BC,EAA3B,KACA,EAA8B9V,mBAAS,IAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KACA,EAA0CF,mBAAwB,MAAlE,mBAAO+V,EAAP,KAAsBC,EAAtB,KAEMC,EAAe5T,kBACnB,iBAAM,CAAC,CAACuT,EAAOvO,KAAK3D,KAAK,kBAAGjB,EAAH,EAAGA,GAAH,MAAYA,KAAOkT,IAAA,MAAL,GAAKA,EAAc9F,eAAnB,wBAAK,EAA2BpN,OACvE,CAACmT,EAAOvO,KAAMsO,GAAd,SAAcA,EAAc9F,eAA5B,wBAAc,EAA2BpN,KAErCyT,EAAsB7T,kBAC1B,iBACEuT,GAAOvO,KAAK3E,IAAI,eAAGD,GAAH,EAAGA,GAAIyG,EAAP,EAAOA,WAAYC,EAAnB,EAAmBA,UAAnB,MAAoC,CAClD1D,MAAO,GAAF,OAAKyD,EAAL,YAAmBC,GACxBtC,MAAOpE,MAEX,CAACmT,EAAOvO,OAGJ8O,GAA4B/V,sBAAY,UAAM,CAC9CwH,IAAwB,MAAQmO,IAAkB,MAEtD7V,GAAW,IACX4V,EAAsBnN,QACtByN,GAAsBxO,EAAqBmO,GACxCjK,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACXyN,EAAsBvV,EAAS8G,QAGlC8E,QAAQ,UAAM,CACbjM,EAAW,QAEd,CAAC0H,EAAqBmO,IAEnBM,GAAsBjW,sBAC1B,SAACkW,EAAuDjC,EAAxD,wDACE,WAAO/H,GAAP,yFACM1E,KAAwB,MAAQmO,IAAkB,MADxD,iDAGQQ,UAAcD,EAAwB9S,OAC1C,SAACC,GAAK+S,GAAN,OACEA,IAAgBnC,0BAA4BA,EAA5C,sBAES5Q,IAFT,CAGM,CACE4Q,0BACAO,MAAOtI,GAAStI,MAAMtB,IAAI,gBAAGkE,IAAH,GAAGA,KAAM6P,EAAT,GAASA,MAAOC,EAAhB,GAAgBA,YAAhB,MAAmC,CAC3D9P,QACA6P,QACAC,oBARV,sBAYQjT,IAZR,CAYa+S,MACf,IAlBJ,SAqBoBG,GAAyB/O,EAAqBmO,EAAe,CAC7EQ,qBAtBJ,GAqBQxK,GArBR,OAyBMA,GAAI1D,SACN8N,SA1BJ,qCADF,uDA8BA,CAACJ,EAAenO,IAkBlB,MAfAoC,qBAAU,UAAM,SACd,GAAI,CAACiM,GAAgB,CAACN,IAAD,SAACA,EAAc9F,eAAf,kBAAC,EAA2BpN,IAAI,OACnD,MAAImT,EAAOvO,QAAX,kBAAI,EAAc,GAAI,OACpB2O,EAAgB,GAACJ,EAAOvO,QAAR,wBAAC,EAAc,GAAG5E,IAEpC,OAGFuT,EAAiBL,GAAD,SAACA,EAAc9F,eAAf,wBAAC,EAA2BpN,KAC3C,CAACkT,GAAD,SAACA,EAAc9F,eAAf,wBAAC,EAA2BpN,GAAIwT,IAEnCjM,oBAAU,UAAM,CACdmM,MACC,CAACA,KAEAP,EAAO3V,QACF,uBAIP,qCACE,cAAC,IAAQ,KAAT,CAAc,MAAO,cAAC,IAAD,CAAkB,GAAG,iBAA1C,SACE,mBACE,SAAUgW,EACV,YAAa,cAAC,IAAD,CAAkB,GAAG,WAClC,QAASC,EACT,MAAOH,EACP,SAAU,SAACjS,EAAD,OAAOkS,GAAiBlS,QAGtC,uBACC7D,GAAW,CAAC4V,GAAsB,uBAClCA,GAAkB,MAAlBA,EAAoBU,YACnBV,EAAmBU,YAAY7T,IAAI,SAAC8R,EAAwBK,EAAzB,aACjC,gBAAC,KAAM,SAAP,WACGA,EAAI,GAAK,uBACV,cAAC,GAAD,CACE,uBAAwBL,EACxB,aAAc6B,GAAmB,GAC/BR,EAAmBU,eADY,mBACG,GAClC/B,EAAuBH,6BANRG,EAAuBH,2BAY9C,mBAAY,UAAZ,CAAsB,MAAO,CAAEuC,UAAW,UAA1C,SACE,cAAC,IAAD,CAAkB,GAAG,8B,4ECnOxB,YAAP,qC,uDAAO,WACL7P,EASAC,EAVK,oGAYEC,YAAO,oCACZF,SACAG,OAAQ,MACaC,SAAU,IAC3BH,GAAW,UAhBZ,qC,0CCqBM6P,GAAqB,UAAM,CACtC,MAA0C7W,mBAAoC,MAA9E,mBAAO8W,EAAP,KAAsBC,EAAtB,KACA,EAAkC/W,mBAA6B,IAA/D,mBAAOgX,EAAP,KAAkBC,EAAlB,KACA,EAAgCtP,cAAxBC,EAAR,EAAQA,oBACFsP,EAAMC,OAENC,EAA+B/U,kBACnC,iBACE2U,GAAUtU,IAAI,SAAC2U,EAAD,OAAY,CACxB5U,GAAI4U,EAAM5U,GACVH,MAAO,GAAF,OAAK+U,EAAMC,MAAM1Q,KAAjB,aAA0ByQ,EAAME,YAAY3Q,KAA5C,KACLf,MAAOsR,KAAOE,EAAM3D,WAAW8D,SAC/B1R,IAAKqR,KAAOE,EAAMI,SAASD,SAC3BE,WAAY,GAAF,OAAKL,EAAMM,MAAMzO,WAAjB,YAA+BmO,EAAMM,MAAMxO,WACrDyO,YAAaP,EAAMM,MAAM9T,MACzB8J,SAAU0J,EAAM1J,SAAS/G,KACzB0Q,MAAOD,EAAMC,MAAM1Q,KACnBiR,QAASR,EAAMQ,QAAQjR,KACvBkR,kBAAmBT,EAAMS,sBAE7B,CAACd,IAGGe,EAAc3X,sBAClB,SAACyF,EAAsBC,EAAuB,CAC5CkS,GAAkB,CAChBpQ,oBAAqBA,EACrBqQ,UAAWpS,EAAM2R,SACjBC,QAAS3R,EAAI0R,WACZ1L,KAAK,SAACvL,EAAa,CAChBA,EAAS8H,SACX4O,EAAa1W,EAAS8G,SAI5B,CAACO,IAGGsQ,EAAmB9X,sBAAY,SAACiX,EAA8B,CAClEN,EAAiBM,IAChB,IAEGc,EAAmB/X,sBAAY,UAAM,CACzC2W,EAAiB,OAChB,IAEGqB,EAAYhY,sBAAY,SAAC6E,EAAwB,CACrD,MAAIA,GAAKoT,OAAOnB,EAAK,OACZ,UAEFjS,EAAKqT,QAAQpB,EAAK,OAAS,UAAY,SAC7C,IAEGqB,EAAiBnY,sBACrB,SAAC6E,EAAwB,CACvB,GAAMuT,GAAiBpB,EAAOjR,OAAO,SAACkR,EAAD,OAAWF,MAAOE,EAAMxR,OAAOwS,OAAOpT,EAAM,SAEjF,MACE,qBAAI,UAAU,SAAd,SACGuT,EAAe9V,IAAI,SAAC2U,EAAD,OAClB,qBAAmB,QAAS,iBAAMa,GAAiBb,IAAnD,SACE,oBAAO,OAAQe,EAAUjB,KAAOE,EAAMxR,QAAS,KAAMwR,EAAM/U,SADpD+U,EAAM5U,SAOvB,CAACuU,IAGGyB,EAAoBrY,sBAAY,SAAC6E,EAAqBsL,EAAuB,CACjF,GAAM1K,GAAQsR,KAAOlS,GAAMyT,QAAQnI,GAAMoI,SAAS,EAAG,SAC/C7S,GAAMqR,KAAOlS,GAAM2T,MAAMrI,GAAMsI,IAAI,EAAG,SAC5Cd,EAAYlS,EAAOC,KAClB,IAEHkE,2BAAU,UAAM,CACd,GAAM8O,GAAmB3B,OAASuB,QAAQ,SACpCK,EAAiB5B,OAASyB,MAAM,SACtCb,EAAYe,EAAkBC,IAC7B,IAED,qCACE,mBAAY,MAAZ,CAAkB,MAAO,EAAzB,SACE,cAAC,IAAD,CAAkB,GAAG,WAAW,eAAe,eAGjD,oBAAU,eAAgBR,EAAgB,cAAeE,IAEzD,oBACE,KAAM3B,IAAkB,KACxB,MAAK,UAAKA,GAAL,YAAKA,EAAee,QAApB,aAAgCf,GAAhC,YAAgCA,EAAexU,OACpD,SAAU6V,EACV,OAAQ,KAJV,UAME,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,YAAY,eAAe,UADlD,KAC+DrB,GAD/D,YAC+DA,EAAeY,cAE9E,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,QAAQ,eAAe,UAD9C,KAC2DZ,GAD3D,YAC2DA,EAAec,eAE1E,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,QAAQ,eAAe,UAD9C,KAC2Dd,GAD3D,YAC2DA,EAAeQ,SAE1E,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,WAAW,eAAe,aADjD,KACiER,GADjE,YACiEA,EAAenJ,YAEhF,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,aAAa,eAAe,eADnD,IAEGmJ,GAAiBK,KAAOL,EAAcjR,OAAO0H,OAAOyL,QAEvD,oBAAY,UAAZ,WACE,cAAC,IAAD,CAAkB,GAAG,SAAS,eAAe,aAD/C,IAEGlC,GAAiBK,KAAOL,EAAchR,KAAKyH,OAAOyL,QAEpDlC,IAAa,KAAb,OAAAA,EAAegB,oBACd,mBAAY,UAAZ,UACE,mBACE,KAAMhB,EAAcgB,kBACpB,OAAO,SACP,IAAI,aAHN,SAME,oBAAQ,KAAK,UAAb,SACE,cAAC,IAAD,CAAkB,GAAG,eAHnB,sB,gFC/ILmB,GAA2B,SAACC,EAAmBjK,EAApB,OACtCiK,GAAM1V,OAAsB,SAACC,EAAD,EAA+B,IAAvB8E,GAAuB,EAAvBA,QAAY4Q,EAAW,mBACnDnW,EAASuF,EAAQ7E,KAAK,SAAC0V,EAAD,OAAgBA,GAAW7R,UAAY0H,IACnE,MAAKjM,GAEE,GAAP,mBAAWS,GAAX,4BAAqB0V,GAArB,IAA2BnW,aAFPS,GAGnB,KAEQ4V,GAAmB,SAC9BC,EACAC,EACW,OACX,EAA0BD,EAAa9V,OACrC,SAACC,EAAD,MAAQT,GAAR,EAAQA,OAAQgJ,EAAhB,EAAgBA,OAAhB,MAA6B,CAACvI,EAAI,GAAKT,EAAOA,OAASgJ,EAAQvI,EAAI,GAAKuI,IACxE,CAAC,EAAG,IAFN,mBAAOwN,EAAP,KAAYC,EAAZ,KAIMC,EAAkB9V,OAAOgI,MAAM4N,EAAMC,GAAc,EAAID,EAAMC,EAE7DE,EAAoBJ,EACvBpL,KAAK,SAAC6F,EAAGC,EAAJ,OAAUD,GAAE0C,YAAczC,EAAEyC,cACjClT,OACC,SAACC,EAAKiM,EAAN,6BACKjM,GADL,aAAC,eAGMiM,GAHP,IAIIkK,yBAA0BF,GAAmBhK,EAAKgH,iBAGtD,IAGJ,GAAIiD,EAAkBnN,MAAM,eAAGoN,GAAH,EAAGA,yBAAH,MAAkCA,KAA2B,SACvF,YAAOD,EAAkBE,GAAG,OAA5B,wBAAO,EAA0BjT,QAAjC,mBAAyC,GAG3C,GAAMkT,GAAkBH,EAAkBI,UACxC,eAAGH,GAAH,EAAGA,yBAAH,MAAkC,CAACA,IAErC,MAAIE,GAAkB,EAAU,GAEhC,GAAOH,EAAkBG,EAAkB,MAA3C,wBAAO,EAAwClT,MAGpCoT,GAAgC,SAC3C3F,EACA4F,EAF2C,gBAI3CA,EAAYvW,KACV,SAAC8Q,EAAD,OACEA,GAAuBH,0BAA4BA,OANZ,wBAI3C,EAGGO,O,mBCtCE,YAAwBzM,EAAkBZ,EAAiB,CAChE,MAAsCvH,mBAA0C,CAC9EC,QAAS,KADX,mBAAOia,EAAP,KAAoBC,EAApB,KAIAnQ,2BAAU,UAAM,CACdmQ,EAAe,SAAC3H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OAC9Cma,GAAmBjS,EAAUZ,GAC1BuE,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACX8R,EAAe,SAAC3H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,KAAM9G,EAAS8G,WAGvD8E,QAAQ,UAAM,CACbgO,EAAe,SAAC3H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,UAEjD,CAACsH,EAASY,IAEN,CAAE+R,eAGJ,aAAyB,CAC9B,MAAoCla,mBAAuC,CAAEC,QAAS,KAAtF,mBAAOoa,EAAP,KAAmBC,EAAnB,KAEAtQ,2BAAU,UAAM,CACdsQ,EAAc,SAAC9H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OAC7Csa,KACGzO,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACXiS,EAAc,SAAC9H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,KAAM9G,EAAS8G,WAGtD8E,QAAQ,UAAM,CACbmO,EAAc,SAAC9H,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,UAEhD,IAEI,CAAEoa,cAGJ,YAA+BhG,EAA6C,CACjF,MAAoDrU,mBAElD,CACAC,QAAS,KAHX,mBAAOua,EAAP,KAA2BC,EAA3B,KAMAzQ,2BAAU,UAAM,CACVqK,IAA4B1L,QAEhC8R,GAAsB,SAACjI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OACrDya,GAAsBrG,GACnBvI,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACXoS,EAAsB,SAACjI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,KAAM9G,EAAS8G,WAG9D8E,QAAQ,UAAM,CACbsO,EAAsB,SAACjI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,WAExD,CAACoU,IAEG,CAAEmG,sBAGJ,YACL5S,EACAwM,EACAC,EACA,CACA,MAAgDrU,mBAAwC,CACtFC,QAAS,KADX,mBAAOsZ,EAAP,KAAyBoB,EAAzB,KAIA3Q,2BAAU,UAAM,CAEZ,MAAOpC,IAAwB,UAC/B,MAAOwM,IAAa,UACpB,MAAOC,IAA4B,UAIrCsG,GAAoB,SAACnI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OACnDmW,GAAsBxO,EAAqBwM,GACxCtI,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACXsS,EAAoB,SAACnI,EAAD,4BAAC,eAChBA,GADe,IAElBnL,KAAI,GAAE2S,GACJ3F,EADiC,GAEjC9T,EAAS8G,KAAKkP,eAFmB,mBAEJ,OAF3B,wBAAE,EAGH7T,IAAI,SAACoB,EAAG+Q,EAAJ,oBAAC,eAAe/Q,GAAhB,IAAmBrB,GAAIoS,YAInC1I,QAAQ,UAAM,CACbwO,EAAoB,SAACnI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,WAEtD,CAAC2H,EAAqBwM,IAElB,CAAEmF,oBAGJ,YAAoCpR,EAAkBZ,EAAiB,CAC5E,MAA8DvH,mBAE5D,CAAEC,QAAS,KAFb,mBAAO2a,EAAP,KAAgCC,EAAhC,KAIMC,EAA+B1a,sBAAY,UAAM,CACrDya,EAA2B,SAACrI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OAC1D6T,GAAwB3L,GACrB2D,KAAK,SAACvL,EAAa,CAClB,GAAIA,EAAS8H,QAAS,CACpB,GAAM0S,GAAoBxa,EAAS8G,KAAK7D,OACtC,SAACC,EAAD,EAAmC,IAA3BgN,GAA2B,EAA3BA,YAAgBuK,EAAW,mBAC3BtK,EAAaD,EAAY/M,KAC7B,SAACuX,EAAD,OAAoBA,GAAe1T,UAAYA,IAGjD,MAAKmJ,GAEE,GAAP,mBAAWjN,GAAX,4BAAqBuX,GAArB,IAA2BtK,iBAFHjN,GAI1B,IAGFoX,EAA2B,SAACrI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,KAAM0T,SAG1D5O,QAAQ,UAAM,CACb0O,EAA2B,SAACrI,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,UAE7D,CAACkI,EAAUZ,IAEdyC,2BAAU,UAAM,CACd8Q,KACC,CAACA,IAEG,CAAEF,0BAAyBE,gCAG7B,YAAyB7L,EAAoBrH,EAAoC,CACtF,MAAwC5H,mBAAqC,CAAEC,QAAS,KAAxF,mBAAOqZ,EAAP,KAAqB4B,EAArB,KAEAlR,2BAAU,UAAM,CACV,CAACpC,GACLsT,GAAgB,SAAC1I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OAC/CuO,EAAS,CAAES,aAAYrH,wBACpBkE,KAAK,SAACvL,EAAa,CAClB,GAAIA,EAAS8H,QAAS,CACpB,GAAMhB,GAAO4R,GAAyB1Y,EAAS8G,KAAM4H,GAErDiM,EAAgB,SAAC1I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,cAGzC8E,QAAQ,UAAM,CACb+O,EAAgB,SAAC1I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,WAElD,CAACgP,EAAYrH,IAET,CAAE0R,gBAGJ,YAA6BnR,EAAkBZ,EAAiB,CACrE,MAAsCvH,mBAAoC,CACxEC,QAAS,KADX,mBAAOkb,EAAP,KAAoBC,EAApB,KAGA,EAAgDpb,mBAO9C,CAAEC,QAAS,KAPb,mBAAOob,EAAP,KAAyBC,EAAzB,KAQA,EAAkDtb,mBAEhD,CAAEC,QAAS,KAFb,mBAAOsb,EAAP,KAA0BC,EAA1B,KAIAxR,2BAAU,UAAM,CACdoR,EAAe,SAAC5I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OAC9Cwb,aAAO,CAAEtT,aACN2D,KAAK,SAACvL,EAAa,CACdA,EAAS8H,SACX+S,EAAe,SAAC5I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBnL,KAAM9G,EAAS8G,WAGvD8E,QAAQ,UAAM,CACbiP,EAAe,SAAC5I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,UAEjD,CAACkI,IAEJ6B,oBAAU,UAAM,CACV,CAACmR,EAAY9T,MAEjBmU,GAAqB,SAAChJ,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OACpDkT,QAAQC,IAAI+H,EAAY9T,KAAK3E,IAAI,eAAGD,GAAH,EAAGA,GAAH,MAAYiZ,cAAQ9X,OAAOnB,OACzDqJ,KAAK,SAAC6P,EAAc,CACnBA,EAAUzR,QAAQ,SAAC3J,EAAa,CAC1BA,EAAS8H,SACXmT,EAAqB,SAAChJ,EAAD,oBAAC,eACjBA,GADgB,IAEnBnL,KAAM,2BACDmL,EAAKnL,MADN,mBAEDzD,OAAOrD,EAAS8G,KAAK5E,IAAMmZ,aAAcrb,EAAS8G,KAAKwU,mBAMjE1P,QAAQ,UAAM,CACbqP,EAAqB,SAAChJ,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,SAGxDqb,EAAoB,SAAC9I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,OACnDkT,QAAQC,IACN+H,EAAY9T,KAAK3E,IAAI,eAAGD,GAAH,EAAGA,GAAH,MACnBqZ,cAAelY,OAAOnB,GAAK,CACzB,oDACA,sDACCqJ,KAAK,SAACvL,EAAa,CACpB,GAAIA,EAAS8H,QAAS,SACd0T,EAAiB,IACrBxb,EAAS8G,KAAK,wDADO,mBACiD,IACtElB,OAAO,SAAC5C,EAAD,OAAcA,GAASd,KAAO8E,IAEjCyU,EAAc,GAClBzb,EAAS8G,KAAK,wDADI,mBACoD,GAExEiU,EAAoB,SAAC9I,EAAD,oBAAC,eAChBA,GADe,IAElBnL,KAAM,2BACDmL,EAAKnL,MADN,mBAEDzD,OAAOnB,GAAM,CAAEsZ,iBAAgBC,8BAM1C7P,QAAQ,iBAAMmP,GAAoB,SAAC9I,EAAD,oBAAC,eAAeA,GAAhB,IAAsBvS,QAAS,WAClE,CAACkb,EAAY9T,KAAME,IAEf,CAAE4T,cAAaE,mBAAkBE,qBC3N1C,GAAMU,IAAwD,CAC5D,CACE3Z,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,SAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,WAC5BC,UAAW,QAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,gBAC5BC,UAAW,cACXkI,UAAW,YAITyR,GAAkE,CACtE,CACE5Z,MAAO,cAAC,IAAD,CAAkB,GAAG,SAC5BC,UAAW,YACXC,OAAQ,SAACgO,EAAIzN,EAAL,OAAawK,cAAO,GAAIC,MAAKzK,EAAI2Q,WAAYjG,QAInD0O,GAAiD,CACrD,CACE7Z,MAAO,cAAC,IAAD,CAAkB,GAAG,SAC5BC,UAAW,SAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,qCAAqC,eAAe,WAChFC,UAAW,SACXkI,UAAW,WAEb,CACEnI,MAAO,cAAC,IAAD,CAAkB,GAAG,aAAa,eAAe,eACxDC,UAAW,aACXC,OAAQ,SAACgO,EAAIzN,EAAL,OAAawK,cAAO,GAAIC,MAAKzK,EAAI2K,YAAaD,OAExD,CACEnL,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,SACXC,OAAQ,SAACgO,EAAIzN,EAAL,iBAAgBA,EAAIC,OAAOA,OAA3B,QAINoZ,GAAwD,CAC5D,CACE9Z,MAAO,cAAC,IAAD,CAAkB,GAAG,SAC5BC,UAAW,QAEb,CACED,MAAO,cAAC,IAAD,CAAkB,GAAG,cAC5BC,UAAW,QACXC,OAAQ,SAACgO,EAAIzN,EAAL,eACN,GAAAA,EAAI0T,SAAJ,oBAAW4F,WAAa9O,aAAO,GAAIC,MAAJ,GAASzK,EAAI0T,SAAb,wBAAS,EAAW4F,YAAa5O,KAAc,MAElF,CACEnL,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,QACXC,OAAQ,SAACgO,EAAIzN,EAAL,qBAAaA,EAAI0T,SAAjB,wBAAa,EAAW6F,cAAxB,mBAAsC,OAI5CC,GAAkB,EAEXC,GAAsC,SAAC,EAA0B,aAAxBjV,EAAwB,EAAxBA,QAASY,EAAe,EAAfA,SAC7D,EAAgCR,cAAxBC,EAAR,EAAQA,oBACR,EAAyB6U,GAAgBlV,EAASK,GAA1C0R,EAAR,EAAQA,aACR,EAAwBoD,GAAevU,EAAUZ,GAAzC2S,EAAR,EAAQA,YACR,EAAuByC,KAAftC,EAAR,EAAQA,WACR,EAA+BuC,GAAqB,GAAC1C,EAAY7S,QAAb,wBAAC,EAAkBgN,yBAA/DmG,EAAR,EAAQA,mBACR,EAA6BqC,GAC3BjV,EAD8C,GAE9CsS,EAAY7S,QAFkC,wBAE9C,EAAkB+M,SAF4B,GAG9C8F,EAAY7S,QAHkC,wBAG9C,EAAkBgN,yBAHZkF,EAAR,EAAQA,iBAKR,EAAkEuD,GAChE3U,EACAZ,GAFMqT,EAAR,EAAQA,wBAAyBE,GAAjC,EAAiCA,6BAIjC,GAA6DiC,GAC3D5U,EACAZ,GAFM4T,EAAR,GAAQA,YAAaE,EAArB,GAAqBA,iBAAkBE,EAAvC,GAAuCA,kBAKvC,EAAetQ,IAAQC,UAAvB,oBAAOC,GAAP,MAEM6R,GAA0B3a,kBAC9B,uBAAM,IAACgY,EAAWhT,QAAZ,mBAAoB,IAAI3E,IAAI,eAAGD,IAAH,EAAGA,GAAImE,GAAP,EAAOA,KAAP,MAAmB,CAAEnB,MAAOmB,GAAMC,MAAOpE,OAC3E,CAAC4X,EAAWhT,OAGR4V,GAAsB5a,kBAC1B,uBACE,IAACmY,EAAmBnT,QAApB,mBAA4B,IAAI3E,IAAI,eAAGkE,IAAH,EAAGA,KAAMnE,GAAT,EAASA,GAAT,MAAmB,CACrDgD,MAAOmB,GACPC,MAAOpE,OAEX,CAAC+X,EAAmBnT,OAGhB6V,EAAgB7a,kBACpB,yBAAMgX,IAAgB,GAACC,EAAajS,QAAd,mBAAsB,GAAtB,GAA0BkS,EAAiBlS,QAA3C,mBAAmD,KACzE,CAACiS,EAAajS,KAAMkS,EAAiBlS,OAGjC8V,GAAqB/c,sBAAW,gDACpC,wHAASgd,GAAT,GAASA,eAAgBC,GAAzB,GAAyBA,cACnB,KAAAnD,EAAY7S,QAAZ,4BAAkB5E,MAAOkG,OAD/B,sDAGQ2U,GAHR,IAG6BpD,EAAY7S,QAHzC,yBAG6B,GAAkBkW,OAAO7Z,KAClD,gBAAG8Z,IAAH,GAAGA,WAAH,MAAoBA,IAAW/a,KAAO4a,KAJ1C,CAOMC,GAPN,mCAQ2BG,GAAiBH,GAAmB7a,GAAI,CAAE2a,wBARrE,GAQU7c,UARV,QAUI,GAAQ,EAAAA,GAAS8H,QAAU,UAAY,SAAS9H,GAASsK,SACrDtK,GAAS8H,SACXsE,IAAQC,KAAR,4BAAkChF,EAAlC,kBAZN,8CAiByB8V,GAAiB,CACtCN,kBACAC,iBACAM,qBAAsBzD,EAAY7S,KAAK5E,SApB3C,IAiBQlC,GAjBR,QAuBE,GAAQ,EAAAA,GAAS8H,QAAU,UAAY,SAAS9H,GAASsK,SAErDtK,GAAS8H,SACXsE,IAAQC,KAAR,4BAAkChF,EAAlC,sBA1BJ,uCADoC,sDA8BpC,CAACsS,EAAY7S,KAAMO,IAGfgW,GAA8Cvb,kBAClD,uBACE,IAACgY,EAAWhT,QAAZ,mBAAoB,IAAI3E,IAAI,SAACmb,EAAD,2BAAC,eACxBA,GADuB,IAE1BpH,MAAK,IAAEyD,EAAY7S,QAAd,yBAAE,GAAkBkW,OAAO7Z,KAAK,gBAAG8Z,IAAH,GAAGA,WAAH,MAAoBA,IAAW/a,KAAOob,EAAKpb,UAEpF,CAACyX,EAAY7S,KAAMgT,EAAWhT,OAG1ByW,GACH3C,EAAYlb,SAAW,CAACkb,EAAY9T,MACpCgU,EAAiBpb,SAAW,CAACob,EAAiBhU,MAC9CkU,EAAkBtb,SAAW,CAACsb,EAAkBlU,KAE7C0W,GAAyB1R,QAC7B8O,EAAY9T,MAAQgU,EAAiBhU,MAAQkU,EAAkBlU,MAGjE,MAAI6S,GAAYja,QACP,uBAIP,qCACGia,EAAY7S,MACX,qCACE,mBAAY,KAAZ,CAAiB,MAAO,CAAE2W,SAAU,OAAQC,WAAY,KAAxD,SACE,cAAC,IAAD,CACE,GAAG,sCACH,OAAQ/D,EAAY7S,KAAK6W,SAG7B,0BAGJ,qBAAK,OAAQ,CAAC,GAAI,IAAK,QAAQ,gBAA/B,UACE,mBAAK,KAAM,GAAX,SACE,cAAC,IAAD,CACE,OAAO,KACP,YAAa,cAAC,IAAD,CAAkB,GAAG,qDAClC,OAAQ,GACR,WAAY,CAAE7P,SAAUkO,IACxB,WAAYjD,EAAajS,KACzB,QAASiS,EAAarZ,QACtB,QAASkc,GACT,QAAS,GACT,UAAW,CAAEpP,UAAW,CAAEkI,QAAS,QAGvC,mBAAK,KAAM,GAAX,SACE,cAAC,IAAD,CACE,OAAO,KACP,YAAa,cAAC,IAAD,CAAkB,GAAG,4CAClC,OAAQ,GACR,WAAY,CAAE5G,SAAUkO,IACxB,WAAYqB,GACZ,QAAS1D,EAAYja,SAAWoa,EAAWpa,QAC3C,QAASmc,GACT,QAAS,GACT,UAAW,CAAErP,UAAW,CAAEkI,QAAS,QAGvC,mBAAK,KAAM,GAAX,SACE,cAAC,IAAD,CACE,OAAO,KACP,YAAa,cAAC,IAAD,CAAkB,GAAG,4CAClC,OAAQ,GACR,QAAS,GACT,WAAY,CAAE5G,SAAUkO,IACxB,UAAW,CAAExP,UAAW,CAAEkI,QAAS,IACnC,WAAY2F,EAAwBvT,KACpC,QAASuT,EAAwB3a,QACjC,QAAO,UACFic,GADE,CAEL,CACE5Z,MAAO,cAAC,IAAD,CAAkB,GAAG,2CAC5BC,UAAW,aACXC,OAAQ,SAACgO,EAAIzN,GAAL,OACN,eAAC,GAAD,CACE,0BAA2BA,GAAIN,GAC/B,UAAW8E,EACX,WAAYxE,GAAI2N,WAAW7J,MAC3B,UAAWiU,aAOvB,mBAAK,KAAM,GAAX,SACE,cAAC,IAAD,CACE,OAAO,KACP,YAAa,cAAC,IAAD,CAAkB,GAAG,4CAClC,OAAQ,GACR,QAAS,GACT,WAAY,CAAEzM,SAAUkO,IACxB,UAAW,CAAExP,UAAW,CAAEkI,QAAS,IACnC,WAAYsE,EAAiBlS,KAC7B,QAASkS,EAAiBtZ,QAC1B,QAASgc,OAGZ6B,IAAwB,uBACxBC,IAAsB,IACrB5C,EAAY9T,QADS,wBACrB,EAAkB3E,IAAI,uCAAGD,GAAH,EAAGA,GAAIH,GAAP,EAAOA,MAAP,MACpB,qBAAc,KAAM,GAApB,UACE,mBAAY,KAAZ,CAAiB,MAAO,CAAE0b,SAAU,OAAQC,WAAY,KAAxD,SACG3b,KAEH,cAAC,KAAD,CACE,UAAWsB,OAAOnB,IAClB,OAAM,OAAE8Y,EAAkBlU,QAApB,yBAAE,GAAyBzD,OAAOnB,QAAlC,mBAA0C,GAChD,MAAK,QAAE4Y,EAAiBhU,QAAnB,uBAAE,GAAwBzD,OAAOnB,QAAjC,yBAAE,GAAqCsZ,kBAAvC,qBAAyD,KAEhE,cAAC,KAAD,CACE,MAAK,QAAEV,EAAiBhU,QAAnB,uBAAE,GAAwBzD,OAAOnB,QAAjC,yBAAE,GAAqCuZ,kBAAvC,qBAAyD,OAVxDvZ,UAehB,cAAC,IAAD,CAAmB,KAAM0I,GAAM,SAAUgS,GAAzC,SACE,eAAC,IAAQ,MAAT,CACE,MAAO,CAAEgB,QAAS,OAAQC,cAAe,SAAUC,WAAY,QAC/D,MAAO,cAAC,IAAD,CAAkB,GAAG,gDAC5B,WAAY,CAAEC,KAAM,SACpB,MAAM,SAJR,UAME,cAAC,KAAD,CACE,KAAK,gBACL,MAAO,CAAC,CAAE1T,SAAU,GAAMC,QAAS,cAAC,IAAD,CAAkB,GAAG,qBACxD,MAAO,cAAC,IAAD,CAAkB,GAAG,0CAC5B,QAASmS,GACT,MAAM,KACN,WAAY,CAAE/c,QAASoa,EAAWpa,WAEpC,cAAC,KAAD,CACE,KAAK,iBACL,MAAO,CAAC,CAAE2K,SAAU,GAAMC,QAAS,cAAC,IAAD,CAAkB,GAAG,qBACxD,MAAO,cAAC,IAAD,CAAkB,GAAG,2CAC5B,QAASoS,GACT,WAAY,CAAEhd,QAASia,EAAYja,SAAWua,EAAmBva,WAEnE,cAAC,IAAQ,KAAT,UACE,cAAC,IAAD,CACE,GAAG,4CACH,OAAQ,CAAEwW,MAAOyG,gBC/SzB3S,GAAkD,CACtD,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,eAC5BC,UAAW,aACXC,OAAQ,SAACgO,EAAIzN,EAAL,OAAaA,GAAImb,KAAKhV,aAEhC,CACE5G,MAAO,cAAC,IAAD,CAAkB,GAAG,cAC5BC,UAAW,YACXC,OAAQ,SAACgO,EAAIzN,EAAL,OAAaA,GAAImb,KAAK/U,YAEhC,CACE7G,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5B2K,aAAc,GACd1K,UAAW,SACXC,OAAQ,SAACgO,EAAIzN,EAAL,OACN,sBAAK,MAAO,CAAEob,QAAS,OAAQC,cAAe,SAAUG,IAAK,OAA7D,SACGxb,EAAIwa,OAAO/U,OACRzF,EAAIwa,OAAO7a,IAAI,eAAG4Z,GAAH,EAAGA,WAAYkB,EAAf,EAAeA,WAAY/a,EAA3B,EAA2BA,GAA3B,MACb,qBAAY,KAAZ,WACG+a,EAAW5W,KADd,KACsB0V,IADA7Z,KAIxB,SAMC+b,GAA4B,UAAM,SACvCxQ,EAAWC,cACjB,EAA8B5L,kBAC5B,6BAAO,CACLkF,QAAS3D,OAAOgI,MAAMhI,OAAM,GAACoK,EAASE,SAAV,wBAAC,EAAgB3G,UACzC,KACA3D,OAAM,GAACoK,EAASE,SAAV,wBAAC,EAAgB3G,SAC3BY,SAAUvE,OAAOgI,MAAMhI,OAAM,GAACoK,EAASE,SAAV,wBAAC,EAAgB/F,WAC1C,KACAvE,OAAM,GAACoK,EAASE,SAAV,wBAAC,EAAgB/F,YAG7B,IAAC6F,EAASE,SAAV,wBAAC,EAAgB3G,QAAjB,GAA0ByG,EAASE,SAAnC,wBAA0B,EAAgB/F,WAVpCZ,EAAR,EAAQA,QAASY,EAAjB,EAAiBA,SAajB,EAAoDR,cAA5CE,EAAR,EAAQA,mBAAoBD,EAA5B,EAA4BA,oBAEtBI,EAAe3F,kBACnB,uBAAM,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CAAEnB,MAAOmB,EAAMC,MAAOpE,MACtF,CAACoF,GAAD,YAACA,EAAoBI,SAGvB,MAAIV,KAAY,MAAQY,IAAa,KAC5B,cAAC,GAAD,CAAoB,QAASZ,EAAS,SAAUY,IAIvD,cAAC,IAAD,CACE,UAAU,mBACV,OAAO,KACP,OAAQ,CAAEnC,OAAQ,YAClB,QAAO,gDAAE,6HAASmC,SAAUsW,EAAnB,WAA+B,GAA/B,MAAmCvV,aAAnC,WAAgD,GAAhD,MAAoDC,YAApD,WAAgE,GAAhE,EACDuV,EAAY,IAAC7W,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAH,MAAYA,KAD9D,SAGgBkc,GAAoBF,EAAUjW,SAAW,EAAIkW,EAAYD,OAHzE,MAGDle,GAHC,OAKFA,GAAS8H,QALP,yCAME,CAAEA,QAAS,GAAO+E,MAAO,EAAG/F,KAAM,SANpC,GAUDA,UAAO9G,GAAS8G,KAAKlB,OACzB,eAAG+X,GAAH,EAAGA,KAAH,MACEA,GAAKhV,WAAWiH,cAAc/F,SAASlB,EAAWiH,gBAClD+N,EAAK/U,UAAUgH,cAAc/F,SAASjB,EAAUgH,iBAb7C,kBAgBA,CAAE9H,QAAS,GAAM+E,MAAO/F,GAAKmB,OAAQnB,cAhBrC,qCAAF,sDAkBP,QAAO,CACL,CACE/E,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,WACXkI,UAAW,SACX6F,WAAY,CACVtJ,QAASgB,EACTuI,KAAM,YAER/N,OAAQ,SAACgO,EAAIzN,EAAL,OACN,eAAC,KAAD,CAAqC,KAAK,WAAW,QAASA,EAAIoF,UAA3CpF,EAAIoF,aAV1B,OAaFoC,GAbE,CAcL,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,YAC5B2K,aAAc,GACdzK,OAAQ,SAACgO,EAAIzN,EAAL,OAAa,CACnB,cAAC,KAAD,CAEE,GAAE,4BAAuB6E,EAAvB,iCAAmE7E,EAAImb,KAAKzb,GAA5E,qBAA2FM,EAAIoF,UAFnG,SAIE,oBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,SAArC,SACE,oBAAQ,KAAK,UAAU,KAAM,cAAC,KAAD,SAJ3B,gB,+FCtGZyW,GAA4C,SAAC,EAAD,IAAGC,GAAH,EAAGA,IAAH,MAChD,qBAAS,MAAO,cAAC,IAAD,CAAkB,GAAG,aAArC,SACE,oBACE,KAAK,UACL,QAAS,UAAM,CACbhe,OAAO6I,KAAKmV,EAAK,SAAU,wBAE7B,KAAM,cAAC,KAAD,SAKNtU,GAA6D,CACjE,CACEjI,MAAO,cAAC,IAAD,CAAkB,GAAG,OAC5BC,UAAW,KACX0K,aAAc,IAEhB,CACE3K,MAAO,cAAC,IAAD,CAAkB,GAAG,eAC5BC,UAAW,aACX0K,aAAc,GACdzK,OAAQ,SAACgO,EAAI1D,EAAL,OAAgBS,cAAO,GAAIC,MAAKV,EAAOY,YAAaoR,OAE9D,CACExc,MAAO,cAAC,IAAD,CAAkB,GAAG,eAC5BC,UAAW,aACXwc,eAAgB,SAACC,EAAD,EAAyC7T,EAAS,IAAzCxI,GAAyC,EAAzCA,KAAMsc,EAAmC,EAAnCA,cAAkBjE,EAAiB,mBAChE,GAAIrY,IAAS,OACX,MAAO,MAET,GAAMuc,GAAY/T,EAAKgU,cAAc,SACrC,MACE,eAAC,KAAD,2BACMnE,GADN,IAEE,MAAO,CACLrY,KAAMuc,OAKd1c,OAAQ,SAACgO,EAAI1D,EAAL,OACN,eAAC,KAAD,CAEE,KAAK,gCACL,QAASA,EAAOsS,WAAW3c,IAFtBqK,EAAOsS,WAAW3c,MAM7B,CACEH,MAAO,cAAC,IAAD,CAAkB,GAAG,gBAC5BC,UAAW,cACX0K,aAAc,GACdzK,OAAQ,SAACgO,EAAI1D,EAAL,OAAgBS,cAAO,GAAIC,MAAKV,EAAOuS,aAAcP,OAE/D,CACExc,MAAO,cAAC,IAAD,CAAkB,GAAG,gBAC5BC,UAAW,cACXwc,eAAgB,SAACC,EAAD,EAAyC7T,EAAS,IAAzCxI,GAAyC,EAAzCA,KAAMsc,EAAmC,EAAnCA,cAAkBjE,EAAiB,mBAChE,GAAIrY,IAAS,OACX,MAAO,MAET,GAAMuc,GAAY/T,EAAKgU,cAAc,SACrC,MACE,eAAC,KAAD,2BACMnE,GADN,IAEE,MAAO,CACLrY,KAAMuc,OAKd1c,OAAQ,SAACgO,EAAI1D,EAAL,OACN,eAAC,KAAD,CAEE,KAAK,gCACL,QAASA,EAAOwS,YAAY7c,IAFvBqK,EAAOwS,YAAY7c,MAM9B,CACEH,MAAO,cAAC,IAAD,CAAkB,GAAG,YAC5BC,UAAW,UACX0K,aAAc,IAEhB,CACE3K,MAAO,cAAC,IAAD,CAAkB,GAAG,YAC5BmI,UAAW,SACXjI,OAAQ,SAACgO,EAAI1D,EAAL,OAAgB,CAAC,cAAC,GAAD,CAA+B,IAAKA,EAAO+R,KAAvB,gBAIpCU,GAA+B,UAAM,SAChD,EAA+B5X,cAAvBE,EAAR,EAAQA,mBAEFG,EAAe3F,kBACnB,uBAAM,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CAAEC,MAAOpE,EAAIgD,MAAOmB,MACpF,CAACiB,GAAD,YAACA,EAAoBI,SAGjB7F,EAAuDC,kBAC3D,0BACE,CACEC,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,WACX6N,YAAa,GACb3F,UAAW,SACX6F,WAAY,CACVtJ,QAASgB,EACT8K,aAAcjL,GAAF,SAAEA,EAAoBI,UAAtB,qBAAE,EAA6B,MAA/B,wBAAE,EAAiCxF,GAC/CsQ,WAAY,MATlB,OAYKxI,KAEL,CAAC1C,GAAD,SAACA,EAAoBI,UAArB,qBAAC,EAA6B,MAA9B,wBAAC,EAAiCxF,GAAIuF,IAGxC,MACE,eAAC,IAAD,CACE,UAAU,mBACV,QAAO,gDAAE,qHACPG,WADO,WACIN,GADJ,SACIA,EAAoBI,UADxB,qBACI,EAA6B,MADjC,wBACI,EAAiCxF,GADrC,EAEP2c,EAFO,EAEPA,WACAE,EAHO,EAGPA,YAHO,SAKgBE,aAAqB,CAAErX,WAAUiX,aAAYE,oBAL7D,MAKD/e,EALC,OAOFA,EAAS8H,QAPP,yCAQE,CAAEA,QAAS,GAAOhB,KAAM,GAAI+F,MAAO,QARrC,4BAWA,CAAE/E,QAAS,GAAMhB,KAAM9G,EAAS8G,KAAM+F,MAAO7M,EAAS8G,KAAKmB,aAX3D,qCAAF,sDAaP,QAASpG,EACT,OAAQ,CAAE4D,OAAQ,YAClB,OAAQ,CAAEjC,EAAG,SCzIb0b,GAAkB,SACtBC,EACA9Y,EAFsB,gBAGC8Y,EAAYhc,KAAK,SAACkR,EAAD,OAAWA,GAAMhO,OAASA,OAH5C,wBAGC,EAAkDnE,IAE9Dkd,GAAoC,SAAC,EAK5C,IAJJ9B,GAII,EAJJA,KACA6B,EAGI,EAHJA,YACAE,EAEI,EAFJA,kBACA1F,EACI,EADJA,YAEA,EAAwCla,mBAAS4f,GAAjD,mBAAOC,EAAP,KAAqBC,EAArB,KAEA,EAA8B9f,mBAAS,IAAvC,mBAAOC,EAAP,KAAgBC,EAAhB,KAEM8G,EAAU3E,kBACd,iBAAMqd,GAAYhd,IAAI,eAAGkE,GAAH,EAAGA,KAAMnE,EAAT,EAASA,GAAT,MAAmB,CAAEoE,MAAOpE,EAAIgD,MAAOmB,MAC7D,CAAC8Y,IAGGvL,EAAW/T,sBACf,SAACgd,EAA2B,CAC1B,GAAI,EAAClD,IAAD,MAACA,EAAazX,IAElB,IAAIod,EAAc,CAChB3f,EAAW,IACXud,GAAiBoC,EAAapd,GAAI,CAChC2a,mBACCjR,QAAQ,iBAAMjM,GAAW,MAC5B,OAGFA,EAAW,IACXwd,GAAiB,CACfL,cAAeQ,EAAKpb,GACpB2a,iBACAO,qBAAsBzD,EAAYzX,KAEjCqJ,KAAK,SAACC,EAAQ,CACb,GAAIA,EAAI1D,QAAS,CACf,GAAM0X,GAAchU,EAAI1E,KAAKkW,OAAO7Z,KAAK,SAAC+S,EAAD,OAAWA,GAAM+G,WAAW/a,KAAOob,EAAKpb,KACjFqd,EAAgBC,MAGnB5T,QAAQ,iBAAMjM,GAAW,QAE9B,CAAC2f,EAAchC,EAAKpb,GAAIyX,GAAxB,YAAwBA,EAAazX,KAGvC,MAAKyX,GAGH,mBACE,QAASja,EACT,SAAUA,EACV,YAAa,cAAC,IAAD,CAAkB,GAAG,uBAClC,MAAO,CAAEqG,MAAO,QAChB,SAAU6N,EACV,QAASnN,EACT,aAAcyY,GAAgBC,EAAaE,GAAd,YAAcA,EAAmBtD,cAVzC,M,aCjDd0D,GAAkC,SAAC,EAA+C,IAA7C1Y,GAA6C,EAA7CA,QAAStE,EAAoC,EAApCA,OAAQiM,EAA4B,EAA5BA,WAAYrF,EAAgB,EAAhBA,UACvEuK,EAAW/T,sBACf6f,oBAAS,SAACpZ,EAAyB,CACjCqZ,GAAiB5Y,EAAS2H,EAAY,CAAEjM,OAAQ6D,GAAF,KAAEA,EAAS,IAAKiF,KAAK,SAACC,EAAQ,CACtEA,EAAI1D,SACNuB,IAAS,MAATA,EAAYmC,EAAI1E,UAGnB,KACH,CAACC,EAAStE,EAAQiM,IAGpB,MAAO,qBAAa,KAAK,SAAS,IAAK,EAAG,IAAK,IAAK,SAAUkF,EAAU,aAAcnR,KCP3Emd,GAAoB,SAC/BrM,EACuC,CACvC,GAAMpB,GAAcoB,EAAwBtQ,OAC1C,SAACC,EAAKiM,EAAN,6BACKjM,GADL,CAEE,CACEnB,MAAOiL,aAAO,GAAIC,MAAKkC,EAAKgE,WAAYjG,KACxClL,UAAW,cAAF,OAAgBmN,EAAKgE,WAC9BzG,aAAc,GACd3G,MAAO,IACPqN,MAAO,SACPnR,OAAQ,SAAC8K,EAAGR,EAAJ,OACN,eAAC,GAAD,CACE,0BAA2B4C,EAAKjN,GAChC,WAAYqK,EAAO,cAAD,OAAe4C,GAAf,YAAeA,EAAMgE,YACvC,UAAW5G,EAAOrK,UAK1B,IAGF,MAAKiQ,GAAYlK,OAGV,CACLlG,MAAO,cAAC,IAAD,CAAkB,GAAG,eAC5B2K,aAAc,GACdmT,SAAU1N,GALH,CAAEpQ,MAAO,cAAC,IAAD,CAAkB,GAAG,eAAiB2K,aAAc,GAAMmD,YAAa,KAS9EiQ,GAAwB,SACnCC,EACArR,EAFmC,OAInCqR,GAAyB9c,OAAO,SAACoM,EAAUkE,EAA4B,CACrE,GAAMC,GAAoBD,EAAwBrD,YAAY/M,KAC5D,SAACgN,EAAD,OAAgBA,GAAWnJ,UAAY0H,IAEzC,MAAK8E,GAEE,2BACFnE,GADL,wCAEiBkE,EAAwBJ,WAAcK,EAAkBlN,QAJ1C+I,GAM9B,KAGQ2Q,GAAe,SAACrH,EAA0D,CACrF,GAAMxG,GAAcwG,EAAM1V,OACxB,SAACC,EAAK0V,EAAN,6BACK1V,GADL,CAEE,CACElB,UAAW,QAAF,OAAU4W,EAAK1W,IACxBH,MAAO,cAAC,IAAD,CAAkB,GAAG,sBAAsB,OAAQ6W,IAC1DlM,aAAc,GACd3G,MAAO,IACP9D,OAAQ,SAACgO,EAAI1D,EAAL,aACNA,IAAM,MAAN,GAAAA,EAAM,eAAWqM,EAAK1W,QAAtB,0BAA6BO,UAAW2F,OACtC,cAAC,GAAD,CACE,OAAQmE,GAAF,YAAEA,EAAM,eAAWqM,EAAK1W,KAAMO,OACpC,QAASmW,EAAK1W,GACd,WAAYqK,EAAOrK,KAGrB,SAIR,IAGF,MAAKiQ,GAAYlK,OAGV,CAAElG,MAAO,cAAC,IAAD,CAAkB,GAAG,UAAY2K,aAAc,GAAMmT,SAAU1N,GAFtE,CAAEpQ,MAAO,cAAC,IAAD,CAAkB,GAAG,UAAY2K,aAAc,GAAMmD,YAAa,KAKzEoQ,GAAwB,SACnClH,EADmC,OAGnCA,GAAa9V,OACX,SAACoM,EAAD,MAAa5M,GAAb,EAAaA,OAAYsE,EAAzB,EAAqB7E,GAArB,mBAAC,eACImN,GADL,kCAEWtI,GAAYtE,KAEvB,KAISyd,GAAqB,SAChCpG,EACAG,EAFgC,OAGQ,CACxClY,MAAO,cAAC,IAAD,CAAkB,GAAG,iBAC5B2K,aAAc,GACdmT,SAAU/F,EAAW3X,IAAI,SAACmb,EAAD,OAAW,CAClCvb,MAAOub,EAAKjX,KACZqG,aAAc,GACd3G,MAAO,IACPqN,MAAO,SACPnR,OAAQ,SAACgO,EAAI1D,EAAL,OACN,eAAC,GAAD,CACE,kBAAmBA,EAAO,eAAD,OAAgB+Q,EAAKpb,KAC9C,YAAaqK,EAAO4T,aACpB,KAAM7C,EACN,YAAarD,UAMRmG,GAAwB,SACnCzG,EACAjL,EAFmC,OAInCiL,GAAYxW,KAAK,SAACkd,EAAD,OAAoBA,GAAe1C,KAAKzb,KAAOwM,KAErD4R,GAAiB,SAC5BC,EAD4B,aAG5B,IAACA,GAAD,YAACA,EAAmBvD,UAApB,mBAA8B,IAAI/Z,OAChC,SAACC,EAAKgT,EAAN,oBAAC,eAAqBhT,GAAtB,yCAA2CgT,EAAM+G,WAAW/a,IAAOgU,KACnE,KChHSsK,GAA0B,UAAM,SAC3C,EAAoDpZ,cAA5CE,EAAR,EAAQA,mBAAoBD,EAA5B,EAA4BA,oBAC5B,EAAsC5H,mBAA+C,IAArF,mBAAO0S,EAAP,KAAoBC,EAApB,KACA,EAAkD3S,mBAAS6H,GAAD,SAACA,EAAoBI,UAArB,qBAAC,EAA6B,MAA9B,wBAAC,EAAiCrB,MAA5F,mBAAOgM,EAAP,KAA0BC,EAA1B,KACMpO,EAAOC,cAEPsD,EAAe3F,kBACnB,uBAAM,IAACwF,GAAD,YAACA,EAAoBI,UAArB,mBAA+B,IAAIvF,IAAI,eAAGD,GAAH,EAAGA,GAAImE,EAAP,EAAOA,KAAP,MAAmB,CAAEC,MAAOpE,EAAIgD,MAAOmB,MACpF,CAACiB,GAAD,YAACA,EAAoBI,SAGjB6F,EAAYC,mBAEZ3L,EAAwBC,kBAC5B,wBACE,CACEC,MAAO,cAAC,IAAD,CAAkB,GAAG,UAC5BC,UAAW,WACX6N,YAAa,GACb3F,UAAW,SACX6F,WAAY,CACVtJ,QAASgB,EACT8K,aAAc9K,GAAF,SAAEA,EAAe,MAAjB,wBAAE,EAAmBnB,MACjCkM,WAAY,KAGhB,CACEzQ,MAAO,cAAC,IAAD,CAAkB,GAAG,iBAAiB,eAAe,qBAC5DC,UAAW,YACXyQ,MAAO,SAfX,mBAiBKN,KAEL,CAAC1K,EAAc0K,IAGjB,MACE,eAAC,IAAD,CACE,UAAU,mBACV,QAAO,gDAAE,uKAASvK,WAAT,cAAoBH,EAAa,MAAjC,wBAAoB,EAAiBnB,MAArC,OAA4CqM,aAA5C,YAAwD,GAAxD,aACsB8N,GAAsB7Y,OAD5C,MACD8Y,GADC,QAEDnZ,GAAgBE,EAAatE,KAAK,gBAAGmD,IAAH,GAAGA,MAAH,MAAeA,MAAUsB,IAF1D,CAIL,EAAC8Y,GAAe5Y,SAChB4Y,GAAe5Z,KAAK,KAAOsB,QAC3Bf,IAAwB,MANnB,iBAQL,YAAQtG,MACNmD,EAAK8B,cAAc,CAAE9D,GAAI,oBAAsB,CAAEqN,WAAYhI,IAAF,YAAEA,GAAerC,SATzE,mBAYE,CAAE4B,KAAM,GAAI+F,MAAO,EAAG/E,QAAS,SAZjC,qBAsBG8K,QAAQC,IAAI,CACpBC,aAAsBlL,GACtBmL,GAA6BnL,GAC7B+Y,EAAW,CAAE/Y,WAAUsG,SAAU,KACjC0S,GAAwBvZ,EAAD,IAAsBqZ,GAAe5Z,QAArC,uBAAsB,GAAsB,MAA5C,yBAAsB,GAA0B+M,UACvEgN,KACAC,GAAuB,GAACJ,GAAe5Z,QAAhB,qBAAC,EAAsB,MAAvB,wBAAC,EAA0BgN,+BA5B7C,qCAgBLd,GAhBK,MAiBLC,GAjBK,MAkBL8N,GAlBK,MAmBLC,EAnBK,MAoBLC,EApBK,MAqBLC,GArBK,OAgCL,EAAClO,GAAoBlL,SACrB,CAACmL,GAA2BnL,SAC5B,CAACiZ,GAASjZ,SACV,CAACkZ,EAAelZ,SAChB,CAACmZ,EAAcnZ,SACf,CAACoZ,GAAsBpZ,SACvB,CAACP,IAtCI,kBAwCL,YAAQxG,MACNmD,EAAK8B,cAAc,CAAE9D,GAAI,oBAAsB,CAAEqN,WAAYhI,IAAF,YAAEA,GAAerC,SAzCzE,mBA4CE,CAAE4B,KAAM,GAAI+F,MAAO,EAAG/E,QAAS,SA5CjC,IA8CPwK,SAAqB/K,GAAcrC,OAG7Bic,GAAiBvB,GAAkB3M,GAA2BnM,MAC9Dsa,GAAYpB,GAAae,GAASja,MAClCua,GAAiBnB,GAAmBe,EAAcna,KAAMoa,GAAsBpa,MAEpFsL,EAAe,CACb+O,GACAC,GACAC,GACA,CACEtf,MAAO,cAAC,IAAD,CAAkB,GAAG,mBAC5B2K,aAAc,GACd1K,UAAW,iBACXoR,MAAO,SACPrN,MAAO,OAILe,GAAOkM,GAAoBlM,KAAK4B,MACnCzF,OACC,SAACC,GAAD,GAA6D,cAArDhB,GAAqD,GAArDA,GAAI2G,GAAiD,GAAjDA,oBAAqBF,GAA4B,GAA5BA,WAAYC,GAAgB,GAAhBA,UACrCyK,GAAkB,GAAH,OAAMzK,GAAN,YAAmBD,IAExC,GACEE,KAAwB,MACxB,CAACwK,GAAgBzD,cAAc/F,SAAS8I,GAAU/C,eAElD,MAAO1M,IAET,GAAMoQ,IAAqBwM,GAAsB7M,GAA2BnM,KAAM5E,IAE5E6W,GAAeL,GAAyBqI,GAASja,KAAM5E,IAEvDof,GAAqBlB,GAAsBM,GAAe5Z,KAAM5E,IAEhEqf,GAAW,IACf9H,GAA6B,IAC3B6H,IAD2B,YAC3BA,GAAoBxN,2BADO,qBACoB,EADpB,IAE3BkN,EAAela,KAAKkP,eAFO,qBAEQ,OAHtB,qBAIV,GAEDwL,GAAiB1I,GAAiBC,GAAcwI,IAEhDE,GAAqBxB,GAAsBlH,IAE3CY,GAAc2G,GAAegB,IAEnC,MAAO,GAAP,mBACKpe,IADL,kDAGIhB,MACAyQ,UAAWU,IACRC,IACAmO,IACA9H,IAPP,IAQI6H,kBACArB,aAAcmB,QAIpB,IAGD1T,KAAK,SAAC6F,GAAGC,GAAJ,OAAUD,IAAEd,UAAUgB,cAAcD,GAAEf,aA/GvC,mBAiHA,CAAE7L,QAAM+F,MAAO/F,GAAKmB,OAAQH,QAAS,SAjHrC,uCAAF,sDAmHP,QAASjG,EACT,YACE,cAAC,IAAD,CACE,GAAG,kCACH,OAAQ,CAAE6f,UAAWrP,KAGzB,OAAQ,CAAE5M,OAAQ,YAClB,OAAQ,CAAEjC,EAAG,MACb,UAAW+J,EACX,WAAY,CAAEqG,SAAU,0BAAMrG,EAAUM,WAAhB,wBAAM,EAAmBW,WACjD,OAAO,QClLPmT,GAAwD,SAAC,EAAY,SAAVC,EAAU,EAAVA,IACzD1d,EAAOC,cACb,EAA0CgR,YAAS,kBAA3C0M,EAAR,EAAQA,gBAAiBzM,EAAzB,EAAyBA,aACzB,EAA4DhO,cAApDE,EAAR,EAAQA,mBAAoBD,EAA5B,EAA4BA,oBAAqBgO,EAAjD,EAAiDA,OAE3CyM,EAA4BjiB,sBAChCkiB,aAAsB3M,GAAD,YAACA,EAAc9F,aACpC,CAAC8F,GAAD,YAACA,EAAc9F,cAGX0S,EAAiBlgB,kBACrB,iBACE,CAAC,CAACuT,EAAOvO,KAAK3D,KAAK,kBAAGjB,EAAH,EAAGA,GAAH,MAAYA,KAAOkT,IAAA,MAAL,GAAKA,EAAc9F,eAAnB,wBAAK,EAA2BpN,OACjE4f,EAA0BG,KAAYC,wBACxC,IAGF,MAAK5a,GAKH,cAAC,IAAD,CACE,MACE,qCACE,cAAC,IAAD,CAAkB,GAAIA,GAAF,SAAEA,EAAoBgQ,WAAtB,wBAAE,EAA6BjR,OAClD,KACD,cAAC,IAAD,CAAkB,GAAIub,OAG1B,mBACE,qBAAK,MAAO,CAAEhE,QAAS,OAAQlJ,QAAS,OAAQsJ,IAAK,QAArD,SACE,cAAC,KAAD,CAAM,GAAE,4BAAuB3W,EAAvB,sBAAR,SACE,oBAAQ,KAAK,UAAb,SACE,cAAC,IAAD,CAAkB,GAAG,eAAe,eAAe,uBAK3D,OAAQ,CACN8a,WAAY,CACVC,OAAQ,CACN,CACEC,KAAM,UACNC,eAAgBpe,EAAK8B,cAAc,CACjC9D,GAAI,aAGR,CACEmgB,KAAM,WACNC,eAAgBpe,EAAK8B,cAAc,CACjC9D,GAAI,cAGR,CACEmgB,KAAMnP,OAAO7L,GACbib,eAAgBpP,OAAM,GAAC5L,EAAmBgQ,WAApB,wBAAC,EAA4BjR,OAErD,CACEgc,KAAMnP,OAAO0O,GACbU,eAAgBpe,EAAK8B,cAAc,CAAE9D,GAAI0f,EAAKlP,eAAgBQ,OAAO0O,SAtC/E,SA4CE,eAAC,KAAD,CACE,UAAW,CAAElN,QAAS,QACtB,KAAM,CACJtS,KAAM,OACNmgB,UAAWX,EACXhO,SAAU,SAAC4O,EAAQ,CACjBX,EAAgB,eACXzM,IAGLhJ,IAAQC,KAAR,4BAAkChF,EAAlC,YAAyDmb,MAV/D,UAcE,cAAC,KAAQ,QAAT,CAA8B,IAAK,cAAC,IAAD,CAAkB,GAAG,WAAxD,SACE,cAAC,KAAD,KADmB,UAGrB,cAAC,KAAQ,QAAT,CAAgC,IAAK,cAAC,IAAD,CAAkB,GAAG,aAA1D,SACE,cAAC,GAAD,KADmB,YAGrB,cAAC,KAAQ,QAAT,CAA6B,IAAK,cAAC,IAAD,CAAkB,GAAG,UAAvD,SACE,cAAC,GAAD,KADmB,SAGrB,cAAC,KAAQ,QAAT,CAAgC,IAAK,cAAC,IAAD,CAAkB,GAAG,aAA1D,SACE,cAAC,GAAD,KADmB,YAGrB,cAAC,KAAQ,QAAT,CAAsC,IAAK,cAAC,IAAD,CAAkB,GAAG,mBAAhE,SACE,cAAC,GAAD,KADmB,kBAGrB,cAAC,KAAQ,QAAT,CAAkC,IAAK,cAAC,IAAD,CAAkB,GAAG,eAA5D,SACE,cAAC,GAAD,KADmB,cAGpBR,GACC,cAAC,KAAQ,QAAT,CAAoC,IAAK,cAAC,IAAD,CAAkB,GAAG,iBAA9D,SACE,cAAC,GAAD,KADmB,gBAIvB,cAAC,KAAQ,QAAT,CAAoC,IAAK,cAAC,IAAD,CAAkB,GAAG,iBAA9D,SACE,cAAC,GAAD,KADmB,gBAGrB,cAAC,KAAQ,QAAT,CAEE,IAAK,cAAC,IAAD,CAAkB,GAAG,yBAF5B,SAIE,cAAC,GAAD,KAHI,6BAzFH,wBAmGI,wBAAM,CACnB,GAAMxb,GAASic,cACPC,EAA8Blc,EAA9Bkc,UAAR,EAAsClc,EAAnBob,MAAnB,WAAyB,SAAzB,EAEA,MACE,eAAC,IAAD,CAA+B,oBAAqBve,OAAOqf,GAA3D,SACE,cAAC,GAAD,CAA4B,IAAKd,Q,2SC/F1Be,GAAUC,KAAMC,cAA8B,IAErDC,EAAc,UAAG,CAAH,MAAM3c,MAAK4c,MAAM5c,KAAK6c,SAAW,QAE/CC,GAAiB,YAAC3H,EAAwC,CAC9D,MAAOA,GAAQrY,OAAO,SAACC,EAAKiM,EAAS,CACnC,MAAO,GAAP,oBAAWjM,GAAX,aAAoBiM,EAAKmM,QAAU2H,GAAe9T,EAAKmM,SAAW,IAAlE,CAAuEnM,KACtE,KAGQkM,GAAgB,YAACC,EAAuC,CACnE,MAAOA,GAAQrY,OAAO,SAACC,EAAKiM,EAAS,OACnC,MAAO,GAAP,oBAAWjM,GAAX,aAAoBiM,EAAKmM,QAAUD,GAAclM,EAAKmM,SAAW,IAAjE,gBAA0EnM,EAAK1N,UAA/E,mBAAyF,MACxF,KAGCyhB,GAA6B,YACjC5H,EACA6H,EACAliB,EACiB,CACjB,MAAOqa,GAAQnZ,IAAI,SAACihB,EAAD,6BAAC,eACfA,GADc,IAEjB9H,QAAS8H,EAAO9H,QAAU4H,GAA2BE,EAAO9H,QAAS6H,EAAUliB,GAAS,GACxFQ,OAAQ2hB,EAAOlhB,KAAOihB,EAAd,2BAA8BC,EAAO3hB,UAArC,qBAA+C,IAA/C,CAAoDR,IAApD,GAA6DmiB,EAAO3hB,UAApE,mBAA8E,QAiBpF4hB,GAA8B,YAClC/H,EACAgI,EACAH,EACiB,CACjB,MAAKA,GAGE7H,EAAQnZ,IAAI,SAACihB,EAAD,oBAAC,eACfA,GADc,IAEjB9H,QAAS,GAAF,oBACD8H,EAAO9H,QAAU+H,GAA4BD,EAAO9H,QAASgI,EAAWH,GAAY,IADnF,aAEDC,EAAOlhB,KAAOihB,EAAW,CAACG,GAAa,SANtC,GAAP,oBAAWhI,GAAX,CAAoBgI,KAWlBC,GAAsB,YAC1BjI,EACA6H,EACAK,EACiB,CACjB,MAAOlI,GAAQnZ,IAAI,SAACihB,EAAD,oBAAC,eACdA,EAAOlhB,KAAOihB,EAAWK,EAAgBJ,GAD5B,IAEjB9H,QAAS8H,EAAO9H,QAAUiI,GAAoBH,EAAO9H,QAAS6H,EAAUK,GAAiB,QAIvFC,EAA0B,YAACnI,EAAuBoI,EAA0C,CAChG,MAAOpI,GAAQnZ,IAAI,SAACihB,EAAD,oBAAC,eACfA,GADc,IAEjB1T,UAAWgU,EACXpI,QAAS8H,EAAO9H,QAAUmI,GAAwBL,EAAO9H,QAAS8H,EAAOlhB,IAAM,QAI7EyhB,EAAwB,YAACrI,EAAuB6H,EAAmC,CACvF,MAAO7H,GACJ1V,OAAO,SAACwd,EAAD,OAAYA,GAAOlhB,KAAOihB,IACjChhB,IAAI,SAACihB,EAAD,oBAAC,eACDA,GADA,IAEH9H,QAAS8H,EAAO9H,QAAUqI,GAAsBP,EAAO9H,QAAS6H,GAAY,QAI5ES,GAAuB,YAACtI,EAAuBuI,EAAkC,CACrF,MAAOvI,GAAQnZ,IAAI,SAACihB,EAAD,oBAAC,eACfA,GADc,IAEjB9H,QAAS8H,EAAO9H,QAAUsI,GAAqBR,EAAO9H,QAASuI,GAAW,GAC1EpiB,OAAQ2hB,EAAO3hB,OAAS2hB,EAAO3hB,OAAOmE,OAAO,SAAC3E,EAAD,OAAWA,GAAMiB,KAAO2hB,IAAW,QAI9EC,GAAyB,YAC7BC,EACA7b,EACA8b,EACA1I,EACiB,CACjB,MAAOA,IAAP,YAAOA,EAASnZ,IAAI,SAACihB,GAAW,CAC9B,GAAIA,GAAOlhB,KAAO8hB,EAAW,OAC3B,MAAO,4BACFZ,IADL,IAEE3hB,OAAM,GAAE2hB,GAAO3hB,UAAT,wBAAE,EAAeU,IAAI,SAAClB,GAAU,CACpC,MAAIA,IAAMiB,KAAO6hB,EACR7b,EAAK+b,KAAKjkB,SAAS8G,KAErB7F,eAGFmiB,GAAO9H,QAChB,MAAO,4BACF8H,IADL,IAEE9H,QAASwI,GAAuBC,EAAa7b,EAAM8b,EAAWZ,GAAO9H,SAAW,MAGpF,MAAO8H,OAIEc,GAAkE,SAAC,EAG1E,IAFJrE,GAEI,EAFJA,SACA3d,EACI,EADJA,GAEA,EAA0BzC,qBAA1B,qBAAO0kB,EAAP,MAAcC,GAAd,MACMlgB,GAAOC,cAEPkgB,GAA0BviB,kBAAQ,UAAM,CAC5C,MAAOqiB,IAASA,EAAM7I,QAAUD,GAAc8I,EAAM7I,SAAW,IAC9D,CAAC6I,IAEEG,GAA4BxiB,kBAAQ,UAAM,CAC9C,MAAOqiB,IAASA,EAAM7I,QAAU2H,GAAekB,EAAM7I,SAAW,IAC/D,CAAC6I,IAEJ,GAAwB1kB,mBAAS,IAAjC,sBAAO8kB,GAAP,MAAaC,GAAb,MAEMC,GAAI/W,eAEVjE,oBAAU,UAAM,CACd+a,GAAQ,KACP,IAaH,GAAME,IAAa7kB,sBAAY,UAAM,CACnCsb,YAAQjZ,GAAIqJ,KAAK,SAACzE,EAAS,CACzB,MACEA,GAAKgB,SACLsc,GAAS,2BACJtd,EAAKA,MADF,IAENwU,QAASmI,EAAwB3c,EAAKA,KAAKwU,eAIhD,CAACpZ,IAEJuH,oBAAU,UAAM,CACdib,MACC,CAACA,KAEJ,GAAMC,IAAuB9kB,sBAC3B,SAAC+kB,EAAqB,CACpB,GAAMxB,GAASkB,GAAYnhB,KAAK,SAAC0hB,EAAD,aAC9BA,IAD8B,SAC9BA,EAAapjB,UADiB,wBAC9B,EAAqB0B,KAAK,SAAClC,EAAD,OAAWA,GAAMiB,KAAO0iB,MAEpD,MAAOxB,GAASA,EAAOlhB,GAAK,MAE9B,CAACoiB,KAGGQ,GAAkBhjB,kBAAyB,UAAM,SACrD,SAAI2iB,GAAE9W,SAAN,kBAAI,EAASyV,OACJ,CACLpT,KAAM,SACN9N,GAAImB,OAAOohB,GAAE9W,MAAMyV,QACnB9c,MAAOge,GAAYnhB,KAAK,SAACigB,EAAD,OAAYA,GAAOlhB,KAAOmB,OAAOohB,GAAE9W,MAAMyV,WAGrE,GAAIqB,GAAE9W,SAAN,kBAAI,EAAS1M,MACJ,CACL+O,KAAM,QACN9N,GAAImB,OAAOohB,GAAE9W,MAAM1M,OACnBqF,MAAO+d,GAAWlhB,KAAK,SAAC4hB,EAAD,OAAOA,GAAE7iB,KAAOmB,OAAOohB,GAAE9W,MAAM1M,UAGnD,CAAE+O,KAAM,SACd,CAACyU,GAAE9W,MAAOwW,EAAOG,GAAaD,KAE3BW,GAAenlB,sBACnB,SAAColB,EAAsB,CACrB,GAAM3B,GAAwB,CAC5B/jB,UAAW2C,EACXT,OAAQ,GACRyjB,MAAO,GACPhjB,GAAIiiB,EAAQA,EAAM7I,QAAQrT,OAAS,EAAI6a,IACvCzU,MAAO,EACPtM,MAAOmC,GAAK8B,cAAc,CAAE9D,GAAI,mBAChCijB,OAAQ,GACRzV,UAAWuV,GAGbb,UAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAAS+H,GAA2B,GAAC+B,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAIgI,EAAW2B,OAIrE3B,GAET,CAACphB,EAAIiiB,IAGDkB,EAAexlB,sBACnB,SAACmkB,EAAmBjY,EAAuB,CACzC,GAAMuX,GAAYgB,GAAYnhB,KAAK,SAACigB,EAAD,OAAYA,GAAOlhB,KAAO8hB,IACvDkB,EAAQ5B,GAAaA,EAAU4B,MAErC,MAAQA,GAAQI,YAAgBvZ,GAAYwZ,YAAgBvB,EAAWjY,IAAWR,KAChF,SAACzE,EAAS,CACR,YAAQgB,QAAQhB,EAAKwD,SACrBoa,KAEE5d,EAAKgB,SACLsc,GAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAASiI,GAAmB,GAAC6B,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAI0I,EAA3B,YAAC,eACxBld,EAAKA,MADkB,IAE1Boe,MAAO,aAqBnB,CAACf,IAGGqB,GAAe3lB,sBACnB,SAACmkB,EAAsB,CACrB,GAAMZ,GAASkB,GAAYnhB,KAAK,SAAC0hB,EAAD,OAAiBA,GAAY3iB,KAAO8hB,IACpE,GAAI,EAACZ,EAGL,IAAQ8B,GAAU9B,EAAV8B,MAEJA,EACFd,GAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAASqI,EAAqB,GAACyB,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAI0I,OAG3DyB,YAAgBzB,GAAWzY,KAAK,SAACzE,EAAS,CACpCA,EAAKgB,SACP,MAAQA,QAAQhB,EAAKwD,SACrB8Z,GAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAASqI,EAAqB,GAACyB,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAI0I,YAMnE,CAACG,IAGGuB,GAAc7lB,sBAClB,SAAC+kB,EAAkB7Y,EAAuB,OAClCiY,EAAYW,GAAqBC,GAEjCxB,EAASkB,GAAYnhB,KAAK,SAAC0hB,GAAD,OAAiBA,IAAY3iB,KAAO8hB,IAE9D/iB,EAAQmiB,GAAM,IAAIA,EAAO3hB,UAAX,wBAAI,EAAe0B,KAAK,SAACwiB,GAAD,OAAgBA,IAAWzjB,KAAO0iB,KAExEM,EAAQjkB,GAAH,YAAGA,EAAOikB,MAErB,MAAQA,GAAQU,YAAe7Z,GAAY8Z,YAAejB,EAAU7Y,IAAWR,KAC7E,SAACzE,GAAS,CACJA,GAAKgB,SACP,MAAQA,QAAQhB,GAAKwD,SACrBoa,KAEAtY,IAAQC,KAAR,wBAA8BnK,EAA9B,2BAAmD4E,GAAKA,KAAK5E,KAEzDjB,IAAK,KAAL,OAAAA,EAAOoB,kBAAmB1D,KAAUmnB,OACtCC,WAAW,UAAM,CACfrB,MACC,SAMb,CAACC,GAAsBR,EAAOO,KAG1BsB,GAAcnmB,sBAClB,SAAC+kB,EAAqB,CACpB,GAAMZ,GAAYW,GAAqBC,GAEjCxB,EAASkB,GAAYnhB,KAAK,SAAC0hB,EAAD,OAAiBA,GAAY3iB,KAAO8hB,IACpE,GAAI,EAACZ,EAIL,IAAMniB,GAAQojB,IAAH,YAAGA,GAAYlhB,KAAK,SAACwiB,EAAD,OAAgBA,GAAWzjB,KAAO0iB,IAE3DM,EAAQjkB,GAAH,YAAGA,EAAOikB,MACjBA,GAAS,CAACjkB,EAAMC,UAClBkjB,GAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAASsI,GAAoB,GAACwB,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAIsJ,OAG1DqB,YAAerB,GAAUrZ,KAAK,SAACzE,EAAS,CAClCA,EAAKgB,SACP,MAAQA,QAAQhB,EAAKwD,SACrB8Z,GAAS,SAACgB,EAAD,2BAAC,eACLA,GADI,IAEP9J,QAASsI,GAAoB,IAACwB,GAAD,YAACA,EAAW9J,WAAZ,qBAAuB,GAAIsJ,YA0BlE,CAACT,EAAOQ,KA+GJuB,EAAcrmB,sBAAY,SAACmkB,EAAmB5hB,EAAwB,CAC1E,GAAM+jB,GAAsB,CAC1BnC,YACAkB,MAAO,GACPhjB,GAAI4gB,IACJ/gB,MAAOmC,GAAK8B,cAAc,CAAE9D,GAAI,mBAChCijB,OAAQ,GACR9iB,eAAgBD,GAGlBgiB,UAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAAS4H,GAA0B,GAACkC,GAAD,YAACA,EAAW9J,WAAZ,mBAAuB,GAAI0I,EAAWmC,OAEpEA,GACN,IAEGC,EAAkB,SAACrC,EAAqB7b,EAA4B,CACxE,GAAM8b,GAAYW,GAAqBZ,GACvCK,GAAS,SAACgB,EAAD,oBAAC,eACLA,GADI,IAEP9J,QAAS8J,EACLtB,GAAuBC,EAAa7b,EAAM8b,EAAWoB,EAAU9J,SAAW,IAC1E,OAKNlP,IAAQC,KAAR,wBAA8BnK,EAA9B,2BAAmDgG,EAAK+b,KAAKjkB,SAAS8G,KAAK5E,MAGvEmkB,GAAaxmB,sBACjB,SAAC+kB,EAAqB,CACpB,MAAO0B,aAAc1B,GAAUrZ,KAAK,SAACvL,EAAa,CAChD,GAAIA,EAAS8H,QAAS,CACpB,KAAQA,QAAQ9H,EAASsK,SACzB,GAAM0Z,GAAYW,GAAqBC,GAEvCR,GAAS,SAACgB,EAAD,0BAAC,eACLA,GADI,IAEP9J,QAAS8J,EAAS,GACdA,EAAU9J,WADI,wBACd,EAAmBnZ,IAAI,SAACihB,EAAW,CACjC,GAAIA,EAAOlhB,KAAO8hB,EAAW,CAC3B,GAAMviB,GAAS2hB,EAAO3hB,QAAU,GAChC,MAAO,4BACF2hB,GADL,IAEE3hB,OAAQ,GAAF,oBAAMA,GAAN,CAAczB,EAAS8G,SAGjC,MAAOsc,KAET,WAKZ,CAACe,EAAOQ,KAGJ4B,GAAc1mB,sBAAY,SAACmkB,EAAsB,CACrD,MAAOwC,aAAexC,GAAWzY,KAAK,SAACvL,EAAa,CAC9CA,EAAS8H,SACX,MAAQA,QAAQ9H,EAASsK,SAEzB8Z,GAAS,SAACgB,EAAD,oBAAC,eACLA,GADI,IAEP9J,QAAS8J,EAAY,GAAH,oBAAOA,EAAU9J,SAAjB,CAA0Btb,EAAS8G,OAAQ,WAIlE,IAEGR,GAAQ,CACZ6d,QACAI,QAEAriB,KACA8iB,gBACAK,eACAK,eAGAF,gBAEAU,cACAF,eACAI,kBACAC,cACAE,eACAzB,mBACAJ,eAGF,MAAO,eAAC,GAAQ,SAAT,CAAkB,MAAOpe,GAAzB,SAAiCuZ,M,kMCzmBnC,YAAP,qC,sDAAO,YACLrZ,EAMAC,GAPK,oGASEC,YAAwB,4BAAjB,cACZF,SACAG,OAAQ,MACaC,SAAU,IAC3BH,IAAW,UAbZ,sC,wBAkBA,YAAP,wC,sDAAO,YACLlH,EACAiH,GACAC,GAHK,wGAKEC,YAAO,kCAA6DnH,EAA7D,yBACZiH,UACAG,OAAQ,MACaC,SAAU,GAC/B6f,aAAc,OACd5f,QAAS,CACP6f,OAAQ,6BAENjgB,IAAW,UAbZ,uC,wBAkBA,YAAP,wC,sDAAO,YACLme,EACAplB,GACAiH,GAHK,wGAKEC,YAAO,iCAA4Dke,EAA5D,yBACZje,OAAQ,MACaC,SAAU,GAC/BJ,OAAQ,CAAEhH,SACVinB,aAAc,OACd5f,QAAS,CACP6f,OAAQ,6BAENjgB,IAAW,UAbZ,uC","file":"p__TeacherSubjects__form.3da3e27f.async.js","sourcesContent":["export enum TopicType {\n  Unselected = '',\n  RichText = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\RichText',\n  OEmbed = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\OEmbed',\n  Audio = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\Audio',\n  Video = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\Video',\n  H5P = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\H5P',\n  Image = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\Image',\n  PDF = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\PDF',\n  SCORM = 'EscolaLms\\\\TopicTypes\\\\Models\\\\TopicContent\\\\ScormSco',\n  Project = 'EscolaLms\\\\TopicTypeProject\\\\Models\\\\Project',\n  GiftQuiz = 'EscolaLms\\\\TopicTypeGift\\\\Models\\\\GiftQuiz',\n}\n\nexport enum EventTypes {\n  OrderPaid = 'EscolaLms\\\\Cart\\\\Events\\\\OrderPaid',\n  UserLogged = 'EscolaLms\\\\Auth\\\\Events\\\\UserLogged',\n}\n\nexport enum CourseStatus {\n  draft = 'draft',\n  published = 'published',\n  archived = 'archived',\n}\n\nexport enum TemplateChannelValue {\n  email = 'EscolaLms\\\\TemplatesEmail\\\\Core\\\\EmailChannel',\n  pdf = 'EscolaLms\\\\TemplatesPdf\\\\Core\\\\PdfChannel',\n  sms = 'EscolaLms\\\\TemplatesSms\\\\Core\\\\SmsChannel',\n}\n\nexport enum TemplateEvents {\n  ManuallyTriggeredEvent = 'EscolaLms\\\\Templates\\\\Events\\\\ManuallyTriggeredEvent',\n}\n\nexport enum VouchersTypes {\n  cart_fixed = 'cart_fixed',\n  cart_percent = 'cart_percent',\n  product_fixed = 'product_fixed',\n  product_percent = 'product_percent',\n}\n\nexport type BuyableTypes =\n  | 'App\\\\Models\\\\Course'\n  | 'App\\\\Models\\\\Consultation'\n  | 'App\\\\Models\\\\Webinar'\n  | 'App\\\\Models\\\\StationaryEvent'\n  | 'EscolaLms\\\\Courses\\\\Models\\\\Course'\n  | 'EscolaLms\\\\Consultations\\\\Models\\\\Consultation'\n  | 'EscolaLms\\\\Webinars\\\\Models\\\\Webinar'\n  | 'EscolaLms\\\\StationaryEvents\\\\Models\\\\StationaryEvent';\n\nexport enum QuestionType {\n  MULTIPLE_CHOICE = 'multiple_choice',\n  MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS = 'multiple_choice_with_multiple_right_answers',\n  TRUE_FALSE = 'true_false',\n  SHORT_ANSWERS = 'short_answers',\n  MATCHING = 'matching',\n  NUMERICAL_QUESTION = 'numerical_question',\n  ESSAY = 'essay',\n  DESCRIPTION = 'description',\n}\n\nexport enum AttendanceValue {\n  PRESENT = 'present',\n  PRESENT_NOT_EXERCISING = 'present_not_exercising',\n  ABSENT = 'absent',\n  EXCUSED_ABSENCE = 'excused_absence',\n}\n\nexport enum ExamGradeType {\n  Manual = 'manual',\n  TeamsForms = 'teams_forms',\n  TeamsLecture = 'teams_lecture',\n  TestPortal = 'test_portal',\n}\n\nexport enum CompetencyChallengeType {\n  Simple = 'simple',\n  Complex = 'complex',\n}\n\nexport enum TopicStatsKey {\n  QuizSummary = 'EscolaLms\\\\Reports\\\\Stats\\\\Topic\\\\QuizSummaryForTopicTypeGIFT',\n}\n","import React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Button } from 'antd';\nimport { ExportOutlined } from '@ant-design/icons';\n\nimport { exportStatForCourse } from '@/services/escola-lms/reports';\n\ninterface Props {\n  course_id: number;\n  stat?: API.ExportStatForCourseStat;\n}\n\nexport const ExportStatsButton: React.FC<Props> = ({\n  course_id,\n  stat = 'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics',\n}) => {\n  const [loading, setLoading] = useState(false);\n\n  const onClickFactory = useCallback(\n    (courseId: number) => async () => {\n      setLoading(true);\n      try {\n        const response = await exportStatForCourse(courseId, {\n          stat,\n        });\n\n        if (response instanceof Blob) {\n          const downloadLink = document.createElement('a');\n          downloadLink.href = window.URL.createObjectURL(response);\n          downloadLink.download = `finished_topics_${course_id}.xlsx`;\n          document.body.appendChild(downloadLink);\n          downloadLink.click();\n          document.body.removeChild(downloadLink);\n        }\n      } catch (error) {\n        console.error(error);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [stat],\n  );\n\n  return (\n    <Button type=\"primary\" loading={loading} onClick={onClickFactory(course_id)}>\n      <ExportOutlined /> <FormattedMessage id=\"export\" />\n    </Button>\n  );\n};\n","import React, { useMemo, useState } from 'react';\nimport { Row, Select, Space, Switch, Table, Tag } from 'antd';\nimport type { ColumnsType } from 'antd/es/table';\nimport ProCard from '@ant-design/pro-card';\nimport { Column } from '@ant-design/plots';\nimport { FormattedMessage, useIntl } from 'umi';\nimport ScrollContainer from 'react-indiana-drag-scroll';\n\nimport TypeButtonDrawer from '../TypeButtonDrawer';\nimport { ExportStatsButton } from './ExportStatsButton';\n\ntype UserStatColumn = Record<string, number | string | API.FinishedTopicsUserStat> & {\n  email: string;\n  id: number;\n};\n\nconst findH5PType = (topic: API.TopicH5P) => {\n  if (topic.topicable.content.contents) {\n    return Object.values(topic.topicable.content.contents)[0].library;\n  }\n  return 'H5P';\n};\n\nexport const UserProgress: React.FC<{\n  course_id: number;\n  topics: API.Topic[];\n  stats: API.FinishedTopicsUserStats[];\n}> = ({ course_id, topics, stats }) => {\n  const [showSeconds, setShowSeconds] = useState(false);\n  const columns: ColumnsType<UserStatColumn> = useMemo(() => {\n    return [\n      {\n        title: <FormattedMessage id=\"user\" />,\n        dataIndex: 'id',\n        render: (id: number) => <TypeButtonDrawer type=\"App\\Models\\User\" type_id={id} />,\n      },\n      {\n        title: <FormattedMessage id=\"email\" />,\n        dataIndex: 'email',\n      },\n      ...topics.map((topic) => {\n        let type: string | undefined = topic.topicable_type?.split('\\\\').pop();\n\n        if (type === 'H5P') {\n          type = findH5PType(topic as API.TopicH5P);\n        }\n\n        return {\n          render: (row: API.FinishedTopicsUserStat | undefined) => {\n            let result = 0;\n            let minutes = 0;\n            if (row) {\n              if (row.started_at && row.finished_at) {\n                result = 1;\n              } else if (row.started_at) {\n                result = 2;\n              }\n              minutes = row.seconds / 60;\n            }\n\n            switch (result) {\n              case 1:\n                return (\n                  <Space>\n                    <Tag color=\"success\">F</Tag>\n                    {showSeconds && <small>{minutes.toFixed(2)}m</small>}\n                  </Space>\n                );\n              case 2:\n                return (\n                  <Space>\n                    <Tag color=\"blue\">S</Tag>\n                    {showSeconds && <small>{minutes.toFixed(2)}m</small>}\n                  </Space>\n                );\n              case 0:\n              default:\n                return (\n                  <React.Fragment>\n                    <Tag color=\"error\">N</Tag>\n                  </React.Fragment>\n                );\n            }\n          },\n\n          title: (\n            <small>\n              <Tag>{type}</Tag> {topic.title}\n            </small>\n          ),\n          dataIndex: topic.id,\n        };\n      }),\n    ];\n  }, [topics, showSeconds]);\n\n  const dataSource: UserStatColumn[] = useMemo(() => {\n    return stats.map((userStat) =>\n      topics.reduce(\n        (acc, topic) => {\n          const result = userStat.topics.find((userStatTopic) => userStatTopic.id === topic.id);\n          return { ...acc, [Number(topic.id)]: result ?? 0 };\n        },\n        { email: userStat.email, id: userStat.id } as UserStatColumn,\n      ),\n    );\n  }, [stats, topics]);\n\n  return (\n    <Table\n      title={() => (\n        <Row justify=\"space-between\" align=\"middle\">\n          <Space>\n            <FormattedMessage id=\"Finished\" defaultMessage=\"Finished:\" />{' '}\n            <Tag color=\"success\">F</Tag>\n            <FormattedMessage id=\"Started\" defaultMessage=\"Started:\" /> <Tag color=\"blue\">S</Tag>\n            <FormattedMessage id=\"NotStarted\" defaultMessage=\"Not Started:\" />{' '}\n            <Tag color=\"error\">N</Tag>\n            <FormattedMessage id=\"ShowMinutes\" defaultMessage=\"Show minutes spent on topic:\" />{' '}\n            <Switch checked={showSeconds} onChange={(v) => setShowSeconds(v)} />\n          </Space>\n          <ExportStatsButton course_id={course_id} />\n        </Row>\n      )}\n      columns={columns}\n      dataSource={dataSource}\n      size=\"small\"\n      scroll={{ x: 1500 }}\n      components={{\n        table: (props: React.HTMLAttributes<HTMLTableElement>) => (\n          <ScrollContainer horizontal={true} style={{ maxWidth: 'auto' }} hideScrollbars={false}>\n            <table {...props} />\n          </ScrollContainer>\n        ),\n      }}\n    />\n  );\n};\n\nexport const UserCourseFinish: React.FC<{ stats: API.FinishedCourseUserStats[] }> = ({ stats }) => {\n  const columns: ColumnsType<{ email: string; finished_at: Date | string }> = useMemo(() => {\n    return [\n      {\n        title: 'user',\n        dataIndex: 'id',\n        render: (id: number) => <TypeButtonDrawer type=\"App\\Models\\User\" type_id={id} />,\n      },\n      {\n        title: 'email',\n        dataIndex: 'email',\n      },\n      {\n        title: <FormattedMessage id=\"finished_at\" defaultMessage=\"Finished at\" />,\n        dataIndex: 'finished_at',\n      },\n    ];\n  }, []);\n\n  const dataSource: { email: string; finished_at: Date | string }[] = useMemo(() => {\n    return stats.map(({ id, email, finished_at }) => ({\n      id,\n      email,\n      finished_at,\n    }));\n  }, [stats]);\n\n  return (\n    <Table\n      title={() => (\n        <Space>\n          <FormattedMessage id=\"course.finished\" defaultMessage=\"Finished\" />\n        </Space>\n      )}\n      columns={columns}\n      dataSource={dataSource}\n      size=\"small\"\n      scroll={{ x: 500 }}\n    />\n  );\n};\n\nexport const UserCourseAttempts: React.FC<{ stats: API.CourseAttempts[] }> = ({ stats }) => {\n  const [choosenUserEmail, setChoosenUserEmail] = useState<string | null>(null);\n  const [choosenAttempt, setChoosenAttempt] = useState<number | null>(null);\n  const intl = useIntl();\n\n  const dataSource = useMemo(() => {\n    return stats.flatMap((userStats) =>\n      Object.values(userStats.attempts).flatMap(({ dates, attempt }) => {\n        const datesValue = Object.values(dates).flatMap(({ date, seconds_total }) => {\n          return {\n            date,\n            attempt,\n            seconds_total,\n            email: userStats.email,\n          };\n        });\n\n        return datesValue;\n      }),\n    );\n  }, [stats]);\n\n  const config: any = {\n    xField: 'date',\n    yField: 'seconds_total',\n    seriesField: 'attempt',\n    isStack: true,\n    xAxis: {\n      label: {\n        autoHide: true,\n        autoRotate: false,\n      },\n    },\n    slider: {\n      start: 0,\n      end: 1,\n    },\n    label: {\n      position: 'middle',\n      layout: [\n        {\n          type: 'interval-adjust-position',\n        },\n        {\n          type: 'interval-hide-overlap',\n        },\n        {\n          type: 'adjust-color',\n        },\n      ],\n    },\n  };\n\n  return (\n    <ProCard\n      title={\n        <Space>\n          <FormattedMessage id=\"course.interactions_time_in_days\" />\n          <Select\n            showSearch\n            value={choosenUserEmail}\n            onChange={(newValue) => {\n              setChoosenUserEmail(newValue);\n              setChoosenAttempt(null);\n            }}\n            placeholder={<FormattedMessage id=\"select_person\" defaultMessage=\"Select a person\" />}\n          >\n            {stats.map(({ id, email }) => (\n              <Select.Option key={id} value={email}>\n                {email}\n              </Select.Option>\n            ))}\n          </Select>\n          <Select\n            value={choosenAttempt}\n            onChange={(newValue) => setChoosenAttempt(newValue)}\n            disabled={choosenUserEmail === null}\n            placeholder={<FormattedMessage id=\"select_attempt\" defaultMessage=\"Select attempt\" />}\n          >\n            {[\n              ...new Set(\n                dataSource\n                  .filter(({ email }) => email === choosenUserEmail)\n                  .map(({ attempt }) => attempt),\n              ),\n            ].map((attempt) => (\n              <Select.Option value={attempt} key={attempt}>\n                <FormattedMessage id=\"attempt\" defaultMessage=\"Attempt\" /> {attempt}\n              </Select.Option>\n            ))}\n          </Select>\n        </Space>\n      }\n      colSpan={12}\n      layout=\"center\"\n    >\n      <div style={{ overflow: 'auto', minHeight: '400px', width: '100%' }}>\n        <Column\n          {...config}\n          tooltip={{\n            title: `${intl.formatMessage({ id: 'attempt' })}`,\n            formatter: (datum) => {\n              const minutes = Math.floor(+datum.seconds_total / 60);\n              const seconds = +datum.seconds_total > 60 ? +datum.seconds_total - minutes * 60 : 0;\n\n              return {\n                name: datum.attempt,\n                value: `${minutes}m ${seconds}s`,\n              };\n            },\n          }}\n          data={dataSource\n            .filter(({ email }) => email === choosenUserEmail)\n            .filter(({ attempt }) =>\n              Number.isInteger(choosenAttempt) ? attempt === choosenAttempt : true,\n            )}\n        />\n      </div>\n    </ProCard>\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/exams */\nexport async function getExams(params?: API.ExamsParams, options?: RequestOptionsInit) {\n  return request<API.DefaultMetaResponse<API.Exam>>(`/api/admin/exams`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    params,\n    ...(options || {}),\n  });\n}\n\n/**  POST /api/admin/exams */\nexport async function createExam(body?: API.CreateExamRequest, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/**  PUT /api/admin/exams/:id */\nexport async function updateExam(\n  id: number,\n  body: API.CreateExamRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${id}`, {\n    method: 'PUT',\n    data: body,\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  GET /api/admin/exams/:id */\nexport async function getExam(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${id}`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  DELETE /api/admin/exams/:id */\nexport async function deleteExam(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<undefined>>(`/api/admin/exams/${id}`, {\n    method: 'DELETE',\n    ...(options || {}),\n  });\n}\n\n/**  POST /api/admin/exams/:id/users/:user_id */\nexport async function createExamResult(\n  exam_id: number,\n  user_id: number,\n  body: API.CreateExamResultRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${exam_id}/users/${user_id}`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/**  DELETE /api/admin/exams/:id/users/:user_id */\nexport async function deleteExamResult(\n  exam_id: number,\n  user_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<undefined>>(`/api/admin/exams/${exam_id}/users/${user_id}`, {\n    method: 'DELETE',\n    ...(options || {}),\n  });\n}\n","import ProForm from '@ant-design/pro-form';\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Modal, Select } from 'antd';\nimport type { DefaultOptionType } from 'antd/lib/select';\n\nimport SecureUpload from '@/components/SecureUpload';\nimport { ExamGradeType } from '@/services/escola-lms/enums';\nimport { useTeacherSubject } from '../context';\nconst FileExamGradeType: React.FC<{\n  type: ExamGradeType;\n  groupSelectDisabled: boolean;\n  onDataConverted: (data: ConvertedData | undefined) => void;\n}> = ({ type, onDataConverted, groupSelectDisabled }) => {\n  const { semester_subject_id, teacherSubjectData } = useTeacherSubject();\n  const [selectedGroup, setSelectedGroup] = useState<number | null>(null);\n\n  const groupOptions: DefaultOptionType[] = useMemo(\n    () =>\n      (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({\n        label: name,\n        value: id,\n      })),\n\n    [],\n  );\n  const reqData: API.ParseExamFileRequest = {\n    type,\n    group_id: selectedGroup!,\n    semester_subject_id: semester_subject_id!,\n  };\n\n  const onUploadFile = useCallback((response: API.DefaultResponse<API.Exam>) => {\n    if (response.success) {\n      // TODO error handling\n      // filter out users that are not in selected group\n      const exam_results = response.data.results.filter(({ user_id }) => user_id !== null);\n      if (!exam_results.length) return;\n\n      onDataConverted({ exam_results, group_id: response.data.group_id });\n    }\n  }, []);\n\n  return (\n    <>\n      <ProForm.Item label={<FormattedMessage id=\"group\" />}>\n        <Select\n          disabled={groupSelectDisabled}\n          value={selectedGroup}\n          onChange={(v) => setSelectedGroup(v)}\n          options={groupOptions}\n          placeholder={<FormattedMessage id=\"select_group\" />}\n          style={{ width: '100%' }}\n        />\n      </ProForm.Item>\n      <SecureUpload\n        name=\"file\"\n        url=\"/api/admin/exams/parse\"\n        onUpload={onUploadFile}\n        onChange={(info) => !info.fileList.length && onDataConverted(undefined)}\n        maxFiles={1}\n        data={reqData}\n        disabled={!selectedGroup}\n      />\n    </>\n  );\n};\n\nconst ManualExamGradeType: React.FC<{\n  onDataConverted: (convertedData: ConvertedData) => void;\n}> = ({ onDataConverted }) => {\n  const { teacherSubjectData, groupUsers } = useTeacherSubject();\n  const [selectedGroup, setSelectedGroup] = useState<number | null>(null);\n\n  const groupOptions: DefaultOptionType[] = useMemo(\n    () =>\n      (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({\n        label: name,\n        value: id,\n      })),\n\n    [],\n  );\n\n  const onSelectedGroupChange = useCallback(\n    (group_id: number) => {\n      setSelectedGroup(group_id);\n      const currGroup = groupUsers.byId?.[group_id];\n      if (!currGroup) return;\n\n      const exam_results = currGroup.users.reduce<API.ExamResult[]>(\n        (acc, { id, email, first_name, last_name, academic_teacher_id }) => {\n          // filter out tutors\n          if (academic_teacher_id !== null) return acc;\n\n          return [\n            ...acc,\n            {\n              email,\n              first_name,\n              last_name,\n              user_id: id,\n              result: 0,\n            },\n          ];\n        },\n        [],\n      );\n\n      onDataConverted({ group_id, exam_results });\n    },\n    [groupUsers.byId],\n  );\n\n  return (\n    <Select\n      value={selectedGroup}\n      onChange={onSelectedGroupChange}\n      options={groupOptions}\n      placeholder={<FormattedMessage id=\"select_group\" />}\n      style={{ width: '100%' }}\n    />\n  );\n};\n\nexport interface ConvertedData {\n  group_id: number;\n  exam_results: API.ExamResult[];\n}\n\ninterface Props {\n  open: boolean;\n  closeModal: () => void;\n  onSuccess: (convertedData: ConvertedData) => void;\n  type: ExamGradeType;\n}\n\nconst FILE_TYPES = [ExamGradeType.TeamsLecture, ExamGradeType.TestPortal, ExamGradeType.TeamsForms];\n\nexport const ConvertGradesModal: React.FC<Props> = ({ open, closeModal, onSuccess, type }) => {\n  const { teacherSubjectData, fetchGroupUsers } = useTeacherSubject();\n  const [convertedData, setConvertedData] = useState<ConvertedData>();\n\n  useEffect(() => {\n    if (type === ExamGradeType.Manual && open) {\n      teacherSubjectData?.groups?.forEach(({ id }) => fetchGroupUsers(id));\n    }\n  }, [type, open]);\n\n  return (\n    <Modal\n      title={<FormattedMessage id={`TeacherSubjects.Exams.${type}Convert`} />}\n      width=\"40vw\"\n      open={open}\n      onCancel={closeModal}\n      onOk={() => {\n        if (convertedData) {\n          onSuccess(convertedData);\n        }\n      }}\n      okButtonProps={{ disabled: !convertedData }}\n    >\n      {FILE_TYPES.includes(type) && (\n        <FileExamGradeType\n          type={type}\n          onDataConverted={setConvertedData}\n          groupSelectDisabled={!!convertedData}\n        />\n      )}\n      {type === ExamGradeType.Manual && <ManualExamGradeType onDataConverted={setConvertedData} />}\n    </Modal>\n  );\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { FormattedMessage, history } from 'umi';\nimport { Button, Col, InputNumber, Row, Spin } from 'antd';\nimport ProTable, { ProColumns } from '@ant-design/pro-table';\nimport ProForm, { ProFormDatePicker, ProFormText } from '@ant-design/pro-form';\nimport { ExamGradeType } from '@/services/escola-lms/enums';\nimport { createExam, getExam, updateExam } from '@/services/escola-lms/exams';\n\nimport { ConvertGradesModal, type ConvertedData } from './ConvertGradesModal';\nimport { useTeacherSubject } from '../context';\n\nconst SelectTypeButtonsGroup: React.FC<{ onSelect: (type: ExamGradeType) => void }> = ({\n  onSelect,\n}) => (\n  <Row gutter={[16, 16]}>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TeamsForms)}>\n        <FormattedMessage id=\"uploadFile.MsTeamsForms\" defaultMessage=\"uploadFile.MsTeamsForms\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TestPortal)}>\n        <FormattedMessage id=\"uploadFile.TestPortal\" defaultMessage=\"uploadFile.TestPortal\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TeamsLecture)}>\n        <FormattedMessage id=\"uploadFile.MsTeams\" defaultMessage=\"uploadFile.MsTeams\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.Manual)}>\n        <FormattedMessage id=\"uploadGradesManually\" defaultMessage=\"uploadGradesManually\" />\n      </Button>\n    </Col>\n  </Row>\n);\n\nconst staticColumns: ProColumns<API.ExamResult>[] = [\n  { title: <FormattedMessage id=\"first_name\" />, dataIndex: 'first_name', editable: false },\n  { title: <FormattedMessage id=\"last_name\" />, dataIndex: 'last_name', editable: false },\n  {\n    title: <FormattedMessage id=\"examResult\" />,\n    dataIndex: 'result',\n    valueType: 'percent',\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n        {\n          type: 'number',\n          min: 0,\n          max: 100,\n          message: <FormattedMessage id=\"number_between\" values={{ min: 0, max: 100 }} />,\n        },\n      ],\n    },\n  },\n];\n\ninterface ExamFormValues {\n  title: string;\n  weight: number;\n  passed_at: Date | string;\n}\n\ninterface Props {\n  exam_id: string;\n}\nexport const ExamForm: React.FC<Props> = ({ exam_id }) => {\n  const [form] = ProForm.useForm<ExamFormValues>();\n  const [selectedType, setSelectedType] = useState<ExamGradeType>();\n  const [convertedData, setConvertedData] = useState<ConvertedData>();\n  const [fetching, setFetching] = useState(false);\n  const { semester_subject_id, getGroupById } = useTeacherSubject();\n\n  const editableKeys = useMemo(\n    () => (convertedData?.exam_results ?? []).map(({ user_id }) => user_id),\n    [convertedData?.exam_results],\n  );\n\n  useEffect(() => {\n    const numExamId = Number(exam_id);\n\n    if (exam_id === 'new') {\n      setSelectedType(undefined);\n      setConvertedData(undefined);\n      form.resetFields();\n    }\n\n    if (exam_id !== 'new' && !Number.isNaN(numExamId)) {\n      setFetching(true);\n      getExam(numExamId)\n        .then((res) => {\n          if (res.success) {\n            const { type, results, title, weight, passed_at, group_id } = res.data;\n            setSelectedType(type);\n            setConvertedData({ group_id, exam_results: results });\n            form.setFieldsValue({ title, weight, passed_at });\n          }\n        })\n        .finally(() => setFetching(false));\n    }\n  }, [exam_id]);\n\n  const resetState = useCallback(() => {\n    setSelectedType(undefined);\n    setConvertedData(undefined);\n  }, []);\n\n  if (fetching) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      {selectedType && (\n        <ConvertGradesModal\n          open={Boolean(selectedType && !convertedData)}\n          type={selectedType}\n          closeModal={resetState}\n          onSuccess={setConvertedData}\n        />\n      )}\n      <ProForm\n        form={form}\n        submitter={selectedType === undefined || !convertedData ? false : undefined}\n        onFinish={async (formData: ExamFormValues) => {\n          // Validation since table has other form instance\n          const areExamResultsValid = convertedData?.exam_results?.every(\n            ({ result }) => typeof result === 'number' && result >= 0 && result <= 100,\n          );\n\n          if (convertedData && areExamResultsValid && typeof semester_subject_id === 'number') {\n            const { title, passed_at, weight } = formData;\n            const numExamId = Number(exam_id);\n            const { exam_results, group_id } = convertedData;\n\n            const reqData: API.CreateExamRequest = {\n              type: selectedType!,\n              semester_subject_id,\n              title,\n              passed_at,\n              weight,\n              group_id,\n              results: exam_results,\n            };\n\n            const response = Number.isNaN(numExamId)\n              ? await createExam(reqData)\n              : await updateExam(numExamId, reqData);\n            if (response.success) {\n              history.push(`/teacher/subjects/${semester_subject_id}/exams`);\n            }\n          }\n          return true;\n        }}\n        onReset={resetState}\n      >\n        <ProForm.Group>\n          <ProFormText\n            label={<FormattedMessage id=\"examTitle\" defaultMessage=\"examTitle\" />}\n            rules={[\n              {\n                required: true,\n                message: <FormattedMessage id=\"field_required\" />,\n              },\n            ]}\n            width=\"lg\"\n            name=\"title\"\n          />\n          <ProFormDatePicker\n            label={<FormattedMessage id=\"datePassingExam\" defaultMessage=\"datePassingExam\" />}\n            rules={[\n              {\n                required: true,\n                message: <FormattedMessage id=\"field_required\" />,\n              },\n            ]}\n            width=\"lg\"\n            name=\"passed_at\"\n          />\n          <ProForm.Item\n            name=\"weight\"\n            label={<FormattedMessage id=\"examImportance\" defaultMessage=\"examImportance\" />}\n            rules={[\n              { required: true, message: <FormattedMessage id=\"field_required\" /> },\n              {\n                type: 'number',\n                min: 1,\n                max: 100,\n                message: <FormattedMessage id=\"number_between\" values={{ min: 1, max: 100 }} />,\n              },\n            ]}\n          >\n            <InputNumber />\n          </ProForm.Item>\n        </ProForm.Group>\n        {selectedType && convertedData && (\n          <ProTable\n            rowKey=\"user_id\"\n            headerTitle={getGroupById(convertedData.group_id)?.name}\n            editable={{\n              type: 'single',\n              editableKeys,\n              onValuesChange: (record, dataSource) =>\n                setConvertedData({ group_id: convertedData.group_id, exam_results: dataSource }),\n            }}\n            cardProps={{ bodyStyle: { paddingInline: 0 } }}\n            search={false}\n            dataSource={convertedData.exam_results}\n            columns={staticColumns}\n          />\n        )}\n        {!convertedData && <SelectTypeButtonsGroup onSelect={setSelectedType} />}\n      </ProForm>\n    </>\n  );\n};\n","import React, { useState } from 'react';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { FormattedMessage } from 'umi';\n\nimport { getExam } from '@/services/escola-lms/exams';\n\ninterface Props {\n  exam_id: number;\n}\n\nconst columns: ProColumns<API.ExamResult>[] = [\n  { title: <FormattedMessage id=\"first_name\" />, dataIndex: 'first_name' },\n  { title: <FormattedMessage id=\"last_name\" />, dataIndex: 'last_name' },\n  { title: <FormattedMessage id=\"examResult\" />, dataIndex: 'result', hideInSearch: true },\n];\n\nexport const ExamResults: React.FC<Props> = ({ exam_id }) => {\n  const [title, setTitle] = useState('');\n\n  return (\n    <ProTable<API.ExamResult>\n      className=\"table-standalone\"\n      rowKey=\"user_id\"\n      search={false}\n      headerTitle={title}\n      request={async () => {\n        const response = await getExam(exam_id);\n\n        if (response.success) {\n          setTitle(response.data.title);\n\n          return {\n            total: response.data.results.length,\n            success: true,\n            data: response.data.results,\n          };\n        }\n\n        return [];\n      }}\n      columns={columns}\n    />\n  );\n};\n","import React, { useMemo, useRef } from 'react';\nimport { format } from 'date-fns';\nimport type { Location } from 'history';\nimport { FormattedMessage, Link, useLocation } from 'umi';\nimport { Button, Popconfirm, Tooltip } from 'antd';\nimport { DeleteOutlined, EditOutlined, LineChartOutlined } from '@ant-design/icons';\nimport ProTable from '@ant-design/pro-table';\nimport type { ActionType, ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { getExams, deleteExam } from '@/services/escola-lms/exams';\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport { ExamForm } from './ExamForm';\nimport { ExamResults } from './ExamResults';\nimport { useTeacherSubject } from '../context';\n\nconst staticColumns: ProColumns<API.Exam>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'id',\n    sorter: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"title\" defaultMessage=\"title\" />,\n    dataIndex: 'title',\n    hideInSearch: true,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"type\" defaultMessage=\"type\" />,\n    dataIndex: 'type',\n    sorter: true,\n    render: (_, record) => <FormattedMessage id={`ExamGradeType.${record.type}`} />,\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.exam_date\" defaultMessage=\"Exam date\" />,\n    dataIndex: 'passed_at',\n    sorter: true,\n    render: (_, record) => record.passed_at && format(new Date(record.passed_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.grade_weight\" defaultMessage=\"Weight\" />,\n    dataIndex: 'weight',\n    sorter: true,\n    render: (_, record) => record.weight + '%',\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" defaultMessage=\"Created at\" />,\n    dataIndex: 'created_at',\n    sorter: true,\n    render: (_, record) => record.created_at && format(new Date(record.created_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"semester\" defaultMessage=\"Semester\" />,\n    dataIndex: 'semester',\n    sorter: true,\n    render: (_, record) => (\n      <FormattedMessage\n        id={`SemesterType.${record.semester.type}`}\n        values={{ year: record.semester.year }}\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"group\" defaultMessage=\"Group\" />,\n    dataIndex: 'group_id',\n    sorter: true,\n    render: (_, record) => (\n      <TypeButtonDrawer key={record.group_id} type=\"Students\" type_id={record.group_id} />\n    ),\n  },\n];\n\nexport const Exams: React.FC = () => {\n  const actionRef = useRef<ActionType>();\n  const { semester_subject_id } = useTeacherSubject();\n  const location = useLocation() as Location & { query: { exam_id?: string; results?: string } };\n\n  const { exam_id, results } = useMemo(\n    () => ({ exam_id: location.query?.exam_id ?? null, results: location.query?.results }),\n    [location.query?.exam_id, location.query?.results],\n  );\n\n  if (results !== null && !Number.isNaN(Number(results))) {\n    return <ExamResults exam_id={Number(results)} />;\n  }\n\n  if (exam_id !== null) {\n    return <ExamForm exam_id={exam_id} />;\n  }\n\n  return (\n    <ProTable<API.Exam, API.ExamsParams>\n      className=\"table-standalone\"\n      headerTitle={<FormattedMessage id=\"exams\" />}\n      actionRef={actionRef}\n      search={false}\n      rowKey=\"id\"\n      request={async ({ current, pageSize }, sort) => {\n        if (semester_subject_id === null)\n          return {\n            data: [],\n            total: 0,\n            success: false,\n          };\n        const sortArr = sort && Object.entries(sort)[0];\n\n        const response = await getExams({\n          per_page: pageSize,\n          page: current,\n          semester_subject_id: !Number.isNaN(semester_subject_id) ? semester_subject_id : undefined,\n          order_by: sortArr && sortArr[0],\n          order: sortArr && (sortArr[1] === 'ascend' ? 'ASC' : 'DESC'),\n        });\n\n        if (response.success) {\n          return {\n            data: response.data,\n            total: response.meta.total,\n            success: true,\n          };\n        }\n\n        return {\n          data: [],\n          total: 0,\n          success: false,\n        };\n      }}\n      columns={[\n        ...staticColumns,\n        {\n          title: <FormattedMessage id=\"pages.searchTable.titleOption\" />,\n          dataIndex: 'option',\n          valueType: 'option',\n          render: (_, record) => [\n            <Link\n              to={`/teacher/subjects/${record.semester_subject_id}/exams?exam_id=${record.id}`}\n              key=\"edit\"\n            >\n              <Tooltip title={<FormattedMessage id=\"edit\" defaultMessage=\"edit\" />}>\n                <Button type=\"primary\" icon={<EditOutlined />} />\n              </Tooltip>\n            </Link>,\n            <Link\n              to={`/teacher/subjects/${record.semester_subject_id}/exams?results=${record.id}`}\n              key=\"results\"\n            >\n              <Tooltip\n                title={\n                  <FormattedMessage id=\"TeacherSubjects.Exams.results\" defaultMessage=\"results\" />\n                }\n              >\n                <Button icon={<LineChartOutlined />} />\n              </Tooltip>\n            </Link>,\n            <Popconfirm\n              key=\"delete\"\n              title={\n                <FormattedMessage\n                  id=\"deleteQuestion\"\n                  defaultMessage=\"Are you sure to delete this record?\"\n                />\n              }\n              onConfirm={async () => {\n                const response = await deleteExam(record.id);\n\n                if (response.success && actionRef.current) {\n                  actionRef.current.reload();\n                }\n              }}\n              okText={<FormattedMessage id=\"yes\" />}\n              cancelText={<FormattedMessage id=\"no\" />}\n            >\n              <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n                <Button type=\"primary\" icon={<DeleteOutlined />} danger />\n              </Tooltip>\n            </Popconfirm>,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  POST /api/admin/chats/ms-teams */\nexport async function createTeamsChat(\n  body: API.CreateTeamsChatRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.TeamsChat>>(`/api/admin/chats/ms-teams`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Button, message, Tooltip } from 'antd';\nimport { ExportOutlined } from '@ant-design/icons';\n\nimport { createTeamsChat } from '@/services/escola-lms/chats';\n\ninterface Props {\n  student_id: number;\n}\n\nexport const CreateTeamsChatButton: React.FC<Props> = ({ student_id }) => {\n  const [loading, setLoading] = useState(false);\n\n  const onClick = useCallback(async () => {\n    setLoading(true);\n    const response = await createTeamsChat({ user_id: student_id });\n    if (!response.success) {\n      message.error(response.message);\n      setLoading(false);\n      return;\n    }\n\n    window.open(response.data.web_url, '_blank', 'noopener noreferrer');\n    setLoading(false);\n  }, []);\n\n  return (\n    <Tooltip title={<FormattedMessage id=\"msTeams\" defaultMessage=\"teams\" />}>\n      <Button loading={loading} type=\"primary\" icon={<ExportOutlined />} onClick={onClick} />\n    </Tooltip>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { FormattedMessage } from 'umi';\nimport type { DefaultOptionType } from 'antd/lib/select';\nimport ProTable, { type ProColumns } from '@ant-design/pro-table';\n\nimport { allStudentsAndGroups as fetchAllStudentsAndGroups } from '@/services/escola-lms/student_user_groups';\nimport { useTeacherSubject } from '../context';\nimport { CreateTeamsChatButton } from './CreateTeamsChatButton';\n\ninterface TableDataProps {\n  group_id: number;\n  group_name: string;\n  user_id: number;\n  first_name: string;\n  last_name: string;\n  email: string;\n}\n\ninterface TableParams {\n  groups: number[];\n  first_name: string;\n  last_name: string;\n  email: string;\n}\n\nexport const TableColumns: ProColumns<TableDataProps>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'user_id',\n    hideInSearch: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"first_name\" defaultMessage=\"First name\" />,\n    dataIndex: 'first_name',\n  },\n  {\n    title: <FormattedMessage id=\"last_name\" defaultMessage=\"Last name\" />,\n    dataIndex: 'last_name',\n  },\n  {\n    title: <FormattedMessage id=\"email\" defaultMessage=\"email\" />,\n    dataIndex: 'email',\n  },\n  {\n    title: <FormattedMessage id=\"groupName\" defaultMessage=\"Group name\" />,\n    dataIndex: 'group_name',\n    hideInSearch: true,\n  },\n];\n\nconst getGroupsOptions = (subjectGroups: API.SubjectGroups[]): DefaultOptionType[] =>\n  subjectGroups.map(({ id, name }) => ({\n    label: name,\n    value: id,\n  }));\n\nconst getTableData = (studentUserGroups: API.StudentUserGroup[]): TableDataProps[] =>\n  studentUserGroups.reduce<TableDataProps[]>((acc, curr) => {\n    const userTable = curr?.users?.reduce<TableDataProps[]>(\n      (innerAcc, currentUser) =>\n        currentUser.academic_teacher_id !== null\n          ? innerAcc\n          : [\n              ...innerAcc,\n              {\n                group_id: curr.id,\n                group_name: curr.name,\n                user_id: currentUser.id,\n                first_name: currentUser.first_name,\n                last_name: currentUser.last_name,\n                email: currentUser.email,\n              },\n            ],\n      [],\n    );\n\n    return [...acc, ...userTable];\n  }, []);\n\nexport const Students: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => getGroupsOptions(teacherSubjectData?.groups ?? []),\n    [teacherSubjectData?.groups],\n  );\n\n  return (\n    <ProTable<TableDataProps, TableParams>\n      className=\"table-standalone\"\n      rowKey={(record) => `${record.group_id}-${record.user_id}`}\n      search={{ layout: 'vertical' }}\n      request={async ({ groups, first_name = '', last_name = '', email = '' }) => {\n        const response = await fetchAllStudentsAndGroups({\n          parent_id: teacherSubjectData?.group_id,\n          'id[]': groups,\n        });\n\n        if (!response.success) {\n          return { data: [], total: 0, success: false };\n        }\n\n        const tableData = getTableData(response.data).filter(\n          (record) =>\n            record.first_name.toLowerCase().includes(first_name.toLowerCase()) &&\n            record.last_name.toLowerCase().includes(last_name.toLowerCase()) &&\n            record.email.toLowerCase().includes(email.toLowerCase()),\n        );\n\n        return { data: tableData, total: tableData.length, success: true };\n      }}\n      columns={[\n        {\n          title: <FormattedMessage id=\"groups\" defaultMessage=\"Groups\" />,\n          dataIndex: 'groups',\n          hideInTable: true,\n          filterMultiple: true,\n          valueType: 'select',\n          fieldProps: {\n            options: groupOptions,\n            mode: 'multiple',\n          },\n        },\n        ...TableColumns,\n        {\n          hideInSearch: true,\n          title: <FormattedMessage id=\"msTeams\" />,\n          dataIndex: 'teamsLink',\n          valueType: 'option',\n          render: (_n, record) => [\n            <CreateTeamsChatButton key=\"teamsChat\" student_id={record.user_id} />,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import type { RequestOptionsInit } from 'umi-request';\nimport type { AttendanceValue } from './enums';\nimport { request } from 'umi';\n\nexport async function groupAttendanceSchedule(group_id: number, options?: RequestOptionsInit) {\n  return request<API.AttendanceScheduleList>(`/api/admin/schedules/groups/${group_id}`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\nexport async function changeStudentAttendance(\n  id: number,\n  user_id: number,\n  value: AttendanceValue,\n  options?: RequestOptionsInit,\n) {\n  return request<API.ChangeStudentAttendance>(`/api/admin/schedules/${id}/attendances`, {\n    data: {\n      attendances: [\n        {\n          user_id,\n          value,\n        },\n      ],\n    },\n    method: 'POST',\n    ...(options || {}),\n  });\n}\n","import { AttendanceValue } from '@/services/escola-lms/enums';\nimport type { AttendanceMap, Status } from './types';\n\nexport function parseToStatus(attendance: AttendanceValue | null): Status {\n  const attendanceMapped = attendance === null ? AttendanceValue.ABSENT : attendance;\n\n  const attendanceMap: AttendanceMap = {\n    [AttendanceValue.PRESENT]: { ch1: true, ch2: false },\n    [AttendanceValue.PRESENT_NOT_EXERCISING]: { ch1: true, ch2: true },\n    [AttendanceValue.ABSENT]: { ch1: false, ch2: false },\n    [AttendanceValue.EXCUSED_ABSENCE]: { ch1: false, ch2: true },\n  };\n\n  return attendanceMap[attendanceMapped] ?? { ch1: false, ch2: false };\n}\n\nexport function parseToAttendanceValue({ ch1, ch2 }: Status): AttendanceValue {\n  const statusStr = `${ch1}_${ch2}`;\n\n  const statusMap = {\n    true_false: AttendanceValue.PRESENT,\n    true_true: AttendanceValue.PRESENT_NOT_EXERCISING,\n    false_false: AttendanceValue.ABSENT,\n    false_true: AttendanceValue.EXCUSED_ABSENCE,\n  };\n\n  return statusMap[statusStr] ?? AttendanceValue.ABSENT;\n}\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Checkbox, Space, Tooltip } from 'antd';\nimport type { CheckboxChangeEvent } from 'antd/es/checkbox';\nimport { changeStudentAttendance } from '@/services/escola-lms/attendances';\n\nimport type { Status } from './types';\nimport { parseToAttendanceValue, parseToStatus } from './utils';\n\ninterface AttendanceCheckboxProps {\n  groupAttendanceScheduleId: number;\n  studentId: number;\n  attendance: API.AttendanceValue | null;\n  onSuccess?: () => void;\n}\n\nconst AttendanceCheckbox: React.FC<AttendanceCheckboxProps> = ({\n  groupAttendanceScheduleId,\n  studentId,\n  attendance,\n  onSuccess,\n}) => {\n  const [status, setStatus] = useState<Status>(parseToStatus(attendance));\n\n  const [loading, setLoading] = useState(false);\n  const firstMount = useRef(true);\n\n  const handleChangeAttendance = useCallback((stat: Status) => {\n    setLoading(true);\n    changeStudentAttendance(groupAttendanceScheduleId, studentId, parseToAttendanceValue(stat))\n      .then((res) => {\n        if (res.success) {\n          onSuccess?.();\n        }\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  const onCh1Change = useCallback(\n    (e: CheckboxChangeEvent) =>\n      setStatus(e.target.checked ? { ch1: true, ch2: false } : { ch1: false, ch2: false }),\n    [],\n  );\n\n  const onCh2Change = useCallback(\n    (e: CheckboxChangeEvent) => setStatus((prev) => ({ ...prev, ch2: e.target.checked })),\n    [],\n  );\n\n  useEffect(() => {\n    if (firstMount.current) {\n      firstMount.current = false;\n      return;\n    }\n\n    handleChangeAttendance(status);\n  }, [status, handleChangeAttendance]);\n\n  return (\n    <Space>\n      <Tooltip title={<FormattedMessage id=\"present\" />}>\n        <Checkbox disabled={loading} checked={status.ch1} onChange={onCh1Change} />\n      </Tooltip>\n      <Tooltip title={<FormattedMessage id={status.ch1 ? 'not_exercising' : 'excused_absence'} />}>\n        <Checkbox disabled={loading} checked={status.ch2} onChange={onCh2Change} />\n      </Tooltip>\n    </Space>\n  );\n};\n\nexport default AttendanceCheckbox;\n","import React, { useMemo, useRef, useState } from 'react';\nimport { format } from 'date-fns';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { message } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { groupAttendanceSchedule as fetchGroupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport { studentUserGroup as fetchStudentUserGroup } from '@/services/escola-lms/student_user_groups';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\nimport { useTeacherSubject } from '../context';\n\ntype AttendanceTableItem = { id: number; full_name: string } & Record<string, API.AttendanceValue>;\n\ninterface AttendanceTableFilters {\n  full_name?: string;\n  group_id?: number;\n}\n\nexport const Attendances: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n  const [dynamicCols, setDynamicCols] = useState<ProColumns<AttendanceTableItem>[]>([]);\n  const [selectedGroupName, setSelectedGroupName] = useState('');\n  const intl = useIntl();\n\n  const actionRef = useRef<ActionType>();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const columns: ProColumns<AttendanceTableItem>[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: groupOptions?.[0]?.value,\n          allowClear: false,\n        },\n      },\n      {\n        title: <FormattedMessage id=\"nameAndSurname\" defaultMessage=\"Name and surname\" />,\n        dataIndex: 'full_name',\n        fixed: 'left',\n      },\n      ...dynamicCols,\n    ],\n    [groupOptions, dynamicCols],\n  );\n\n  return (\n    <ProTable<AttendanceTableItem, AttendanceTableFilters>\n      className=\"table-standalone\"\n      headerTitle={`${intl.formatMessage({\n        id: 'attendances',\n        defaultMessage: 'Attendances',\n      })} (${selectedGroupName})`}\n      request={async ({ group_id = groupOptions?.[0]?.value, full_name = '' }) => {\n        const [studentUserGroupRes, groupAttendanceScheduleRes] = await Promise.all([\n          fetchStudentUserGroup(group_id),\n          fetchGroupAttendanceSchedule(group_id),\n        ]);\n        const selectedGroup = groupOptions.find(({ value }) => value === group_id);\n\n        if (!studentUserGroupRes.success || !groupAttendanceScheduleRes.success || !selectedGroup)\n          return { data: [], total: 0, success: false };\n\n        if (!groupAttendanceScheduleRes.data.length) {\n          message.error(\n            intl.formatMessage({\n              id: 'noAttendanceSchedule',\n              defaultMessage: 'No attendance schedule for this group...',\n            }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n\n        setSelectedGroupName(selectedGroup.label);\n        setDynamicCols(\n          groupAttendanceScheduleRes.data.reduce<ProColumns<AttendanceTableItem>[]>(\n            (acc, curr) => [\n              ...acc,\n              {\n                title: String(format(new Date(curr.date_from), DAY_FORMAT)),\n                dataIndex: String(curr.date_from),\n                hideInSearch: true,\n                width: 100,\n                align: 'center',\n                render: (_, record) => (\n                  <AttendanceCheckbox\n                    groupAttendanceScheduleId={curr.id}\n                    attendance={record[`${curr?.date_from}`]}\n                    studentId={record.id}\n                  />\n                ),\n              },\n            ],\n            [],\n          ),\n        );\n\n        const data = studentUserGroupRes.data.users\n          .reduce<AttendanceTableItem[]>(\n            (acc, { id, academic_teacher_id, first_name, last_name }) => {\n              const studentFullName = `${last_name} ${first_name}`;\n              // filter out tutor & first name and second name filter\n              if (\n                academic_teacher_id !== null ||\n                !studentFullName.toLowerCase().includes(full_name.toLowerCase())\n              )\n                return acc;\n\n              const studentAttendances = groupAttendanceScheduleRes.data.reduce<\n                Record<string, API.AttendanceValue>\n              >((innerAcc, groupAttendanceSchedule) => {\n                const studentAttendance = groupAttendanceSchedule.attendances.find(\n                  (attendance) => attendance.user_id === id,\n                );\n                if (!studentAttendance) return innerAcc;\n\n                return {\n                  ...innerAcc,\n                  [`${groupAttendanceSchedule.date_from}`]: studentAttendance.value,\n                };\n              }, {});\n\n              return [...acc, { id, full_name: studentFullName, ...studentAttendances }];\n            },\n            [],\n          )\n          .sort((a, b) => a.full_name.localeCompare(b.full_name));\n\n        return { data, total: data.length, success: true };\n      }}\n      columns={columns}\n      search={{ layout: 'vertical' }}\n      pagination={{ onChange: () => actionRef.current?.reload() }}\n      scroll={{ x: 1500 }}\n      actionRef={actionRef}\n      rowKey=\"id\"\n    />\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/semester-subjects/:semester_subject_id/tutors/:tutor_id/grades */\nexport async function getSubjectTutorGrades(\n  semester_subject_id: number,\n  tutor_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.SubjectTutorGrades>>(\n    `/api/admin/semester-subjects/${semester_subject_id}/tutors/${tutor_id}/grades`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  POST /api/admin/semester-subjects/:semester_subject_id/tutors/:tutor_id/grades */\nexport async function createSubjectTutorGrades(\n  semester_subject_id: number,\n  tutor_id: number,\n  body: API.CreateSubjectTutorGradesRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.GradeScale[]>>(\n    `/api/admin/semester-subjects/${semester_subject_id}/tutors/${tutor_id}/grades`,\n    {\n      method: 'POST',\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  GET /api/admin/lesson-group-users */\nexport async function getGroupFinalGrades(\n  group_id: number | number[],\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem[]>>(`/api/admin/lesson-group-users`, {\n    method: 'GET',\n    params: { 'groups[]': group_id },\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  GET /api/admin/lesson-group-users/groups/:group_id/users/:user_id */\nexport async function getUserFinalGrades(\n  group_id: number,\n  user_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(\n    `/api/admin/lesson-group-users/groups/${group_id}/users/${user_id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/** GET /api/admin/grade-terms */\nexport async function getGradeTerms(options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.GradeTerm[]>>(`/api/admin/grade-terms`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/** GET /api/admin/grade-scales/:s_subject_scale_form_id */\nexport async function getSubjectGradeScales(\n  s_subject_scale_form_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.SubjectGradeScale[]>>(\n    `/api/admin/grade-scales/${s_subject_scale_form_id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/** POST /api/admin/final-grades */\nexport async function createFinalGrade(\n  body: API.CreateFinalGradeRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(`/api/admin/final-grades`, {\n    method: 'POST',\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/** PATCH /api/admin/final-grades/:id */\nexport async function updateFinalGrade(\n  final_grade_id: number,\n  body: API.UpdateFinalGradeRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(\n    `/api/admin/final-grades/${final_grade_id}`,\n    {\n      method: 'PATCH',\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n","import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useModel } from 'umi';\nimport { Button, Divider, Select, Spin, Typography } from 'antd';\nimport ProForm from '@ant-design/pro-form';\nimport { EditableProTable } from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\nimport { CheckOutlined, EditOutlined } from '@ant-design/icons';\n\nimport { createSubjectTutorGrades, getSubjectTutorGrades } from '@/services/escola-lms/grades';\nimport { useTeacherSubject } from '../context';\n\ntype TableGradeScale = API.GradeScale & { id: string };\n\ninterface FormData {\n  table: TableGradeScale[];\n}\n\nconst staticColumns: ProColumns<TableGradeScale>[] = [\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n    editable: false,\n  },\n  {\n    title: <FormattedMessage id=\"degree\" />,\n    dataIndex: 'name',\n    editable: false,\n  },\n  {\n    title: <FormattedMessage id=\"min_percent\" />,\n    dataIndex: 'grade_value',\n    valueType: 'percent',\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n        {\n          type: 'number',\n          min: 0,\n          max: 100,\n          message: <FormattedMessage id=\"number_between\" values={{ min: 0, max: 100 }} />,\n        },\n      ],\n    },\n  },\n];\n\ninterface GradeScaleTableProps {\n  subjectTutorGradeScale: API.SubjectTutorGradeScale;\n  onFormSubmit: (formData: FormData) => Promise<void>;\n}\n\nconst GradeScaleTable: React.FC<GradeScaleTableProps> = ({\n  subjectTutorGradeScale,\n  onFormSubmit,\n}) => {\n  const [editableKeys, setEditableKeys] = useState<React.Key[]>([]);\n  const actionRef = useRef<ActionType>();\n\n  const [form] = ProForm.useForm<FormData>();\n\n  useEffect(() => {\n    const gradeScaleWithIds = (subjectTutorGradeScale.scale ?? []).map((values, i) => ({\n      ...values,\n      id: String((i + 1) * 100),\n    }));\n\n    form.setFieldValue('table', gradeScaleWithIds);\n  }, []);\n\n  return (\n    <ProForm<FormData>\n      form={form}\n      onFinish={onFormSubmit}\n      submitter={{ render: (_p, [, submit]) => [submit] }}\n    >\n      <EditableProTable<TableGradeScale>\n        name=\"table\"\n        rowKey=\"id\"\n        actionRef={actionRef}\n        formItemProps={{ label: <FormattedMessage id=\"grades-scale\" /> }}\n        cardProps={{ bodyStyle: { padding: 0 } }}\n        recordCreatorProps={false}\n        columns={[\n          ...staticColumns,\n          {\n            title: <FormattedMessage id=\"options\" />,\n            valueType: 'option',\n            render: (_n, row) => (\n              <Button\n                type=\"primary\"\n                onClick={() => actionRef.current?.startEditable(row.id)}\n                icon={<EditOutlined />}\n              />\n            ),\n          },\n        ]}\n        editable={{\n          form,\n          type: 'multiple',\n          editableKeys,\n          saveText: <Button type=\"primary\" icon={<CheckOutlined />} />,\n          onChange: setEditableKeys,\n          actionRender: (_r, _c, dom) => [dom.save],\n        }}\n      />\n    </ProForm>\n  );\n};\n\nexport const GradesScale: React.FC = () => {\n  const { initialState } = useModel('@@initialState');\n  const { semester_subject_id, tutors } = useTeacherSubject();\n\n  const [subjectTutorGrades, setSubjectTutorGrades] = useState<API.SubjectTutorGrades>();\n  const [loading, setLoading] = useState(false);\n  const [selectedTutor, setSelectedTutor] = useState<number | null>(null);\n\n  const tutorViewing = useMemo(\n    () => !!tutors.data.find(({ id }) => id === initialState?.currentUser?.id),\n    [tutors.data, initialState?.currentUser?.id],\n  );\n  const tutorsSelectOptions = useMemo(\n    () =>\n      tutors.data.map(({ id, first_name, last_name }) => ({\n        label: `${first_name} ${last_name}`,\n        value: id,\n      })),\n    [tutors.data],\n  );\n\n  const refreshSubjectTutorGrades = useCallback(() => {\n    if (semester_subject_id === null || selectedTutor === null) return;\n\n    setLoading(true);\n    setSubjectTutorGrades(undefined);\n    getSubjectTutorGrades(semester_subject_id, selectedTutor)\n      .then((response) => {\n        if (response.success) {\n          setSubjectTutorGrades(response.data);\n        }\n      })\n      .finally(() => {\n        setLoading(false);\n      });\n  }, [semester_subject_id, selectedTutor]);\n\n  const onFormSubmitFactory = useCallback(\n    (subjectTutorGradeScales: API.SubjectTutorGradeScale[], s_subject_scale_form_id: number) =>\n      async (formData: FormData) => {\n        if (semester_subject_id === null || selectedTutor === null) return;\n\n        const grade_scale = subjectTutorGradeScales.reduce<API.SubjectTutorGradeScale[]>(\n          (acc, tutorGradeScale) =>\n            tutorGradeScale.s_subject_scale_form_id === s_subject_scale_form_id\n              ? [\n                  ...acc,\n                  {\n                    s_subject_scale_form_id,\n                    scale: formData.table.map(({ name, grade, grade_value }) => ({\n                      name,\n                      grade,\n                      grade_value,\n                    })),\n                  },\n                ]\n              : [...acc, tutorGradeScale],\n          [],\n        );\n\n        const res = await createSubjectTutorGrades(semester_subject_id, selectedTutor, {\n          grade_scale,\n        });\n\n        if (res.success) {\n          refreshSubjectTutorGrades();\n        }\n      },\n    [selectedTutor, semester_subject_id],\n  );\n\n  useEffect(() => {\n    if (!tutorViewing || !initialState?.currentUser?.id) {\n      if (tutors.data?.[0]) {\n        setSelectedTutor(tutors.data?.[0].id);\n      }\n      return;\n    }\n\n    setSelectedTutor(initialState?.currentUser?.id);\n  }, [initialState?.currentUser?.id, tutorViewing]);\n\n  useEffect(() => {\n    refreshSubjectTutorGrades();\n  }, [refreshSubjectTutorGrades]);\n\n  if (tutors.loading) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      <ProForm.Item label={<FormattedMessage id=\"menu.Teacher\" />}>\n        <Select\n          disabled={tutorViewing}\n          placeholder={<FormattedMessage id=\"select\" />}\n          options={tutorsSelectOptions}\n          value={selectedTutor}\n          onChange={(v) => setSelectedTutor(v)}\n        />\n      </ProForm.Item>\n      <Divider />\n      {loading && !subjectTutorGrades && <Spin />}\n      {subjectTutorGrades?.grade_scale ? (\n        subjectTutorGrades.grade_scale.map((subjectTutorGradeScale, i) => (\n          <React.Fragment key={subjectTutorGradeScale.s_subject_scale_form_id}>\n            {i > 0 && <Divider />}\n            <GradeScaleTable\n              subjectTutorGradeScale={subjectTutorGradeScale}\n              onFormSubmit={onFormSubmitFactory(\n                subjectTutorGrades.grade_scale ?? [],\n                subjectTutorGradeScale.s_subject_scale_form_id,\n              )}\n            />\n          </React.Fragment>\n        ))\n      ) : (\n        <Typography.Paragraph style={{ textAlign: 'center' }}>\n          <FormattedMessage id=\"gradesScalesMissing\" />\n        </Typography.Paragraph>\n      )}\n    </>\n  );\n};\n","import type { RequestOptionsInit } from 'umi-request';\nimport { request } from 'umi';\n\nexport async function allSchedules(\n  params: API.PageParams &\n    API.PaginationParams & {\n      // query\n      semester_subject_id?: number | null;\n      date_form?: Date;\n      date_to?: Date;\n      group_id?: number;\n      term_status_id?: number;\n    },\n  options?: RequestOptionsInit,\n) {\n  return request<API.ScheduleList>(`/api/admin/schedules`, {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useEffect, useState, useMemo } from 'react';\nimport moment from 'moment';\nimport { FormattedMessage } from 'umi';\nimport { Badge, Button, Modal, Typography, Calendar } from 'antd';\nimport type { CalendarMode } from 'antd/lib/calendar/generateCalendar';\n\nimport { DAYTIME_FORMAT } from '@/consts/dates';\nimport { allSchedules as fetchAllSchedules } from '@/services/escola-lms/schedules';\nimport { useTeacherSubject } from '../context';\nimport './index.css';\n\ninterface EventCalendarProps {\n  id: number;\n  title: string;\n  start: Date | string;\n  end: Date | string;\n  tutor_name: string;\n  tutor_email: string;\n  group: string;\n  semester: string;\n  subject: string;\n  ms_teams_join_url: string | null;\n}\n\nexport const Schedule: React.FC = () => {\n  const [selectedEvent, setSelectedEvent] = useState<EventCalendarProps | null>(null);\n  const [eventData, setEventData] = useState<API.ScheduleData[]>([]);\n  const { semester_subject_id } = useTeacherSubject();\n  const now = moment();\n\n  const events: EventCalendarProps[] = useMemo(\n    () =>\n      eventData.map((event) => ({\n        id: event.id,\n        title: `${event.group.name} (${event.term_status.name})`,\n        start: moment(event.date_from).toDate(),\n        end: moment(event.date_to).toDate(),\n        tutor_name: `${event.tutor.first_name} ${event.tutor.last_name}`,\n        tutor_email: event.tutor.email,\n        semester: event.semester.name,\n        group: event.group.name,\n        subject: event.subject.name,\n        ms_teams_join_url: event.ms_teams_join_url,\n      })),\n    [eventData],\n  );\n\n  const fetchEvents = useCallback(\n    (start: moment.Moment, end: moment.Moment) => {\n      fetchAllSchedules({\n        semester_subject_id: semester_subject_id,\n        date_form: start.toDate(),\n        date_to: end.toDate(),\n      }).then((response) => {\n        if (response.success) {\n          setEventData(response.data);\n        }\n      });\n    },\n    [semester_subject_id],\n  );\n\n  const handleEventClick = useCallback((event: EventCalendarProps) => {\n    setSelectedEvent(event);\n  }, []);\n\n  const handleModalClose = useCallback(() => {\n    setSelectedEvent(null);\n  }, []);\n\n  const checkDate = useCallback((date: moment.Moment) => {\n    if (date.isSame(now, 'day')) {\n      return 'warning';\n    }\n    return date.isAfter(now, 'day') ? 'success' : 'error';\n  }, []);\n\n  const dateCellRender = useCallback(\n    (date: moment.Moment) => {\n      const filteredEvents = events.filter((event) => moment(event.start).isSame(date, 'day'));\n\n      return (\n        <ul className=\"events\">\n          {filteredEvents.map((event) => (\n            <li key={event.id} onClick={() => handleEventClick(event)}>\n              <Badge status={checkDate(moment(event.start))} text={event.title} />\n            </li>\n          ))}\n        </ul>\n      );\n    },\n    [eventData],\n  );\n\n  const handlePanelChange = useCallback((date: moment.Moment, mode: CalendarMode) => {\n    const start = moment(date).startOf(mode).subtract(1, 'month');\n    const end = moment(date).endOf(mode).add(1, 'month');\n    fetchEvents(start, end);\n  }, []);\n\n  useEffect(() => {\n    const initialStartDate = moment().startOf('month');\n    const initialEndDate = moment().endOf('month');\n    fetchEvents(initialStartDate, initialEndDate);\n  }, []);\n  return (\n    <>\n      <Typography.Title level={4}>\n        <FormattedMessage id=\"schedule\" defaultMessage=\"Schedule\" />\n      </Typography.Title>\n\n      <Calendar dateCellRender={dateCellRender} onPanelChange={handlePanelChange} />\n\n      <Modal\n        open={selectedEvent !== null}\n        title={`${selectedEvent?.subject}: ${selectedEvent?.title}`}\n        onCancel={handleModalClose}\n        footer={null}\n      >\n        <Typography.Paragraph>\n          <FormattedMessage id=\"tutorName\" defaultMessage=\"Tutor\" />: {selectedEvent?.tutor_name}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"email\" defaultMessage=\"Email\" />: {selectedEvent?.tutor_email}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"group\" defaultMessage=\"Group\" />: {selectedEvent?.group}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"semester\" defaultMessage=\"Semester\" />: {selectedEvent?.semester}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"started_at\" defaultMessage=\"Start date\" />:\n          {selectedEvent && moment(selectedEvent.start).format(DAYTIME_FORMAT)}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"end_at\" defaultMessage=\"End date\" />:\n          {selectedEvent && moment(selectedEvent.end).format(DAYTIME_FORMAT)}\n        </Typography.Paragraph>\n        {selectedEvent?.ms_teams_join_url && (\n          <Typography.Paragraph>\n            <a\n              href={selectedEvent.ms_teams_join_url}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              key=\"teamsLink\"\n            >\n              <Button type=\"primary\">\n                <FormattedMessage id=\"msTeams\" />\n              </Button>\n            </a>\n          </Typography.Paragraph>\n        )}\n      </Modal>\n    </>\n  );\n};\n","import type { StudentExam } from './types';\n\nexport const getStudentExamsFromExams = (exams: API.Exam[], student_id: number): StudentExam[] =>\n  exams.reduce<StudentExam[]>((acc, { results, ...exam }) => {\n    const result = results.find((examResult) => examResult.user_id === student_id);\n    if (!result) return acc;\n\n    return [...acc, { ...exam, result }];\n  }, []);\n\nexport const getProposedGrade = (\n  studentExams: StudentExam[],\n  tutorGradeScales: API.GradeScale[],\n): string => {\n  const [sum, weightsSum] = studentExams.reduce<[number, number]>(\n    (acc, { result, weight }) => [acc[0] + result.result * weight, acc[1] + weight],\n    [0, 0],\n  );\n  const weightedAverage = Number.isNaN(sum / weightsSum) ? 0 : sum / weightsSum;\n\n  const sortedGradeScales = tutorGradeScales\n    .sort((a, b) => a.grade_value - b.grade_value)\n    .reduce<(API.GradeScale & { isWeightedAverageGreater: boolean })[]>(\n      (acc, curr) => [\n        ...acc,\n        {\n          ...curr,\n          isWeightedAverageGreater: weightedAverage >= curr.grade_value,\n        },\n      ],\n      [],\n    );\n\n  if (sortedGradeScales.every(({ isWeightedAverageGreater }) => isWeightedAverageGreater)) {\n    return sortedGradeScales.at(-1)?.name ?? '';\n  }\n\n  const firstFalseIndex = sortedGradeScales.findIndex(\n    ({ isWeightedAverageGreater }) => !isWeightedAverageGreater,\n  );\n  if (firstFalseIndex < 0) return '';\n\n  return sortedGradeScales[firstFalseIndex - 1]?.name;\n};\n\nexport const getScalesBySubjectScaleFormId = (\n  s_subject_scale_form_id: number,\n  tutorGrades: API.SubjectTutorGradeScale[],\n): API.GradeScale[] | undefined =>\n  tutorGrades.find(\n    (subjectTutorGradeScale) =>\n      subjectTutorGradeScale.s_subject_scale_form_id === s_subject_scale_form_id,\n  )?.scale;\n","import { useCallback, useEffect, useState } from 'react';\nimport { groupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport {\n  getGradeTerms,\n  getUserFinalGrades,\n  getSubjectGradeScales,\n  getSubjectTutorGrades,\n} from '@/services/escola-lms/grades';\nimport { getExams } from '@/services/escola-lms/exams';\nimport { course, getCourseStats, program } from '@/services/escola-lms/course';\nimport { getFlatTopics } from '@/components/ProgramForm/Context';\nimport { getScalesBySubjectScaleFormId, getStudentExamsFromExams } from './utils';\nimport type { FetchedData, StudentExam } from './types';\n\nexport function useFinalGrades(group_id: number, user_id: number) {\n  const [finalGrades, setFinalGrades] = useState<FetchedData<API.FinalGradeItem>>({\n    loading: false,\n  });\n\n  useEffect(() => {\n    setFinalGrades((prev) => ({ ...prev, loading: true }));\n    getUserFinalGrades(group_id, user_id)\n      .then((response) => {\n        if (response.success) {\n          setFinalGrades((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setFinalGrades((prev) => ({ ...prev, loading: false }));\n      });\n  }, [user_id, group_id]);\n\n  return { finalGrades };\n}\n\nexport function useGradeTerms() {\n  const [gradeTerms, setGradeTerms] = useState<FetchedData<API.GradeTerm[]>>({ loading: false });\n\n  useEffect(() => {\n    setGradeTerms((prev) => ({ ...prev, loading: true }));\n    getGradeTerms()\n      .then((response) => {\n        if (response.success) {\n          setGradeTerms((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setGradeTerms((prev) => ({ ...prev, loading: false }));\n      });\n  }, []);\n\n  return { gradeTerms };\n}\n\nexport function useSubjectGradeScales(s_subject_scale_form_id: number | undefined) {\n  const [subjectGradeScales, setSubjectGradeScales] = useState<\n    FetchedData<API.SubjectGradeScale[]>\n  >({\n    loading: false,\n  });\n\n  useEffect(() => {\n    if (s_subject_scale_form_id === undefined) return;\n\n    setSubjectGradeScales((prev) => ({ ...prev, loading: true }));\n    getSubjectGradeScales(s_subject_scale_form_id)\n      .then((response) => {\n        if (response.success) {\n          setSubjectGradeScales((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setSubjectGradeScales((prev) => ({ ...prev, loading: false }));\n      });\n  }, [s_subject_scale_form_id]);\n\n  return { subjectGradeScales };\n}\n\nexport function useTutorGradeScales(\n  semester_subject_id: number | undefined | null,\n  tutor_id: number | undefined | null,\n  s_subject_scale_form_id: number | undefined | null,\n) {\n  const [tutorGradeScales, setTutorGradeScales] = useState<FetchedData<API.GradeScale[]>>({\n    loading: false,\n  });\n\n  useEffect(() => {\n    if (\n      typeof semester_subject_id !== 'number' ||\n      typeof tutor_id !== 'number' ||\n      typeof s_subject_scale_form_id !== 'number'\n    )\n      return;\n\n    setTutorGradeScales((prev) => ({ ...prev, loading: true }));\n    getSubjectTutorGrades(semester_subject_id, tutor_id)\n      .then((response) => {\n        if (response.success) {\n          setTutorGradeScales((prev) => ({\n            ...prev,\n            data: getScalesBySubjectScaleFormId(\n              s_subject_scale_form_id,\n              response.data.grade_scale ?? [],\n            )?.map((v, i) => ({ ...v, id: i })),\n          }));\n        }\n      })\n      .finally(() => {\n        setTutorGradeScales((prev) => ({ ...prev, loading: false }));\n      });\n  }, [semester_subject_id, tutor_id]);\n\n  return { tutorGradeScales };\n}\n\nexport function useUserAttendanceSchedules(group_id: number, user_id: number) {\n  const [userAttendanceSchedules, setUserAttendanceSchedules] = useState<\n    FetchedData<API.UserAttendanceSchedule[]>\n  >({ loading: false });\n\n  const fetchUserAttendanceSchedules = useCallback(() => {\n    setUserAttendanceSchedules((prev) => ({ ...prev, loading: true }));\n    groupAttendanceSchedule(group_id)\n      .then((response) => {\n        if (response.success) {\n          const filteredSchedules = response.data.reduce<API.UserAttendanceSchedule[]>(\n            (acc, { attendances, ...rest }) => {\n              const attendance = attendances.find(\n                (attendanceItem) => attendanceItem.user_id === user_id,\n              );\n\n              if (!attendance) return acc;\n\n              return [...acc, { ...rest, attendance }];\n            },\n            [],\n          );\n\n          setUserAttendanceSchedules((prev) => ({ ...prev, data: filteredSchedules }));\n        }\n      })\n      .finally(() => {\n        setUserAttendanceSchedules((prev) => ({ ...prev, loading: false }));\n      });\n  }, [group_id, user_id]);\n\n  useEffect(() => {\n    fetchUserAttendanceSchedules();\n  }, [fetchUserAttendanceSchedules]);\n\n  return { userAttendanceSchedules, fetchUserAttendanceSchedules };\n}\n\nexport function useStudentExams(student_id: number, semester_subject_id: number | null) {\n  const [studentExams, setStudentExams] = useState<FetchedData<StudentExam[]>>({ loading: false });\n\n  useEffect(() => {\n    if (!semester_subject_id) return;\n    setStudentExams((prev) => ({ ...prev, loading: true }));\n    getExams({ student_id, semester_subject_id })\n      .then((response) => {\n        if (response.success) {\n          const data = getStudentExamsFromExams(response.data, student_id);\n\n          setStudentExams((prev) => ({ ...prev, data }));\n        }\n      })\n      .finally(() => {\n        setStudentExams((prev) => ({ ...prev, loading: false }));\n      });\n  }, [student_id, semester_subject_id]);\n\n  return { studentExams };\n}\n\nexport function useUserCoursesStats(group_id: number, user_id: number) {\n  const [userCourses, setUserCourses] = useState<FetchedData<API.Course[]>>({\n    loading: false,\n  });\n  const [userCoursesStats, setUserCoursesStats] = useState<\n    FetchedData<\n      Record<\n        string,\n        { finishedTopics: API.FinishedTopicsUserStats[]; attendanceList: API.CourseAttempts[] }\n      >\n    >\n  >({ loading: false });\n  const [userCoursesTopics, setUserCoursesTopics] = useState<\n    FetchedData<Record<string, API.Topic[]>>\n  >({ loading: false });\n\n  useEffect(() => {\n    setUserCourses((prev) => ({ ...prev, loading: true }));\n    course({ group_id })\n      .then((response) => {\n        if (response.success) {\n          setUserCourses((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setUserCourses((prev) => ({ ...prev, loading: false }));\n      });\n  }, [group_id]);\n\n  useEffect(() => {\n    if (!userCourses.data) return;\n\n    setUserCoursesTopics((prev) => ({ ...prev, loading: true }));\n    Promise.all(userCourses.data.map(({ id }) => program(Number(id))))\n      .then((responses) => {\n        responses.forEach((response) => {\n          if (response.success) {\n            setUserCoursesTopics((prev) => ({\n              ...prev,\n              data: {\n                ...prev.data,\n                [Number(response.data.id)]: getFlatTopics(response.data.lessons),\n              },\n            }));\n          }\n        });\n      })\n      .finally(() => {\n        setUserCoursesTopics((prev) => ({ ...prev, loading: false }));\n      });\n\n    setUserCoursesStats((prev) => ({ ...prev, loading: true }));\n    Promise.all(\n      userCourses.data.map(({ id }) =>\n        getCourseStats(Number(id), [\n          'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics',\n          'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\AttendanceList',\n        ]).then((response) => {\n          if (response.success) {\n            const finishedTopics = (\n              response.data['EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics'] ?? []\n            ).filter((userStat) => userStat.id === user_id);\n\n            const attendanceList =\n              response.data['EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\AttendanceList'] ?? [];\n\n            setUserCoursesStats((prev) => ({\n              ...prev,\n              data: {\n                ...prev.data,\n                [Number(id)]: { finishedTopics, attendanceList },\n              },\n            }));\n          }\n        }),\n      ),\n    ).finally(() => setUserCoursesStats((prev) => ({ ...prev, loading: false })));\n  }, [userCourses.data, user_id]);\n\n  return { userCourses, userCoursesStats, userCoursesTopics };\n}\n","import React, { useCallback, useMemo } from 'react';\nimport { FormattedMessage, history } from 'umi';\nimport { format } from 'date-fns';\nimport { Col, Divider, message, Row, Spin, Typography } from 'antd';\nimport ProForm, { ProFormSelect } from '@ant-design/pro-form';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { createFinalGrade, updateFinalGrade } from '@/services/escola-lms/grades';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\nimport { UserCourseAttempts, UserProgress } from '@/components/CourseStatistics/userProgress';\nimport { useTeacherSubject } from '../../context';\nimport {\n  useFinalGrades,\n  useSubjectGradeScales,\n  useGradeTerms,\n  useUserAttendanceSchedules,\n  useStudentExams,\n  useTutorGradeScales,\n  useUserCoursesStats,\n} from './hooks';\nimport type { StudentExam } from './types';\nimport { getProposedGrade } from './utils';\n\ninterface Props {\n  user_id: number;\n  group_id: number;\n}\n\ninterface FormData {\n  grade_term_id: number;\n  grade_scale_id: number;\n}\n\ntype FinalGradeTableItem = API.GradeTerm & { grade?: API.FinalGradeItemGrade };\n\nconst tutorGradeScalesColumns: ProColumns<API.GradeScale>[] = [\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n  },\n  {\n    title: <FormattedMessage id=\"degree\" />,\n    dataIndex: 'name',\n  },\n  {\n    title: <FormattedMessage id=\"min_percent\" />,\n    dataIndex: 'grade_value',\n    valueType: 'percent',\n  },\n];\n\nconst userAttendanceColumns: ProColumns<API.UserAttendanceSchedule>[] = [\n  {\n    title: <FormattedMessage id=\"date\" />,\n    dataIndex: 'date_from',\n    render: (_n, row) => format(new Date(row.date_from), DAY_FORMAT),\n  },\n];\n\nconst studentExamsColumns: ProColumns<StudentExam>[] = [\n  {\n    title: <FormattedMessage id=\"name\" />,\n    dataIndex: 'title',\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.grade_weight\" defaultMessage=\"Weight\" />,\n    dataIndex: 'weight',\n    valueType: 'percent',\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" defaultMessage=\"Created at\" />,\n    dataIndex: 'created_at',\n    render: (_n, row) => format(new Date(row.created_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'result',\n    render: (_n, row) => `${row.result.result}%`,\n  },\n];\n\nconst finalGradesColumns: ProColumns<FinalGradeTableItem>[] = [\n  {\n    title: <FormattedMessage id=\"name\" />,\n    dataIndex: 'name',\n  },\n  {\n    title: <FormattedMessage id=\"issued_at\" />,\n    dataIndex: 'grade',\n    render: (_n, row) =>\n      row.grade?.grade_date ? format(new Date(row.grade?.grade_date), DAY_FORMAT) : '-',\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n    render: (_n, row) => row.grade?.grade_name ?? '-',\n  },\n];\n\nconst TABLE_PAGE_SIZE = 6;\n\nexport const FinalGradesDetails: React.FC<Props> = ({ user_id, group_id }) => {\n  const { semester_subject_id } = useTeacherSubject();\n  const { studentExams } = useStudentExams(user_id, semester_subject_id);\n  const { finalGrades } = useFinalGrades(group_id, user_id);\n  const { gradeTerms } = useGradeTerms();\n  const { subjectGradeScales } = useSubjectGradeScales(finalGrades.data?.s_subject_scale_form_id);\n  const { tutorGradeScales } = useTutorGradeScales(\n    semester_subject_id,\n    finalGrades.data?.tutor_id,\n    finalGrades.data?.s_subject_scale_form_id,\n  );\n  const { userAttendanceSchedules, fetchUserAttendanceSchedules } = useUserAttendanceSchedules(\n    group_id,\n    user_id,\n  );\n  const { userCourses, userCoursesStats, userCoursesTopics } = useUserCoursesStats(\n    group_id,\n    user_id,\n  );\n\n  const [form] = ProForm.useForm<FormData>();\n\n  const gradeTermsSelectOptions = useMemo(\n    () => (gradeTerms.data ?? []).map(({ id, name }) => ({ label: name, value: id })),\n    [gradeTerms.data],\n  );\n\n  const gradesSelectOptions = useMemo(\n    () =>\n      (subjectGradeScales.data ?? []).map(({ name, id }) => ({\n        label: name,\n        value: id,\n      })),\n    [subjectGradeScales.data],\n  );\n\n  const proposedGrade = useMemo(\n    () => getProposedGrade(studentExams.data ?? [], tutorGradeScales.data ?? []),\n    [studentExams.data, tutorGradeScales.data],\n  );\n\n  const onFinalGradeSubmit = useCallback(\n    async ({ grade_scale_id, grade_term_id }: FormData) => {\n      if (finalGrades.data?.id === undefined) return;\n\n      const existingFinalGrade = finalGrades.data?.grades.find(\n        ({ grade_term }) => grade_term.id === grade_term_id,\n      );\n\n      if (existingFinalGrade) {\n        const response = await updateFinalGrade(existingFinalGrade.id, { grade_scale_id });\n\n        message[response.success ? 'success' : 'error'](response.message);\n        if (response.success) {\n          history.push(`/teacher/subjects/${semester_subject_id}/final-grades`);\n        }\n        return;\n      }\n\n      const response = await createFinalGrade({\n        grade_scale_id,\n        grade_term_id,\n        lesson_group_user_id: finalGrades.data.id,\n      });\n\n      message[response.success ? 'success' : 'error'](response.message);\n\n      if (response.success) {\n        history.push(`/teacher/subjects/${semester_subject_id}/final-grades`);\n      }\n    },\n    [finalGrades.data, semester_subject_id],\n  );\n\n  const finalGradesTableData: FinalGradeTableItem[] = useMemo(\n    () =>\n      (gradeTerms.data ?? []).map((term) => ({\n        ...term,\n        grade: finalGrades.data?.grades.find(({ grade_term }) => grade_term.id === term.id),\n      })),\n    [finalGrades.data, gradeTerms.data],\n  );\n\n  const areStatisticsLoading =\n    (userCourses.loading && !userCourses.data) ||\n    (userCoursesStats.loading && !userCoursesStats.data) ||\n    (userCoursesTopics.loading && !userCoursesTopics.data);\n\n  const isStatisticDataPresent = Boolean(\n    userCourses.data && userCoursesStats.data && userCoursesTopics.data,\n  );\n\n  if (finalGrades.loading) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      {finalGrades.data && (\n        <>\n          <Typography.Text style={{ fontSize: '16px', fontWeight: 500 }}>\n            <FormattedMessage\n              id=\"TeacherSubjects.FinalGrades.Student\"\n              values={finalGrades.data.user}\n            />\n          </Typography.Text>\n          <Divider />\n        </>\n      )}\n      <Row gutter={[48, 48]} justify=\"space-between\">\n        <Col span={12}>\n          <ProTable\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.StudentPartialGrades\" />}\n            search={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            dataSource={studentExams.data}\n            loading={studentExams.loading}\n            columns={studentExamsColumns}\n            options={false}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.FinalGrades\" />}\n            search={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            dataSource={finalGradesTableData}\n            loading={finalGrades.loading || gradeTerms.loading}\n            columns={finalGradesColumns}\n            options={false}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable<API.UserAttendanceSchedule>\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.Attendances\" />}\n            search={false}\n            options={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n            dataSource={userAttendanceSchedules.data}\n            loading={userAttendanceSchedules.loading}\n            columns={[\n              ...userAttendanceColumns,\n              {\n                title: <FormattedMessage id=\"TeacherSubjects.FinalGrades.Attendance\" />,\n                dataIndex: 'attendance',\n                render: (_n, row) => (\n                  <AttendanceCheckbox\n                    groupAttendanceScheduleId={row.id}\n                    studentId={user_id}\n                    attendance={row.attendance.value}\n                    onSuccess={fetchUserAttendanceSchedules}\n                  />\n                ),\n              },\n            ]}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable<API.GradeScale>\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.GradesScale\" />}\n            search={false}\n            options={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n            dataSource={tutorGradeScales.data}\n            loading={tutorGradeScales.loading}\n            columns={tutorGradeScalesColumns}\n          />\n        </Col>\n        {areStatisticsLoading && <Spin />}\n        {isStatisticDataPresent &&\n          userCourses.data?.map(({ id, title }) => (\n            <Col key={id} span={24}>\n              <Typography.Text style={{ fontSize: '16px', fontWeight: 500 }}>\n                {title}\n              </Typography.Text>\n              <UserProgress\n                course_id={Number(id)}\n                topics={userCoursesTopics.data?.[Number(id)] ?? []}\n                stats={userCoursesStats.data?.[Number(id)]?.finishedTopics ?? []}\n              />\n              <UserCourseAttempts\n                stats={userCoursesStats.data?.[Number(id)]?.attendanceList ?? []}\n              />\n            </Col>\n          ))}\n      </Row>\n      <ProForm<FormData> form={form} onFinish={onFinalGradeSubmit}>\n        <ProForm.Group\n          style={{ display: 'flex', flexDirection: 'column', paddingTop: '48px' }}\n          title={<FormattedMessage id=\"TeacherSubjects.FinalGrades.IssueAssessment\" />}\n          titleStyle={{ flex: 'unset' }}\n          align=\"center\"\n        >\n          <ProFormSelect\n            name=\"grade_term_id\"\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            label={<FormattedMessage id=\"TeacherSubjects.FinalGrades.GradeTerm\" />}\n            options={gradeTermsSelectOptions}\n            width=\"sm\"\n            fieldProps={{ loading: gradeTerms.loading }}\n          />\n          <ProFormSelect\n            name=\"grade_scale_id\"\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            label={<FormattedMessage id=\"TeacherSubjects.FinalGrades.FinalGrade\" />}\n            options={gradesSelectOptions}\n            fieldProps={{ loading: finalGrades.loading || subjectGradeScales.loading }}\n          />\n          <ProForm.Item>\n            <FormattedMessage\n              id=\"TeacherSubjects.FinalGrades.ProposedGrade\"\n              values={{ grade: proposedGrade }}\n            />\n          </ProForm.Item>\n        </ProForm.Group>\n      </ProForm>\n    </>\n  );\n};\n","import React, { useMemo } from 'react';\nimport type { Location } from 'history';\nimport { FormattedMessage, Link, useLocation } from 'umi';\nimport { Button, Tooltip, Typography } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport { EditOutlined } from '@ant-design/icons';\n\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport { getGroupFinalGrades } from '@/services/escola-lms/grades';\nimport { FinalGradesDetails } from './FinalGradesDetails';\nimport { useTeacherSubject } from '../context';\n\ninterface TableParams {\n  group_id?: number[];\n  first_name?: string;\n  last_name?: string;\n}\n\nconst staticColumns: ProColumns<API.FinalGradeItem>[] = [\n  {\n    title: <FormattedMessage id=\"first_name\" />,\n    dataIndex: 'first_name',\n    render: (_n, row) => row.user.first_name,\n  },\n  {\n    title: <FormattedMessage id=\"last_name\" />,\n    dataIndex: 'last_name',\n    render: (_n, row) => row.user.last_name,\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    hideInSearch: true,\n    dataIndex: 'grades',\n    render: (_n, row) => (\n      <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>\n        {row.grades.length\n          ? row.grades.map(({ grade_name, grade_term, id }) => (\n              <Typography.Text key={id}>\n                {grade_term.name}: {grade_name}\n              </Typography.Text>\n            ))\n          : '-'}\n      </div>\n    ),\n  },\n];\n\nexport const FinalGradesList: React.FC = () => {\n  const location = useLocation() as Location & { query: { user_id?: string; group_id?: string } };\n  const { user_id, group_id } = useMemo(\n    () => ({\n      user_id: Number.isNaN(Number(location.query?.user_id))\n        ? null\n        : Number(location.query?.user_id),\n      group_id: Number.isNaN(Number(location.query?.group_id))\n        ? null\n        : Number(location.query?.group_id),\n    }),\n\n    [location.query?.user_id, location.query?.group_id],\n  );\n\n  const { teacherSubjectData, semester_subject_id } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ label: name, value: id })),\n    [teacherSubjectData?.groups],\n  );\n\n  if (user_id !== null && group_id !== null) {\n    return <FinalGradesDetails user_id={user_id} group_id={group_id} />;\n  }\n\n  return (\n    <ProTable<API.FinalGradeItem, TableParams>\n      className=\"table-standalone\"\n      rowKey=\"id\"\n      search={{ layout: 'vertical' }}\n      request={async ({ group_id: group_ids = [], first_name = '', last_name = '' }) => {\n        const allGroups = (teacherSubjectData?.groups ?? []).map(({ id }) => id);\n\n        const response = await getGroupFinalGrades(group_ids.length === 0 ? allGroups : group_ids);\n\n        if (!response.success) {\n          return { success: false, total: 0, data: [] };\n        }\n\n        // TODO backend filter\n        const data = response.data.filter(\n          ({ user }) =>\n            user.first_name.toLowerCase().includes(first_name.toLowerCase()) &&\n            user.last_name.toLowerCase().includes(last_name.toLowerCase()),\n        );\n\n        return { success: true, total: data.length, data };\n      }}\n      columns={[\n        {\n          title: <FormattedMessage id=\"group\" />,\n          dataIndex: 'group_id',\n          valueType: 'select',\n          fieldProps: {\n            options: groupOptions,\n            mode: 'multiple',\n          },\n          render: (_n, row) => (\n            <TypeButtonDrawer key={row.group_id} type=\"Students\" type_id={row.group_id} />\n          ),\n        },\n        ...staticColumns,\n        {\n          title: <FormattedMessage id=\"options\" />,\n          hideInSearch: true,\n          render: (_n, row) => [\n            <Link\n              key=\"edit\"\n              to={`/teacher/subjects/${semester_subject_id}/final-grades?user_id=${row.user.id}&group_id=${row.group_id}`}\n            >\n              <Tooltip title={<FormattedMessage id=\"edit\" />}>\n                <Button type=\"primary\" icon={<EditOutlined />} />\n              </Tooltip>\n            </Link>,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import React, { useMemo } from 'react';\nimport { format } from 'date-fns';\nimport { FormattedMessage } from 'umi';\nimport { Button, Tooltip } from 'antd';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { DownloadOutlined } from '@ant-design/icons';\n\nimport { DATETIME_FORMAT } from '@/consts/dates';\nimport { getPCGExportsHistory } from '@/services/escola-lms/pcg-export';\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport UserSelect from '@/components/UserSelect';\nimport { useTeacherSubject } from '../context';\n\nconst DownloadButton: React.FC<{ url: string }> = ({ url }) => (\n  <Tooltip title={<FormattedMessage id=\"download\" />}>\n    <Button\n      type=\"primary\"\n      onClick={() => {\n        window.open(url, '_blank', 'noopener noreferrer');\n      }}\n      icon={<DownloadOutlined />}\n    />\n  </Tooltip>\n);\n\nconst staticColumns: ProColumns<API.PCGFileExportsHistoryItem>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" />,\n    dataIndex: 'id',\n    hideInSearch: true,\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" />,\n    dataIndex: 'created_at',\n    hideInSearch: true,\n    render: (_n, record) => format(new Date(record.created_at), DATETIME_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"created_by\" />,\n    dataIndex: 'created_by',\n    renderFormItem: (item, { type, defaultRender, ...rest }, form) => {\n      if (type === 'form') {\n        return null;\n      }\n      const stateType = form.getFieldValue('state');\n      return (\n        <UserSelect\n          {...rest}\n          state={{\n            type: stateType,\n          }}\n        />\n      );\n    },\n    render: (_n, record) => (\n      <TypeButtonDrawer\n        key={record.created_by.id}\n        type=\"EscolaLms\\Core\\Models\\User\"\n        type_id={record.created_by.id}\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"exported_at\" />,\n    dataIndex: 'exported_at',\n    hideInSearch: true,\n    render: (_n, record) => format(new Date(record.exported_at), DATETIME_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"exported_by\" />,\n    dataIndex: 'exported_by',\n    renderFormItem: (item, { type, defaultRender, ...rest }, form) => {\n      if (type === 'form') {\n        return null;\n      }\n      const stateType = form.getFieldValue('state');\n      return (\n        <UserSelect\n          {...rest}\n          state={{\n            type: stateType,\n          }}\n        />\n      );\n    },\n    render: (_n, record) => (\n      <TypeButtonDrawer\n        key={record.exported_by.id}\n        type=\"EscolaLms\\Core\\Models\\User\"\n        type_id={record.exported_by.id}\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"version\" />,\n    dataIndex: 'version',\n    hideInSearch: true,\n  },\n  {\n    title: <FormattedMessage id=\"options\" />,\n    valueType: 'option',\n    render: (_n, record) => [<DownloadButton key=\"download\" url={record.url} />],\n  },\n];\n\nexport const FileExportsHistory: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const columns: ProColumns<API.PCGFileExportsHistoryItem>[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: teacherSubjectData?.groups?.[0]?.id,\n          allowClear: false,\n        },\n      },\n      ...staticColumns,\n    ],\n    [teacherSubjectData?.groups?.[0]?.id, groupOptions],\n  );\n\n  return (\n    <ProTable<API.PCGFileExportsHistoryItem, API.PCGFileExportsHistoryParams>\n      className=\"table-standalone\"\n      request={async ({\n        group_id = teacherSubjectData?.groups?.[0]?.id,\n        created_by,\n        exported_by,\n      }) => {\n        const response = await getPCGExportsHistory({ group_id, created_by, exported_by });\n\n        if (!response.success) {\n          return { success: false, data: [], total: 0 };\n        }\n\n        return { success: true, data: response.data, total: response.data.length };\n      }}\n      columns={columns}\n      search={{ layout: 'vertical' }}\n      scroll={{ x: 1500 }}\n    />\n  );\n};\n","import React, { useCallback, useMemo, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Select } from 'antd';\n\nimport { createFinalGrade, updateFinalGrade } from '@/services/escola-lms/grades';\n\ninterface Props {\n  term: API.GradeTerm;\n  gradeScales: API.SubjectGradeScale[];\n  defaultFinalGrade?: API.FinalGradeItemGrade;\n  finalGrades?: API.FinalGradeItem;\n}\n\nconst getGradeScaleId = (\n  gradeScales: API.SubjectGradeScale[],\n  name: string | undefined,\n): number | undefined => gradeScales.find((scale) => scale.name === name)?.id;\n\nexport const FinalGradeSelect: React.FC<Props> = ({\n  term,\n  gradeScales,\n  defaultFinalGrade,\n  finalGrades,\n}) => {\n  const [createdGrade, setCreatedGrade] = useState(defaultFinalGrade);\n\n  const [loading, setLoading] = useState(false);\n\n  const options = useMemo(\n    () => gradeScales.map(({ name, id }) => ({ value: id, label: name })),\n    [gradeScales],\n  );\n\n  const onChange = useCallback(\n    (grade_scale_id: number) => {\n      if (!finalGrades?.id) return;\n\n      if (createdGrade) {\n        setLoading(true);\n        updateFinalGrade(createdGrade.id, {\n          grade_scale_id,\n        }).finally(() => setLoading(false));\n        return;\n      }\n\n      setLoading(true);\n      createFinalGrade({\n        grade_term_id: term.id,\n        grade_scale_id,\n        lesson_group_user_id: finalGrades.id,\n      })\n        .then((res) => {\n          if (res.success) {\n            const recentGrade = res.data.grades.find((grade) => grade.grade_term.id === term.id);\n            setCreatedGrade(recentGrade);\n          }\n        })\n        .finally(() => setLoading(false));\n    },\n    [createdGrade, term.id, finalGrades?.id],\n  );\n\n  if (!finalGrades) return null;\n\n  return (\n    <Select\n      loading={loading}\n      disabled={loading}\n      placeholder={<FormattedMessage id=\"select_final_grade\" />}\n      style={{ width: '100%' }}\n      onChange={onChange}\n      options={options}\n      defaultValue={getGradeScaleId(gradeScales, defaultFinalGrade?.grade_name)}\n    />\n  );\n};\n","import React, { useCallback } from 'react';\nimport { InputNumber } from 'antd';\nimport { debounce } from 'lodash';\n\nimport { createExamResult } from '@/services/escola-lms/exams';\n\ninterface Props {\n  exam_id: number;\n  result: number;\n  student_id: number;\n  onSuccess?: (exam: API.Exam) => void;\n}\n\nexport const ExamGradeInput: React.FC<Props> = ({ exam_id, result, student_id, onSuccess }) => {\n  const onChange = useCallback(\n    debounce((value: number | null) => {\n      createExamResult(exam_id, student_id, { result: value ?? 0 }).then((res) => {\n        if (res.success) {\n          onSuccess?.(res.data);\n        }\n      });\n    }, 300),\n    [exam_id, result, student_id],\n  );\n\n  return <InputNumber type=\"number\" min={0} max={100} onChange={onChange} defaultValue={result} />;\n};\n","import { FormattedMessage } from 'umi';\nimport { format } from 'date-fns';\nimport type { ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\n\nimport type { StudentExam } from '../FinalGradesDetails/types';\nimport { FinalGradeSelect } from '../FinalGradeSelect';\nimport { ExamGradeInput } from '../ExamGradeInput';\nimport type {\n  ClassRegisterTableItemAttendance,\n  ClassRegisterTableItemFinalGrade,\n  ClassRegisterTableItem,\n  ClassRegisterTableItemExamResult,\n} from './types';\n\n/* Attendance */\nexport const getAttendanceCols = (\n  groupAttendanceSchedule: API.GroupAttendanceSchedule[],\n): ProColumns<ClassRegisterTableItem> => {\n  const dynamicCols = groupAttendanceSchedule.reduce<ProColumns<ClassRegisterTableItem>[]>(\n    (acc, curr) => [\n      ...acc,\n      {\n        title: format(new Date(curr.date_from), DAY_FORMAT),\n        dataIndex: `attendance-${curr.date_from}`,\n        hideInSearch: true,\n        width: 100,\n        align: 'center',\n        render: (_, record) => (\n          <AttendanceCheckbox\n            groupAttendanceScheduleId={curr.id}\n            attendance={record[`attendance-${curr?.date_from}`]}\n            studentId={record.id}\n          />\n        ),\n      },\n    ],\n    [],\n  );\n\n  if (!dynamicCols.length)\n    return { title: <FormattedMessage id=\"attendance\" />, hideInSearch: true, hideInTable: true };\n\n  return {\n    title: <FormattedMessage id=\"attendance\" />,\n    hideInSearch: true,\n    children: dynamicCols,\n  };\n};\n\nexport const getStudentAttendances = (\n  groupAttendanceSchedules: API.GroupAttendanceSchedule[],\n  student_id: number,\n): ClassRegisterTableItemAttendance =>\n  groupAttendanceSchedules.reduce((innerAcc, groupAttendanceSchedule) => {\n    const studentAttendance = groupAttendanceSchedule.attendances.find(\n      (attendance) => attendance.user_id === student_id,\n    );\n    if (!studentAttendance) return innerAcc;\n\n    return {\n      ...innerAcc,\n      [`attendance-${groupAttendanceSchedule.date_from}`]: studentAttendance.value,\n    };\n  }, {});\n\n/* Exams */\nexport const getExamsCols = (exams: API.Exam[]): ProColumns<ClassRegisterTableItem> => {\n  const dynamicCols = exams.reduce<ProColumns<ClassRegisterTableItem>[]>(\n    (acc, exam) => [\n      ...acc,\n      {\n        dataIndex: `exam-${exam.id}`,\n        title: <FormattedMessage id=\"examTitleWithWeight\" values={exam} />,\n        hideInSearch: true,\n        width: 100,\n        render: (_n, record) =>\n          record?.[`exam-${exam.id}`]?.result !== undefined ? (\n            <ExamGradeInput\n              result={record?.[`exam-${exam.id}`].result}\n              exam_id={exam.id}\n              student_id={record.id}\n            />\n          ) : (\n            '-'\n          ),\n      },\n    ],\n    [],\n  );\n\n  if (!dynamicCols.length)\n    return { title: <FormattedMessage id=\"exams\" />, hideInSearch: true, hideInTable: true };\n\n  return { title: <FormattedMessage id=\"exams\" />, hideInSearch: true, children: dynamicCols };\n};\n\nexport const getStudentExamResults = (\n  studentExams: StudentExam[],\n): ClassRegisterTableItemExamResult =>\n  studentExams.reduce(\n    (innerAcc, { result, id: exam_id }) => ({\n      ...innerAcc,\n      [`exam-${exam_id}`]: result,\n    }),\n    {},\n  );\n\n/* Final grades */\nexport const getFinalGradesCols = (\n  gradeTerms: API.GradeTerm[],\n  subjectGradeScales: API.SubjectGradeScale[],\n): ProColumns<ClassRegisterTableItem> => ({\n  title: <FormattedMessage id=\"final-grades\" />,\n  hideInSearch: true,\n  children: gradeTerms.map((term) => ({\n    title: term.name,\n    hideInSearch: true,\n    width: 100,\n    align: 'center',\n    render: (_n, record) => (\n      <FinalGradeSelect\n        defaultFinalGrade={record[`final-grade-${term.id}`]}\n        finalGrades={record.final_grades}\n        term={term}\n        gradeScales={subjectGradeScales}\n      />\n    ),\n  })),\n});\n\nexport const getStudentFinalGrades = (\n  finalGrades: API.FinalGradeItem[],\n  student_id: number,\n): API.FinalGradeItem | undefined =>\n  finalGrades.find((finalGradeItem) => finalGradeItem.user.id === student_id);\n\nexport const getFinalGrades = (\n  studentFinalGrade?: API.FinalGradeItem,\n): ClassRegisterTableItemFinalGrade =>\n  (studentFinalGrade?.grades ?? []).reduce(\n    (acc, grade) => ({ ...acc, [`final-grade-${grade.grade_term.id}`]: grade }),\n    {},\n  );\n","import React, { useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { message } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\n\nimport { groupAttendanceSchedule as fetchGroupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport { studentUserGroup as fetchStudentUserGroup } from '@/services/escola-lms/student_user_groups';\nimport {\n  getSubjectTutorGrades as fetchSubjectTutorGrades,\n  getGroupFinalGrades as fetchGroupFinalGrades,\n  getGradeTerms as fetchGradeTerms,\n  getSubjectGradeScales as fetchSubjectGradeScales,\n} from '@/services/escola-lms/grades';\nimport { getExams as fetchExams } from '@/services/escola-lms/exams';\nimport { useTeacherSubject } from '../../context';\nimport {\n  getProposedGrade,\n  getScalesBySubjectScaleFormId,\n  getStudentExamsFromExams,\n} from '../FinalGradesDetails/utils';\nimport {\n  getAttendanceCols,\n  getExamsCols,\n  getFinalGrades,\n  getFinalGradesCols,\n  getStudentAttendances,\n  getStudentExamResults,\n  getStudentFinalGrades,\n} from './utils';\nimport type { ClassRegisterTableItem } from './types';\n\nexport const ClassRegister: React.FC = () => {\n  const { teacherSubjectData, semester_subject_id } = useTeacherSubject();\n  const [dynamicCols, setDynamicCols] = useState<ProColumns<ClassRegisterTableItem>[]>([]);\n  const [selectedGroupName, setSelectedGroupName] = useState(teacherSubjectData?.groups?.[0]?.name);\n  const intl = useIntl();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const actionRef = useRef<ActionType>();\n\n  const columns: ProColumns[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: groupOptions?.[0]?.value,\n          allowClear: false,\n        },\n      },\n      {\n        title: <FormattedMessage id=\"nameAndSurname\" defaultMessage=\"Name and surname\" />,\n        dataIndex: 'full_name',\n        fixed: 'left',\n      },\n      ...dynamicCols,\n    ],\n    [groupOptions, dynamicCols],\n  );\n\n  return (\n    <ProTable<ClassRegisterTableItem>\n      className=\"table-standalone\"\n      request={async ({ group_id = groupOptions[0]?.value, full_name = '' }) => {\n        const finalGradesRes = await fetchGroupFinalGrades(group_id);\n        const selectedGroup = groupOptions.find(({ value }) => value === group_id);\n        if (\n          !finalGradesRes.success ||\n          finalGradesRes.data[0] === undefined ||\n          semester_subject_id === null\n        ) {\n          message.error(\n            intl.formatMessage({ id: 'groupDataMissing' }, { group_name: selectedGroup?.label }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n\n        const [\n          studentUserGroupRes,\n          groupAttendanceScheduleRes,\n          examsRes,\n          tutorGradesRes,\n          gradeTermsRes,\n          subjectGradeScalesRes,\n        ] = await Promise.all([\n          fetchStudentUserGroup(group_id),\n          fetchGroupAttendanceSchedule(group_id),\n          fetchExams({ group_id, per_page: -1 }),\n          fetchSubjectTutorGrades(semester_subject_id, finalGradesRes.data?.[0]?.tutor_id),\n          fetchGradeTerms(),\n          fetchSubjectGradeScales(finalGradesRes.data?.[0]?.s_subject_scale_form_id),\n        ]);\n\n        if (\n          !studentUserGroupRes.success ||\n          !groupAttendanceScheduleRes.success ||\n          !examsRes.success ||\n          !tutorGradesRes.success ||\n          !gradeTermsRes.success ||\n          !subjectGradeScalesRes.success ||\n          !selectedGroup\n        ) {\n          message.error(\n            intl.formatMessage({ id: 'groupDataMissing' }, { group_name: selectedGroup?.label }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n        setSelectedGroupName(selectedGroup.label);\n\n        /* COLS */\n        const attendanceCols = getAttendanceCols(groupAttendanceScheduleRes.data);\n        const examsCols = getExamsCols(examsRes.data);\n        const finalGradeCols = getFinalGradesCols(gradeTermsRes.data, subjectGradeScalesRes.data);\n\n        setDynamicCols([\n          attendanceCols,\n          examsCols,\n          finalGradeCols,\n          {\n            title: <FormattedMessage id=\"proposed_grade\" />,\n            hideInSearch: true,\n            dataIndex: 'proposed_grade',\n            align: 'center',\n            width: 100,\n          },\n        ]);\n\n        const data = studentUserGroupRes.data.users\n          .reduce<ClassRegisterTableItem[]>(\n            (acc, { id, academic_teacher_id, first_name, last_name }) => {\n              const studentFullName = `${last_name} ${first_name}`;\n              // filter out tutor & first name and second name filter\n              if (\n                academic_teacher_id !== null ||\n                !studentFullName.toLowerCase().includes(full_name.toLowerCase())\n              )\n                return acc;\n\n              const studentAttendances = getStudentAttendances(groupAttendanceScheduleRes.data, id);\n\n              const studentExams = getStudentExamsFromExams(examsRes.data, id);\n\n              const studentFinalGrades = getStudentFinalGrades(finalGradesRes.data, id);\n\n              const tutorScales =\n                getScalesBySubjectScaleFormId(\n                  studentFinalGrades?.s_subject_scale_form_id ?? 0,\n                  tutorGradesRes.data.grade_scale ?? [],\n                ) ?? [];\n\n              const proposed_grade = getProposedGrade(studentExams, tutorScales);\n\n              const studentExamResults = getStudentExamResults(studentExams);\n\n              const finalGrades = getFinalGrades(studentFinalGrades);\n\n              return [\n                ...acc,\n                {\n                  id,\n                  full_name: studentFullName,\n                  ...studentAttendances,\n                  ...studentExamResults,\n                  ...finalGrades,\n                  proposed_grade,\n                  final_grades: studentFinalGrades,\n                },\n              ];\n            },\n            [],\n          )\n          // sort alphabetically\n          .sort((a, b) => a.full_name.localeCompare(b.full_name));\n\n        return { data, total: data.length, success: true };\n      }}\n      columns={columns}\n      headerTitle={\n        <FormattedMessage\n          id=\"classRegisterTitleWithGroupName\"\n          values={{ groupName: selectedGroupName }}\n        />\n      }\n      search={{ layout: 'vertical' }}\n      scroll={{ x: 1500 }}\n      actionRef={actionRef}\n      pagination={{ onChange: () => actionRef.current?.reload() }}\n      rowKey=\"id\"\n    />\n  );\n};\n","import React, { useCallback, useMemo } from 'react';\nimport { useParams, history, useIntl, FormattedMessage, useModel, Link } from 'umi';\nimport { Spin, Button } from 'antd';\nimport ProCard from '@ant-design/pro-card';\nimport { PageContainer } from '@ant-design/pro-layout';\n\nimport PERMISSIONS from '@/consts/permissions';\nimport { isUserHavePermissions } from '@/services/escola-lms/permissions';\nimport { TeacherSubjectContextProvider, useTeacherSubject } from './context';\nimport { Groups } from './components/Groups';\nimport { Exams } from './components/Exams';\nimport { Students } from './components/Students';\nimport { Attendances } from './components/Attendances';\nimport { GradesScale } from './components/GradesScale';\nimport { Schedule } from './components/Schedule';\nimport { FinalGradesList } from './components/FinalGradesList';\nimport { FileExportsHistory } from './components/FileExportsHistory';\nimport { ClassRegister } from './components/ClassRegister';\n\nconst TeacherSubjectsFormContent: React.FC<{ tab: string }> = ({ tab }) => {\n  const intl = useIntl();\n  const { setInitialState, initialState } = useModel('@@initialState');\n  const { teacherSubjectData, semester_subject_id, tutors } = useTeacherSubject();\n\n  const currentUserHasPermissions = useCallback(\n    isUserHavePermissions(initialState?.currentUser as API.UserItem),\n    [initialState?.currentUser],\n  );\n\n  const showGradeScale = useMemo(\n    () =>\n      !!tutors.data.find(({ id }) => id === initialState?.currentUser?.id) ||\n      currentUserHasPermissions(PERMISSIONS.TeacherListGradeScale),\n    [],\n  );\n\n  if (!teacherSubjectData) {\n    return <Spin />;\n  }\n\n  return (\n    <PageContainer\n      title={\n        <>\n          <FormattedMessage id={teacherSubjectData?.subject?.name} />\n          {', '}\n          <FormattedMessage id={tab} />\n        </>\n      }\n      tabBarExtraContent={\n        <div style={{ display: 'flex', padding: '12px', gap: '12px' }}>\n          <Link to={`/teacher/subjects/${semester_subject_id}/exams?exam_id=new`}>\n            <Button type=\"primary\">\n              <FormattedMessage id=\"uploadGrades\" defaultMessage=\"uploadGrades\" />\n            </Button>\n          </Link>\n        </div>\n      }\n      header={{\n        breadcrumb: {\n          routes: [\n            {\n              path: 'teacher',\n              breadcrumbName: intl.formatMessage({\n                id: 'Teacher',\n              }),\n            },\n            {\n              path: 'subjects',\n              breadcrumbName: intl.formatMessage({\n                id: 'Subjects',\n              }),\n            },\n            {\n              path: String(semester_subject_id),\n              breadcrumbName: String(teacherSubjectData.subject?.name),\n            },\n            {\n              path: String(tab),\n              breadcrumbName: intl.formatMessage({ id: tab, defaultMessage: String(tab) }),\n            },\n          ],\n        },\n      }}\n    >\n      <ProCard\n        bodyStyle={{ padding: '24px' }}\n        tabs={{\n          type: 'card',\n          activeKey: tab,\n          onChange: (key) => {\n            setInitialState({\n              ...initialState,\n            });\n\n            history.push(`/teacher/subjects/${semester_subject_id}/${key}`);\n          },\n        }}\n      >\n        <ProCard.TabPane key=\"groups\" tab={<FormattedMessage id=\"groups\" />}>\n          <Groups />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"students\" tab={<FormattedMessage id=\"students\" />}>\n          <Students />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"exams\" tab={<FormattedMessage id=\"exams\" />}>\n          <Exams />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"schedule\" tab={<FormattedMessage id=\"schedule\" />}>\n          <Schedule />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"class-register\" tab={<FormattedMessage id=\"class-register\" />}>\n          <ClassRegister />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"attendance\" tab={<FormattedMessage id=\"attendance\" />}>\n          <Attendances />\n        </ProCard.TabPane>\n        {showGradeScale && (\n          <ProCard.TabPane key=\"grades-scale\" tab={<FormattedMessage id=\"grades-scale\" />}>\n            <GradesScale />\n          </ProCard.TabPane>\n        )}\n        <ProCard.TabPane key=\"final-grades\" tab={<FormattedMessage id=\"final-grades\" />}>\n          <FinalGradesList />\n        </ProCard.TabPane>\n        <ProCard.TabPane\n          key=\"file-exports-history\"\n          tab={<FormattedMessage id=\"file-exports-history\" />}\n        >\n          <FileExportsHistory />\n        </ProCard.TabPane>\n      </ProCard>\n    </PageContainer>\n  );\n};\n\nexport default () => {\n  const params = useParams<{ subjectId?: string; tab?: string }>();\n  const { subjectId, tab = 'groups' } = params;\n\n  return (\n    <TeacherSubjectContextProvider semester_subject_id={Number(subjectId)}>\n      <TeacherSubjectsFormContent tab={tab} />\n    </TeacherSubjectContextProvider>\n  );\n};\n","import React, { useCallback, useEffect, useState, useMemo } from 'react';\nimport { message } from 'antd';\nimport { useIntl, useLocation } from 'umi';\nimport { history } from 'umi';\nimport type { Location } from 'history';\n\nimport {\n  program,\n  createLesson as apiCreateLesson,\n  updateLesson as apiUpdateLesson,\n  createTopic as apiCreateTopic,\n  updateTopic as apiUpdateTopic,\n  removeLesson as apiRemoveLesson,\n  removeTopic as apiRemoveTopic,\n  cloneLesson as apiCloneLesson,\n  cloneTopic as apiCloneTopic,\n} from '@/services/escola-lms/course';\n\nimport type { UploadChangeParam } from 'antd/lib/upload';\nimport { TopicType } from '@/services/escola-lms/enums';\n\ntype CurrentEditMode =\n  | { mode: 'lesson'; id: number; value?: API.Lesson | null }\n  | { mode: 'topic'; id: number; value?: API.Topic | null }\n  | { mode: 'init' };\n\ntype ProgramContext = {\n  currentEditMode?: CurrentEditMode;\n  state?: API.CourseProgram;\n  h5ps?: any[];\n  // token: credentials.token,\n  id?: number;\n  addNewLesson?: (parentId?: number) => API.Lesson;\n  updateLesson?: (lesson_id: number, data: FormData) => Promise<void | boolean>;\n  updateTopic?: (topic_id: number, data: FormData) => Promise<void>;\n  // addResource,\n  // removeResource,\n  deleteLesson?: (lesson_id: number) => void;\n  // updateH5P,\n  addNewTopic?: (lesson_id: number, type: API.TopicType) => API.Topic;\n  deleteTopic?: (topic_id: number) => void;\n  onTopicUploaded?: (prevTopicId: number, info: UploadChangeParam) => void;\n  cloneTopic?: (topic_id: number) => void;\n  cloneLesson?: (lesson_id: number) => void;\n  getLessons?: () => void;\n};\n\nexport const Context = React.createContext<ProgramContext>({});\n\nconst getRandomId = () => Math.round(Math.random() * 99999);\n\nconst getFlatLessons = (lessons: API.Lesson[]): API.Lesson[] => {\n  return lessons.reduce((acc, curr) => {\n    return [...acc, ...(curr.lessons ? getFlatLessons(curr.lessons) : []), curr];\n  }, [] as API.Lesson[]) as API.Lesson[];\n};\n\nexport const getFlatTopics = (lessons: API.Lesson[]): API.Topic[] => {\n  return lessons.reduce((acc, curr) => {\n    return [...acc, ...(curr.lessons ? getFlatTopics(curr.lessons) : []), ...(curr.topics ?? [])];\n  }, [] as API.Topic[]) as API.Topic[];\n};\n\nconst recursiveAddTopicToLessons = (\n  lessons: API.Lesson[],\n  lessonId: number,\n  topic: API.Topic,\n): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: lesson.lessons ? recursiveAddTopicToLessons(lesson.lessons, lessonId, topic) : [],\n    topics: lesson.id === lessonId ? [...(lesson.topics ?? []), topic] : lesson.topics ?? [],\n  }));\n};\n\n// Probably should be removed\n// const recursiveEditTopic = (\n//   lessons: API.Lesson[],\n//   topicId: number,\n//   updatedTopic: API.Topic,\n// ): API.Lesson[] => {\n//   return lessons.map((lesson) => ({\n//     ...lesson,\n//     lessons: recursiveEditTopic(lesson.lessons ?? [], topicId, updatedTopic),\n//     topics: lesson.topics?.map((topic) => (topic.id === topicId ? updatedTopic : topic)) ?? [],\n//   }));\n// };\n\nconst recursiveAddLessonToLessons = (\n  lessons: API.Lesson[],\n  newLesson: API.Lesson,\n  lessonId?: number | null,\n): API.Lesson[] => {\n  if (!lessonId) {\n    return [...lessons, newLesson];\n  }\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: [\n      ...(lesson.lessons ? recursiveAddLessonToLessons(lesson.lessons, newLesson, lessonId) : []),\n      ...(lesson.id === lessonId ? [newLesson] : []),\n    ],\n  }));\n};\n\nconst recursiveEditLesson = (\n  lessons: API.Lesson[],\n  lessonId: number,\n  updatedLesson: API.Lesson,\n): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...(lesson.id === lessonId ? updatedLesson : lesson),\n    lessons: lesson.lessons ? recursiveEditLesson(lesson.lessons, lessonId, updatedLesson) : [],\n  }));\n};\n\nconst appendParentIdToLessons = (lessons: API.Lesson[], lessonParentId?: number): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    parent_id: lessonParentId,\n    lessons: lesson.lessons ? appendParentIdToLessons(lesson.lessons, lesson.id) : [],\n  }));\n};\n\nconst recursiveDeleteLesson = (lessons: API.Lesson[], lessonId: number): API.Lesson[] => {\n  return lessons\n    .filter((lesson) => lesson.id !== lessonId)\n    .map((lesson) => ({\n      ...lesson,\n      lessons: lesson.lessons ? recursiveDeleteLesson(lesson.lessons, lessonId) : [],\n    }));\n};\n\nconst recursiveDeleteTopic = (lessons: API.Lesson[], topicId: number): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: lesson.lessons ? recursiveDeleteTopic(lesson.lessons, topicId) : [],\n    topics: lesson.topics ? lesson.topics.filter((topic) => topic.id !== topicId) : [],\n  }));\n};\n\nconst recursiveTopicUploaded = (\n  prevTopicId: number,\n  info: UploadChangeParam,\n  lesson_id: number | null | undefined,\n  lessons: API.Lesson[],\n): API.Lesson[] => {\n  return lessons?.map((lesson) => {\n    if (lesson.id === lesson_id) {\n      return {\n        ...lesson,\n        topics: lesson.topics?.map((topic) => {\n          if (topic.id === prevTopicId) {\n            return info.file.response.data;\n          }\n          return topic;\n        }),\n      };\n    } else if (lesson.lessons) {\n      return {\n        ...lesson,\n        lessons: recursiveTopicUploaded(prevTopicId, info, lesson_id, lesson.lessons || []),\n      };\n    }\n    return lesson;\n  });\n};\n\nexport const AppContext: React.FC<{ children: React.ReactNode; id: number }> = ({\n  children,\n  id,\n}) => {\n  const [state, setState] = useState<API.CourseProgram>();\n  const intl = useIntl();\n\n  const flatTopics: API.Topic[] = useMemo(() => {\n    return state && state.lessons ? getFlatTopics(state.lessons) : [];\n  }, [state]);\n\n  const flatLessons: API.Lesson[] = useMemo(() => {\n    return state && state.lessons ? getFlatLessons(state.lessons) : [];\n  }, [state]);\n\n  const [h5ps, setH5ps] = useState([]);\n\n  const l = useLocation() as Location & { query: { lesson?: string; topic?: string } };\n\n  useEffect(() => {\n    setH5ps([]);\n  }, []);\n\n  /*\n  useEffect(() => {\n    API(`h5p`, token)\n      .then((response) => response.json())\n      .then((data) => {\n        setH5ps(data);\n      });\n    //.then(() => addNewLesson());\n  }, []);\n  */\n\n  const getLessons = useCallback(() => {\n    program(id).then((data) => {\n      return (\n        data.success &&\n        setState({\n          ...data.data,\n          lessons: appendParentIdToLessons(data.data.lessons),\n        })\n      );\n    });\n  }, [id]);\n\n  useEffect(() => {\n    getLessons();\n  }, [getLessons]);\n\n  const getLessonIdByTopicId = useCallback(\n    (topic_id: number) => {\n      const lesson = flatLessons.find((lesson_item) =>\n        lesson_item?.topics?.find((topic) => topic.id === topic_id),\n      );\n      return lesson ? lesson.id : null;\n    },\n    [flatLessons],\n  );\n\n  const currentEditMode = useMemo<CurrentEditMode>(() => {\n    if (l.query?.lesson) {\n      return {\n        mode: 'lesson',\n        id: Number(l.query.lesson),\n        value: flatLessons.find((lesson) => lesson.id === Number(l.query.lesson)),\n      };\n    }\n    if (l.query?.topic) {\n      return {\n        mode: 'topic',\n        id: Number(l.query.topic),\n        value: flatTopics.find((t) => t.id === Number(l.query.topic)),\n      };\n    }\n    return { mode: 'init' };\n  }, [l.query, state, flatLessons, flatTopics]);\n\n  const addNewLesson = useCallback(\n    (parentId?: number) => {\n      const newLesson: API.Lesson = {\n        course_id: id,\n        topics: [],\n        isNew: true,\n        id: state ? state.lessons.length + 1 : getRandomId(), // New Lesson\n        order: 0,\n        title: intl.formatMessage({ id: 'add_title_here' }),\n        active: true,\n        parent_id: parentId,\n      };\n\n      setState((prevState) => ({\n        ...prevState,\n        lessons: recursiveAddLessonToLessons(prevState?.lessons ?? [], newLesson, parentId),\n        //lessons: [...(prevState ? prevState.lessons : []), newLesson] as API.Lesson[],\n      }));\n\n      return newLesson;\n    },\n    [id, state],\n  );\n\n  const updateLesson = useCallback(\n    (lesson_id: number, formData: FormData) => {\n      const newLesson = flatLessons.find((lesson) => lesson.id === lesson_id);\n      const isNew = newLesson && newLesson.isNew;\n\n      return (isNew ? apiCreateLesson(formData) : apiUpdateLesson(lesson_id, formData)).then(\n        (data) => {\n          message.success(data.message);\n          getLessons();\n          return (\n            data.success &&\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveEditLesson(prevState?.lessons ?? [], lesson_id, {\n                ...data.data,\n                isNew: false,\n              }),\n              /*\n              lessons: prevState?.lessons\n                ? prevState.lessons.map((lesson) => {\n                    if (lesson.id === lesson_id) {\n                      return {\n                        ...lesson,\n                        ...data.data,\n                        isNew: false,\n                      };\n                    }\n                    return lesson;\n                  })\n                : [data.data],\n                */\n            }))\n          );\n        },\n      );\n    },\n    [state],\n  );\n\n  const deleteLesson = useCallback(\n    (lesson_id: number) => {\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n      if (!lesson) {\n        return;\n      }\n      const { isNew } = lesson;\n\n      if (isNew) {\n        setState((prevState) => ({\n          ...prevState,\n          lessons: recursiveDeleteLesson(prevState?.lessons ?? [], lesson_id),\n        }));\n      } else {\n        apiRemoveLesson(lesson_id).then((data) => {\n          if (data.success) {\n            message.success(data.message);\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveDeleteLesson(prevState?.lessons ?? [], lesson_id),\n            }));\n          }\n        });\n      }\n    },\n    [state],\n  );\n\n  const updateTopic = useCallback(\n    (topic_id: number, formData: FormData) => {\n      const lesson_id = getLessonIdByTopicId(topic_id);\n\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n\n      const topic = lesson && lesson.topics?.find((topic_item) => topic_item.id === topic_id);\n\n      const isNew = topic?.isNew;\n\n      return (isNew ? apiCreateTopic(formData) : apiUpdateTopic(topic_id, formData)).then(\n        (data) => {\n          if (data.success) {\n            message.success(data.message);\n            getLessons();\n\n            history.push(`/courses/list/${id}/program/?topic=${data.data.id}`);\n\n            if (topic?.topicable_type === TopicType.Video) {\n              setTimeout(() => {\n                getLessons();\n              }, 5000);\n            }\n          }\n        },\n      );\n    },\n    [getLessonIdByTopicId, state, getLessons],\n  );\n\n  const deleteTopic = useCallback(\n    (topic_id: number) => {\n      const lesson_id = getLessonIdByTopicId(topic_id);\n\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n      if (!lesson) {\n        return;\n      }\n\n      const topic = flatTopics?.find((topic_item) => topic_item.id === topic_id);\n\n      const isNew = topic?.isNew;\n      if (isNew && !topic.topicable) {\n        setState((prevState) => ({\n          ...prevState,\n          lessons: recursiveDeleteTopic(prevState?.lessons ?? [], topic_id),\n        }));\n      } else {\n        apiRemoveTopic(topic_id).then((data) => {\n          if (data.success) {\n            message.success(data.message);\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveDeleteTopic(prevState?.lessons ?? [], topic_id),\n            }));\n          }\n        });\n\n        // TODO call API to delete\n        /**\n         return API(`topic/delete/${id}`, token, 'POST')\n        .then((response) => response.json())\n        .then(() =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.filter((topic) => topic.id !== id),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n         */\n      }\n    },\n    [state, getLessonIdByTopicId],\n  );\n\n  /*\n  const addResource = useCallback(\n    (id, formData) => {\n      const isNew = false;\n\n      const id = getLessonByTopicId(id);\n\n      return API(`topic/resource/save/${id}`, token, 'POST', formData)\n        .then((response) => response.json())\n        .then((data) =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        resources: [...topic.resources, data],\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  /*\n  const removeResource = useCallback(\n    (resource_id) => {\n      // resource/delete/{courseFiles}\n\n      const id = getQuizIdByResourseId(resource_id);\n      const id = getLessonByTopicId(id);\n\n      return API(`topic/resource/delete/${resource_id}`, token, 'DELETE', null)\n        .then((response) => response.json())\n        .then(() =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        resources: topic.resources.filter(\n                          (resource) => resource.id !== resource_id,\n                        ),\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  /*\n  const updateH5P = useCallback(\n    (id, h5p_id) => {\n      const id = getLessonByTopicId(id);\n      return API(`topic/h5p/save/${id}`, token, 'POST', getFormData({ media: h5p_id }))\n        .then((response) => response.json())\n        .then((data) =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        media: data,\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  const addNewTopic = useCallback((lesson_id: number, type: API.TopicType) => {\n    const newTopic: API.Topic = {\n      lesson_id,\n      isNew: true,\n      id: getRandomId(),\n      title: intl.formatMessage({ id: 'add_title_here' }),\n      active: true,\n      topicable_type: type,\n    };\n\n    setState((prevState) => ({\n      ...prevState,\n      lessons: recursiveAddTopicToLessons(prevState?.lessons ?? [], lesson_id, newTopic),\n    }));\n    return newTopic;\n  }, []);\n\n  const onTopicUploaded = (prevTopicId: number, info: UploadChangeParam) => {\n    const lesson_id = getLessonIdByTopicId(prevTopicId);\n    setState((prevState) => ({\n      ...prevState,\n      lessons: prevState\n        ? recursiveTopicUploaded(prevTopicId, info, lesson_id, prevState.lessons || [])\n        : [],\n      // Probably should be removed\n      // lessons: recursiveEditTopic(prevState?.lessons ?? [], prevTopicId, info.file.response.data),\n    }));\n    // Update topic id in params after receiving from server\n    history.push(`/courses/list/${id}/program/?topic=${info.file.response.data.id}`);\n  };\n\n  const cloneTopic = useCallback(\n    (topic_id: number) => {\n      return apiCloneTopic(topic_id).then((response) => {\n        if (response.success) {\n          message.success(response.message);\n          const lesson_id = getLessonIdByTopicId(topic_id);\n\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState\n              ? prevState.lessons?.map((lesson) => {\n                  if (lesson.id === lesson_id) {\n                    const topics = lesson.topics || [];\n                    return {\n                      ...lesson,\n                      topics: [...topics, response.data] as API.Topic[],\n                    };\n                  }\n                  return lesson;\n                })\n              : [],\n          }));\n        }\n      });\n    },\n    [state, getLessonIdByTopicId],\n  );\n\n  const cloneLesson = useCallback((lesson_id: number) => {\n    return apiCloneLesson(lesson_id).then((response) => {\n      if (response.success) {\n        message.success(response.message);\n\n        setState((prevState) => ({\n          ...prevState,\n          lessons: prevState ? [...prevState.lessons, response.data] : [],\n        }));\n      }\n    });\n  }, []);\n\n  const value = {\n    state,\n    h5ps,\n    // token: credentials.token,\n    id,\n    addNewLesson,\n    updateLesson,\n    updateTopic,\n    // addResource,\n    // removeResource,\n    deleteLesson,\n    // updateH5P,\n    addNewTopic,\n    deleteTopic,\n    onTopicUploaded,\n    cloneTopic,\n    cloneLesson,\n    currentEditMode,\n    getLessons,\n  };\n\n  return <Context.Provider value={value}>{children}</Context.Provider>;\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\nexport async function reports(\n  params: {\n    // query\n    metric: API.ReportType;\n    date?: string;\n    limit?: number;\n  },\n  options?: RequestOptionsInit,\n) {\n  return request<API.ReportList>('/api/admin/reports/report', {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/* GET /api/admin/stats/course/:course_id/export */\nexport async function exportStatForCourse(\n  course_id: number,\n  params: API.ExportStatForCourseParams,\n  options?: RequestOptionsInit,\n) {\n  return request<Blob | API.DefaultResponseError>(`/api/admin/stats/course/${course_id}/export`, {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    responseType: 'blob',\n    headers: {\n      accept: 'application/vnd.ms-excel',\n    },\n    ...(options || {}),\n  });\n}\n\n/* GET /api/admin/stats/topic/:topic_id/export */\nexport async function exportStatForTopic(\n  topic_id: number,\n  stat: API.TopicStatsKey,\n  options?: RequestOptionsInit,\n) {\n  return request<Blob | API.DefaultResponseError>(`/api/admin/stats/topic/${topic_id}/export`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    params: { stat },\n    responseType: 'blob',\n    headers: {\n      accept: 'application/vnd.ms-excel',\n    },\n    ...(options || {}),\n  });\n}\n"],"sourceRoot":""}