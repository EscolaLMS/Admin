"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803],{56717:function(jt,at,o){var Qe=o(1413),c=o(67294),Fe=o(93696),w=o(84089),$e=function(m,s){return c.createElement(w.Z,(0,Qe.Z)((0,Qe.Z)({},m),{},{ref:s,icon:Fe.Z}))};$e.displayName="InfoCircleOutlined",at.Z=c.forwardRef($e)},78677:function(jt,at,o){var Qe=o(67294),c=o(80404),Fe=function(){return Fe=Object.assign||function($e){for(var T,m=1,s=arguments.length;m<s;m++){T=arguments[m];for(var Ve in T)Object.prototype.hasOwnProperty.call(T,Ve)&&($e[Ve]=T[Ve])}return $e},Fe.apply(this,arguments)},w=function($e){return Qe.createElement(c.P,Fe({},$e,{chartType:"Column"}))};at.Z=w},88280:function(jt,at,o){o.d(at,{Z:function(){return xt}});var Qe=o(4942),c=o(97685),Fe=o(45987),w=o(74165),$e=o(15861),T=o(1413),m=o(87462),s=o(67294),Ve=o(42110),ze=o(78026),ce=function(Ne,rt){return s.createElement(ze.Z,(0,m.Z)({},Ne,{ref:rt,icon:Ve.Z}))},v=s.forwardRef(ce),P=o(97462),u=o(952),M=o(10915),x=o(48171),ie=o(53914),k=o(22270),Se=o(60249),Z=o(14726),pe=o(75842),ge=o(21770),qe=o(88306),pt=o(8880),_e=o(72717),V=o(85893),oe=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],A=["record","position","creatorButtonText","newRecordType","parentKey","style"],B=s.createContext(void 0);function Oe(e){var Ne=e.children,rt=e.record,we=e.position,Pe=e.newRecordType,ae=e.parentKey,ue=(0,s.useContext)(B);return s.cloneElement(Ne,(0,T.Z)((0,T.Z)({},Ne.props),{},{onClick:function(){var Ze=(0,$e.Z)((0,w.Z)().mark(function he(Ge){var Ye,Je,De,ve;return(0,w.Z)().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return X.next=2,(Ye=(Je=Ne.props).onClick)===null||Ye===void 0?void 0:Ye.call(Je,Ge);case 2:if(ve=X.sent,ve!==!1){X.next=5;break}return X.abrupt("return");case 5:ue==null||(De=ue.current)===null||De===void 0||De.addEditRecord(rt,{position:we,newRecordType:Pe,parentKey:ae});case 6:case"end":return X.stop()}},he)}));function J(he){return Ze.apply(this,arguments)}return J}()}))}function g(e){var Ne,rt,we=(0,M.YB)(),Pe=e.onTableChange,ae=e.maxLength,ue=e.formItemProps,Ze=e.recordCreatorProps,J=e.rowKey,he=e.controlled,Ge=e.defaultValue,Ye=e.onChange,Je=e.editableFormRef,De=(0,Fe.Z)(e,oe),ve=(0,s.useRef)(void 0),be=(0,s.useRef)(),X=(0,s.useRef)();(0,s.useImperativeHandle)(De.actionRef,function(){return be.current},[be.current]);var me=(0,ge.Z)(function(){return e.value||Ge||[]},{value:e.value,onChange:e.onChange}),G=(0,c.Z)(me,2),Q=G[0],lt=G[1],$=s.useMemo(function(){return typeof J=="function"?J:function(le,Le){return le[J]||Le}},[J]),re=(0,x.J)(function(le){if(typeof le=="number"&&!e.name){if(le>=Q.length)return le;var Le=Q&&Q[le];return $==null?void 0:$(Le,le)}if((typeof le=="string"||le>=Q.length)&&e.name){var de=Q.findIndex(function(xe,je){var Ae;return($==null||(Ae=$(xe,je))===null||Ae===void 0?void 0:Ae.toString())===(le==null?void 0:le.toString())});if(de!==-1)return de}return le});(0,s.useImperativeHandle)(Je,function(){var le=function(xe){var je,Ae;if(xe==null)throw new Error("rowIndex is required");var et=re(xe),dt=[e.name,(je=et==null?void 0:et.toString())!==null&&je!==void 0?je:""].flat(1).filter(Boolean);return(Ae=X.current)===null||Ae===void 0?void 0:Ae.getFieldValue(dt)},Le=function(){var xe,je=[e.name].flat(1).filter(Boolean);if(Array.isArray(je)&&je.length===0){var Ae,et=(Ae=X.current)===null||Ae===void 0?void 0:Ae.getFieldsValue();return Array.isArray(et)?et:Object.keys(et).map(function(dt){return et[dt]})}return(xe=X.current)===null||xe===void 0?void 0:xe.getFieldValue(je)};return(0,T.Z)((0,T.Z)({},X.current),{},{getRowData:le,getRowsData:Le,setRowData:function(xe,je){var Ae,et;if(xe==null)throw new Error("rowIndex is required");var dt=re(xe),ht=[e.name,(Ae=dt==null?void 0:dt.toString())!==null&&Ae!==void 0?Ae:""].flat(1).filter(Boolean),Pt=Object.assign({},(0,T.Z)((0,T.Z)({},le(xe)),je||{})),Mt=(0,pt.Z)({},ht,Pt);return(et=X.current)===null||et===void 0||et.setFieldsValue(Mt),!0}})},[re,e.name,X.current]),(0,s.useEffect)(function(){e.controlled&&(Q||[]).forEach(function(le,Le){var de;(de=X.current)===null||de===void 0||de.setFieldsValue((0,Qe.Z)({},"".concat($(le,Le)),le))},{})},[(0,ie.ZP)(Q),e.controlled]),(0,s.useEffect)(function(){if(e.name){var le;X.current=e==null||(le=e.editable)===null||le===void 0?void 0:le.form}},[(Ne=e.editable)===null||Ne===void 0?void 0:Ne.form,e.name]);var W=Ze||{},K=W.record,ee=W.position,ne=W.creatorButtonText,Xe=W.newRecordType,tt=W.parentKey,Ft=W.style,_t=(0,Fe.Z)(W,A),Et=ee==="top",gt=(0,s.useMemo)(function(){return typeof ae=="number"&&ae<=(Q==null?void 0:Q.length)?!1:Ze!==!1&&(0,V.jsx)(Oe,{record:(0,k.h)(K,Q==null?void 0:Q.length,Q)||{},position:ee,parentKey:(0,k.h)(tt,Q==null?void 0:Q.length,Q),newRecordType:Xe,children:(0,V.jsx)(Z.ZP,(0,T.Z)((0,T.Z)({type:"dashed",style:(0,T.Z)({display:"block",margin:"10px 0",width:"100%"},Ft),icon:(0,V.jsx)(v,{})},_t),{},{children:ne||we.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ze,ae,Q==null?void 0:Q.length]),At=(0,s.useMemo)(function(){return gt?Et?{components:{header:{wrapper:function(Le){var de,xe=Le.className,je=Le.children;return(0,V.jsxs)("thead",{className:xe,children:[je,(0,V.jsxs)("tr",{style:{position:"relative"},children:[(0,V.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:gt}),(0,V.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(de=De.columns)===null||de===void 0?void 0:de.length,children:gt})]})]})}}}}:{tableViewRender:function(Le,de){var xe,je;return(0,V.jsxs)(V.Fragment,{children:[(xe=(je=e.tableViewRender)===null||je===void 0?void 0:je.call(e,Le,de))!==null&&xe!==void 0?xe:de,gt]})}}:{}},[Et,gt]),St=(0,T.Z)({},e.editable),Vt=(0,x.J)(function(le,Le){var de,xe,je;if((de=e.editable)===null||de===void 0||(xe=de.onValuesChange)===null||xe===void 0||xe.call(de,le,Le),(je=e.onValuesChange)===null||je===void 0||je.call(e,Le,le),e.controlled){var Ae;e==null||(Ae=e.onChange)===null||Ae===void 0||Ae.call(e,Le)}});return(e!=null&&e.onValuesChange||(rt=e.editable)!==null&&rt!==void 0&&rt.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(St.onValuesChange=Vt),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B.Provider,{value:be,children:(0,V.jsx)(_e.Z,(0,T.Z)((0,T.Z)((0,T.Z)({search:!1,options:!1,pagination:!1,rowKey:J,revalidateOnFocus:!1},De),At),{},{tableLayout:"fixed",actionRef:be,onChange:Pe,editable:(0,T.Z)((0,T.Z)({},St),{},{formProps:(0,T.Z)({formRef:X},St.formProps)}),dataSource:Q,onDataSourceChange:function(Le){if(lt(Le),e.name&&ee==="top"){var de,xe=(0,pt.Z)({},[e.name].flat(1).filter(Boolean),Le);(de=X.current)===null||de===void 0||de.setFieldsValue(xe)}}}))}),e.name?(0,V.jsx)(P.Z,{name:[e.name],children:function(Le){var de,xe;if(!ve.current)return ve.current=Q,null;var je=(0,qe.Z)(Le,[e.name].flat(1)),Ae=je==null?void 0:je.find(function(et,dt){var ht;return!(0,Se.A)(et,(ht=ve.current)===null||ht===void 0?void 0:ht[dt])});return ve.current=Q,Ae&&(e==null||(de=e.editable)===null||de===void 0||(xe=de.onValuesChange)===null||xe===void 0||xe.call(de,Ae,je)),null}}):null]})}function We(e){var Ne=u.ZP.useFormInstance();return e.name?(0,V.jsx)(pe.Z.Item,(0,T.Z)((0,T.Z)({style:{maxWidth:"100%"}},e==null?void 0:e.formItemProps),{},{name:e.name,shouldUpdate:function(we,Pe){var ae=[e.name].flat(1);try{return JSON.stringify((0,qe.Z)(we,ae))!==JSON.stringify((0,qe.Z)(Pe,ae))}catch(ue){return!0}},children:(0,V.jsx)(g,(0,T.Z)((0,T.Z)({},e),{},{editable:(0,T.Z)((0,T.Z)({},e.editable),{},{form:Ne})}))})):(0,V.jsx)(g,(0,T.Z)({},e))}We.RecordCreator=Oe;var xt=We},11312:function(jt,at,o){o.d(at,{nu:function(){return rt},rL:function(){return Ne},Du:function(){return e}});var Qe=o(9783),c=o.n(Qe),Fe=o(97857),w=o.n(Fe),$e=o(19632),T=o.n($e),m=o(5574),s=o.n(m),Ve=o(45919),ze=o(66419),ce=o(78677),v=o(26271),P=o(78957),u=o(66309),M=o(72051),x=o(71230),ie=o(72269),k=o(83863),Se=o(60943),Z=o(67294),pe=o(70804),ge=o(80854),qe=o(62235),pt=o(15009),_e=o.n(pt),V=o(99289),oe=o.n(V),A=o(58638),B=o(14726),Oe=o(76841),g=o(85893),We=function(Pe){var ae=Pe.course_id,ue=Pe.stat,Ze=ue===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":ue,J=(0,Z.useState)(!1),he=s()(J,2),Ge=he[0],Ye=he[1],Je=(0,Z.useCallback)(function(De){return oe()(_e()().mark(function ve(){var be,X;return _e()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Ye(!0),G.prev=1,G.next=4,(0,Oe._g)(De,{stat:Ze});case 4:be=G.sent,be instanceof Blob&&(X=document.createElement("a"),X.href=window.URL.createObjectURL(be),X.download="finished_topics_".concat(ae,".xlsx"),document.body.appendChild(X),X.click(),document.body.removeChild(X)),G.next=11;break;case 8:G.prev=8,G.t0=G.catch(1),console.error(G.t0);case 11:return G.prev=11,Ye(!1),G.finish(11);case 14:case"end":return G.stop()}},ve,null,[[1,8,11,14]])}))},[Ze]);return(0,g.jsxs)(B.ZP,{type:"primary",loading:Ge,onClick:Je(ae),children:[(0,g.jsx)(A.Z,{})," ",(0,g.jsx)(ge.FormattedMessage,{id:"export"})]})},xt=function(Pe){return Pe.topicable.content.contents?Object.values(Pe.topicable.content.contents)[0].library:"H5P"},e=function(Pe){var ae=Pe.course_id,ue=Pe.topics,Ze=Pe.stats,J=(0,Z.useState)(!1),he=s()(J,2),Ge=he[0],Ye=he[1],Je=(0,Z.useMemo)(function(){return[{title:(0,g.jsx)(ge.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(be){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:be})}},{title:(0,g.jsx)(ge.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(T()(ue.map(function(ve){var be,X=(be=ve.topicable_type)===null||be===void 0?void 0:be.split("\\").pop();return X==="H5P"&&(X=xt(ve)),{render:function(G){var Q=0;switch(G&&(G.started_at&&G.finished_at?Q=1:G.started_at&&(Q=2)),Q){case 1:return(0,g.jsxs)(P.Z,{children:[(0,g.jsx)(u.Z,{color:"success",children:"F"}),Ge&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 2:return(0,g.jsxs)(P.Z,{children:[(0,g.jsx)(u.Z,{color:"blue",children:"S"}),Ge&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 0:default:return(0,g.jsx)(Z.Fragment,{children:(0,g.jsx)(u.Z,{color:"error",children:"N"})})}},title:(0,g.jsxs)("small",{children:[(0,g.jsx)(u.Z,{children:X})," ",ve.title]}),dataIndex:ve.id}})))},[ue,Ge]),De=(0,Z.useMemo)(function(){return Ze.map(function(ve){return ue.reduce(function(be,X){var me=ve.topics.find(function(G){return G.id===X.id});return w()(w()({},be),{},c()({},Number(X.id),me!=null?me:0))},{email:ve.email,id:ve.id})})},[Ze,ue]);return(0,g.jsx)(M.Z,{title:function(){return(0,g.jsxs)(x.Z,{justify:"space-between",align:"middle",children:[(0,g.jsxs)(P.Z,{children:[(0,g.jsx)(ge.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,g.jsx)(u.Z,{color:"success",children:"F"}),(0,g.jsx)(ge.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,g.jsx)(u.Z,{color:"blue",children:"S"}),(0,g.jsx)(ge.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,g.jsx)(u.Z,{color:"error",children:"N"}),(0,g.jsx)(ge.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,g.jsx)(ie.Z,{checked:Ge,onChange:function(X){return Ye(X)}})]}),(0,g.jsx)(We,{course_id:ae})]})},columns:Je,dataSource:De,size:"small",scroll:{x:1500},components:{table:function(be){return(0,g.jsx)(pe.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,g.jsx)("table",w()({},be))})}}})},Ne=function(Pe){var ae=Pe.stats,ue=Pe.attempts,Ze=(0,Z.useMemo)(function(){return[{title:(0,g.jsx)(ge.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(Ge){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:Ge})}},{title:(0,g.jsx)(ge.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,g.jsx)(ge.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,g.jsx)(ge.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Ge){return Ge?(0,Se.WU)(new Date(Ge),Ve.Cu):""}}]},[]),J=(0,Z.useMemo)(function(){return ae.map(function(he){var Ge=he.id,Ye=he.email,Je=he.finished_at,De=ue==null?void 0:ue.find(function(be){return be.id===Ge}),ve=Array.isArray(De==null?void 0:De.attempts)?De==null?void 0:De.attempts.length:0;return{id:Ge,email:Ye,finished_at:Je,attempt:ve}})},[ae]);return(0,g.jsx)(M.Z,{title:function(){return(0,g.jsx)(P.Z,{children:(0,g.jsx)(ge.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ze,dataSource:J,size:"small",scroll:{x:500}})},rt=function(Pe){var ae=Pe.stats,ue=(0,Z.useState)(null),Ze=s()(ue,2),J=Ze[0],he=Ze[1],Ge=(0,Z.useState)(null),Ye=s()(Ge,2),Je=Ye[0],De=Ye[1],ve=(0,ge.useIntl)(),be=(0,Z.useMemo)(function(){return ae.flatMap(function(me){return Object.values(me.attempts).flatMap(function(G){var Q=G.dates,lt=G.attempt,$=Object.values(Q).flatMap(function(re){var W=re.date,K=re.seconds_total;return{date:W,attempt:lt,seconds_total:K,email:me.email}});return $})})},[ae]),X={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,g.jsx)(v.ZP,{title:(0,g.jsxs)(P.Z,{children:[(0,g.jsx)(ge.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,g.jsx)(k.default,{showSearch:!0,value:J,onChange:function(G){he(G),De(null)},placeholder:(0,g.jsx)(ge.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:ae.map(function(me){var G=me.id,Q=me.email;return(0,g.jsx)(k.default.Option,{value:Q,children:Q},G)})}),(0,g.jsx)(k.default,{value:Je,onChange:function(G){return De(G)},disabled:J===null,placeholder:(0,g.jsx)(ge.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:T()(new Set(be.filter(function(me){var G=me.email;return G===J}).map(function(me){var G=me.attempt;return G}))).map(function(me){return(0,g.jsxs)(k.default.Option,{value:me,children:[(0,g.jsx)(ge.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",me]},me)})})]}),colSpan:12,layout:"center",children:(0,g.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,g.jsx)(ce.Z,w()(w()({},X),{},{tooltip:{title:"".concat(ve.formatMessage({id:"attempt"})),formatter:function(G){var Q=Math.floor(+G.seconds_total/60),lt=+G.seconds_total>60?+G.seconds_total-Q*60:0;return{name:G.attempt,value:"".concat(Q,"m ").concat(lt,"s")}}},data:be.filter(function(me){var G=me.email;return G===J}).filter(function(me){var G=me.attempt;return Number.isInteger(Je)?G===Je:!0})}))})})}},87366:function(jt,at,o){o.d(at,{Il:function(){return pt},_y:function(){return P},uS:function(){return x}});var Qe=o(5574),c=o.n(Qe),Fe=o(97857),w=o.n(Fe),$e=o(19632),T=o.n($e),m=o(2453),s=o(67294),Ve=o(80854),ze=o(99100),ce=o(31472),v=o(85893),P=s.createContext({}),u=function(){return Math.round(Math.random()*99999)},M=function _e(V){return V.reduce(function(oe,A){return[].concat(T()(oe),T()(A.lessons?_e(A.lessons):[]),[A])},[])},x=function _e(V){return V.reduce(function(oe,A){var B;return[].concat(T()(oe),T()(A.lessons?_e(A.lessons):[]),T()((B=A.topics)!==null&&B!==void 0?B:[]))},[])},ie=function _e(V,oe,A){return V.map(function(B){var Oe,g;return w()(w()({},B),{},{lessons:B.lessons?_e(B.lessons,oe,A):[],topics:B.id===oe?[].concat(T()((Oe=B.topics)!==null&&Oe!==void 0?Oe:[]),[A]):(g=B.topics)!==null&&g!==void 0?g:[]})})},k=function _e(V,oe,A){return A?V.map(function(B){return w()(w()({},B),{},{lessons:[].concat(T()(B.lessons?_e(B.lessons,oe,A):[]),T()(B.id===A?[oe]:[]))})}):[].concat(T()(V),[oe])},Se=function _e(V,oe,A){return V.map(function(B){return w()(w()({},B.id===oe?A:B),{},{lessons:B.lessons?_e(B.lessons,oe,A):[]})})},Z=function _e(V,oe){return V.map(function(A){return w()(w()({},A),{},{parent_id:oe,lessons:A.lessons?_e(A.lessons,A.id):[]})})},pe=function _e(V,oe){return V.filter(function(A){return A.id!==oe}).map(function(A){return w()(w()({},A),{},{lessons:A.lessons?_e(A.lessons,oe):[]})})},ge=function _e(V,oe){return V.map(function(A){return w()(w()({},A),{},{lessons:A.lessons?_e(A.lessons,oe):[],topics:A.topics?A.topics.filter(function(B){return B.id!==oe}):[]})})},qe=function _e(V,oe,A,B){return B==null?void 0:B.map(function(Oe){if(Oe.id===A){var g;return w()(w()({},Oe),{},{topics:(g=Oe.topics)===null||g===void 0?void 0:g.map(function(We){return We.id===V?oe.file.response.data:We})})}else if(Oe.lessons)return w()(w()({},Oe),{},{lessons:_e(V,oe,A,Oe.lessons||[])});return Oe})},pt=function(V){var oe=V.children,A=V.id,B=(0,s.useState)(),Oe=c()(B,2),g=Oe[0],We=Oe[1],xt=(0,Ve.useIntl)(),e=(0,s.useMemo)(function(){return g&&g.lessons?x(g.lessons):[]},[g]),Ne=(0,s.useMemo)(function(){return g&&g.lessons?M(g.lessons):[]},[g]),rt=(0,s.useState)([]),we=c()(rt,2),Pe=we[0],ae=we[1],ue=(0,Ve.useLocation)(),Ze=(0,s.useMemo)(function(){var $=new URLSearchParams(ue.search);return{lesson:$.get("lesson"),topic:$.get("topic")}},[ue]);(0,s.useEffect)(function(){ae([])},[]);var J=(0,s.useCallback)(function(){(0,ze.Nx)(A).then(function($){return $.success&&We(w()(w()({},$.data),{},{lessons:Z($.data.lessons)}))})},[A]);(0,s.useEffect)(function(){J()},[J]);var he=(0,s.useCallback)(function($){var re=Ne.find(function(W){var K;return W==null||(K=W.topics)===null||K===void 0?void 0:K.find(function(ee){return ee.id===$})});return re?re.id:null},[Ne]),Ge=(0,s.useMemo)(function(){return Ze.lesson?{mode:"lesson",id:Number(Ze.lesson),value:Ne.find(function($){return $.id===Number(Ze.lesson)})}:Ze.topic?{mode:"topic",id:Number(Ze.topic),value:e.find(function($){return $.id===Number(Ze.topic)})}:{mode:"init"}},[Ze,g,Ne,e]),Ye=(0,s.useCallback)(function($){var re={course_id:A,topics:[],isNew:!0,id:g?g.lessons.length+1:u(),order:0,title:xt.formatMessage({id:"add_title_here"}),active:!0,parent_id:$};return We(function(W){var K;return w()(w()({},W),{},{lessons:k((K=W==null?void 0:W.lessons)!==null&&K!==void 0?K:[],re,$)})}),re},[A,g]),Je=(0,s.useCallback)(function($,re){var W=Ne.find(function(ee){return ee.id===$}),K=W&&W.isNew;return(K?(0,ze.aA)(re):(0,ze.sI)($,re)).then(function(ee){return m.ZP.success(ee.message),J(),ee.success&&We(function(ne){var Xe;return w()(w()({},ne),{},{lessons:Se((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],$,w()(w()({},ee.data),{},{isNew:!1}))})})})},[g]),De=(0,s.useCallback)(function($){var re=Ne.find(function(K){return K.id===$});if(re){var W=re.isNew;W?We(function(K){var ee;return w()(w()({},K),{},{lessons:pe((ee=K==null?void 0:K.lessons)!==null&&ee!==void 0?ee:[],$)})}):(0,ze.iI)($).then(function(K){K.success&&(m.ZP.success(K.message),We(function(ee){var ne;return w()(w()({},ee),{},{lessons:pe((ne=ee==null?void 0:ee.lessons)!==null&&ne!==void 0?ne:[],$)})}))})}},[g]),ve=(0,s.useCallback)(function($,re){var W,K=he($),ee=Ne.find(function(tt){return tt.id===K}),ne=ee&&((W=ee.topics)===null||W===void 0?void 0:W.find(function(tt){return tt.id===$})),Xe=ne==null?void 0:ne.isNew;return(Xe?(0,ze.HV)(re):(0,ze.Cn)($,re)).then(function(tt){tt.success&&(m.ZP.success(tt.message),J(),Ve.history.push("/courses/list/".concat(A,"/program/?topic=").concat(tt.data.id)),(ne==null?void 0:ne.topicable_type)===ce.oz.Video&&setTimeout(function(){J()},5e3))})},[he,g,J]),be=(0,s.useCallback)(function($){var re=he($),W=Ne.find(function(ne){return ne.id===re});if(W){var K=e==null?void 0:e.find(function(ne){return ne.id===$}),ee=K==null?void 0:K.isNew;ee&&!K.topicable?We(function(ne){var Xe;return w()(w()({},ne),{},{lessons:ge((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],$)})}):(0,ze.vJ)($).then(function(ne){ne.success&&(m.ZP.success(ne.message),We(function(Xe){var tt;return w()(w()({},Xe),{},{lessons:ge((tt=Xe==null?void 0:Xe.lessons)!==null&&tt!==void 0?tt:[],$)})}))})}},[g,he]),X=(0,s.useCallback)(function($,re){var W={lesson_id:$,isNew:!0,id:u(),title:xt.formatMessage({id:"add_title_here"}),active:!0,topicable_type:re};return We(function(K){var ee;return w()(w()({},K),{},{lessons:ie((ee=K==null?void 0:K.lessons)!==null&&ee!==void 0?ee:[],$,W)})}),W},[]),me=function(re,W){var K=he(re);We(function(ee){return w()(w()({},ee),{},{lessons:ee?qe(re,W,K,ee.lessons||[]):[]})}),Ve.history.push("/courses/list/".concat(A,"/program/?topic=").concat(W.file.response.data.id))},G=(0,s.useCallback)(function($){return(0,ze.Cx)($).then(function(re){if(re.success){m.ZP.success(re.message);var W=he($);We(function(K){var ee;return w()(w()({},K),{},{lessons:K?(ee=K.lessons)===null||ee===void 0?void 0:ee.map(function(ne){if(ne.id===W){var Xe=ne.topics||[];return w()(w()({},ne),{},{topics:[].concat(T()(Xe),[re.data])})}return ne}):[]})})}})},[g,he]),Q=(0,s.useCallback)(function($){return(0,ze.if)($).then(function(re){re.success&&(m.ZP.success(re.message),We(function(W){return w()(w()({},W),{},{lessons:W?[].concat(T()(W.lessons),[re.data]):[]})}))})},[]),lt={state:g,h5ps:Pe,id:A,addNewLesson:Ye,updateLesson:Je,updateTopic:ve,deleteLesson:De,addNewTopic:X,deleteTopic:be,onTopicUploaded:me,cloneTopic:G,cloneLesson:Q,currentEditMode:Ge,getLessons:J};return(0,v.jsx)(P.Provider,{value:lt,children:oe})}},91149:function(jt,at,o){o.r(at),o.d(at,{default:function(){return Nr}});var Qe=o(97857),c=o.n(Qe),Fe=o(26271),w=o(74453),$e=o(75081),T=o(14726),m=o(67294),s=o(80854),Ve=o(91115),ze=o(26114),ce=o(15009),v=o.n(ce),P=o(9783),u=o.n(P),M=o(99289),x=o.n(M),ie=o(19632),k=o.n(ie),Se=o(5574),Z=o.n(Se),pe=o(16894),ge=o(2453),qe=o(60943);function pt(i,r){return _e.apply(this,arguments)}function _e(){return _e=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(r),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),_e.apply(this,arguments)}function V(i,r,t,n){return oe.apply(this,arguments)}function oe(){return oe=x()(v()().mark(function i(r,t,n,a){return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(r,"/attendances"),c()({data:{attendances:[{user_id:t,value:n}]},method:"POST"},a||{})));case 1:case"end":return d.stop()}},i)})),oe.apply(this,arguments)}var A=o(78957),B=o(83062),Oe=o(84567),g=o(31472);function We(i){var r,t=i===null?g.cX.ABSENT:i,n=u()(u()(u()(u()({},g.cX.PRESENT,{ch1:!0,ch2:!1}),g.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),g.cX.ABSENT,{ch1:!1,ch2:!1}),g.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(r=n[t])!==null&&r!==void 0?r:{ch1:!1,ch2:!1}}function xt(i){var r,t=i.ch1,n=i.ch2,a="".concat(t,"_").concat(n),l={true_false:g.cX.PRESENT,true_true:g.cX.PRESENT_NOT_EXERCISING,false_false:g.cX.ABSENT,false_true:g.cX.EXCUSED_ABSENCE};return(r=l[a])!==null&&r!==void 0?r:g.cX.ABSENT}var e=o(85893),Ne=function(r){var t=r.groupAttendanceScheduleId,n=r.studentId,a=r.attendance,l=r.onSuccess,d=(0,m.useState)(We(a)),f=Z()(d,2),h=f[0],b=f[1],y=(0,m.useState)(!1),C=Z()(y,2),F=C[0],p=C[1],j=(0,m.useRef)(!0),S=(0,m.useCallback)(function(E){p(!0),V(t,n,xt(E)).then(function(D){D.success&&(l==null||l())}).finally(function(){return p(!1)})},[]),_=(0,m.useCallback)(function(E){return b(E.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),O=(0,m.useCallback)(function(E){return b(function(D){return c()(c()({},D),{},{ch2:E.target.checked})})},[]);return(0,m.useEffect)(function(){if(j.current){j.current=!1;return}S(h)},[h,S]),(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(Oe.Z,{disabled:F,checked:h.ch1,onChange:_})}),(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:h.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(Oe.Z,{disabled:F,checked:h.ch2,onChange:O})})]})},rt=Ne,we=o(45919),Pe=o(95213),ae=o(7092),ue=o(73199),Ze=function(){var r=(0,ae.Z)(),t=r.teacherSubjectData,n=(0,m.useState)([]),a=Z()(n,2),l=a[0],d=a[1],f=(0,m.useState)(""),h=Z()(f,2),b=h[0],y=h[1],C=(0,s.useIntl)(),F=(0,m.useRef)(),p=(0,m.useMemo)(function(){var S;return((S=t==null?void 0:t.groups)!==null&&S!==void 0?S:[]).map(function(_){var O=_.id,E=_.name;return{value:O,label:E}})},[t==null?void 0:t.groups]),j=(0,m.useMemo)(function(){var S;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:p,defaultValue:p==null||(S=p[0])===null||S===void 0?void 0:S.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(l))},[p,l]);return(0,e.jsx)(pe.ZP,{className:"table-standalone",headerTitle:"".concat(C.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(b,")"),request:function(){var S=x()(v()().mark(function _(O){var E,D,q,U,H,R,I,L,N,se,Ke;return v()().wrap(function(Ie){for(;;)switch(Ie.prev=Ie.next){case 0:return D=O.group_id,q=D===void 0?p==null||(E=p[0])===null||E===void 0?void 0:E.value:D,U=O.full_name,H=U===void 0?"":U,Ie.next=3,Promise.all([(0,Pe.X)(q),pt(q)]);case 3:if(R=Ie.sent,I=Z()(R,2),L=I[0],N=I[1],se=p.find(function(Re){var Y=Re.value;return Y===q}),!(!L.success||!N.success||!se)){Ie.next=10;break}return Ie.abrupt("return",{data:[],total:0,success:!1});case 10:if(N.data.length){Ie.next=13;break}return ge.ZP.error(C.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),Ie.abrupt("return",{data:[],total:0,success:!1});case 13:return y(se.label),d(N.data.reduce(function(Re,Y){return[].concat(k()(Re),[{title:String((0,qe.WU)(new Date(Y.date_from),we.GC)),dataIndex:String(Y.date_from),hideInSearch:!0,width:100,align:"center",render:function(z,fe){return(0,e.jsx)(rt,{groupAttendanceScheduleId:Y.id,attendance:fe["".concat(Y==null?void 0:Y.date_from)],studentId:fe.id})}}])},[])),Ke=L.data.users.reduce(function(Re,Y){var Me=Y.id,z=Y.academic_teacher_id,fe=Y.first_name,te=Y.last_name,Ue="".concat(te," ").concat(fe);if(z!==null||!Ue.toLowerCase().includes(H.toLowerCase()))return Re;var Ee=N.data.reduce(function(ye,Ce){var Te=Ce.attendances.find(function(ke){return ke.user_id===Me});return Te?c()(c()({},ye),{},u()({},"".concat(Ce.date_from),Te.value)):ye},{});return[].concat(k()(Re),[c()({id:Me,full_name:Ue},Ee)])},[]).sort(function(Re,Y){return Re.full_name.localeCompare(Y.full_name)}),Ie.abrupt("return",{data:Ke,total:Ke.length,success:!0});case 17:case"end":return Ie.stop()}},_)}));return function(_){return S.apply(this,arguments)}}(),columns:j,search:{layout:"vertical"},pagination:{defaultPageSize:ue.Sl,onChange:function(){var _;return(_=F.current)===null||_===void 0?void 0:_.reload()}},scroll:{x:1500},actionRef:F,rowKey:"id"})},J=o(25514),he=o(28248),Ge=o(2487),Ye=o(96365),Je=o(75842);function De(i,r){return ve.apply(this,arguments)}function ve(){return ve=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"GET",params:r},t||{})));case 1:case"end":return a.stop()}},i)})),ve.apply(this,arguments)}function be(i,r){return X.apply(this,arguments)}function X(){return X=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return a.stop()}},i)})),X.apply(this,arguments)}function me(i,r,t){return G.apply(this,arguments)}function G(){return G=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(r),c()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},i)})),G.apply(this,arguments)}function Q(i,r,t){return lt.apply(this,arguments)}function lt(){return lt=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(r),c()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},i)})),lt.apply(this,arguments)}var $=function(r){var t=r.visible,n=r.onClose,a=r.user,l=J.Z.Text,d=a.name,f=a.groupId,h=a.userId,b=(0,m.useState)(""),y=Z()(b,2),C=y[0],F=y[1],p=(0,m.useState)(!1),j=Z()(p,2),S=j[0],_=j[1],O=(0,m.useState)([]),E=Z()(O,2),D=E[0],q=E[1],U=(0,m.useState)(null),H=Z()(U,2),R=H[0],I=H[1],L=(0,m.useState)({current_page:1,per_page:5,last_page:1,total:0}),N=Z()(L,2),se=N[0],Ke=N[1],He=function(){var Me=x()(v()().mark(function z(fe){var te;return v()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,De({bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h,page:fe,per_page:se.per_page});case 2:te=Ee.sent,te.success&&(q(te.data),Ke(te.meta));case 4:case"end":return Ee.stop()}},z)}));return function(fe){return Me.apply(this,arguments)}}(),Ie=function(){var Me=x()(v()().mark(function z(){var fe;return v()().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return Ue.next=2,be({value:C,bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h});case 2:fe=Ue.sent,fe.success&&(He(),_(!1),F(""));case 4:case"end":return Ue.stop()}},z)}));return function(){return Me.apply(this,arguments)}}(),Re=function(){var Me=x()(v()().mark(function z(fe){var te;return v()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,Q(fe);case 2:te=Ee.sent,te.success&&He();case 4:case"end":return Ee.stop()}},z)}));return function(fe){return Me.apply(this,arguments)}}(),Y=function(){var Me=x()(v()().mark(function z(fe){var te;return v()().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return Ee.next=2,me(fe,{value:(R==null?void 0:R.currentText)||"",bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:h});case 2:te=Ee.sent,te.success&&(He(),I(null));case 4:case"end":return Ee.stop()}},z)}));return function(fe){return Me.apply(this,arguments)}}();return(0,m.useEffect)(function(){He()},[]),(0,e.jsxs)(he.Z,{title:(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(d,")")})]}),open:t,onCancel:n,footer:[(0,e.jsx)(T.ZP,{onClick:n,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(Ge.Z,{dataSource:D,pagination:{onChange:function(z){return He(z)},pageSize:se.per_page,total:se.total,current:se.current_page},renderItem:function(z){return(0,e.jsx)(Ge.Z.Item,{actions:[(0,e.jsx)(T.ZP,{danger:!0,onClick:function(){return Re(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},z.id),(R==null?void 0:R.currentNoteId)===z.id?(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(T.ZP,{onClick:function(){return Y(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(T.ZP,{onClick:function(){return I(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(T.ZP,{onClick:function(){return I({currentNoteId:z.id,currentText:z.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},z.id)],children:(R==null?void 0:R.currentNoteId)===z.id&&(R==null?void 0:R.currentText)!==null?(0,e.jsx)(Ye.Z.TextArea,{value:R==null?void 0:R.currentText,onChange:function(te){return I(function(Ue){return c()(c()({},Ue),{},{currentText:te.target.value})})}}):z.value})}}),S?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Je.Z,{layout:"vertical",children:(0,e.jsx)(Je.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(Ye.Z.TextArea,{value:C,onChange:function(z){return F(z.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(T.ZP,{type:"primary",onClick:Ie,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return _(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return _(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},re=$;function W(i,r){return K.apply(this,arguments)}function K(){return K=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"GET",useCache:!1,params:r},t||{})));case 1:case"end":return a.stop()}},i)})),K.apply(this,arguments)}function ee(i,r){return ne.apply(this,arguments)}function ne(){return ne=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return a.stop()}},i)})),ne.apply(this,arguments)}function Xe(i,r,t){return tt.apply(this,arguments)}function tt(){return tt=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(r),c()({method:"PUT",data:t,useCache:!1},n||{})));case 1:case"end":return l.stop()}},i)})),tt.apply(this,arguments)}function Ft(i,r){return _t.apply(this,arguments)}function _t(){return _t=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(r),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),_t.apply(this,arguments)}function Et(i,r){return gt.apply(this,arguments)}function gt(){return gt=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(r),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),gt.apply(this,arguments)}function At(i,r,t,n){return St.apply(this,arguments)}function St(){return St=x()(v()().mark(function i(r,t,n,a){return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/exams/".concat(r,"/users/").concat(t),c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return d.stop()}},i)})),St.apply(this,arguments)}function Vt(i,r,t){return le.apply(this,arguments)}function le(){return le=_asyncToGenerator(_regeneratorRuntime().mark(function i(r,t,n){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(r,"/users/").concat(t),_objectSpread({method:"DELETE"},n||{})));case 1:case"end":return l.stop()}},i)})),le.apply(this,arguments)}function Le(i,r,t){return de.apply(this,arguments)}function de(){return de=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(t,"/grades"),c()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},i)})),de.apply(this,arguments)}function xe(i,r,t,n){return je.apply(this,arguments)}function je(){return je=x()(v()().mark(function i(r,t,n,a){return v()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(t,"/grades"),c()({method:"POST",data:n},a||{})));case 1:case"end":return d.stop()}},i)})),je.apply(this,arguments)}function Ae(i,r){return et.apply(this,arguments)}function et(){return et=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",c()({method:"GET",params:{groups:r},useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),et.apply(this,arguments)}function dt(i,r,t){return ht.apply(this,arguments)}function ht(){return ht=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(t),c()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},i)})),ht.apply(this,arguments)}function Pt(i){return Mt.apply(this,arguments)}function Mt(){return Mt=x()(v()().mark(function i(r){return v()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,s.request)("/api/admin/grade-terms",c()({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},i)})),Mt.apply(this,arguments)}function zt(i,r){return Rt.apply(this,arguments)}function Rt(){return Rt=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(r),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Rt.apply(this,arguments)}function Xt(i,r){return $t.apply(this,arguments)}function $t(){return $t=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades",c()({method:"POST",data:r},t||{})));case 1:case"end":return a.stop()}},i)})),$t.apply(this,arguments)}function Ht(i,r,t){return Nt.apply(this,arguments)}function Nt(){return Nt=x()(v()().mark(function i(r,t,n){return v()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(r),c()({method:"PATCH",data:t},n||{})));case 1:case"end":return l.stop()}},i)})),Nt.apply(this,arguments)}function Yt(i,r){return Ot.apply(this,arguments)}function Ot(){return Ot=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(r),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),Ot.apply(this,arguments)}var Zt=o(47389),pa=o(13769),It=o.n(pa),ga=["results"],Jt=function(r,t){return r.reduce(function(n,a){var l=a.results,d=It()(a,ga),f=l.find(function(h){return h.user_id===t});return f?[].concat(k()(n),[c()(c()({},d),{},{result:f})]):n},[])},Qt=function(r,t){var n,a=r.reduce(function(p,j){var S=j.result,_=j.weight;return _&&typeof S.result=="number"?[p[0]+S.result*_,p[1]+_]:p},[0,0]),l=Z()(a,2),d=l[0],f=l[1],h=Number.isNaN(d/f)?0:d/f,b=t.sort(function(p,j){return p.grade_value-j.grade_value}).reduce(function(p,j){return[].concat(k()(p),[c()(c()({},j),{},{isWeightedAverageGreater:h>=j.grade_value})])},[]);if(b.every(function(p){var j=p.isWeightedAverageGreater;return j})){var y,C;return(y=(C=b.at(-1))===null||C===void 0?void 0:C.name)!==null&&y!==void 0?y:""}var F=b.findIndex(function(p){var j=p.isWeightedAverageGreater;return!j});return F<0?"":(n=b[F-1])===null||n===void 0?void 0:n.name},qt=function(r,t){var n;return(n=t.find(function(a){return a.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},bt=o(83863),ea=o(8925),ha=o(96486),ta=function(r){switch(r){case g.UL.ManualGrades:return 2;case g.UL.ManualPass:return g.wl.Failed;default:return 0}},xa=function(r){var t=r.exam_id,n=r.result,a=r.student_id,l=r.type,d=r.onSuccess,f=(0,m.useCallback)((0,ha.debounce)(function(b){At(t,a,{result:b!=null?b:ta(l)}).then(function(y){y.success&&(d==null||d(y.data))})},300),[t,n,a]),h=function(){switch(l){case g.UL.ManualPass:return(0,e.jsx)(bt.default,{allowClear:!0,style:{width:"100%"},onChange:f,options:ue.FW,defaultValue:String(n)});case g.UL.ManualGrades:return(0,e.jsx)(bt.default,{allowClear:!0,style:{width:"100%"},onChange:f,options:ue.BP,defaultValue:Number(n)});default:return(0,e.jsx)(ea.Z,{type:"number",min:0,max:100,onChange:f,defaultValue:Number(n)})}};return h()},ja=function(r,t){var n;return(n=r.find(function(a){return a.name===t}))===null||n===void 0?void 0:n.id},Sa=function(r){var t=r.term,n=r.gradeScales,a=r.defaultFinalGrade,l=r.finalGrades,d=(0,m.useState)(a),f=Z()(d,2),h=f[0],b=f[1],y=(0,m.useState)(!1),C=Z()(y,2),F=C[0],p=C[1],j=(0,m.useState)(!1),S=Z()(j,2),_=S[0],O=S[1],E=(0,s.useIntl)(),D=(0,m.useMemo)(function(){return n.map(function(H){var R=H.name,I=H.id;return{value:I,label:R}})},[n]),q=function(R){O(!0),ge.ZP.error(E.formatMessage({id:R.data.message}))},U=(0,m.useCallback)(function(H){if(l!=null&&l.id){if(H===void 0){if(!h)return;p(!0),Yt(h.id).then(function(R){R.success&&b(void 0)}).finally(function(){return p(!1)});return}if(h){p(!0),Ht(h.id,{grade_scale_id:H}).catch(function(R){var I;R!=null&&(I=R.data)!==null&&I!==void 0&&I.message&&q(R)}).finally(function(){return p(!1)});return}p(!0),Xt({grade_term_id:t.id,grade_scale_id:H,lesson_group_user_id:l.id}).then(function(R){if(R.success){var I=R.data.grades.find(function(L){return L.grade_term.id===t.id});b(I),_&&O(!1)}}).catch(function(R){var I;R!=null&&(I=R.data)!==null&&I!==void 0&&I.message&&q(R)}).finally(function(){return p(!1)})}},[h,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(bt.default,{allowClear:!0,status:_?"error":"",loading:F,disabled:F,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:U,options:D,defaultValue:ja(n,a==null?void 0:a.grade_name)}):null},ba=function(r){var t=r.reduce(function(n,a){return[].concat(k()(n),[{title:(0,qe.WU)(new Date(a.date_from),we.GC),dataIndex:"attendance-".concat(a.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,f){return(0,e.jsx)(rt,{groupAttendanceScheduleId:a.id,attendance:f["attendance-".concat(a==null?void 0:a.date_from)],studentId:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},ya=function(r,t){return r.reduce(function(n,a){var l=a.attendances.find(function(d){return d.user_id===t});return l?c()(c()({},n),{},u()({},"attendance-".concat(a.date_from),l.value)):n},{})},_a=function(r){var t=r.reduce(function(n,a){return[].concat(k()(n),[{dataIndex:"exam-".concat(a.id),title:a.type===g.UL.Manual?(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:a}):(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithoutWeight",values:a}),hideInSearch:!0,width:100,render:function(d,f){var h;return(f==null||(h=f["exam-".concat(a.id)])===null||h===void 0?void 0:h.result)!==void 0?(0,e.jsx)(xa,{type:a.type,result:f==null?void 0:f["exam-".concat(a.id)].result,exam_id:a.id,student_id:f.id}):"-"}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},Ma=function(r){return r.reduce(function(t,n){var a=n.result,l=n.id;return c()(c()({},t),{},u()({},"exam-".concat(l),a))},{})},Ca=function(r,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(l,d){var f;return(0,e.jsx)(Sa,{defaultFinalGrade:d["final-grade-".concat(n.id)],finalGrades:d.final_grades,term:n,gradeScales:t},"".concat(d==null||(f=d.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(n.id))}}})}},Ta=function(r,t){return r.find(function(n){return n.user.id===t})},Fa=function(r){var t;return((t=r==null?void 0:r.grades)!==null&&t!==void 0?t:[]).reduce(function(n,a){return c()(c()({},n),{},u()({},"final-grade-".concat(a.grade_term.id),a))},{})},Ea=function(){var r,t=(0,ae.Z)(),n=t.teacherSubjectData,a=t.semester_subject_id,l=(0,m.useState)([]),d=Z()(l,2),f=d[0],h=d[1],b=(0,m.useState)(n==null||(r=n.groups)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.name),y=Z()(b,2),C=y[0],F=y[1],p=(0,m.useState)(null),j=Z()(p,2),S=j[0],_=j[1],O=(0,s.useIntl)(),E=(0,m.useMemo)(function(){var U;return((U=n==null?void 0:n.groups)!==null&&U!==void 0?U:[]).map(function(H){var R=H.id,I=H.name;return{value:R,label:I}})},[n==null?void 0:n.groups]),D=(0,m.useRef)(),q=(0,m.useMemo)(function(){var U;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:E,defaultValue:E==null||(U=E[0])===null||U===void 0?void 0:U.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(R,I){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(Zt.Z,{}),onClick:function(){return _({userName:I.full_name,userId:I.id,groupId:I.final_grades.group_id})}})})})}}])},[E,f]);return(0,e.jsxs)(e.Fragment,{children:[(S==null?void 0:S.userId)&&(0,e.jsx)(re,{visible:!!S.userId,onClose:function(){return _(null)},user:{name:S.userName,userId:S.userId,groupId:S.groupId}}),(0,e.jsx)(pe.ZP,{sticky:!0,className:"table-standalone",request:function(){var U=x()(v()().mark(function H(R){var I,L,N,se,Ke,He,Ie,Re,Y,Me,z,fe,te,Ue,Ee,ye,Ce,Te,ke,nt,ft;return v()().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return se=R.group_id,Ke=se===void 0?(I=E[0])===null||I===void 0?void 0:I.value:se,He=R.full_name,Ie=He===void 0?"":He,Be.next=3,Ae([Ke]);case 3:if(Re=Be.sent,Y=E.find(function(it){var ut=it.value;return ut===Ke}),!(!Re.success||Re.data[0]===void 0||a===null)){Be.next=8;break}return ge.ZP.error(O.formatMessage({id:"groupDataMissing"},{group_name:Y==null?void 0:Y.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 8:return Be.next=10,Promise.all([(0,Pe.X)(Ke),pt(Ke),W({group_id:Ke,per_page:-1}),Le(a,(L=Re.data)===null||L===void 0||(L=L[0])===null||L===void 0?void 0:L.tutor_id),Pt(),zt((N=Re.data)===null||N===void 0||(N=N[0])===null||N===void 0?void 0:N.s_subject_scale_form_id)]);case 10:if(Me=Be.sent,z=Z()(Me,6),fe=z[0],te=z[1],Ue=z[2],Ee=z[3],ye=z[4],Ce=z[5],!(!fe.success||!te.success||!Ue.success||!Ee.success||!ye.success||!Ce.success||!Y)){Be.next=21;break}return ge.ZP.error(O.formatMessage({id:"groupDataMissing"},{group_name:Y==null?void 0:Y.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 21:return F(Y.label),Te=ba(te.data),ke=_a(Ue.data),nt=Ca(ye.data,Ce.data),h([Te,ke,nt,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),ft=fe.data.users.reduce(function(it,ut){var Lt,st,Ct,yt=ut.id,Or=ut.academic_teacher_id,Ur=ut.first_name,kr=ut.last_name,fa="".concat(kr," ").concat(Ur);if(Or!==null||!fa.toLowerCase().includes(Ie.toLowerCase()))return it;var Br=ya(te.data,yt),va=Jt(Ue.data,yt),Tt=Ta(Re.data,yt),Wr=(Lt=qt((st=Tt==null?void 0:Tt.s_subject_scale_form_id)!==null&&st!==void 0?st:0,(Ct=Ee.data.grade_scale)!==null&&Ct!==void 0?Ct:[]))!==null&&Lt!==void 0?Lt:[],Kr=Qt(va,Wr),Vr=Ma(va),zr=Fa(Tt);return[].concat(k()(it),[c()(c()(c()(c()({id:yt,full_name:fa},Br),Vr),zr),{},{proposed_grade:Kr,final_grades:Tt})])},[]).sort(function(it,ut){return it.full_name.localeCompare(ut.full_name)}),Be.abrupt("return",{data:ft,total:ft.length,success:!0});case 28:case"end":return Be.stop()}},H)}));return function(H){return U.apply(this,arguments)}}(),columns:q,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:C}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:D,pagination:{defaultPageSize:ue.Sl,onChange:function(){var H;return(H=D.current)===null||H===void 0?void 0:H.reload()}},rowKey:"id"})]})},aa=o(1413),Pa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Za=Pa,Ia=o(84089),ra=function(r,t){return m.createElement(Ia.Z,(0,aa.Z)((0,aa.Z)({},r),{},{ref:t,icon:Za}))};ra.displayName="LineChartOutlined";var wa=m.forwardRef(ra),na=o(82061),sa=o(86738),wt=o(62235),ot=o(952),Ga=o(5966),Da=o(50335),ia=o(71230),ct=o(15746),La=o(56717),ua=o(95830),Aa=o(29477),oa=function(r){return r===g.UL.Manual||r===g.UL.ManualPass||r===g.UL.ManualGrades},Ra=function(r){var t=r.type,n=r.onDataConverted,a=r.groupSelectDisabled,l=(0,ae.Z)(),d=l.semester_subject_id,f=l.teacherSubjectData,h=(0,m.useState)(null),b=Z()(h,2),y=b[0],C=b[1],F=(0,m.useMemo)(function(){var S;return((S=f==null?void 0:f.groups)!==null&&S!==void 0?S:[]).map(function(_){var O=_.id,E=_.name;return{label:E,value:O}})},[]),p={type:t,group_id:y,semester_subject_id:d},j=(0,m.useCallback)(function(S){if(S.success){var _=S.data.results.filter(function(O){var E=O.user_id;return E!==null});if(!_.length)return;n({exam_results:_,group_id:S.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(bt.default,{disabled:a,value:y,onChange:function(_){return C(_)},options:F,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Aa.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:j,onChange:function(_){return!_.fileList.length&&n(void 0)},maxFiles:1,data:p,disabled:!y})]})},$a=function(r){var t=r.onDataConverted,n=r.examType,a=(0,ae.Z)(),l=a.teacherSubjectData,d=a.groupUsers,f=(0,m.useState)(null),h=Z()(f,2),b=h[0],y=h[1],C=(0,m.useMemo)(function(){var p;return((p=l==null?void 0:l.groups)!==null&&p!==void 0?p:[]).map(function(j){var S=j.id,_=j.name;return{label:_,value:S}})},[]),F=(0,m.useCallback)(function(p){var j;y(p);var S=(j=d.byId)===null||j===void 0?void 0:j[p];if(S){var _=S.users.reduce(function(O,E){var D=E.id,q=E.email,U=E.first_name,H=E.last_name,R=E.academic_teacher_id;return R!==null?O:[].concat(k()(O),[{email:q,first_name:U,last_name:H,user_id:D,result:ta(n)}])},[]);t({group_id:p,exam_results:_})}},[d.byId]);return(0,e.jsx)(bt.default,{value:b,onChange:F,options:C,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Gt=u()(u()(u()(u()(u()(u()({},g.UL.TestPortal,["/teacher-examples/testPortal.png"]),g.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),g.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),g.UL.Manual,[]),g.UL.ManualPass,[]),g.UL.ManualGrades,[]),Na=function(r){var t=r.images,n=(0,m.useState)(!1),a=Z()(n,2),l=a[0],d=a[1],f=(0,m.useCallback)(function(){return d(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(T.ZP,{onClick:f,icon:(0,e.jsx)(La.Z,{})})}),(0,e.jsx)(ua.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:d},children:t.map(function(h){return(0,e.jsx)(ua.Z,{style:{display:"none"},src:h},h)})})]})},Oa=function(r){var t,n=r.type,a=r.onOk,l=r.onCancel,d=r.okDisabled,f=(t=Gt==null?void 0:Gt[n])!==null&&t!==void 0?t:Gt[g.UL.Manual];return(0,e.jsxs)(A.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)(Na,{images:f}),(0,e.jsxs)(A.Z,{children:[(0,e.jsx)(T.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(T.ZP,{type:"primary",disabled:d,onClick:a,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Ua=[g.UL.TeamsLecture,g.UL.TestPortal,g.UL.TeamsForms],ka=function(r){var t=r.open,n=r.closeModal,a=r.onSuccess,l=r.type,d=(0,ae.Z)(),f=d.teacherSubjectData,h=d.fetchGroupUsers,b=(0,m.useState)(),y=Z()(b,2),C=y[0],F=y[1];return(0,m.useEffect)(function(){if(oa(l)&&t){var p;f==null||(p=f.groups)===null||p===void 0||p.forEach(function(j){var S=j.id;return h(S)})}},[l,t]),(0,e.jsxs)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:n,footer:(0,e.jsx)(Oa,{type:l,onOk:function(){C&&a(C)},onCancel:n,okDisabled:!C}),children:[Ua.includes(l)&&(0,e.jsx)(Ra,{type:l,onDataConverted:F,groupSelectDisabled:!!C}),oa(l)&&(0,e.jsx)($a,{onDataConverted:F,examType:l})]})},Ba=function(r){var t=r.onSelect;return(0,e.jsxs)(ia.Z,{gutter:[16,16],children:[(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.ManualPass)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyPass",defaultMessage:"uploadGradesManuallyPass"})})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){return t(g.UL.ManualGrades)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyGrades",defaultMessage:"uploadGradesManuallyGrades"})})})]})},Wa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1}],Ka=function(r){var t,n=r.exam_id,a=ot.ZP.useForm(),l=Z()(a,1),d=l[0],f=(0,m.useState)(),h=Z()(f,2),b=h[0],y=h[1],C=(0,m.useState)(),F=Z()(C,2),p=F[0],j=F[1],S=(0,m.useState)(!1),_=Z()(S,2),O=_[0],E=_[1],D=(0,ae.Z)(),q=D.semester_subject_id,U=D.getGroupById,H=(0,m.useMemo)(function(){var I;return((I=p==null?void 0:p.exam_results)!==null&&I!==void 0?I:[]).map(function(L){var N=L.user_id;return N})},[p==null?void 0:p.exam_results]);(0,m.useEffect)(function(){var I=Number(n);n==="new"&&(y(void 0),j(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(I)&&(E(!0),Ft(I).then(function(L){if(L.success){var N=L.data,se=N.type,Ke=N.results,He=N.title,Ie=N.weight,Re=N.passed_at,Y=N.group_id;y(se),j({group_id:Y,exam_results:Ke}),d.setFieldsValue({title:He,weight:Ie,passed_at:Re})}}).finally(function(){return E(!1)}))},[n]);var R=(0,m.useCallback)(function(){y(void 0),j(void 0)},[]);return O?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[b&&(0,e.jsx)(ka,{open:!!(b&&!p),type:b,closeModal:R,onSuccess:j}),(0,e.jsxs)(ot.ZP,{form:d,submitter:b===void 0||!p?!1:void 0,onFinish:function(){var I=x()(v()().mark(function L(N){var se,Ke,He,Ie,Re,Y,Me,z;return v()().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:if(!(p&&typeof q=="number")){te.next=16;break}if(se=N.title,Ke=N.passed_at,He=N.weight,Ie=Number(n),Re=p.exam_results,Y=p.group_id,Me={type:b,semester_subject_id:q,title:se,passed_at:Ke,weight:He,group_id:Y,results:Re},!Number.isNaN(Ie)){te.next=11;break}return te.next=8,ee(Me);case 8:te.t0=te.sent,te.next=14;break;case 11:return te.next=13,Xe(Ie,Me);case 13:te.t0=te.sent;case 14:z=te.t0,z.success&&s.history.push("/teacher/subjects/".concat(q,"/exams"));case 16:return te.abrupt("return",!0);case 17:case"end":return te.stop()}},L)}));return function(L){return I.apply(this,arguments)}}(),onReset:R,children:[(0,e.jsxs)(ot.ZP.Group,{children:[(0,e.jsx)(Ga.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(Da.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),b!==g.UL.ManualGrades&&b!==g.UL.ManualPass&&(0,e.jsx)(ot.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(ea.Z,{})})]}),b&&p&&(0,e.jsx)(pe.ZP,{rowKey:"user_id",headerTitle:(t=U(p.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:H,onValuesChange:function(L,N){return j({group_id:p.group_id,exam_results:N})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:p.exam_results.sort(function(I,L){return I.last_name.localeCompare(L.last_name)}),pagination:{defaultPageSize:ue.Sl},columns:[].concat(Wa,[function(){switch(b){case g.UL.ManualPass:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:ue.FW}};case g.UL.ManualGrades:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:ue.BP}};default:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}}}()])}),!p&&(0,e.jsx)(Ba,{onSelect:y})]})]})},Va=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],za=function(r){var t=r.exam_id,n=(0,m.useState)(""),a=Z()(n,2),l=a[0],d=a[1];return(0,e.jsx)(pe.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:ue.Sl},request:x()(v()().mark(function f(){var h;return v()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,Ft(t);case 2:if(h=y.sent,!h.success){y.next=6;break}return d(h.data.title),y.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return y.abrupt("return",[]);case 7:case"end":return y.stop()}},f)})),columns:Va})},Xa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,t){return t.passed_at&&(0,qe.WU)(new Date(t.passed_at),we.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,t){return t.weight?t.weight+"%":""}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,t){return t.created_at&&(0,qe.WU)(new Date(t.created_at),we.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,t){return(0,e.jsx)(wt.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],Ha=function(){var r,t=(0,m.useRef)(),n=(0,ae.Z)(),a=n.semester_subject_id,l=(0,s.useLocation)(),d=new URLSearchParams(l.search),f=(r=d.get("exam_id"))!==null&&r!==void 0?r:null,h=d.get("results");return h!==null&&!Number.isNaN(Number(h))?(0,e.jsx)(za,{exam_id:Number(h)}):f!==null?(0,e.jsx)(Ka,{exam_id:f}):(0,e.jsx)(pe.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:ue.Sl},request:function(){var b=x()(v()().mark(function y(C,F){var p,j,S,_;return v()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=C.current,j=C.pageSize,a!==null){E.next=3;break}return E.abrupt("return",{data:[],total:0,success:!1});case 3:return S=F&&Object.entries(F)[0],E.next=6,W({per_page:j,page:p,semester_subject_id:Number.isNaN(a)?void 0:a,order_by:S&&S[0],order:S&&(S[1]==="ascend"?"ASC":"DESC")});case 6:if(_=E.sent,!_.success){E.next=9;break}return E.abrupt("return",{data:_.data,total:_.meta.total,success:!0});case 9:return E.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return E.stop()}},y)}));return function(y,C){return b.apply(this,arguments)}}(),columns:[].concat(Xa,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(y,C){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C.semester_subject_id,"/exams?exam_id=").concat(C.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(Zt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C.semester_subject_id,"/exams?results=").concat(C.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(T.ZP,{icon:(0,e.jsx)(wa,{})})})},"results"),(0,e.jsx)(sa.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:x()(v()().mark(function F(){var p;return v()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Et(C.id);case 2:p=S.sent,p.success&&t.current&&t.current.reload();case 4:case"end":return S.stop()}},F)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(na.Z,{}),danger:!0})})},"delete")]}}])})},Ya=o(69753),la=o(44167),Ja=o(84665),Qa=["type","defaultRender"],qa=["type","defaultRender"],er=function(r){var t=r.url;return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(Ya.Z,{})})})},tr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,t){return(0,qe.WU)(new Date(t.created_at),we.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,t,n){var a=t.type,l=t.defaultRender,d=It()(t,Qa);if(a==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(la.Z,c()(c()({},d),{},{state:{type:f}}))},render:function(r,t){var n,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(n=t.created_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(a=t.created_by)!==null&&a!==void 0&&a.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,t){return(0,qe.WU)(new Date(t.exported_at),we.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,t,n){var a=t.type,l=t.defaultRender,d=It()(t,qa);if(a==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(la.Z,c()(c()({},d),{},{state:{type:f}}))},render:function(r,t){var n,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(n=t.exported_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(a=t.exported_by)!==null&&a!==void 0&&a.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(r,t){return[(0,e.jsx)(er,{url:t.url},"download")]}}],ar=function(){var r,t=(0,ae.Z)(),n=t.teacherSubjectData,a=(0,m.useMemo)(function(){var d;return((d=n==null?void 0:n.groups)!==null&&d!==void 0?d:[]).map(function(f){var h=f.id,b=f.name;return{value:h,label:b}})},[n==null?void 0:n.groups]),l=(0,m.useMemo)(function(){var d;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:a,defaultValue:n==null||(d=n.groups)===null||d===void 0||(d=d[0])===null||d===void 0?void 0:d.id,allowClear:!1}}].concat(tr)},[n==null||(r=n.groups)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.id,a]);return(0,e.jsx)(pe.ZP,{className:"table-standalone",request:function(){var d=x()(v()().mark(function f(h){var b,y,C,F,p,j;return v()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return y=h.group_id,C=y===void 0?n==null||(b=n.groups)===null||b===void 0||(b=b[0])===null||b===void 0?void 0:b.id:y,F=h.created_by,p=h.exported_by,_.next=3,(0,Ja.v)({group_id:C,created_by:F,exported_by:p});case 3:if(j=_.sent,j.success){_.next=6;break}return _.abrupt("return",{success:!1,data:[],total:0});case 6:return _.abrupt("return",{success:!0,data:j.data,total:j.data.length});case 7:case"end":return _.stop()}},f)}));return function(f){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:ue.Sl}})},da=o(64317),Ut=o(96074),ca=o(11312),rr=o(87366),kt=o(99100),nr=["attendances"];function sr(i){return function(t){i(function(n){return c()(c()({},n),{},{loading:t})})}}function ma(i,r){return Bt.apply(this,arguments)}function Bt(){return Bt=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r(!0),a.prev=1,a.abrupt("return",t());case 3:return a.prev=3,r(!1),a.finish(3);case 6:case"end":return a.stop()}},i,null,[[1,,3,6]])})),Bt.apply(this,arguments)}function ir(i,r){var t=(0,m.useState)({loading:!1}),n=Z()(t,2),a=n[0],l=n[1],d=(0,m.useCallback)(sr(l),[]),f=(0,m.useCallback)(x()(v()().mark(function b(){var y;return v()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,dt(i,r);case 2:if(y=F.sent,y.success){F.next=5;break}return F.abrupt("return",y);case 5:return l(function(p){return c()(c()({},p),{},{data:y.data})}),F.abrupt("return",y);case 7:case"end":return F.stop()}},b)})),[r,i]),h=(0,m.useCallback)(function(b){return ma(d,function(){return Yt(b).then(f)})},[f]);return(0,m.useEffect)(function(){ma(d,f)},[f]),{finalGrades:a,deleteFinalGrade:h}}function ur(){var i=(0,m.useState)({loading:!1}),r=Z()(i,2),t=r[0],n=r[1];return(0,m.useEffect)(function(){n(function(a){return c()(c()({},a),{},{loading:!0})}),Pt().then(function(a){a.success&&n(function(l){return c()(c()({},l),{},{data:a.data})})}).finally(function(){n(function(a){return c()(c()({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function or(i){var r=(0,m.useState)({loading:!1}),t=Z()(r,2),n=t[0],a=t[1];return(0,m.useEffect)(function(){i!==void 0&&(a(function(l){return c()(c()({},l),{},{loading:!0})}),zt(i).then(function(l){l.success&&a(function(d){return c()(c()({},d),{},{data:l.data})})}).finally(function(){a(function(l){return c()(c()({},l),{},{loading:!1})})}))},[i]),{subjectGradeScales:n}}function lr(i,r,t){var n=(0,m.useState)({loading:!1}),a=Z()(n,2),l=a[0],d=a[1];return(0,m.useEffect)(function(){typeof i!="number"||typeof r!="number"||typeof t!="number"||(d(function(f){return c()(c()({},f),{},{loading:!0})}),Le(i,r).then(function(f){f.success&&d(function(h){var b,y;return c()(c()({},h),{},{data:(b=qt(t,(y=f.data.grade_scale)!==null&&y!==void 0?y:[]))===null||b===void 0?void 0:b.map(function(C,F){return c()(c()({},C),{},{id:F})})})})}).finally(function(){d(function(f){return c()(c()({},f),{},{loading:!1})})}))},[i,r]),{tutorGradeScales:l}}function dr(i,r){var t=(0,m.useState)({loading:!1}),n=Z()(t,2),a=n[0],l=n[1],d=(0,m.useCallback)(function(){l(function(f){return c()(c()({},f),{},{loading:!0})}),pt(i).then(function(f){if(f.success){var h=f.data.reduce(function(b,y){var C=y.attendances,F=It()(y,nr),p=C.find(function(j){return j.user_id===r});return p?[].concat(k()(b),[c()(c()({},F),{},{attendance:p})]):b},[]);l(function(b){return c()(c()({},b),{},{data:h})})}}).finally(function(){l(function(f){return c()(c()({},f),{},{loading:!1})})})},[i,r]);return(0,m.useEffect)(function(){d()},[d]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:d}}function cr(i,r){var t=(0,m.useState)({loading:!1}),n=Z()(t,2),a=n[0],l=n[1];return(0,m.useEffect)(function(){r&&(l(function(d){return c()(c()({},d),{},{loading:!0})}),W({student_id:i,semester_subject_id:r}).then(function(d){if(d.success){var f=Jt(d.data,i);l(function(h){return c()(c()({},h),{},{data:f})})}}).finally(function(){l(function(d){return c()(c()({},d),{},{loading:!1})})}))},[i,r]),{studentExams:a}}function mr(i,r){var t=(0,m.useState)({loading:!1}),n=Z()(t,2),a=n[0],l=n[1],d=(0,m.useState)({loading:!1}),f=Z()(d,2),h=f[0],b=f[1],y=(0,m.useState)({loading:!1}),C=Z()(y,2),F=C[0],p=C[1];return(0,m.useEffect)(function(){l(function(j){return c()(c()({},j),{},{loading:!0})}),(0,kt.N7)({group_id:i}).then(function(j){j.success&&l(function(S){return c()(c()({},S),{},{data:j.data})})}).finally(function(){l(function(j){return c()(c()({},j),{},{loading:!1})})})},[i]),(0,m.useEffect)(function(){a.data&&(p(function(j){return c()(c()({},j),{},{loading:!0})}),Promise.all(a.data.map(function(j){var S=j.id;return(0,kt.Nx)(Number(S))})).then(function(j){j.forEach(function(S){S.success&&p(function(_){return c()(c()({},_),{},{data:c()(c()({},_.data),{},u()({},Number(S.data.id),(0,rr.uS)(S.data.lessons)))})})})}).finally(function(){p(function(j){return c()(c()({},j),{},{loading:!1})})}),b(function(j){return c()(c()({},j),{},{loading:!0})}),Promise.all(a.data.map(function(j){var S=j.id;return(0,kt.ue)(Number(S),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(_){if(_.success){var O,E,D=((O=_.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&O!==void 0?O:[]).filter(function(U){return U.id===r}),q=(E=_.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&E!==void 0?E:[];b(function(U){return c()(c()({},U),{},{data:c()(c()({},U.data),{},u()({},Number(S),{finishedTopics:D,attendanceList:q}))})})}})})).finally(function(){return b(function(j){return c()(c()({},j),{},{loading:!1})})}))},[a.data,r]),{userCourses:a,userCoursesStats:h,userCoursesTopics:F}}var fr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],vr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(r,t){return(0,qe.WU)(new Date(t.date_from),we.GC)}}],pr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,t){return(0,qe.WU)(new Date(t.created_at),we.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(r,t){return"".concat(t.result.result," ").concat(t.weight?"%":"")}}],gr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(r,t){var n,a;return(n=t.grade)!==null&&n!==void 0&&n.grade_date?(0,qe.WU)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),we.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(r,t){var n,a;return(n=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&n!==void 0?n:"-"}}],Dt=6,hr=function(r){var t,n,a,l,d=r.user_id,f=r.group_id,h=(0,ae.Z)(),b=h.semester_subject_id,y=cr(d,b),C=y.studentExams,F=ir(f,d),p=F.finalGrades,j=F.deleteFinalGrade,S=ur(),_=S.gradeTerms,O=or((t=p.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),E=O.subjectGradeScales,D=lr(b,(n=p.data)===null||n===void 0?void 0:n.tutor_id,(a=p.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),q=D.tutorGradeScales,U=dr(f,d),H=U.userAttendanceSchedules,R=U.fetchUserAttendanceSchedules,I=mr(f,d),L=I.userCourses,N=I.userCoursesStats,se=I.userCoursesTopics,Ke=ot.ZP.useForm(),He=Z()(Ke,1),Ie=He[0],Re=(0,m.useMemo)(function(){var ye;return((ye=_.data)!==null&&ye!==void 0?ye:[]).map(function(Ce){var Te=Ce.id,ke=Ce.name;return{label:ke,value:Te}})},[_.data]),Y=(0,m.useMemo)(function(){var ye;return((ye=E.data)!==null&&ye!==void 0?ye:[]).map(function(Ce){var Te=Ce.name,ke=Ce.id;return{label:Te,value:ke}})},[E.data]),Me=(0,m.useMemo)(function(){var ye,Ce;return Qt((ye=C.data)!==null&&ye!==void 0?ye:[],(Ce=q.data)!==null&&Ce!==void 0?Ce:[])},[C.data,q.data]),z=(0,m.useCallback)(function(){var ye=x()(v()().mark(function Ce(Te){var ke,nt,ft,vt,Be,it,ut;return v()().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(ft=Te.grade_scale_id,vt=Te.grade_term_id,((ke=p.data)===null||ke===void 0?void 0:ke.id)!==void 0){st.next=3;break}return st.abrupt("return");case 3:if(Be=(nt=p.data)===null||nt===void 0?void 0:nt.grades.find(function(Ct){var yt=Ct.grade_term;return yt.id===vt}),!Be){st.next=11;break}return st.next=7,Ht(Be.id,{grade_scale_id:ft});case 7:return it=st.sent,ge.ZP[it.success?"success":"error"](it.message),it.success&&s.history.push("/teacher/subjects/".concat(b,"/final-grades")),st.abrupt("return");case 11:return st.next=13,Xt({grade_scale_id:ft,grade_term_id:vt,lesson_group_user_id:p.data.id});case 13:ut=st.sent,ge.ZP[ut.success?"success":"error"](ut.message),ut.success&&s.history.push("/teacher/subjects/".concat(b,"/final-grades"));case 16:case"end":return st.stop()}},Ce)}));return function(Ce){return ye.apply(this,arguments)}}(),[p.data,b]),fe=(0,m.useMemo)(function(){return[].concat(gr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Ce,Te){var ke;return typeof(Te==null||(ke=Te.grade)===null||ke===void 0?void 0:ke.id)=="number"?[(0,e.jsx)(sa.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return j(Te.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(na.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),te=(0,m.useMemo)(function(){var ye;return((ye=_.data)!==null&&ye!==void 0?ye:[]).map(function(Ce){var Te;return c()(c()({},Ce),{},{grade:(Te=p.data)===null||Te===void 0?void 0:Te.grades.find(function(ke){var nt=ke.grade_term;return nt.id===Ce.id})})})},[p.data,_.data]),Ue=L.loading&&!L.data||N.loading&&!N.data||se.loading&&!se.data,Ee=!!(L.data&&N.data&&se.data);return p.loading?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[p.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:p.data.user})}),(0,e.jsx)(Ut.Z,{})]}),(0,e.jsxs)(ia.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(pe.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:C.data,loading:C.loading,columns:pr,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(pe.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:te,loading:p.loading||_.loading,columns:fe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(pe.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:H.data,loading:H.loading,columns:[].concat(vr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Ce,Te){return(0,e.jsx)(rt,{groupAttendanceScheduleId:Te.id,studentId:d,attendance:Te.attendance.value,onSuccess:R})}}])})}),(0,e.jsx)(ct.Z,{span:12,children:(0,e.jsx)(pe.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:q.data,loading:q.loading,columns:fr})}),Ue&&(0,e.jsx)($e.Z,{}),Ee&&((l=L.data)===null||l===void 0?void 0:l.map(function(ye){var Ce,Te,ke,nt,ft,vt,Be=ye.id,it=ye.title;return(0,e.jsxs)(ct.Z,{span:24,children:[(0,e.jsx)(J.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:it}),(0,e.jsx)(ca.Du,{course_id:Number(Be),topics:(Ce=(Te=se.data)===null||Te===void 0?void 0:Te[Number(Be)])!==null&&Ce!==void 0?Ce:[],stats:(ke=(nt=N.data)===null||nt===void 0||(nt=nt[Number(Be)])===null||nt===void 0?void 0:nt.finishedTopics)!==null&&ke!==void 0?ke:[]}),(0,e.jsx)(ca.nu,{stats:(ft=(vt=N.data)===null||vt===void 0||(vt=vt[Number(Be)])===null||vt===void 0?void 0:vt.attendanceList)!==null&&ft!==void 0?ft:[]})]},Be)}))]}),(0,e.jsx)(ot.ZP,{form:Ie,onFinish:z,children:(0,e.jsxs)(ot.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(da.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:Re,width:"sm",fieldProps:{loading:_.loading}}),(0,e.jsx)(da.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Y,fieldProps:{loading:p.loading||E.loading}}),(0,e.jsx)(ot.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Me}})})]})})]})},xr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(r,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(r,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(n){var a=n.grade_name,l=n.grade_term,d=n.id;return(0,e.jsxs)(J.Z.Text,{children:[l.name,": ",a]},d)}):"-"})}}],jr=function(){var r,t,n=(0,s.useLocation)(),a=new URLSearchParams(n.search),l=(r=a.get("user_id"))!==null&&r!==void 0?r:null,d=(t=a.get("group_id"))!==null&&t!==void 0?t:null,f=(0,ae.Z)(),h=f.teacherSubjectData,b=f.semester_subject_id,y=(0,m.useMemo)(function(){var C;return((C=h==null?void 0:h.groups)!==null&&C!==void 0?C:[]).map(function(F){var p=F.id,j=F.name;return{label:j,value:p}})},[h==null?void 0:h.groups]);return l!==null&&d!==null?(0,e.jsx)(hr,{user_id:Number(l),group_id:Number(d)}):(0,e.jsx)(pe.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:ue.Sl},request:function(){var C=x()(v()().mark(function F(p){var j,S,_,O,E,D,q,U,H,R;return v()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return S=p.group_id,_=S===void 0?[]:S,O=p.first_name,E=O===void 0?"":O,D=p.last_name,q=D===void 0?"":D,U=((j=h==null?void 0:h.groups)!==null&&j!==void 0?j:[]).map(function(N){var se=N.id;return se}),L.next=4,Ae(_.length===0?U:_);case 4:if(H=L.sent,H.success){L.next=7;break}return L.abrupt("return",{success:!1,total:0,data:[]});case 7:return R=H.data.filter(function(N){var se=N.user;return se.first_name.toLowerCase().includes(E.toLowerCase())&&se.last_name.toLowerCase().includes(q.toLowerCase())}),L.abrupt("return",{success:!0,total:R.length,data:R});case 9:case"end":return L.stop()}},F)}));return function(F){return C.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:y,mode:"multiple"},render:function(F,p){return(0,e.jsx)(wt.Z,{type:"Students",type_id:p.group_id},p.group_id)}}].concat(xr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(F,p){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(b,"/final-grades?user_id=").concat(p.user.id,"&group_id=").concat(p.group_id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(Zt.Z,{})})})},"edit")]}}])})},Sr=o(88284),br=o(88280),yr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],_r=function(r){var t=r.subjectTutorGradeScale,n=r.onFormSubmit,a=(0,m.useState)([]),l=Z()(a,2),d=l[0],f=l[1],h=(0,m.useRef)(),b=ot.ZP.useForm(),y=Z()(b,1),C=y[0];return(0,m.useEffect)(function(){var F,p=((F=t.scale)!==null&&F!==void 0?F:[]).map(function(j,S){return c()(c()({},j),{},{id:String((S+1)*100)})});C.setFieldValue("table",p)},[]),(0,e.jsx)(ot.ZP,{form:C,onFinish:n,submitter:{render:function(p,j){var S=Z()(j,2),_=S[1];return[_]}},children:(0,e.jsx)(br.Z,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(yr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(p,j){return(0,e.jsx)(T.ZP,{type:"primary",onClick:function(){var _;return(_=h.current)===null||_===void 0?void 0:_.startEditable(j.id)},icon:(0,e.jsx)(Zt.Z,{})})}}]),editable:{form:C,type:"multiple",editableKeys:d,saveText:(0,e.jsx)(T.ZP,{type:"primary",icon:(0,e.jsx)(Sr.Z,{})}),onChange:f,actionRender:function(p,j,S){return[S.save]}}})})},Mr=function(){var r,t,n=(0,s.useModel)("@@initialState"),a=n.initialState,l=(0,ae.Z)(),d=l.semester_subject_id,f=l.tutors,h=(0,m.useState)(),b=Z()(h,2),y=b[0],C=b[1],F=(0,m.useState)(!1),p=Z()(F,2),j=p[0],S=p[1],_=(0,m.useState)(null),O=Z()(_,2),E=O[0],D=O[1],q=(0,m.useMemo)(function(){return!!f.data.find(function(I){var L,N=I.id;return N===(a==null||(L=a.currentUser)===null||L===void 0?void 0:L.id)})},[f.data,a==null||(r=a.currentUser)===null||r===void 0?void 0:r.id]),U=(0,m.useMemo)(function(){return f.data.map(function(I){var L=I.id,N=I.first_name,se=I.last_name;return{label:"".concat(N," ").concat(se),value:L}})},[f.data]),H=(0,m.useCallback)(function(){d===null||E===null||(S(!0),C(void 0),Le(d,E).then(function(I){I.success&&C(I.data)}).finally(function(){S(!1)}))},[d,E]),R=(0,m.useCallback)(function(I,L){return function(){var N=x()(v()().mark(function se(Ke){var He,Ie;return v()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!(d===null||E===null)){Y.next=2;break}return Y.abrupt("return");case 2:return He=I.reduce(function(Me,z){return z.s_subject_scale_form_id===L?[].concat(k()(Me),[{s_subject_scale_form_id:L,scale:Ke.table.map(function(fe){var te=fe.name,Ue=fe.grade,Ee=fe.grade_value;return{name:te,grade:Ue,grade_value:Ee}})}]):[].concat(k()(Me),[z])},[]),Y.next=5,xe(d,E,{grade_scale:He});case 5:Ie=Y.sent,Ie.success&&H();case 7:case"end":return Y.stop()}},se)}));return function(se){return N.apply(this,arguments)}}()},[E,d]);return(0,m.useEffect)(function(){var I,L;if(!q||!(a!=null&&(I=a.currentUser)!==null&&I!==void 0&&I.id)){var N;if((N=f.data)!==null&&N!==void 0&&N[0]){var se;D((se=f.data)===null||se===void 0?void 0:se[0].id)}return}D(a==null||(L=a.currentUser)===null||L===void 0?void 0:L.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,q]),(0,m.useEffect)(function(){H()},[H]),f.loading?(0,e.jsx)($e.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(bt.default,{disabled:q,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:U,value:E,onChange:function(L){return D(L)}})}),(0,e.jsx)(Ut.Z,{}),j&&!y&&(0,e.jsx)($e.Z,{}),y!=null&&y.grade_scale?y.grade_scale.map(function(I,L){var N;return(0,e.jsxs)(m.Fragment,{children:[L>0&&(0,e.jsx)(Ut.Z,{}),(0,e.jsx)(_r,{subjectTutorGradeScale:I,onFormSubmit:R((N=y.grade_scale)!==null&&N!==void 0?N:[],I.s_subject_scale_form_id)})]},I.s_subject_scale_form_id)}):(0,e.jsx)(J.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},Cr=o(30814),Tr=o(40411),Fr=o(31156),Er=o(27484),mt=o.n(Er);function Pr(i,r){return Wt.apply(this,arguments)}function Wt(){return Wt=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules",c()({params:r,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Wt.apply(this,arguments)}var Zr=function(){var r=(0,m.useState)(null),t=Z()(r,2),n=t[0],a=t[1],l=(0,m.useState)([]),d=Z()(l,2),f=d[0],h=d[1],b=(0,ae.Z)(),y=b.semester_subject_id,C=mt()(),F=(0,m.useMemo)(function(){return f.map(function(D){return{id:D.id,title:"".concat(D.group.name," (").concat(D.term_status.name,")"),start:mt()(D.date_from).toDate(),end:mt()(D.date_to).toDate(),tutor_name:"".concat(D.tutor.first_name," ").concat(D.tutor.last_name),tutor_email:D.tutor.email,semester:D.semester.name,group:D.group.name,subject:D.subject.name,ms_teams_join_url:D.ms_teams_join_url}})},[f]),p=(0,m.useCallback)(function(D,q){Pr({semester_subject_id:y,date_form:D.toDate(),date_to:q.toDate()}).then(function(U){U.success&&h(U.data)})},[y]),j=(0,m.useCallback)(function(D){a(D)},[]),S=(0,m.useCallback)(function(){a(null)},[]),_=(0,m.useCallback)(function(D){return D.isSame(C,"day")?"warning":D.isAfter(C,"day")?"success":"error"},[]),O=(0,m.useCallback)(function(D){var q=F.filter(function(U){return mt()(U.start).isSame(D,"day")});return(0,e.jsx)("ul",{className:"events",children:q.map(function(U){return(0,e.jsx)("li",{onClick:function(){return j(U)},children:(0,e.jsx)(Tr.Z,{status:_(mt()(U.start)),text:U.title})},U.id)})})},[f]),E=(0,m.useCallback)(function(D,q){var U=mt()(D).startOf(q).subtract(1,"month"),H=mt()(D).endOf(q).add(1,"month");p(U,H)},[]);return(0,m.useEffect)(function(){var D=mt()().startOf("month"),q=mt()().endOf("month");p(D,q)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(Fr.Z,{dateCellRender:O,onPanelChange:E}),(0,e.jsxs)(he.Z,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:S,footer:null,children:[(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",n&&mt()(n.start).format(we.E)]}),(0,e.jsxs)(J.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",n&&mt()(n.end).format(we.E)]}),(n==null?void 0:n.ms_teams_join_url)&&(0,e.jsx)(J.Z.Paragraph,{children:(0,e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(T.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},Ir=o(58638);function wr(i,r){return Kt.apply(this,arguments)}function Kt(){return Kt=x()(v()().mark(function i(r,t){return v()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return a.stop()}},i)})),Kt.apply(this,arguments)}var Gr=function(r){var t=r.student_id,n=(0,m.useState)(!1),a=Z()(n,2),l=a[0],d=a[1],f=(0,m.useCallback)(x()(v()().mark(function h(){var b;return v()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return d(!0),C.next=3,wr({user_id:t});case 3:if(b=C.sent,b.success){C.next=8;break}return ge.ZP.error(b.message),d(!1),C.abrupt("return");case 8:window.open(b.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return C.stop()}},h)})),[]);return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(T.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(Ir.Z,{}),onClick:f})})},Dr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Lr=function(r){return r.map(function(t){var n=t.id,a=t.name;return{label:a,value:n}})},Ar=function(r){return r.reduce(function(t,n){var a,l=n==null||(a=n.users)===null||a===void 0?void 0:a.reduce(function(d,f){return f.academic_teacher_id!==null?d:[].concat(k()(d),[{group_id:n.id,group_name:n.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(k()(t),k()(l))},[])},Rr=function(){var r=(0,ae.Z)(),t=r.teacherSubjectData,n=(0,m.useMemo)(function(){var a;return Lr((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(pe.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:ue.Sl},request:function(){var a=x()(v()().mark(function l(d){var f,h,b,y,C,F,p,j,S;return v()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return f=d.groups,h=d.first_name,b=h===void 0?"":h,y=d.last_name,C=y===void 0?"":y,F=d.email,p=F===void 0?"":F,O.next=3,(0,Pe.Z)({parent_id:t==null?void 0:t.group_id,"id[]":f});case 3:if(j=O.sent,j.success){O.next=6;break}return O.abrupt("return",{data:[],total:0,success:!1});case 6:return S=Ar(j.data).filter(function(E){return E.first_name.toLowerCase().includes(b.toLowerCase())&&E.last_name.toLowerCase().includes(C.toLowerCase())&&E.email.toLowerCase().includes(p.toLowerCase())}),O.abrupt("return",{data:S,total:S.length,success:!0});case 8:case"end":return O.stop()}},l)}));return function(l){return a.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(Dr,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,d){return[(0,e.jsx)(Gr,{student_id:d.user_id},"teamsChat")]}}])})},$r=function(r){var t,n,a=r.tab,l=(0,s.useIntl)(),d=(0,s.useModel)("@@initialState"),f=d.setInitialState,h=d.initialState,b=(0,ae.Z)(),y=b.teacherSubjectData,C=b.semester_subject_id,F=b.tutors,p=(0,m.useCallback)((0,ze.X)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),j=(0,m.useMemo)(function(){return!!F.data.find(function(S){var _,O=S.id;return O===(h==null||(_=h.currentUser)===null||_===void 0?void 0:_.id)})||p(Ve.Z.TeacherListGradeScale)},[]);return y?(0,e.jsx)(w._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:y==null||(t=y.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:a})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C,"/exams?exam_id=new"),children:(0,e.jsx)(T.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(C),breadcrumbName:String((n=y.subject)===null||n===void 0?void 0:n.name)},{path:String(a),breadcrumbName:l.formatMessage({id:a,defaultMessage:String(a)})}]}},children:(0,e.jsxs)(Fe.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(_){f(c()({},h)),s.history.push("/teacher/subjects/".concat(C,"/").concat(_))}},children:[(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(Cr.F,{})},"groups"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(Rr,{})},"students"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(Ha,{})},"exams"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Zr,{})},"schedule"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(Ea,{})},"class-register"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),children:(0,e.jsx)(Ze,{})},"attendance"),j&&(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(Mr,{})},"grades-scale"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(jr,{})},"final-grades"),(0,e.jsx)(Fe.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(ar,{})},"file-exports-history")]})}):(0,e.jsx)($e.Z,{})},Nr=function(){var i=(0,s.useParams)(),r=i.subjectId,t=i.tab,n=t===void 0?"groups":t;return(0,e.jsx)(ae.p,{semester_subject_id:Number(r),children:(0,e.jsx)($r,{tab:n})})}},76841:function(jt,at,o){o.d(at,{Gm:function(){return s},Sx:function(){return v},_g:function(){return ze}});var Qe=o(15009),c=o.n(Qe),Fe=o(97857),w=o.n(Fe),$e=o(99289),T=o.n($e),m=o(80854);function s(u,M){return Ve.apply(this,arguments)}function Ve(){return Ve=T()(c()().mark(function u(M,x){return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",(0,m.request)("/api/admin/reports/report",w()({params:M,method:"GET",useCache:!1},x||{})));case 1:case"end":return k.stop()}},u)})),Ve.apply(this,arguments)}function ze(u,M,x){return ce.apply(this,arguments)}function ce(){return ce=T()(c()().mark(function u(M,x,ie){return c()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.abrupt("return",(0,m.request)("/api/admin/stats/course/".concat(M,"/export"),w()({params:x,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return Se.stop()}},u)})),ce.apply(this,arguments)}function v(u,M,x){return P.apply(this,arguments)}function P(){return P=T()(c()().mark(function u(M,x,ie){return c()().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return Se.abrupt("return",(0,m.request)("/api/admin/stats/topic/".concat(M,"/export"),w()({method:"GET",useCache:!1,params:{stat:x},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return Se.stop()}},u)})),P.apply(this,arguments)}},70804:function(jt,at,o){var Qe=o(67294);var c=function(ce,v){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,u){P.__proto__=u}||function(P,u){for(var M in u)u.hasOwnProperty(M)&&(P[M]=u[M])})(ce,v)},Fe,w,$e=(function(ce){(function(){var v={}.hasOwnProperty;function P(){for(var u=[],M=0;M<arguments.length;M++){var x=arguments[M];if(x){var ie=typeof x;if(ie==="string"||ie==="number")u.push(x);else if(Array.isArray(x)&&x.length){var k=P.apply(null,x);k&&u.push(k)}else if(ie==="object")for(var Se in x)v.call(x,Se)&&x[Se]&&u.push(Se)}}return u.join(" ")}ce.exports?(P.default=P,ce.exports=P):window.classNames=P})()}(w={path:Fe,exports:{},require:function(ce,v){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(v==null&&w.path)}},w.exports),w.exports);function T(ce,v,P){var u,M,x,ie,k;function Se(){var pe=Date.now()-ie;pe<v&&pe>=0?u=setTimeout(Se,v-pe):(u=null,P||(k=ce.apply(x,M),x=M=null))}v==null&&(v=100);var Z=function(){x=this,M=arguments,ie=Date.now();var pe=P&&!u;return u||(u=setTimeout(Se,v)),pe&&(k=ce.apply(x,M),x=M=null),k};return Z.clear=function(){u&&(clearTimeout(u),u=null)},Z.flush=function(){u&&(k=ce.apply(x,M),x=M=null,clearTimeout(u),u=null)},Z}T.debounce=T;var m=T;(function(ce,v){v===void 0&&(v={});var P=v.insertAt;if(ce&&typeof document!="undefined"){var u=document.head||document.getElementsByTagName("head")[0],M=document.createElement("style");M.type="text/css",P==="top"&&u.firstChild?u.insertBefore(M,u.firstChild):u.appendChild(M),M.styleSheet?M.styleSheet.cssText=ce:M.appendChild(document.createTextNode(ce))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var s,Ve=(s="indiana-scroll-container",function(ce,v){if(!ce)return s;var P;typeof ce=="string"?P=ce:v=ce;var u=s;return P&&(u+="__"+P),u+(v?Object.keys(v).reduce(function(M,x){var ie=v[x];return ie&&(M+=" "+(typeof ie=="boolean"?u+"--"+x:u+"--"+x+"_"+ie)),M},""):"")}),ze=function(ce){function v(P){var u=ce.call(this,P)||this;return u.onEndScroll=function(){u.scrolling=!1,!u.pressed&&u.started&&u.processEnd()},u.onScroll=function(M){var x=u.container.current;x.scrollLeft===u.scrollLeft&&x.scrollTop===u.scrollTop||(u.scrolling=!0,u.processScroll(M),u.onEndScroll())},u.onTouchStart=function(M){var x=u.props.nativeMobileScroll;if(u.isDraggable(M.target))if(u.internal=!0,x&&u.scrolling)u.pressed=!0;else{var ie=M.touches[0];u.processClick(M,ie.clientX,ie.clientY),!x&&u.props.stopPropagation&&M.stopPropagation()}},u.onTouchEnd=function(M){var x=u.props.nativeMobileScroll;u.pressed&&(!u.started||u.scrolling&&x?u.pressed=!1:u.processEnd(),u.forceUpdate())},u.onTouchMove=function(M){var x=u.props.nativeMobileScroll;if(u.pressed&&(!x||!u.isMobile)){var ie=M.touches[0];ie&&u.processMove(M,ie.clientX,ie.clientY),M.preventDefault(),u.props.stopPropagation&&M.stopPropagation()}},u.onMouseDown=function(M){u.isDraggable(M.target)&&u.isScrollable()&&(u.internal=!0,u.props.buttons.indexOf(M.button)!==-1&&(u.processClick(M,M.clientX,M.clientY),M.preventDefault(),u.props.stopPropagation&&M.stopPropagation()))},u.onMouseMove=function(M){u.pressed&&(u.processMove(M,M.clientX,M.clientY),M.preventDefault(),u.props.stopPropagation&&M.stopPropagation())},u.onMouseUp=function(M){u.pressed&&(u.started?u.processEnd():(u.internal=!1,u.pressed=!1,u.forceUpdate(),u.props.onClick&&u.props.onClick(M)),M.preventDefault(),u.props.stopPropagation&&M.stopPropagation())},u.container=Qe.createRef(),u.onEndScroll=m(u.onEndScroll,300),u.scrolling=!1,u.started=!1,u.pressed=!1,u.internal=!1,u.getRef=u.getRef.bind(u),u}return function(P,u){function M(){this.constructor=P}c(P,u),P.prototype=u===null?Object.create(u):(M.prototype=u.prototype,new M)}(v,ce),v.prototype.componentDidMount=function(){var P=this.props.nativeMobileScroll,u=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),u.addEventListener("touchstart",this.onTouchStart,{passive:!1}),u.addEventListener("mousedown",this.onMouseDown,{passive:!1}),P&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},v.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},v.prototype.getElement=function(){return this.container.current},v.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},v.prototype.isDraggable=function(P){var u=this.props.ignoreElements;if(u){var M=P.closest(u);return M===null||M.contains(this.getElement())}return!0},v.prototype.isScrollable=function(){var P=this.container.current;return P&&(P.scrollWidth>P.clientWidth||P.scrollHeight>P.clientHeight)},v.prototype.processClick=function(P,u,M){var x=this.container.current;this.scrollLeft=x.scrollLeft,this.scrollTop=x.scrollTop,this.clientX=u,this.clientY=M,this.pressed=!0},v.prototype.processStart=function(P){P===void 0&&(P=!0);var u=this.props.onStartScroll;this.started=!0,P&&document.body.classList.add("indiana-dragging"),u&&u({external:!this.internal}),this.forceUpdate()},v.prototype.processScroll=function(P){if(this.started){var u=this.props.onScroll;u&&u({external:!this.internal})}else this.processStart(!1)},v.prototype.processMove=function(P,u,M){var x=this.props,ie=x.horizontal,k=x.vertical,Se=x.activationDistance,Z=x.onScroll,pe=this.container.current;this.started?(ie&&(pe.scrollLeft-=u-this.clientX),k&&(pe.scrollTop-=M-this.clientY),Z&&Z({external:!this.internal}),this.clientX=u,this.clientY=M,this.scrollLeft=pe.scrollLeft,this.scrollTop=pe.scrollTop):(ie&&Math.abs(u-this.clientX)>Se||k&&Math.abs(M-this.clientY)>Se)&&(this.clientX=u,this.clientY=M,this.processStart())},v.prototype.processEnd=function(){var P=this.props.onEndScroll;this.container.current&&P&&P({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},v.prototype.getRef=function(P){[this.container,this.props.innerRef].forEach(function(u){u&&(typeof u=="function"?u(P):u.current=P)})},v.prototype.render=function(){var P=this.props,u=P.children,M=P.draggingClassName,x=P.className,ie=P.style,k=P.hideScrollbars,Se=P.component;return Qe.createElement(Se,{className:$e(x,this.pressed&&M,Ve({dragging:this.pressed,"hide-scrollbars":k,"native-scroll":this.isMobile})),style:ie,ref:this.getRef,onScroll:this.onScroll},u)},v.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},v}(Qe.PureComponent);at.Z=ze}}]);
