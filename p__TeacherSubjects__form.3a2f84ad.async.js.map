{"version":3,"sources":["webpack:///./src/components/CourseStatistics/ExportStatsButton.tsx","webpack:///./src/components/CourseStatistics/userProgress.tsx","webpack:///./src/services/escola-lms/exams.ts","webpack:///./src/pages/TeacherSubjects/components/ConvertGradesModal.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamForm.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamResults.tsx","webpack:///./src/pages/TeacherSubjects/components/Exams.tsx","webpack:///./src/services/escola-lms/chats.ts","webpack:///./src/pages/TeacherSubjects/components/CreateTeamsChatButton.tsx","webpack:///./src/pages/TeacherSubjects/components/Students.tsx","webpack:///./src/services/escola-lms/attendances.ts","webpack:///./src/components/AttendanceCheckbox/utils.ts","webpack:///./src/components/AttendanceCheckbox/index.tsx","webpack:///./src/pages/TeacherSubjects/components/Attendances.tsx","webpack:///./src/services/escola-lms/grades.ts","webpack:///./src/pages/TeacherSubjects/components/GradesScale.tsx","webpack:///./src/services/escola-lms/schedules.ts","webpack:///./src/pages/TeacherSubjects/components/Schedule.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/utils.ts","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/hooks.ts","webpack:///./src/pages/TeacherSubjects/components/FinalGradesDetails/index.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradesList.tsx","webpack:///./src/pages/TeacherSubjects/components/FileExportsHistory.tsx","webpack:///./src/pages/TeacherSubjects/components/FinalGradeSelect.tsx","webpack:///./src/pages/TeacherSubjects/components/ExamGradeInput.tsx","webpack:///./src/pages/TeacherSubjects/components/ClassRegister/utils.tsx","webpack:///./src/pages/TeacherSubjects/components/ClassRegister/index.tsx","webpack:///./src/pages/TeacherSubjects/form.tsx","webpack:///./src/components/ProgramForm/Context/index.tsx","webpack:///./src/services/escola-lms/reports.ts"],"names":["ExportStatsButton","course_id","stat","useState","loading","setLoading","onClickFactory","useCallback","courseId","exportStatForCourse","response","Blob","downloadLink","document","createElement","href","window","URL","createObjectURL","download","body","appendChild","click","removeChild","console","error","findH5PType","topic","topicable","content","contents","Object","values","library","UserProgress","topics","stats","showSeconds","setShowSeconds","columns","useMemo","title","dataIndex","render","id","map","type","topicable_type","split","pop","row","result","minutes","started_at","finished_at","seconds","toFixed","dataSource","userStat","reduce","acc","find","userStatTopic","Number","email","v","x","table","props","maxWidth","UserCourseFinish","attempts","text","format","Date","DATETIME_FORMAT","courseAttempts","attempt","attemptCount","Array","isArray","length","UserCourseAttempts","choosenUserEmail","setChoosenUserEmail","choosenAttempt","setChoosenAttempt","intl","useIntl","flatMap","userStats","dates","datesValue","date","seconds_total","config","xField","yField","seriesField","isStack","xAxis","label","autoHide","autoRotate","slider","start","end","position","layout","newValue","Set","filter","overflow","minHeight","width","formatMessage","formatter","datum","Math","floor","name","value","isInteger","params","options","request","method","useCache","headers","data","exam_id","user_id","FileExamGradeType","onDataConverted","groupSelectDisabled","useTeacherSubject","semester_subject_id","teacherSubjectData","selectedGroup","setSelectedGroup","groupOptions","groups","reqData","group_id","onUploadFile","success","exam_results","results","info","fileList","undefined","ManualExamGradeType","groupUsers","onSelectedGroupChange","currGroup","byId","users","first_name","last_name","academic_teacher_id","EXAM_GRADE_IMAGES","ExamGradeType","TestPortal","TeamsForms","TeamsLecture","Manual","ExampleImagesPreview","images","visible","setVisible","openImagePreview","onVisibleChange","src","display","ModalFooter","onOk","onCancel","okDisabled","currentImages","justifyContent","FILE_TYPES","ConvertGradesModal","open","closeModal","onSuccess","fetchGroupUsers","convertedData","setConvertedData","useEffect","forEach","includes","SelectTypeButtonsGroup","onSelect","staticColumns","editable","valueType","formItemProps","rules","required","message","min","max","ExamForm","ProForm","useForm","form","selectedType","setSelectedType","fetching","setFetching","getGroupById","editableKeys","numExamId","resetFields","isNaN","getExam","then","res","weight","passed_at","setFieldsValue","finally","resetState","Boolean","formData","areExamResultsValid","every","createExam","updateExam","history","push","onValuesChange","record","bodyStyle","paddingInline","defaultPageSize","TEACHER_SUBJECTS_PAGE_SIZE","hideInSearch","ExamResults","setTitle","total","sorter","_","DAY_FORMAT","created_at","semester","year","Exams","actionRef","useRef","location","useLocation","query","sort","current","pageSize","sortArr","entries","getExams","per_page","page","order_by","order","meta","deleteExam","reload","CreateTeamsChatButton","student_id","onClick","createTeamsChat","web_url","TableColumns","getGroupsOptions","subjectGroups","getTableData","studentUserGroups","curr","userTable","innerAcc","currentUser","group_name","Students","fetchAllStudentsAndGroups","parent_id","tableData","toLowerCase","hideInTable","filterMultiple","fieldProps","mode","_n","attendances","attendance","attendanceMapped","AttendanceValue","ABSENT","attendanceMap","PRESENT","ch1","ch2","PRESENT_NOT_EXERCISING","EXCUSED_ABSENCE","statusStr","statusMap","true_false","true_true","false_false","false_true","AttendanceCheckbox","groupAttendanceScheduleId","studentId","parseToStatus","status","setStatus","firstMount","handleChangeAttendance","changeStudentAttendance","parseToAttendanceValue","onCh1Change","e","target","checked","onCh2Change","prev","Attendances","dynamicCols","setDynamicCols","selectedGroupName","setSelectedGroupName","defaultValue","allowClear","fixed","defaultMessage","full_name","Promise","all","fetchStudentUserGroup","fetchGroupAttendanceSchedule","studentUserGroupRes","groupAttendanceScheduleRes","String","date_from","align","studentFullName","studentAttendances","groupAttendanceSchedule","studentAttendance","a","b","localeCompare","onChange","tutor_id","s_subject_scale_form_id","final_grade_id","GradeScaleTable","subjectTutorGradeScale","onFormSubmit","setEditableKeys","gradeScaleWithIds","scale","i","setFieldValue","_p","submit","padding","startEditable","saveText","actionRender","_r","_c","dom","save","GradesScale","useModel","initialState","tutors","subjectTutorGrades","setSubjectTutorGrades","selectedTutor","setSelectedTutor","tutorViewing","tutorsSelectOptions","refreshSubjectTutorGrades","getSubjectTutorGrades","onFormSubmitFactory","subjectTutorGradeScales","grade_scale","tutorGradeScale","grade","grade_value","createSubjectTutorGrades","textAlign","Schedule","selectedEvent","setSelectedEvent","eventData","setEventData","now","moment","events","event","group","term_status","toDate","date_to","tutor_name","tutor","tutor_email","subject","ms_teams_join_url","fetchEvents","fetchAllSchedules","date_form","handleEventClick","handleModalClose","checkDate","isSame","isAfter","dateCellRender","filteredEvents","handlePanelChange","startOf","subtract","endOf","add","initialStartDate","initialEndDate","DAYTIME_FORMAT","getStudentExamsFromExams","exams","exam","examResult","getProposedGrade","studentExams","tutorGradeScales","sum","weightsSum","weightedAverage","sortedGradeScales","isWeightedAverageGreater","at","firstFalseIndex","findIndex","getScalesBySubjectScaleFormId","tutorGrades","setter","promiseCb","finalGrades","setFinalGrades","setLoadingFactory","fetchFinalGrades","getUserFinalGrades","deleteFinalGrade","withLoading","removeFinalGrade","gradeTerms","setGradeTerms","getGradeTerms","subjectGradeScales","setSubjectGradeScales","getSubjectGradeScales","setTutorGradeScales","userAttendanceSchedules","setUserAttendanceSchedules","fetchUserAttendanceSchedules","filteredSchedules","rest","attendanceItem","setStudentExams","userCourses","setUserCourses","userCoursesStats","setUserCoursesStats","userCoursesTopics","setUserCoursesTopics","course","program","responses","getFlatTopics","lessons","getCourseStats","finishedTopics","attendanceList","tutorGradeScalesColumns","userAttendanceColumns","studentExamsColumns","staticFinalGradesColumns","grade_date","grade_name","TABLE_PAGE_SIZE","FinalGradesDetails","useStudentExams","useFinalGrades","useGradeTerms","useSubjectGradeScales","useTutorGradeScales","useUserAttendanceSchedules","useUserCoursesStats","gradeTermsSelectOptions","gradesSelectOptions","proposedGrade","onFinalGradeSubmit","grade_scale_id","grade_term_id","existingFinalGrade","grades","grade_term","updateFinalGrade","createFinalGrade","lesson_group_user_id","finalGradesColumns","finalGradesTableData","term","areStatisticsLoading","isStatisticDataPresent","fontSize","fontWeight","user","flexDirection","paddingTop","flex","gap","FinalGradesList","group_ids","allGroups","getGroupFinalGrades","DownloadButton","url","renderFormItem","item","defaultRender","stateType","getFieldValue","created_by","exported_at","exported_by","FileExportsHistory","getPCGExportsHistory","getGradeScaleId","gradeScales","FinalGradeSelect","defaultFinalGrade","createdGrade","setCreatedGrade","recentGrade","ExamGradeInput","debounce","createExamResult","getAttendanceCols","children","getStudentAttendances","groupAttendanceSchedules","getExamsCols","getStudentExamResults","getFinalGradesCols","final_grades","getStudentFinalGrades","finalGradeItem","getFinalGrades","studentFinalGrade","ClassRegister","fetchGroupFinalGrades","finalGradesRes","fetchExams","fetchSubjectTutorGrades","fetchGradeTerms","fetchSubjectGradeScales","examsRes","tutorGradesRes","gradeTermsRes","subjectGradeScalesRes","attendanceCols","examsCols","finalGradeCols","studentFinalGrades","tutorScales","proposed_grade","studentExamResults","groupName","TeacherSubjectsFormContent","tab","setInitialState","currentUserHasPermissions","isUserHavePermissions","showGradeScale","PERMISSIONS","TeacherListGradeScale","breadcrumb","routes","path","breadcrumbName","activeKey","key","useParams","subjectId","Context","React","createContext","getRandomId","round","random","getFlatLessons","recursiveAddTopicToLessons","lessonId","lesson","recursiveAddLessonToLessons","newLesson","recursiveEditLesson","updatedLesson","appendParentIdToLessons","lessonParentId","recursiveDeleteLesson","recursiveDeleteTopic","topicId","recursiveTopicUploaded","prevTopicId","lesson_id","file","AppContext","state","setState","flatTopics","flatLessons","h5ps","setH5ps","l","getLessons","getLessonIdByTopicId","topic_id","lesson_item","currentEditMode","t","addNewLesson","parentId","isNew","active","prevState","updateLesson","apiCreateLesson","apiUpdateLesson","deleteLesson","apiRemoveLesson","updateTopic","topic_item","apiCreateTopic","apiUpdateTopic","TopicType","Video","setTimeout","deleteTopic","apiRemoveTopic","addNewTopic","newTopic","onTopicUploaded","cloneTopic","apiCloneTopic","cloneLesson","apiCloneLesson","responseType","accept"],"mappings":"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","file":"p__TeacherSubjects__form.3a2f84ad.async.js","sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Button } from 'antd';\nimport { ExportOutlined } from '@ant-design/icons';\n\nimport { exportStatForCourse } from '@/services/escola-lms/reports';\n\ninterface Props {\n  course_id: number;\n  stat?: API.ExportStatForCourseStat;\n}\n\nexport const ExportStatsButton: React.FC<Props> = ({\n  course_id,\n  stat = 'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics',\n}) => {\n  const [loading, setLoading] = useState(false);\n\n  const onClickFactory = useCallback(\n    (courseId: number) => async () => {\n      setLoading(true);\n      try {\n        const response = await exportStatForCourse(courseId, {\n          stat,\n        });\n\n        if (response instanceof Blob) {\n          const downloadLink = document.createElement('a');\n          downloadLink.href = window.URL.createObjectURL(response);\n          downloadLink.download = `finished_topics_${course_id}.xlsx`;\n          document.body.appendChild(downloadLink);\n          downloadLink.click();\n          document.body.removeChild(downloadLink);\n        }\n      } catch (error) {\n        console.error(error);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [stat],\n  );\n\n  return (\n    <Button type=\"primary\" loading={loading} onClick={onClickFactory(course_id)}>\n      <ExportOutlined /> <FormattedMessage id=\"export\" />\n    </Button>\n  );\n};\n","import React, { useMemo, useState } from 'react';\nimport { Row, Select, Space, Switch, Table, Tag } from 'antd';\nimport type { ColumnsType } from 'antd/es/table';\nimport ProCard from '@ant-design/pro-card';\nimport { Column } from '@ant-design/plots';\nimport { FormattedMessage, useIntl } from 'umi';\nimport ScrollContainer from 'react-indiana-drag-scroll';\nimport { format } from 'date-fns';\nimport { DATETIME_FORMAT } from '@/consts/dates';\n\nimport TypeButtonDrawer from '../TypeButtonDrawer';\nimport { ExportStatsButton } from './ExportStatsButton';\n\ntype UserStatColumn = Record<string, number | string | API.FinishedTopicsUserStat> & {\n  email: string;\n  id: number;\n};\n\nconst findH5PType = (topic: API.TopicH5P) => {\n  if (topic.topicable.content.contents) {\n    return Object.values(topic.topicable.content.contents)[0].library;\n  }\n  return 'H5P';\n};\n\nexport const UserProgress: React.FC<{\n  course_id: number;\n  topics: API.Topic[];\n  stats: API.FinishedTopicsUserStats[];\n}> = ({ course_id, topics, stats }) => {\n  const [showSeconds, setShowSeconds] = useState(false);\n  const columns: ColumnsType<UserStatColumn> = useMemo(() => {\n    return [\n      {\n        title: <FormattedMessage id=\"user\" />,\n        dataIndex: 'id',\n        render: (id: number) => <TypeButtonDrawer type=\"App\\Models\\User\" type_id={id} />,\n      },\n      {\n        title: <FormattedMessage id=\"email\" />,\n        dataIndex: 'email',\n      },\n      ...topics.map((topic) => {\n        let type: string | undefined = topic.topicable_type?.split('\\\\').pop();\n\n        if (type === 'H5P') {\n          type = findH5PType(topic as API.TopicH5P);\n        }\n\n        return {\n          render: (row: API.FinishedTopicsUserStat | undefined) => {\n            let result = 0;\n            let minutes = 0;\n            if (row) {\n              if (row.started_at && row.finished_at) {\n                result = 1;\n              } else if (row.started_at) {\n                result = 2;\n              }\n              minutes = row.seconds / 60;\n            }\n\n            switch (result) {\n              case 1:\n                return (\n                  <Space>\n                    <Tag color=\"success\">F</Tag>\n                    {showSeconds && <small>{minutes.toFixed(2)}m</small>}\n                  </Space>\n                );\n              case 2:\n                return (\n                  <Space>\n                    <Tag color=\"blue\">S</Tag>\n                    {showSeconds && <small>{minutes.toFixed(2)}m</small>}\n                  </Space>\n                );\n              case 0:\n              default:\n                return (\n                  <React.Fragment>\n                    <Tag color=\"error\">N</Tag>\n                  </React.Fragment>\n                );\n            }\n          },\n\n          title: (\n            <small>\n              <Tag>{type}</Tag> {topic.title}\n            </small>\n          ),\n          dataIndex: topic.id,\n        };\n      }),\n    ];\n  }, [topics, showSeconds]);\n\n  const dataSource: UserStatColumn[] = useMemo(() => {\n    return stats.map((userStat) =>\n      topics.reduce(\n        (acc, topic) => {\n          const result = userStat.topics.find((userStatTopic) => userStatTopic.id === topic.id);\n          return { ...acc, [Number(topic.id)]: result ?? 0 };\n        },\n        { email: userStat.email, id: userStat.id } as UserStatColumn,\n      ),\n    );\n  }, [stats, topics]);\n\n  return (\n    <Table\n      title={() => (\n        <Row justify=\"space-between\" align=\"middle\">\n          <Space>\n            <FormattedMessage id=\"Finished\" defaultMessage=\"Finished:\" />{' '}\n            <Tag color=\"success\">F</Tag>\n            <FormattedMessage id=\"Started\" defaultMessage=\"Started:\" /> <Tag color=\"blue\">S</Tag>\n            <FormattedMessage id=\"NotStarted\" defaultMessage=\"Not Started:\" />{' '}\n            <Tag color=\"error\">N</Tag>\n            <FormattedMessage id=\"ShowMinutes\" defaultMessage=\"Show minutes spent on topic:\" />{' '}\n            <Switch checked={showSeconds} onChange={(v) => setShowSeconds(v)} />\n          </Space>\n          <ExportStatsButton course_id={course_id} />\n        </Row>\n      )}\n      columns={columns}\n      dataSource={dataSource}\n      size=\"small\"\n      scroll={{ x: 1500 }}\n      components={{\n        table: (props: React.HTMLAttributes<HTMLTableElement>) => (\n          <ScrollContainer horizontal={true} style={{ maxWidth: 'auto' }} hideScrollbars={false}>\n            <table {...props} />\n          </ScrollContainer>\n        ),\n      }}\n    />\n  );\n};\n\nexport const UserCourseFinish: React.FC<{\n  stats: API.FinishedCourseUserStats[];\n  attempts: API.CourseAttempts[];\n}> = ({ stats, attempts }) => {\n  const columns: ColumnsType<{ email: string; finished_at: Date | string }> = useMemo(() => {\n    return [\n      {\n        title: <FormattedMessage id=\"user\" />,\n        dataIndex: 'id',\n        render: (id: number) => <TypeButtonDrawer type=\"App\\Models\\User\" type_id={id} />,\n      },\n      {\n        title: <FormattedMessage id=\"email\" />,\n        dataIndex: 'email',\n      },\n      {\n        title: <FormattedMessage id=\"attempt\" defaultMessage=\"Attempt\" />,\n        dataIndex: 'attempt',\n      },\n      {\n        title: <FormattedMessage id=\"finished_at\" defaultMessage=\"Finished at\" />,\n        dataIndex: 'finished_at',\n        render: (text) => (text ? format(new Date(text), DATETIME_FORMAT) : ''),\n      },\n    ];\n  }, []);\n\n  const dataSource: { email: string; finished_at: Date | string }[] = useMemo(() => {\n    return stats.map(({ id, email, finished_at }) => {\n      const courseAttempts = attempts?.find((attempt) => attempt.id === id);\n      const attemptCount = Array.isArray(courseAttempts?.attempts)\n        ? courseAttempts?.attempts.length\n        : 0;\n\n      return {\n        id,\n        email,\n        finished_at,\n        attempt: attemptCount,\n      };\n    });\n  }, [stats]);\n\n  return (\n    <Table\n      title={() => (\n        <Space>\n          <FormattedMessage id=\"course.finished\" defaultMessage=\"Finished\" />\n        </Space>\n      )}\n      columns={columns}\n      dataSource={dataSource}\n      size=\"small\"\n      scroll={{ x: 500 }}\n    />\n  );\n};\n\nexport const UserCourseAttempts: React.FC<{ stats: API.CourseAttempts[] }> = ({ stats }) => {\n  const [choosenUserEmail, setChoosenUserEmail] = useState<string | null>(null);\n  const [choosenAttempt, setChoosenAttempt] = useState<number | null>(null);\n  const intl = useIntl();\n\n  const dataSource = useMemo(() => {\n    return stats.flatMap((userStats) =>\n      Object.values(userStats.attempts).flatMap(({ dates, attempt }) => {\n        const datesValue = Object.values(dates).flatMap(({ date, seconds_total }) => {\n          return {\n            date,\n            attempt,\n            seconds_total,\n            email: userStats.email,\n          };\n        });\n\n        return datesValue;\n      }),\n    );\n  }, [stats]);\n\n  const config: any = {\n    xField: 'date',\n    yField: 'seconds_total',\n    seriesField: 'attempt',\n    isStack: true,\n    xAxis: {\n      label: {\n        autoHide: true,\n        autoRotate: false,\n      },\n    },\n    slider: {\n      start: 0,\n      end: 1,\n    },\n    label: {\n      position: 'middle',\n      layout: [\n        {\n          type: 'interval-adjust-position',\n        },\n        {\n          type: 'interval-hide-overlap',\n        },\n        {\n          type: 'adjust-color',\n        },\n      ],\n    },\n  };\n\n  return (\n    <ProCard\n      title={\n        <Space>\n          <FormattedMessage id=\"course.interactions_time_in_days\" />\n          <Select\n            showSearch\n            value={choosenUserEmail}\n            onChange={(newValue) => {\n              setChoosenUserEmail(newValue);\n              setChoosenAttempt(null);\n            }}\n            placeholder={<FormattedMessage id=\"select_person\" defaultMessage=\"Select a person\" />}\n          >\n            {stats.map(({ id, email }) => (\n              <Select.Option key={id} value={email}>\n                {email}\n              </Select.Option>\n            ))}\n          </Select>\n          <Select\n            value={choosenAttempt}\n            onChange={(newValue) => setChoosenAttempt(newValue)}\n            disabled={choosenUserEmail === null}\n            placeholder={<FormattedMessage id=\"select_attempt\" defaultMessage=\"Select attempt\" />}\n          >\n            {[\n              ...new Set(\n                dataSource\n                  .filter(({ email }) => email === choosenUserEmail)\n                  .map(({ attempt }) => attempt),\n              ),\n            ].map((attempt) => (\n              <Select.Option value={attempt} key={attempt}>\n                <FormattedMessage id=\"attempt\" defaultMessage=\"Attempt\" /> {attempt}\n              </Select.Option>\n            ))}\n          </Select>\n        </Space>\n      }\n      colSpan={12}\n      layout=\"center\"\n    >\n      <div style={{ overflow: 'auto', minHeight: '400px', width: '100%' }}>\n        <Column\n          {...config}\n          tooltip={{\n            title: `${intl.formatMessage({ id: 'attempt' })}`,\n            formatter: (datum) => {\n              const minutes = Math.floor(+datum.seconds_total / 60);\n              const seconds = +datum.seconds_total > 60 ? +datum.seconds_total - minutes * 60 : 0;\n\n              return {\n                name: datum.attempt,\n                value: `${minutes}m ${seconds}s`,\n              };\n            },\n          }}\n          data={dataSource\n            .filter(({ email }) => email === choosenUserEmail)\n            .filter(({ attempt }) =>\n              Number.isInteger(choosenAttempt) ? attempt === choosenAttempt : true,\n            )}\n        />\n      </div>\n    </ProCard>\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/exams */\nexport async function getExams(params?: API.ExamsParams, options?: RequestOptionsInit) {\n  return request<API.DefaultMetaResponse<API.Exam>>(`/api/admin/exams`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    params,\n    ...(options || {}),\n  });\n}\n\n/**  POST /api/admin/exams */\nexport async function createExam(body?: API.CreateExamRequest, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/**  PUT /api/admin/exams/:id */\nexport async function updateExam(\n  id: number,\n  body: API.CreateExamRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${id}`, {\n    method: 'PUT',\n    data: body,\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  GET /api/admin/exams/:id */\nexport async function getExam(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${id}`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  DELETE /api/admin/exams/:id */\nexport async function deleteExam(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<undefined>>(`/api/admin/exams/${id}`, {\n    method: 'DELETE',\n    ...(options || {}),\n  });\n}\n\n/**  POST /api/admin/exams/:id/users/:user_id */\nexport async function createExamResult(\n  exam_id: number,\n  user_id: number,\n  body: API.CreateExamResultRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.Exam>>(`/api/admin/exams/${exam_id}/users/${user_id}`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/**  DELETE /api/admin/exams/:id/users/:user_id */\nexport async function deleteExamResult(\n  exam_id: number,\n  user_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<undefined>>(`/api/admin/exams/${exam_id}/users/${user_id}`, {\n    method: 'DELETE',\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Button, Image, Modal, Select, Space, Tooltip } from 'antd';\nimport type { DefaultOptionType } from 'antd/lib/select';\nimport ProForm from '@ant-design/pro-form';\nimport { InfoCircleOutlined } from '@ant-design/icons';\n\nimport SecureUpload from '@/components/SecureUpload';\nimport { ExamGradeType } from '@/services/escola-lms/enums';\nimport { useTeacherSubject } from '../context';\n\nconst FileExamGradeType: React.FC<{\n  type: ExamGradeType;\n  groupSelectDisabled: boolean;\n  onDataConverted: (data: ConvertedData | undefined) => void;\n}> = ({ type, onDataConverted, groupSelectDisabled }) => {\n  const { semester_subject_id, teacherSubjectData } = useTeacherSubject();\n  const [selectedGroup, setSelectedGroup] = useState<number | null>(null);\n\n  const groupOptions: DefaultOptionType[] = useMemo(\n    () =>\n      (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({\n        label: name,\n        value: id,\n      })),\n\n    [],\n  );\n  const reqData: API.ParseExamFileRequest = {\n    type,\n    group_id: selectedGroup!,\n    semester_subject_id: semester_subject_id!,\n  };\n\n  const onUploadFile = useCallback((response: API.DefaultResponse<API.Exam>) => {\n    if (response.success) {\n      // TODO error handling\n      // filter out users that are not in selected group\n      const exam_results = response.data.results.filter(({ user_id }) => user_id !== null);\n      if (!exam_results.length) return;\n\n      onDataConverted({ exam_results, group_id: response.data.group_id });\n    }\n  }, []);\n\n  return (\n    <>\n      <ProForm.Item label={<FormattedMessage id=\"group\" />}>\n        <Select\n          disabled={groupSelectDisabled}\n          value={selectedGroup}\n          onChange={(v) => setSelectedGroup(v)}\n          options={groupOptions}\n          placeholder={<FormattedMessage id=\"select_group\" />}\n          style={{ width: '100%' }}\n        />\n      </ProForm.Item>\n      <SecureUpload\n        name=\"file\"\n        url=\"/api/admin/exams/parse\"\n        onUpload={onUploadFile}\n        onChange={(info) => !info.fileList.length && onDataConverted(undefined)}\n        maxFiles={1}\n        data={reqData}\n        disabled={!selectedGroup}\n      />\n    </>\n  );\n};\n\nconst ManualExamGradeType: React.FC<{\n  onDataConverted: (convertedData: ConvertedData) => void;\n}> = ({ onDataConverted }) => {\n  const { teacherSubjectData, groupUsers } = useTeacherSubject();\n  const [selectedGroup, setSelectedGroup] = useState<number | null>(null);\n\n  const groupOptions: DefaultOptionType[] = useMemo(\n    () =>\n      (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({\n        label: name,\n        value: id,\n      })),\n\n    [],\n  );\n\n  const onSelectedGroupChange = useCallback(\n    (group_id: number) => {\n      setSelectedGroup(group_id);\n      const currGroup = groupUsers.byId?.[group_id];\n      if (!currGroup) return;\n\n      const exam_results = currGroup.users.reduce<API.ExamResult[]>(\n        (acc, { id, email, first_name, last_name, academic_teacher_id }) => {\n          // filter out tutors\n          if (academic_teacher_id !== null) return acc;\n\n          return [\n            ...acc,\n            {\n              email,\n              first_name,\n              last_name,\n              user_id: id,\n              result: 0,\n            },\n          ];\n        },\n        [],\n      );\n\n      onDataConverted({ group_id, exam_results });\n    },\n    [groupUsers.byId],\n  );\n\n  return (\n    <Select\n      value={selectedGroup}\n      onChange={onSelectedGroupChange}\n      options={groupOptions}\n      placeholder={<FormattedMessage id=\"select_group\" />}\n      style={{ width: '100%' }}\n    />\n  );\n};\n\nexport interface ConvertedData {\n  group_id: number;\n  exam_results: API.ExamResult[];\n}\n\ninterface Props {\n  open: boolean;\n  closeModal: () => void;\n  onSuccess: (convertedData: ConvertedData) => void;\n  type: ExamGradeType;\n}\n\nconst EXAM_GRADE_IMAGES: Record<ExamGradeType, string[]> = {\n  [ExamGradeType.TestPortal]: ['/teacher-examples/testPortal.png'],\n  [ExamGradeType.TeamsForms]: ['/teacher-examples/teamsForms.png'],\n  [ExamGradeType.TeamsLecture]: [\n    '/teacher-examples/teamsLecture.png',\n    '/teacher-examples/teamsLectureWithoutMail.png',\n  ],\n  [ExamGradeType.Manual]: [],\n};\n\nconst ExampleImagesPreview: React.FC<{ images: string[] }> = ({ images }) => {\n  const [visible, setVisible] = useState(false);\n\n  const openImagePreview = useCallback(() => setVisible(true), []);\n\n  return (\n    <>\n      <Tooltip title={<FormattedMessage id=\"see_file_example_image\" />}>\n        <Button onClick={openImagePreview} icon={<InfoCircleOutlined />} />\n      </Tooltip>\n      <Image.PreviewGroup preview={{ visible, onVisibleChange: setVisible }}>\n        {images.map((src) => (\n          <Image key={src} style={{ display: 'none' }} src={src} />\n        ))}\n      </Image.PreviewGroup>\n    </>\n  );\n};\n\nconst ModalFooter: React.FC<{\n  type: ExamGradeType;\n  onOk: () => void;\n  onCancel: () => void;\n  okDisabled: boolean;\n}> = ({ type, onOk, onCancel, okDisabled }) => {\n  const currentImages = EXAM_GRADE_IMAGES?.[type] ?? EXAM_GRADE_IMAGES[ExamGradeType.Manual];\n\n  return (\n    <Space\n      style={{ width: '100%', justifyContent: currentImages.length ? 'space-between' : 'flex-end' }}\n    >\n      {!!currentImages.length && <ExampleImagesPreview images={currentImages} />}\n      <Space>\n        <Button onClick={onCancel}>\n          <FormattedMessage id=\"cancel\" />\n        </Button>\n        <Button type=\"primary\" disabled={okDisabled} onClick={onOk}>\n          <FormattedMessage id=\"ok\" />\n        </Button>\n      </Space>\n    </Space>\n  );\n};\n\nconst FILE_TYPES = [ExamGradeType.TeamsLecture, ExamGradeType.TestPortal, ExamGradeType.TeamsForms];\n\nexport const ConvertGradesModal: React.FC<Props> = ({ open, closeModal, onSuccess, type }) => {\n  const { teacherSubjectData, fetchGroupUsers } = useTeacherSubject();\n  const [convertedData, setConvertedData] = useState<ConvertedData>();\n\n  useEffect(() => {\n    if (type === ExamGradeType.Manual && open) {\n      teacherSubjectData?.groups?.forEach(({ id }) => fetchGroupUsers(id));\n    }\n  }, [type, open]);\n\n  return (\n    <Modal\n      title={<FormattedMessage id={`TeacherSubjects.Exams.${type}Convert`} />}\n      width=\"40vw\"\n      open={open}\n      onCancel={closeModal}\n      footer={\n        <ModalFooter\n          type={type}\n          onOk={() => {\n            if (convertedData) {\n              onSuccess(convertedData);\n            }\n          }}\n          onCancel={closeModal}\n          okDisabled={!convertedData}\n        />\n      }\n    >\n      {FILE_TYPES.includes(type) && (\n        <FileExamGradeType\n          type={type}\n          onDataConverted={setConvertedData}\n          groupSelectDisabled={!!convertedData}\n        />\n      )}\n      {type === ExamGradeType.Manual && <ManualExamGradeType onDataConverted={setConvertedData} />}\n    </Modal>\n  );\n};\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { FormattedMessage, history } from 'umi';\nimport { Button, Col, InputNumber, Row, Spin } from 'antd';\nimport ProTable, { type ProColumns } from '@ant-design/pro-table';\nimport ProForm, { ProFormDatePicker, ProFormText } from '@ant-design/pro-form';\nimport { ExamGradeType } from '@/services/escola-lms/enums';\nimport { createExam, getExam, updateExam } from '@/services/escola-lms/exams';\n\nimport { useTeacherSubject } from '../context';\nimport { ConvertGradesModal, type ConvertedData } from './ConvertGradesModal';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\n\nconst SelectTypeButtonsGroup: React.FC<{ onSelect: (type: ExamGradeType) => void }> = ({\n  onSelect,\n}) => (\n  <Row gutter={[16, 16]}>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TeamsForms)}>\n        <FormattedMessage id=\"uploadFile.MsTeamsForms\" defaultMessage=\"uploadFile.MsTeamsForms\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TestPortal)}>\n        <FormattedMessage id=\"uploadFile.TestPortal\" defaultMessage=\"uploadFile.TestPortal\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.TeamsLecture)}>\n        <FormattedMessage id=\"uploadFile.MsTeams\" defaultMessage=\"uploadFile.MsTeams\" />\n      </Button>\n    </Col>\n    <Col span={12}>\n      <Button type=\"primary\" onClick={() => onSelect(ExamGradeType.Manual)}>\n        <FormattedMessage id=\"uploadGradesManually\" defaultMessage=\"uploadGradesManually\" />\n      </Button>\n    </Col>\n  </Row>\n);\n\nconst staticColumns: ProColumns<API.ExamResult>[] = [\n  { title: <FormattedMessage id=\"first_name\" />, dataIndex: 'first_name', editable: false },\n  { title: <FormattedMessage id=\"last_name\" />, dataIndex: 'last_name', editable: false },\n  {\n    title: <FormattedMessage id=\"examResult\" />,\n    dataIndex: 'result',\n    valueType: 'percent',\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n        {\n          type: 'number',\n          min: 0,\n          max: 100,\n          message: <FormattedMessage id=\"number_between\" values={{ min: 0, max: 100 }} />,\n        },\n      ],\n    },\n  },\n];\n\ninterface ExamFormValues {\n  title: string;\n  weight: number;\n  passed_at: Date | string;\n}\n\ninterface Props {\n  exam_id: string;\n}\nexport const ExamForm: React.FC<Props> = ({ exam_id }) => {\n  const [form] = ProForm.useForm<ExamFormValues>();\n  const [selectedType, setSelectedType] = useState<ExamGradeType>();\n  const [convertedData, setConvertedData] = useState<ConvertedData>();\n  const [fetching, setFetching] = useState(false);\n  const { semester_subject_id, getGroupById } = useTeacherSubject();\n\n  const editableKeys = useMemo(\n    () => (convertedData?.exam_results ?? []).map(({ user_id }) => user_id),\n    [convertedData?.exam_results],\n  );\n\n  useEffect(() => {\n    const numExamId = Number(exam_id);\n\n    if (exam_id === 'new') {\n      setSelectedType(undefined);\n      setConvertedData(undefined);\n      form.resetFields();\n    }\n\n    if (exam_id !== 'new' && !Number.isNaN(numExamId)) {\n      setFetching(true);\n      getExam(numExamId)\n        .then((res) => {\n          if (res.success) {\n            const { type, results, title, weight, passed_at, group_id } = res.data;\n            setSelectedType(type);\n            setConvertedData({ group_id, exam_results: results });\n            form.setFieldsValue({ title, weight, passed_at });\n          }\n        })\n        .finally(() => setFetching(false));\n    }\n  }, [exam_id]);\n\n  const resetState = useCallback(() => {\n    setSelectedType(undefined);\n    setConvertedData(undefined);\n  }, []);\n\n  if (fetching) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      {selectedType && (\n        <ConvertGradesModal\n          open={Boolean(selectedType && !convertedData)}\n          type={selectedType}\n          closeModal={resetState}\n          onSuccess={setConvertedData}\n        />\n      )}\n      <ProForm\n        form={form}\n        submitter={selectedType === undefined || !convertedData ? false : undefined}\n        onFinish={async (formData: ExamFormValues) => {\n          // Validation since table has other form instance\n          const areExamResultsValid = convertedData?.exam_results?.every(\n            ({ result }) => typeof result === 'number' && result >= 0 && result <= 100,\n          );\n\n          if (convertedData && areExamResultsValid && typeof semester_subject_id === 'number') {\n            const { title, passed_at, weight } = formData;\n            const numExamId = Number(exam_id);\n            const { exam_results, group_id } = convertedData;\n\n            const reqData: API.CreateExamRequest = {\n              type: selectedType!,\n              semester_subject_id,\n              title,\n              passed_at,\n              weight,\n              group_id,\n              results: exam_results,\n            };\n\n            const response = Number.isNaN(numExamId)\n              ? await createExam(reqData)\n              : await updateExam(numExamId, reqData);\n            if (response.success) {\n              history.push(`/teacher/subjects/${semester_subject_id}/exams`);\n            }\n          }\n          return true;\n        }}\n        onReset={resetState}\n      >\n        <ProForm.Group>\n          <ProFormText\n            label={<FormattedMessage id=\"examTitle\" defaultMessage=\"examTitle\" />}\n            rules={[\n              {\n                required: true,\n                message: <FormattedMessage id=\"field_required\" />,\n              },\n            ]}\n            width=\"lg\"\n            name=\"title\"\n          />\n          <ProFormDatePicker\n            label={<FormattedMessage id=\"datePassingExam\" defaultMessage=\"datePassingExam\" />}\n            rules={[\n              {\n                required: true,\n                message: <FormattedMessage id=\"field_required\" />,\n              },\n            ]}\n            width=\"lg\"\n            name=\"passed_at\"\n          />\n          <ProForm.Item\n            name=\"weight\"\n            label={<FormattedMessage id=\"examImportance\" defaultMessage=\"examImportance\" />}\n            rules={[\n              { required: true, message: <FormattedMessage id=\"field_required\" /> },\n              {\n                type: 'number',\n                min: 1,\n                max: 100,\n                message: <FormattedMessage id=\"number_between\" values={{ min: 1, max: 100 }} />,\n              },\n            ]}\n          >\n            <InputNumber />\n          </ProForm.Item>\n        </ProForm.Group>\n        {selectedType && convertedData && (\n          <ProTable\n            rowKey=\"user_id\"\n            headerTitle={getGroupById(convertedData.group_id)?.name}\n            editable={{\n              type: 'single',\n              editableKeys,\n              onValuesChange: (record, dataSource) =>\n                setConvertedData({ group_id: convertedData.group_id, exam_results: dataSource }),\n            }}\n            cardProps={{ bodyStyle: { paddingInline: 0 } }}\n            search={false}\n            dataSource={convertedData.exam_results}\n            pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n            columns={staticColumns}\n          />\n        )}\n        {!convertedData && <SelectTypeButtonsGroup onSelect={setSelectedType} />}\n      </ProForm>\n    </>\n  );\n};\n","import React, { useState } from 'react';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { FormattedMessage } from 'umi';\n\nimport { getExam } from '@/services/escola-lms/exams';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\n\ninterface Props {\n  exam_id: number;\n}\n\nconst columns: ProColumns<API.ExamResult>[] = [\n  { title: <FormattedMessage id=\"first_name\" />, dataIndex: 'first_name' },\n  { title: <FormattedMessage id=\"last_name\" />, dataIndex: 'last_name' },\n  { title: <FormattedMessage id=\"examResult\" />, dataIndex: 'result', hideInSearch: true },\n];\n\nexport const ExamResults: React.FC<Props> = ({ exam_id }) => {\n  const [title, setTitle] = useState('');\n\n  return (\n    <ProTable<API.ExamResult>\n      className=\"table-standalone\"\n      rowKey=\"user_id\"\n      search={false}\n      headerTitle={title}\n      pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n      request={async () => {\n        const response = await getExam(exam_id);\n\n        if (response.success) {\n          setTitle(response.data.title);\n\n          return {\n            total: response.data.results.length,\n            success: true,\n            data: response.data.results,\n          };\n        }\n\n        return [];\n      }}\n      columns={columns}\n    />\n  );\n};\n","import React, { useMemo, useRef } from 'react';\nimport { format } from 'date-fns';\nimport type { Location } from 'history';\nimport { FormattedMessage, Link, useLocation } from 'umi';\nimport { Button, Popconfirm, Tooltip } from 'antd';\nimport { DeleteOutlined, EditOutlined, LineChartOutlined } from '@ant-design/icons';\nimport ProTable from '@ant-design/pro-table';\nimport type { ActionType, ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { getExams, deleteExam } from '@/services/escola-lms/exams';\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\nimport { ExamForm } from './ExamForm';\nimport { ExamResults } from './ExamResults';\nimport { useTeacherSubject } from '../context';\n\nconst staticColumns: ProColumns<API.Exam>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'id',\n    sorter: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"title\" defaultMessage=\"title\" />,\n    dataIndex: 'title',\n    hideInSearch: true,\n    sorter: true,\n  },\n  {\n    title: <FormattedMessage id=\"type\" defaultMessage=\"type\" />,\n    dataIndex: 'type',\n    sorter: true,\n    render: (_, record) => <FormattedMessage id={`ExamGradeType.${record.type}`} />,\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.exam_date\" defaultMessage=\"Exam date\" />,\n    dataIndex: 'passed_at',\n    sorter: true,\n    render: (_, record) => record.passed_at && format(new Date(record.passed_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.grade_weight\" defaultMessage=\"Weight\" />,\n    dataIndex: 'weight',\n    sorter: true,\n    render: (_, record) => record.weight + '%',\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" defaultMessage=\"Created at\" />,\n    dataIndex: 'created_at',\n    sorter: true,\n    render: (_, record) => record.created_at && format(new Date(record.created_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"semester\" defaultMessage=\"Semester\" />,\n    dataIndex: 'semester',\n    sorter: true,\n    render: (_, record) => (\n      <FormattedMessage\n        id={`SemesterType.${record.semester.type}`}\n        values={{ year: record.semester.year }}\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"group\" defaultMessage=\"Group\" />,\n    dataIndex: 'group_id',\n    sorter: true,\n    render: (_, record) => (\n      <TypeButtonDrawer key={record.group_id} type=\"Students\" type_id={record.group_id} />\n    ),\n  },\n];\n\nexport const Exams: React.FC = () => {\n  const actionRef = useRef<ActionType>();\n  const { semester_subject_id } = useTeacherSubject();\n  const location = useLocation() as Location & { query: { exam_id?: string; results?: string } };\n\n  const { exam_id, results } = useMemo(\n    () => ({ exam_id: location.query?.exam_id ?? null, results: location.query?.results }),\n    [location.query?.exam_id, location.query?.results],\n  );\n\n  if (results !== null && !Number.isNaN(Number(results))) {\n    return <ExamResults exam_id={Number(results)} />;\n  }\n\n  if (exam_id !== null) {\n    return <ExamForm exam_id={exam_id} />;\n  }\n\n  return (\n    <ProTable<API.Exam, API.ExamsParams>\n      className=\"table-standalone\"\n      headerTitle={<FormattedMessage id=\"exams\" />}\n      actionRef={actionRef}\n      search={false}\n      rowKey=\"id\"\n      pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n      request={async ({ current, pageSize }, sort) => {\n        if (semester_subject_id === null)\n          return {\n            data: [],\n            total: 0,\n            success: false,\n          };\n        const sortArr = sort && Object.entries(sort)[0];\n\n        const response = await getExams({\n          per_page: pageSize,\n          page: current,\n          semester_subject_id: !Number.isNaN(semester_subject_id) ? semester_subject_id : undefined,\n          order_by: sortArr && sortArr[0],\n          order: sortArr && (sortArr[1] === 'ascend' ? 'ASC' : 'DESC'),\n        });\n\n        if (response.success) {\n          return {\n            data: response.data,\n            total: response.meta.total,\n            success: true,\n          };\n        }\n\n        return {\n          data: [],\n          total: 0,\n          success: false,\n        };\n      }}\n      columns={[\n        ...staticColumns,\n        {\n          title: <FormattedMessage id=\"pages.searchTable.titleOption\" />,\n          dataIndex: 'option',\n          valueType: 'option',\n          render: (_, record) => [\n            <Link\n              to={`/teacher/subjects/${record.semester_subject_id}/exams?exam_id=${record.id}`}\n              key=\"edit\"\n            >\n              <Tooltip title={<FormattedMessage id=\"edit\" defaultMessage=\"edit\" />}>\n                <Button type=\"primary\" icon={<EditOutlined />} />\n              </Tooltip>\n            </Link>,\n            <Link\n              to={`/teacher/subjects/${record.semester_subject_id}/exams?results=${record.id}`}\n              key=\"results\"\n            >\n              <Tooltip\n                title={\n                  <FormattedMessage id=\"TeacherSubjects.Exams.results\" defaultMessage=\"results\" />\n                }\n              >\n                <Button icon={<LineChartOutlined />} />\n              </Tooltip>\n            </Link>,\n            <Popconfirm\n              key=\"delete\"\n              title={\n                <FormattedMessage\n                  id=\"deleteQuestion\"\n                  defaultMessage=\"Are you sure to delete this record?\"\n                />\n              }\n              onConfirm={async () => {\n                const response = await deleteExam(record.id);\n\n                if (response.success && actionRef.current) {\n                  actionRef.current.reload();\n                }\n              }}\n              okText={<FormattedMessage id=\"yes\" />}\n              cancelText={<FormattedMessage id=\"no\" />}\n            >\n              <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n                <Button type=\"primary\" icon={<DeleteOutlined />} danger />\n              </Tooltip>\n            </Popconfirm>,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  POST /api/admin/chats/ms-teams */\nexport async function createTeamsChat(\n  body: API.CreateTeamsChatRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.TeamsChat>>(`/api/admin/chats/ms-teams`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    data: body,\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Button, message, Tooltip } from 'antd';\nimport { ExportOutlined } from '@ant-design/icons';\n\nimport { createTeamsChat } from '@/services/escola-lms/chats';\n\ninterface Props {\n  student_id: number;\n}\n\nexport const CreateTeamsChatButton: React.FC<Props> = ({ student_id }) => {\n  const [loading, setLoading] = useState(false);\n\n  const onClick = useCallback(async () => {\n    setLoading(true);\n    const response = await createTeamsChat({ user_id: student_id });\n    if (!response.success) {\n      message.error(response.message);\n      setLoading(false);\n      return;\n    }\n\n    window.open(response.data.web_url, '_blank', 'noopener noreferrer');\n    setLoading(false);\n  }, []);\n\n  return (\n    <Tooltip title={<FormattedMessage id=\"msTeams\" defaultMessage=\"teams\" />}>\n      <Button loading={loading} type=\"primary\" icon={<ExportOutlined />} onClick={onClick} />\n    </Tooltip>\n  );\n};\n","import React, { useMemo } from 'react';\nimport { FormattedMessage } from 'umi';\nimport type { DefaultOptionType } from 'antd/lib/select';\nimport ProTable, { type ProColumns } from '@ant-design/pro-table';\n\nimport { allStudentsAndGroups as fetchAllStudentsAndGroups } from '@/services/escola-lms/student_user_groups';\nimport { useTeacherSubject } from '../context';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\nimport { CreateTeamsChatButton } from './CreateTeamsChatButton';\n\ninterface TableDataProps {\n  group_id: number;\n  group_name: string;\n  user_id: number;\n  first_name: string;\n  last_name: string;\n  email: string;\n}\n\ninterface TableParams {\n  groups: number[];\n  first_name: string;\n  last_name: string;\n  email: string;\n}\n\nexport const TableColumns: ProColumns<TableDataProps>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n    dataIndex: 'user_id',\n    hideInSearch: true,\n    width: '80px',\n  },\n  {\n    title: <FormattedMessage id=\"first_name\" defaultMessage=\"First name\" />,\n    dataIndex: 'first_name',\n  },\n  {\n    title: <FormattedMessage id=\"last_name\" defaultMessage=\"Last name\" />,\n    dataIndex: 'last_name',\n  },\n  {\n    title: <FormattedMessage id=\"email\" defaultMessage=\"email\" />,\n    dataIndex: 'email',\n  },\n  {\n    title: <FormattedMessage id=\"groupName\" defaultMessage=\"Group name\" />,\n    dataIndex: 'group_name',\n    hideInSearch: true,\n  },\n];\n\nconst getGroupsOptions = (subjectGroups: API.SubjectGroups[]): DefaultOptionType[] =>\n  subjectGroups.map(({ id, name }) => ({\n    label: name,\n    value: id,\n  }));\n\nconst getTableData = (studentUserGroups: API.StudentUserGroup[]): TableDataProps[] =>\n  studentUserGroups.reduce<TableDataProps[]>((acc, curr) => {\n    const userTable = curr?.users?.reduce<TableDataProps[]>(\n      (innerAcc, currentUser) =>\n        currentUser.academic_teacher_id !== null\n          ? innerAcc\n          : [\n              ...innerAcc,\n              {\n                group_id: curr.id,\n                group_name: curr.name,\n                user_id: currentUser.id,\n                first_name: currentUser.first_name,\n                last_name: currentUser.last_name,\n                email: currentUser.email,\n              },\n            ],\n      [],\n    );\n\n    return [...acc, ...userTable];\n  }, []);\n\nexport const Students: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => getGroupsOptions(teacherSubjectData?.groups ?? []),\n    [teacherSubjectData?.groups],\n  );\n\n  return (\n    <ProTable<TableDataProps, TableParams>\n      className=\"table-standalone\"\n      rowKey={(record) => `${record.group_id}-${record.user_id}`}\n      search={{ layout: 'vertical' }}\n      pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n      request={async ({ groups, first_name = '', last_name = '', email = '' }) => {\n        const response = await fetchAllStudentsAndGroups({\n          parent_id: teacherSubjectData?.group_id,\n          'id[]': groups,\n        });\n\n        if (!response.success) {\n          return { data: [], total: 0, success: false };\n        }\n\n        const tableData = getTableData(response.data).filter(\n          (record) =>\n            record.first_name.toLowerCase().includes(first_name.toLowerCase()) &&\n            record.last_name.toLowerCase().includes(last_name.toLowerCase()) &&\n            record.email.toLowerCase().includes(email.toLowerCase()),\n        );\n\n        return { data: tableData, total: tableData.length, success: true };\n      }}\n      columns={[\n        {\n          title: <FormattedMessage id=\"groups\" defaultMessage=\"Groups\" />,\n          dataIndex: 'groups',\n          hideInTable: true,\n          filterMultiple: true,\n          valueType: 'select',\n          fieldProps: {\n            options: groupOptions,\n            mode: 'multiple',\n          },\n        },\n        ...TableColumns,\n        {\n          hideInSearch: true,\n          title: <FormattedMessage id=\"msTeams\" />,\n          dataIndex: 'teamsLink',\n          valueType: 'option',\n          render: (_n, record) => [\n            <CreateTeamsChatButton key=\"teamsChat\" student_id={record.user_id} />,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import type { RequestOptionsInit } from 'umi-request';\nimport type { AttendanceValue } from './enums';\nimport { request } from 'umi';\n\nexport async function groupAttendanceSchedule(group_id: number, options?: RequestOptionsInit) {\n  return request<API.AttendanceScheduleList>(`/api/admin/schedules/groups/${group_id}`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\nexport async function changeStudentAttendance(\n  id: number,\n  user_id: number,\n  value: AttendanceValue,\n  options?: RequestOptionsInit,\n) {\n  return request<API.ChangeStudentAttendance>(`/api/admin/schedules/${id}/attendances`, {\n    data: {\n      attendances: [\n        {\n          user_id,\n          value,\n        },\n      ],\n    },\n    method: 'POST',\n    ...(options || {}),\n  });\n}\n","import { AttendanceValue } from '@/services/escola-lms/enums';\nimport type { AttendanceMap, Status } from './types';\n\nexport function parseToStatus(attendance: AttendanceValue | null): Status {\n  const attendanceMapped = attendance === null ? AttendanceValue.ABSENT : attendance;\n\n  const attendanceMap: AttendanceMap = {\n    [AttendanceValue.PRESENT]: { ch1: true, ch2: false },\n    [AttendanceValue.PRESENT_NOT_EXERCISING]: { ch1: true, ch2: true },\n    [AttendanceValue.ABSENT]: { ch1: false, ch2: false },\n    [AttendanceValue.EXCUSED_ABSENCE]: { ch1: false, ch2: true },\n  };\n\n  return attendanceMap[attendanceMapped] ?? { ch1: false, ch2: false };\n}\n\nexport function parseToAttendanceValue({ ch1, ch2 }: Status): AttendanceValue {\n  const statusStr = `${ch1}_${ch2}`;\n\n  const statusMap = {\n    true_false: AttendanceValue.PRESENT,\n    true_true: AttendanceValue.PRESENT_NOT_EXERCISING,\n    false_false: AttendanceValue.ABSENT,\n    false_true: AttendanceValue.EXCUSED_ABSENCE,\n  };\n\n  return statusMap[statusStr] ?? AttendanceValue.ABSENT;\n}\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Checkbox, Space, Tooltip } from 'antd';\nimport type { CheckboxChangeEvent } from 'antd/es/checkbox';\nimport { changeStudentAttendance } from '@/services/escola-lms/attendances';\n\nimport type { Status } from './types';\nimport { parseToAttendanceValue, parseToStatus } from './utils';\n\ninterface AttendanceCheckboxProps {\n  groupAttendanceScheduleId: number;\n  studentId: number;\n  attendance: API.AttendanceValue | null;\n  onSuccess?: () => void;\n}\n\nconst AttendanceCheckbox: React.FC<AttendanceCheckboxProps> = ({\n  groupAttendanceScheduleId,\n  studentId,\n  attendance,\n  onSuccess,\n}) => {\n  const [status, setStatus] = useState<Status>(parseToStatus(attendance));\n\n  const [loading, setLoading] = useState(false);\n  const firstMount = useRef(true);\n\n  const handleChangeAttendance = useCallback((stat: Status) => {\n    setLoading(true);\n    changeStudentAttendance(groupAttendanceScheduleId, studentId, parseToAttendanceValue(stat))\n      .then((res) => {\n        if (res.success) {\n          onSuccess?.();\n        }\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  const onCh1Change = useCallback(\n    (e: CheckboxChangeEvent) =>\n      setStatus(e.target.checked ? { ch1: true, ch2: false } : { ch1: false, ch2: false }),\n    [],\n  );\n\n  const onCh2Change = useCallback(\n    (e: CheckboxChangeEvent) => setStatus((prev) => ({ ...prev, ch2: e.target.checked })),\n    [],\n  );\n\n  useEffect(() => {\n    if (firstMount.current) {\n      firstMount.current = false;\n      return;\n    }\n\n    handleChangeAttendance(status);\n  }, [status, handleChangeAttendance]);\n\n  return (\n    <Space>\n      <Tooltip title={<FormattedMessage id=\"present\" />}>\n        <Checkbox disabled={loading} checked={status.ch1} onChange={onCh1Change} />\n      </Tooltip>\n      <Tooltip title={<FormattedMessage id={status.ch1 ? 'not_exercising' : 'excused_absence'} />}>\n        <Checkbox disabled={loading} checked={status.ch2} onChange={onCh2Change} />\n      </Tooltip>\n    </Space>\n  );\n};\n\nexport default AttendanceCheckbox;\n","import React, { useMemo, useRef, useState } from 'react';\nimport { format } from 'date-fns';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { message } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { groupAttendanceSchedule as fetchGroupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport { studentUserGroup as fetchStudentUserGroup } from '@/services/escola-lms/student_user_groups';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\nimport { useTeacherSubject } from '../context';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\n\ntype AttendanceTableItem = { id: number; full_name: string } & Record<string, API.AttendanceValue>;\n\ninterface AttendanceTableFilters {\n  full_name?: string;\n  group_id?: number;\n}\n\nexport const Attendances: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n  const [dynamicCols, setDynamicCols] = useState<ProColumns<AttendanceTableItem>[]>([]);\n  const [selectedGroupName, setSelectedGroupName] = useState('');\n  const intl = useIntl();\n\n  const actionRef = useRef<ActionType>();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const columns: ProColumns<AttendanceTableItem>[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: groupOptions?.[0]?.value,\n          allowClear: false,\n        },\n      },\n      {\n        title: <FormattedMessage id=\"nameAndSurname\" defaultMessage=\"Name and surname\" />,\n        dataIndex: 'full_name',\n        fixed: 'left',\n      },\n      ...dynamicCols,\n    ],\n    [groupOptions, dynamicCols],\n  );\n\n  return (\n    <ProTable<AttendanceTableItem, AttendanceTableFilters>\n      className=\"table-standalone\"\n      headerTitle={`${intl.formatMessage({\n        id: 'attendances',\n        defaultMessage: 'Attendances',\n      })} (${selectedGroupName})`}\n      request={async ({ group_id = groupOptions?.[0]?.value, full_name = '' }) => {\n        const [studentUserGroupRes, groupAttendanceScheduleRes] = await Promise.all([\n          fetchStudentUserGroup(group_id),\n          fetchGroupAttendanceSchedule(group_id),\n        ]);\n        const selectedGroup = groupOptions.find(({ value }) => value === group_id);\n\n        if (!studentUserGroupRes.success || !groupAttendanceScheduleRes.success || !selectedGroup)\n          return { data: [], total: 0, success: false };\n\n        if (!groupAttendanceScheduleRes.data.length) {\n          message.error(\n            intl.formatMessage({\n              id: 'noAttendanceSchedule',\n              defaultMessage: 'No attendance schedule for this group...',\n            }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n\n        setSelectedGroupName(selectedGroup.label);\n        setDynamicCols(\n          groupAttendanceScheduleRes.data.reduce<ProColumns<AttendanceTableItem>[]>(\n            (acc, curr) => [\n              ...acc,\n              {\n                title: String(format(new Date(curr.date_from), DAY_FORMAT)),\n                dataIndex: String(curr.date_from),\n                hideInSearch: true,\n                width: 100,\n                align: 'center',\n                render: (_, record) => (\n                  <AttendanceCheckbox\n                    groupAttendanceScheduleId={curr.id}\n                    attendance={record[`${curr?.date_from}`]}\n                    studentId={record.id}\n                  />\n                ),\n              },\n            ],\n            [],\n          ),\n        );\n\n        const data = studentUserGroupRes.data.users\n          .reduce<AttendanceTableItem[]>(\n            (acc, { id, academic_teacher_id, first_name, last_name }) => {\n              const studentFullName = `${last_name} ${first_name}`;\n              // filter out tutor & first name and second name filter\n              if (\n                academic_teacher_id !== null ||\n                !studentFullName.toLowerCase().includes(full_name.toLowerCase())\n              )\n                return acc;\n\n              const studentAttendances = groupAttendanceScheduleRes.data.reduce<\n                Record<string, API.AttendanceValue>\n              >((innerAcc, groupAttendanceSchedule) => {\n                const studentAttendance = groupAttendanceSchedule.attendances.find(\n                  (attendance) => attendance.user_id === id,\n                );\n                if (!studentAttendance) return innerAcc;\n\n                return {\n                  ...innerAcc,\n                  [`${groupAttendanceSchedule.date_from}`]: studentAttendance.value,\n                };\n              }, {});\n\n              return [...acc, { id, full_name: studentFullName, ...studentAttendances }];\n            },\n            [],\n          )\n          .sort((a, b) => a.full_name.localeCompare(b.full_name));\n\n        return { data, total: data.length, success: true };\n      }}\n      columns={columns}\n      search={{ layout: 'vertical' }}\n      pagination={{\n        defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE,\n        onChange: () => actionRef.current?.reload(),\n      }}\n      scroll={{ x: 1500 }}\n      actionRef={actionRef}\n      rowKey=\"id\"\n    />\n  );\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\n/**  GET /api/admin/semester-subjects/:semester_subject_id/tutors/:tutor_id/grades */\nexport async function getSubjectTutorGrades(\n  semester_subject_id: number,\n  tutor_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.SubjectTutorGrades>>(\n    `/api/admin/semester-subjects/${semester_subject_id}/tutors/${tutor_id}/grades`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  POST /api/admin/semester-subjects/:semester_subject_id/tutors/:tutor_id/grades */\nexport async function createSubjectTutorGrades(\n  semester_subject_id: number,\n  tutor_id: number,\n  body: API.CreateSubjectTutorGradesRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.GradeScale[]>>(\n    `/api/admin/semester-subjects/${semester_subject_id}/tutors/${tutor_id}/grades`,\n    {\n      method: 'POST',\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/**  GET /api/admin/lesson-group-users */\nexport async function getGroupFinalGrades(\n  group_id: number | number[],\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem[]>>(`/api/admin/lesson-group-users`, {\n    method: 'GET',\n    params: { 'groups[]': group_id },\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/**  GET /api/admin/lesson-group-users/groups/:group_id/users/:user_id */\nexport async function getUserFinalGrades(\n  group_id: number,\n  user_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(\n    `/api/admin/lesson-group-users/groups/${group_id}/users/${user_id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/** GET /api/admin/grade-terms */\nexport async function getGradeTerms(options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.GradeTerm[]>>(`/api/admin/grade-terms`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/** GET /api/admin/grade-scales/:s_subject_scale_form_id */\nexport async function getSubjectGradeScales(\n  s_subject_scale_form_id: number,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.SubjectGradeScale[]>>(\n    `/api/admin/grade-scales/${s_subject_scale_form_id}`,\n    {\n      method: 'GET',\n      /* useCache: true */ useCache: false,\n      ...(options || {}),\n    },\n  );\n}\n\n/** POST /api/admin/final-grades */\nexport async function createFinalGrade(\n  body: API.CreateFinalGradeRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(`/api/admin/final-grades`, {\n    method: 'POST',\n    data: body,\n    ...(options || {}),\n  });\n}\n\n/** PATCH /api/admin/final-grades/:id */\nexport async function updateFinalGrade(\n  final_grade_id: number,\n  body: API.UpdateFinalGradeRequest,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<API.FinalGradeItem>>(\n    `/api/admin/final-grades/${final_grade_id}`,\n    {\n      method: 'PATCH',\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\n/** DELETE /api/admin/final-grades/:id */\nexport async function removeFinalGrade(final_grade_id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<undefined>>(`/api/admin/final-grades/${final_grade_id}`, {\n    method: 'DELETE',\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useModel } from 'umi';\nimport { Button, Divider, Select, Spin, Typography } from 'antd';\nimport ProForm from '@ant-design/pro-form';\nimport { EditableProTable } from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\nimport { CheckOutlined, EditOutlined } from '@ant-design/icons';\n\nimport { createSubjectTutorGrades, getSubjectTutorGrades } from '@/services/escola-lms/grades';\nimport { useTeacherSubject } from '../context';\n\ntype TableGradeScale = API.GradeScale & { id: string };\n\ninterface FormData {\n  table: TableGradeScale[];\n}\n\nconst staticColumns: ProColumns<TableGradeScale>[] = [\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n    editable: false,\n  },\n  {\n    title: <FormattedMessage id=\"degree\" />,\n    dataIndex: 'name',\n    editable: false,\n  },\n  {\n    title: <FormattedMessage id=\"min_percent\" />,\n    dataIndex: 'grade_value',\n    valueType: 'percent',\n    formItemProps: {\n      rules: [\n        {\n          required: true,\n          message: <FormattedMessage id=\"field_required\" />,\n        },\n        {\n          type: 'number',\n          min: 0,\n          max: 100,\n          message: <FormattedMessage id=\"number_between\" values={{ min: 0, max: 100 }} />,\n        },\n      ],\n    },\n  },\n];\n\ninterface GradeScaleTableProps {\n  subjectTutorGradeScale: API.SubjectTutorGradeScale;\n  onFormSubmit: (formData: FormData) => Promise<void>;\n}\n\nconst GradeScaleTable: React.FC<GradeScaleTableProps> = ({\n  subjectTutorGradeScale,\n  onFormSubmit,\n}) => {\n  const [editableKeys, setEditableKeys] = useState<React.Key[]>([]);\n  const actionRef = useRef<ActionType>();\n\n  const [form] = ProForm.useForm<FormData>();\n\n  useEffect(() => {\n    const gradeScaleWithIds = (subjectTutorGradeScale.scale ?? []).map((values, i) => ({\n      ...values,\n      id: String((i + 1) * 100),\n    }));\n\n    form.setFieldValue('table', gradeScaleWithIds);\n  }, []);\n\n  return (\n    <ProForm<FormData>\n      form={form}\n      onFinish={onFormSubmit}\n      submitter={{ render: (_p, [, submit]) => [submit] }}\n    >\n      <EditableProTable<TableGradeScale>\n        name=\"table\"\n        rowKey=\"id\"\n        actionRef={actionRef}\n        formItemProps={{ label: <FormattedMessage id=\"grades-scale\" /> }}\n        cardProps={{ bodyStyle: { padding: 0 } }}\n        recordCreatorProps={false}\n        columns={[\n          ...staticColumns,\n          {\n            title: <FormattedMessage id=\"options\" />,\n            valueType: 'option',\n            render: (_n, row) => (\n              <Button\n                type=\"primary\"\n                onClick={() => actionRef.current?.startEditable(row.id)}\n                icon={<EditOutlined />}\n              />\n            ),\n          },\n        ]}\n        editable={{\n          form,\n          type: 'multiple',\n          editableKeys,\n          saveText: <Button type=\"primary\" icon={<CheckOutlined />} />,\n          onChange: setEditableKeys,\n          actionRender: (_r, _c, dom) => [dom.save],\n        }}\n      />\n    </ProForm>\n  );\n};\n\nexport const GradesScale: React.FC = () => {\n  const { initialState } = useModel('@@initialState');\n  const { semester_subject_id, tutors } = useTeacherSubject();\n\n  const [subjectTutorGrades, setSubjectTutorGrades] = useState<API.SubjectTutorGrades>();\n  const [loading, setLoading] = useState(false);\n  const [selectedTutor, setSelectedTutor] = useState<number | null>(null);\n\n  const tutorViewing = useMemo(\n    () => !!tutors.data.find(({ id }) => id === initialState?.currentUser?.id),\n    [tutors.data, initialState?.currentUser?.id],\n  );\n  const tutorsSelectOptions = useMemo(\n    () =>\n      tutors.data.map(({ id, first_name, last_name }) => ({\n        label: `${first_name} ${last_name}`,\n        value: id,\n      })),\n    [tutors.data],\n  );\n\n  const refreshSubjectTutorGrades = useCallback(() => {\n    if (semester_subject_id === null || selectedTutor === null) return;\n\n    setLoading(true);\n    setSubjectTutorGrades(undefined);\n    getSubjectTutorGrades(semester_subject_id, selectedTutor)\n      .then((response) => {\n        if (response.success) {\n          setSubjectTutorGrades(response.data);\n        }\n      })\n      .finally(() => {\n        setLoading(false);\n      });\n  }, [semester_subject_id, selectedTutor]);\n\n  const onFormSubmitFactory = useCallback(\n    (subjectTutorGradeScales: API.SubjectTutorGradeScale[], s_subject_scale_form_id: number) =>\n      async (formData: FormData) => {\n        if (semester_subject_id === null || selectedTutor === null) return;\n\n        const grade_scale = subjectTutorGradeScales.reduce<API.SubjectTutorGradeScale[]>(\n          (acc, tutorGradeScale) =>\n            tutorGradeScale.s_subject_scale_form_id === s_subject_scale_form_id\n              ? [\n                  ...acc,\n                  {\n                    s_subject_scale_form_id,\n                    scale: formData.table.map(({ name, grade, grade_value }) => ({\n                      name,\n                      grade,\n                      grade_value,\n                    })),\n                  },\n                ]\n              : [...acc, tutorGradeScale],\n          [],\n        );\n\n        const res = await createSubjectTutorGrades(semester_subject_id, selectedTutor, {\n          grade_scale,\n        });\n\n        if (res.success) {\n          refreshSubjectTutorGrades();\n        }\n      },\n    [selectedTutor, semester_subject_id],\n  );\n\n  useEffect(() => {\n    if (!tutorViewing || !initialState?.currentUser?.id) {\n      if (tutors.data?.[0]) {\n        setSelectedTutor(tutors.data?.[0].id);\n      }\n      return;\n    }\n\n    setSelectedTutor(initialState?.currentUser?.id);\n  }, [initialState?.currentUser?.id, tutorViewing]);\n\n  useEffect(() => {\n    refreshSubjectTutorGrades();\n  }, [refreshSubjectTutorGrades]);\n\n  if (tutors.loading) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      <ProForm.Item label={<FormattedMessage id=\"menu.Teacher\" />}>\n        <Select\n          disabled={tutorViewing}\n          placeholder={<FormattedMessage id=\"select\" />}\n          options={tutorsSelectOptions}\n          value={selectedTutor}\n          onChange={(v) => setSelectedTutor(v)}\n        />\n      </ProForm.Item>\n      <Divider />\n      {loading && !subjectTutorGrades && <Spin />}\n      {subjectTutorGrades?.grade_scale ? (\n        subjectTutorGrades.grade_scale.map((subjectTutorGradeScale, i) => (\n          <React.Fragment key={subjectTutorGradeScale.s_subject_scale_form_id}>\n            {i > 0 && <Divider />}\n            <GradeScaleTable\n              subjectTutorGradeScale={subjectTutorGradeScale}\n              onFormSubmit={onFormSubmitFactory(\n                subjectTutorGrades.grade_scale ?? [],\n                subjectTutorGradeScale.s_subject_scale_form_id,\n              )}\n            />\n          </React.Fragment>\n        ))\n      ) : (\n        <Typography.Paragraph style={{ textAlign: 'center' }}>\n          <FormattedMessage id=\"gradesScalesMissing\" />\n        </Typography.Paragraph>\n      )}\n    </>\n  );\n};\n","import type { RequestOptionsInit } from 'umi-request';\nimport { request } from 'umi';\n\nexport async function allSchedules(\n  params: API.PageParams &\n    API.PaginationParams & {\n      // query\n      semester_subject_id?: number | null;\n      date_form?: Date;\n      date_to?: Date;\n      group_id?: number;\n      term_status_id?: number;\n    },\n  options?: RequestOptionsInit,\n) {\n  return request<API.ScheduleList>(`/api/admin/schedules`, {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n","import React, { useCallback, useEffect, useState, useMemo } from 'react';\nimport moment from 'moment';\nimport { FormattedMessage } from 'umi';\nimport { Badge, Button, Modal, Typography, Calendar } from 'antd';\nimport type { CalendarMode } from 'antd/lib/calendar/generateCalendar';\n\nimport { DAYTIME_FORMAT } from '@/consts/dates';\nimport { allSchedules as fetchAllSchedules } from '@/services/escola-lms/schedules';\nimport { useTeacherSubject } from '../context';\nimport './index.css';\n\ninterface EventCalendarProps {\n  id: number;\n  title: string;\n  start: Date | string;\n  end: Date | string;\n  tutor_name: string;\n  tutor_email: string;\n  group: string;\n  semester: string;\n  subject: string;\n  ms_teams_join_url: string | null;\n}\n\nexport const Schedule: React.FC = () => {\n  const [selectedEvent, setSelectedEvent] = useState<EventCalendarProps | null>(null);\n  const [eventData, setEventData] = useState<API.ScheduleData[]>([]);\n  const { semester_subject_id } = useTeacherSubject();\n  const now = moment();\n\n  const events: EventCalendarProps[] = useMemo(\n    () =>\n      eventData.map((event) => ({\n        id: event.id,\n        title: `${event.group.name} (${event.term_status.name})`,\n        start: moment(event.date_from).toDate(),\n        end: moment(event.date_to).toDate(),\n        tutor_name: `${event.tutor.first_name} ${event.tutor.last_name}`,\n        tutor_email: event.tutor.email,\n        semester: event.semester.name,\n        group: event.group.name,\n        subject: event.subject.name,\n        ms_teams_join_url: event.ms_teams_join_url,\n      })),\n    [eventData],\n  );\n\n  const fetchEvents = useCallback(\n    (start: moment.Moment, end: moment.Moment) => {\n      fetchAllSchedules({\n        semester_subject_id: semester_subject_id,\n        date_form: start.toDate(),\n        date_to: end.toDate(),\n      }).then((response) => {\n        if (response.success) {\n          setEventData(response.data);\n        }\n      });\n    },\n    [semester_subject_id],\n  );\n\n  const handleEventClick = useCallback((event: EventCalendarProps) => {\n    setSelectedEvent(event);\n  }, []);\n\n  const handleModalClose = useCallback(() => {\n    setSelectedEvent(null);\n  }, []);\n\n  const checkDate = useCallback((date: moment.Moment) => {\n    if (date.isSame(now, 'day')) {\n      return 'warning';\n    }\n    return date.isAfter(now, 'day') ? 'success' : 'error';\n  }, []);\n\n  const dateCellRender = useCallback(\n    (date: moment.Moment) => {\n      const filteredEvents = events.filter((event) => moment(event.start).isSame(date, 'day'));\n\n      return (\n        <ul className=\"events\">\n          {filteredEvents.map((event) => (\n            <li key={event.id} onClick={() => handleEventClick(event)}>\n              <Badge status={checkDate(moment(event.start))} text={event.title} />\n            </li>\n          ))}\n        </ul>\n      );\n    },\n    [eventData],\n  );\n\n  const handlePanelChange = useCallback((date: moment.Moment, mode: CalendarMode) => {\n    const start = moment(date).startOf(mode).subtract(1, 'month');\n    const end = moment(date).endOf(mode).add(1, 'month');\n    fetchEvents(start, end);\n  }, []);\n\n  useEffect(() => {\n    const initialStartDate = moment().startOf('month');\n    const initialEndDate = moment().endOf('month');\n    fetchEvents(initialStartDate, initialEndDate);\n  }, []);\n  return (\n    <>\n      <Typography.Title level={4}>\n        <FormattedMessage id=\"schedule\" defaultMessage=\"Schedule\" />\n      </Typography.Title>\n\n      <Calendar dateCellRender={dateCellRender} onPanelChange={handlePanelChange} />\n\n      <Modal\n        open={selectedEvent !== null}\n        title={`${selectedEvent?.subject}: ${selectedEvent?.title}`}\n        onCancel={handleModalClose}\n        footer={null}\n      >\n        <Typography.Paragraph>\n          <FormattedMessage id=\"tutorName\" defaultMessage=\"Tutor\" />: {selectedEvent?.tutor_name}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"email\" defaultMessage=\"Email\" />: {selectedEvent?.tutor_email}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"group\" defaultMessage=\"Group\" />: {selectedEvent?.group}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"semester\" defaultMessage=\"Semester\" />: {selectedEvent?.semester}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"started_at\" defaultMessage=\"Start date\" />:\n          {selectedEvent && moment(selectedEvent.start).format(DAYTIME_FORMAT)}\n        </Typography.Paragraph>\n        <Typography.Paragraph>\n          <FormattedMessage id=\"end_at\" defaultMessage=\"End date\" />:\n          {selectedEvent && moment(selectedEvent.end).format(DAYTIME_FORMAT)}\n        </Typography.Paragraph>\n        {selectedEvent?.ms_teams_join_url && (\n          <Typography.Paragraph>\n            <a\n              href={selectedEvent.ms_teams_join_url}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n              key=\"teamsLink\"\n            >\n              <Button type=\"primary\">\n                <FormattedMessage id=\"msTeams\" />\n              </Button>\n            </a>\n          </Typography.Paragraph>\n        )}\n      </Modal>\n    </>\n  );\n};\n","import type { StudentExam } from './types';\n\nexport const getStudentExamsFromExams = (exams: API.Exam[], student_id: number): StudentExam[] =>\n  exams.reduce<StudentExam[]>((acc, { results, ...exam }) => {\n    const result = results.find((examResult) => examResult.user_id === student_id);\n    if (!result) return acc;\n\n    return [...acc, { ...exam, result }];\n  }, []);\n\nexport const getProposedGrade = (\n  studentExams: StudentExam[],\n  tutorGradeScales: API.GradeScale[],\n): string => {\n  const [sum, weightsSum] = studentExams.reduce<[number, number]>(\n    (acc, { result, weight }) => [acc[0] + result.result * weight, acc[1] + weight],\n    [0, 0],\n  );\n  const weightedAverage = Number.isNaN(sum / weightsSum) ? 0 : sum / weightsSum;\n\n  const sortedGradeScales = tutorGradeScales\n    .sort((a, b) => a.grade_value - b.grade_value)\n    .reduce<(API.GradeScale & { isWeightedAverageGreater: boolean })[]>(\n      (acc, curr) => [\n        ...acc,\n        {\n          ...curr,\n          isWeightedAverageGreater: weightedAverage >= curr.grade_value,\n        },\n      ],\n      [],\n    );\n\n  if (sortedGradeScales.every(({ isWeightedAverageGreater }) => isWeightedAverageGreater)) {\n    return sortedGradeScales.at(-1)?.name ?? '';\n  }\n\n  const firstFalseIndex = sortedGradeScales.findIndex(\n    ({ isWeightedAverageGreater }) => !isWeightedAverageGreater,\n  );\n  if (firstFalseIndex < 0) return '';\n\n  return sortedGradeScales[firstFalseIndex - 1]?.name;\n};\n\nexport const getScalesBySubjectScaleFormId = (\n  s_subject_scale_form_id: number,\n  tutorGrades: API.SubjectTutorGradeScale[],\n): API.GradeScale[] | undefined =>\n  tutorGrades.find(\n    (subjectTutorGradeScale) =>\n      subjectTutorGradeScale.s_subject_scale_form_id === s_subject_scale_form_id,\n  )?.scale;\n","import type React from 'react';\nimport { useCallback, useEffect, useState } from 'react';\nimport { groupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport {\n  getGradeTerms,\n  getUserFinalGrades,\n  getSubjectGradeScales,\n  getSubjectTutorGrades,\n  removeFinalGrade,\n} from '@/services/escola-lms/grades';\nimport { getExams } from '@/services/escola-lms/exams';\nimport { course, getCourseStats, program } from '@/services/escola-lms/course';\nimport { getFlatTopics } from '@/components/ProgramForm/Context';\nimport { getScalesBySubjectScaleFormId, getStudentExamsFromExams } from './utils';\nimport type { FetchedData, StudentExam } from './types';\n\ntype SetLoading = (loading: boolean) => void;\n\nfunction setLoadingFactory<T>(\n  setter: React.Dispatch<React.SetStateAction<FetchedData<T>>>,\n): SetLoading {\n  return function setLoading(loading) {\n    setter((prev) => ({ ...prev, loading }));\n  };\n}\n\nasync function withLoading<T>(setLoading: SetLoading, promiseCb: () => Promise<T>) {\n  setLoading(true);\n  try {\n    return promiseCb();\n  } finally {\n    setLoading(false);\n  }\n}\n\nexport function useFinalGrades(group_id: number, user_id: number) {\n  const [finalGrades, setFinalGrades] = useState<FetchedData<API.FinalGradeItem>>({\n    loading: false,\n  });\n\n  const setLoading = useCallback(setLoadingFactory(setFinalGrades), []);\n\n  const fetchFinalGrades = useCallback(async () => {\n    const res = await getUserFinalGrades(group_id, user_id);\n    if (!res.success) return res;\n\n    setFinalGrades((prev) => ({ ...prev, data: res.data }));\n    return res;\n  }, [user_id, group_id]);\n\n  const deleteFinalGrade = useCallback(\n    (final_grade_id: number) =>\n      withLoading(setLoading, () => removeFinalGrade(final_grade_id).then(fetchFinalGrades)),\n    [fetchFinalGrades],\n  );\n\n  useEffect(() => {\n    withLoading(setLoading, fetchFinalGrades);\n  }, [fetchFinalGrades]);\n\n  return { finalGrades, deleteFinalGrade };\n}\n\nexport function useGradeTerms() {\n  const [gradeTerms, setGradeTerms] = useState<FetchedData<API.GradeTerm[]>>({ loading: false });\n\n  useEffect(() => {\n    setGradeTerms((prev) => ({ ...prev, loading: true }));\n    getGradeTerms()\n      .then((response) => {\n        if (response.success) {\n          setGradeTerms((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setGradeTerms((prev) => ({ ...prev, loading: false }));\n      });\n  }, []);\n\n  return { gradeTerms };\n}\n\nexport function useSubjectGradeScales(s_subject_scale_form_id: number | undefined) {\n  const [subjectGradeScales, setSubjectGradeScales] = useState<\n    FetchedData<API.SubjectGradeScale[]>\n  >({\n    loading: false,\n  });\n\n  useEffect(() => {\n    if (s_subject_scale_form_id === undefined) return;\n\n    setSubjectGradeScales((prev) => ({ ...prev, loading: true }));\n    getSubjectGradeScales(s_subject_scale_form_id)\n      .then((response) => {\n        if (response.success) {\n          setSubjectGradeScales((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setSubjectGradeScales((prev) => ({ ...prev, loading: false }));\n      });\n  }, [s_subject_scale_form_id]);\n\n  return { subjectGradeScales };\n}\n\nexport function useTutorGradeScales(\n  semester_subject_id: number | undefined | null,\n  tutor_id: number | undefined | null,\n  s_subject_scale_form_id: number | undefined | null,\n) {\n  const [tutorGradeScales, setTutorGradeScales] = useState<FetchedData<API.GradeScale[]>>({\n    loading: false,\n  });\n\n  useEffect(() => {\n    if (\n      typeof semester_subject_id !== 'number' ||\n      typeof tutor_id !== 'number' ||\n      typeof s_subject_scale_form_id !== 'number'\n    )\n      return;\n\n    setTutorGradeScales((prev) => ({ ...prev, loading: true }));\n    getSubjectTutorGrades(semester_subject_id, tutor_id)\n      .then((response) => {\n        if (response.success) {\n          setTutorGradeScales((prev) => ({\n            ...prev,\n            data: getScalesBySubjectScaleFormId(\n              s_subject_scale_form_id,\n              response.data.grade_scale ?? [],\n            )?.map((v, i) => ({ ...v, id: i })),\n          }));\n        }\n      })\n      .finally(() => {\n        setTutorGradeScales((prev) => ({ ...prev, loading: false }));\n      });\n  }, [semester_subject_id, tutor_id]);\n\n  return { tutorGradeScales };\n}\n\nexport function useUserAttendanceSchedules(group_id: number, user_id: number) {\n  const [userAttendanceSchedules, setUserAttendanceSchedules] = useState<\n    FetchedData<API.UserAttendanceSchedule[]>\n  >({ loading: false });\n\n  const fetchUserAttendanceSchedules = useCallback(() => {\n    setUserAttendanceSchedules((prev) => ({ ...prev, loading: true }));\n    groupAttendanceSchedule(group_id)\n      .then((response) => {\n        if (response.success) {\n          const filteredSchedules = response.data.reduce<API.UserAttendanceSchedule[]>(\n            (acc, { attendances, ...rest }) => {\n              const attendance = attendances.find(\n                (attendanceItem) => attendanceItem.user_id === user_id,\n              );\n\n              if (!attendance) return acc;\n\n              return [...acc, { ...rest, attendance }];\n            },\n            [],\n          );\n\n          setUserAttendanceSchedules((prev) => ({ ...prev, data: filteredSchedules }));\n        }\n      })\n      .finally(() => {\n        setUserAttendanceSchedules((prev) => ({ ...prev, loading: false }));\n      });\n  }, [group_id, user_id]);\n\n  useEffect(() => {\n    fetchUserAttendanceSchedules();\n  }, [fetchUserAttendanceSchedules]);\n\n  return { userAttendanceSchedules, fetchUserAttendanceSchedules };\n}\n\nexport function useStudentExams(student_id: number, semester_subject_id: number | null) {\n  const [studentExams, setStudentExams] = useState<FetchedData<StudentExam[]>>({ loading: false });\n\n  useEffect(() => {\n    if (!semester_subject_id) return;\n    setStudentExams((prev) => ({ ...prev, loading: true }));\n    getExams({ student_id, semester_subject_id })\n      .then((response) => {\n        if (response.success) {\n          const data = getStudentExamsFromExams(response.data, student_id);\n\n          setStudentExams((prev) => ({ ...prev, data }));\n        }\n      })\n      .finally(() => {\n        setStudentExams((prev) => ({ ...prev, loading: false }));\n      });\n  }, [student_id, semester_subject_id]);\n\n  return { studentExams };\n}\n\nexport function useUserCoursesStats(group_id: number, user_id: number) {\n  const [userCourses, setUserCourses] = useState<FetchedData<API.Course[]>>({\n    loading: false,\n  });\n  const [userCoursesStats, setUserCoursesStats] = useState<\n    FetchedData<\n      Record<\n        string,\n        { finishedTopics: API.FinishedTopicsUserStats[]; attendanceList: API.CourseAttempts[] }\n      >\n    >\n  >({ loading: false });\n  const [userCoursesTopics, setUserCoursesTopics] = useState<\n    FetchedData<Record<string, API.Topic[]>>\n  >({ loading: false });\n\n  useEffect(() => {\n    setUserCourses((prev) => ({ ...prev, loading: true }));\n    course({ group_id })\n      .then((response) => {\n        if (response.success) {\n          setUserCourses((prev) => ({ ...prev, data: response.data }));\n        }\n      })\n      .finally(() => {\n        setUserCourses((prev) => ({ ...prev, loading: false }));\n      });\n  }, [group_id]);\n\n  useEffect(() => {\n    if (!userCourses.data) return;\n\n    setUserCoursesTopics((prev) => ({ ...prev, loading: true }));\n    Promise.all(userCourses.data.map(({ id }) => program(Number(id))))\n      .then((responses) => {\n        responses.forEach((response) => {\n          if (response.success) {\n            setUserCoursesTopics((prev) => ({\n              ...prev,\n              data: {\n                ...prev.data,\n                [Number(response.data.id)]: getFlatTopics(response.data.lessons),\n              },\n            }));\n          }\n        });\n      })\n      .finally(() => {\n        setUserCoursesTopics((prev) => ({ ...prev, loading: false }));\n      });\n\n    setUserCoursesStats((prev) => ({ ...prev, loading: true }));\n    Promise.all(\n      userCourses.data.map(({ id }) =>\n        getCourseStats(Number(id), [\n          'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics',\n          'EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\AttendanceList',\n        ]).then((response) => {\n          if (response.success) {\n            const finishedTopics = (\n              response.data['EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\FinishedTopics'] ?? []\n            ).filter((userStat) => userStat.id === user_id);\n\n            const attendanceList =\n              response.data['EscolaLms\\\\Reports\\\\Stats\\\\Course\\\\AttendanceList'] ?? [];\n\n            setUserCoursesStats((prev) => ({\n              ...prev,\n              data: {\n                ...prev.data,\n                [Number(id)]: { finishedTopics, attendanceList },\n              },\n            }));\n          }\n        }),\n      ),\n    ).finally(() => setUserCoursesStats((prev) => ({ ...prev, loading: false })));\n  }, [userCourses.data, user_id]);\n\n  return { userCourses, userCoursesStats, userCoursesTopics };\n}\n","import React, { useCallback, useMemo } from 'react';\nimport { FormattedMessage, history } from 'umi';\nimport { format } from 'date-fns';\nimport { Button, Col, Divider, message, Popconfirm, Row, Spin, Tooltip, Typography } from 'antd';\nimport { DeleteOutlined } from '@ant-design/icons';\nimport ProForm, { ProFormSelect } from '@ant-design/pro-form';\nimport ProTable, { type ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport { createFinalGrade, updateFinalGrade } from '@/services/escola-lms/grades';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\nimport { UserCourseAttempts, UserProgress } from '@/components/CourseStatistics/userProgress';\nimport { useTeacherSubject } from '../../context';\nimport {\n  useFinalGrades,\n  useSubjectGradeScales,\n  useGradeTerms,\n  useUserAttendanceSchedules,\n  useStudentExams,\n  useTutorGradeScales,\n  useUserCoursesStats,\n} from './hooks';\nimport type { StudentExam } from './types';\nimport { getProposedGrade } from './utils';\n\ninterface Props {\n  user_id: number;\n  group_id: number;\n}\n\ninterface FormData {\n  grade_term_id: number;\n  grade_scale_id: number;\n}\n\ntype FinalGradeTableItem = API.GradeTerm & { grade?: API.FinalGradeItemGrade };\n\nconst tutorGradeScalesColumns: ProColumns<API.GradeScale>[] = [\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n  },\n  {\n    title: <FormattedMessage id=\"degree\" />,\n    dataIndex: 'name',\n  },\n  {\n    title: <FormattedMessage id=\"min_percent\" />,\n    dataIndex: 'grade_value',\n    valueType: 'percent',\n  },\n];\n\nconst userAttendanceColumns: ProColumns<API.UserAttendanceSchedule>[] = [\n  {\n    title: <FormattedMessage id=\"date\" />,\n    dataIndex: 'date_from',\n    render: (_n, row) => format(new Date(row.date_from), DAY_FORMAT),\n  },\n];\n\nconst studentExamsColumns: ProColumns<StudentExam>[] = [\n  {\n    title: <FormattedMessage id=\"name\" />,\n    dataIndex: 'title',\n  },\n  {\n    title: <FormattedMessage id=\"TeacherSubjects.Exams.grade_weight\" defaultMessage=\"Weight\" />,\n    dataIndex: 'weight',\n    valueType: 'percent',\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" defaultMessage=\"Created at\" />,\n    dataIndex: 'created_at',\n    render: (_n, row) => format(new Date(row.created_at), DAY_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'result',\n    render: (_n, row) => `${row.result.result}%`,\n  },\n];\n\nconst staticFinalGradesColumns: ProColumns<FinalGradeTableItem>[] = [\n  {\n    title: <FormattedMessage id=\"name\" />,\n    dataIndex: 'name',\n  },\n  {\n    title: <FormattedMessage id=\"issued_at\" />,\n    dataIndex: 'grade',\n    render: (_n, row) =>\n      row.grade?.grade_date ? format(new Date(row.grade?.grade_date), DAY_FORMAT) : '-',\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    dataIndex: 'grade',\n    render: (_n, row) => row.grade?.grade_name ?? '-',\n  },\n];\n\nconst TABLE_PAGE_SIZE = 6;\n\nexport const FinalGradesDetails: React.FC<Props> = ({ user_id, group_id }) => {\n  const { semester_subject_id } = useTeacherSubject();\n  const { studentExams } = useStudentExams(user_id, semester_subject_id);\n  const { finalGrades, deleteFinalGrade } = useFinalGrades(group_id, user_id);\n  const { gradeTerms } = useGradeTerms();\n  const { subjectGradeScales } = useSubjectGradeScales(finalGrades.data?.s_subject_scale_form_id);\n  const { tutorGradeScales } = useTutorGradeScales(\n    semester_subject_id,\n    finalGrades.data?.tutor_id,\n    finalGrades.data?.s_subject_scale_form_id,\n  );\n  const { userAttendanceSchedules, fetchUserAttendanceSchedules } = useUserAttendanceSchedules(\n    group_id,\n    user_id,\n  );\n  const { userCourses, userCoursesStats, userCoursesTopics } = useUserCoursesStats(\n    group_id,\n    user_id,\n  );\n\n  const [form] = ProForm.useForm<FormData>();\n\n  const gradeTermsSelectOptions = useMemo(\n    () => (gradeTerms.data ?? []).map(({ id, name }) => ({ label: name, value: id })),\n    [gradeTerms.data],\n  );\n\n  const gradesSelectOptions = useMemo(\n    () =>\n      (subjectGradeScales.data ?? []).map(({ name, id }) => ({\n        label: name,\n        value: id,\n      })),\n    [subjectGradeScales.data],\n  );\n\n  const proposedGrade = useMemo(\n    () => getProposedGrade(studentExams.data ?? [], tutorGradeScales.data ?? []),\n    [studentExams.data, tutorGradeScales.data],\n  );\n\n  const onFinalGradeSubmit = useCallback(\n    async ({ grade_scale_id, grade_term_id }: FormData) => {\n      if (finalGrades.data?.id === undefined) return;\n\n      const existingFinalGrade = finalGrades.data?.grades.find(\n        ({ grade_term }) => grade_term.id === grade_term_id,\n      );\n\n      if (existingFinalGrade) {\n        const response = await updateFinalGrade(existingFinalGrade.id, { grade_scale_id });\n\n        message[response.success ? 'success' : 'error'](response.message);\n        if (response.success) {\n          history.push(`/teacher/subjects/${semester_subject_id}/final-grades`);\n        }\n        return;\n      }\n\n      const response = await createFinalGrade({\n        grade_scale_id,\n        grade_term_id,\n        lesson_group_user_id: finalGrades.data.id,\n      });\n\n      message[response.success ? 'success' : 'error'](response.message);\n\n      if (response.success) {\n        history.push(`/teacher/subjects/${semester_subject_id}/final-grades`);\n      }\n    },\n    [finalGrades.data, semester_subject_id],\n  );\n\n  const finalGradesColumns: ProColumns<FinalGradeTableItem>[] = useMemo(\n    () => [\n      ...staticFinalGradesColumns,\n      {\n        title: <FormattedMessage id=\"options\" defaultMessage=\"options\" />,\n        dataIndex: 'option',\n        valueType: 'option',\n        render: (_n, record) =>\n          typeof record?.grade?.id === 'number'\n            ? [\n                <Popconfirm\n                  key=\"delete\"\n                  title={\n                    <FormattedMessage\n                      id=\"deleteQuestion\"\n                      defaultMessage=\"Are you sure to delete this record?\"\n                    />\n                  }\n                  onConfirm={() => deleteFinalGrade(record.grade!.id)}\n                  okText={<FormattedMessage id=\"yes\" defaultMessage=\"Yes\" />}\n                  cancelText={<FormattedMessage id=\"no\" defaultMessage=\"No\" />}\n                >\n                  <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n                    <Button type=\"primary\" icon={<DeleteOutlined />} danger />\n                  </Tooltip>\n                </Popconfirm>,\n              ]\n            : [],\n      },\n    ],\n    [],\n  );\n\n  const finalGradesTableData: FinalGradeTableItem[] = useMemo(\n    () =>\n      (gradeTerms.data ?? []).map((term) => ({\n        ...term,\n        grade: finalGrades.data?.grades.find(({ grade_term }) => grade_term.id === term.id),\n      })),\n    [finalGrades.data, gradeTerms.data],\n  );\n\n  const areStatisticsLoading =\n    (userCourses.loading && !userCourses.data) ||\n    (userCoursesStats.loading && !userCoursesStats.data) ||\n    (userCoursesTopics.loading && !userCoursesTopics.data);\n\n  const isStatisticDataPresent = Boolean(\n    userCourses.data && userCoursesStats.data && userCoursesTopics.data,\n  );\n\n  if (finalGrades.loading) {\n    return <Spin />;\n  }\n\n  return (\n    <>\n      {finalGrades.data && (\n        <>\n          <Typography.Text style={{ fontSize: '16px', fontWeight: 500 }}>\n            <FormattedMessage\n              id=\"TeacherSubjects.FinalGrades.Student\"\n              values={finalGrades.data.user}\n            />\n          </Typography.Text>\n          <Divider />\n        </>\n      )}\n      <Row gutter={[48, 48]} justify=\"space-between\">\n        <Col span={12}>\n          <ProTable\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.StudentPartialGrades\" />}\n            search={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            dataSource={studentExams.data}\n            loading={studentExams.loading}\n            columns={studentExamsColumns}\n            options={false}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.FinalGrades\" />}\n            search={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            dataSource={finalGradesTableData}\n            loading={finalGrades.loading || gradeTerms.loading}\n            columns={finalGradesColumns}\n            options={false}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable<API.UserAttendanceSchedule>\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.Attendances\" />}\n            search={false}\n            options={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n            dataSource={userAttendanceSchedules.data}\n            loading={userAttendanceSchedules.loading}\n            columns={[\n              ...userAttendanceColumns,\n              {\n                title: <FormattedMessage id=\"TeacherSubjects.FinalGrades.Attendance\" />,\n                dataIndex: 'attendance',\n                render: (_n, row) => (\n                  <AttendanceCheckbox\n                    groupAttendanceScheduleId={row.id}\n                    studentId={user_id}\n                    attendance={row.attendance.value}\n                    onSuccess={fetchUserAttendanceSchedules}\n                  />\n                ),\n              },\n            ]}\n          />\n        </Col>\n        <Col span={12}>\n          <ProTable<API.GradeScale>\n            rowKey=\"id\"\n            headerTitle={<FormattedMessage id=\"TeacherSubjects.FinalGrades.GradesScale\" />}\n            search={false}\n            options={false}\n            pagination={{ pageSize: TABLE_PAGE_SIZE }}\n            cardProps={{ bodyStyle: { padding: 0 } }}\n            dataSource={tutorGradeScales.data}\n            loading={tutorGradeScales.loading}\n            columns={tutorGradeScalesColumns}\n          />\n        </Col>\n        {areStatisticsLoading && <Spin />}\n        {isStatisticDataPresent &&\n          userCourses.data?.map(({ id, title }) => (\n            <Col key={id} span={24}>\n              <Typography.Text style={{ fontSize: '16px', fontWeight: 500 }}>\n                {title}\n              </Typography.Text>\n              <UserProgress\n                course_id={Number(id)}\n                topics={userCoursesTopics.data?.[Number(id)] ?? []}\n                stats={userCoursesStats.data?.[Number(id)]?.finishedTopics ?? []}\n              />\n              <UserCourseAttempts\n                stats={userCoursesStats.data?.[Number(id)]?.attendanceList ?? []}\n              />\n            </Col>\n          ))}\n      </Row>\n      <ProForm<FormData> form={form} onFinish={onFinalGradeSubmit}>\n        <ProForm.Group\n          style={{ display: 'flex', flexDirection: 'column', paddingTop: '48px' }}\n          title={<FormattedMessage id=\"TeacherSubjects.FinalGrades.IssueAssessment\" />}\n          titleStyle={{ flex: 'unset' }}\n          align=\"center\"\n        >\n          <ProFormSelect\n            name=\"grade_term_id\"\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            label={<FormattedMessage id=\"TeacherSubjects.FinalGrades.GradeTerm\" />}\n            options={gradeTermsSelectOptions}\n            width=\"sm\"\n            fieldProps={{ loading: gradeTerms.loading }}\n          />\n          <ProFormSelect\n            name=\"grade_scale_id\"\n            rules={[{ required: true, message: <FormattedMessage id=\"field_required\" /> }]}\n            label={<FormattedMessage id=\"TeacherSubjects.FinalGrades.FinalGrade\" />}\n            options={gradesSelectOptions}\n            fieldProps={{ loading: finalGrades.loading || subjectGradeScales.loading }}\n          />\n          <ProForm.Item>\n            <FormattedMessage\n              id=\"TeacherSubjects.FinalGrades.ProposedGrade\"\n              values={{ grade: proposedGrade }}\n            />\n          </ProForm.Item>\n        </ProForm.Group>\n      </ProForm>\n    </>\n  );\n};\n","import React, { useMemo } from 'react';\nimport type { Location } from 'history';\nimport { FormattedMessage, Link, useLocation } from 'umi';\nimport { Button, Tooltip, Typography } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport { EditOutlined } from '@ant-design/icons';\n\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport { getGroupFinalGrades } from '@/services/escola-lms/grades';\nimport { useTeacherSubject } from '../context';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\nimport { FinalGradesDetails } from './FinalGradesDetails';\n\ninterface TableParams {\n  group_id?: number[];\n  first_name?: string;\n  last_name?: string;\n}\n\nconst staticColumns: ProColumns<API.FinalGradeItem>[] = [\n  {\n    title: <FormattedMessage id=\"first_name\" />,\n    dataIndex: 'first_name',\n    render: (_n, row) => row.user.first_name,\n  },\n  {\n    title: <FormattedMessage id=\"last_name\" />,\n    dataIndex: 'last_name',\n    render: (_n, row) => row.user.last_name,\n  },\n  {\n    title: <FormattedMessage id=\"grade\" />,\n    hideInSearch: true,\n    dataIndex: 'grades',\n    render: (_n, row) => (\n      <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>\n        {row.grades.length\n          ? row.grades.map(({ grade_name, grade_term, id }) => (\n              <Typography.Text key={id}>\n                {grade_term.name}: {grade_name}\n              </Typography.Text>\n            ))\n          : '-'}\n      </div>\n    ),\n  },\n];\n\nexport const FinalGradesList: React.FC = () => {\n  const location = useLocation() as Location & { query: { user_id?: string; group_id?: string } };\n  const { user_id, group_id } = useMemo(\n    () => ({\n      user_id: Number.isNaN(Number(location.query?.user_id))\n        ? null\n        : Number(location.query?.user_id),\n      group_id: Number.isNaN(Number(location.query?.group_id))\n        ? null\n        : Number(location.query?.group_id),\n    }),\n\n    [location.query?.user_id, location.query?.group_id],\n  );\n\n  const { teacherSubjectData, semester_subject_id } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ label: name, value: id })),\n    [teacherSubjectData?.groups],\n  );\n\n  if (user_id !== null && group_id !== null) {\n    return <FinalGradesDetails user_id={user_id} group_id={group_id} />;\n  }\n\n  return (\n    <ProTable<API.FinalGradeItem, TableParams>\n      className=\"table-standalone\"\n      rowKey=\"id\"\n      search={{ layout: 'vertical' }}\n      pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n      request={async ({ group_id: group_ids = [], first_name = '', last_name = '' }) => {\n        const allGroups = (teacherSubjectData?.groups ?? []).map(({ id }) => id);\n\n        const response = await getGroupFinalGrades(group_ids.length === 0 ? allGroups : group_ids);\n\n        if (!response.success) {\n          return { success: false, total: 0, data: [] };\n        }\n\n        // TODO backend filter\n        const data = response.data.filter(\n          ({ user }) =>\n            user.first_name.toLowerCase().includes(first_name.toLowerCase()) &&\n            user.last_name.toLowerCase().includes(last_name.toLowerCase()),\n        );\n\n        return { success: true, total: data.length, data };\n      }}\n      columns={[\n        {\n          title: <FormattedMessage id=\"group\" />,\n          dataIndex: 'group_id',\n          valueType: 'select',\n          fieldProps: {\n            options: groupOptions,\n            mode: 'multiple',\n          },\n          render: (_n, row) => (\n            <TypeButtonDrawer key={row.group_id} type=\"Students\" type_id={row.group_id} />\n          ),\n        },\n        ...staticColumns,\n        {\n          title: <FormattedMessage id=\"options\" />,\n          hideInSearch: true,\n          render: (_n, row) => [\n            <Link\n              key=\"edit\"\n              to={`/teacher/subjects/${semester_subject_id}/final-grades?user_id=${row.user.id}&group_id=${row.group_id}`}\n            >\n              <Tooltip title={<FormattedMessage id=\"edit\" />}>\n                <Button type=\"primary\" icon={<EditOutlined />} />\n              </Tooltip>\n            </Link>,\n          ],\n        },\n      ]}\n    />\n  );\n};\n","import React, { useMemo } from 'react';\nimport { format } from 'date-fns';\nimport { FormattedMessage } from 'umi';\nimport { Button, Tooltip } from 'antd';\nimport type { ProColumns } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { DownloadOutlined } from '@ant-design/icons';\n\nimport { DATETIME_FORMAT } from '@/consts/dates';\nimport { getPCGExportsHistory } from '@/services/escola-lms/pcg-export';\nimport TypeButtonDrawer from '@/components/TypeButtonDrawer';\nimport UserSelect from '@/components/UserSelect';\nimport { useTeacherSubject } from '../context';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from './consts';\n\nconst DownloadButton: React.FC<{ url: string }> = ({ url }) => (\n  <Tooltip title={<FormattedMessage id=\"download\" />}>\n    <Button\n      type=\"primary\"\n      onClick={() => {\n        window.open(url, '_blank', 'noopener noreferrer');\n      }}\n      icon={<DownloadOutlined />}\n    />\n  </Tooltip>\n);\n\nconst staticColumns: ProColumns<API.PCGFileExportsHistoryItem>[] = [\n  {\n    title: <FormattedMessage id=\"ID\" />,\n    dataIndex: 'id',\n    hideInSearch: true,\n  },\n  {\n    title: <FormattedMessage id=\"created_at\" />,\n    dataIndex: 'created_at',\n    hideInSearch: true,\n    render: (_n, record) => format(new Date(record.created_at), DATETIME_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"created_by\" />,\n    dataIndex: 'created_by',\n    renderFormItem: (item, { type, defaultRender, ...rest }, form) => {\n      if (type === 'form') {\n        return null;\n      }\n      const stateType = form.getFieldValue('state');\n      return (\n        <UserSelect\n          {...rest}\n          state={{\n            type: stateType,\n          }}\n        />\n      );\n    },\n    render: (_n, record) => (\n      <TypeButtonDrawer\n        key={record.created_by.id}\n        type=\"EscolaLms\\Core\\Models\\User\"\n        type_id={record.created_by.id}\n        text={\n          record?.created_by?.first_name && record?.created_by?.last_name\n            ? `${record.created_by.first_name} ${record.created_by.last_name}`\n            : undefined\n        }\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"exported_at\" />,\n    dataIndex: 'exported_at',\n    hideInSearch: true,\n    render: (_n, record) => format(new Date(record.exported_at), DATETIME_FORMAT),\n  },\n  {\n    title: <FormattedMessage id=\"exported_by\" />,\n    dataIndex: 'exported_by',\n    renderFormItem: (item, { type, defaultRender, ...rest }, form) => {\n      if (type === 'form') {\n        return null;\n      }\n      const stateType = form.getFieldValue('state');\n      return (\n        <UserSelect\n          {...rest}\n          state={{\n            type: stateType,\n          }}\n        />\n      );\n    },\n    render: (_n, record) => (\n      <TypeButtonDrawer\n        key={record.exported_by.id}\n        type=\"EscolaLms\\Core\\Models\\User\"\n        type_id={record.exported_by.id}\n        text={\n          record?.exported_by?.first_name && record?.exported_by?.last_name\n            ? `${record.exported_by.first_name} ${record.exported_by.last_name}`\n            : undefined\n        }\n      />\n    ),\n  },\n  {\n    title: <FormattedMessage id=\"version\" />,\n    dataIndex: 'version',\n    hideInSearch: true,\n  },\n  {\n    title: <FormattedMessage id=\"options\" />,\n    valueType: 'option',\n    render: (_n, record) => [<DownloadButton key=\"download\" url={record.url} />],\n  },\n];\n\nexport const FileExportsHistory: React.FC = () => {\n  const { teacherSubjectData } = useTeacherSubject();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const columns: ProColumns<API.PCGFileExportsHistoryItem>[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: teacherSubjectData?.groups?.[0]?.id,\n          allowClear: false,\n        },\n      },\n      ...staticColumns,\n    ],\n    [teacherSubjectData?.groups?.[0]?.id, groupOptions],\n  );\n\n  return (\n    <ProTable<API.PCGFileExportsHistoryItem, API.PCGFileExportsHistoryParams>\n      className=\"table-standalone\"\n      request={async ({\n        group_id = teacherSubjectData?.groups?.[0]?.id,\n        created_by,\n        exported_by,\n      }) => {\n        const response = await getPCGExportsHistory({ group_id, created_by, exported_by });\n\n        if (!response.success) {\n          return { success: false, data: [], total: 0 };\n        }\n\n        return { success: true, data: response.data, total: response.data.length };\n      }}\n      columns={columns}\n      search={{ layout: 'vertical' }}\n      scroll={{ x: 1500 }}\n      pagination={{ defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE }}\n    />\n  );\n};\n","import React, { useCallback, useMemo, useState } from 'react';\nimport { FormattedMessage } from 'umi';\nimport { Select } from 'antd';\n\nimport { createFinalGrade, removeFinalGrade, updateFinalGrade } from '@/services/escola-lms/grades';\n\ninterface Props {\n  term: API.GradeTerm;\n  gradeScales: API.SubjectGradeScale[];\n  defaultFinalGrade?: API.FinalGradeItemGrade;\n  finalGrades?: API.FinalGradeItem;\n}\n\nconst getGradeScaleId = (\n  gradeScales: API.SubjectGradeScale[],\n  name: string | undefined,\n): number | undefined => gradeScales.find((scale) => scale.name === name)?.id;\n\nexport const FinalGradeSelect: React.FC<Props> = ({\n  term,\n  gradeScales,\n  defaultFinalGrade,\n  finalGrades,\n}) => {\n  const [createdGrade, setCreatedGrade] = useState(defaultFinalGrade);\n\n  const [loading, setLoading] = useState(false);\n\n  const options = useMemo(\n    () => gradeScales.map(({ name, id }) => ({ value: id, label: name })),\n    [gradeScales],\n  );\n\n  const onChange = useCallback(\n    (grade_scale_id: number | undefined) => {\n      if (!finalGrades?.id) return;\n\n      if (grade_scale_id === undefined) {\n        if (!createdGrade) return;\n        setLoading(true);\n        removeFinalGrade(createdGrade.id)\n          .then((res) => {\n            if (!res.success) return;\n            setCreatedGrade(undefined);\n          })\n          .finally(() => setLoading(false));\n        return;\n      }\n\n      if (createdGrade) {\n        setLoading(true);\n        updateFinalGrade(createdGrade.id, {\n          grade_scale_id,\n        }).finally(() => setLoading(false));\n        return;\n      }\n\n      setLoading(true);\n      createFinalGrade({\n        grade_term_id: term.id,\n        grade_scale_id,\n        lesson_group_user_id: finalGrades.id,\n      })\n        .then((res) => {\n          if (res.success) {\n            const recentGrade = res.data.grades.find((grade) => grade.grade_term.id === term.id);\n            setCreatedGrade(recentGrade);\n          }\n        })\n        .finally(() => setLoading(false));\n    },\n    [createdGrade, term.id, finalGrades?.id],\n  );\n\n  if (!finalGrades) return null;\n\n  return (\n    <Select\n      allowClear\n      loading={loading}\n      disabled={loading}\n      placeholder={<FormattedMessage id=\"select_final_grade\" />}\n      style={{ width: '100%' }}\n      onChange={onChange}\n      options={options}\n      defaultValue={getGradeScaleId(gradeScales, defaultFinalGrade?.grade_name)}\n    />\n  );\n};\n","import React, { useCallback } from 'react';\nimport { InputNumber } from 'antd';\nimport { debounce } from 'lodash';\n\nimport { createExamResult } from '@/services/escola-lms/exams';\n\ninterface Props {\n  exam_id: number;\n  result: number;\n  student_id: number;\n  onSuccess?: (exam: API.Exam) => void;\n}\n\nexport const ExamGradeInput: React.FC<Props> = ({ exam_id, result, student_id, onSuccess }) => {\n  const onChange = useCallback(\n    debounce((value: number | null) => {\n      createExamResult(exam_id, student_id, { result: value ?? 0 }).then((res) => {\n        if (res.success) {\n          onSuccess?.(res.data);\n        }\n      });\n    }, 300),\n    [exam_id, result, student_id],\n  );\n\n  return <InputNumber type=\"number\" min={0} max={100} onChange={onChange} defaultValue={result} />;\n};\n","import { FormattedMessage } from 'umi';\nimport { format } from 'date-fns';\nimport type { ProColumns } from '@ant-design/pro-table';\n\nimport { DAY_FORMAT } from '@/consts/dates';\nimport AttendanceCheckbox from '@/components/AttendanceCheckbox';\n\nimport type { StudentExam } from '../FinalGradesDetails/types';\nimport { FinalGradeSelect } from '../FinalGradeSelect';\nimport { ExamGradeInput } from '../ExamGradeInput';\nimport type {\n  ClassRegisterTableItemAttendance,\n  ClassRegisterTableItemFinalGrade,\n  ClassRegisterTableItem,\n  ClassRegisterTableItemExamResult,\n} from './types';\n\n/* Attendance */\nexport const getAttendanceCols = (\n  groupAttendanceSchedule: API.GroupAttendanceSchedule[],\n): ProColumns<ClassRegisterTableItem> => {\n  const dynamicCols = groupAttendanceSchedule.reduce<ProColumns<ClassRegisterTableItem>[]>(\n    (acc, curr) => [\n      ...acc,\n      {\n        title: format(new Date(curr.date_from), DAY_FORMAT),\n        dataIndex: `attendance-${curr.date_from}`,\n        hideInSearch: true,\n        width: 100,\n        align: 'center',\n        render: (_, record) => (\n          <AttendanceCheckbox\n            groupAttendanceScheduleId={curr.id}\n            attendance={record[`attendance-${curr?.date_from}`]}\n            studentId={record.id}\n          />\n        ),\n      },\n    ],\n    [],\n  );\n\n  if (!dynamicCols.length)\n    return { title: <FormattedMessage id=\"attendance\" />, hideInSearch: true, hideInTable: true };\n\n  return {\n    title: <FormattedMessage id=\"attendance\" />,\n    hideInSearch: true,\n    children: dynamicCols,\n  };\n};\n\nexport const getStudentAttendances = (\n  groupAttendanceSchedules: API.GroupAttendanceSchedule[],\n  student_id: number,\n): ClassRegisterTableItemAttendance =>\n  groupAttendanceSchedules.reduce((innerAcc, groupAttendanceSchedule) => {\n    const studentAttendance = groupAttendanceSchedule.attendances.find(\n      (attendance) => attendance.user_id === student_id,\n    );\n    if (!studentAttendance) return innerAcc;\n\n    return {\n      ...innerAcc,\n      [`attendance-${groupAttendanceSchedule.date_from}`]: studentAttendance.value,\n    };\n  }, {});\n\n/* Exams */\nexport const getExamsCols = (exams: API.Exam[]): ProColumns<ClassRegisterTableItem> => {\n  const dynamicCols = exams.reduce<ProColumns<ClassRegisterTableItem>[]>(\n    (acc, exam) => [\n      ...acc,\n      {\n        dataIndex: `exam-${exam.id}`,\n        title: <FormattedMessage id=\"examTitleWithWeight\" values={exam} />,\n        hideInSearch: true,\n        width: 100,\n        render: (_n, record) =>\n          record?.[`exam-${exam.id}`]?.result !== undefined ? (\n            <ExamGradeInput\n              result={record?.[`exam-${exam.id}`].result}\n              exam_id={exam.id}\n              student_id={record.id}\n            />\n          ) : (\n            '-'\n          ),\n      },\n    ],\n    [],\n  );\n\n  if (!dynamicCols.length)\n    return { title: <FormattedMessage id=\"exams\" />, hideInSearch: true, hideInTable: true };\n\n  return { title: <FormattedMessage id=\"exams\" />, hideInSearch: true, children: dynamicCols };\n};\n\nexport const getStudentExamResults = (\n  studentExams: StudentExam[],\n): ClassRegisterTableItemExamResult =>\n  studentExams.reduce(\n    (innerAcc, { result, id: exam_id }) => ({\n      ...innerAcc,\n      [`exam-${exam_id}`]: result,\n    }),\n    {},\n  );\n\n/* Final grades */\nexport const getFinalGradesCols = (\n  gradeTerms: API.GradeTerm[],\n  subjectGradeScales: API.SubjectGradeScale[],\n): ProColumns<ClassRegisterTableItem> => ({\n  title: <FormattedMessage id=\"final-grades\" />,\n  hideInSearch: true,\n  children: gradeTerms.map((term) => ({\n    title: term.name,\n    hideInSearch: true,\n    width: 100,\n    align: 'center',\n    render: (_n, record) => (\n      <FinalGradeSelect\n        defaultFinalGrade={record[`final-grade-${term.id}`]}\n        finalGrades={record.final_grades}\n        term={term}\n        gradeScales={subjectGradeScales}\n      />\n    ),\n  })),\n});\n\nexport const getStudentFinalGrades = (\n  finalGrades: API.FinalGradeItem[],\n  student_id: number,\n): API.FinalGradeItem | undefined =>\n  finalGrades.find((finalGradeItem) => finalGradeItem.user.id === student_id);\n\nexport const getFinalGrades = (\n  studentFinalGrade?: API.FinalGradeItem,\n): ClassRegisterTableItemFinalGrade =>\n  (studentFinalGrade?.grades ?? []).reduce(\n    (acc, grade) => ({ ...acc, [`final-grade-${grade.grade_term.id}`]: grade }),\n    {},\n  );\n","import React, { useMemo, useRef, useState } from 'react';\nimport { FormattedMessage, useIntl } from 'umi';\nimport { message } from 'antd';\nimport ProTable from '@ant-design/pro-table';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\n\nimport { groupAttendanceSchedule as fetchGroupAttendanceSchedule } from '@/services/escola-lms/attendances';\nimport { studentUserGroup as fetchStudentUserGroup } from '@/services/escola-lms/student_user_groups';\nimport {\n  getSubjectTutorGrades as fetchSubjectTutorGrades,\n  getGroupFinalGrades as fetchGroupFinalGrades,\n  getGradeTerms as fetchGradeTerms,\n  getSubjectGradeScales as fetchSubjectGradeScales,\n} from '@/services/escola-lms/grades';\nimport { getExams as fetchExams } from '@/services/escola-lms/exams';\nimport { useTeacherSubject } from '../../context';\nimport {\n  getProposedGrade,\n  getScalesBySubjectScaleFormId,\n  getStudentExamsFromExams,\n} from '../FinalGradesDetails/utils';\nimport { TEACHER_SUBJECTS_PAGE_SIZE } from '../consts';\nimport {\n  getAttendanceCols,\n  getExamsCols,\n  getFinalGrades,\n  getFinalGradesCols,\n  getStudentAttendances,\n  getStudentExamResults,\n  getStudentFinalGrades,\n} from './utils';\nimport type { ClassRegisterTableItem } from './types';\n\nexport const ClassRegister: React.FC = () => {\n  const { teacherSubjectData, semester_subject_id } = useTeacherSubject();\n  const [dynamicCols, setDynamicCols] = useState<ProColumns<ClassRegisterTableItem>[]>([]);\n  const [selectedGroupName, setSelectedGroupName] = useState(teacherSubjectData?.groups?.[0]?.name);\n  const intl = useIntl();\n\n  const groupOptions = useMemo(\n    () => (teacherSubjectData?.groups ?? []).map(({ id, name }) => ({ value: id, label: name })),\n    [teacherSubjectData?.groups],\n  );\n\n  const actionRef = useRef<ActionType>();\n\n  const columns: ProColumns[] = useMemo(\n    () => [\n      {\n        title: <FormattedMessage id=\"group\" />,\n        dataIndex: 'group_id',\n        hideInTable: true,\n        valueType: 'select',\n        fieldProps: {\n          options: groupOptions,\n          defaultValue: groupOptions?.[0]?.value,\n          allowClear: false,\n        },\n      },\n      {\n        title: <FormattedMessage id=\"nameAndSurname\" defaultMessage=\"Name and surname\" />,\n        dataIndex: 'full_name',\n        fixed: 'left',\n      },\n      ...dynamicCols,\n    ],\n    [groupOptions, dynamicCols],\n  );\n\n  return (\n    <ProTable<ClassRegisterTableItem>\n      className=\"table-standalone\"\n      request={async ({ group_id = groupOptions[0]?.value, full_name = '' }) => {\n        const finalGradesRes = await fetchGroupFinalGrades(group_id);\n        const selectedGroup = groupOptions.find(({ value }) => value === group_id);\n        if (\n          !finalGradesRes.success ||\n          finalGradesRes.data[0] === undefined ||\n          semester_subject_id === null\n        ) {\n          message.error(\n            intl.formatMessage({ id: 'groupDataMissing' }, { group_name: selectedGroup?.label }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n\n        const [\n          studentUserGroupRes,\n          groupAttendanceScheduleRes,\n          examsRes,\n          tutorGradesRes,\n          gradeTermsRes,\n          subjectGradeScalesRes,\n        ] = await Promise.all([\n          fetchStudentUserGroup(group_id),\n          fetchGroupAttendanceSchedule(group_id),\n          fetchExams({ group_id, per_page: -1 }),\n          fetchSubjectTutorGrades(semester_subject_id, finalGradesRes.data?.[0]?.tutor_id),\n          fetchGradeTerms(),\n          fetchSubjectGradeScales(finalGradesRes.data?.[0]?.s_subject_scale_form_id),\n        ]);\n\n        if (\n          !studentUserGroupRes.success ||\n          !groupAttendanceScheduleRes.success ||\n          !examsRes.success ||\n          !tutorGradesRes.success ||\n          !gradeTermsRes.success ||\n          !subjectGradeScalesRes.success ||\n          !selectedGroup\n        ) {\n          message.error(\n            intl.formatMessage({ id: 'groupDataMissing' }, { group_name: selectedGroup?.label }),\n          );\n\n          return { data: [], total: 0, success: false };\n        }\n        setSelectedGroupName(selectedGroup.label);\n\n        /* COLS */\n        const attendanceCols = getAttendanceCols(groupAttendanceScheduleRes.data);\n        const examsCols = getExamsCols(examsRes.data);\n        const finalGradeCols = getFinalGradesCols(gradeTermsRes.data, subjectGradeScalesRes.data);\n\n        setDynamicCols([\n          attendanceCols,\n          examsCols,\n          finalGradeCols,\n          {\n            title: <FormattedMessage id=\"proposed_grade\" />,\n            hideInSearch: true,\n            dataIndex: 'proposed_grade',\n            align: 'center',\n            width: 100,\n          },\n        ]);\n\n        const data = studentUserGroupRes.data.users\n          .reduce<ClassRegisterTableItem[]>(\n            (acc, { id, academic_teacher_id, first_name, last_name }) => {\n              const studentFullName = `${last_name} ${first_name}`;\n              // filter out tutor & first name and second name filter\n              if (\n                academic_teacher_id !== null ||\n                !studentFullName.toLowerCase().includes(full_name.toLowerCase())\n              )\n                return acc;\n\n              const studentAttendances = getStudentAttendances(groupAttendanceScheduleRes.data, id);\n\n              const studentExams = getStudentExamsFromExams(examsRes.data, id);\n\n              const studentFinalGrades = getStudentFinalGrades(finalGradesRes.data, id);\n\n              const tutorScales =\n                getScalesBySubjectScaleFormId(\n                  studentFinalGrades?.s_subject_scale_form_id ?? 0,\n                  tutorGradesRes.data.grade_scale ?? [],\n                ) ?? [];\n\n              const proposed_grade = getProposedGrade(studentExams, tutorScales);\n\n              const studentExamResults = getStudentExamResults(studentExams);\n\n              const finalGrades = getFinalGrades(studentFinalGrades);\n\n              return [\n                ...acc,\n                {\n                  id,\n                  full_name: studentFullName,\n                  ...studentAttendances,\n                  ...studentExamResults,\n                  ...finalGrades,\n                  proposed_grade,\n                  final_grades: studentFinalGrades,\n                },\n              ];\n            },\n            [],\n          )\n          // sort alphabetically\n          .sort((a, b) => a.full_name.localeCompare(b.full_name));\n\n        return { data, total: data.length, success: true };\n      }}\n      columns={columns}\n      headerTitle={\n        <FormattedMessage\n          id=\"classRegisterTitleWithGroupName\"\n          values={{ groupName: selectedGroupName }}\n        />\n      }\n      search={{ layout: 'vertical' }}\n      scroll={{ x: 1500 }}\n      actionRef={actionRef}\n      pagination={{\n        defaultPageSize: TEACHER_SUBJECTS_PAGE_SIZE,\n        onChange: () => actionRef.current?.reload(),\n      }}\n      rowKey=\"id\"\n    />\n  );\n};\n","import React, { useCallback, useMemo } from 'react';\nimport { useParams, history, useIntl, FormattedMessage, useModel, Link } from 'umi';\nimport { Spin, Button } from 'antd';\nimport ProCard from '@ant-design/pro-card';\nimport { PageContainer } from '@ant-design/pro-layout';\n\nimport PERMISSIONS from '@/consts/permissions';\nimport { isUserHavePermissions } from '@/services/escola-lms/permissions';\nimport { TeacherSubjectContextProvider, useTeacherSubject } from './context';\nimport { Groups } from './components/Groups';\nimport { Exams } from './components/Exams';\nimport { Students } from './components/Students';\nimport { Attendances } from './components/Attendances';\nimport { GradesScale } from './components/GradesScale';\nimport { Schedule } from './components/Schedule';\nimport { FinalGradesList } from './components/FinalGradesList';\nimport { FileExportsHistory } from './components/FileExportsHistory';\nimport { ClassRegister } from './components/ClassRegister';\n\nconst TeacherSubjectsFormContent: React.FC<{ tab: string }> = ({ tab }) => {\n  const intl = useIntl();\n  const { setInitialState, initialState } = useModel('@@initialState');\n  const { teacherSubjectData, semester_subject_id, tutors } = useTeacherSubject();\n\n  const currentUserHasPermissions = useCallback(\n    isUserHavePermissions(initialState?.currentUser as API.UserItem),\n    [initialState?.currentUser],\n  );\n\n  const showGradeScale = useMemo(\n    () =>\n      !!tutors.data.find(({ id }) => id === initialState?.currentUser?.id) ||\n      currentUserHasPermissions(PERMISSIONS.TeacherListGradeScale),\n    [],\n  );\n\n  if (!teacherSubjectData) {\n    return <Spin />;\n  }\n\n  return (\n    <PageContainer\n      title={\n        <>\n          <FormattedMessage id={teacherSubjectData?.subject?.name} />\n          {', '}\n          <FormattedMessage id={tab} />\n        </>\n      }\n      tabBarExtraContent={\n        <div style={{ display: 'flex', padding: '12px', gap: '12px' }}>\n          <Link to={`/teacher/subjects/${semester_subject_id}/exams?exam_id=new`}>\n            <Button type=\"primary\">\n              <FormattedMessage id=\"uploadGrades\" defaultMessage=\"uploadGrades\" />\n            </Button>\n          </Link>\n        </div>\n      }\n      header={{\n        breadcrumb: {\n          routes: [\n            {\n              path: 'teacher',\n              breadcrumbName: intl.formatMessage({\n                id: 'menu.Teacher',\n              }),\n            },\n            {\n              path: 'subjects',\n              breadcrumbName: intl.formatMessage({\n                id: 'menu.Teacher.Subjects',\n              }),\n            },\n            {\n              path: String(semester_subject_id),\n              breadcrumbName: String(teacherSubjectData.subject?.name),\n            },\n            {\n              path: String(tab),\n              breadcrumbName: intl.formatMessage({ id: tab, defaultMessage: String(tab) }),\n            },\n          ],\n        },\n      }}\n    >\n      <ProCard\n        bodyStyle={{ padding: '24px' }}\n        tabs={{\n          type: 'card',\n          activeKey: tab,\n          onChange: (key) => {\n            setInitialState({\n              ...initialState,\n            });\n\n            history.push(`/teacher/subjects/${semester_subject_id}/${key}`);\n          },\n        }}\n      >\n        <ProCard.TabPane key=\"groups\" tab={<FormattedMessage id=\"groups\" />}>\n          <Groups />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"students\" tab={<FormattedMessage id=\"students\" />}>\n          <Students />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"exams\" tab={<FormattedMessage id=\"exams\" />}>\n          <Exams />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"schedule\" tab={<FormattedMessage id=\"schedule\" />}>\n          <Schedule />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"class-register\" tab={<FormattedMessage id=\"class-register\" />}>\n          <ClassRegister />\n        </ProCard.TabPane>\n        <ProCard.TabPane key=\"attendance\" tab={<FormattedMessage id=\"attendance\" />}>\n          <Attendances />\n        </ProCard.TabPane>\n        {showGradeScale && (\n          <ProCard.TabPane key=\"grades-scale\" tab={<FormattedMessage id=\"grades-scale\" />}>\n            <GradesScale />\n          </ProCard.TabPane>\n        )}\n        <ProCard.TabPane key=\"final-grades\" tab={<FormattedMessage id=\"final-grades\" />}>\n          <FinalGradesList />\n        </ProCard.TabPane>\n        <ProCard.TabPane\n          key=\"file-exports-history\"\n          tab={<FormattedMessage id=\"file-exports-history\" />}\n        >\n          <FileExportsHistory />\n        </ProCard.TabPane>\n      </ProCard>\n    </PageContainer>\n  );\n};\n\nexport default () => {\n  const params = useParams<{ subjectId?: string; tab?: string }>();\n  const { subjectId, tab = 'groups' } = params;\n\n  return (\n    <TeacherSubjectContextProvider semester_subject_id={Number(subjectId)}>\n      <TeacherSubjectsFormContent tab={tab} />\n    </TeacherSubjectContextProvider>\n  );\n};\n","import React, { useCallback, useEffect, useState, useMemo } from 'react';\nimport { message } from 'antd';\nimport { useIntl, useLocation } from 'umi';\nimport { history } from 'umi';\nimport type { Location } from 'history';\n\nimport {\n  program,\n  createLesson as apiCreateLesson,\n  updateLesson as apiUpdateLesson,\n  createTopic as apiCreateTopic,\n  updateTopic as apiUpdateTopic,\n  removeLesson as apiRemoveLesson,\n  removeTopic as apiRemoveTopic,\n  cloneLesson as apiCloneLesson,\n  cloneTopic as apiCloneTopic,\n} from '@/services/escola-lms/course';\n\nimport type { UploadChangeParam } from 'antd/lib/upload';\nimport { TopicType } from '@/services/escola-lms/enums';\n\ntype CurrentEditMode =\n  | { mode: 'lesson'; id: number; value?: API.Lesson | null }\n  | { mode: 'topic'; id: number; value?: API.Topic | null }\n  | { mode: 'init' };\n\ntype ProgramContext = {\n  currentEditMode?: CurrentEditMode;\n  state?: API.CourseProgram;\n  h5ps?: any[];\n  // token: credentials.token,\n  id?: number;\n  addNewLesson?: (parentId?: number) => API.Lesson;\n  updateLesson?: (lesson_id: number, data: FormData) => Promise<void | boolean>;\n  updateTopic?: (topic_id: number, data: FormData) => Promise<void>;\n  // addResource,\n  // removeResource,\n  deleteLesson?: (lesson_id: number) => void;\n  // updateH5P,\n  addNewTopic?: (lesson_id: number, type: API.TopicType) => API.Topic;\n  deleteTopic?: (topic_id: number) => void;\n  onTopicUploaded?: (prevTopicId: number, info: UploadChangeParam) => void;\n  cloneTopic?: (topic_id: number) => void;\n  cloneLesson?: (lesson_id: number) => void;\n  getLessons?: () => void;\n};\n\nexport const Context = React.createContext<ProgramContext>({});\n\nconst getRandomId = () => Math.round(Math.random() * 99999);\n\nconst getFlatLessons = (lessons: API.Lesson[]): API.Lesson[] => {\n  return lessons.reduce((acc, curr) => {\n    return [...acc, ...(curr.lessons ? getFlatLessons(curr.lessons) : []), curr];\n  }, [] as API.Lesson[]) as API.Lesson[];\n};\n\nexport const getFlatTopics = (lessons: API.Lesson[]): API.Topic[] => {\n  return lessons.reduce((acc, curr) => {\n    return [...acc, ...(curr.lessons ? getFlatTopics(curr.lessons) : []), ...(curr.topics ?? [])];\n  }, [] as API.Topic[]) as API.Topic[];\n};\n\nconst recursiveAddTopicToLessons = (\n  lessons: API.Lesson[],\n  lessonId: number,\n  topic: API.Topic,\n): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: lesson.lessons ? recursiveAddTopicToLessons(lesson.lessons, lessonId, topic) : [],\n    topics: lesson.id === lessonId ? [...(lesson.topics ?? []), topic] : lesson.topics ?? [],\n  }));\n};\n\n// Probably should be removed\n// const recursiveEditTopic = (\n//   lessons: API.Lesson[],\n//   topicId: number,\n//   updatedTopic: API.Topic,\n// ): API.Lesson[] => {\n//   return lessons.map((lesson) => ({\n//     ...lesson,\n//     lessons: recursiveEditTopic(lesson.lessons ?? [], topicId, updatedTopic),\n//     topics: lesson.topics?.map((topic) => (topic.id === topicId ? updatedTopic : topic)) ?? [],\n//   }));\n// };\n\nconst recursiveAddLessonToLessons = (\n  lessons: API.Lesson[],\n  newLesson: API.Lesson,\n  lessonId?: number | null,\n): API.Lesson[] => {\n  if (!lessonId) {\n    return [...lessons, newLesson];\n  }\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: [\n      ...(lesson.lessons ? recursiveAddLessonToLessons(lesson.lessons, newLesson, lessonId) : []),\n      ...(lesson.id === lessonId ? [newLesson] : []),\n    ],\n  }));\n};\n\nconst recursiveEditLesson = (\n  lessons: API.Lesson[],\n  lessonId: number,\n  updatedLesson: API.Lesson,\n): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...(lesson.id === lessonId ? updatedLesson : lesson),\n    lessons: lesson.lessons ? recursiveEditLesson(lesson.lessons, lessonId, updatedLesson) : [],\n  }));\n};\n\nconst appendParentIdToLessons = (lessons: API.Lesson[], lessonParentId?: number): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    parent_id: lessonParentId,\n    lessons: lesson.lessons ? appendParentIdToLessons(lesson.lessons, lesson.id) : [],\n  }));\n};\n\nconst recursiveDeleteLesson = (lessons: API.Lesson[], lessonId: number): API.Lesson[] => {\n  return lessons\n    .filter((lesson) => lesson.id !== lessonId)\n    .map((lesson) => ({\n      ...lesson,\n      lessons: lesson.lessons ? recursiveDeleteLesson(lesson.lessons, lessonId) : [],\n    }));\n};\n\nconst recursiveDeleteTopic = (lessons: API.Lesson[], topicId: number): API.Lesson[] => {\n  return lessons.map((lesson) => ({\n    ...lesson,\n    lessons: lesson.lessons ? recursiveDeleteTopic(lesson.lessons, topicId) : [],\n    topics: lesson.topics ? lesson.topics.filter((topic) => topic.id !== topicId) : [],\n  }));\n};\n\nconst recursiveTopicUploaded = (\n  prevTopicId: number,\n  info: UploadChangeParam,\n  lesson_id: number | null | undefined,\n  lessons: API.Lesson[],\n): API.Lesson[] => {\n  return lessons?.map((lesson) => {\n    if (lesson.id === lesson_id) {\n      return {\n        ...lesson,\n        topics: lesson.topics?.map((topic) => {\n          if (topic.id === prevTopicId) {\n            return info.file.response.data;\n          }\n          return topic;\n        }),\n      };\n    } else if (lesson.lessons) {\n      return {\n        ...lesson,\n        lessons: recursiveTopicUploaded(prevTopicId, info, lesson_id, lesson.lessons || []),\n      };\n    }\n    return lesson;\n  });\n};\n\nexport const AppContext: React.FC<{ children: React.ReactNode; id: number }> = ({\n  children,\n  id,\n}) => {\n  const [state, setState] = useState<API.CourseProgram>();\n  const intl = useIntl();\n\n  const flatTopics: API.Topic[] = useMemo(() => {\n    return state && state.lessons ? getFlatTopics(state.lessons) : [];\n  }, [state]);\n\n  const flatLessons: API.Lesson[] = useMemo(() => {\n    return state && state.lessons ? getFlatLessons(state.lessons) : [];\n  }, [state]);\n\n  const [h5ps, setH5ps] = useState([]);\n\n  const l = useLocation() as Location & { query: { lesson?: string; topic?: string } };\n\n  useEffect(() => {\n    setH5ps([]);\n  }, []);\n\n  /*\n  useEffect(() => {\n    API(`h5p`, token)\n      .then((response) => response.json())\n      .then((data) => {\n        setH5ps(data);\n      });\n    //.then(() => addNewLesson());\n  }, []);\n  */\n\n  const getLessons = useCallback(() => {\n    program(id).then((data) => {\n      return (\n        data.success &&\n        setState({\n          ...data.data,\n          lessons: appendParentIdToLessons(data.data.lessons),\n        })\n      );\n    });\n  }, [id]);\n\n  useEffect(() => {\n    getLessons();\n  }, [getLessons]);\n\n  const getLessonIdByTopicId = useCallback(\n    (topic_id: number) => {\n      const lesson = flatLessons.find((lesson_item) =>\n        lesson_item?.topics?.find((topic) => topic.id === topic_id),\n      );\n      return lesson ? lesson.id : null;\n    },\n    [flatLessons],\n  );\n\n  const currentEditMode = useMemo<CurrentEditMode>(() => {\n    if (l.query?.lesson) {\n      return {\n        mode: 'lesson',\n        id: Number(l.query.lesson),\n        value: flatLessons.find((lesson) => lesson.id === Number(l.query.lesson)),\n      };\n    }\n    if (l.query?.topic) {\n      return {\n        mode: 'topic',\n        id: Number(l.query.topic),\n        value: flatTopics.find((t) => t.id === Number(l.query.topic)),\n      };\n    }\n    return { mode: 'init' };\n  }, [l.query, state, flatLessons, flatTopics]);\n\n  const addNewLesson = useCallback(\n    (parentId?: number) => {\n      const newLesson: API.Lesson = {\n        course_id: id,\n        topics: [],\n        isNew: true,\n        id: state ? state.lessons.length + 1 : getRandomId(), // New Lesson\n        order: 0,\n        title: intl.formatMessage({ id: 'add_title_here' }),\n        active: true,\n        parent_id: parentId,\n      };\n\n      setState((prevState) => ({\n        ...prevState,\n        lessons: recursiveAddLessonToLessons(prevState?.lessons ?? [], newLesson, parentId),\n        //lessons: [...(prevState ? prevState.lessons : []), newLesson] as API.Lesson[],\n      }));\n\n      return newLesson;\n    },\n    [id, state],\n  );\n\n  const updateLesson = useCallback(\n    (lesson_id: number, formData: FormData) => {\n      const newLesson = flatLessons.find((lesson) => lesson.id === lesson_id);\n      const isNew = newLesson && newLesson.isNew;\n\n      return (isNew ? apiCreateLesson(formData) : apiUpdateLesson(lesson_id, formData)).then(\n        (data) => {\n          message.success(data.message);\n          getLessons();\n          return (\n            data.success &&\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveEditLesson(prevState?.lessons ?? [], lesson_id, {\n                ...data.data,\n                isNew: false,\n              }),\n              /*\n              lessons: prevState?.lessons\n                ? prevState.lessons.map((lesson) => {\n                    if (lesson.id === lesson_id) {\n                      return {\n                        ...lesson,\n                        ...data.data,\n                        isNew: false,\n                      };\n                    }\n                    return lesson;\n                  })\n                : [data.data],\n                */\n            }))\n          );\n        },\n      );\n    },\n    [state],\n  );\n\n  const deleteLesson = useCallback(\n    (lesson_id: number) => {\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n      if (!lesson) {\n        return;\n      }\n      const { isNew } = lesson;\n\n      if (isNew) {\n        setState((prevState) => ({\n          ...prevState,\n          lessons: recursiveDeleteLesson(prevState?.lessons ?? [], lesson_id),\n        }));\n      } else {\n        apiRemoveLesson(lesson_id).then((data) => {\n          if (data.success) {\n            message.success(data.message);\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveDeleteLesson(prevState?.lessons ?? [], lesson_id),\n            }));\n          }\n        });\n      }\n    },\n    [state],\n  );\n\n  const updateTopic = useCallback(\n    (topic_id: number, formData: FormData) => {\n      const lesson_id = getLessonIdByTopicId(topic_id);\n\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n\n      const topic = lesson && lesson.topics?.find((topic_item) => topic_item.id === topic_id);\n\n      const isNew = topic?.isNew;\n\n      return (isNew ? apiCreateTopic(formData) : apiUpdateTopic(topic_id, formData)).then(\n        (data) => {\n          if (data.success) {\n            message.success(data.message);\n            getLessons();\n\n            history.push(`/courses/list/${id}/program/?topic=${data.data.id}`);\n\n            if (topic?.topicable_type === TopicType.Video) {\n              setTimeout(() => {\n                getLessons();\n              }, 5000);\n            }\n          }\n        },\n      );\n    },\n    [getLessonIdByTopicId, state, getLessons],\n  );\n\n  const deleteTopic = useCallback(\n    (topic_id: number) => {\n      const lesson_id = getLessonIdByTopicId(topic_id);\n\n      const lesson = flatLessons.find((lesson_item) => lesson_item.id === lesson_id);\n      if (!lesson) {\n        return;\n      }\n\n      const topic = flatTopics?.find((topic_item) => topic_item.id === topic_id);\n\n      const isNew = topic?.isNew;\n      if (isNew && !topic.topicable) {\n        setState((prevState) => ({\n          ...prevState,\n          lessons: recursiveDeleteTopic(prevState?.lessons ?? [], topic_id),\n        }));\n      } else {\n        apiRemoveTopic(topic_id).then((data) => {\n          if (data.success) {\n            message.success(data.message);\n            setState((prevState) => ({\n              ...prevState,\n              lessons: recursiveDeleteTopic(prevState?.lessons ?? [], topic_id),\n            }));\n          }\n        });\n\n        // TODO call API to delete\n        /**\n         return API(`topic/delete/${id}`, token, 'POST')\n        .then((response) => response.json())\n        .then(() =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.filter((topic) => topic.id !== id),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n         */\n      }\n    },\n    [state, getLessonIdByTopicId],\n  );\n\n  /*\n  const addResource = useCallback(\n    (id, formData) => {\n      const isNew = false;\n\n      const id = getLessonByTopicId(id);\n\n      return API(`topic/resource/save/${id}`, token, 'POST', formData)\n        .then((response) => response.json())\n        .then((data) =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        resources: [...topic.resources, data],\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  /*\n  const removeResource = useCallback(\n    (resource_id) => {\n      // resource/delete/{courseFiles}\n\n      const id = getQuizIdByResourseId(resource_id);\n      const id = getLessonByTopicId(id);\n\n      return API(`topic/resource/delete/${resource_id}`, token, 'DELETE', null)\n        .then((response) => response.json())\n        .then(() =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        resources: topic.resources.filter(\n                          (resource) => resource.id !== resource_id,\n                        ),\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  /*\n  const updateH5P = useCallback(\n    (id, h5p_id) => {\n      const id = getLessonByTopicId(id);\n      return API(`topic/h5p/save/${id}`, token, 'POST', getFormData({ media: h5p_id }))\n        .then((response) => response.json())\n        .then((data) =>\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState.lessons.map((lesson) => {\n              if (lesson.id == id) {\n                return {\n                  ...lesson,\n                  topics: lesson.topics.map((topic) => {\n                    if (topic.id == id) {\n                      return {\n                        ...topic,\n                        media: data,\n                      };\n                    }\n                    return topic;\n                  }),\n                };\n              }\n              return lesson;\n            }),\n          })),\n        );\n    },\n    [state],\n  );\n  */\n\n  const addNewTopic = useCallback((lesson_id: number, type: API.TopicType) => {\n    const newTopic: API.Topic = {\n      lesson_id,\n      isNew: true,\n      id: getRandomId(),\n      title: intl.formatMessage({ id: 'add_title_here' }),\n      active: true,\n      topicable_type: type,\n    };\n\n    setState((prevState) => ({\n      ...prevState,\n      lessons: recursiveAddTopicToLessons(prevState?.lessons ?? [], lesson_id, newTopic),\n    }));\n    return newTopic;\n  }, []);\n\n  const onTopicUploaded = (prevTopicId: number, info: UploadChangeParam) => {\n    const lesson_id = getLessonIdByTopicId(prevTopicId);\n    setState((prevState) => ({\n      ...prevState,\n      lessons: prevState\n        ? recursiveTopicUploaded(prevTopicId, info, lesson_id, prevState.lessons || [])\n        : [],\n      // Probably should be removed\n      // lessons: recursiveEditTopic(prevState?.lessons ?? [], prevTopicId, info.file.response.data),\n    }));\n    // Update topic id in params after receiving from server\n    history.push(`/courses/list/${id}/program/?topic=${info.file.response.data.id}`);\n  };\n\n  const cloneTopic = useCallback(\n    (topic_id: number) => {\n      return apiCloneTopic(topic_id).then((response) => {\n        if (response.success) {\n          message.success(response.message);\n          const lesson_id = getLessonIdByTopicId(topic_id);\n\n          setState((prevState) => ({\n            ...prevState,\n            lessons: prevState\n              ? prevState.lessons?.map((lesson) => {\n                  if (lesson.id === lesson_id) {\n                    const topics = lesson.topics || [];\n                    return {\n                      ...lesson,\n                      topics: [...topics, response.data] as API.Topic[],\n                    };\n                  }\n                  return lesson;\n                })\n              : [],\n          }));\n        }\n      });\n    },\n    [state, getLessonIdByTopicId],\n  );\n\n  const cloneLesson = useCallback((lesson_id: number) => {\n    return apiCloneLesson(lesson_id).then((response) => {\n      if (response.success) {\n        message.success(response.message);\n\n        setState((prevState) => ({\n          ...prevState,\n          lessons: prevState ? [...prevState.lessons, response.data] : [],\n        }));\n      }\n    });\n  }, []);\n\n  const value = {\n    state,\n    h5ps,\n    // token: credentials.token,\n    id,\n    addNewLesson,\n    updateLesson,\n    updateTopic,\n    // addResource,\n    // removeResource,\n    deleteLesson,\n    // updateH5P,\n    addNewTopic,\n    deleteTopic,\n    onTopicUploaded,\n    cloneTopic,\n    cloneLesson,\n    currentEditMode,\n    getLessons,\n  };\n\n  return <Context.Provider value={value}>{children}</Context.Provider>;\n};\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\nexport async function reports(\n  params: {\n    // query\n    metric: API.ReportType;\n    date?: string;\n    limit?: number;\n  },\n  options?: RequestOptionsInit,\n) {\n  return request<API.ReportList>('/api/admin/reports/report', {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    ...(options || {}),\n  });\n}\n\n/* GET /api/admin/stats/course/:course_id/export */\nexport async function exportStatForCourse(\n  course_id: number,\n  params: API.ExportStatForCourseParams,\n  options?: RequestOptionsInit,\n) {\n  return request<Blob | API.DefaultResponseError>(`/api/admin/stats/course/${course_id}/export`, {\n    params,\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    responseType: 'blob',\n    headers: {\n      accept: 'application/vnd.ms-excel',\n    },\n    ...(options || {}),\n  });\n}\n\n/* GET /api/admin/stats/topic/:topic_id/export */\nexport async function exportStatForTopic(\n  topic_id: number,\n  stat: API.TopicStatsKey,\n  options?: RequestOptionsInit,\n) {\n  return request<Blob | API.DefaultResponseError>(`/api/admin/stats/topic/${topic_id}/export`, {\n    method: 'GET',\n    /* useCache: true */ useCache: false,\n    params: { stat },\n    responseType: 'blob',\n    headers: {\n      accept: 'application/vnd.ms-excel',\n    },\n    ...(options || {}),\n  });\n}\n"],"sourceRoot":""}