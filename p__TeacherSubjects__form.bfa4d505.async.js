"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803],{56717:function(jt,at,o){var Qe=o(1413),c=o(67294),Te=o(93696),I=o(84089),Re=function(m,s){return c.createElement(I.Z,(0,Qe.Z)((0,Qe.Z)({},m),{},{ref:s,icon:Te.Z}))};Re.displayName="InfoCircleOutlined",at.Z=c.forwardRef(Re)},78677:function(jt,at,o){var Qe=o(67294),c=o(80404),Te=function(){return Te=Object.assign||function(Re){for(var F,m=1,s=arguments.length;m<s;m++){F=arguments[m];for(var Ve in F)Object.prototype.hasOwnProperty.call(F,Ve)&&(Re[Ve]=F[Ve])}return Re},Te.apply(this,arguments)},I=function(Re){return Qe.createElement(c.P,Te({},Re,{chartType:"Column"}))};at.Z=I},88280:function(jt,at,o){o.d(at,{Z:function(){return xt}});var Qe=o(4942),c=o(97685),Te=o(45987),I=o(74165),Re=o(15861),F=o(1413),m=o(87462),s=o(67294),Ve=o(42110),ze=o(78026),ce=function(Ne,rt){return s.createElement(ze.Z,(0,m.Z)({},Ne,{ref:rt,icon:Ve.Z}))},p=s.forwardRef(ce),E=o(97462),u=o(952),_=o(10915),j=o(48171),ie=o(53914),k=o(22270),ye=o(60249),P=o(14726),he=o(75842),xe=o(21770),qe=o(88306),vt=o(8880),Me=o(72717),V=o(85893),oe=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],$=["record","position","creatorButtonText","newRecordType","parentKey","style"],B=s.createContext(void 0);function Ue(e){var Ne=e.children,rt=e.record,Ie=e.position,Pe=e.newRecordType,ae=e.parentKey,ve=(0,s.useContext)(B);return s.cloneElement(Ne,(0,F.Z)((0,F.Z)({},Ne.props),{},{onClick:function(){var Ze=(0,Re.Z)((0,I.Z)().mark(function je(we){var Ye,Je,Ge,pe;return(0,I.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.next=2,(Ye=(Je=Ne.props).onClick)===null||Ye===void 0?void 0:Ye.call(Je,we);case 2:if(pe=H.sent,pe!==!1){H.next=5;break}return H.abrupt("return");case 5:ve==null||(Ge=ve.current)===null||Ge===void 0||Ge.addEditRecord(rt,{position:Ie,newRecordType:Pe,parentKey:ae});case 6:case"end":return H.stop()}},je)}));function Q(je){return Ze.apply(this,arguments)}return Q}()}))}function g(e){var Ne,rt,Ie=(0,_.YB)(),Pe=e.onTableChange,ae=e.maxLength,ve=e.formItemProps,Ze=e.recordCreatorProps,Q=e.rowKey,je=e.controlled,we=e.defaultValue,Ye=e.onChange,Je=e.editableFormRef,Ge=(0,Te.Z)(e,oe),pe=(0,s.useRef)(void 0),_e=(0,s.useRef)(),H=(0,s.useRef)();(0,s.useImperativeHandle)(Ge.actionRef,function(){return _e.current},[_e.current]);var me=(0,xe.Z)(function(){return e.value||we||[]},{value:e.value,onChange:e.onChange}),G=(0,c.Z)(me,2),q=G[0],lt=G[1],L=s.useMemo(function(){return typeof Q=="function"?Q:function(le,De){return le[Q]||De}},[Q]),re=(0,j.J)(function(le){if(typeof le=="number"&&!e.name){if(le>=q.length)return le;var De=q&&q[le];return L==null?void 0:L(De,le)}if((typeof le=="string"||le>=q.length)&&e.name){var de=q.findIndex(function(be,Se){var Ae;return(L==null||(Ae=L(be,Se))===null||Ae===void 0?void 0:Ae.toString())===(le==null?void 0:le.toString())});if(de!==-1)return de}return le});(0,s.useImperativeHandle)(Je,function(){var le=function(be){var Se,Ae;if(be==null)throw new Error("rowIndex is required");var et=re(be),dt=[e.name,(Se=et==null?void 0:et.toString())!==null&&Se!==void 0?Se:""].flat(1).filter(Boolean);return(Ae=H.current)===null||Ae===void 0?void 0:Ae.getFieldValue(dt)},De=function(){var be,Se=[e.name].flat(1).filter(Boolean);if(Array.isArray(Se)&&Se.length===0){var Ae,et=(Ae=H.current)===null||Ae===void 0?void 0:Ae.getFieldsValue();return Array.isArray(et)?et:Object.keys(et).map(function(dt){return et[dt]})}return(be=H.current)===null||be===void 0?void 0:be.getFieldValue(Se)};return(0,F.Z)((0,F.Z)({},H.current),{},{getRowData:le,getRowsData:De,setRowData:function(be,Se){var Ae,et;if(be==null)throw new Error("rowIndex is required");var dt=re(be),gt=[e.name,(Ae=dt==null?void 0:dt.toString())!==null&&Ae!==void 0?Ae:""].flat(1).filter(Boolean),Et=Object.assign({},(0,F.Z)((0,F.Z)({},le(be)),Se||{})),_t=(0,vt.Z)({},gt,Et);return(et=H.current)===null||et===void 0||et.setFieldsValue(_t),!0}})},[re,e.name,H.current]),(0,s.useEffect)(function(){e.controlled&&(q||[]).forEach(function(le,De){var de;(de=H.current)===null||de===void 0||de.setFieldsValue((0,Qe.Z)({},"".concat(L(le,De)),le))},{})},[(0,ie.ZP)(q),e.controlled]),(0,s.useEffect)(function(){if(e.name){var le;H.current=e==null||(le=e.editable)===null||le===void 0?void 0:le.form}},[(Ne=e.editable)===null||Ne===void 0?void 0:Ne.form,e.name]);var W=Ze||{},K=W.record,te=W.position,ne=W.creatorButtonText,Xe=W.newRecordType,tt=W.parentKey,Tt=W.style,yt=(0,Te.Z)(W,$),Ft=te==="top",pt=(0,s.useMemo)(function(){return typeof ae=="number"&&ae<=(q==null?void 0:q.length)?!1:Ze!==!1&&(0,V.jsx)(Ue,{record:(0,k.h)(K,q==null?void 0:q.length,q)||{},position:te,parentKey:(0,k.h)(tt,q==null?void 0:q.length,q),newRecordType:Xe,children:(0,V.jsx)(P.ZP,(0,F.Z)((0,F.Z)({type:"dashed",style:(0,F.Z)({display:"block",margin:"10px 0",width:"100%"},Tt),icon:(0,V.jsx)(p,{})},yt),{},{children:ne||Ie.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ze,ae,q==null?void 0:q.length]),$t=(0,s.useMemo)(function(){return pt?Ft?{components:{header:{wrapper:function(De){var de,be=De.className,Se=De.children;return(0,V.jsxs)("thead",{className:be,children:[Se,(0,V.jsxs)("tr",{style:{position:"relative"},children:[(0,V.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:pt}),(0,V.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(de=Ge.columns)===null||de===void 0?void 0:de.length,children:pt})]})]})}}}}:{tableViewRender:function(De,de){var be,Se;return(0,V.jsxs)(V.Fragment,{children:[(be=(Se=e.tableViewRender)===null||Se===void 0?void 0:Se.call(e,De,de))!==null&&be!==void 0?be:de,pt]})}}:{}},[Ft,pt]),bt=(0,F.Z)({},e.editable),Vt=(0,j.J)(function(le,De){var de,be,Se;if((de=e.editable)===null||de===void 0||(be=de.onValuesChange)===null||be===void 0||be.call(de,le,De),(Se=e.onValuesChange)===null||Se===void 0||Se.call(e,De,le),e.controlled){var Ae;e==null||(Ae=e.onChange)===null||Ae===void 0||Ae.call(e,De)}});return(e!=null&&e.onValuesChange||(rt=e.editable)!==null&&rt!==void 0&&rt.onValuesChange||e.controlled&&e!==null&&e!==void 0&&e.onChange)&&(bt.onValuesChange=Vt),(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B.Provider,{value:_e,children:(0,V.jsx)(Me.Z,(0,F.Z)((0,F.Z)((0,F.Z)({search:!1,options:!1,pagination:!1,rowKey:Q,revalidateOnFocus:!1},Ge),$t),{},{tableLayout:"fixed",actionRef:_e,onChange:Pe,editable:(0,F.Z)((0,F.Z)({},bt),{},{formProps:(0,F.Z)({formRef:H},bt.formProps)}),dataSource:q,onDataSourceChange:function(De){if(lt(De),e.name&&te==="top"){var de,be=(0,vt.Z)({},[e.name].flat(1).filter(Boolean),De);(de=H.current)===null||de===void 0||de.setFieldsValue(be)}}}))}),e.name?(0,V.jsx)(E.Z,{name:[e.name],children:function(De){var de,be;if(!pe.current)return pe.current=q,null;var Se=(0,qe.Z)(De,[e.name].flat(1)),Ae=Se==null?void 0:Se.find(function(et,dt){var gt;return!(0,ye.A)(et,(gt=pe.current)===null||gt===void 0?void 0:gt[dt])});return pe.current=q,Ae&&(e==null||(de=e.editable)===null||de===void 0||(be=de.onValuesChange)===null||be===void 0||be.call(de,Ae,Se)),null}}):null]})}function We(e){var Ne=u.ZP.useFormInstance();return e.name?(0,V.jsx)(he.Z.Item,(0,F.Z)((0,F.Z)({style:{maxWidth:"100%"}},e==null?void 0:e.formItemProps),{},{name:e.name,shouldUpdate:function(Ie,Pe){var ae=[e.name].flat(1);try{return JSON.stringify((0,qe.Z)(Ie,ae))!==JSON.stringify((0,qe.Z)(Pe,ae))}catch(ve){return!0}},children:(0,V.jsx)(g,(0,F.Z)((0,F.Z)({},e),{},{editable:(0,F.Z)((0,F.Z)({},e.editable),{},{form:Ne})}))})):(0,V.jsx)(g,(0,F.Z)({},e))}We.RecordCreator=Ue;var xt=We},11312:function(jt,at,o){o.d(at,{nu:function(){return rt},rL:function(){return Ne},Du:function(){return e}});var Qe=o(9783),c=o.n(Qe),Te=o(97857),I=o.n(Te),Re=o(19632),F=o.n(Re),m=o(5574),s=o.n(m),Ve=o(45919),ze=o(66419),ce=o(78677),p=o(26271),E=o(78957),u=o(66309),_=o(72051),j=o(71230),ie=o(72269),k=o(83863),ye=o(60943),P=o(67294),he=o(70804),xe=o(80854),qe=o(62235),vt=o(15009),Me=o.n(vt),V=o(99289),oe=o.n(V),$=o(58638),B=o(14726),Ue=o(76841),g=o(85893),We=function(Pe){var ae=Pe.course_id,ve=Pe.stat,Ze=ve===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":ve,Q=(0,P.useState)(!1),je=s()(Q,2),we=je[0],Ye=je[1],Je=(0,P.useCallback)(function(Ge){return oe()(Me()().mark(function pe(){var _e,H;return Me()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Ye(!0),G.prev=1,G.next=4,(0,Ue._g)(Ge,{stat:Ze});case 4:_e=G.sent,_e instanceof Blob&&(H=document.createElement("a"),H.href=window.URL.createObjectURL(_e),H.download="finished_topics_".concat(ae,".xlsx"),document.body.appendChild(H),H.click(),document.body.removeChild(H)),G.next=11;break;case 8:G.prev=8,G.t0=G.catch(1),console.error(G.t0);case 11:return G.prev=11,Ye(!1),G.finish(11);case 14:case"end":return G.stop()}},pe,null,[[1,8,11,14]])}))},[Ze]);return(0,g.jsxs)(B.ZP,{type:"primary",loading:we,onClick:Je(ae),children:[(0,g.jsx)($.Z,{})," ",(0,g.jsx)(xe.FormattedMessage,{id:"export"})]})},xt=function(Pe){return Pe.topicable.content.contents?Object.values(Pe.topicable.content.contents)[0].library:"H5P"},e=function(Pe){var ae=Pe.course_id,ve=Pe.topics,Ze=Pe.stats,Q=(0,P.useState)(!1),je=s()(Q,2),we=je[0],Ye=je[1],Je=(0,P.useMemo)(function(){return[{title:(0,g.jsx)(xe.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(_e){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:_e})}},{title:(0,g.jsx)(xe.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(F()(ve.map(function(pe){var _e,H=(_e=pe.topicable_type)===null||_e===void 0?void 0:_e.split("\\").pop();return H==="H5P"&&(H=xt(pe)),{render:function(G){var q=0;switch(G&&(G.started_at&&G.finished_at?q=1:G.started_at&&(q=2)),q){case 1:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(u.Z,{color:"success",children:"F"}),we&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 2:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(u.Z,{color:"blue",children:"S"}),we&&(G==null?void 0:G.seconds)&&(0,g.jsx)("small",{children:(0,ze.Im)(G.seconds)})]});case 0:default:return(0,g.jsx)(P.Fragment,{children:(0,g.jsx)(u.Z,{color:"error",children:"N"})})}},title:(0,g.jsxs)("small",{children:[(0,g.jsx)(u.Z,{children:H})," ",pe.title]}),dataIndex:pe.id}})))},[ve,we]),Ge=(0,P.useMemo)(function(){return Ze.map(function(pe){return ve.reduce(function(_e,H){var me=pe.topics.find(function(G){return G.id===H.id});return I()(I()({},_e),{},c()({},Number(H.id),me!=null?me:0))},{email:pe.email,id:pe.id})})},[Ze,ve]);return(0,g.jsx)(_.Z,{title:function(){return(0,g.jsxs)(j.Z,{justify:"space-between",align:"middle",children:[(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(xe.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,g.jsx)(u.Z,{color:"success",children:"F"}),(0,g.jsx)(xe.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,g.jsx)(u.Z,{color:"blue",children:"S"}),(0,g.jsx)(xe.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,g.jsx)(u.Z,{color:"error",children:"N"}),(0,g.jsx)(xe.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,g.jsx)(ie.Z,{checked:we,onChange:function(H){return Ye(H)}})]}),(0,g.jsx)(We,{course_id:ae})]})},columns:Je,dataSource:Ge,size:"small",scroll:{x:1500},components:{table:function(_e){return(0,g.jsx)(he.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,g.jsx)("table",I()({},_e))})}}})},Ne=function(Pe){var ae=Pe.stats,ve=Pe.attempts,Ze=(0,P.useMemo)(function(){return[{title:(0,g.jsx)(xe.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(we){return(0,g.jsx)(qe.Z,{type:"App\\Models\\User",type_id:we})}},{title:(0,g.jsx)(xe.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,g.jsx)(xe.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,g.jsx)(xe.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(we){return we?(0,ye.WU)(new Date(we),Ve.Cu):""}}]},[]),Q=(0,P.useMemo)(function(){return ae.map(function(je){var we=je.id,Ye=je.email,Je=je.finished_at,Ge=ve==null?void 0:ve.find(function(_e){return _e.id===we}),pe=Array.isArray(Ge==null?void 0:Ge.attempts)?Ge==null?void 0:Ge.attempts.length:0;return{id:we,email:Ye,finished_at:Je,attempt:pe}})},[ae]);return(0,g.jsx)(_.Z,{title:function(){return(0,g.jsx)(E.Z,{children:(0,g.jsx)(xe.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ze,dataSource:Q,size:"small",scroll:{x:500}})},rt=function(Pe){var ae=Pe.stats,ve=(0,P.useState)(null),Ze=s()(ve,2),Q=Ze[0],je=Ze[1],we=(0,P.useState)(null),Ye=s()(we,2),Je=Ye[0],Ge=Ye[1],pe=(0,xe.useIntl)(),_e=(0,P.useMemo)(function(){return ae.flatMap(function(me){return Object.values(me.attempts).flatMap(function(G){var q=G.dates,lt=G.attempt,L=Object.values(q).flatMap(function(re){var W=re.date,K=re.seconds_total;return{date:W,attempt:lt,seconds_total:K,email:me.email}});return L})})},[ae]),H={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,g.jsx)(p.ZP,{title:(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(xe.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,g.jsx)(k.default,{showSearch:!0,value:Q,onChange:function(G){je(G),Ge(null)},placeholder:(0,g.jsx)(xe.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:ae.map(function(me){var G=me.id,q=me.email;return(0,g.jsx)(k.default.Option,{value:q,children:q},G)})}),(0,g.jsx)(k.default,{value:Je,onChange:function(G){return Ge(G)},disabled:Q===null,placeholder:(0,g.jsx)(xe.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:F()(new Set(_e.filter(function(me){var G=me.email;return G===Q}).map(function(me){var G=me.attempt;return G}))).map(function(me){return(0,g.jsxs)(k.default.Option,{value:me,children:[(0,g.jsx)(xe.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",me]},me)})})]}),colSpan:12,layout:"center",children:(0,g.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,g.jsx)(ce.Z,I()(I()({},H),{},{tooltip:{title:"".concat(pe.formatMessage({id:"attempt"})),formatter:function(G){var q=Math.floor(+G.seconds_total/60),lt=+G.seconds_total>60?+G.seconds_total-q*60:0;return{name:G.attempt,value:"".concat(q,"m ").concat(lt,"s")}}},data:_e.filter(function(me){var G=me.email;return G===Q}).filter(function(me){var G=me.attempt;return Number.isInteger(Je)?G===Je:!0})}))})})}},87366:function(jt,at,o){o.d(at,{Il:function(){return vt},_y:function(){return E},uS:function(){return j}});var Qe=o(5574),c=o.n(Qe),Te=o(97857),I=o.n(Te),Re=o(19632),F=o.n(Re),m=o(2453),s=o(67294),Ve=o(80854),ze=o(99100),ce=o(31472),p=o(85893),E=s.createContext({}),u=function(){return Math.round(Math.random()*99999)},_=function Me(V){return V.reduce(function(oe,$){return[].concat(F()(oe),F()($.lessons?Me($.lessons):[]),[$])},[])},j=function Me(V){return V.reduce(function(oe,$){var B;return[].concat(F()(oe),F()($.lessons?Me($.lessons):[]),F()((B=$.topics)!==null&&B!==void 0?B:[]))},[])},ie=function Me(V,oe,$){return V.map(function(B){var Ue,g;return I()(I()({},B),{},{lessons:B.lessons?Me(B.lessons,oe,$):[],topics:B.id===oe?[].concat(F()((Ue=B.topics)!==null&&Ue!==void 0?Ue:[]),[$]):(g=B.topics)!==null&&g!==void 0?g:[]})})},k=function Me(V,oe,$){return $?V.map(function(B){return I()(I()({},B),{},{lessons:[].concat(F()(B.lessons?Me(B.lessons,oe,$):[]),F()(B.id===$?[oe]:[]))})}):[].concat(F()(V),[oe])},ye=function Me(V,oe,$){return V.map(function(B){return I()(I()({},B.id===oe?$:B),{},{lessons:B.lessons?Me(B.lessons,oe,$):[]})})},P=function Me(V,oe){return V.map(function($){return I()(I()({},$),{},{parent_id:oe,lessons:$.lessons?Me($.lessons,$.id):[]})})},he=function Me(V,oe){return V.filter(function($){return $.id!==oe}).map(function($){return I()(I()({},$),{},{lessons:$.lessons?Me($.lessons,oe):[]})})},xe=function Me(V,oe){return V.map(function($){return I()(I()({},$),{},{lessons:$.lessons?Me($.lessons,oe):[],topics:$.topics?$.topics.filter(function(B){return B.id!==oe}):[]})})},qe=function Me(V,oe,$,B){return B==null?void 0:B.map(function(Ue){if(Ue.id===$){var g;return I()(I()({},Ue),{},{topics:(g=Ue.topics)===null||g===void 0?void 0:g.map(function(We){return We.id===V?oe.file.response.data:We})})}else if(Ue.lessons)return I()(I()({},Ue),{},{lessons:Me(V,oe,$,Ue.lessons||[])});return Ue})},vt=function(V){var oe=V.children,$=V.id,B=(0,s.useState)(),Ue=c()(B,2),g=Ue[0],We=Ue[1],xt=(0,Ve.useIntl)(),e=(0,s.useMemo)(function(){return g&&g.lessons?j(g.lessons):[]},[g]),Ne=(0,s.useMemo)(function(){return g&&g.lessons?_(g.lessons):[]},[g]),rt=(0,s.useState)([]),Ie=c()(rt,2),Pe=Ie[0],ae=Ie[1],ve=(0,Ve.useLocation)(),Ze=(0,s.useMemo)(function(){var L=new URLSearchParams(ve.search);return{lesson:L.get("lesson"),topic:L.get("topic")}},[ve]);(0,s.useEffect)(function(){ae([])},[]);var Q=(0,s.useCallback)(function(){(0,ze.Nx)($).then(function(L){return L.success&&We(I()(I()({},L.data),{},{lessons:P(L.data.lessons)}))})},[$]);(0,s.useEffect)(function(){Q()},[Q]);var je=(0,s.useCallback)(function(L){var re=Ne.find(function(W){var K;return W==null||(K=W.topics)===null||K===void 0?void 0:K.find(function(te){return te.id===L})});return re?re.id:null},[Ne]),we=(0,s.useMemo)(function(){return Ze.lesson?{mode:"lesson",id:Number(Ze.lesson),value:Ne.find(function(L){return L.id===Number(Ze.lesson)})}:Ze.topic?{mode:"topic",id:Number(Ze.topic),value:e.find(function(L){return L.id===Number(Ze.topic)})}:{mode:"init"}},[Ze,g,Ne,e]),Ye=(0,s.useCallback)(function(L){var re={course_id:$,topics:[],isNew:!0,id:g?g.lessons.length+1:u(),order:0,title:xt.formatMessage({id:"add_title_here"}),active:!0,parent_id:L};return We(function(W){var K;return I()(I()({},W),{},{lessons:k((K=W==null?void 0:W.lessons)!==null&&K!==void 0?K:[],re,L)})}),re},[$,g]),Je=(0,s.useCallback)(function(L,re){var W=Ne.find(function(te){return te.id===L}),K=W&&W.isNew;return(K?(0,ze.aA)(re):(0,ze.sI)(L,re)).then(function(te){return m.ZP.success(te.message),Q(),te.success&&We(function(ne){var Xe;return I()(I()({},ne),{},{lessons:ye((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],L,I()(I()({},te.data),{},{isNew:!1}))})})})},[g]),Ge=(0,s.useCallback)(function(L){var re=Ne.find(function(K){return K.id===L});if(re){var W=re.isNew;W?We(function(K){var te;return I()(I()({},K),{},{lessons:he((te=K==null?void 0:K.lessons)!==null&&te!==void 0?te:[],L)})}):(0,ze.iI)(L).then(function(K){K.success&&(m.ZP.success(K.message),We(function(te){var ne;return I()(I()({},te),{},{lessons:he((ne=te==null?void 0:te.lessons)!==null&&ne!==void 0?ne:[],L)})}))})}},[g]),pe=(0,s.useCallback)(function(L,re){var W,K=je(L),te=Ne.find(function(tt){return tt.id===K}),ne=te&&((W=te.topics)===null||W===void 0?void 0:W.find(function(tt){return tt.id===L})),Xe=ne==null?void 0:ne.isNew;return(Xe?(0,ze.HV)(re):(0,ze.Cn)(L,re)).then(function(tt){tt.success&&(m.ZP.success(tt.message),Q(),Ve.history.push("/courses/list/".concat($,"/program/?topic=").concat(tt.data.id)),(ne==null?void 0:ne.topicable_type)===ce.oz.Video&&setTimeout(function(){Q()},5e3))})},[je,g,Q]),_e=(0,s.useCallback)(function(L){var re=je(L),W=Ne.find(function(ne){return ne.id===re});if(W){var K=e==null?void 0:e.find(function(ne){return ne.id===L}),te=K==null?void 0:K.isNew;te&&!K.topicable?We(function(ne){var Xe;return I()(I()({},ne),{},{lessons:xe((Xe=ne==null?void 0:ne.lessons)!==null&&Xe!==void 0?Xe:[],L)})}):(0,ze.vJ)(L).then(function(ne){ne.success&&(m.ZP.success(ne.message),We(function(Xe){var tt;return I()(I()({},Xe),{},{lessons:xe((tt=Xe==null?void 0:Xe.lessons)!==null&&tt!==void 0?tt:[],L)})}))})}},[g,je]),H=(0,s.useCallback)(function(L,re){var W={lesson_id:L,isNew:!0,id:u(),title:xt.formatMessage({id:"add_title_here"}),active:!0,topicable_type:re};return We(function(K){var te;return I()(I()({},K),{},{lessons:ie((te=K==null?void 0:K.lessons)!==null&&te!==void 0?te:[],L,W)})}),W},[]),me=function(re,W){var K=je(re);We(function(te){return I()(I()({},te),{},{lessons:te?qe(re,W,K,te.lessons||[]):[]})}),Ve.history.push("/courses/list/".concat($,"/program/?topic=").concat(W.file.response.data.id))},G=(0,s.useCallback)(function(L){return(0,ze.Cx)(L).then(function(re){if(re.success){m.ZP.success(re.message);var W=je(L);We(function(K){var te;return I()(I()({},K),{},{lessons:K?(te=K.lessons)===null||te===void 0?void 0:te.map(function(ne){if(ne.id===W){var Xe=ne.topics||[];return I()(I()({},ne),{},{topics:[].concat(F()(Xe),[re.data])})}return ne}):[]})})}})},[g,je]),q=(0,s.useCallback)(function(L){return(0,ze.if)(L).then(function(re){re.success&&(m.ZP.success(re.message),We(function(W){return I()(I()({},W),{},{lessons:W?[].concat(F()(W.lessons),[re.data]):[]})}))})},[]),lt={state:g,h5ps:Pe,id:$,addNewLesson:Ye,updateLesson:Je,updateTopic:pe,deleteLesson:Ge,addNewTopic:H,deleteTopic:_e,onTopicUploaded:me,cloneTopic:G,cloneLesson:q,currentEditMode:we,getLessons:Q};return(0,p.jsx)(E.Provider,{value:lt,children:oe})}},42733:function(jt,at,o){o.r(at),o.d(at,{default:function(){return Lr}});var Qe=o(97857),c=o.n(Qe),Te=o(26271),I=o(74453),Re=o(75081),F=o(14726),m=o(67294),s=o(80854),Ve=o(91115),ze=o(26114),ce=o(15009),p=o.n(ce),E=o(9783),u=o.n(E),_=o(99289),j=o.n(_),ie=o(19632),k=o.n(ie),ye=o(5574),P=o.n(ye),he=o(16894),xe=o(2453),qe=o(60943);function vt(i,n){return Me.apply(this,arguments)}function Me(){return Me=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Me.apply(this,arguments)}function V(i,n,t,r){return oe.apply(this,arguments)}function oe(){return oe=j()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n,"/attendances"),c()({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return d.stop()}},i)})),oe.apply(this,arguments)}var $=o(78957),B=o(83062),Ue=o(84567),g=o(31472);function We(i){var n,t=i===null?g.cX.ABSENT:i,r=u()(u()(u()(u()({},g.cX.PRESENT,{ch1:!0,ch2:!1}),g.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),g.cX.ABSENT,{ch1:!1,ch2:!1}),g.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(n=r[t])!==null&&n!==void 0?n:{ch1:!1,ch2:!1}}function xt(i){var n,t=i.ch1,r=i.ch2,a="".concat(t,"_").concat(r),l={true_false:g.cX.PRESENT,true_true:g.cX.PRESENT_NOT_EXERCISING,false_false:g.cX.ABSENT,false_true:g.cX.EXCUSED_ABSENCE};return(n=l[a])!==null&&n!==void 0?n:g.cX.ABSENT}var e=o(85893),Ne=function(n){var t=n.groupAttendanceScheduleId,r=n.studentId,a=n.attendance,l=n.onSuccess,d=(0,m.useState)(We(a)),v=P()(d,2),h=v[0],C=v[1],y=(0,m.useState)(!1),M=P()(y,2),b=M[0],f=M[1],x=(0,m.useRef)(!0),T=(0,m.useCallback)(function(D){f(!0),V(t,r,xt(D)).then(function(Z){Z.success&&(l==null||l())}).finally(function(){return f(!1)})},[]),S=(0,m.useCallback)(function(D){return C(D.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),A=(0,m.useCallback)(function(D){return C(function(Z){return c()(c()({},Z),{},{ch2:D.target.checked})})},[]);return(0,m.useEffect)(function(){if(x.current){x.current=!1;return}T(h)},[h,T]),(0,e.jsxs)($.Z,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(Ue.Z,{disabled:b,checked:h.ch1,onChange:S})}),(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:h.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(Ue.Z,{disabled:b,checked:h.ch2,onChange:A})})]})},rt=Ne,Ie=o(45919),Pe=o(95213),ae=o(7092),ve=o(66149),Ze=function(){var n=(0,ae.Z)(),t=n.teacherSubjectData,r=(0,m.useState)([]),a=P()(r,2),l=a[0],d=a[1],v=(0,m.useState)(""),h=P()(v,2),C=h[0],y=h[1],M=(0,s.useIntl)(),b=(0,m.useRef)(),f=(0,m.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(S){var A=S.id,D=S.name;return{value:A,label:D}})},[t==null?void 0:t.groups]),x=(0,m.useMemo)(function(){var T;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:f,defaultValue:f==null||(T=f[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(l))},[f,l]);return(0,e.jsx)(he.ZP,{className:"table-standalone",headerTitle:"".concat(M.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(C,")"),request:function(){var T=j()(p()().mark(function S(A){var D,Z,ee,U,Y,N,w,R,O,se,Ke;return p()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return Z=A.group_id,ee=Z===void 0?f==null||(D=f[0])===null||D===void 0?void 0:D.value:Z,U=A.full_name,Y=U===void 0?"":U,$e.next=3,Promise.all([(0,Pe.X)(ee),vt(ee)]);case 3:if(N=$e.sent,w=P()(N,2),R=w[0],O=w[1],se=f.find(function(Le){var X=Le.value;return X===ee}),!(!R.success||!O.success||!se)){$e.next=10;break}return $e.abrupt("return",{data:[],total:0,success:!1});case 10:if(O.data.length){$e.next=13;break}return xe.ZP.error(M.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),$e.abrupt("return",{data:[],total:0,success:!1});case 13:return y(se.label),d(O.data.reduce(function(Le,X){return[].concat(k()(Le),[{title:String((0,qe.WU)(new Date(X.date_from),Ie.GC)),dataIndex:String(X.date_from),hideInSearch:!0,width:100,align:"center",render:function(z,ue){return(0,e.jsx)(rt,{groupAttendanceScheduleId:X.id,attendance:ue["".concat(X==null?void 0:X.date_from)],studentId:ue.id})}}])},[])),Ke=R.data.users.reduce(function(Le,X){var Fe=X.id,z=X.academic_teacher_id,ue=X.first_name,Ee=X.last_name,Oe="".concat(Ee," ").concat(ue);if(z!==null||!Oe.toLowerCase().includes(Y.toLowerCase()))return Le;var J=O.data.reduce(function(ge,fe){var Ce=fe.attendances.find(function(ke){return ke.user_id===Fe});return Ce?c()(c()({},ge),{},u()({},"".concat(fe.date_from),Ce.value)):ge},{});return[].concat(k()(Le),[c()({id:Fe,full_name:Oe},J)])},[]).sort(function(Le,X){return Le.full_name.localeCompare(X.full_name)}),$e.abrupt("return",{data:Ke,total:Ke.length,success:!0});case 17:case"end":return $e.stop()}},S)}));return function(S){return T.apply(this,arguments)}}(),columns:x,search:{layout:"vertical"},pagination:{defaultPageSize:ve.S,onChange:function(){var S;return(S=b.current)===null||S===void 0?void 0:S.reload()}},scroll:{x:1500},actionRef:b,rowKey:"id"})},Q=o(25514),je=o(28248),we=o(2487),Ye=o(96365),Je=o(75842);function Ge(i,n){return pe.apply(this,arguments)}function pe(){return pe=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"GET",params:n},t||{})));case 1:case"end":return a.stop()}},i)})),pe.apply(this,arguments)}function _e(i,n){return H.apply(this,arguments)}function H(){return H=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),H.apply(this,arguments)}function me(i,n,t){return G.apply(this,arguments)}function G(){return G=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),c()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},i)})),G.apply(this,arguments)}function q(i,n,t){return lt.apply(this,arguments)}function lt(){return lt=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),c()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},i)})),lt.apply(this,arguments)}var L=function(n){var t=n.visible,r=n.onClose,a=n.user,l=Q.Z.Text,d=a.name,v=a.groupId,h=a.userId,C=(0,m.useState)(""),y=P()(C,2),M=y[0],b=y[1],f=(0,m.useState)(!1),x=P()(f,2),T=x[0],S=x[1],A=(0,m.useState)([]),D=P()(A,2),Z=D[0],ee=D[1],U=(0,m.useState)(null),Y=P()(U,2),N=Y[0],w=Y[1],R=(0,m.useState)({current_page:1,per_page:5,last_page:1,total:0}),O=P()(R,2),se=O[0],Ke=O[1],He=function(){var Fe=j()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,Ge({bookmarkable_id:v,bookmarkable_type:g.h5.Group,user_id:h,page:ue,per_page:se.per_page});case 2:Ee=J.sent,Ee.success&&(ee(Ee.data),Ke(Ee.meta));case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}(),$e=function(){var Fe=j()(p()().mark(function z(){var ue;return p()().wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return Oe.next=2,_e({value:M,bookmarkable_id:v,bookmarkable_type:g.h5.Group,user_id:h});case 2:ue=Oe.sent,ue.success&&(He(),S(!1),b(""));case 4:case"end":return Oe.stop()}},z)}));return function(){return Fe.apply(this,arguments)}}(),Le=function(){var Fe=j()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,q(ue);case 2:Ee=J.sent,Ee.success&&He();case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}(),X=function(){var Fe=j()(p()().mark(function z(ue){var Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,me(ue,{value:(N==null?void 0:N.currentText)||"",bookmarkable_id:v,bookmarkable_type:g.h5.Group,user_id:h});case 2:Ee=J.sent,Ee.success&&(He(),w(null));case 4:case"end":return J.stop()}},z)}));return function(ue){return Fe.apply(this,arguments)}}();return(0,m.useEffect)(function(){He()},[]),(0,e.jsxs)(je.Z,{title:(0,e.jsxs)($.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(d,")")})]}),open:t,onCancel:r,footer:[(0,e.jsx)(F.ZP,{onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(we.Z,{dataSource:Z,pagination:{onChange:function(z){return He(z)},pageSize:se.per_page,total:se.total,current:se.current_page},renderItem:function(z){return(0,e.jsx)(we.Z.Item,{actions:[(0,e.jsx)(F.ZP,{danger:!0,onClick:function(){return Le(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},z.id),(N==null?void 0:N.currentNoteId)===z.id?(0,e.jsxs)($.Z,{children:[(0,e.jsx)(F.ZP,{onClick:function(){return X(z.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(F.ZP,{onClick:function(){return w(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(F.ZP,{onClick:function(){return w({currentNoteId:z.id,currentText:z.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},z.id)],children:(N==null?void 0:N.currentNoteId)===z.id&&(N==null?void 0:N.currentText)!==null?(0,e.jsx)(Ye.Z.TextArea,{value:N==null?void 0:N.currentText,onChange:function(Ee){return w(function(Oe){return c()(c()({},Oe),{},{currentText:Ee.target.value})})}}):z.value})}}),T?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Je.Z,{layout:"vertical",children:(0,e.jsx)(Je.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(Ye.Z.TextArea,{value:M,onChange:function(z){return b(z.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)($.Z,{children:[(0,e.jsx)(F.ZP,{type:"primary",onClick:$e,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return S(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return S(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},re=L;function W(i,n){return K.apply(this,arguments)}function K(){return K=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},i)})),K.apply(this,arguments)}function te(i,n){return ne.apply(this,arguments)}function ne(){return ne=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),ne.apply(this,arguments)}function Xe(i,n,t){return tt.apply(this,arguments)}function tt(){return tt=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),tt.apply(this,arguments)}function Tt(i,n){return yt.apply(this,arguments)}function yt(){return yt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),yt.apply(this,arguments)}function Ft(i,n){return pt.apply(this,arguments)}function pt(){return pt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),pt.apply(this,arguments)}function $t(i,n,t,r){return bt.apply(this,arguments)}function bt(){return bt=j()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n,"/users/").concat(t),c()({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return d.stop()}},i)})),bt.apply(this,arguments)}function Vt(i,n,t){return le.apply(this,arguments)}function le(){return le=_asyncToGenerator(_regeneratorRuntime().mark(function i(n,t,r){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(n,"/users/").concat(t),_objectSpread({method:"DELETE"},r||{})));case 1:case"end":return l.stop()}},i)})),le.apply(this,arguments)}function De(i,n,t){return de.apply(this,arguments)}function de(){return de=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),c()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),de.apply(this,arguments)}function be(i,n,t,r){return Se.apply(this,arguments)}function Se(){return Se=j()(p()().mark(function i(n,t,r,a){return p()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),c()({method:"POST",data:r},a||{})));case 1:case"end":return d.stop()}},i)})),Se.apply(this,arguments)}function Ae(i,n){return et.apply(this,arguments)}function et(){return et=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",c()({method:"GET",params:{"groups[]":n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),et.apply(this,arguments)}function dt(i,n,t){return gt.apply(this,arguments)}function gt(){return gt=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),c()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},i)})),gt.apply(this,arguments)}function Et(i){return _t.apply(this,arguments)}function _t(){return _t=j()(p()().mark(function i(n){return p()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-terms",c()({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},i)})),_t.apply(this,arguments)}function zt(i,n){return Lt.apply(this,arguments)}function Lt(){return Lt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(n),c()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Lt.apply(this,arguments)}function Xt(i,n){return Rt.apply(this,arguments)}function Rt(){return Rt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades",c()({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Rt.apply(this,arguments)}function Ht(i,n,t){return Nt.apply(this,arguments)}function Nt(){return Nt=j()(p()().mark(function i(n,t,r){return p()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),c()({method:"PATCH",data:t},r||{})));case 1:case"end":return l.stop()}},i)})),Nt.apply(this,arguments)}function Yt(i,n){return Ot.apply(this,arguments)}function Ot(){return Ot=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),c()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},i)})),Ot.apply(this,arguments)}var Pt=o(47389),fa=o(13769),Zt=o.n(fa),va=["results"],Jt=function(n,t){return n.reduce(function(r,a){var l=a.results,d=Zt()(a,va),v=l.find(function(h){return h.user_id===t});return v?[].concat(k()(r),[c()(c()({},d),{},{result:v})]):r},[])},Qt=function(n,t){var r,a=n.reduce(function(f,x){var T=x.result,S=x.weight;return[f[0]+T.result*S,f[1]+S]},[0,0]),l=P()(a,2),d=l[0],v=l[1],h=Number.isNaN(d/v)?0:d/v,C=t.sort(function(f,x){return f.grade_value-x.grade_value}).reduce(function(f,x){return[].concat(k()(f),[c()(c()({},x),{},{isWeightedAverageGreater:h>=x.grade_value})])},[]);if(C.every(function(f){var x=f.isWeightedAverageGreater;return x})){var y,M;return(y=(M=C.at(-1))===null||M===void 0?void 0:M.name)!==null&&y!==void 0?y:""}var b=C.findIndex(function(f){var x=f.isWeightedAverageGreater;return!x});return b<0?"":(r=C[b-1])===null||r===void 0?void 0:r.name},qt=function(n,t){var r;return(r=t.find(function(a){return a.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},ea=o(8925),pa=o(96486),ga=function(n){var t=n.exam_id,r=n.result,a=n.student_id,l=n.onSuccess,d=(0,m.useCallback)((0,pa.debounce)(function(v){$t(t,a,{result:v!=null?v:0}).then(function(h){h.success&&(l==null||l(h.data))})},300),[t,r,a]);return(0,e.jsx)(ea.Z,{type:"number",min:0,max:100,onChange:d,defaultValue:r})},It=o(83863),ha=function(n,t){var r;return(r=n.find(function(a){return a.name===t}))===null||r===void 0?void 0:r.id},xa=function(n){var t=n.term,r=n.gradeScales,a=n.defaultFinalGrade,l=n.finalGrades,d=(0,m.useState)(a),v=P()(d,2),h=v[0],C=v[1],y=(0,m.useState)(!1),M=P()(y,2),b=M[0],f=M[1],x=(0,m.useState)(!1),T=P()(x,2),S=T[0],A=T[1],D=(0,s.useIntl)(),Z=(0,m.useMemo)(function(){return r.map(function(Y){var N=Y.name,w=Y.id;return{value:w,label:N}})},[r]),ee=function(N){A(!0),xe.ZP.error(D.formatMessage({id:N.data.message}))},U=(0,m.useCallback)(function(Y){if(l!=null&&l.id){if(Y===void 0){if(!h)return;f(!0),Yt(h.id).then(function(N){N.success&&C(void 0)}).finally(function(){return f(!1)});return}if(h){f(!0),Ht(h.id,{grade_scale_id:Y}).catch(function(N){var w;N!=null&&(w=N.data)!==null&&w!==void 0&&w.message&&ee(N)}).finally(function(){return f(!1)});return}f(!0),Xt({grade_term_id:t.id,grade_scale_id:Y,lesson_group_user_id:l.id}).then(function(N){if(N.success){var w=N.data.grades.find(function(R){return R.grade_term.id===t.id});C(w),S&&A(!1)}}).catch(function(N){var w;N!=null&&(w=N.data)!==null&&w!==void 0&&w.message&&ee(N)}).finally(function(){return f(!1)})}},[h,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(It.default,{allowClear:!0,status:S?"error":"",loading:b,disabled:b,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:U,options:Z,defaultValue:ha(r,a==null?void 0:a.grade_name)}):null},ja=function(n){var t=n.reduce(function(r,a){return[].concat(k()(r),[{title:(0,qe.WU)(new Date(a.date_from),Ie.GC),dataIndex:"attendance-".concat(a.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,v){return(0,e.jsx)(rt,{groupAttendanceScheduleId:a.id,attendance:v["attendance-".concat(a==null?void 0:a.date_from)],studentId:v.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},ba=function(n,t){return n.reduce(function(r,a){var l=a.attendances.find(function(d){return d.user_id===t});return l?c()(c()({},r),{},u()({},"attendance-".concat(a.date_from),l.value)):r},{})},Sa=function(n){var t=n.reduce(function(r,a){return[].concat(k()(r),[{dataIndex:"exam-".concat(a.id),title:(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:a}),hideInSearch:!0,width:100,render:function(d,v){var h;return(v==null||(h=v["exam-".concat(a.id)])===null||h===void 0?void 0:h.result)!==void 0?(0,e.jsx)(ga,{result:v==null?void 0:v["exam-".concat(a.id)].result,exam_id:a.id,student_id:v.id}):"-"}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},ya=function(n){return n.reduce(function(t,r){var a=r.result,l=r.id;return c()(c()({},t),{},u()({},"exam-".concat(l),a))},{})},_a=function(n,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(l,d){var v;return(0,e.jsx)(xa,{defaultFinalGrade:d["final-grade-".concat(r.id)],finalGrades:d.final_grades,term:r,gradeScales:t},"".concat(d==null||(v=d.final_grades)===null||v===void 0?void 0:v.group_id,"-").concat(r.id))}}})}},Ma=function(n,t){return n.find(function(r){return r.user.id===t})},Ca=function(n){var t;return((t=n==null?void 0:n.grades)!==null&&t!==void 0?t:[]).reduce(function(r,a){return c()(c()({},r),{},u()({},"final-grade-".concat(a.grade_term.id),a))},{})},Ta=function(){var n,t=(0,ae.Z)(),r=t.teacherSubjectData,a=t.semester_subject_id,l=(0,m.useState)([]),d=P()(l,2),v=d[0],h=d[1],C=(0,m.useState)(r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.name),y=P()(C,2),M=y[0],b=y[1],f=(0,m.useState)(null),x=P()(f,2),T=x[0],S=x[1],A=(0,s.useIntl)(),D=(0,m.useMemo)(function(){var U;return((U=r==null?void 0:r.groups)!==null&&U!==void 0?U:[]).map(function(Y){var N=Y.id,w=Y.name;return{value:N,label:w}})},[r==null?void 0:r.groups]),Z=(0,m.useRef)(),ee=(0,m.useMemo)(function(){var U;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:D,defaultValue:D==null||(U=D[0])===null||U===void 0?void 0:U.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(k()(v),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(N,w){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{}),onClick:function(){return S({userName:w.full_name,userId:w.id,groupId:w.final_grades.group_id})}})})})}}])},[D,v]);return(0,e.jsxs)(e.Fragment,{children:[(T==null?void 0:T.userId)&&(0,e.jsx)(re,{visible:!!T.userId,onClose:function(){return S(null)},user:{name:T.userName,userId:T.userId,groupId:T.groupId}}),(0,e.jsx)(he.ZP,{sticky:!0,className:"table-standalone",request:function(){var U=j()(p()().mark(function Y(N){var w,R,O,se,Ke,He,$e,Le,X,Fe,z,ue,Ee,Oe,J,ge,fe,Ce,ke,nt,mt;return p()().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return se=N.group_id,Ke=se===void 0?(w=D[0])===null||w===void 0?void 0:w.value:se,He=N.full_name,$e=He===void 0?"":He,Be.next=3,Ae(Ke);case 3:if(Le=Be.sent,X=D.find(function(it){var ut=it.value;return ut===Ke}),!(!Le.success||Le.data[0]===void 0||a===null)){Be.next=8;break}return xe.ZP.error(A.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 8:return Be.next=10,Promise.all([(0,Pe.X)(Ke),vt(Ke),W({group_id:Ke,per_page:-1}),De(a,(R=Le.data)===null||R===void 0||(R=R[0])===null||R===void 0?void 0:R.tutor_id),Et(),zt((O=Le.data)===null||O===void 0||(O=O[0])===null||O===void 0?void 0:O.s_subject_scale_form_id)]);case 10:if(Fe=Be.sent,z=P()(Fe,6),ue=z[0],Ee=z[1],Oe=z[2],J=z[3],ge=z[4],fe=z[5],!(!ue.success||!Ee.success||!Oe.success||!J.success||!ge.success||!fe.success||!X)){Be.next=21;break}return xe.ZP.error(A.formatMessage({id:"groupDataMissing"},{group_name:X==null?void 0:X.label})),Be.abrupt("return",{data:[],total:0,success:!1});case 21:return b(X.label),Ce=ja(Ee.data),ke=Sa(Oe.data),nt=_a(ge.data,fe.data),h([Ce,ke,nt,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),mt=ue.data.users.reduce(function(it,ut){var At,st,Mt,St=ut.id,Rr=ut.academic_teacher_id,Nr=ut.first_name,Or=ut.last_name,ca="".concat(Or," ").concat(Nr);if(Rr!==null||!ca.toLowerCase().includes($e.toLowerCase()))return it;var Ur=ba(Ee.data,St),ma=Jt(Oe.data,St),Ct=Ma(Le.data,St),kr=(At=qt((st=Ct==null?void 0:Ct.s_subject_scale_form_id)!==null&&st!==void 0?st:0,(Mt=J.data.grade_scale)!==null&&Mt!==void 0?Mt:[]))!==null&&At!==void 0?At:[],Br=Qt(ma,kr),Wr=ya(ma),Kr=Ca(Ct);return[].concat(k()(it),[c()(c()(c()(c()({id:St,full_name:ca},Ur),Wr),Kr),{},{proposed_grade:Br,final_grades:Ct})])},[]).sort(function(it,ut){return it.full_name.localeCompare(ut.full_name)}),Be.abrupt("return",{data:mt,total:mt.length,success:!0});case 28:case"end":return Be.stop()}},Y)}));return function(Y){return U.apply(this,arguments)}}(),columns:ee,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:M}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:Z,pagination:{defaultPageSize:ve.S,onChange:function(){var Y;return(Y=Z.current)===null||Y===void 0?void 0:Y.reload()}},rowKey:"id"})]})},ta=o(1413),Fa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ea=Fa,Pa=o(84089),aa=function(n,t){return m.createElement(Pa.Z,(0,ta.Z)((0,ta.Z)({},n),{},{ref:t,icon:Ea}))};aa.displayName="LineChartOutlined";var Za=m.forwardRef(aa),ra=o(82061),na=o(86738),wt=o(62235),ot=o(952),Ia=o(5966),wa=o(50335),sa=o(71230),ht=o(15746),Ga=o(56717),ia=o(95830),Da=o(29477),Aa=function(n){var t=n.type,r=n.onDataConverted,a=n.groupSelectDisabled,l=(0,ae.Z)(),d=l.semester_subject_id,v=l.teacherSubjectData,h=(0,m.useState)(null),C=P()(h,2),y=C[0],M=C[1],b=(0,m.useMemo)(function(){var T;return((T=v==null?void 0:v.groups)!==null&&T!==void 0?T:[]).map(function(S){var A=S.id,D=S.name;return{label:D,value:A}})},[]),f={type:t,group_id:y,semester_subject_id:d},x=(0,m.useCallback)(function(T){if(T.success){var S=T.data.results.filter(function(A){var D=A.user_id;return D!==null});if(!S.length)return;r({exam_results:S,group_id:T.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(It.default,{disabled:a,value:y,onChange:function(S){return M(S)},options:b,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Da.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:x,onChange:function(S){return!S.fileList.length&&r(void 0)},maxFiles:1,data:f,disabled:!y})]})},$a=function(n){var t=n.onDataConverted,r=(0,ae.Z)(),a=r.teacherSubjectData,l=r.groupUsers,d=(0,m.useState)(null),v=P()(d,2),h=v[0],C=v[1],y=(0,m.useMemo)(function(){var b;return((b=a==null?void 0:a.groups)!==null&&b!==void 0?b:[]).map(function(f){var x=f.id,T=f.name;return{label:T,value:x}})},[]),M=(0,m.useCallback)(function(b){var f;C(b);var x=(f=l.byId)===null||f===void 0?void 0:f[b];if(x){var T=x.users.reduce(function(S,A){var D=A.id,Z=A.email,ee=A.first_name,U=A.last_name,Y=A.academic_teacher_id;return Y!==null?S:[].concat(k()(S),[{email:Z,first_name:ee,last_name:U,user_id:D,result:0}])},[]);t({group_id:b,exam_results:T})}},[l.byId]);return(0,e.jsx)(It.default,{value:h,onChange:M,options:y,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Gt=u()(u()(u()(u()({},g.UL.TestPortal,["/teacher-examples/testPortal.png"]),g.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),g.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),g.UL.Manual,[]),La=function(n){var t=n.images,r=(0,m.useState)(!1),a=P()(r,2),l=a[0],d=a[1],v=(0,m.useCallback)(function(){return d(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(F.ZP,{onClick:v,icon:(0,e.jsx)(Ga.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:d},children:t.map(function(h){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:h},h)})})]})},Ra=function(n){var t,r=n.type,a=n.onOk,l=n.onCancel,d=n.okDisabled,v=(t=Gt==null?void 0:Gt[r])!==null&&t!==void 0?t:Gt[g.UL.Manual];return(0,e.jsxs)($.Z,{style:{width:"100%",justifyContent:v.length?"space-between":"flex-end"},children:[!!v.length&&(0,e.jsx)(La,{images:v}),(0,e.jsxs)($.Z,{children:[(0,e.jsx)(F.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(F.ZP,{type:"primary",disabled:d,onClick:a,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Na=[g.UL.TeamsLecture,g.UL.TestPortal,g.UL.TeamsForms],Oa=function(n){var t=n.open,r=n.closeModal,a=n.onSuccess,l=n.type,d=(0,ae.Z)(),v=d.teacherSubjectData,h=d.fetchGroupUsers,C=(0,m.useState)(),y=P()(C,2),M=y[0],b=y[1];return(0,m.useEffect)(function(){if(l===g.UL.Manual&&t){var f;v==null||(f=v.groups)===null||f===void 0||f.forEach(function(x){var T=x.id;return h(T)})}},[l,t]),(0,e.jsxs)(je.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:r,footer:(0,e.jsx)(Ra,{type:l,onOk:function(){M&&a(M)},onCancel:r,okDisabled:!M}),children:[Na.includes(l)&&(0,e.jsx)(Aa,{type:l,onDataConverted:b,groupSelectDisabled:!!M}),l===g.UL.Manual&&(0,e.jsx)($a,{onDataConverted:b})]})},Ua=function(n){var t=n.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){return t(g.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ka=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Ba=function(n){var t,r=n.exam_id,a=ot.ZP.useForm(),l=P()(a,1),d=l[0],v=(0,m.useState)(),h=P()(v,2),C=h[0],y=h[1],M=(0,m.useState)(),b=P()(M,2),f=b[0],x=b[1],T=(0,m.useState)(!1),S=P()(T,2),A=S[0],D=S[1],Z=(0,ae.Z)(),ee=Z.semester_subject_id,U=Z.getGroupById,Y=(0,m.useMemo)(function(){var w;return((w=f==null?void 0:f.exam_results)!==null&&w!==void 0?w:[]).map(function(R){var O=R.user_id;return O})},[f==null?void 0:f.exam_results]);(0,m.useEffect)(function(){var w=Number(r);r==="new"&&(y(void 0),x(void 0),d.resetFields()),r!=="new"&&!Number.isNaN(w)&&(D(!0),Tt(w).then(function(R){if(R.success){var O=R.data,se=O.type,Ke=O.results,He=O.title,$e=O.weight,Le=O.passed_at,X=O.group_id;y(se),x({group_id:X,exam_results:Ke}),d.setFieldsValue({title:He,weight:$e,passed_at:Le})}}).finally(function(){return D(!1)}))},[r]);var N=(0,m.useCallback)(function(){y(void 0),x(void 0)},[]);return A?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[C&&(0,e.jsx)(Oa,{open:!!(C&&!f),type:C,closeModal:N,onSuccess:x}),(0,e.jsxs)(ot.ZP,{form:d,submitter:C===void 0||!f?!1:void 0,onFinish:function(){var w=j()(p()().mark(function R(O){var se,Ke,He,$e,Le,X,Fe,z,ue,Ee;return p()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:if(Ke=f==null||(se=f.exam_results)===null||se===void 0?void 0:se.every(function(ge){var fe=ge.result;return typeof fe=="number"&&fe>=0&&fe<=100}),!(f&&Ke&&typeof ee=="number")){J.next=17;break}if(He=O.title,$e=O.passed_at,Le=O.weight,X=Number(r),Fe=f.exam_results,z=f.group_id,ue={type:C,semester_subject_id:ee,title:He,passed_at:$e,weight:Le,group_id:z,results:Fe},!Number.isNaN(X)){J.next=12;break}return J.next=9,te(ue);case 9:J.t0=J.sent,J.next=15;break;case 12:return J.next=14,Xe(X,ue);case 14:J.t0=J.sent;case 15:Ee=J.t0,Ee.success&&s.history.push("/teacher/subjects/".concat(ee,"/exams"));case 17:return J.abrupt("return",!0);case 18:case"end":return J.stop()}},R)}));return function(R){return w.apply(this,arguments)}}(),onReset:N,children:[(0,e.jsxs)(ot.ZP.Group,{children:[(0,e.jsx)(Ia.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(wa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),(0,e.jsx)(ot.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(ea.Z,{})})]}),C&&f&&(0,e.jsx)(he.ZP,{rowKey:"user_id",headerTitle:(t=U(f.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:Y,onValuesChange:function(R,O){return x({group_id:f.group_id,exam_results:O})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:f.exam_results,pagination:{defaultPageSize:ve.S},columns:ka}),!f&&(0,e.jsx)(Ua,{onSelect:y})]})]})},Wa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Ka=function(n){var t=n.exam_id,r=(0,m.useState)(""),a=P()(r,2),l=a[0],d=a[1];return(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:ve.S},request:j()(p()().mark(function v(){var h;return p()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,Tt(t);case 2:if(h=y.sent,!h.success){y.next=6;break}return d(h.data.title),y.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return y.abrupt("return",[]);case 7:case"end":return y.stop()}},v)})),columns:Wa})},Va=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&(0,qe.WU)(new Date(t.passed_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight+"%"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&(0,qe.WU)(new Date(t.created_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return(0,e.jsx)(wt.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],za=function(){var n,t,r=(0,m.useRef)(),a=(0,ae.Z)(),l=a.semester_subject_id,d=(0,s.useLocation)(),v=(0,m.useMemo)(function(){var y,M,b;return{exam_id:(y=(M=d.query)===null||M===void 0?void 0:M.exam_id)!==null&&y!==void 0?y:null,results:(b=d.query)===null||b===void 0?void 0:b.results}},[(n=d.query)===null||n===void 0?void 0:n.exam_id,(t=d.query)===null||t===void 0?void 0:t.results]),h=v.exam_id,C=v.results;return C!==null&&!Number.isNaN(Number(C))?(0,e.jsx)(Ka,{exam_id:Number(C)}):h!==null?(0,e.jsx)(Ba,{exam_id:h}):(0,e.jsx)(he.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",pagination:{defaultPageSize:ve.S},request:function(){var y=j()(p()().mark(function M(b,f){var x,T,S,A;return p()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(x=b.current,T=b.pageSize,l!==null){Z.next=3;break}return Z.abrupt("return",{data:[],total:0,success:!1});case 3:return S=f&&Object.entries(f)[0],Z.next=6,W({per_page:T,page:x,semester_subject_id:Number.isNaN(l)?void 0:l,order_by:S&&S[0],order:S&&(S[1]==="ascend"?"ASC":"DESC")});case 6:if(A=Z.sent,!A.success){Z.next=9;break}return Z.abrupt("return",{data:A.data,total:A.meta.total,success:!0});case 9:return Z.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return Z.stop()}},M)}));return function(M,b){return y.apply(this,arguments)}}(),columns:[].concat(Va,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(M,b){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(b.semester_subject_id,"/exams?exam_id=").concat(b.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(b.semester_subject_id,"/exams?results=").concat(b.id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(F.ZP,{icon:(0,e.jsx)(Za,{})})})},"results"),(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:j()(p()().mark(function f(){var x;return p()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Ft(b.id);case 2:x=S.sent,x.success&&r.current&&r.current.reload();case 4:case"end":return S.stop()}},f)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(ra.Z,{}),danger:!0})})},"delete")]}}])})},Xa=o(69753),ua=o(44167),Ha=o(84665),Ya=["type","defaultRender"],Ja=["type","defaultRender"],Qa=function(n){var t=n.url;return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(Xa.Z,{})})})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return(0,qe.WU)(new Date(t.created_at),Ie.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,d=Zt()(t,Ya);if(a==="form")return null;var v=r.getFieldValue("state");return(0,e.jsx)(ua.Z,c()(c()({},d),{},{state:{type:v}}))},render:function(n,t){var r,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(r=t.created_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.created_by)!==null&&a!==void 0&&a.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return(0,qe.WU)(new Date(t.exported_at),Ie.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,d=Zt()(t,Ja);if(a==="form")return null;var v=r.getFieldValue("state");return(0,e.jsx)(ua.Z,c()(c()({},d),{},{state:{type:v}}))},render:function(n,t){var r,a;return(0,e.jsx)(wt.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(r=t.exported_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.exported_by)!==null&&a!==void 0&&a.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(n,t){return[(0,e.jsx)(Qa,{url:t.url},"download")]}}],er=function(){var n,t=(0,ae.Z)(),r=t.teacherSubjectData,a=(0,m.useMemo)(function(){var d;return((d=r==null?void 0:r.groups)!==null&&d!==void 0?d:[]).map(function(v){var h=v.id,C=v.name;return{value:h,label:C}})},[r==null?void 0:r.groups]),l=(0,m.useMemo)(function(){var d;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:a,defaultValue:r==null||(d=r.groups)===null||d===void 0||(d=d[0])===null||d===void 0?void 0:d.id,allowClear:!1}}].concat(qa)},[r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.id,a]);return(0,e.jsx)(he.ZP,{className:"table-standalone",request:function(){var d=j()(p()().mark(function v(h){var C,y,M,b,f,x;return p()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return y=h.group_id,M=y===void 0?r==null||(C=r.groups)===null||C===void 0||(C=C[0])===null||C===void 0?void 0:C.id:y,b=h.created_by,f=h.exported_by,S.next=3,(0,Ha.v)({group_id:M,created_by:b,exported_by:f});case 3:if(x=S.sent,x.success){S.next=6;break}return S.abrupt("return",{success:!1,data:[],total:0});case 6:return S.abrupt("return",{success:!0,data:x.data,total:x.data.length});case 7:case"end":return S.stop()}},v)}));return function(v){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:ve.S}})},oa=o(64317),Ut=o(96074),la=o(11312),tr=o(87366),kt=o(99100),ar=["attendances"];function rr(i){return function(t){i(function(r){return c()(c()({},r),{},{loading:t})})}}function da(i,n){return Bt.apply(this,arguments)}function Bt(){return Bt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n(!0),a.prev=1,a.abrupt("return",t());case 3:return a.prev=3,n(!1),a.finish(3);case 6:case"end":return a.stop()}},i,null,[[1,,3,6]])})),Bt.apply(this,arguments)}function nr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useCallback)(rr(l),[]),v=(0,m.useCallback)(j()(p()().mark(function C(){var y;return p()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,dt(i,n);case 2:if(y=b.sent,y.success){b.next=5;break}return b.abrupt("return",y);case 5:return l(function(f){return c()(c()({},f),{},{data:y.data})}),b.abrupt("return",y);case 7:case"end":return b.stop()}},C)})),[n,i]),h=(0,m.useCallback)(function(C){return da(d,function(){return Yt(C).then(v)})},[v]);return(0,m.useEffect)(function(){da(d,v)},[v]),{finalGrades:a,deleteFinalGrade:h}}function sr(){var i=(0,m.useState)({loading:!1}),n=P()(i,2),t=n[0],r=n[1];return(0,m.useEffect)(function(){r(function(a){return c()(c()({},a),{},{loading:!0})}),Et().then(function(a){a.success&&r(function(l){return c()(c()({},l),{},{data:a.data})})}).finally(function(){r(function(a){return c()(c()({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function ir(i){var n=(0,m.useState)({loading:!1}),t=P()(n,2),r=t[0],a=t[1];return(0,m.useEffect)(function(){i!==void 0&&(a(function(l){return c()(c()({},l),{},{loading:!0})}),zt(i).then(function(l){l.success&&a(function(d){return c()(c()({},d),{},{data:l.data})})}).finally(function(){a(function(l){return c()(c()({},l),{},{loading:!1})})}))},[i]),{subjectGradeScales:r}}function ur(i,n,t){var r=(0,m.useState)({loading:!1}),a=P()(r,2),l=a[0],d=a[1];return(0,m.useEffect)(function(){typeof i!="number"||typeof n!="number"||typeof t!="number"||(d(function(v){return c()(c()({},v),{},{loading:!0})}),De(i,n).then(function(v){v.success&&d(function(h){var C,y;return c()(c()({},h),{},{data:(C=qt(t,(y=v.data.grade_scale)!==null&&y!==void 0?y:[]))===null||C===void 0?void 0:C.map(function(M,b){return c()(c()({},M),{},{id:b})})})})}).finally(function(){d(function(v){return c()(c()({},v),{},{loading:!1})})}))},[i,n]),{tutorGradeScales:l}}function or(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useCallback)(function(){l(function(v){return c()(c()({},v),{},{loading:!0})}),vt(i).then(function(v){if(v.success){var h=v.data.reduce(function(C,y){var M=y.attendances,b=Zt()(y,ar),f=M.find(function(x){return x.user_id===n});return f?[].concat(k()(C),[c()(c()({},b),{},{attendance:f})]):C},[]);l(function(C){return c()(c()({},C),{},{data:h})})}}).finally(function(){l(function(v){return c()(c()({},v),{},{loading:!1})})})},[i,n]);return(0,m.useEffect)(function(){d()},[d]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:d}}function lr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1];return(0,m.useEffect)(function(){n&&(l(function(d){return c()(c()({},d),{},{loading:!0})}),W({student_id:i,semester_subject_id:n}).then(function(d){if(d.success){var v=Jt(d.data,i);l(function(h){return c()(c()({},h),{},{data:v})})}}).finally(function(){l(function(d){return c()(c()({},d),{},{loading:!1})})}))},[i,n]),{studentExams:a}}function dr(i,n){var t=(0,m.useState)({loading:!1}),r=P()(t,2),a=r[0],l=r[1],d=(0,m.useState)({loading:!1}),v=P()(d,2),h=v[0],C=v[1],y=(0,m.useState)({loading:!1}),M=P()(y,2),b=M[0],f=M[1];return(0,m.useEffect)(function(){l(function(x){return c()(c()({},x),{},{loading:!0})}),(0,kt.N7)({group_id:i}).then(function(x){x.success&&l(function(T){return c()(c()({},T),{},{data:x.data})})}).finally(function(){l(function(x){return c()(c()({},x),{},{loading:!1})})})},[i]),(0,m.useEffect)(function(){a.data&&(f(function(x){return c()(c()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var T=x.id;return(0,kt.Nx)(Number(T))})).then(function(x){x.forEach(function(T){T.success&&f(function(S){return c()(c()({},S),{},{data:c()(c()({},S.data),{},u()({},Number(T.data.id),(0,tr.uS)(T.data.lessons)))})})})}).finally(function(){f(function(x){return c()(c()({},x),{},{loading:!1})})}),C(function(x){return c()(c()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var T=x.id;return(0,kt.ue)(Number(T),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(S){if(S.success){var A,D,Z=((A=S.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&A!==void 0?A:[]).filter(function(U){return U.id===n}),ee=(D=S.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&D!==void 0?D:[];C(function(U){return c()(c()({},U),{},{data:c()(c()({},U.data),{},u()({},Number(T),{finishedTopics:Z,attendanceList:ee}))})})}})})).finally(function(){return C(function(x){return c()(c()({},x),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:h,userCoursesTopics:b}}var cr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],mr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(n,t){return(0,qe.WU)(new Date(t.date_from),Ie.GC)}}],fr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return(0,qe.WU)(new Date(t.created_at),Ie.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result,"%")}}],vr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?(0,qe.WU)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),Ie.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],Dt=6,pr=function(n){var t,r,a,l,d=n.user_id,v=n.group_id,h=(0,ae.Z)(),C=h.semester_subject_id,y=lr(d,C),M=y.studentExams,b=nr(v,d),f=b.finalGrades,x=b.deleteFinalGrade,T=sr(),S=T.gradeTerms,A=ir((t=f.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),D=A.subjectGradeScales,Z=ur(C,(r=f.data)===null||r===void 0?void 0:r.tutor_id,(a=f.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),ee=Z.tutorGradeScales,U=or(v,d),Y=U.userAttendanceSchedules,N=U.fetchUserAttendanceSchedules,w=dr(v,d),R=w.userCourses,O=w.userCoursesStats,se=w.userCoursesTopics,Ke=ot.ZP.useForm(),He=P()(Ke,1),$e=He[0],Le=(0,m.useMemo)(function(){var ge;return((ge=S.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce=fe.id,ke=fe.name;return{label:ke,value:Ce}})},[S.data]),X=(0,m.useMemo)(function(){var ge;return((ge=D.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce=fe.name,ke=fe.id;return{label:Ce,value:ke}})},[D.data]),Fe=(0,m.useMemo)(function(){var ge,fe;return Qt((ge=M.data)!==null&&ge!==void 0?ge:[],(fe=ee.data)!==null&&fe!==void 0?fe:[])},[M.data,ee.data]),z=(0,m.useCallback)(function(){var ge=j()(p()().mark(function fe(Ce){var ke,nt,mt,ft,Be,it,ut;return p()().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(mt=Ce.grade_scale_id,ft=Ce.grade_term_id,((ke=f.data)===null||ke===void 0?void 0:ke.id)!==void 0){st.next=3;break}return st.abrupt("return");case 3:if(Be=(nt=f.data)===null||nt===void 0?void 0:nt.grades.find(function(Mt){var St=Mt.grade_term;return St.id===ft}),!Be){st.next=11;break}return st.next=7,Ht(Be.id,{grade_scale_id:mt});case 7:return it=st.sent,xe.ZP[it.success?"success":"error"](it.message),it.success&&s.history.push("/teacher/subjects/".concat(C,"/final-grades")),st.abrupt("return");case 11:return st.next=13,Xt({grade_scale_id:mt,grade_term_id:ft,lesson_group_user_id:f.data.id});case 13:ut=st.sent,xe.ZP[ut.success?"success":"error"](ut.message),ut.success&&s.history.push("/teacher/subjects/".concat(C,"/final-grades"));case 16:case"end":return st.stop()}},fe)}));return function(fe){return ge.apply(this,arguments)}}(),[f.data,C]),ue=(0,m.useMemo)(function(){return[].concat(vr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(fe,Ce){var ke;return typeof(Ce==null||(ke=Ce.grade)===null||ke===void 0?void 0:ke.id)=="number"?[(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return x(Ce.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(ra.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),Ee=(0,m.useMemo)(function(){var ge;return((ge=S.data)!==null&&ge!==void 0?ge:[]).map(function(fe){var Ce;return c()(c()({},fe),{},{grade:(Ce=f.data)===null||Ce===void 0?void 0:Ce.grades.find(function(ke){var nt=ke.grade_term;return nt.id===fe.id})})})},[f.data,S.data]),Oe=R.loading&&!R.data||O.loading&&!O.data||se.loading&&!se.data,J=!!(R.data&&O.data&&se.data);return f.loading?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[f.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:f.data.user})}),(0,e.jsx)(Ut.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:M.data,loading:M.loading,columns:fr,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Dt},dataSource:Ee,loading:f.loading||S.loading,columns:ue,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:Y.data,loading:Y.loading,columns:[].concat(mr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(fe,Ce){return(0,e.jsx)(rt,{groupAttendanceScheduleId:Ce.id,studentId:d,attendance:Ce.attendance.value,onSuccess:N})}}])})}),(0,e.jsx)(ht.Z,{span:12,children:(0,e.jsx)(he.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Dt},cardProps:{bodyStyle:{padding:0}},dataSource:ee.data,loading:ee.loading,columns:cr})}),Oe&&(0,e.jsx)(Re.Z,{}),J&&((l=R.data)===null||l===void 0?void 0:l.map(function(ge){var fe,Ce,ke,nt,mt,ft,Be=ge.id,it=ge.title;return(0,e.jsxs)(ht.Z,{span:24,children:[(0,e.jsx)(Q.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:it}),(0,e.jsx)(la.Du,{course_id:Number(Be),topics:(fe=(Ce=se.data)===null||Ce===void 0?void 0:Ce[Number(Be)])!==null&&fe!==void 0?fe:[],stats:(ke=(nt=O.data)===null||nt===void 0||(nt=nt[Number(Be)])===null||nt===void 0?void 0:nt.finishedTopics)!==null&&ke!==void 0?ke:[]}),(0,e.jsx)(la.nu,{stats:(mt=(ft=O.data)===null||ft===void 0||(ft=ft[Number(Be)])===null||ft===void 0?void 0:ft.attendanceList)!==null&&mt!==void 0?mt:[]})]},Be)}))]}),(0,e.jsx)(ot.ZP,{form:$e,onFinish:z,children:(0,e.jsxs)(ot.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(oa.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:Le,width:"sm",fieldProps:{loading:S.loading}}),(0,e.jsx)(oa.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:X,fieldProps:{loading:f.loading||D.loading}}),(0,e.jsx)(ot.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Fe}})})]})})]})},gr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,l=r.grade_term,d=r.id;return(0,e.jsxs)(Q.Z.Text,{children:[l.name,": ",a]},d)}):"-"})}}],hr=function(){var n,t,r=(0,s.useLocation)(),a=(0,m.useMemo)(function(){var M,b,f,x;return{user_id:Number.isNaN(Number((M=r.query)===null||M===void 0?void 0:M.user_id))?null:Number((b=r.query)===null||b===void 0?void 0:b.user_id),group_id:Number.isNaN(Number((f=r.query)===null||f===void 0?void 0:f.group_id))?null:Number((x=r.query)===null||x===void 0?void 0:x.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(t=r.query)===null||t===void 0?void 0:t.group_id]),l=a.user_id,d=a.group_id,v=(0,ae.Z)(),h=v.teacherSubjectData,C=v.semester_subject_id,y=(0,m.useMemo)(function(){var M;return((M=h==null?void 0:h.groups)!==null&&M!==void 0?M:[]).map(function(b){var f=b.id,x=b.name;return{label:x,value:f}})},[h==null?void 0:h.groups]);return l!==null&&d!==null?(0,e.jsx)(pr,{user_id:l,group_id:d}):(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:ve.S},request:function(){var M=j()(p()().mark(function b(f){var x,T,S,A,D,Z,ee,U,Y,N;return p()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return T=f.group_id,S=T===void 0?[]:T,A=f.first_name,D=A===void 0?"":A,Z=f.last_name,ee=Z===void 0?"":Z,U=((x=h==null?void 0:h.groups)!==null&&x!==void 0?x:[]).map(function(O){var se=O.id;return se}),R.next=4,Ae(S.length===0?U:S);case 4:if(Y=R.sent,Y.success){R.next=7;break}return R.abrupt("return",{success:!1,total:0,data:[]});case 7:return N=Y.data.filter(function(O){var se=O.user;return se.first_name.toLowerCase().includes(D.toLowerCase())&&se.last_name.toLowerCase().includes(ee.toLowerCase())}),R.abrupt("return",{success:!0,total:N.length,data:N});case 9:case"end":return R.stop()}},b)}));return function(b){return M.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:y,mode:"multiple"},render:function(b,f){return(0,e.jsx)(wt.Z,{type:"Students",type_id:f.group_id},f.group_id)}}].concat(gr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(b,f){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(C,"/final-grades?user_id=").concat(f.user.id,"&group_id=").concat(f.group_id),children:(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(Pt.Z,{})})})},"edit")]}}])})},xr=o(88284),jr=o(88280),br=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Sr=function(n){var t=n.subjectTutorGradeScale,r=n.onFormSubmit,a=(0,m.useState)([]),l=P()(a,2),d=l[0],v=l[1],h=(0,m.useRef)(),C=ot.ZP.useForm(),y=P()(C,1),M=y[0];return(0,m.useEffect)(function(){var b,f=((b=t.scale)!==null&&b!==void 0?b:[]).map(function(x,T){return c()(c()({},x),{},{id:String((T+1)*100)})});M.setFieldValue("table",f)},[]),(0,e.jsx)(ot.ZP,{form:M,onFinish:r,submitter:{render:function(f,x){var T=P()(x,2),S=T[1];return[S]}},children:(0,e.jsx)(jr.Z,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(br,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(f,x){return(0,e.jsx)(F.ZP,{type:"primary",onClick:function(){var S;return(S=h.current)===null||S===void 0?void 0:S.startEditable(x.id)},icon:(0,e.jsx)(Pt.Z,{})})}}]),editable:{form:M,type:"multiple",editableKeys:d,saveText:(0,e.jsx)(F.ZP,{type:"primary",icon:(0,e.jsx)(xr.Z,{})}),onChange:v,actionRender:function(f,x,T){return[T.save]}}})})},yr=function(){var n,t,r=(0,s.useModel)("@@initialState"),a=r.initialState,l=(0,ae.Z)(),d=l.semester_subject_id,v=l.tutors,h=(0,m.useState)(),C=P()(h,2),y=C[0],M=C[1],b=(0,m.useState)(!1),f=P()(b,2),x=f[0],T=f[1],S=(0,m.useState)(null),A=P()(S,2),D=A[0],Z=A[1],ee=(0,m.useMemo)(function(){return!!v.data.find(function(w){var R,O=w.id;return O===(a==null||(R=a.currentUser)===null||R===void 0?void 0:R.id)})},[v.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),U=(0,m.useMemo)(function(){return v.data.map(function(w){var R=w.id,O=w.first_name,se=w.last_name;return{label:"".concat(O," ").concat(se),value:R}})},[v.data]),Y=(0,m.useCallback)(function(){d===null||D===null||(T(!0),M(void 0),De(d,D).then(function(w){w.success&&M(w.data)}).finally(function(){T(!1)}))},[d,D]),N=(0,m.useCallback)(function(w,R){return function(){var O=j()(p()().mark(function se(Ke){var He,$e;return p()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!(d===null||D===null)){X.next=2;break}return X.abrupt("return");case 2:return He=w.reduce(function(Fe,z){return z.s_subject_scale_form_id===R?[].concat(k()(Fe),[{s_subject_scale_form_id:R,scale:Ke.table.map(function(ue){var Ee=ue.name,Oe=ue.grade,J=ue.grade_value;return{name:Ee,grade:Oe,grade_value:J}})}]):[].concat(k()(Fe),[z])},[]),X.next=5,be(d,D,{grade_scale:He});case 5:$e=X.sent,$e.success&&Y();case 7:case"end":return X.stop()}},se)}));return function(se){return O.apply(this,arguments)}}()},[D,d]);return(0,m.useEffect)(function(){var w,R;if(!ee||!(a!=null&&(w=a.currentUser)!==null&&w!==void 0&&w.id)){var O;if((O=v.data)!==null&&O!==void 0&&O[0]){var se;Z((se=v.data)===null||se===void 0?void 0:se[0].id)}return}Z(a==null||(R=a.currentUser)===null||R===void 0?void 0:R.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,ee]),(0,m.useEffect)(function(){Y()},[Y]),v.loading?(0,e.jsx)(Re.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(It.default,{disabled:ee,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:U,value:D,onChange:function(R){return Z(R)}})}),(0,e.jsx)(Ut.Z,{}),x&&!y&&(0,e.jsx)(Re.Z,{}),y!=null&&y.grade_scale?y.grade_scale.map(function(w,R){var O;return(0,e.jsxs)(m.Fragment,{children:[R>0&&(0,e.jsx)(Ut.Z,{}),(0,e.jsx)(Sr,{subjectTutorGradeScale:w,onFormSubmit:N((O=y.grade_scale)!==null&&O!==void 0?O:[],w.s_subject_scale_form_id)})]},w.s_subject_scale_form_id)}):(0,e.jsx)(Q.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},_r=o(30814),Mr=o(40411),Cr=o(31156),Tr=o(27484),ct=o.n(Tr);function Fr(i,n){return Wt.apply(this,arguments)}function Wt(){return Wt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules",c()({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},i)})),Wt.apply(this,arguments)}var Er=function(){var n=(0,m.useState)(null),t=P()(n,2),r=t[0],a=t[1],l=(0,m.useState)([]),d=P()(l,2),v=d[0],h=d[1],C=(0,ae.Z)(),y=C.semester_subject_id,M=ct()(),b=(0,m.useMemo)(function(){return v.map(function(Z){return{id:Z.id,title:"".concat(Z.group.name," (").concat(Z.term_status.name,")"),start:ct()(Z.date_from).toDate(),end:ct()(Z.date_to).toDate(),tutor_name:"".concat(Z.tutor.first_name," ").concat(Z.tutor.last_name),tutor_email:Z.tutor.email,semester:Z.semester.name,group:Z.group.name,subject:Z.subject.name,ms_teams_join_url:Z.ms_teams_join_url}})},[v]),f=(0,m.useCallback)(function(Z,ee){Fr({semester_subject_id:y,date_form:Z.toDate(),date_to:ee.toDate()}).then(function(U){U.success&&h(U.data)})},[y]),x=(0,m.useCallback)(function(Z){a(Z)},[]),T=(0,m.useCallback)(function(){a(null)},[]),S=(0,m.useCallback)(function(Z){return Z.isSame(M,"day")?"warning":Z.isAfter(M,"day")?"success":"error"},[]),A=(0,m.useCallback)(function(Z){var ee=b.filter(function(U){return ct()(U.start).isSame(Z,"day")});return(0,e.jsx)("ul",{className:"events",children:ee.map(function(U){return(0,e.jsx)("li",{onClick:function(){return x(U)},children:(0,e.jsx)(Mr.Z,{status:S(ct()(U.start)),text:U.title})},U.id)})})},[v]),D=(0,m.useCallback)(function(Z,ee){var U=ct()(Z).startOf(ee).subtract(1,"month"),Y=ct()(Z).endOf(ee).add(1,"month");f(U,Y)},[]);return(0,m.useEffect)(function(){var Z=ct()().startOf("month"),ee=ct()().endOf("month");f(Z,ee)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Q.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(Cr.Z,{dateCellRender:A,onPanelChange:D}),(0,e.jsxs)(je.Z,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:T,footer:null,children:[(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",r&&ct()(r.start).format(Ie.E)]}),(0,e.jsxs)(Q.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",r&&ct()(r.end).format(Ie.E)]}),(r==null?void 0:r.ms_teams_join_url)&&(0,e.jsx)(Q.Z.Paragraph,{children:(0,e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(F.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},Pr=o(58638);function Zr(i,n){return Kt.apply(this,arguments)}function Kt(){return Kt=j()(p()().mark(function i(n,t){return p()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",c()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},i)})),Kt.apply(this,arguments)}var Ir=function(n){var t=n.student_id,r=(0,m.useState)(!1),a=P()(r,2),l=a[0],d=a[1],v=(0,m.useCallback)(j()(p()().mark(function h(){var C;return p()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return d(!0),M.next=3,Zr({user_id:t});case 3:if(C=M.sent,C.success){M.next=8;break}return xe.ZP.error(C.message),d(!1),M.abrupt("return");case 8:window.open(C.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return M.stop()}},h)})),[]);return(0,e.jsx)(B.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(F.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(Pr.Z,{}),onClick:v})})},wr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Gr=function(n){return n.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},Dr=function(n){return n.reduce(function(t,r){var a,l=r==null||(a=r.users)===null||a===void 0?void 0:a.reduce(function(d,v){return v.academic_teacher_id!==null?d:[].concat(k()(d),[{group_id:r.id,group_name:r.name,user_id:v.id,first_name:v.first_name,last_name:v.last_name,email:v.email}])},[]);return[].concat(k()(t),k()(l))},[])},Ar=function(){var n=(0,ae.Z)(),t=n.teacherSubjectData,r=(0,m.useMemo)(function(){var a;return Gr((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(he.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:ve.S},request:function(){var a=j()(p()().mark(function l(d){var v,h,C,y,M,b,f,x,T;return p()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return v=d.groups,h=d.first_name,C=h===void 0?"":h,y=d.last_name,M=y===void 0?"":y,b=d.email,f=b===void 0?"":b,A.next=3,(0,Pe.Z)({parent_id:t==null?void 0:t.group_id,"id[]":v});case 3:if(x=A.sent,x.success){A.next=6;break}return A.abrupt("return",{data:[],total:0,success:!1});case 6:return T=Dr(x.data).filter(function(D){return D.first_name.toLowerCase().includes(C.toLowerCase())&&D.last_name.toLowerCase().includes(M.toLowerCase())&&D.email.toLowerCase().includes(f.toLowerCase())}),A.abrupt("return",{data:T,total:T.length,success:!0});case 8:case"end":return A.stop()}},l)}));return function(l){return a.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(wr,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,d){return[(0,e.jsx)(Ir,{student_id:d.user_id},"teamsChat")]}}])})},$r=function(n){var t,r,a=n.tab,l=(0,s.useIntl)(),d=(0,s.useModel)("@@initialState"),v=d.setInitialState,h=d.initialState,C=(0,ae.Z)(),y=C.teacherSubjectData,M=C.semester_subject_id,b=C.tutors,f=(0,m.useCallback)((0,ze.X)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),x=(0,m.useMemo)(function(){return!!b.data.find(function(T){var S,A=T.id;return A===(h==null||(S=h.currentUser)===null||S===void 0?void 0:S.id)})||f(Ve.Z.TeacherListGradeScale)},[]);return y?(0,e.jsx)(I._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:y==null||(t=y.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:a})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(M,"/exams?exam_id=new"),children:(0,e.jsx)(F.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(M),breadcrumbName:String((r=y.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:l.formatMessage({id:a,defaultMessage:String(a)})}]}},children:(0,e.jsxs)(Te.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(S){v(c()({},h)),s.history.push("/teacher/subjects/".concat(M,"/").concat(S))}},children:[(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(_r.F,{})},"groups"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(Ar,{})},"students"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(za,{})},"exams"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Er,{})},"schedule"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(Ta,{})},"class-register"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),children:(0,e.jsx)(Ze,{})},"attendance"),x&&(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(yr,{})},"grades-scale"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(hr,{})},"final-grades"),(0,e.jsx)(Te.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(er,{})},"file-exports-history")]})}):(0,e.jsx)(Re.Z,{})},Lr=function(){var i=(0,s.useParams)(),n=i.subjectId,t=i.tab,r=t===void 0?"groups":t;return(0,e.jsx)(ae.p,{semester_subject_id:Number(n),children:(0,e.jsx)($r,{tab:r})})}},76841:function(jt,at,o){o.d(at,{Gm:function(){return s},Sx:function(){return p},_g:function(){return ze}});var Qe=o(15009),c=o.n(Qe),Te=o(97857),I=o.n(Te),Re=o(99289),F=o.n(Re),m=o(80854);function s(u,_){return Ve.apply(this,arguments)}function Ve(){return Ve=F()(c()().mark(function u(_,j){return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",(0,m.request)("/api/admin/reports/report",I()({params:_,method:"GET",useCache:!1},j||{})));case 1:case"end":return k.stop()}},u)})),Ve.apply(this,arguments)}function ze(u,_,j){return ce.apply(this,arguments)}function ce(){return ce=F()(c()().mark(function u(_,j,ie){return c()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",(0,m.request)("/api/admin/stats/course/".concat(_,"/export"),I()({params:j,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return ye.stop()}},u)})),ce.apply(this,arguments)}function p(u,_,j){return E.apply(this,arguments)}function E(){return E=F()(c()().mark(function u(_,j,ie){return c()().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return ye.abrupt("return",(0,m.request)("/api/admin/stats/topic/".concat(_,"/export"),I()({method:"GET",useCache:!1,params:{stat:j},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ie||{})));case 1:case"end":return ye.stop()}},u)})),E.apply(this,arguments)}},70804:function(jt,at,o){var Qe=o(67294);var c=function(ce,p){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,u){E.__proto__=u}||function(E,u){for(var _ in u)u.hasOwnProperty(_)&&(E[_]=u[_])})(ce,p)},Te,I,Re=(function(ce){(function(){var p={}.hasOwnProperty;function E(){for(var u=[],_=0;_<arguments.length;_++){var j=arguments[_];if(j){var ie=typeof j;if(ie==="string"||ie==="number")u.push(j);else if(Array.isArray(j)&&j.length){var k=E.apply(null,j);k&&u.push(k)}else if(ie==="object")for(var ye in j)p.call(j,ye)&&j[ye]&&u.push(ye)}}return u.join(" ")}ce.exports?(E.default=E,ce.exports=E):window.classNames=E})()}(I={path:Te,exports:{},require:function(ce,p){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(p==null&&I.path)}},I.exports),I.exports);function F(ce,p,E){var u,_,j,ie,k;function ye(){var he=Date.now()-ie;he<p&&he>=0?u=setTimeout(ye,p-he):(u=null,E||(k=ce.apply(j,_),j=_=null))}p==null&&(p=100);var P=function(){j=this,_=arguments,ie=Date.now();var he=E&&!u;return u||(u=setTimeout(ye,p)),he&&(k=ce.apply(j,_),j=_=null),k};return P.clear=function(){u&&(clearTimeout(u),u=null)},P.flush=function(){u&&(k=ce.apply(j,_),j=_=null,clearTimeout(u),u=null)},P}F.debounce=F;var m=F;(function(ce,p){p===void 0&&(p={});var E=p.insertAt;if(ce&&typeof document!="undefined"){var u=document.head||document.getElementsByTagName("head")[0],_=document.createElement("style");_.type="text/css",E==="top"&&u.firstChild?u.insertBefore(_,u.firstChild):u.appendChild(_),_.styleSheet?_.styleSheet.cssText=ce:_.appendChild(document.createTextNode(ce))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var s,Ve=(s="indiana-scroll-container",function(ce,p){if(!ce)return s;var E;typeof ce=="string"?E=ce:p=ce;var u=s;return E&&(u+="__"+E),u+(p?Object.keys(p).reduce(function(_,j){var ie=p[j];return ie&&(_+=" "+(typeof ie=="boolean"?u+"--"+j:u+"--"+j+"_"+ie)),_},""):"")}),ze=function(ce){function p(E){var u=ce.call(this,E)||this;return u.onEndScroll=function(){u.scrolling=!1,!u.pressed&&u.started&&u.processEnd()},u.onScroll=function(_){var j=u.container.current;j.scrollLeft===u.scrollLeft&&j.scrollTop===u.scrollTop||(u.scrolling=!0,u.processScroll(_),u.onEndScroll())},u.onTouchStart=function(_){var j=u.props.nativeMobileScroll;if(u.isDraggable(_.target))if(u.internal=!0,j&&u.scrolling)u.pressed=!0;else{var ie=_.touches[0];u.processClick(_,ie.clientX,ie.clientY),!j&&u.props.stopPropagation&&_.stopPropagation()}},u.onTouchEnd=function(_){var j=u.props.nativeMobileScroll;u.pressed&&(!u.started||u.scrolling&&j?u.pressed=!1:u.processEnd(),u.forceUpdate())},u.onTouchMove=function(_){var j=u.props.nativeMobileScroll;if(u.pressed&&(!j||!u.isMobile)){var ie=_.touches[0];ie&&u.processMove(_,ie.clientX,ie.clientY),_.preventDefault(),u.props.stopPropagation&&_.stopPropagation()}},u.onMouseDown=function(_){u.isDraggable(_.target)&&u.isScrollable()&&(u.internal=!0,u.props.buttons.indexOf(_.button)!==-1&&(u.processClick(_,_.clientX,_.clientY),_.preventDefault(),u.props.stopPropagation&&_.stopPropagation()))},u.onMouseMove=function(_){u.pressed&&(u.processMove(_,_.clientX,_.clientY),_.preventDefault(),u.props.stopPropagation&&_.stopPropagation())},u.onMouseUp=function(_){u.pressed&&(u.started?u.processEnd():(u.internal=!1,u.pressed=!1,u.forceUpdate(),u.props.onClick&&u.props.onClick(_)),_.preventDefault(),u.props.stopPropagation&&_.stopPropagation())},u.container=Qe.createRef(),u.onEndScroll=m(u.onEndScroll,300),u.scrolling=!1,u.started=!1,u.pressed=!1,u.internal=!1,u.getRef=u.getRef.bind(u),u}return function(E,u){function _(){this.constructor=E}c(E,u),E.prototype=u===null?Object.create(u):(_.prototype=u.prototype,new _)}(p,ce),p.prototype.componentDidMount=function(){var E=this.props.nativeMobileScroll,u=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),u.addEventListener("touchstart",this.onTouchStart,{passive:!1}),u.addEventListener("mousedown",this.onMouseDown,{passive:!1}),E&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},p.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},p.prototype.getElement=function(){return this.container.current},p.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},p.prototype.isDraggable=function(E){var u=this.props.ignoreElements;if(u){var _=E.closest(u);return _===null||_.contains(this.getElement())}return!0},p.prototype.isScrollable=function(){var E=this.container.current;return E&&(E.scrollWidth>E.clientWidth||E.scrollHeight>E.clientHeight)},p.prototype.processClick=function(E,u,_){var j=this.container.current;this.scrollLeft=j.scrollLeft,this.scrollTop=j.scrollTop,this.clientX=u,this.clientY=_,this.pressed=!0},p.prototype.processStart=function(E){E===void 0&&(E=!0);var u=this.props.onStartScroll;this.started=!0,E&&document.body.classList.add("indiana-dragging"),u&&u({external:!this.internal}),this.forceUpdate()},p.prototype.processScroll=function(E){if(this.started){var u=this.props.onScroll;u&&u({external:!this.internal})}else this.processStart(!1)},p.prototype.processMove=function(E,u,_){var j=this.props,ie=j.horizontal,k=j.vertical,ye=j.activationDistance,P=j.onScroll,he=this.container.current;this.started?(ie&&(he.scrollLeft-=u-this.clientX),k&&(he.scrollTop-=_-this.clientY),P&&P({external:!this.internal}),this.clientX=u,this.clientY=_,this.scrollLeft=he.scrollLeft,this.scrollTop=he.scrollTop):(ie&&Math.abs(u-this.clientX)>ye||k&&Math.abs(_-this.clientY)>ye)&&(this.clientX=u,this.clientY=_,this.processStart())},p.prototype.processEnd=function(){var E=this.props.onEndScroll;this.container.current&&E&&E({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},p.prototype.getRef=function(E){[this.container,this.props.innerRef].forEach(function(u){u&&(typeof u=="function"?u(E):u.current=E)})},p.prototype.render=function(){var E=this.props,u=E.children,_=E.draggingClassName,j=E.className,ie=E.style,k=E.hideScrollbars,ye=E.component;return Qe.createElement(ye,{className:Re(j,this.pressed&&_,Ve({dragging:this.pressed,"hide-scrollbars":k,"native-scroll":this.isMobile})),style:ie,ref:this.getRef,onScroll:this.onScroll},u)},p.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},p}(Qe.PureComponent);at.Z=ze}}]);
