(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"/y+f":function(ut,ue,c){"use strict";c.d(ue,"h",function(){return o}),c.d(ue,"e",function(){return M}),c.d(ue,"f",function(){return se}),c.d(ue,"d",function(){return qe}),c.d(ue,"a",function(){return s}),c.d(ue,"c",function(){return Ne}),c.d(ue,"b",function(){return q}),c.d(ue,"g",function(){return te});var o;(function(C){C.Unselected="",C.RichText="EscolaLms\\TopicTypes\\Models\\TopicContent\\RichText",C.OEmbed="EscolaLms\\TopicTypes\\Models\\TopicContent\\OEmbed",C.Audio="EscolaLms\\TopicTypes\\Models\\TopicContent\\Audio",C.Video="EscolaLms\\TopicTypes\\Models\\TopicContent\\Video",C.H5P="EscolaLms\\TopicTypes\\Models\\TopicContent\\H5P",C.Image="EscolaLms\\TopicTypes\\Models\\TopicContent\\Image",C.PDF="EscolaLms\\TopicTypes\\Models\\TopicContent\\PDF",C.SCORM="EscolaLms\\TopicTypes\\Models\\TopicContent\\ScormSco",C.Project="EscolaLms\\TopicTypeProject\\Models\\Project",C.GiftQuiz="EscolaLms\\TopicTypeGift\\Models\\GiftQuiz"})(o||(o={}));var Oe;(function(C){C.OrderPaid="EscolaLms\\Cart\\Events\\OrderPaid",C.UserLogged="EscolaLms\\Auth\\Events\\UserLogged"})(Oe||(Oe={}));var ne;(function(C){C.draft="draft",C.published="published",C.archived="archived"})(ne||(ne={}));var M;(function(C){C.email="EscolaLms\\TemplatesEmail\\Core\\EmailChannel",C.pdf="EscolaLms\\TemplatesPdf\\Core\\PdfChannel",C.sms="EscolaLms\\TemplatesSms\\Core\\SmsChannel"})(M||(M={}));var se;(function(C){C.ManuallyTriggeredEvent="EscolaLms\\Templates\\Events\\ManuallyTriggeredEvent"})(se||(se={}));var j;(function(C){C.cart_fixed="cart_fixed",C.cart_percent="cart_percent",C.product_fixed="product_fixed",C.product_percent="product_percent"})(j||(j={}));var qe;(function(C){C.MULTIPLE_CHOICE="multiple_choice",C.MULTIPLE_CHOICE_WITH_MULTIPLE_RIGHT_ANSWERS="multiple_choice_with_multiple_right_answers",C.TRUE_FALSE="true_false",C.SHORT_ANSWERS="short_answers",C.MATCHING="matching",C.NUMERICAL_QUESTION="numerical_question",C.ESSAY="essay",C.DESCRIPTION="description"})(qe||(qe={}));var s;(function(C){C.PRESENT="present",C.PRESENT_NOT_EXERCISING="present_not_exercising",C.ABSENT="absent",C.EXCUSED_ABSENCE="excused_absence"})(s||(s={}));var Ne;(function(C){C.Manual="manual",C.TeamsForms="teams_forms",C.TeamsLecture="teams_lecture",C.TestPortal="test_portal"})(Ne||(Ne={}));var q;(function(C){C.Simple="simple",C.Complex="complex"})(q||(q={}));var te;(function(C){C.QuizSummary="EscolaLms\\Reports\\Stats\\Topic\\QuizSummaryForTopicTypeGIFT"})(te||(te={}))},"5R/X":function(ut,ue,c){},"5Syx":function(ut,ue,c){"use strict";c.d(ue,"c",function(){return ye}),c.d(ue,"b",function(){return at}),c.d(ue,"a",function(){return et});var o=c("OaEy"),Oe=c("2fM7"),ne=c("g9YV"),M=c("wCAj"),se=c("14J3"),j=c("BMrR"),qe=c("BoS7"),s=c("Sdc0"),Ne=c("jrin"),q=c("k1fw"),te=c("DYRE"),C=c("zeV3"),Ye=c("+BJd"),Ee=c("mr32"),k=c("oBTY"),xe=c("tJVT"),Pe=c("q1tI"),ct=c.n(Pe),jt=c("nhC9"),We=c("LDJE"),S=c("9kvl"),V=c("nz6D"),De=c("Vpfc"),nt=c("+L6B"),it=c("2/Rp"),ce=c("qLMh"),H=c("9og8"),N=c("4KAj"),F=c("w/VK"),x=c("nKUr"),Se=function(Ge){var Te=Ge.course_id,$e=Ge.stat,Ie=$e===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":$e,ie=Object(Pe.useState)(!1),de=Object(xe.a)(ie,2),le=de[0],He=de[1],Ve=Object(Pe.useCallback)(function(D){return Object(H.a)(Object(ce.a)().mark(function Ce(){var me,ve;return Object(ce.a)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return He(!0),G.prev=1,G.next=4,Object(F.a)(D,{stat:Ie});case 4:me=G.sent,me instanceof Blob&&(ve=document.createElement("a"),ve.href=window.URL.createObjectURL(me),ve.download="finished_topics_".concat(Te,".xlsx"),document.body.appendChild(ve),ve.click(),document.body.removeChild(ve)),G.next=11;break;case 8:G.prev=8,G.t0=G.catch(1),console.error(G.t0);case 11:return G.prev=11,He(!1),G.finish(11);case 14:case"end":return G.stop()}},Ce,null,[[1,8,11,14]])}))},[Ie]);return Object(x.jsxs)(it.a,{type:"primary",loading:le,onClick:Ve(Te),children:[Object(x.jsx)(N.a,{})," ",Object(x.jsx)(S.a,{id:"export"})]})},X=function(Ge){return Ge.topicable.content.contents?Object.values(Ge.topicable.content.contents)[0].library:"H5P"},ye=function(Ge){var Te=Ge.course_id,$e=Ge.topics,Ie=Ge.stats,ie=Object(Pe.useState)(!1),de=Object(xe.a)(ie,2),le=de[0],He=de[1],Ve=Object(Pe.useMemo)(function(){return[{title:Object(x.jsx)(S.a,{id:"user"}),dataIndex:"id",render:function(me){return Object(x.jsx)(De.a,{type:"App\\Models\\User",type_id:me})}},{title:Object(x.jsx)(S.a,{id:"email"}),dataIndex:"email"}].concat(Object(k.a)($e.map(function(Ce){var me,ve=(me=Ce.topicable_type)===null||me===void 0?void 0:me.split("\\").pop();return ve==="H5P"&&(ve=X(Ce)),{render:function(G){var Le=0,Xe=0;switch(G&&(G.started_at&&G.finished_at?Le=1:G.started_at&&(Le=2),Xe=G.seconds/60),Le){case 1:return Object(x.jsxs)(C.b,{children:[Object(x.jsx)(Ee.a,{color:"success",children:"F"}),le&&Object(x.jsxs)("small",{children:[Xe.toFixed(2),"m"]})]});case 2:return Object(x.jsxs)(C.b,{children:[Object(x.jsx)(Ee.a,{color:"blue",children:"S"}),le&&Object(x.jsxs)("small",{children:[Xe.toFixed(2),"m"]})]});case 0:default:return Object(x.jsx)(ct.a.Fragment,{children:Object(x.jsx)(Ee.a,{color:"error",children:"N"})})}},title:Object(x.jsxs)("small",{children:[Object(x.jsx)(Ee.a,{children:ve})," ",Ce.title]}),dataIndex:Ce.id}})))},[$e,le]),D=Object(Pe.useMemo)(function(){return Ie.map(function(Ce){return $e.reduce(function(me,ve){var w=Ce.topics.find(function(G){return G.id===ve.id});return Object(q.a)(Object(q.a)({},me),{},Object(Ne.a)({},Number(ve.id),w!=null?w:0))},{email:Ce.email,id:Ce.id})})},[Ie,$e]);return Object(x.jsx)(M.a,{title:function(){return Object(x.jsxs)(j.a,{justify:"space-between",align:"middle",children:[Object(x.jsxs)(C.b,{children:[Object(x.jsx)(S.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(x.jsx)(Ee.a,{color:"success",children:"F"}),Object(x.jsx)(S.a,{id:"Started",defaultMessage:"Started:"})," ",Object(x.jsx)(Ee.a,{color:"blue",children:"S"}),Object(x.jsx)(S.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(x.jsx)(Ee.a,{color:"error",children:"N"}),Object(x.jsx)(S.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(x.jsx)(s.a,{checked:le,onChange:function(ve){return He(ve)}})]}),Object(x.jsx)(Se,{course_id:Te})]})},columns:Ve,dataSource:D,size:"small",scroll:{x:1500},components:{table:function(me){return Object(x.jsx)(V.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(x.jsx)("table",Object(q.a)({},me))})}}})},at=function(Ge){var Te=Ge.stats,$e=Object(Pe.useMemo)(function(){return[{title:"user",dataIndex:"id",render:function(de){return Object(x.jsx)(De.a,{type:"App\\Models\\User",type_id:de})}},{title:"email",dataIndex:"email"},{title:Object(x.jsx)(S.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),Ie=Object(Pe.useMemo)(function(){return Te.map(function(ie){var de=ie.id,le=ie.email,He=ie.finished_at;return{id:de,email:le,finished_at:He}})},[Te]);return Object(x.jsx)(M.a,{title:function(){return Object(x.jsx)(C.b,{children:Object(x.jsx)(S.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:$e,dataSource:Ie,size:"small",scroll:{x:500}})},et=function(Ge){var Te=Ge.stats,$e=Object(Pe.useState)(null),Ie=Object(xe.a)($e,2),ie=Ie[0],de=Ie[1],le=Object(Pe.useState)(null),He=Object(xe.a)(le,2),Ve=He[0],D=He[1],Ce=Object(S.l)(),me=Object(Pe.useMemo)(function(){return Te.flatMap(function(w){return Object.values(w.attempts).flatMap(function(G){var Le=G.dates,Xe=G.attempt,oe=Object.values(Le).flatMap(function(L){var U=L.date,I=L.seconds_total;return{date:U,attempt:Xe,seconds_total:I,email:w.email}});return oe})})},[Te]),ve={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(x.jsx)(jt.a,{title:Object(x.jsxs)(C.b,{children:[Object(x.jsx)(S.a,{id:"course.interactions_time_in_days"}),Object(x.jsx)(Oe.a,{showSearch:!0,value:ie,onChange:function(G){de(G),D(null)},placeholder:Object(x.jsx)(S.a,{id:"select_person",defaultMessage:"Select a person"}),children:Te.map(function(w){var G=w.id,Le=w.email;return Object(x.jsx)(Oe.a.Option,{value:Le,children:Le},G)})}),Object(x.jsx)(Oe.a,{value:Ve,onChange:function(G){return D(G)},disabled:ie===null,placeholder:Object(x.jsx)(S.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(k.a)(new Set(me.filter(function(w){var G=w.email;return G===ie}).map(function(w){var G=w.attempt;return G}))).map(function(w){return Object(x.jsxs)(Oe.a.Option,{value:w,children:[Object(x.jsx)(S.a,{id:"attempt",defaultMessage:"Attempt"})," ",w]},w)})})]}),colSpan:12,layout:"center",children:Object(x.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(x.jsx)(We.a,Object(q.a)(Object(q.a)({},ve),{},{tooltip:{title:"".concat(Ce.formatMessage({id:"attempt"})),formatter:function(G){var Le=Math.floor(+G.seconds_total/60),Xe=+G.seconds_total>60?+G.seconds_total-Le*60:0;return{name:G.attempt,value:"".concat(Le,"m ").concat(Xe,"s")}}},data:me.filter(function(w){var G=w.email;return G===ie}).filter(function(w){var G=w.attempt;return Number.isInteger(Ve)?G===Ve:!0})}))})})}},olry:function(ut,ue,c){"use strict";c.r(ue);var o=c("k1fw"),Oe=c("+L6B"),ne=c("2/Rp"),M=c("T2oS"),se=c("W9HT"),j=c("q1tI"),qe=c.n(j),s=c("9kvl"),Ne=c("55Ip"),q=c("Ty5D"),te=c("nhC9"),C=c("tMyG"),Ye=c("my69"),Ee=c("huej"),k=c("mJ0o"),xe=c("EhlZ"),Pe=c("P2fV"),ct=c("NJEC"),jt=c("5Dmo"),We=c("3S7+"),S=c("qLMh"),V=c("9og8"),De=c("sWYD"),nt=c("G3dp"),it=c("lbgm"),ce=c("/MfK"),H=c("Qiat"),N=c("mGZj");function F(i,r){return x.apply(this,arguments)}function x(){return x=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(o.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},i)})),x.apply(this,arguments)}function Se(i,r){return X.apply(this,arguments)}function X(){return X=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(o.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),X.apply(this,arguments)}function ye(i,r,a){return at.apply(this,arguments)}function at(){return at=Object(V.a)(Object(S.a)().mark(function i(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(o.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return u.stop()}},i)})),at.apply(this,arguments)}function et(i,r){return _e.apply(this,arguments)}function _e(){return _e=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(o.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),_e.apply(this,arguments)}function Ge(i,r){return Te.apply(this,arguments)}function Te(){return Te=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(o.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},i)})),Te.apply(this,arguments)}function $e(i,r,a,n){return Ie.apply(this,arguments)}function Ie(){return Ie=Object(V.a)(Object(S.a)().mark(function i(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(o.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return d.stop()}},i)})),Ie.apply(this,arguments)}function ie(i,r,a){return de.apply(this,arguments)}function de(){return de=Object(V.a)(Object(S.a)().mark(function i(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(o.a)({method:"DELETE"},n||{})));case 1:case"end":return u.stop()}},i)})),de.apply(this,arguments)}var le=c("Vpfc"),He=c("giR+"),Ve=c("fyUT"),D=c("tJVT"),Ce=c("14J3"),me=c("BMrR"),ve=c("jCWc"),w=c("kPKH"),G=c("VMEa"),Le=c("Qurx"),Xe=c("lR9U"),oe=c("/y+f"),L=c("2qtc"),U=c("kLXV"),I=c("oBTY"),B=c("OaEy"),K=c("2fM7"),J=c("DBJ/"),e=c("nKUr"),Ue=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,u=Object(k.b)(),d=u.semester_subject_id,b=u.teacherSubjectData,m=Object(j.useState)(null),y=Object(D.a)(m,2),g=y[0],O=y[1],h=Object(j.useMemo)(function(){var v;return((v=b==null?void 0:b.groups)!==null&&v!==void 0?v:[]).map(function(p){var _=p.id,E=p.name;return{label:E,value:_}})},[]),l={type:a,group_id:g,semester_subject_id:d},f=Object(j.useCallback)(function(v){if(v.success){var p=v.data.results.filter(function(_){var E=_.user_id;return E!==null});if(!p.length)return;n({exam_results:p,group_id:v.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(G.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(K.a,{disabled:t,value:g,onChange:function(p){return O(p)},options:h,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(J.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(p){return!p.fileList.length&&n(void 0)},maxFiles:1,data:l,disabled:!g})]})},Yt=function(r){var a=r.onDataConverted,n=Object(k.b)(),t=n.teacherSubjectData,u=n.groupUsers,d=Object(j.useState)(null),b=Object(D.a)(d,2),m=b[0],y=b[1],g=Object(j.useMemo)(function(){var h;return((h=t==null?void 0:t.groups)!==null&&h!==void 0?h:[]).map(function(l){var f=l.id,v=l.name;return{label:v,value:f}})},[]),O=Object(j.useCallback)(function(h){var l;y(h);var f=(l=u.byId)===null||l===void 0?void 0:l[h];if(!!f){var v=f.users.reduce(function(p,_){var E=_.id,T=_.email,z=_.first_name,W=_.last_name,je=_.academic_teacher_id;return je!==null?p:[].concat(Object(I.a)(p),[{email:T,first_name:z,last_name:W,user_id:E,result:0}])},[]);a({group_id:h,exam_results:v})}},[u.byId]);return Object(e.jsx)(K.a,{value:m,onChange:O,options:g,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},Xt=[oe.c.TeamsLecture,oe.c.TestPortal,oe.c.TeamsForms],Zt=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,u=r.type,d=Object(k.b)(),b=d.teacherSubjectData,m=d.fetchGroupUsers,y=Object(j.useState)(),g=Object(D.a)(y,2),O=g[0],h=g[1];return Object(j.useEffect)(function(){if(u===oe.c.Manual&&a){var l;b==null||(l=b.groups)===null||l===void 0||l.forEach(function(f){var v=f.id;return m(v)})}},[u,a]),Object(e.jsxs)(U.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(u,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){O&&t(O)},okButtonProps:{disabled:!O},children:[Xt.includes(u)&&Object(e.jsx)(Ue,{type:u,onDataConverted:h,groupSelectDisabled:!!O}),u===oe.c.Manual&&Object(e.jsx)(Yt,{onDataConverted:h})]})},Qt=function(r){var a=r.onSelect;return Object(e.jsxs)(me.a,{gutter:[16,16],children:[Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(ne.a,{type:"primary",onClick:function(){return a(oe.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(ne.a,{type:"primary",onClick:function(){return a(oe.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(ne.a,{type:"primary",onClick:function(){return a(oe.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(ne.a,{type:"primary",onClick:function(){return a(oe.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},kt=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],qt=function(r){var a,n=r.exam_id,t=G.a.useForm(),u=Object(D.a)(t,1),d=u[0],b=Object(j.useState)(),m=Object(D.a)(b,2),y=m[0],g=m[1],O=Object(j.useState)(),h=Object(D.a)(O,2),l=h[0],f=h[1],v=Object(j.useState)(!1),p=Object(D.a)(v,2),_=p[0],E=p[1],T=Object(k.b)(),z=T.semester_subject_id,W=T.getGroupById,je=Object(j.useMemo)(function(){var A;return((A=l==null?void 0:l.exam_results)!==null&&A!==void 0?A:[]).map(function(P){var $=P.user_id;return $})},[l==null?void 0:l.exam_results]);Object(j.useEffect)(function(){var A=Number(n);n==="new"&&(g(void 0),f(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(A)&&(E(!0),et(A).then(function(P){if(P.success){var $=P.data,Z=$.type,Fe=$.results,Be=$.title,ee=$.weight,ae=$.passed_at,Y=$.group_id;g(Z),f({group_id:Y,exam_results:Fe}),d.setFieldsValue({title:Be,weight:ee,passed_at:ae})}}).finally(function(){return E(!1)}))},[n]);var pe=Object(j.useCallback)(function(){g(void 0),f(void 0)},[]);return _?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(Zt,{open:Boolean(y&&!l),type:y,closeModal:pe,onSuccess:f}),Object(e.jsxs)(G.a,{form:d,submitter:y===void 0||!l?!1:void 0,onFinish:function(){var A=Object(V.a)(Object(S.a)().mark(function P($){var Z,Fe,Be,ee,ae,Y,he,we,ge,Ke;return Object(S.a)().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(Fe=l==null||(Z=l.exam_results)===null||Z===void 0?void 0:Z.every(function(re){var be=re.result;return typeof be=="number"&&be>=0&&be<=100}),!(l&&Fe&&typeof z=="number")){R.next=17;break}if(Be=$.title,ee=$.passed_at,ae=$.weight,Y=Number(n),he=l.exam_results,we=l.group_id,ge={type:y,semester_subject_id:z,title:Be,passed_at:ee,weight:ae,group_id:we,results:he},!Number.isNaN(Y)){R.next=12;break}return R.next=9,Se(ge);case 9:R.t0=R.sent,R.next=15;break;case 12:return R.next=14,ye(Y,ge);case 14:R.t0=R.sent;case 15:Ke=R.t0,Ke.success&&s.f.push("/teacher/subjects/".concat(z,"/exams"));case 17:return R.abrupt("return",!0);case 18:case"end":return R.stop()}},P)}));return function(P){return A.apply(this,arguments)}}(),onReset:pe,children:[Object(e.jsxs)(G.a.Group,{children:[Object(e.jsx)(Le.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(Xe.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(G.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ve.a,{})})]}),y&&l&&Object(e.jsx)(H.a,{rowKey:"user_id",headerTitle:(a=W(l.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:je,onValuesChange:function(P,$){return f({group_id:l.group_id,exam_results:$})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:l.exam_results,columns:kt}),!l&&Object(e.jsx)(Qt,{onSelect:g})]})]})},ea=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],ta=function(r){var a=r.exam_id,n=Object(j.useState)(""),t=Object(D.a)(n,2),u=t[0],d=t[1];return Object(e.jsx)(H.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:u,request:Object(V.a)(Object(S.a)().mark(function b(){var m;return Object(S.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,et(a);case 2:if(m=g.sent,!m.success){g.next=6;break}return d(m.data.title),g.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return g.abrupt("return",[]);case 7:case"end":return g.stop()}},b)})),columns:ea})},aa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(De.a)(new Date(a.passed_at),N.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(De.a)(new Date(a.created_at),N.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(le.a,{type:"Students",type_id:a.group_id},a.group_id)}}],ra=function(){var r,a,n=Object(j.useRef)(),t=Object(k.b)(),u=t.semester_subject_id,d=Object(q.k)(),b=Object(j.useMemo)(function(){var g,O,h;return{exam_id:(g=(O=d.query)===null||O===void 0?void 0:O.exam_id)!==null&&g!==void 0?g:null,results:(h=d.query)===null||h===void 0?void 0:h.results}},[(r=d.query)===null||r===void 0?void 0:r.exam_id,(a=d.query)===null||a===void 0?void 0:a.results]),m=b.exam_id,y=b.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(ta,{exam_id:Number(y)}):m!==null?Object(e.jsx)(qt,{exam_id:m}):Object(e.jsx)(H.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var g=Object(V.a)(Object(S.a)().mark(function O(h,l){var f,v,p,_;return Object(S.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(f=h.current,v=h.pageSize,u!==null){T.next=3;break}return T.abrupt("return",{data:[],total:0,success:!1});case 3:return p=l&&Object.entries(l)[0],T.next=6,F({per_page:v,page:f,semester_subject_id:Number.isNaN(u)?void 0:u,order_by:p&&p[0],order:p&&(p[1]==="ascend"?"ASC":"DESC")});case 6:if(_=T.sent,!_.success){T.next=9;break}return T.abrupt("return",{data:_.data,total:_.meta.total,success:!0});case 9:return T.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return T.stop()}},O)}));return function(O,h){return g.apply(this,arguments)}}(),columns:[].concat(aa,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(O,h){return[Object(e.jsx)(Ne.a,{to:"/teacher/subjects/".concat(h.semester_subject_id,"/exams?exam_id=").concat(h.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(ne.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit"),Object(e.jsx)(Ne.a,{to:"/teacher/subjects/".concat(h.semester_subject_id,"/exams?results=").concat(h.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(ne.a,{icon:Object(e.jsx)(it.a,{})})})},"results"),Object(e.jsx)(ct.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(V.a)(Object(S.a)().mark(function l(){var f;return Object(S.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Ge(h.id);case 2:f=p.sent,f.success&&n.current&&n.current.reload();case 4:case"end":return p.stop()}},l)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ne.a,{type:"primary",icon:Object(e.jsx)(ce.a,{}),danger:!0})})},"delete")]}}])})},vt=c("o0Ox"),gr=c("miYZ"),st=c("tsqr"),na=c("4KAj");function sa(i,r){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(o.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},i)})),Ot.apply(this,arguments)}var ua=function(r){var a=r.student_id,n=Object(j.useState)(!1),t=Object(D.a)(n,2),u=t[0],d=t[1],b=Object(j.useCallback)(Object(V.a)(Object(S.a)().mark(function m(){var y;return Object(S.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return d(!0),O.next=3,sa({user_id:a});case 3:if(y=O.sent,y.success){O.next=8;break}return st.b.error(y.message),d(!1),O.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return O.stop()}},m)})),[]);return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(ne.a,{loading:u,type:"primary",icon:Object(e.jsx)(na.a,{}),onClick:b})})},ca=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ia=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},da=function(r){return r.reduce(function(a,n){var t,u=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(d,b){return b.academic_teacher_id!==null?d:[].concat(Object(I.a)(d),[{group_id:n.id,group_name:n.name,user_id:b.id,first_name:b.first_name,last_name:b.last_name,email:b.email}])},[]);return[].concat(Object(I.a)(a),Object(I.a)(u))},[])},la=function(){var r=Object(k.b)(),a=r.teacherSubjectData,n=Object(j.useMemo)(function(){var t;return ia((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(H.a,{className:"table-standalone",rowKey:function(u){return"".concat(u.group_id,"-").concat(u.user_id)},search:{layout:"vertical"},request:function(){var t=Object(V.a)(Object(S.a)().mark(function u(d){var b,m,y,g,O,h,l,f,v;return Object(S.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return b=d.groups,m=d.first_name,y=m===void 0?"":m,g=d.last_name,O=g===void 0?"":g,h=d.email,l=h===void 0?"":h,_.next=3,Object(vt.a)({parent_id:a==null?void 0:a.group_id,"id[]":b});case 3:if(f=_.sent,f.success){_.next=6;break}return _.abrupt("return",{data:[],total:0,success:!1});case 6:return v=da(f.data).filter(function(E){return E.first_name.toLowerCase().includes(y.toLowerCase())&&E.last_name.toLowerCase().includes(O.toLowerCase())&&E.email.toLowerCase().includes(l.toLowerCase())}),_.abrupt("return",{data:v,total:v.length,success:!0});case 8:case"end":return _.stop()}},u)}));return function(u){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ca,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(u,d){return[Object(e.jsx)(ua,{student_id:d.user_id},"teamsChat")]}}])})},tt=c("jrin");function pt(i,r){return ht.apply(this,arguments)}function ht(){return ht=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(r),Object(o.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),ht.apply(this,arguments)}function oa(i,r,a,n){return gt.apply(this,arguments)}function gt(){return gt=Object(V.a)(Object(S.a)().mark(function i(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(o.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return d.stop()}},i)})),gt.apply(this,arguments)}var xr=c("DYRE"),ja=c("zeV3"),Sr=c("sRBo"),$t=c("kaz8");function ba(i){var r,a,n=i===null?oe.a.ABSENT:i,t=(r={},Object(tt.a)(r,oe.a.PRESENT,{ch1:!0,ch2:!1}),Object(tt.a)(r,oe.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(tt.a)(r,oe.a.ABSENT,{ch1:!1,ch2:!1}),Object(tt.a)(r,oe.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),r);return(a=t[n])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function ma(i){var r,a=i.ch1,n=i.ch2,t="".concat(a,"_").concat(n),u={true_false:oe.a.PRESENT,true_true:oe.a.PRESENT_NOT_EXERCISING,false_false:oe.a.ABSENT,false_true:oe.a.EXCUSED_ABSENCE};return(r=u[t])!==null&&r!==void 0?r:oe.a.ABSENT}var fa=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.attendance,u=r.onSuccess,d=Object(j.useState)(ba(t)),b=Object(D.a)(d,2),m=b[0],y=b[1],g=Object(j.useState)(!1),O=Object(D.a)(g,2),h=O[0],l=O[1],f=Object(j.useRef)(!0),v=Object(j.useCallback)(function(E){l(!0),oa(a,n,ma(E)).then(function(T){T.success&&(u==null||u())}).finally(function(){return l(!1)})},[]),p=Object(j.useCallback)(function(E){return y(E.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),_=Object(j.useCallback)(function(E){return y(function(T){return Object(o.a)(Object(o.a)({},T),{},{ch2:E.target.checked})})},[]);return Object(j.useEffect)(function(){if(f.current){f.current=!1;return}v(m)},[m,v]),Object(e.jsxs)(ja.b,{children:[Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)($t.a,{disabled:h,checked:m.ch1,onChange:p})}),Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)($t.a,{disabled:h,checked:m.ch2,onChange:_})})]})},xt=fa,va=function(){var r=Object(k.b)(),a=r.teacherSubjectData,n=Object(j.useState)([]),t=Object(D.a)(n,2),u=t[0],d=t[1],b=Object(j.useState)(""),m=Object(D.a)(b,2),y=m[0],g=m[1],O=Object(s.l)(),h=Object(j.useRef)(),l=Object(j.useMemo)(function(){var v;return((v=a==null?void 0:a.groups)!==null&&v!==void 0?v:[]).map(function(p){var _=p.id,E=p.name;return{value:_,label:E}})},[a==null?void 0:a.groups]),f=Object(j.useMemo)(function(){var v;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:l,defaultValue:l==null||(v=l[0])===null||v===void 0?void 0:v.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(I.a)(u))},[l,u]);return Object(e.jsx)(H.a,{className:"table-standalone",headerTitle:"".concat(O.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var v=Object(V.a)(Object(S.a)().mark(function p(_){var E,T,z,W,je,pe,A,P,$,Z,Fe;return Object(S.a)().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return T=_.group_id,z=T===void 0?l==null||(E=l[0])===null||E===void 0?void 0:E.value:T,W=_.full_name,je=W===void 0?"":W,ee.next=3,Promise.all([Object(vt.b)(z),pt(z)]);case 3:if(pe=ee.sent,A=Object(D.a)(pe,2),P=A[0],$=A[1],Z=l.find(function(ae){var Y=ae.value;return Y===z}),!(!P.success||!$.success||!Z)){ee.next=10;break}return ee.abrupt("return",{data:[],total:0,success:!1});case 10:if($.data.length){ee.next=13;break}return st.b.error(O.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),ee.abrupt("return",{data:[],total:0,success:!1});case 13:return g(Z.label),d($.data.reduce(function(ae,Y){return[].concat(Object(I.a)(ae),[{title:String(Object(De.a)(new Date(Y.date_from),N.c)),dataIndex:String(Y.date_from),hideInSearch:!0,width:100,align:"center",render:function(we,ge){return Object(e.jsx)(xt,{groupAttendanceScheduleId:Y.id,attendance:ge["".concat(Y==null?void 0:Y.date_from)],studentId:ge.id})}}])},[])),Fe=P.data.users.reduce(function(ae,Y){var he=Y.id,we=Y.academic_teacher_id,ge=Y.first_name,Ke=Y.last_name,Q="".concat(Ke," ").concat(ge);if(we!==null||!Q.toLowerCase().includes(je.toLowerCase()))return ae;var R=$.data.reduce(function(re,be){var Ae=be.attendances.find(function(Je){return Je.user_id===he});return Ae?Object(o.a)(Object(o.a)({},re),{},Object(tt.a)({},"".concat(be.date_from),Ae.value)):re},{});return[].concat(Object(I.a)(ae),[Object(o.a)({id:he,full_name:Q},R)])},[]).sort(function(ae,Y){return ae.full_name.localeCompare(Y.full_name)}),ee.abrupt("return",{data:Fe,total:Fe.length,success:!0});case 17:case"end":return ee.stop()}},p)}));return function(p){return v.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{onChange:function(){var p;return(p=h.current)===null||p===void 0?void 0:p.reload()}},scroll:{x:1500},actionRef:h,rowKey:"id"})},yr=c("tU7J"),ze=c("wFql"),Tr=c("/zsF"),St=c("PArb"),Oa=c("Hn4i"),pa=c("bRQS");function yt(i,r,a){return Tt.apply(this,arguments)}function Tt(){return Tt=Object(V.a)(Object(S.a)().mark(function i(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(o.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return u.stop()}},i)})),Tt.apply(this,arguments)}function ha(i,r,a,n){return Ct.apply(this,arguments)}function Ct(){return Ct=Object(V.a)(Object(S.a)().mark(function i(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(o.a)({method:"POST",data:n},t||{})));case 1:case"end":return d.stop()}},i)})),Ct.apply(this,arguments)}function Lt(i,r){return Et.apply(this,arguments)}function Et(){return Et=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(o.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Et.apply(this,arguments)}function ga(i,r,a){return _t.apply(this,arguments)}function _t(){return _t=Object(V.a)(Object(S.a)().mark(function i(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(o.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return u.stop()}},i)})),_t.apply(this,arguments)}function At(i){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(V.a)(Object(S.a)().mark(function i(r){return Object(S.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(o.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},i)})),Gt.apply(this,arguments)}function Rt(i,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(r),Object(o.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Mt.apply(this,arguments)}function Nt(i,r){return It.apply(this,arguments)}function It(){return It=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(o.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},i)})),It.apply(this,arguments)}function wt(i,r,a){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(V.a)(Object(S.a)().mark(function i(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(o.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return u.stop()}},i)})),Ft.apply(this,arguments)}var xa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Sa=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(j.useState)([]),u=Object(D.a)(t,2),d=u[0],b=u[1],m=Object(j.useRef)(),y=G.a.useForm(),g=Object(D.a)(y,1),O=g[0];return Object(j.useEffect)(function(){var h,l=((h=a.scale)!==null&&h!==void 0?h:[]).map(function(f,v){return Object(o.a)(Object(o.a)({},f),{},{id:String((v+1)*100)})});O.setFieldValue("table",l)},[]),Object(e.jsx)(G.a,{form:O,onFinish:n,submitter:{render:function(l,f){var v=Object(D.a)(f,2),p=v[1];return[p]}},children:Object(e.jsx)(Oa.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(xa,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(l,f){return Object(e.jsx)(ne.a,{type:"primary",onClick:function(){var p;return(p=m.current)===null||p===void 0?void 0:p.startEditable(f.id)},icon:Object(e.jsx)(nt.a,{})})}}]),editable:{form:O,type:"multiple",editableKeys:d,saveText:Object(e.jsx)(ne.a,{type:"primary",icon:Object(e.jsx)(pa.a,{})}),onChange:b,actionRender:function(l,f,v){return[v.save]}}})})},ya=function(){var r,a,n=Object(s.m)("@@initialState"),t=n.initialState,u=Object(k.b)(),d=u.semester_subject_id,b=u.tutors,m=Object(j.useState)(),y=Object(D.a)(m,2),g=y[0],O=y[1],h=Object(j.useState)(!1),l=Object(D.a)(h,2),f=l[0],v=l[1],p=Object(j.useState)(null),_=Object(D.a)(p,2),E=_[0],T=_[1],z=Object(j.useMemo)(function(){return!!b.data.find(function(A){var P,$=A.id;return $===(t==null||(P=t.currentUser)===null||P===void 0?void 0:P.id)})},[b.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),W=Object(j.useMemo)(function(){return b.data.map(function(A){var P=A.id,$=A.first_name,Z=A.last_name;return{label:"".concat($," ").concat(Z),value:P}})},[b.data]),je=Object(j.useCallback)(function(){d===null||E===null||(v(!0),O(void 0),yt(d,E).then(function(A){A.success&&O(A.data)}).finally(function(){v(!1)}))},[d,E]),pe=Object(j.useCallback)(function(A,P){return function(){var $=Object(V.a)(Object(S.a)().mark(function Z(Fe){var Be,ee;return Object(S.a)().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!(d===null||E===null)){Y.next=2;break}return Y.abrupt("return");case 2:return Be=A.reduce(function(he,we){return we.s_subject_scale_form_id===P?[].concat(Object(I.a)(he),[{s_subject_scale_form_id:P,scale:Fe.table.map(function(ge){var Ke=ge.name,Q=ge.grade,R=ge.grade_value;return{name:Ke,grade:Q,grade_value:R}})}]):[].concat(Object(I.a)(he),[we])},[]),Y.next=5,ha(d,E,{grade_scale:Be});case 5:ee=Y.sent,ee.success&&je();case 7:case"end":return Y.stop()}},Z)}));return function(Z){return $.apply(this,arguments)}}()},[E,d]);return Object(j.useEffect)(function(){var A,P;if(!z||!(t!=null&&(A=t.currentUser)!==null&&A!==void 0&&A.id)){var $;if(($=b.data)!==null&&$!==void 0&&$[0]){var Z;T((Z=b.data)===null||Z===void 0?void 0:Z[0].id)}return}T(t==null||(P=t.currentUser)===null||P===void 0?void 0:P.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,z]),Object(j.useEffect)(function(){je()},[je]),b.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(G.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(K.a,{disabled:z,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:W,value:E,onChange:function(P){return T(P)}})}),Object(e.jsx)(St.a,{}),f&&!g&&Object(e.jsx)(se.a,{}),g!=null&&g.grade_scale?g.grade_scale.map(function(A,P){var $;return Object(e.jsxs)(qe.a.Fragment,{children:[P>0&&Object(e.jsx)(St.a,{}),Object(e.jsx)(Sa,{subjectTutorGradeScale:A,onFormSubmit:pe(($=g.grade_scale)!==null&&$!==void 0?$:[],A.s_subject_scale_form_id)})]},A.s_subject_scale_form_id)}):Object(e.jsx)(ze.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Cr=c("qbNl"),Ta=c("JBPa"),Er=c("Awhp"),Ca=c("KrTs"),Ea=c("wd/R"),Ze=c.n(Ea);function _a(i,r){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(V.a)(Object(S.a)().mark(function i(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(o.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},i)})),Pt.apply(this,arguments)}var _r=c("5R/X"),Ga=function(){var r=Object(j.useState)(null),a=Object(D.a)(r,2),n=a[0],t=a[1],u=Object(j.useState)([]),d=Object(D.a)(u,2),b=d[0],m=d[1],y=Object(k.b)(),g=y.semester_subject_id,O=Ze()(),h=Object(j.useMemo)(function(){return b.map(function(T){return{id:T.id,title:"".concat(T.group.name," (").concat(T.term_status.name,")"),start:Ze()(T.date_from).toDate(),end:Ze()(T.date_to).toDate(),tutor_name:"".concat(T.tutor.first_name," ").concat(T.tutor.last_name),tutor_email:T.tutor.email,semester:T.semester.name,group:T.group.name,subject:T.subject.name,ms_teams_join_url:T.ms_teams_join_url}})},[b]),l=Object(j.useCallback)(function(T,z){_a({semester_subject_id:g,date_form:T.toDate(),date_to:z.toDate()}).then(function(W){W.success&&m(W.data)})},[g]),f=Object(j.useCallback)(function(T){t(T)},[]),v=Object(j.useCallback)(function(){t(null)},[]),p=Object(j.useCallback)(function(T){return T.isSame(O,"day")?"warning":T.isAfter(O,"day")?"success":"error"},[]),_=Object(j.useCallback)(function(T){var z=h.filter(function(W){return Ze()(W.start).isSame(T,"day")});return Object(e.jsx)("ul",{className:"events",children:z.map(function(W){return Object(e.jsx)("li",{onClick:function(){return f(W)},children:Object(e.jsx)(Ca.a,{status:p(Ze()(W.start)),text:W.title})},W.id)})})},[b]),E=Object(j.useCallback)(function(T,z){var W=Ze()(T).startOf(z).subtract(1,"month"),je=Ze()(T).endOf(z).add(1,"month");l(W,je)},[]);return Object(j.useEffect)(function(){var T=Ze()().startOf("month"),z=Ze()().endOf("month");l(T,z)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ze.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ta.a,{dateCellRender:_,onPanelChange:E}),Object(e.jsxs)(U.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:v,footer:null,children:[Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&Ze()(n.start).format(N.b)]}),Object(e.jsxs)(ze.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",n&&Ze()(n.end).format(N.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(ze.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(ne.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Ut=c("yj/a"),Bt=c("5Syx"),bt=c("PpiC"),Dt=c("H6aw"),Ma=c("p3I6"),Ia=["results"],Kt=function(r,a){return r.reduce(function(n,t){var u=t.results,d=Object(bt.a)(t,Ia),b=u.find(function(m){return m.user_id===a});return b?[].concat(Object(I.a)(n),[Object(o.a)(Object(o.a)({},d),{},{result:b})]):n},[])},Wt=function(r,a){var n,t=r.reduce(function(l,f){var v=f.result,p=f.weight;return[l[0]+v.result*p,l[1]+p]},[0,0]),u=Object(D.a)(t,2),d=u[0],b=u[1],m=Number.isNaN(d/b)?0:d/b,y=a.sort(function(l,f){return l.grade_value-f.grade_value}).reduce(function(l,f){return[].concat(Object(I.a)(l),[Object(o.a)(Object(o.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(y.every(function(l){var f=l.isWeightedAverageGreater;return f})){var g,O;return(g=(O=y.at(-1))===null||O===void 0?void 0:O.name)!==null&&g!==void 0?g:""}var h=y.findIndex(function(l){var f=l.isWeightedAverageGreater;return!f});return h<0?"":(n=y[h-1])===null||n===void 0?void 0:n.name},Ht=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Fa=["attendances"];function Pa(i,r){var a=Object(j.useState)({loading:!1}),n=Object(D.a)(a,2),t=n[0],u=n[1];return Object(j.useEffect)(function(){u(function(d){return Object(o.a)(Object(o.a)({},d),{},{loading:!0})}),ga(i,r).then(function(d){d.success&&u(function(b){return Object(o.a)(Object(o.a)({},b),{},{data:d.data})})}).finally(function(){u(function(d){return Object(o.a)(Object(o.a)({},d),{},{loading:!1})})})},[r,i]),{finalGrades:t}}function Da(){var i=Object(j.useState)({loading:!1}),r=Object(D.a)(i,2),a=r[0],n=r[1];return Object(j.useEffect)(function(){n(function(t){return Object(o.a)(Object(o.a)({},t),{},{loading:!0})}),At().then(function(t){t.success&&n(function(u){return Object(o.a)(Object(o.a)({},u),{},{data:t.data})})}).finally(function(){n(function(t){return Object(o.a)(Object(o.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function $a(i){var r=Object(j.useState)({loading:!1}),a=Object(D.a)(r,2),n=a[0],t=a[1];return Object(j.useEffect)(function(){i!==void 0&&(t(function(u){return Object(o.a)(Object(o.a)({},u),{},{loading:!0})}),Rt(i).then(function(u){u.success&&t(function(d){return Object(o.a)(Object(o.a)({},d),{},{data:u.data})})}).finally(function(){t(function(u){return Object(o.a)(Object(o.a)({},u),{},{loading:!1})})}))},[i]),{subjectGradeScales:n}}function La(i,r,a){var n=Object(j.useState)({loading:!1}),t=Object(D.a)(n,2),u=t[0],d=t[1];return Object(j.useEffect)(function(){typeof i!="number"||typeof r!="number"||typeof a!="number"||(d(function(b){return Object(o.a)(Object(o.a)({},b),{},{loading:!0})}),yt(i,r).then(function(b){b.success&&d(function(m){var y,g;return Object(o.a)(Object(o.a)({},m),{},{data:(y=Ht(a,(g=b.data.grade_scale)!==null&&g!==void 0?g:[]))===null||y===void 0?void 0:y.map(function(O,h){return Object(o.a)(Object(o.a)({},O),{},{id:h})})})})}).finally(function(){d(function(b){return Object(o.a)(Object(o.a)({},b),{},{loading:!1})})}))},[i,r]),{tutorGradeScales:u}}function Aa(i,r){var a=Object(j.useState)({loading:!1}),n=Object(D.a)(a,2),t=n[0],u=n[1],d=Object(j.useCallback)(function(){u(function(b){return Object(o.a)(Object(o.a)({},b),{},{loading:!0})}),pt(i).then(function(b){if(b.success){var m=b.data.reduce(function(y,g){var O=g.attendances,h=Object(bt.a)(g,Fa),l=O.find(function(f){return f.user_id===r});return l?[].concat(Object(I.a)(y),[Object(o.a)(Object(o.a)({},h),{},{attendance:l})]):y},[]);u(function(y){return Object(o.a)(Object(o.a)({},y),{},{data:m})})}}).finally(function(){u(function(b){return Object(o.a)(Object(o.a)({},b),{},{loading:!1})})})},[i,r]);return Object(j.useEffect)(function(){d()},[d]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:d}}function Ra(i,r){var a=Object(j.useState)({loading:!1}),n=Object(D.a)(a,2),t=n[0],u=n[1];return Object(j.useEffect)(function(){!r||(u(function(d){return Object(o.a)(Object(o.a)({},d),{},{loading:!0})}),F({student_id:i,semester_subject_id:r}).then(function(d){if(d.success){var b=Kt(d.data,i);u(function(m){return Object(o.a)(Object(o.a)({},m),{},{data:b})})}}).finally(function(){u(function(d){return Object(o.a)(Object(o.a)({},d),{},{loading:!1})})}))},[i,r]),{studentExams:t}}function Na(i,r){var a=Object(j.useState)({loading:!1}),n=Object(D.a)(a,2),t=n[0],u=n[1],d=Object(j.useState)({loading:!1}),b=Object(D.a)(d,2),m=b[0],y=b[1],g=Object(j.useState)({loading:!1}),O=Object(D.a)(g,2),h=O[0],l=O[1];return Object(j.useEffect)(function(){u(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!0})}),Object(Dt.e)({group_id:i}).then(function(f){f.success&&u(function(v){return Object(o.a)(Object(o.a)({},v),{},{data:f.data})})}).finally(function(){u(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!1})})})},[i]),Object(j.useEffect)(function(){!t.data||(l(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var v=f.id;return Object(Dt.n)(Number(v))})).then(function(f){f.forEach(function(v){v.success&&l(function(p){return Object(o.a)(Object(o.a)({},p),{},{data:Object(o.a)(Object(o.a)({},p.data),{},Object(tt.a)({},Number(v.data.id),Object(Ma.c)(v.data.lessons)))})})})}).finally(function(){l(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!1})})}),y(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var v=f.id;return Object(Dt.l)(Number(v),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(p){if(p.success){var _,E,T=((_=p.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&_!==void 0?_:[]).filter(function(W){return W.id===r}),z=(E=p.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&E!==void 0?E:[];y(function(W){return Object(o.a)(Object(o.a)({},W),{},{data:Object(o.a)(Object(o.a)({},W.data),{},Object(tt.a)({},Number(v),{finishedTopics:T,attendanceList:z}))})})}})})).finally(function(){return y(function(f){return Object(o.a)(Object(o.a)({},f),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:m,userCoursesTopics:h}}var wa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ua=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(De.a)(new Date(a.date_from),N.c)}}],Ba=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(De.a)(new Date(a.created_at),N.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],Ka=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(De.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),N.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],mt=6,Wa=function(r){var a,n,t,u,d=r.user_id,b=r.group_id,m=Object(k.b)(),y=m.semester_subject_id,g=Ra(d,y),O=g.studentExams,h=Pa(b,d),l=h.finalGrades,f=Da(),v=f.gradeTerms,p=$a((a=l.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),_=p.subjectGradeScales,E=La(y,(n=l.data)===null||n===void 0?void 0:n.tutor_id,(t=l.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),T=E.tutorGradeScales,z=Aa(b,d),W=z.userAttendanceSchedules,je=z.fetchUserAttendanceSchedules,pe=Na(b,d),A=pe.userCourses,P=pe.userCoursesStats,$=pe.userCoursesTopics,Z=G.a.useForm(),Fe=Object(D.a)(Z,1),Be=Fe[0],ee=Object(j.useMemo)(function(){var Q;return((Q=v.data)!==null&&Q!==void 0?Q:[]).map(function(R){var re=R.id,be=R.name;return{label:be,value:re}})},[v.data]),ae=Object(j.useMemo)(function(){var Q;return((Q=_.data)!==null&&Q!==void 0?Q:[]).map(function(R){var re=R.name,be=R.id;return{label:re,value:be}})},[_.data]),Y=Object(j.useMemo)(function(){var Q,R;return Wt((Q=O.data)!==null&&Q!==void 0?Q:[],(R=T.data)!==null&&R!==void 0?R:[])},[O.data,T.data]),he=Object(j.useCallback)(function(){var Q=Object(V.a)(Object(S.a)().mark(function R(re){var be,Ae,Je,Qe,rt,fe,Me;return Object(S.a)().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(Je=re.grade_scale_id,Qe=re.grade_term_id,((be=l.data)===null||be===void 0?void 0:be.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(rt=(Ae=l.data)===null||Ae===void 0?void 0:Ae.grades.find(function(dt){var lt=dt.grade_term;return lt.id===Qe}),!rt){Re.next=11;break}return Re.next=7,wt(rt.id,{grade_scale_id:Je});case 7:return fe=Re.sent,st.b[fe.success?"success":"error"](fe.message),fe.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,Nt({grade_scale_id:Je,grade_term_id:Qe,lesson_group_user_id:l.data.id});case 13:Me=Re.sent,st.b[Me.success?"success":"error"](Me.message),Me.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades"));case 16:case"end":return Re.stop()}},R)}));return function(R){return Q.apply(this,arguments)}}(),[l.data,y]),we=Object(j.useMemo)(function(){var Q;return((Q=v.data)!==null&&Q!==void 0?Q:[]).map(function(R){var re;return Object(o.a)(Object(o.a)({},R),{},{grade:(re=l.data)===null||re===void 0?void 0:re.grades.find(function(be){var Ae=be.grade_term;return Ae.id===R.id})})})},[l.data,v.data]),ge=A.loading&&!A.data||P.loading&&!P.data||$.loading&&!$.data,Ke=Boolean(A.data&&P.data&&$.data);return l.loading?Object(e.jsx)(se.a,{}):Object(e.jsxs)(e.Fragment,{children:[l.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(ze.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:l.data.user})}),Object(e.jsx)(St.a,{})]}),Object(e.jsxs)(me.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:mt},dataSource:O.data,loading:O.loading,columns:Ba,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:mt},dataSource:we,loading:l.loading||v.loading,columns:Ka,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:W.data,loading:W.loading,columns:[].concat(Ua,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(R,re){return Object(e.jsx)(xt,{groupAttendanceScheduleId:re.id,studentId:d,attendance:re.attendance.value,onSuccess:je})}}])})}),Object(e.jsx)(w.a,{span:12,children:Object(e.jsx)(H.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:T.data,loading:T.loading,columns:wa})}),ge&&Object(e.jsx)(se.a,{}),Ke&&((u=A.data)===null||u===void 0?void 0:u.map(function(Q){var R,re,be,Ae,Je,Qe,rt,fe,Me=Q.id,ke=Q.title;return Object(e.jsxs)(w.a,{span:24,children:[Object(e.jsx)(ze.a.Text,{style:{fontSize:"16px",fontWeight:500},children:ke}),Object(e.jsx)(Bt.c,{course_id:Number(Me),topics:(R=(re=$.data)===null||re===void 0?void 0:re[Number(Me)])!==null&&R!==void 0?R:[],stats:(be=(Ae=P.data)===null||Ae===void 0||(Je=Ae[Number(Me)])===null||Je===void 0?void 0:Je.finishedTopics)!==null&&be!==void 0?be:[]}),Object(e.jsx)(Bt.a,{stats:(Qe=(rt=P.data)===null||rt===void 0||(fe=rt[Number(Me)])===null||fe===void 0?void 0:fe.attendanceList)!==null&&Qe!==void 0?Qe:[]})]},Me)}))]}),Object(e.jsx)(G.a,{form:Be,onFinish:he,children:Object(e.jsxs)(G.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Ut.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ee,width:"sm",fieldProps:{loading:v.loading}}),Object(e.jsx)(Ut.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ae,fieldProps:{loading:l.loading||_.loading}}),Object(e.jsx)(G.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Y}})})]})})]})},Ha=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,u=n.grade_term,d=n.id;return Object(e.jsxs)(ze.a.Text,{children:[u.name,": ",t]},d)}):"-"})}}],Va=function(){var r,a,n=Object(q.k)(),t=Object(j.useMemo)(function(){var O,h,l,f;return{user_id:Number.isNaN(Number((O=n.query)===null||O===void 0?void 0:O.user_id))?null:Number((h=n.query)===null||h===void 0?void 0:h.user_id),group_id:Number.isNaN(Number((l=n.query)===null||l===void 0?void 0:l.group_id))?null:Number((f=n.query)===null||f===void 0?void 0:f.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),u=t.user_id,d=t.group_id,b=Object(k.b)(),m=b.teacherSubjectData,y=b.semester_subject_id,g=Object(j.useMemo)(function(){var O;return((O=m==null?void 0:m.groups)!==null&&O!==void 0?O:[]).map(function(h){var l=h.id,f=h.name;return{label:f,value:l}})},[m==null?void 0:m.groups]);return u!==null&&d!==null?Object(e.jsx)(Wa,{user_id:u,group_id:d}):Object(e.jsx)(H.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var O=Object(V.a)(Object(S.a)().mark(function h(l){var f,v,p,_,E,T,z,W,je,pe;return Object(S.a)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return v=l.group_id,p=v===void 0?[]:v,_=l.first_name,E=_===void 0?"":_,T=l.last_name,z=T===void 0?"":T,W=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function($){var Z=$.id;return Z}),P.next=4,Lt(p.length===0?W:p);case 4:if(je=P.sent,je.success){P.next=7;break}return P.abrupt("return",{success:!1,total:0,data:[]});case 7:return pe=je.data.filter(function($){var Z=$.user;return Z.first_name.toLowerCase().includes(E.toLowerCase())&&Z.last_name.toLowerCase().includes(z.toLowerCase())}),P.abrupt("return",{success:!0,total:pe.length,data:pe});case 9:case"end":return P.stop()}},h)}));return function(h){return O.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:g,mode:"multiple"},render:function(h,l){return Object(e.jsx)(le.a,{type:"Students",type_id:l.group_id},l.group_id)}}].concat(Ha,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(h,l){return[Object(e.jsx)(Ne.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(l.user.id,"&group_id=").concat(l.group_id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(ne.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit")]}}])})},za=c("dF/Y"),Ja=c("o+0V"),Vt=c("0WSk"),Ya=["type","defaultRender"],Xa=["type","defaultRender"],Za=function(r){var a=r.url;return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(ne.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(za.a,{})})})},Qa=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(De.a)(new Date(a.created_at),N.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,u=a.defaultRender,d=Object(bt.a)(a,Ya);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(Vt.a,Object(o.a)(Object(o.a)({},d),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(De.a)(new Date(a.exported_at),N.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,u=a.defaultRender,d=Object(bt.a)(a,Xa);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(Vt.a,Object(o.a)(Object(o.a)({},d),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(Za,{url:a.url},"download")]}}],ka=function(){var r,a,n=Object(k.b)(),t=n.teacherSubjectData,u=Object(j.useMemo)(function(){var b;return((b=t==null?void 0:t.groups)!==null&&b!==void 0?b:[]).map(function(m){var y=m.id,g=m.name;return{value:y,label:g}})},[t==null?void 0:t.groups]),d=Object(j.useMemo)(function(){var b,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:u,defaultValue:t==null||(b=t.groups)===null||b===void 0||(m=b[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(Qa)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,u]);return Object(e.jsx)(H.a,{className:"table-standalone",request:function(){var b=Object(V.a)(Object(S.a)().mark(function m(y){var g,O,h,l,f,v,p;return Object(S.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return h=y.group_id,l=h===void 0?t==null||(g=t.groups)===null||g===void 0||(O=g[0])===null||O===void 0?void 0:O.id:h,f=y.created_by,v=y.exported_by,E.next=3,Object(Ja.a)({group_id:l,created_by:f,exported_by:v});case 3:if(p=E.sent,p.success){E.next=6;break}return E.abrupt("return",{success:!1,data:[],total:0});case 6:return E.abrupt("return",{success:!0,data:p.data,total:p.data.length});case 7:case"end":return E.stop()}},m)}));return function(m){return b.apply(this,arguments)}}(),columns:d,search:{layout:"vertical"},scroll:{x:1500}})},qa=function(r,a){var n;return(n=r.find(function(t){return t.name===a}))===null||n===void 0?void 0:n.id},er=function(r){var a=r.term,n=r.gradeScales,t=r.defaultFinalGrade,u=r.finalGrades,d=Object(j.useState)(t),b=Object(D.a)(d,2),m=b[0],y=b[1],g=Object(j.useState)(!1),O=Object(D.a)(g,2),h=O[0],l=O[1],f=Object(j.useMemo)(function(){return n.map(function(p){var _=p.name,E=p.id;return{value:E,label:_}})},[n]),v=Object(j.useCallback)(function(p){if(!!(u!=null&&u.id)){if(m){l(!0),wt(m.id,{grade_scale_id:p}).finally(function(){return l(!1)});return}l(!0),Nt({grade_term_id:a.id,grade_scale_id:p,lesson_group_user_id:u.id}).then(function(_){if(_.success){var E=_.data.grades.find(function(T){return T.grade_term.id===a.id});y(E)}}).finally(function(){return l(!1)})}},[m,a.id,u==null?void 0:u.id]);return u?Object(e.jsx)(K.a,{loading:h,disabled:h,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:v,options:f,defaultValue:qa(n,t==null?void 0:t.grade_name)}):null},tr=c("LvDl"),ar=function(r){var a=r.exam_id,n=r.result,t=r.student_id,u=r.onSuccess,d=Object(j.useCallback)(Object(tr.debounce)(function(b){$e(a,t,{result:b!=null?b:0}).then(function(m){m.success&&(u==null||u(m.data))})},300),[a,n,t]);return Object(e.jsx)(Ve.a,{type:"number",min:0,max:100,onChange:d,defaultValue:n})},rr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(I.a)(n),[{title:Object(De.a)(new Date(t.date_from),N.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,b){return Object(e.jsx)(xt,{groupAttendanceScheduleId:t.id,attendance:b["attendance-".concat(t==null?void 0:t.date_from)],studentId:b.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},nr=function(r,a){return r.reduce(function(n,t){var u=t.attendances.find(function(d){return d.user_id===a});return u?Object(o.a)(Object(o.a)({},n),{},Object(tt.a)({},"attendance-".concat(t.date_from),u.value)):n},{})},sr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(I.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(d,b){var m;return(b==null||(m=b["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(ar,{result:b==null?void 0:b["exam-".concat(t.id)].result,exam_id:t.id,student_id:b.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},ur=function(r){return r.reduce(function(a,n){var t=n.result,u=n.id;return Object(o.a)(Object(o.a)({},a),{},Object(tt.a)({},"exam-".concat(u),t))},{})},cr=function(r,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(u,d){return Object(e.jsx)(er,{defaultFinalGrade:d["final-grade-".concat(n.id)],finalGrades:d.final_grades,term:n,gradeScales:a})}}})}},ir=function(r,a){return r.find(function(n){return n.user.id===a})},dr=function(r){var a;return((a=r==null?void 0:r.grades)!==null&&a!==void 0?a:[]).reduce(function(n,t){return Object(o.a)(Object(o.a)({},n),{},Object(tt.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},lr=function(){var r,a,n=Object(k.b)(),t=n.teacherSubjectData,u=n.semester_subject_id,d=Object(j.useState)([]),b=Object(D.a)(d,2),m=b[0],y=b[1],g=Object(j.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),O=Object(D.a)(g,2),h=O[0],l=O[1],f=Object(s.l)(),v=Object(j.useMemo)(function(){var E;return((E=t==null?void 0:t.groups)!==null&&E!==void 0?E:[]).map(function(T){var z=T.id,W=T.name;return{value:z,label:W}})},[t==null?void 0:t.groups]),p=Object(j.useRef)(),_=Object(j.useMemo)(function(){var E;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:v,defaultValue:v==null||(E=v[0])===null||E===void 0?void 0:E.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(I.a)(m))},[v,m]);return Object(e.jsx)(H.a,{className:"table-standalone",request:function(){var E=Object(V.a)(Object(S.a)().mark(function T(z){var W,je,pe,A,P,$,Z,Fe,Be,ee,ae,Y,he,we,ge,Ke,Q,R,re,be,Ae,Je,Qe;return Object(S.a)().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return $=z.group_id,Z=$===void 0?(W=v[0])===null||W===void 0?void 0:W.value:$,Fe=z.full_name,Be=Fe===void 0?"":Fe,fe.next=3,Lt(Z);case 3:if(ee=fe.sent,ae=v.find(function(Me){var ke=Me.value;return ke===Z}),!(!ee.success||ee.data[0]===void 0||u===null)){fe.next=8;break}return st.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ae==null?void 0:ae.label})),fe.abrupt("return",{data:[],total:0,success:!1});case 8:return fe.next=10,Promise.all([Object(vt.b)(Z),pt(Z),F({group_id:Z,per_page:-1}),yt(u,(je=ee.data)===null||je===void 0||(pe=je[0])===null||pe===void 0?void 0:pe.tutor_id),At(),Rt((A=ee.data)===null||A===void 0||(P=A[0])===null||P===void 0?void 0:P.s_subject_scale_form_id)]);case 10:if(Y=fe.sent,he=Object(D.a)(Y,6),we=he[0],ge=he[1],Ke=he[2],Q=he[3],R=he[4],re=he[5],!(!we.success||!ge.success||!Ke.success||!Q.success||!R.success||!re.success||!ae)){fe.next=21;break}return st.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ae==null?void 0:ae.label})),fe.abrupt("return",{data:[],total:0,success:!1});case 21:return l(ae.label),be=rr(ge.data),Ae=sr(Ke.data),Je=cr(R.data,re.data),y([be,Ae,Je,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Qe=we.data.users.reduce(function(Me,ke){var Re,dt,lt,ft=ke.id,jr=ke.academic_teacher_id,br=ke.first_name,mr=ke.last_name,zt="".concat(mr," ").concat(br);if(jr!==null||!zt.toLowerCase().includes(Be.toLowerCase()))return Me;var fr=nr(ge.data,ft),Jt=Kt(Ke.data,ft),ot=ir(ee.data,ft),vr=(Re=Ht((dt=ot==null?void 0:ot.s_subject_scale_form_id)!==null&&dt!==void 0?dt:0,(lt=Q.data.grade_scale)!==null&&lt!==void 0?lt:[]))!==null&&Re!==void 0?Re:[],Or=Wt(Jt,vr),pr=ur(Jt),hr=dr(ot);return[].concat(Object(I.a)(Me),[Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({id:ft,full_name:zt},fr),pr),hr),{},{proposed_grade:Or,final_grades:ot})])},[]).sort(function(Me,ke){return Me.full_name.localeCompare(ke.full_name)}),fe.abrupt("return",{data:Qe,total:Qe.length,success:!0});case 28:case"end":return fe.stop()}},T)}));return function(T){return E.apply(this,arguments)}}(),columns:_,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:h}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:p,pagination:{onChange:function(){var T;return(T=p.current)===null||T===void 0?void 0:T.reload()}},rowKey:"id"})},or=function(r){var a,n,t=r.tab,u=Object(s.l)(),d=Object(s.m)("@@initialState"),b=d.setInitialState,m=d.initialState,y=Object(k.b)(),g=y.teacherSubjectData,O=y.semester_subject_id,h=y.tutors,l=Object(j.useCallback)(Object(Ee.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(j.useMemo)(function(){return!!h.data.find(function(v){var p,_=v.id;return _===(m==null||(p=m.currentUser)===null||p===void 0?void 0:p.id)})||l(Ye.a.TeacherListGradeScale)},[]);return g?Object(e.jsx)(C.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:g==null||(a=g.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Ne.a,{to:"/teacher/subjects/".concat(O,"/exams?exam_id=new"),children:Object(e.jsx)(ne.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:u.formatMessage({id:"Teacher"})},{path:"subjects",breadcrumbName:u.formatMessage({id:"Subjects"})},{path:String(O),breadcrumbName:String((n=g.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:u.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(te.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(p){b(Object(o.a)({},m)),s.f.push("/teacher/subjects/".concat(O,"/").concat(p))}},children:[Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(xe.a,{})},"groups"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(la,{})},"students"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(ra,{})},"exams"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ga,{})},"schedule"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(lr,{})},"class-register"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(va,{})},"attendance"),f&&Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(ya,{})},"grades-scale"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Va,{})},"final-grades"),Object(e.jsx)(te.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(ka,{})},"file-exports-history")]})}):Object(e.jsx)(se.a,{})},Gr=ue.default=function(){var i=Object(q.l)(),r=i.subjectId,a=i.tab,n=a===void 0?"groups":a;return Object(e.jsx)(k.a,{semester_subject_id:Number(r),children:Object(e.jsx)(or,{tab:n})})}},p3I6:function(ut,ue,c){"use strict";c.d(ue,"b",function(){return Ee}),c.d(ue,"c",function(){return Pe}),c.d(ue,"a",function(){return it});var o=c("miYZ"),Oe=c("tsqr"),ne=c("tJVT"),M=c("k1fw"),se=c("oBTY"),j=c("q1tI"),qe=c.n(j),s=c("9kvl"),Ne=c("Ty5D"),q=c("H6aw"),te=c("/y+f"),C=c("nKUr"),Ye=c.n(C),Ee=qe.a.createContext({}),k=function(){return Math.round(Math.random()*99999)},xe=function ce(H){return H.reduce(function(N,F){return[].concat(Object(se.a)(N),Object(se.a)(F.lessons?ce(F.lessons):[]),[F])},[])},Pe=function ce(H){return H.reduce(function(N,F){var x;return[].concat(Object(se.a)(N),Object(se.a)(F.lessons?ce(F.lessons):[]),Object(se.a)((x=F.topics)!==null&&x!==void 0?x:[]))},[])},ct=function ce(H,N,F){return H.map(function(x){var Se,X;return Object(M.a)(Object(M.a)({},x),{},{lessons:x.lessons?ce(x.lessons,N,F):[],topics:x.id===N?[].concat(Object(se.a)((Se=x.topics)!==null&&Se!==void 0?Se:[]),[F]):(X=x.topics)!==null&&X!==void 0?X:[]})})},jt=function ce(H,N,F){return F?H.map(function(x){return Object(M.a)(Object(M.a)({},x),{},{lessons:[].concat(Object(se.a)(x.lessons?ce(x.lessons,N,F):[]),Object(se.a)(x.id===F?[N]:[]))})}):[].concat(Object(se.a)(H),[N])},We=function ce(H,N,F){return H.map(function(x){return Object(M.a)(Object(M.a)({},x.id===N?F:x),{},{lessons:x.lessons?ce(x.lessons,N,F):[]})})},S=function ce(H,N){return H.map(function(F){return Object(M.a)(Object(M.a)({},F),{},{parent_id:N,lessons:F.lessons?ce(F.lessons,F.id):[]})})},V=function ce(H,N){return H.filter(function(F){return F.id!==N}).map(function(F){return Object(M.a)(Object(M.a)({},F),{},{lessons:F.lessons?ce(F.lessons,N):[]})})},De=function ce(H,N){return H.map(function(F){return Object(M.a)(Object(M.a)({},F),{},{lessons:F.lessons?ce(F.lessons,N):[],topics:F.topics?F.topics.filter(function(x){return x.id!==N}):[]})})},nt=function ce(H,N,F,x){return x==null?void 0:x.map(function(Se){if(Se.id===F){var X;return Object(M.a)(Object(M.a)({},Se),{},{topics:(X=Se.topics)===null||X===void 0?void 0:X.map(function(ye){return ye.id===H?N.file.response.data:ye})})}else if(Se.lessons)return Object(M.a)(Object(M.a)({},Se),{},{lessons:ce(H,N,F,Se.lessons||[])});return Se})},it=function(H){var N=H.children,F=H.id,x=Object(j.useState)(),Se=Object(ne.a)(x,2),X=Se[0],ye=Se[1],at=Object(s.l)(),et=Object(j.useMemo)(function(){return X&&X.lessons?Pe(X.lessons):[]},[X]),_e=Object(j.useMemo)(function(){return X&&X.lessons?xe(X.lessons):[]},[X]),Ge=Object(j.useState)([]),Te=Object(ne.a)(Ge,2),$e=Te[0],Ie=Te[1],ie=Object(Ne.k)();Object(j.useEffect)(function(){Ie([])},[]);var de=Object(j.useCallback)(function(){Object(q.n)(F).then(function(L){return L.success&&ye(Object(M.a)(Object(M.a)({},L.data),{},{lessons:S(L.data.lessons)}))})},[F]);Object(j.useEffect)(function(){de()},[de]);var le=Object(j.useCallback)(function(L){var U=_e.find(function(I){var B;return I==null||(B=I.topics)===null||B===void 0?void 0:B.find(function(K){return K.id===L})});return U?U.id:null},[_e]),He=Object(j.useMemo)(function(){var L,U;return(L=ie.query)!==null&&L!==void 0&&L.lesson?{mode:"lesson",id:Number(ie.query.lesson),value:_e.find(function(I){return I.id===Number(ie.query.lesson)})}:(U=ie.query)!==null&&U!==void 0&&U.topic?{mode:"topic",id:Number(ie.query.topic),value:et.find(function(I){return I.id===Number(ie.query.topic)})}:{mode:"init"}},[ie.query,X,_e,et]),Ve=Object(j.useCallback)(function(L){var U={course_id:F,topics:[],isNew:!0,id:X?X.lessons.length+1:k(),order:0,title:at.formatMessage({id:"add_title_here"}),active:!0,parent_id:L};return ye(function(I){var B;return Object(M.a)(Object(M.a)({},I),{},{lessons:jt((B=I==null?void 0:I.lessons)!==null&&B!==void 0?B:[],U,L)})}),U},[F,X]),D=Object(j.useCallback)(function(L,U){var I=_e.find(function(K){return K.id===L}),B=I&&I.isNew;return(B?Object(q.g)(U):Object(q.v)(L,U)).then(function(K){return Oe.b.success(K.message),de(),K.success&&ye(function(J){var e;return Object(M.a)(Object(M.a)({},J),{},{lessons:We((e=J==null?void 0:J.lessons)!==null&&e!==void 0?e:[],L,Object(M.a)(Object(M.a)({},K.data),{},{isNew:!1}))})})})},[X]),Ce=Object(j.useCallback)(function(L){var U=_e.find(function(B){return B.id===L});if(!!U){var I=U.isNew;I?ye(function(B){var K;return Object(M.a)(Object(M.a)({},B),{},{lessons:V((K=B==null?void 0:B.lessons)!==null&&K!==void 0?K:[],L)})}):Object(q.p)(L).then(function(B){B.success&&(Oe.b.success(B.message),ye(function(K){var J;return Object(M.a)(Object(M.a)({},K),{},{lessons:V((J=K==null?void 0:K.lessons)!==null&&J!==void 0?J:[],L)})}))})}},[X]),me=Object(j.useCallback)(function(L,U){var I,B=le(L),K=_e.find(function(Ue){return Ue.id===B}),J=K&&((I=K.topics)===null||I===void 0?void 0:I.find(function(Ue){return Ue.id===L})),e=J==null?void 0:J.isNew;return(e?Object(q.h)(U):Object(q.w)(L,U)).then(function(Ue){Ue.success&&(Oe.b.success(Ue.message),de(),s.f.push("/courses/list/".concat(F,"/program/?topic=").concat(Ue.data.id)),(J==null?void 0:J.topicable_type)===te.h.Video&&setTimeout(function(){de()},5e3))})},[le,X,de]),ve=Object(j.useCallback)(function(L){var U=le(L),I=_e.find(function(J){return J.id===U});if(!!I){var B=et==null?void 0:et.find(function(J){return J.id===L}),K=B==null?void 0:B.isNew;K&&!B.topicable?ye(function(J){var e;return Object(M.a)(Object(M.a)({},J),{},{lessons:De((e=J==null?void 0:J.lessons)!==null&&e!==void 0?e:[],L)})}):Object(q.q)(L).then(function(J){J.success&&(Oe.b.success(J.message),ye(function(e){var Ue;return Object(M.a)(Object(M.a)({},e),{},{lessons:De((Ue=e==null?void 0:e.lessons)!==null&&Ue!==void 0?Ue:[],L)})}))})}},[X,le]),w=Object(j.useCallback)(function(L,U){var I={lesson_id:L,isNew:!0,id:k(),title:at.formatMessage({id:"add_title_here"}),active:!0,topicable_type:U};return ye(function(B){var K;return Object(M.a)(Object(M.a)({},B),{},{lessons:ct((K=B==null?void 0:B.lessons)!==null&&K!==void 0?K:[],L,I)})}),I},[]),G=function(U,I){var B=le(U);ye(function(K){return Object(M.a)(Object(M.a)({},K),{},{lessons:K?nt(U,I,B,K.lessons||[]):[]})}),s.f.push("/courses/list/".concat(F,"/program/?topic=").concat(I.file.response.data.id))},Le=Object(j.useCallback)(function(L){return Object(q.d)(L).then(function(U){if(U.success){Oe.b.success(U.message);var I=le(L);ye(function(B){var K;return Object(M.a)(Object(M.a)({},B),{},{lessons:B?(K=B.lessons)===null||K===void 0?void 0:K.map(function(J){if(J.id===I){var e=J.topics||[];return Object(M.a)(Object(M.a)({},J),{},{topics:[].concat(Object(se.a)(e),[U.data])})}return J}):[]})})}})},[X,le]),Xe=Object(j.useCallback)(function(L){return Object(q.c)(L).then(function(U){U.success&&(Oe.b.success(U.message),ye(function(I){return Object(M.a)(Object(M.a)({},I),{},{lessons:I?[].concat(Object(se.a)(I.lessons),[U.data]):[]})}))})},[]),oe={state:X,h5ps:$e,id:F,addNewLesson:Ve,updateLesson:D,updateTopic:me,deleteLesson:Ce,addNewTopic:w,deleteTopic:ve,onTopicUploaded:G,cloneTopic:Le,cloneLesson:Xe,currentEditMode:He,getLessons:de};return Object(C.jsx)(Ee.Provider,{value:oe,children:N})}},"w/VK":function(ut,ue,c){"use strict";c.d(ue,"c",function(){return se}),c.d(ue,"a",function(){return qe}),c.d(ue,"b",function(){return Ne});var o=c("qLMh"),Oe=c("k1fw"),ne=c("9og8"),M=c("9kvl");function se(te,C){return j.apply(this,arguments)}function j(){return j=Object(ne.a)(Object(o.a)().mark(function te(C,Ye){return Object(o.a)().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",Object(M.i)("/api/admin/reports/report",Object(Oe.a)({params:C,method:"GET",useCache:!1},Ye||{})));case 1:case"end":return k.stop()}},te)})),j.apply(this,arguments)}function qe(te,C,Ye){return s.apply(this,arguments)}function s(){return s=Object(ne.a)(Object(o.a)().mark(function te(C,Ye,Ee){return Object(o.a)().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.abrupt("return",Object(M.i)("/api/admin/stats/course/".concat(C,"/export"),Object(Oe.a)({params:Ye,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return xe.stop()}},te)})),s.apply(this,arguments)}function Ne(te,C,Ye){return q.apply(this,arguments)}function q(){return q=Object(ne.a)(Object(o.a)().mark(function te(C,Ye,Ee){return Object(o.a)().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.abrupt("return",Object(M.i)("/api/admin/stats/topic/".concat(C,"/export"),Object(Oe.a)({method:"GET",useCache:!1,params:{stat:Ye},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ee||{})));case 1:case"end":return xe.stop()}},te)})),q.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.3da3e27f.async.js.map