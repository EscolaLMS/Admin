{"version":3,"sources":["webpack:///./src/components/H5P/upload.tsx","webpack:///./src/pages/H5P/index.tsx","webpack:///./src/services/escola-lms/h5p.ts"],"names":["UploadH5P","onSuccess","onError","hideLabel","info","file","status","response","TableList","useState","loading","setLoading","actionRef","useRef","intl","useIntl","handleRemove","useCallback","id","hide","removeH5P","success","current","reload","error","columns","title","dataIndex","sorter","search","width","hideInSearch","hideInTable","renderFormItem","a","b","length","render","dom","entity","library","count_h5p","valueType","_","record","split","join","toLocaleLowerCase","formatMessage","defaultMessage","layout","sort","pageSize","library_id","h5p","per_page","page","createTableOrderObject","then","data","total","meta","params","options","request","method","editorSettings","lang","url","contentSettings","body","headers"],"mappings":"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","file":"p__H5P.1d4da4c8.async.js","sourcesContent":["import SecureUpload from '@/components/SecureUpload';\nimport React from 'react';\n\nexport const UploadH5P: React.FC<{\n  onSuccess: (response: any) => void;\n  onError: () => void;\n  hideLabel?: boolean;\n}> = ({ onSuccess, onError, hideLabel }) => {\n  return (\n    <SecureUpload\n      url=\"/api/admin/hh5p/content/upload\"\n      name=\"h5p_file\"\n      accept=\".h5p\"\n      hideLabel={hideLabel}\n      onChange={(info) => {\n        if (info.file.status === 'done') {\n          if (info.file.response) {\n            onSuccess(info.file.response);\n          }\n        }\n        if (info.file.status === 'error') {\n          onError();\n        }\n      }}\n    />\n  );\n};\n\nexport default UploadH5P;\n","import { PlusOutlined } from '@ant-design/icons';\nimport { Button, Tooltip, Popconfirm, message } from 'antd';\nimport React, { useState, useRef, useCallback } from 'react';\nimport { useIntl, FormattedMessage, Link } from 'umi';\nimport { PageContainer } from '@ant-design/pro-layout';\nimport type { ProColumns, ActionType } from '@ant-design/pro-table';\nimport ProTable from '@ant-design/pro-table';\nimport { h5p, removeH5P } from '@/services/escola-lms/h5p';\nimport { DeleteOutlined, EditOutlined, BookOutlined, ExportOutlined } from '@ant-design/icons';\nimport UploadH5P from '@/components/H5P/upload';\nimport AuthenticatedLinkButton from '@/components/AuthenticatedLinkButton';\nimport { createTableOrderObject } from '@/utils/utils';\n\nconst TableList: React.FC = () => {\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const actionRef = useRef<ActionType>();\n\n  const intl = useIntl();\n\n  const handleRemove = useCallback(\n    async (id: number) => {\n      setLoading(true);\n      const hide = message.loading(<FormattedMessage id=\"loading\" defaultMessage=\"loading\" />);\n      try {\n        await removeH5P(id);\n        hide();\n        message.success(<FormattedMessage id=\"success\" defaultMessage=\"success\" />);\n        setLoading(false);\n        actionRef.current?.reload();\n        return true;\n      } catch (error) {\n        hide();\n        message.error(<FormattedMessage id=\"error\" defaultMessage=\"error\" />);\n        setLoading(false);\n        return false;\n      }\n    },\n    [actionRef],\n  );\n\n  const columns: ProColumns<API.H5PContentListItem>[] = [\n    {\n      title: <FormattedMessage id=\"ID\" defaultMessage=\"ID\" />,\n      dataIndex: 'id',\n      sorter: true,\n      search: false,\n      width: '80px',\n    },\n    {\n      title: <FormattedMessage id=\"newH5P\" defaultMessage=\"newH5P\" />,\n      dataIndex: 'upload',\n      hideInSearch: false,\n      hideInTable: true,\n\n      renderFormItem: () => [\n        <UploadH5P\n          key={'upload'}\n          hideLabel\n          onSuccess={() => {\n            if (actionRef.current) {\n              actionRef.current.reload();\n            }\n            message.success(\n              <FormattedMessage id=\"H5P_uploaded\" defaultMessage=\"new H5P uploaded successfully\" />,\n            );\n          }}\n          onError={() => message.error(<FormattedMessage id=\"error\" defaultMessage=\"error\" />)}\n        />,\n      ],\n    },\n    {\n      title: <FormattedMessage id=\"title\" defaultMessage=\"title\" />,\n      dataIndex: 'title',\n      sorter: (a, b) => a.title.length - b.title.length,\n      render: (dom, entity) => {\n        return entity.title;\n      },\n    },\n    {\n      title: <FormattedMessage id=\"library\" defaultMessage=\"library\" />,\n      dataIndex: 'library',\n      sorter: (a, b) => a.library.title.length - b.library.title.length,\n      search: false,\n      render: (dom, entity) => {\n        return entity.library.title;\n      },\n    },\n    {\n      title: <FormattedMessage id=\"library_id\" defaultMessage=\"library_id\" />,\n      dataIndex: 'library_id',\n      sorter: (a, b) => a.library.id - b.library.id,\n      render: (dom, entity) => {\n        return entity.library.id;\n      },\n    },\n    {\n      title: <FormattedMessage id=\"count_h5p\" defaultMessage=\"count_h5p\" />,\n      dataIndex: 'count_h5p',\n      sorter: (a, b) => a.count_h5p - b.count_h5p,\n      search: false,\n      render: (dom, entity) => {\n        return entity.count_h5p;\n      },\n    },\n    {\n      title: <FormattedMessage id=\"options\" defaultMessage=\"options\" />,\n      dataIndex: 'option',\n      valueType: 'option',\n      render: (_, record) => [\n        <Link key={'edit'} to={`/courses/h5ps/${record.id}`}>\n          <Tooltip title={<FormattedMessage id=\"edit\" defaultMessage=\"edit\" />}>\n            <Button type=\"primary\" icon={<EditOutlined />} />\n          </Tooltip>\n        </Link>,\n\n        <Popconfirm\n          key={'delete'}\n          disabled={record.count_h5p !== 0}\n          title={\n            <FormattedMessage\n              id=\"deleteQuestion\"\n              defaultMessage=\"Are you sure to delete this record?\"\n            />\n          }\n          onConfirm={() => record.id && handleRemove(record.id)}\n          okText={<FormattedMessage id=\"yes\" defaultMessage=\"Yes\" />}\n          cancelText={<FormattedMessage id=\"no\" defaultMessage=\"No\" />}\n        >\n          <Tooltip title={<FormattedMessage id=\"delete\" defaultMessage=\"delete\" />}>\n            <Button\n              disabled={record.count_h5p !== 0}\n              type=\"primary\"\n              icon={<DeleteOutlined />}\n              danger\n            />\n          </Tooltip>\n        </Popconfirm>,\n        <Link key={'preview'} to={`/courses/h5ps/preview/${record.id}`}>\n          <Tooltip title={<FormattedMessage id=\"preview\" defaultMessage=\"preview\" />}>\n            <Button icon={<BookOutlined />} />\n          </Tooltip>\n        </Link>,\n        <Tooltip title={<FormattedMessage id=\"export\" defaultMessage=\"export\" />} key={'export'}>\n          <AuthenticatedLinkButton\n            url={`/api/admin/hh5p/content/${record.id}/export`}\n            filename={`${record.title.split(' ').join('-').toLocaleLowerCase()}.h5p`}\n            icon={<ExportOutlined />}\n          />\n        </Tooltip>,\n      ],\n    },\n  ];\n\n  return (\n    <PageContainer>\n      <ProTable<API.H5PContentListItem, API.H5PListParams>\n        loading={loading}\n        headerTitle={intl.formatMessage({\n          id: 'menu.Courses.H5Ps',\n          defaultMessage: 'H5Ps List',\n        })}\n        actionRef={actionRef}\n        rowKey=\"id\"\n        search={{\n          layout: 'vertical',\n        }}\n        toolBarRender={() => [\n          <Link to=\"/courses/h5ps/new\" key={'new'}>\n            <Button type=\"primary\" key=\"primary\">\n              <PlusOutlined /> <FormattedMessage id=\"new\" defaultMessage=\"new\" />\n            </Button>\n          </Link>,\n        ]}\n        request={({ pageSize, current, title, library_id }, sort) => {\n          setLoading(true);\n\n          return h5p({\n            title,\n            library_id,\n            per_page: pageSize,\n            page: current,\n            ...createTableOrderObject(sort),\n          }).then((response) => {\n            setLoading(false);\n            if (response.success) {\n              return {\n                data: response.data,\n                total: response.meta.total,\n                success: true,\n              };\n            }\n            return [];\n          });\n        }}\n        columns={columns}\n      />\n    </PageContainer>\n  );\n};\n\nexport default TableList;\n","import { request } from 'umi';\nimport type { RequestOptionsInit } from 'umi-request';\n\nexport async function h5p(params: API.H5PListParams, options?: RequestOptionsInit) {\n  return request<API.DefaultMetaResponse<API.H5PContentListItem>>(`/api/admin/hh5p/content`, {\n    method: 'GET',\n    params,\n    ...(options || {}),\n  });\n}\n\nexport async function getH5p(id: number, options?: RequestOptionsInit) {\n  return request<API.DefaultResponse<API.H5PObject>>(`/api/admin/hh5p/content/${id}`, {\n    method: 'GET',\n    ...(options || {}),\n  });\n}\n\nexport const editorSettings = (\n  id?: string | number,\n  lang: string = 'en',\n  options?: RequestOptionsInit,\n) => {\n  let url: string = id ? `/api/admin/hh5p/editor/${id}` : `/api/admin/hh5p/editor`;\n  url = lang ? `${url}?lang=${lang}` : url;\n  return request<API.DefaultResponse<API.H5PObject>>(url, {\n    method: 'GET',\n    ...(options || {}),\n  });\n};\n\nexport const contentSettings = (\n  id?: string | number,\n  lang: string = 'en',\n  options?: RequestOptionsInit,\n) => {\n  let url: string = `/api/admin/hh5p/content/${id}`;\n  url = lang ? `${url}?lang=${lang}` : url;\n  return request<API.DefaultResponse<API.H5PObject>>(url, {\n    method: 'GET',\n    ...(options || {}),\n  });\n};\n\nexport async function updateContent(\n  body: any,\n  id?: number | string | undefined,\n  options?: RequestOptionsInit,\n) {\n  return request<API.DefaultResponse<{ id: number }>>(\n    id ? `/api/admin/hh5p/content/${id}` : `/api/admin/hh5p/content`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      data: body,\n      ...(options || {}),\n    },\n  );\n}\n\nexport async function removeH5P(id: number) {\n  return request<API.DefaultResponse<unknown>>(`/api/admin/hh5p/content/${id}`, {\n    method: 'DELETE',\n  });\n}\n\nexport async function allContent(options?: RequestOptionsInit) {\n  return request<API.DefaultMetaResponse<API.H5PContentListItem>>(\n    '/api/admin/hh5p/content?per_page=0',\n    {\n      method: 'GET',\n      ...(options || {}),\n    },\n  );\n}\n"],"sourceRoot":""}