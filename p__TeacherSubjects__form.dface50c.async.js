"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803,8047],{56717:function(Tt,qe,u){var Xe=u(1413),m=u(67294),Ke=u(93696),Ze=u(84089),_e=function(g,v){return m.createElement(Ze.Z,(0,Xe.Z)((0,Xe.Z)({},g),{},{ref:v,icon:Ke.Z}))},B=m.forwardRef(_e);qe.Z=B},78677:function(Tt,qe,u){var Xe=u(67294),m=u(76390),Ke=function(){return Ke=Object.assign||function(_e){for(var B,Oe=1,g=arguments.length;Oe<g;Oe++){B=arguments[Oe];for(var v in B)Object.prototype.hasOwnProperty.call(B,v)&&(_e[v]=B[v])}return _e},Ke.apply(this,arguments)},Ze=(0,Xe.forwardRef)(function(_e,B){return Xe.createElement(m.P,Ke({},_e,{chartType:"Column",ref:B}))});qe.Z=Ze},88280:function(Tt,qe,u){u.d(qe,{Z:function(){return ie}});var Xe=u(4942),m=u(97685),Ke=u(45987),Ze=u(74165),_e=u(15861),B=u(1413),Oe=u(87462),g=u(67294),v=u(42110),s=u(78026),ee=function(F,e){return g.createElement(s.Z,(0,Oe.Z)({},F,{ref:e,icon:v.Z}))},d=g.forwardRef(ee),P=d,i=u(97462),y=u(952),I=u(10915),ae=u(48171),Z=u(53914),H=u(22270),be=u(60249),he=u(14726),je=u(75842),Ve=u(21770),at=u(88306),pt=u(8880),gt=u(48433),Ie=u(85893),Ft=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],xt=["record","position","creatorButtonText","newRecordType","parentKey","style"],ye=g.createContext(void 0);function T(b){var F=b.children,e=b.record,Ge=b.position,we=b.newRecordType,de=b.parentKey,ke=(0,g.useContext)(ye);return g.cloneElement(F,(0,B.Z)((0,B.Z)({},F.props),{},{onClick:function(){var Ne=(0,_e.Z)((0,Ze.Z)().mark(function Ce(He){var Be,Re,ve,me;return(0,Ze.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(Be=(Re=F.props).onClick)===null||Be===void 0?void 0:Be.call(Re,He);case 2:if(me=W.sent,me!==!1){W.next=5;break}return W.abrupt("return");case 5:ke==null||(ve=ke.current)===null||ve===void 0||ve.addEditRecord(e,{position:Ge,newRecordType:we,parentKey:de});case 6:case"end":return W.stop()}},Ce)}));function Me(Ce){return Ne.apply(this,arguments)}return Me}()}))}function le(b){var F,e,Ge=(0,I.YB)(),we=b.onTableChange,de=b.maxLength,ke=b.formItemProps,Ne=b.recordCreatorProps,Me=b.rowKey,Ce=b.controlled,He=b.defaultValue,Be=b.onChange,Re=b.editableFormRef,ve=(0,Ke.Z)(b,Ft),me=(0,g.useRef)(void 0),ne=(0,g.useRef)(),W=(0,g.useRef)();(0,g.useImperativeHandle)(ve.actionRef,function(){return ne.current},[ne.current]);var w=(0,Ve.Z)(function(){return b.value||He||[]},{value:b.value,onChange:b.onChange}),De=(0,m.Z)(w,2),ue=De[0],Et=De[1],et=g.useMemo(function(){return typeof Me=="function"?Me:function(U,te){return U[Me]||te}},[Me]),jt=(0,ae.J)(function(U){if(typeof U=="number"&&!b.name){if(U>=ue.length)return U;var te=ue&&ue[U];return et==null?void 0:et(te,U)}if((typeof U=="string"||U>=ue.length)&&b.name){var ce=ue.findIndex(function(fe,ge){var Te;return(et==null||(Te=et(fe,ge))===null||Te===void 0?void 0:Te.toString())===(U==null?void 0:U.toString())});if(ce!==-1)return ce}return U});(0,g.useImperativeHandle)(Re,function(){var U=function(fe){var ge,Te;if(fe==null)throw new Error("rowIndex is required");var Ye=jt(fe),st=[b.name,(ge=Ye==null?void 0:Ye.toString())!==null&&ge!==void 0?ge:""].flat(1).filter(Boolean);return(Te=W.current)===null||Te===void 0?void 0:Te.getFieldValue(st)},te=function(){var fe,ge=[b.name].flat(1).filter(Boolean);if(Array.isArray(ge)&&ge.length===0){var Te,Ye=(Te=W.current)===null||Te===void 0?void 0:Te.getFieldsValue();return Array.isArray(Ye)?Ye:Object.keys(Ye).map(function(st){return Ye[st]})}return(fe=W.current)===null||fe===void 0?void 0:fe.getFieldValue(ge)};return(0,B.Z)((0,B.Z)({},W.current),{},{getRowData:U,getRowsData:te,setRowData:function(fe,ge){var Te,Ye;if(fe==null)throw new Error("rowIndex is required");var st=jt(fe),yt=[b.name,(Te=st==null?void 0:st.toString())!==null&&Te!==void 0?Te:""].flat(1).filter(Boolean),Gt=Object.assign({},(0,B.Z)((0,B.Z)({},U(fe)),ge||{})),tt=(0,pt.Z)({},yt,Gt);return(Ye=W.current)===null||Ye===void 0||Ye.setFieldsValue(tt),!0}})},[jt,b.name,W.current]),(0,g.useEffect)(function(){b.controlled&&(ue||[]).forEach(function(U,te){var ce;(ce=W.current)===null||ce===void 0||ce.setFieldsValue((0,Xe.Z)({},"".concat(et(U,te)),U))},{})},[(0,Z.ZP)(ue),b.controlled]),(0,g.useEffect)(function(){if(b.name){var U;W.current=b==null||(U=b.editable)===null||U===void 0?void 0:U.form}},[(F=b.editable)===null||F===void 0?void 0:F.form,b.name]);var rt=Ne||{},Rt=rt.record,bt=rt.position,Pt=rt.creatorButtonText,Zt=rt.newRecordType,Dt=rt.parentKey,It=rt.style,N=(0,Ke.Z)(rt,xt),J=bt==="top",V=(0,g.useMemo)(function(){return typeof de=="number"&&de<=(ue==null?void 0:ue.length)?!1:Ne!==!1&&(0,Ie.jsx)(T,{record:(0,H.h)(Rt,ue==null?void 0:ue.length,ue)||{},position:bt,parentKey:(0,H.h)(Dt,ue==null?void 0:ue.length,ue),newRecordType:Zt,children:(0,Ie.jsx)(he.ZP,(0,B.Z)((0,B.Z)({type:"dashed",style:(0,B.Z)({display:"block",margin:"10px 0",width:"100%"},It),icon:(0,Ie.jsx)(P,{})},N),{},{children:Pt||Ge.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ne,de,ue==null?void 0:ue.length]),X=(0,g.useMemo)(function(){return V?J?{components:{header:{wrapper:function(te){var ce,fe=te.className,ge=te.children;return(0,Ie.jsxs)("thead",{className:fe,children:[ge,(0,Ie.jsxs)("tr",{style:{position:"relative"},children:[(0,Ie.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:V}),(0,Ie.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ce=ve.columns)===null||ce===void 0?void 0:ce.length,children:V})]})]})}}}}:{tableViewRender:function(te,ce){var fe,ge;return(0,Ie.jsxs)(Ie.Fragment,{children:[(fe=(ge=b.tableViewRender)===null||ge===void 0?void 0:ge.call(b,te,ce))!==null&&fe!==void 0?fe:ce,V]})}}:{}},[J,V]),K=(0,B.Z)({},b.editable),Q=(0,ae.J)(function(U,te){var ce,fe,ge;if((ce=b.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,U,te),(ge=b.onValuesChange)===null||ge===void 0||ge.call(b,te,U),b.controlled){var Te;b==null||(Te=b.onChange)===null||Te===void 0||Te.call(b,te)}});return(b!=null&&b.onValuesChange||(e=b.editable)!==null&&e!==void 0&&e.onValuesChange||b.controlled&&b!==null&&b!==void 0&&b.onChange)&&(K.onValuesChange=Q),(0,Ie.jsxs)(Ie.Fragment,{children:[(0,Ie.jsx)(ye.Provider,{value:ne,children:(0,Ie.jsx)(gt.Z,(0,B.Z)((0,B.Z)((0,B.Z)({search:!1,options:!1,pagination:!1,rowKey:Me,revalidateOnFocus:!1},ve),X),{},{tableLayout:"fixed",actionRef:ne,onChange:we,editable:(0,B.Z)((0,B.Z)({},K),{},{formProps:(0,B.Z)({formRef:W},K.formProps)}),dataSource:ue,onDataSourceChange:function(te){if(Et(te),b.name&&bt==="top"){var ce,fe=(0,pt.Z)({},[b.name].flat(1).filter(Boolean),te);(ce=W.current)===null||ce===void 0||ce.setFieldsValue(fe)}}}))}),b.name?(0,Ie.jsx)(i.Z,{name:[b.name],children:function(te){var ce,fe;if(!me.current)return me.current=ue,null;var ge=(0,at.Z)(te,[b.name].flat(1)),Te=ge==null?void 0:ge.find(function(Ye,st){var yt;return!(0,be.A)(Ye,(yt=me.current)===null||yt===void 0?void 0:yt[st])});return me.current=ue,Te&&(b==null||(ce=b.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,Te,ge)),null}}):null]})}function O(b){var F=y.ZP.useFormInstance();return b.name?(0,Ie.jsx)(je.Z.Item,(0,B.Z)((0,B.Z)({style:{maxWidth:"100%"}},b==null?void 0:b.formItemProps),{},{name:b.name,shouldUpdate:function(Ge,we){var de=[b.name].flat(1);try{return JSON.stringify((0,at.Z)(Ge,de))!==JSON.stringify((0,at.Z)(we,de))}catch(ke){return!0}},children:(0,Ie.jsx)(le,(0,B.Z)((0,B.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},b),{},{editable:(0,B.Z)((0,B.Z)({},b.editable),{},{form:F})}))})):(0,Ie.jsx)(le,(0,B.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},b))}O.RecordCreator=T;var ie=O},11312:function(Tt,qe,u){u.d(qe,{nu:function(){return F},rL:function(){return b},Du:function(){return ie}});var Xe=u(9783),m=u.n(Xe),Ke=u(97857),Ze=u.n(Ke),_e=u(19632),B=u.n(_e),Oe=u(5574),g=u.n(Oe),v=u(45919),s=u(66419),ee=u(78677),d=u(26271),P=u(78957),i=u(66309),y=u(72051),I=u(71230),ae=u(72269),Z=u(74656),H=u(60943),be=u(67294),he=u(70804),je=u(80854),Ve=u(62235),at=u(15009),pt=u.n(at),gt=u(99289),Ie=u.n(gt),Ft=u(58638),xt=u(14726),ye=u(76841),T=u(85893),le=function(Ge){var we=Ge.course_id,de=Ge.stat,ke=de===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":de,Ne=(0,be.useState)(!1),Me=g()(Ne,2),Ce=Me[0],He=Me[1],Be=(0,be.useCallback)(function(Re){return Ie()(pt()().mark(function ve(){var me,ne;return pt()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return He(!0),w.prev=1,w.next=4,(0,ye._g)(Re,{stat:ke});case 4:me=w.sent,me instanceof Blob&&(ne=document.createElement("a"),ne.href=window.URL.createObjectURL(me),ne.download="finished_topics_".concat(we,".xlsx"),document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)),w.next=11;break;case 8:w.prev=8,w.t0=w.catch(1),console.error(w.t0);case 11:return w.prev=11,He(!1),w.finish(11);case 14:case"end":return w.stop()}},ve,null,[[1,8,11,14]])}))},[ke]);return(0,T.jsxs)(xt.ZP,{type:"primary",loading:Ce,onClick:Be(we),children:[(0,T.jsx)(Ft.Z,{})," ",(0,T.jsx)(je.FormattedMessage,{id:"export"})]})},O=function(Ge){return Ge.topicable.content.contents?Object.values(Ge.topicable.content.contents)[0].library:"H5P"},ie=function(Ge){var we=Ge.course_id,de=Ge.topics,ke=Ge.stats,Ne=(0,be.useState)(!1),Me=g()(Ne,2),Ce=Me[0],He=Me[1],Be=(0,be.useMemo)(function(){return[{title:(0,T.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(me){return(0,T.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:me})}},{title:(0,T.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(B()(de.map(function(ve){var me,ne=(me=ve.topicable_type)===null||me===void 0?void 0:me.split("\\").pop();return ne==="H5P"&&(ne=O(ve)),{render:function(w){var De=0;switch(w&&(w.started_at&&w.finished_at?De=1:w.started_at&&(De=2)),De){case 1:return(0,T.jsxs)(P.Z,{children:[(0,T.jsx)(i.Z,{color:"success",children:"F"}),Ce&&(w==null?void 0:w.seconds)&&(0,T.jsx)("small",{children:(0,s.Im)(w.seconds)})]});case 2:return(0,T.jsxs)(P.Z,{children:[(0,T.jsx)(i.Z,{color:"blue",children:"S"}),Ce&&(w==null?void 0:w.seconds)&&(0,T.jsx)("small",{children:(0,s.Im)(w.seconds)})]});case 0:default:return(0,T.jsx)(be.Fragment,{children:(0,T.jsx)(i.Z,{color:"error",children:"N"})})}},title:(0,T.jsxs)("small",{children:[(0,T.jsx)(i.Z,{children:ne})," ",ve.title]}),dataIndex:ve.id}})))},[de,Ce]),Re=(0,be.useMemo)(function(){return ke.map(function(ve){return de.reduce(function(me,ne){var W=ve.topics.find(function(w){return w.id===ne.id});return Ze()(Ze()({},me),{},m()({},Number(ne.id),W!=null?W:0))},{email:ve.email,id:ve.id})})},[ke,de]);return(0,T.jsx)(y.Z,{title:function(){return(0,T.jsxs)(I.Z,{justify:"space-between",align:"middle",children:[(0,T.jsxs)(P.Z,{children:[(0,T.jsx)(je.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,T.jsx)(i.Z,{color:"success",children:"F"}),(0,T.jsx)(je.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,T.jsx)(i.Z,{color:"blue",children:"S"}),(0,T.jsx)(je.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,T.jsx)(i.Z,{color:"error",children:"N"}),(0,T.jsx)(je.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,T.jsx)(ae.Z,{checked:Ce,onChange:function(ne){return He(ne)}})]}),(0,T.jsx)(le,{course_id:we})]})},columns:Be,dataSource:Re,size:"small",scroll:{x:1500},components:{table:function(me){return(0,T.jsx)(he.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,T.jsx)("table",Ze()({},me))})}}})},b=function(Ge){var we=Ge.stats,de=Ge.attempts,ke=(0,be.useMemo)(function(){return[{title:(0,T.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(Ce){return(0,T.jsx)(Ve.Z,{type:"App\\Models\\User",type_id:Ce})}},{title:(0,T.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,T.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,T.jsx)(je.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Ce){return Ce?(0,H.WU)(new Date(Ce),v.Cu):""}}]},[]),Ne=(0,be.useMemo)(function(){return we.map(function(Me){var Ce=Me.id,He=Me.email,Be=Me.finished_at,Re=de==null?void 0:de.find(function(me){return me.id===Ce}),ve=Array.isArray(Re==null?void 0:Re.attempts)?Re==null?void 0:Re.attempts.length:0;return{id:Ce,email:He,finished_at:Be,attempt:ve}})},[we]);return(0,T.jsx)(y.Z,{title:function(){return(0,T.jsx)(P.Z,{children:(0,T.jsx)(je.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:ke,dataSource:Ne,size:"small",scroll:{x:500}})},F=function(Ge){var we=Ge.stats,de=(0,be.useState)(null),ke=g()(de,2),Ne=ke[0],Me=ke[1],Ce=(0,be.useState)(null),He=g()(Ce,2),Be=He[0],Re=He[1],ve=(0,je.useIntl)(),me=(0,be.useMemo)(function(){return we.flatMap(function(W){return Object.values(W.attempts).flatMap(function(w){var De=w.dates,ue=w.attempt,Et=Object.values(De).flatMap(function(et){var jt=et.date,rt=et.seconds_total;return{date:jt,attempt:ue,seconds_total:rt,email:W.email}});return Et})})},[we]),ne={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,T.jsx)(d.ZP,{title:(0,T.jsxs)(P.Z,{children:[(0,T.jsx)(je.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,T.jsx)(Z.default,{showSearch:!0,value:Ne,onChange:function(w){Me(w),Re(null)},placeholder:(0,T.jsx)(je.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:we.map(function(W){var w=W.id,De=W.email;return(0,T.jsx)(Z.default.Option,{value:De,children:De},w)})}),(0,T.jsx)(Z.default,{value:Be,onChange:function(w){return Re(w)},disabled:Ne===null,placeholder:(0,T.jsx)(je.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:B()(new Set(me.filter(function(W){var w=W.email;return w===Ne}).map(function(W){var w=W.attempt;return w}))).map(function(W){return(0,T.jsxs)(Z.default.Option,{value:W,children:[(0,T.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",W]},W)})})]}),colSpan:12,layout:"center",children:(0,T.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,T.jsx)(ee.Z,Ze()(Ze()({},ne),{},{tooltip:{title:"".concat(ve.formatMessage({id:"attempt"})),formatter:function(w){var De=Math.floor(+w.seconds_total/60),ue=+w.seconds_total>60?+w.seconds_total-De*60:0;return{name:w.attempt,value:"".concat(De,"m ").concat(ue,"s")}}},data:me.filter(function(W){var w=W.email;return w===Ne}).filter(function(W){var w=W.attempt;return Number.isInteger(Be)?w===Be:!0})}))})})}},87366:function(Tt,qe,u){u.d(qe,{Il:function(){return xt},_y:function(){return Z},uS:function(){return he}});var Xe=u(15009),m=u.n(Xe),Ke=u(99289),Ze=u.n(Ke),_e=u(5574),B=u.n(_e),Oe=u(97857),g=u.n(Oe),v=u(19632),s=u.n(v),ee=u(2453),d=u(67294),P=u(80854),i=u(99100),y=u(31472),I=u(36309),ae=u(85893),Z=d.createContext({}),H=function(){return Math.round(Math.random()*99999)},be=function ye(T){return T.reduce(function(le,O){return[].concat(s()(le),s()(O.lessons?ye(O.lessons):[]),[O])},[])},he=function ye(T){return T.reduce(function(le,O){var ie;return[].concat(s()(le),s()(O.lessons?ye(O.lessons):[]),s()((ie=O.topics)!==null&&ie!==void 0?ie:[]))},[])},je=function ye(T,le,O){return T.map(function(ie){var b,F;return g()(g()({},ie),{},{lessons:ie.lessons?ye(ie.lessons,le,O):[],topics:ie.id===le?[].concat(s()((b=ie.topics)!==null&&b!==void 0?b:[]),[O]):(F=ie.topics)!==null&&F!==void 0?F:[]})})},Ve=function ye(T,le,O){return O?T.map(function(ie){return g()(g()({},ie),{},{lessons:[].concat(s()(ie.lessons?ye(ie.lessons,le,O):[]),s()(ie.id===O?[le]:[]))})}):[].concat(s()(T),[le])},at=function ye(T,le,O){return T.map(function(ie){return g()(g()({},ie.id===le?O:ie),{},{lessons:ie.lessons?ye(ie.lessons,le,O):[]})})},pt=function ye(T,le){return T.map(function(O){return g()(g()({},O),{},{parent_id:le,lessons:O.lessons?ye(O.lessons,O.id):[]})})},gt=function ye(T,le){return T.filter(function(O){return O.id!==le}).map(function(O){return g()(g()({},O),{},{lessons:O.lessons?ye(O.lessons,le):[]})})},Ie=function ye(T,le){return T.map(function(O){return g()(g()({},O),{},{lessons:O.lessons?ye(O.lessons,le):[],topics:O.topics?O.topics.filter(function(ie){return ie.id!==le}):[]})})},Ft=function ye(T,le,O,ie){return ie==null?void 0:ie.map(function(b){if(b.id===O){var F;return g()(g()({},b),{},{topics:(F=b.topics)===null||F===void 0?void 0:F.map(function(e){return e.id===T?le.file.response.data:e})})}else if(b.lessons)return g()(g()({},b),{},{lessons:ye(T,le,O,b.lessons||[])});return b})},xt=function(T){var le=T.children,O=T.id,ie=(0,d.useState)(),b=B()(ie,2),F=b[0],e=b[1],Ge=(0,P.useIntl)(),we=(0,d.useMemo)(function(){return F&&F.lessons?he(F.lessons):[]},[F]),de=(0,d.useMemo)(function(){return F&&F.lessons?be(F.lessons):[]},[F]),ke=(0,d.useState)([]),Ne=B()(ke,2),Me=Ne[0],Ce=Ne[1],He=(0,d.useState)(!1),Be=B()(He,2),Re=Be[0],ve=Be[1],me=(0,P.useLocation)(),ne=(0,d.useMemo)(function(){var N=new URLSearchParams(me.search);return{lesson:N.get("lesson"),topic:N.get("topic")}},[me]),W=(0,d.useCallback)(Ze()(m()().mark(function N(){var J,V;return m()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,(0,I.XU)({class_type:"EscolaLms\\Courses\\Models\\Lesson"});case 2:J=K.sent,J.success&&(V=J.data.find(function(Q){var U=Q.name;return U==="assistant_id"}),ve(!!(V!=null&&V.id)));case 4:case"end":return K.stop()}},N)})),[]);(0,d.useEffect)(function(){W(),Ce([])},[]);var w=(0,d.useCallback)(function(){(0,i.Nx)(O).then(function(N){return N.success&&e(g()(g()({},N.data),{},{lessons:pt(N.data.lessons)}))})},[O]);(0,d.useEffect)(function(){w()},[w]);var De=(0,d.useCallback)(function(N){var J=de.find(function(V){var X;return V==null||(X=V.topics)===null||X===void 0?void 0:X.find(function(K){return K.id===N})});return J?J.id:null},[de]),ue=(0,d.useMemo)(function(){return ne.lesson?{mode:"lesson",id:Number(ne.lesson),value:de.find(function(N){return N.id===Number(ne.lesson)})}:ne.topic?{mode:"topic",id:Number(ne.topic),value:we.find(function(N){return N.id===Number(ne.topic)})}:{mode:"init"}},[ne,F,de,we]),Et=(0,d.useCallback)(function(N){var J={course_id:O,topics:[],isNew:!0,id:F?F.lessons.length+1:H(),order:0,title:Ge.formatMessage({id:"add_title_here"}),active:!0,parent_id:N};return e(function(V){var X;return g()(g()({},V),{},{lessons:Ve((X=V==null?void 0:V.lessons)!==null&&X!==void 0?X:[],J,N)})}),J},[O,F]),et=(0,d.useCallback)(function(N,J){var V=de.find(function(K){return K.id===N}),X=V&&V.isNew;return(X?(0,i.aA)(J):(0,i.sI)(N,J)).then(function(K){return ee.ZP.success(K.message),w(),K.success&&e(function(Q){var U;return g()(g()({},Q),{},{lessons:at((U=Q==null?void 0:Q.lessons)!==null&&U!==void 0?U:[],N,g()(g()({},K.data),{},{isNew:!1}))})})})},[F]),jt=(0,d.useCallback)(function(N){var J=de.find(function(X){return X.id===N});if(J){var V=J.isNew;V?e(function(X){var K;return g()(g()({},X),{},{lessons:gt((K=X==null?void 0:X.lessons)!==null&&K!==void 0?K:[],N)})}):(0,i.iI)(N).then(function(X){X.success&&(ee.ZP.success(X.message),e(function(K){var Q;return g()(g()({},K),{},{lessons:gt((Q=K==null?void 0:K.lessons)!==null&&Q!==void 0?Q:[],N)})}))})}},[F]),rt=(0,d.useCallback)(function(N,J){var V,X=De(N),K=de.find(function(te){return te.id===X}),Q=K&&((V=K.topics)===null||V===void 0?void 0:V.find(function(te){return te.id===N})),U=Q==null?void 0:Q.isNew;return(U?(0,i.HV)(J):(0,i.Cn)(N,J)).then(function(te){te.success&&(ee.ZP.success(te.message),w(),P.history.push("/courses/list/".concat(O,"/program/?topic=").concat(te.data.id)),(Q==null?void 0:Q.topicable_type)===y.oz.Video&&setTimeout(function(){w()},5e3))})},[De,F,w]),Rt=(0,d.useCallback)(function(N){var J=De(N),V=de.find(function(Q){return Q.id===J});if(V){var X=we==null?void 0:we.find(function(Q){return Q.id===N}),K=X==null?void 0:X.isNew;K&&!X.topicable?e(function(Q){var U;return g()(g()({},Q),{},{lessons:Ie((U=Q==null?void 0:Q.lessons)!==null&&U!==void 0?U:[],N)})}):(0,i.vJ)(N).then(function(Q){Q.success&&(ee.ZP.success(Q.message),e(function(U){var te;return g()(g()({},U),{},{lessons:Ie((te=U==null?void 0:U.lessons)!==null&&te!==void 0?te:[],N)})}))})}},[F,De]),bt=(0,d.useCallback)(function(N,J){var V={lesson_id:N,isNew:!0,id:H(),title:Ge.formatMessage({id:"add_title_here"}),active:!0,topicable_type:J};return e(function(X){var K;return g()(g()({},X),{},{lessons:je((K=X==null?void 0:X.lessons)!==null&&K!==void 0?K:[],N,V)})}),V},[]),Pt=function(J,V){var X=De(J);e(function(K){return g()(g()({},K),{},{lessons:K?Ft(J,V,X,K.lessons||[]):[]})}),P.history.push("/courses/list/".concat(O,"/program/?topic=").concat(V.file.response.data.id))},Zt=(0,d.useCallback)(function(N){return(0,i.Cx)(N).then(function(J){if(J.success){ee.ZP.success(J.message);var V=De(N);e(function(X){var K;return g()(g()({},X),{},{lessons:X?(K=X.lessons)===null||K===void 0?void 0:K.map(function(Q){if(Q.id===V){var U=Q.topics||[];return g()(g()({},Q),{},{topics:[].concat(s()(U),[J.data])})}return Q}):[]})})}})},[F,De]),Dt=(0,d.useCallback)(function(N){return(0,i.if)(N).then(function(J){J.success&&(ee.ZP.success(J.message),e(function(V){return g()(g()({},V),{},{lessons:V?[].concat(s()(V.lessons),[J.data]):[]})}))})},[]),It={state:F,h5ps:Me,id:O,addNewLesson:Et,updateLesson:et,updateTopic:rt,deleteLesson:jt,addNewTopic:bt,deleteTopic:Rt,onTopicUploaded:Pt,cloneTopic:Zt,cloneLesson:Dt,currentEditMode:ue,getLessons:w,isAssistant:Re};return(0,ae.jsx)(Z.Provider,{value:It,children:le})}},88030:function(Tt,qe,u){u.r(qe),u.d(qe,{default:function(){return Wr}});var Xe=u(97857),m=u.n(Xe),Ke=u(91115),Ze=u(26114),_e=u(26271),B=u(74453),Oe=u(74330),g=u(14726),v=u(67294),s=u(80854),ee=u(15009),d=u.n(ee),P=u(99289),i=u.n(P),y=u(19632),I=u.n(y),ae=u(5574),Z=u.n(ae),H=u(16894),be=u(28248),he=u(83062),je=u(2453),Ve=u(96746),at=u(78957),pt=u(2487),gt=u(55102),Ie=u(75842);function Ft(o,n){return xt.apply(this,arguments)}function xt(){return xt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"GET",params:n},t||{})));case 1:case"end":return a.stop()}},o)})),xt.apply(this,arguments)}function ye(o,n){return T.apply(this,arguments)}function T(){return T=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),T.apply(this,arguments)}function le(o,n,t){return O.apply(this,arguments)}function O(){return O=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),m()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},o)})),O.apply(this,arguments)}function ie(o,n,t){return b.apply(this,arguments)}function b(){return b=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(n),m()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},r||{})));case 1:case"end":return l.stop()}},o)})),b.apply(this,arguments)}var F=u(31472),e=u(85893),Ge=function(n){var t=n.visible,r=n.onClose,a=n.user,l=Ve.Z.Text,c=a.name,f=a.groupId,h=a.userId,j=(0,v.useState)(""),S=Z()(j,2),_=S[0],E=S[1],p=(0,v.useState)(!1),x=Z()(p,2),M=x[0],C=x[1],Y=(0,v.useState)([]),G=Z()(Y,2),L=G[0],k=G[1],se=(0,v.useState)(null),oe=Z()(se,2),$=oe[0],R=oe[1],D=(0,v.useState)({current_page:1,per_page:5,last_page:1,total:0}),A=Z()(D,2),q=A[0],Fe=A[1],Le=function(){var Ae=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,Ft({bookmarkable_id:f,bookmarkable_type:F.h5.Group,user_id:h,page:pe,per_page:q.per_page});case 2:z=xe.sent,z.success&&(k(z.data),Fe(z.meta));case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}(),ze=function(){var Ae=i()(d()().mark(function re(){var pe;return d()().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:return Je.next=2,ye({value:_,bookmarkable_id:f,bookmarkable_type:F.h5.Group,user_id:h});case 2:pe=Je.sent,pe.success&&(Le(),C(!1),E(""));case 4:case"end":return Je.stop()}},re)}));return function(){return Ae.apply(this,arguments)}}(),it=function(){var Ae=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,ie(pe);case 2:z=xe.sent,z.success&&Le();case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}(),Ue=function(){var Ae=i()(d()().mark(function re(pe){var z;return d()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,le(pe,{value:($==null?void 0:$.currentText)||"",bookmarkable_id:f,bookmarkable_type:F.h5.Group,user_id:h});case 2:z=xe.sent,z.success&&(Le(),R(null));case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}();return(0,v.useEffect)(function(){Le()},[]),(0,e.jsxs)(be.Z,{title:(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(c,")")})]}),open:t,onCancel:r,footer:[(0,e.jsx)(g.ZP,{onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(pt.Z,{dataSource:L,pagination:{onChange:function(re){return Le(re)},pageSize:q.per_page,total:q.total,current:q.current_page},renderItem:function(re){return(0,e.jsx)(pt.Z.Item,{actions:[(0,e.jsx)(g.ZP,{danger:!0,onClick:function(){return it(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},re.id),($==null?void 0:$.currentNoteId)===re.id?(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{onClick:function(){return Ue(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(g.ZP,{onClick:function(){return R(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(g.ZP,{onClick:function(){return R({currentNoteId:re.id,currentText:re.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},re.id)],children:($==null?void 0:$.currentNoteId)===re.id&&($==null?void 0:$.currentText)!==null?(0,e.jsx)(gt.Z.TextArea,{value:$==null?void 0:$.currentText,onChange:function(z){return R(function(Je){return m()(m()({},Je),{},{currentText:z.target.value})})}}):re.value})}}),M?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ie.Z,{layout:"vertical",children:(0,e.jsx)(Ie.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(gt.Z.TextArea,{value:_,onChange:function(re){return E(re.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{type:"primary",onClick:ze,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return C(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return C(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},we=Ge,de=u(54464);function ke(o,n){return Ne.apply(this,arguments)}function Ne(){return Ne=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),Ne.apply(this,arguments)}function Me(o,n,t,r){return Ce.apply(this,arguments)}function Ce(){return Ce=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n,"/attendances"),m()({data:{attendances:[{user_id:t,value:r}]},method:"POST"},a||{})));case 1:case"end":return c.stop()}},o)})),Ce.apply(this,arguments)}function He(o,n){return Be.apply(this,arguments)}function Be(){return Be=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),Be.apply(this,arguments)}function Re(o,n){return ve.apply(this,arguments)}function ve(){return ve=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"GET",useCache:!1,params:n},t||{})));case 1:case"end":return a.stop()}},o)})),ve.apply(this,arguments)}function me(o,n){return ne.apply(this,arguments)}function ne(){return ne=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),ne.apply(this,arguments)}function W(o,n,t){return w.apply(this,arguments)}function w(){return w=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"PUT",data:t,useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),w.apply(this,arguments)}function De(o,n){return ue.apply(this,arguments)}function ue(){return ue=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),ue.apply(this,arguments)}function Et(o,n){return et.apply(this,arguments)}function et(){return et=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),et.apply(this,arguments)}function jt(o,n,t,r){return rt.apply(this,arguments)}function rt(){return rt=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/exams/".concat(n,"/users/").concat(t),m()({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return c.stop()}},o)})),rt.apply(this,arguments)}function Rt(o,n,t){return bt.apply(this,arguments)}function bt(){return bt=_asyncToGenerator(_regeneratorRuntime().mark(function o(n,t,r){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(n,"/users/").concat(t),_objectSpread({method:"DELETE"},r||{})));case 1:case"end":return l.stop()}},o)})),bt.apply(this,arguments)}function Pt(o,n,t){return Zt.apply(this,arguments)}function Zt(){return Zt=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),m()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),Zt.apply(this,arguments)}function Dt(o,n,t,r){return It.apply(this,arguments)}function It(){return It=i()(d()().mark(function o(n,t,r,a){return d()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(t,"/grades"),m()({method:"POST",data:r},a||{})));case 1:case"end":return c.stop()}},o)})),It.apply(this,arguments)}function N(o,n){return J.apply(this,arguments)}function J(){return J=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",m()({method:"GET",params:{groups:n},useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),J.apply(this,arguments)}function V(o,n,t){return X.apply(this,arguments)}function X(){return X=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(t),m()({method:"GET",useCache:!1},r||{})));case 1:case"end":return l.stop()}},o)})),X.apply(this,arguments)}function K(o){return Q.apply(this,arguments)}function Q(){return Q=i()(d()().mark(function o(n){return d()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-terms",m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},o)})),Q.apply(this,arguments)}function U(o,n){return te.apply(this,arguments)}function te(){return te=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(n),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),te.apply(this,arguments)}function ce(o,n){return fe.apply(this,arguments)}function fe(){return fe=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades",m()({method:"POST",data:n},t||{})));case 1:case"end":return a.stop()}},o)})),fe.apply(this,arguments)}function ge(o,n,t){return Te.apply(this,arguments)}function Te(){return Te=i()(d()().mark(function o(n,t,r){return d()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),m()({method:"PATCH",data:t},r||{})));case 1:case"end":return l.stop()}},o)})),Te.apply(this,arguments)}function Ye(o,n){return st.apply(this,arguments)}function st(){return st=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(n),m()({method:"DELETE"},t||{})));case 1:case"end":return a.stop()}},o)})),st.apply(this,arguments)}var yt=u(95213),Gt=u(47389),tt=u(7092),va=u(13769),$t=u.n(va),pa=["results"],Jt=function(n,t){return n.reduce(function(r,a){var l=a.results,c=$t()(a,pa),f=l.find(function(h){return h.user_id===t});return f?[].concat(I()(r),[m()(m()({},c),{},{result:f})]):r},[])},Qt=function(n,t){var r,a=n.reduce(function(p,x){var M=x.result,C=x.weight;return C&&typeof M.result=="number"?[p[0]+M.result*C,p[1]+C]:p},[0,0]),l=Z()(a,2),c=l[0],f=l[1],h=Number.isNaN(c/f)?0:c/f,j=t.sort(function(p,x){return p.grade_value-x.grade_value}).reduce(function(p,x){return[].concat(I()(p),[m()(m()({},x),{},{isWeightedAverageGreater:h>=x.grade_value})])},[]);if(j.every(function(p){var x=p.isWeightedAverageGreater;return x})){var S,_;return(S=(_=j.at(-1))===null||_===void 0?void 0:_.name)!==null&&S!==void 0?S:""}var E=j.findIndex(function(p){var x=p.isWeightedAverageGreater;return!x});return E<0?"":(r=j[E-1])===null||r===void 0?void 0:r.name},qt=function(n,t){var r;return(r=t.find(function(a){return a.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},dt=u(73199),ha=u(9783),nt=u.n(ha),ea=u(84567);function ga(o){var n,t=o===null?F.cX.ABSENT:o,r=nt()(nt()(nt()(nt()({},F.cX.PRESENT,{ch1:!0,ch2:!1}),F.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),F.cX.ABSENT,{ch1:!1,ch2:!1}),F.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(n=r[t])!==null&&n!==void 0?n:{ch1:!1,ch2:!1}}function xa(o){var n,t=o.ch1,r=o.ch2,a="".concat(t,"_").concat(r),l={true_false:F.cX.PRESENT,true_true:F.cX.PRESENT_NOT_EXERCISING,false_false:F.cX.ABSENT,false_true:F.cX.EXCUSED_ABSENCE};return(n=l[a])!==null&&n!==void 0?n:F.cX.ABSENT}var ja=function(n){var t=n.groupAttendanceScheduleId,r=n.studentId,a=n.attendance,l=n.onSuccess,c=(0,v.useState)(ga(a)),f=Z()(c,2),h=f[0],j=f[1],S=(0,v.useState)(!1),_=Z()(S,2),E=_[0],p=_[1],x=(0,v.useRef)(!0),M=(0,v.useCallback)(function(G){p(!0),Me(t,r,xa(G)).then(function(L){L.success&&(l==null||l())}).finally(function(){return p(!1)})},[]),C=(0,v.useCallback)(function(G){return j(G.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),Y=(0,v.useCallback)(function(G){return j(function(L){return m()(m()({},L),{},{ch2:G.target.checked})})},[]);return(0,v.useEffect)(function(){if(x.current){x.current=!1;return}M(h)},[h,M]),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(ea.Z,{disabled:E,checked:h.ch1,onChange:C})}),(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:h.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(ea.Z,{disabled:E,checked:h.ch2,onChange:Y})})]})},ta=ja,ct=u(45919),kt=u(82061),St=u(60943),wt=u(74656),aa=u(37804),ba=u(96486),Sa=function(n){var t=n.exam_id,r=n.result,a=n.student_id,l=n.type,c=n.onSuccess,f=(0,s.useIntl)(),h=(0,v.useCallback)((0,ba.debounce)(function(S){jt(t,a,{result:S}).then(function(_){_.success&&(c==null||c(_.data))})},300),[t,r,a]),j=function(){switch(l){case F.UL.ManualPass:return(0,e.jsx)(wt.default,{allowClear:!0,style:{width:"100%"},onChange:h,options:dt.FW,defaultValue:r!=null?r:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});case F.UL.ManualGrades:return(0,e.jsx)(wt.default,{allowClear:!0,style:{width:"100%"},onChange:h,options:dt.BP,defaultValue:r!=null?r:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});default:return(0,e.jsx)(aa.Z,{type:"number",min:0,max:100,onChange:h,defaultValue:r!=null?r:void 0,placeholder:f.formatMessage({id:"select_grade"})})}};return j()},_a=function(n,t){var r;return(r=n.find(function(a){return a.name===t}))===null||r===void 0?void 0:r.id},ya=function(n){var t=n.term,r=n.gradeScales,a=n.defaultFinalGrade,l=n.finalGrades,c=(0,v.useState)(a),f=Z()(c,2),h=f[0],j=f[1],S=(0,v.useState)(!1),_=Z()(S,2),E=_[0],p=_[1],x=(0,v.useState)(!1),M=Z()(x,2),C=M[0],Y=M[1],G=(0,s.useIntl)(),L=(0,v.useMemo)(function(){return r.map(function(oe){var $=oe.name,R=oe.id;return{value:R,label:$}})},[r]),k=function($){Y(!0),je.ZP.error(G.formatMessage({id:$.data.message}))},se=(0,v.useCallback)(function(oe){if(l!=null&&l.id){if(oe===void 0){if(!h)return;p(!0),Ye(h.id).then(function($){$.success&&j(void 0)}).finally(function(){return p(!1)});return}if(h){p(!0),ge(h.id,{grade_scale_id:oe}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&k($)}).finally(function(){return p(!1)});return}p(!0),ce({grade_term_id:t.id,grade_scale_id:oe,lesson_group_user_id:l.id}).then(function($){if($.success){var R=$.data.grades.find(function(D){return D.grade_term.id===t.id});j(R),C&&Y(!1)}}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&k($)}).finally(function(){return p(!1)})}},[h,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(wt.default,{allowClear:!0,status:C?"error":"",loading:E,disabled:E,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:se,options:L,defaultValue:_a(r,a==null?void 0:a.grade_name)}):null},Ma=function(n){var t=n.groupAttendanceSchedule,r=n.handleDeleteColumn,a=n.scheduleDeletePermission,l=a===void 0?!1:a,c=t.reduce(function(f,h){return[].concat(I()(f),[{title:(0,e.jsxs)(at.Z,{children:[(0,St.WU)(new Date(h.date_from),ct.GC),l&&h.is_outdated&&(0,e.jsx)(kt.Z,{onClick:function(S){S.stopPropagation(),r(h.id,(0,St.WU)(new Date(h.date_from),ct.GC))}})]}),dataIndex:"attendance-".concat(h.id),hideInSearch:!0,width:100,align:"center",render:function(S,_){return(0,e.jsx)(ta,{groupAttendanceScheduleId:h.id,attendance:_["attendance-".concat(h==null?void 0:h.id)],studentId:_.id})}}])},[]);return c.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:c}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Ca=function(n,t){return n.reduce(function(r,a){var l=a.attendances.find(function(c){return c.user_id===t});return l?m()(m()({},r),{},nt()({},"attendance-".concat(a.id),l.value)):r},{})},Ta=function(n){var t=n.reduce(function(r,a){return[].concat(I()(r),[{dataIndex:"exam-".concat(a.id),title:a.type===F.UL.Manual?(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:a}):(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithoutWeight",values:a}),hideInSearch:!0,width:100,render:function(c,f){var h;return(0,e.jsx)(Sa,{type:a.type,result:f==null||(h=f["exam-".concat(a.id)])===null||h===void 0?void 0:h.result,exam_id:a.id,student_id:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},Fa=function(n){return n.reduce(function(t,r){var a=r.result,l=r.id;return m()(m()({},t),{},nt()({},"exam-".concat(l),a))},{})},Ea=function(n,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(l,c){var f;return(0,e.jsx)(ya,{defaultFinalGrade:c["final-grade-".concat(r.id)],finalGrades:c.final_grades,term:r,gradeScales:t},"".concat(c==null||(f=c.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(r.id))}}})}},Pa=function(n,t){return n.find(function(r){return r.user.id===t})},Za=function(n){var t;return((t=n==null?void 0:n.grades)!==null&&t!==void 0?t:[]).reduce(function(r,a){return m()(m()({},r),{},nt()({},"final-grade-".concat(a.grade_term.id),a))},{})},Ia=function(){var n,t=(0,tt.Z)(),r=t.teacherSubjectData,a=t.semester_subject_id,l=(0,v.useState)([]),c=Z()(l,2),f=c[0],h=c[1],j=(0,v.useState)(r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.name),S=Z()(j,2),_=S[0],E=S[1],p=(0,v.useState)(null),x=Z()(p,2),M=x[0],C=x[1],Y=(0,s.useIntl)(),G=(0,v.useRef)(),L=(0,de.T)(),k=L.checkPermission,se=function(A,q){be.Z.confirm({title:Y.formatMessage({id:"scheduleDeleteConfirm"},{columnId:A}),okText:Y.formatMessage({id:"delete"}),cancelText:Y.formatMessage({id:"cancel"}),onOk:q})},oe=function(A,q){se(q,function(){var Fe;He(A),(Fe=G.current)===null||Fe===void 0||Fe.reload()})},$=(0,v.useMemo)(function(){var D;return((D=r==null?void 0:r.groups)!==null&&D!==void 0?D:[]).map(function(A){var q=A.id,Fe=A.name;return{value:q,label:Fe}})},[r==null?void 0:r.groups]),R=(0,v.useMemo)(function(){var D;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:$,defaultValue:$==null||(D=$[0])===null||D===void 0?void 0:D.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(I()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(q,Fe){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(Gt.Z,{}),onClick:function(){return C({userName:Fe.full_name,userId:Fe.id,groupId:Fe.final_grades.group_id})}})})})}}])},[$,f]);return(0,e.jsxs)(e.Fragment,{children:[(M==null?void 0:M.userId)&&(0,e.jsx)(we,{visible:!!M.userId,onClose:function(){return C(null)},user:{name:M.userName,userId:M.userId,groupId:M.groupId}}),(0,e.jsx)(H.ZP,{sticky:!0,className:"table-standalone",request:function(){var D=i()(d()().mark(function A(q){var Fe,Le,ze,it,Ue,Ae,re,pe,z,Je,xe,Ee,Pe,Se,We,Qe,vt,ut,lt,_t,Mt;return d()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return it=q.group_id,Ue=it===void 0?(Fe=$[0])===null||Fe===void 0?void 0:Fe.value:it,Ae=q.full_name,re=Ae===void 0?"":Ae,$e.next=3,N([Ue]);case 3:if(pe=$e.sent,z=$.find(function(Ct){var ht=Ct.value;return ht===Ue}),!(!pe.success||pe.data[0]===void 0||a===null)){$e.next=8;break}return je.ZP.error(Y.formatMessage({id:"groupDataMissing"},{group_name:z==null?void 0:z.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 8:return $e.next=10,Promise.all([(0,yt.X)(Ue),ke(Ue),Re({group_id:Ue,per_page:-1}),Pt(a,(Le=pe.data)===null||Le===void 0||(Le=Le[0])===null||Le===void 0?void 0:Le.tutor_id),K(),U((ze=pe.data)===null||ze===void 0||(ze=ze[0])===null||ze===void 0?void 0:ze.s_subject_scale_form_id)]);case 10:if(Je=$e.sent,xe=Z()(Je,6),Ee=xe[0],Pe=xe[1],Se=xe[2],We=xe[3],Qe=xe[4],vt=xe[5],!(!Ee.success||!Pe.success||!Se.success||!We.success||!Qe.success||!vt.success||!z)){$e.next=21;break}return je.ZP.error(Y.formatMessage({id:"groupDataMissing"},{group_name:z==null?void 0:z.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 21:return E(z.label),ut=Ma({groupAttendanceSchedule:Pe.data,handleDeleteColumn:oe,scheduleDeletePermission:k(Ke.Z.PCGSchedulesDelete)||k(Ke.Z.PCGSchedulesDeleteOwn)}),lt=Ta(Se.data),_t=Ea(Qe.data,vt.data),h([ut,lt,_t,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Mt=Ee.data.users.reduce(function(Ct,ht){var zt,Ht,Yt,Lt=ht.id,Vr=ht.academic_teacher_id,Xr=ht.first_name,zr=ht.last_name,ma="".concat(zr," ").concat(Xr),Hr=pe.data.some(function(tn){return tn.user.id===Lt});if(Vr!==null&&!Hr||!ma.toLowerCase().includes(re.toLowerCase()))return Ct;var Yr=Ca(Pe.data,Lt),fa=Jt(Se.data,Lt),At=Pa(pe.data,Lt),Jr=(zt=qt((Ht=At==null?void 0:At.s_subject_scale_form_id)!==null&&Ht!==void 0?Ht:0,(Yt=We.data.grade_scale)!==null&&Yt!==void 0?Yt:[]))!==null&&zt!==void 0?zt:[],Qr=Qt(fa,Jr),qr=Fa(fa),en=Za(At);return[].concat(I()(Ct),[m()(m()(m()(m()({id:Lt,full_name:ma},Yr),qr),en),{},{proposed_grade:Qr,final_grades:At})])},[]).sort(function(Ct,ht){return Ct.full_name.localeCompare(ht.full_name)}),$e.abrupt("return",{data:Mt,total:Mt.length,success:!0});case 28:case"end":return $e.stop()}},A)}));return function(A){return D.apply(this,arguments)}}(),columns:R,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:_}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:G,pagination:{defaultPageSize:dt.Sl,onChange:function(){var A;return(A=G.current)===null||A===void 0?void 0:A.reload()}},rowKey:"id"})]})},ra=u(1413),Ga={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},wa=Ga,Da=u(84089),La=function(n,t){return v.createElement(Da.Z,(0,ra.Z)((0,ra.Z)({},n),{},{ref:t,icon:wa}))},Aa=v.forwardRef(La),Ra=Aa,na=u(86738),Ot=u(62235),ot=u(952),$a=u(5966),Oa=u(50335),sa=u(71230),mt=u(15746),Na=u(29477),Ua=u(56717),ia=u(95830),ua=function(n){return n===F.UL.Manual||n===F.UL.ManualPass||n===F.UL.ManualGrades},ka=function(n){var t=n.type,r=n.onDataConverted,a=n.groupSelectDisabled,l=(0,tt.Z)(),c=l.semester_subject_id,f=l.teacherSubjectData,h=(0,v.useState)(null),j=Z()(h,2),S=j[0],_=j[1],E=(0,v.useMemo)(function(){var M;return((M=f==null?void 0:f.groups)!==null&&M!==void 0?M:[]).map(function(C){var Y=C.id,G=C.name;return{label:G,value:Y}})},[]),p={type:t,group_id:S,semester_subject_id:c},x=(0,v.useCallback)(function(M){if(M.success){var C=M.data.results.filter(function(Y){var G=Y.user_id;return G!==null});if(!C.length)return;r({exam_results:C,group_id:M.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(wt.default,{disabled:a,value:S,onChange:function(C){return _(C)},options:E,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Na.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:x,onChange:function(C){return!C.fileList.length&&r(void 0)},maxFiles:1,data:p,disabled:!S})]})},Ba=function(n){var t=n.onDataConverted,r=(0,tt.Z)(),a=r.teacherSubjectData,l=r.groupUsers,c=(0,v.useState)(null),f=Z()(c,2),h=f[0],j=f[1],S=(0,v.useMemo)(function(){var E;return((E=a==null?void 0:a.groups)!==null&&E!==void 0?E:[]).map(function(p){var x=p.id,M=p.name;return{label:M,value:x}})},[]),_=(0,v.useCallback)(function(){var E=i()(d()().mark(function p(x){var M,C,Y,G;return d()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(j(x),C=(M=l.byId)===null||M===void 0?void 0:M[x],C){k.next=4;break}return k.abrupt("return");case 4:return k.prev=4,k.next=7,N([x]);case 7:if(Y=k.sent,Y.success){k.next=10;break}return k.abrupt("return");case 10:G=C.users.reduce(function(se,oe){var $=oe.id,R=oe.email,D=oe.first_name,A=oe.last_name,q=oe.academic_teacher_id,Fe=Y.data.some(function(Le){return Le.user.id===$});return q!==null&&!Fe?se:[].concat(I()(se),[{email:R,first_name:D,last_name:A,user_id:$,result:null}])},[]),t({group_id:x,exam_results:G}),k.next=17;break;case 14:k.prev=14,k.t0=k.catch(4),console.error("Error fetching final grades:",k.t0);case 17:case"end":return k.stop()}},p,null,[[4,14]])}));return function(p){return E.apply(this,arguments)}}(),[l.byId]);return(0,e.jsx)(wt.default,{value:h,onChange:_,options:S,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Nt=nt()(nt()(nt()(nt()(nt()(nt()({},F.UL.TestPortal,["/teacher-examples/testPortal.png"]),F.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),F.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),F.UL.Manual,[]),F.UL.ManualPass,[]),F.UL.ManualGrades,[]),Wa=function(n){var t=n.images,r=(0,v.useState)(!1),a=Z()(r,2),l=a[0],c=a[1],f=(0,v.useCallback)(function(){return c(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(g.ZP,{onClick:f,icon:(0,e.jsx)(Ua.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:c},children:t.map(function(h){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:h},h)})})]})},Ka=function(n){var t,r=n.type,a=n.onOk,l=n.onCancel,c=n.okDisabled,f=(t=Nt==null?void 0:Nt[r])!==null&&t!==void 0?t:Nt[F.UL.Manual];return(0,e.jsxs)(at.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)(Wa,{images:f}),(0,e.jsxs)(at.Z,{children:[(0,e.jsx)(g.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(g.ZP,{type:"primary",disabled:c,onClick:a,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Va=[F.UL.TeamsLecture,F.UL.TestPortal,F.UL.TeamsForms],Xa=function(n){var t=n.open,r=n.closeModal,a=n.onSuccess,l=n.type,c=(0,tt.Z)(),f=c.teacherSubjectData,h=c.fetchGroupUsers,j=(0,v.useState)(),S=Z()(j,2),_=S[0],E=S[1];return(0,v.useEffect)(function(){if(ua(l)&&t){var p;f==null||(p=f.groups)===null||p===void 0||p.forEach(function(x){var M=x.id;return h(M)})}},[l,t]),(0,e.jsxs)(be.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:r,footer:(0,e.jsx)(Ka,{type:l,onOk:function(){_&&a(_)},onCancel:r,okDisabled:!_}),children:[Va.includes(l)&&(0,e.jsx)(ka,{type:l,onDataConverted:E,groupSelectDisabled:!!_}),ua(l)&&(0,e.jsx)(Ba,{onDataConverted:E,examType:l})]})},za=function(n){var t=n.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.ManualPass)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyPass",defaultMessage:"uploadGradesManuallyPass"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){return t(F.UL.ManualGrades)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyGrades",defaultMessage:"uploadGradesManuallyGrades"})})})]})},Ha=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1}],Ya=function(n){var t,r=n.exam_id,a=ot.ZP.useForm(),l=Z()(a,1),c=l[0],f=(0,v.useState)(),h=Z()(f,2),j=h[0],S=h[1],_=(0,v.useState)(),E=Z()(_,2),p=E[0],x=E[1],M=(0,v.useState)(!1),C=Z()(M,2),Y=C[0],G=C[1],L=(0,tt.Z)(),k=L.semester_subject_id,se=L.getGroupById,oe=(0,v.useMemo)(function(){var R;return((R=p==null?void 0:p.exam_results)!==null&&R!==void 0?R:[]).map(function(D){var A=D.user_id;return A})},[p==null?void 0:p.exam_results]);(0,v.useEffect)(function(){var R=Number(r);r==="new"&&(S(void 0),x(void 0),c.resetFields()),r!=="new"&&!Number.isNaN(R)&&(G(!0),De(R).then(function(D){if(D.success){var A=D.data,q=A.type,Fe=A.results,Le=A.title,ze=A.weight,it=A.passed_at,Ue=A.group_id;S(q),x({group_id:Ue,exam_results:Fe}),c.setFieldsValue({title:Le,weight:ze,passed_at:it})}}).finally(function(){return G(!1)}))},[r]);var $=(0,v.useCallback)(function(){S(void 0),x(void 0)},[]);return Y?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[j&&(0,e.jsx)(Xa,{open:!!(j&&!p),type:j,closeModal:$,onSuccess:x}),(0,e.jsxs)(ot.ZP,{form:c,submitter:j===void 0||!p?!1:void 0,onFinish:function(){var R=i()(d()().mark(function D(A){var q,Fe,Le,ze,it,Ue,Ae,re;return d()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(p&&typeof k=="number")){z.next=16;break}if(q=A.title,Fe=A.passed_at,Le=A.weight,ze=Number(r),it=p.exam_results,Ue=p.group_id,Ae={type:j,semester_subject_id:k,title:q,passed_at:Fe,weight:Le,group_id:Ue,results:it},!Number.isNaN(ze)){z.next=11;break}return z.next=8,me(Ae);case 8:z.t0=z.sent,z.next=14;break;case 11:return z.next=13,W(ze,Ae);case 13:z.t0=z.sent;case 14:re=z.t0,re.success&&s.history.push("/teacher/subjects/".concat(k,"/exams"));case 16:return z.abrupt("return",!0);case 17:case"end":return z.stop()}},D)}));return function(D){return R.apply(this,arguments)}}(),onReset:$,children:[(0,e.jsxs)(ot.ZP.Group,{children:[(0,e.jsx)($a.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(Oa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),j!==F.UL.ManualGrades&&j!==F.UL.ManualPass&&(0,e.jsx)(ot.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(aa.Z,{})})]}),j&&p&&(0,e.jsx)(H.ZP,{rowKey:"user_id",headerTitle:(t=se(p.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:oe,onValuesChange:function(D,A){return x({group_id:p.group_id,exam_results:A})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:p.exam_results.sort(function(R,D){return R.last_name.localeCompare(D.last_name)}),pagination:{defaultPageSize:dt.Sl},columns:[].concat(Ha,[function(){switch(j){case F.UL.ManualPass:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.FW}};case F.UL.ManualGrades:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.BP}};default:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}}}()])}),!p&&(0,e.jsx)(za,{onSelect:S})]})]})},Ja=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Qa=function(n){var t=n.exam_id,r=(0,v.useState)(""),a=Z()(r,2),l=a[0],c=a[1];return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:dt.Sl},request:i()(d()().mark(function f(){var h;return d()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,De(t);case 2:if(h=S.sent,!h.success){S.next=6;break}return c(h.data.title),S.abrupt("return",{total:h.data.results.length,success:!0,data:h.data.results});case 6:return S.abrupt("return",[]);case 7:case"end":return S.stop()}},f)})),columns:Ja})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,t){return t.passed_at&&(0,St.WU)(new Date(t.passed_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,t){return t.weight?t.weight+"%":""}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,t){return t.created_at&&(0,St.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,t){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],er=function(){var n,t=(0,v.useRef)(),r=(0,tt.Z)(),a=r.semester_subject_id,l=(0,s.useLocation)(),c=new URLSearchParams(l.search),f=(n=c.get("exam_id"))!==null&&n!==void 0?n:null,h=c.get("results");return h!==null&&!Number.isNaN(Number(h))?(0,e.jsx)(Qa,{exam_id:Number(h)}):f!==null?(0,e.jsx)(Ya,{exam_id:f}):(0,e.jsx)(H.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:dt.Sl},request:function(){var j=i()(d()().mark(function S(_,E){var p,x,M,C;return d()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(p=_.current,x=_.pageSize,a!==null){G.next=3;break}return G.abrupt("return",{data:[],total:0,success:!1});case 3:return M=E&&Object.entries(E)[0],G.next=6,Re({per_page:x,page:p,semester_subject_id:Number.isNaN(a)?void 0:a,order_by:M&&M[0],order:M&&(M[1]==="ascend"?"ASC":"DESC")});case 6:if(C=G.sent,!C.success){G.next=9;break}return G.abrupt("return",{data:C.data,total:C.meta.total,success:!0});case 9:return G.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return G.stop()}},S)}));return function(S,_){return j.apply(this,arguments)}}(),columns:[].concat(qa,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(S,_){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?exam_id=").concat(_.id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(Gt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(_.semester_subject_id,"/exams?results=").concat(_.id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(g.ZP,{icon:(0,e.jsx)(Ra,{})})})},"results"),(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:i()(d()().mark(function E(){var p;return d()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,Et(_.id);case 2:p=M.sent,p.success&&t.current&&t.current.reload();case 4:case"end":return M.stop()}},E)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(kt.Z,{}),danger:!0})})},"delete")]}}])})},tr=u(69753),oa=u(44167),ar=u(84665),rr=["type","defaultRender"],nr=["type","defaultRender"],sr=function(n){var t=n.url;return(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(tr.Z,{})})})},ir=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,t){return(0,St.WU)(new Date(t.created_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,c=$t()(t,rr);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},c),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(r=t.created_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.created_by)!==null&&a!==void 0&&a.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,t){return(0,St.WU)(new Date(t.exported_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,t,r){var a=t.type,l=t.defaultRender,c=$t()(t,nr);if(a==="form")return null;var f=r.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},c),{},{state:{type:f}}))},render:function(n,t){var r,a;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(r=t.exported_by)!==null&&r!==void 0&&r.first_name&&t!==null&&t!==void 0&&(a=t.exported_by)!==null&&a!==void 0&&a.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(n,t){return[(0,e.jsx)(sr,{url:t.url},"download")]}}],ur=function(){var n,t=(0,tt.Z)(),r=t.teacherSubjectData,a=(0,v.useMemo)(function(){var c;return((c=r==null?void 0:r.groups)!==null&&c!==void 0?c:[]).map(function(f){var h=f.id,j=f.name;return{value:h,label:j}})},[r==null?void 0:r.groups]),l=(0,v.useMemo)(function(){var c;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:a,defaultValue:r==null||(c=r.groups)===null||c===void 0||(c=c[0])===null||c===void 0?void 0:c.id,allowClear:!1}}].concat(ir)},[r==null||(n=r.groups)===null||n===void 0||(n=n[0])===null||n===void 0?void 0:n.id,a]);return(0,e.jsx)(H.ZP,{className:"table-standalone",request:function(){var c=i()(d()().mark(function f(h){var j,S,_,E,p,x;return d()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return S=h.group_id,_=S===void 0?r==null||(j=r.groups)===null||j===void 0||(j=j[0])===null||j===void 0?void 0:j.id:S,E=h.created_by,p=h.exported_by,C.next=3,(0,ar.v)({group_id:_,created_by:E,exported_by:p});case 3:if(x=C.sent,x.success){C.next=6;break}return C.abrupt("return",{success:!1,data:[],total:0});case 6:return C.abrupt("return",{success:!0,data:x.data,total:x.data.length});case 7:case"end":return C.stop()}},f)}));return function(f){return c.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:dt.Sl}})},la=u(64317),Bt=u(96074),da=u(11312),or=u(87366),Wt=u(99100),lr=["attendances"];function dr(o){return function(t){o(function(r){return m()(m()({},r),{},{loading:t})})}}function ca(o,n){return Kt.apply(this,arguments)}function Kt(){return Kt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n(!0),a.prev=1,a.abrupt("return",t());case 3:return a.prev=3,n(!1),a.finish(3);case 6:case"end":return a.stop()}},o,null,[[1,,3,6]])})),Kt.apply(this,arguments)}function cr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useCallback)(dr(l),[]),f=(0,v.useCallback)(i()(d()().mark(function j(){var S;return d()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,V(o,n);case 2:if(S=E.sent,S.success){E.next=5;break}return E.abrupt("return",S);case 5:return l(function(p){return m()(m()({},p),{},{data:S.data})}),E.abrupt("return",S);case 7:case"end":return E.stop()}},j)})),[n,o]),h=(0,v.useCallback)(function(j){return ca(c,function(){return Ye(j).then(f)})},[f]);return(0,v.useEffect)(function(){ca(c,f)},[f]),{finalGrades:a,deleteFinalGrade:h}}function mr(){var o=(0,v.useState)({loading:!1}),n=Z()(o,2),t=n[0],r=n[1];return(0,v.useEffect)(function(){r(function(a){return m()(m()({},a),{},{loading:!0})}),K().then(function(a){a.success&&r(function(l){return m()(m()({},l),{},{data:a.data})})}).finally(function(){r(function(a){return m()(m()({},a),{},{loading:!1})})})},[]),{gradeTerms:t}}function fr(o){var n=(0,v.useState)({loading:!1}),t=Z()(n,2),r=t[0],a=t[1];return(0,v.useEffect)(function(){o!==void 0&&(a(function(l){return m()(m()({},l),{},{loading:!0})}),U(o).then(function(l){l.success&&a(function(c){return m()(m()({},c),{},{data:l.data})})}).finally(function(){a(function(l){return m()(m()({},l),{},{loading:!1})})}))},[o]),{subjectGradeScales:r}}function vr(o,n,t){var r=(0,v.useState)({loading:!1}),a=Z()(r,2),l=a[0],c=a[1];return(0,v.useEffect)(function(){typeof o!="number"||typeof n!="number"||typeof t!="number"||(c(function(f){return m()(m()({},f),{},{loading:!0})}),Pt(o,n).then(function(f){f.success&&c(function(h){var j,S;return m()(m()({},h),{},{data:(j=qt(t,(S=f.data.grade_scale)!==null&&S!==void 0?S:[]))===null||j===void 0?void 0:j.map(function(_,E){return m()(m()({},_),{},{id:E})})})})}).finally(function(){c(function(f){return m()(m()({},f),{},{loading:!1})})}))},[o,n]),{tutorGradeScales:l}}function pr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useCallback)(function(){l(function(f){return m()(m()({},f),{},{loading:!0})}),ke(o).then(function(f){if(f.success){var h=f.data.reduce(function(j,S){var _=S.attendances,E=$t()(S,lr),p=_.find(function(x){return x.user_id===n});return p?[].concat(I()(j),[m()(m()({},E),{},{attendance:p})]):j},[]);l(function(j){return m()(m()({},j),{},{data:h})})}}).finally(function(){l(function(f){return m()(m()({},f),{},{loading:!1})})})},[o,n]);return(0,v.useEffect)(function(){c()},[c]),{userAttendanceSchedules:a,fetchUserAttendanceSchedules:c}}function hr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1];return(0,v.useEffect)(function(){n&&(l(function(c){return m()(m()({},c),{},{loading:!0})}),Re({student_id:o,semester_subject_id:n}).then(function(c){if(c.success){var f=Jt(c.data,o);l(function(h){return m()(m()({},h),{},{data:f})})}}).finally(function(){l(function(c){return m()(m()({},c),{},{loading:!1})})}))},[o,n]),{studentExams:a}}function gr(o,n){var t=(0,v.useState)({loading:!1}),r=Z()(t,2),a=r[0],l=r[1],c=(0,v.useState)({loading:!1}),f=Z()(c,2),h=f[0],j=f[1],S=(0,v.useState)({loading:!1}),_=Z()(S,2),E=_[0],p=_[1];return(0,v.useEffect)(function(){l(function(x){return m()(m()({},x),{},{loading:!0})}),(0,Wt.N7)({group_id:o}).then(function(x){x.success&&l(function(M){return m()(m()({},M),{},{data:x.data})})}).finally(function(){l(function(x){return m()(m()({},x),{},{loading:!1})})})},[o]),(0,v.useEffect)(function(){a.data&&(p(function(x){return m()(m()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var M=x.id;return(0,Wt.Nx)(Number(M))})).then(function(x){x.forEach(function(M){M.success&&p(function(C){return m()(m()({},C),{},{data:m()(m()({},C.data),{},nt()({},Number(M.data.id),(0,or.uS)(M.data.lessons)))})})})}).finally(function(){p(function(x){return m()(m()({},x),{},{loading:!1})})}),j(function(x){return m()(m()({},x),{},{loading:!0})}),Promise.all(a.data.map(function(x){var M=x.id;return(0,Wt.ue)(Number(M),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(C){if(C.success){var Y,G,L=((Y=C.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&Y!==void 0?Y:[]).filter(function(se){return se.id===n}),k=(G=C.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&G!==void 0?G:[];j(function(se){return m()(m()({},se),{},{data:m()(m()({},se.data),{},nt()({},Number(M),{finishedTopics:L,attendanceList:k}))})})}})})).finally(function(){return j(function(x){return m()(m()({},x),{},{loading:!1})})}))},[a.data,n]),{userCourses:a,userCoursesStats:h,userCoursesTopics:E}}var xr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],jr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(n,t){return(0,St.WU)(new Date(t.date_from),ct.GC)}}],br=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,t){return(0,St.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(n,t){return"".concat(t.result.result," ").concat(t.weight?"%":"")}}],Sr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=t.grade)!==null&&r!==void 0&&r.grade_date?(0,St.WU)(new Date((a=t.grade)===null||a===void 0?void 0:a.grade_date),ct.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(n,t){var r,a;return(r=(a=t.grade)===null||a===void 0?void 0:a.grade_name)!==null&&r!==void 0?r:"-"}}],Ut=6,_r=function(n){var t,r,a,l,c=n.user_id,f=n.group_id,h=(0,tt.Z)(),j=h.semester_subject_id,S=hr(c,j),_=S.studentExams,E=cr(f,c),p=E.finalGrades,x=E.deleteFinalGrade,M=mr(),C=M.gradeTerms,Y=fr((t=p.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),G=Y.subjectGradeScales,L=vr(j,(r=p.data)===null||r===void 0?void 0:r.tutor_id,(a=p.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),k=L.tutorGradeScales,se=pr(f,c),oe=se.userAttendanceSchedules,$=se.fetchUserAttendanceSchedules,R=gr(f,c),D=R.userCourses,A=R.userCoursesStats,q=R.userCoursesTopics,Fe=ot.ZP.useForm(),Le=Z()(Fe,1),ze=Le[0],it=(0,v.useMemo)(function(){var Ee;return((Ee=C.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se=Pe.id,We=Pe.name;return{label:We,value:Se}})},[C.data]),Ue=(0,v.useMemo)(function(){var Ee;return((Ee=G.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se=Pe.name,We=Pe.id;return{label:Se,value:We}})},[G.data]),Ae=(0,v.useMemo)(function(){var Ee,Pe;return Qt((Ee=_.data)!==null&&Ee!==void 0?Ee:[],(Pe=k.data)!==null&&Pe!==void 0?Pe:[])},[_.data,k.data]),re=(0,v.useCallback)(function(){var Ee=i()(d()().mark(function Pe(Se){var We,Qe,vt,ut,lt,_t,Mt;return d()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(vt=Se.grade_scale_id,ut=Se.grade_term_id,((We=p.data)===null||We===void 0?void 0:We.id)!==void 0){$e.next=3;break}return $e.abrupt("return");case 3:if(lt=(Qe=p.data)===null||Qe===void 0?void 0:Qe.grades.find(function(Ct){var ht=Ct.grade_term;return ht.id===ut}),!lt){$e.next=11;break}return $e.next=7,ge(lt.id,{grade_scale_id:vt});case 7:return _t=$e.sent,je.ZP[_t.success?"success":"error"](_t.message),_t.success&&s.history.push("/teacher/subjects/".concat(j,"/final-grades")),$e.abrupt("return");case 11:return $e.next=13,ce({grade_scale_id:vt,grade_term_id:ut,lesson_group_user_id:p.data.id});case 13:Mt=$e.sent,je.ZP[Mt.success?"success":"error"](Mt.message),Mt.success&&s.history.push("/teacher/subjects/".concat(j,"/final-grades"));case 16:case"end":return $e.stop()}},Pe)}));return function(Pe){return Ee.apply(this,arguments)}}(),[p.data,j]),pe=(0,v.useMemo)(function(){return[].concat(Sr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Pe,Se){var We;return typeof(Se==null||(We=Se.grade)===null||We===void 0?void 0:We.id)=="number"?[(0,e.jsx)(na.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return x(Se.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(kt.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),z=(0,v.useMemo)(function(){var Ee;return((Ee=C.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var Se;return m()(m()({},Pe),{},{grade:(Se=p.data)===null||Se===void 0?void 0:Se.grades.find(function(We){var Qe=We.grade_term;return Qe.id===Pe.id})})})},[p.data,C.data]),Je=D.loading&&!D.data||A.loading&&!A.data||q.loading&&!q.data,xe=!!(D.data&&A.data&&q.data);return p.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[p.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:p.data.user})}),(0,e.jsx)(Bt.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:Ut},dataSource:_.data,loading:_.loading,columns:br,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:Ut},dataSource:z,loading:p.loading||C.loading,columns:pe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:Ut},cardProps:{bodyStyle:{padding:0}},dataSource:oe.data,loading:oe.loading,columns:[].concat(jr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Pe,Se){return(0,e.jsx)(ta,{groupAttendanceScheduleId:Se.id,studentId:c,attendance:Se.attendance.value,onSuccess:$})}}])})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(H.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:Ut},cardProps:{bodyStyle:{padding:0}},dataSource:k.data,loading:k.loading,columns:xr})}),Je&&(0,e.jsx)(Oe.Z,{}),xe&&((l=D.data)===null||l===void 0?void 0:l.map(function(Ee){var Pe,Se,We,Qe,vt,ut,lt=Ee.id,_t=Ee.title;return(0,e.jsxs)(mt.Z,{span:24,children:[(0,e.jsx)(Ve.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:_t}),(0,e.jsx)(da.Du,{course_id:Number(lt),topics:(Pe=(Se=q.data)===null||Se===void 0?void 0:Se[Number(lt)])!==null&&Pe!==void 0?Pe:[],stats:(We=(Qe=A.data)===null||Qe===void 0||(Qe=Qe[Number(lt)])===null||Qe===void 0?void 0:Qe.finishedTopics)!==null&&We!==void 0?We:[]}),(0,e.jsx)(da.nu,{stats:(vt=(ut=A.data)===null||ut===void 0||(ut=ut[Number(lt)])===null||ut===void 0?void 0:ut.attendanceList)!==null&&vt!==void 0?vt:[]})]},lt)}))]}),(0,e.jsx)(ot.ZP,{form:ze,onFinish:re,children:(0,e.jsxs)(ot.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(la.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:it,width:"sm",fieldProps:{loading:C.loading}}),(0,e.jsx)(la.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:Ue,fieldProps:{loading:p.loading||G.loading}}),(0,e.jsx)(ot.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Ae}})})]})})]})},yr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(n,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(n,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(r){var a=r.grade_name,l=r.grade_term,c=r.id;return(0,e.jsxs)(Ve.Z.Text,{children:[l.name,": ",a]},c)}):"-"})}}],Mr=function(){var n,t,r=(0,s.useLocation)(),a=new URLSearchParams(r.search),l=(n=a.get("user_id"))!==null&&n!==void 0?n:null,c=(t=a.get("group_id"))!==null&&t!==void 0?t:null,f=(0,tt.Z)(),h=f.teacherSubjectData,j=f.semester_subject_id,S=(0,v.useMemo)(function(){var _;return((_=h==null?void 0:h.groups)!==null&&_!==void 0?_:[]).map(function(E){var p=E.id,x=E.name;return{label:x,value:p}})},[h==null?void 0:h.groups]);return l!==null&&c!==null?(0,e.jsx)(_r,{user_id:Number(l),group_id:Number(c)}):(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var _=i()(d()().mark(function E(p){var x,M,C,Y,G,L,k,se,oe,$;return d()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return M=p.group_id,C=M===void 0?[]:M,Y=p.first_name,G=Y===void 0?"":Y,L=p.last_name,k=L===void 0?"":L,se=((x=h==null?void 0:h.groups)!==null&&x!==void 0?x:[]).map(function(A){var q=A.id;return q}),D.next=4,N(C.length===0?se:C);case 4:if(oe=D.sent,oe.success){D.next=7;break}return D.abrupt("return",{success:!1,total:0,data:[]});case 7:return $=oe.data.filter(function(A){var q=A.user;return q.first_name.toLowerCase().includes(G.toLowerCase())&&q.last_name.toLowerCase().includes(k.toLowerCase())}),D.abrupt("return",{success:!0,total:$.length,data:$});case 9:case"end":return D.stop()}},E)}));return function(E){return _.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:S,mode:"multiple"},render:function(E,p){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:p.group_id},p.group_id)}}].concat(yr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(E,p){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(j,"/final-grades?user_id=").concat(p.user.id,"&group_id=").concat(p.group_id),children:(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(Gt.Z,{})})})},"edit")]}}])})},Cr=u(88284),Tr=u(88280),Fr=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Er=function(n){var t=n.subjectTutorGradeScale,r=n.onFormSubmit,a=(0,v.useState)([]),l=Z()(a,2),c=l[0],f=l[1],h=(0,v.useRef)(),j=ot.ZP.useForm(),S=Z()(j,1),_=S[0];return(0,v.useEffect)(function(){var E,p=((E=t.scale)!==null&&E!==void 0?E:[]).map(function(x,M){return m()(m()({},x),{},{id:String((M+1)*100)})});_.setFieldValue("table",p)},[]),(0,e.jsx)(ot.ZP,{form:_,onFinish:r,submitter:{render:function(p,x){var M=Z()(x,2),C=M[1];return[C]}},children:(0,e.jsx)(Tr.Z,{name:"table",rowKey:"id",actionRef:h,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Fr,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(p,x){return(0,e.jsx)(g.ZP,{type:"primary",onClick:function(){var C;return(C=h.current)===null||C===void 0?void 0:C.startEditable(x.id)},icon:(0,e.jsx)(Gt.Z,{})})}}]),editable:{form:_,type:"multiple",editableKeys:c,saveText:(0,e.jsx)(g.ZP,{type:"primary",icon:(0,e.jsx)(Cr.Z,{})}),onChange:f,actionRender:function(p,x,M){return[M.save]}}})})},Pr=function(){var n,t,r=(0,s.useModel)("@@initialState"),a=r.initialState,l=(0,tt.Z)(),c=l.semester_subject_id,f=l.tutors,h=(0,v.useState)(),j=Z()(h,2),S=j[0],_=j[1],E=(0,v.useState)(!1),p=Z()(E,2),x=p[0],M=p[1],C=(0,v.useState)(null),Y=Z()(C,2),G=Y[0],L=Y[1],k=(0,v.useMemo)(function(){return!!f.data.find(function(R){var D,A=R.id;return A===(a==null||(D=a.currentUser)===null||D===void 0?void 0:D.id)})},[f.data,a==null||(n=a.currentUser)===null||n===void 0?void 0:n.id]),se=(0,v.useMemo)(function(){return f.data.map(function(R){var D=R.id,A=R.first_name,q=R.last_name;return{label:"".concat(A," ").concat(q),value:D}})},[f.data]),oe=(0,v.useCallback)(function(){c===null||G===null||(M(!0),_(void 0),Pt(c,G).then(function(R){R.success&&_(R.data)}).finally(function(){M(!1)}))},[c,G]),$=(0,v.useCallback)(function(R,D){return function(){var A=i()(d()().mark(function q(Fe){var Le,ze;return d()().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if(!(c===null||G===null)){Ue.next=2;break}return Ue.abrupt("return");case 2:return Le=R.reduce(function(Ae,re){return re.s_subject_scale_form_id===D?[].concat(I()(Ae),[{s_subject_scale_form_id:D,scale:Fe.table.map(function(pe){var z=pe.name,Je=pe.grade,xe=pe.grade_value;return{name:z,grade:Je,grade_value:xe}})}]):[].concat(I()(Ae),[re])},[]),Ue.next=5,Dt(c,G,{grade_scale:Le});case 5:ze=Ue.sent,ze.success&&oe();case 7:case"end":return Ue.stop()}},q)}));return function(q){return A.apply(this,arguments)}}()},[G,c]);return(0,v.useEffect)(function(){var R,D;if(!k||!(a!=null&&(R=a.currentUser)!==null&&R!==void 0&&R.id)){var A;if((A=f.data)!==null&&A!==void 0&&A[0]){var q;L((q=f.data)===null||q===void 0?void 0:q[0].id)}return}L(a==null||(D=a.currentUser)===null||D===void 0?void 0:D.id)},[a==null||(t=a.currentUser)===null||t===void 0?void 0:t.id,k]),(0,v.useEffect)(function(){oe()},[oe]),f.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ot.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(wt.default,{disabled:k,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:se,value:G,onChange:function(D){return L(D)}})}),(0,e.jsx)(Bt.Z,{}),x&&!S&&(0,e.jsx)(Oe.Z,{}),S!=null&&S.grade_scale?S.grade_scale.map(function(R,D){var A;return(0,e.jsxs)(v.Fragment,{children:[D>0&&(0,e.jsx)(Bt.Z,{}),(0,e.jsx)(Er,{subjectTutorGradeScale:R,onFormSubmit:$((A=S.grade_scale)!==null&&A!==void 0?A:[],R.s_subject_scale_form_id)})]},R.s_subject_scale_form_id)}):(0,e.jsx)(Ve.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},Zr=u(30814),Ir=u(40411),Gr=u(31156),wr=u(27484),ft=u.n(wr);function Dr(o,n){return Vt.apply(this,arguments)}function Vt(){return Vt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/schedules",m()({params:n,method:"GET",useCache:!1},t||{})));case 1:case"end":return a.stop()}},o)})),Vt.apply(this,arguments)}var Lr=function(){var n=(0,v.useState)(null),t=Z()(n,2),r=t[0],a=t[1],l=(0,v.useState)([]),c=Z()(l,2),f=c[0],h=c[1],j=(0,tt.Z)(),S=j.semester_subject_id,_=ft()(),E=(0,v.useMemo)(function(){return f.map(function(L){return{id:L.id,title:"".concat(L.group.name," (").concat(L.term_status.name,")"),start:ft()(L.date_from).toDate(),end:ft()(L.date_to).toDate(),tutor_name:"".concat(L.tutor.first_name," ").concat(L.tutor.last_name),tutor_email:L.tutor.email,semester:L.semester.name,group:L.group.name,subject:L.subject.name,ms_teams_join_url:L.ms_teams_join_url}})},[f]),p=(0,v.useCallback)(function(L,k){Dr({semester_subject_id:S,date_form:L.toDate(),date_to:k.toDate()}).then(function(se){se.success&&h(se.data)})},[S]),x=(0,v.useCallback)(function(L){a(L)},[]),M=(0,v.useCallback)(function(){a(null)},[]),C=(0,v.useCallback)(function(L){return L.isSame(_,"day")?"warning":L.isAfter(_,"day")?"success":"error"},[]),Y=(0,v.useCallback)(function(L){var k=E.filter(function(se){return ft()(se.start).isSame(L,"day")});return(0,e.jsx)("ul",{className:"events",children:k.map(function(se){return(0,e.jsx)("li",{onClick:function(){return x(se)},children:(0,e.jsx)(Ir.Z,{status:C(ft()(se.start)),text:se.title})},se.id)})})},[f]),G=(0,v.useCallback)(function(L,k){var se=ft()(L).startOf(k).subtract(1,"month"),oe=ft()(L).endOf(k).add(1,"month");p(se,oe)},[]);return(0,v.useEffect)(function(){var L=ft()().startOf("month"),k=ft()().endOf("month");p(L,k)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ve.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(Gr.Z,{dateCellRender:Y,onPanelChange:G}),(0,e.jsxs)(be.Z,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:M,footer:null,children:[(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",r&&ft()(r.start).format(ct.E)]}),(0,e.jsxs)(Ve.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",r&&ft()(r.end).format(ct.E)]}),(r==null?void 0:r.ms_teams_join_url)&&(0,e.jsx)(Ve.Z.Paragraph,{children:(0,e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(g.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},Ar=u(58638);function Rr(o,n){return Xt.apply(this,arguments)}function Xt(){return Xt=i()(d()().mark(function o(n,t){return d()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return a.stop()}},o)})),Xt.apply(this,arguments)}var $r=function(n){var t=n.student_id,r=(0,v.useState)(!1),a=Z()(r,2),l=a[0],c=a[1],f=(0,v.useCallback)(i()(d()().mark(function h(){var j;return d()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return c(!0),_.next=3,Rr({user_id:t});case 3:if(j=_.sent,j.success){_.next=8;break}return je.ZP.error(j.message),c(!1),_.abrupt("return");case 8:window.open(j.data.web_url,"_blank","noopener noreferrer"),c(!1);case 10:case"end":return _.stop()}},h)})),[]);return(0,e.jsx)(he.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(g.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(Ar.Z,{}),onClick:f})})},Or=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Nr=function(n){return n.map(function(t){var r=t.id,a=t.name;return{label:a,value:r}})},Ur=function(n,t){return n.reduce(function(r,a){if(!(a!=null&&a.users))return r;var l=a.users.reduce(function(c,f){var h=t.some(function(j){return j.user.id===f.id});return f.academic_teacher_id!==null&&!h?c:[].concat(I()(c),[{group_id:a.id,group_name:a.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(I()(r),I()(l))},[])},kr=function(){var n=(0,tt.Z)(),t=n.teacherSubjectData,r=(0,v.useMemo)(function(){var a;return Nr((a=t==null?void 0:t.groups)!==null&&a!==void 0?a:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(H.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var a=i()(d()().mark(function l(c){var f,h,j,S,_,E,p,x,M,C;return d()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return f=c.groups,h=c.first_name,j=h===void 0?"":h,S=c.last_name,_=S===void 0?"":S,E=c.email,p=E===void 0?"":E,G.next=3,(0,yt.Z)({parent_id:t==null?void 0:t.group_id,id:f});case 3:if(x=G.sent,x.success){G.next=6;break}return G.abrupt("return",{data:[],total:0,success:!1});case 6:return G.next=8,N(x.data.map(function(L){return L.id}));case 8:if(M=G.sent,M.success){G.next=11;break}return G.abrupt("return",{data:[],success:!1});case 11:return C=Ur(x.data,M.data).filter(function(L){return L.first_name.toLowerCase().includes(j.toLowerCase())&&L.last_name.toLowerCase().includes(_.toLowerCase())&&L.email.toLowerCase().includes(p.toLowerCase())}),G.abrupt("return",{data:C,total:C.length,success:!0});case 13:case"end":return G.stop()}},l)}));return function(l){return a.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(Or,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,c){return[(0,e.jsx)($r,{student_id:c.user_id},"teamsChat")]}}])})},Br=function(n){var t,r,a=n.tab,l=(0,s.useIntl)(),c=(0,s.useModel)("@@initialState"),f=c.setInitialState,h=c.initialState,j=(0,tt.Z)(),S=j.teacherSubjectData,_=j.semester_subject_id,E=j.tutors,p=(0,v.useCallback)((0,Ze.X)(h==null?void 0:h.currentUser),[h==null?void 0:h.currentUser]),x=(0,v.useMemo)(function(){return!!E.data.find(function(M){var C,Y=M.id;return Y===(h==null||(C=h.currentUser)===null||C===void 0?void 0:C.id)})||p(Ke.Z.TeacherListGradeScale)},[]);return S?(0,e.jsx)(B._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:S==null||(t=S.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:a})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(_,"/exams?exam_id=new"),children:(0,e.jsx)(g.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(_),breadcrumbName:String((r=S.subject)===null||r===void 0?void 0:r.name)},{path:String(a),breadcrumbName:l.formatMessage({id:a,defaultMessage:String(a)})}]}},children:(0,e.jsxs)(_e.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:a,onChange:function(C){f(m()({},h)),s.history.push("/teacher/subjects/".concat(_,"/").concat(C))}},children:[(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(Zr.F,{})},"groups"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(kr,{})},"students"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(er,{})},"exams"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Lr,{})},"schedule"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(Ia,{})},"class-register"),x&&(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(Pr,{})},"grades-scale"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(Mr,{})},"final-grades"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(ur,{})},"file-exports-history")]})}):(0,e.jsx)(Oe.Z,{})},Wr=function(){var o=(0,s.useParams)(),n=o.subjectId,t=o.tab,r=t===void 0?"groups":t;return(0,e.jsx)(tt.p,{semester_subject_id:Number(n),children:(0,e.jsx)(Br,{tab:r})})}},76841:function(Tt,qe,u){u.d(qe,{Gm:function(){return g},Sx:function(){return d},_g:function(){return s}});var Xe=u(15009),m=u.n(Xe),Ke=u(97857),Ze=u.n(Ke),_e=u(99289),B=u.n(_e),Oe=u(80854);function g(i,y){return v.apply(this,arguments)}function v(){return v=B()(m()().mark(function i(y,I){return m()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",(0,Oe.request)("/api/admin/reports/report",Ze()({params:y,method:"GET",useCache:!1},I||{})));case 1:case"end":return Z.stop()}},i)})),v.apply(this,arguments)}function s(i,y,I){return ee.apply(this,arguments)}function ee(){return ee=B()(m()().mark(function i(y,I,ae){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,Oe.request)("/api/admin/stats/course/".concat(y,"/export"),Ze()({params:I,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ae||{})));case 1:case"end":return H.stop()}},i)})),ee.apply(this,arguments)}function d(i,y,I){return P.apply(this,arguments)}function P(){return P=B()(m()().mark(function i(y,I,ae){return m()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",(0,Oe.request)("/api/admin/stats/topic/".concat(y,"/export"),Ze()({method:"GET",useCache:!1,params:{stat:I},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ae||{})));case 1:case"end":return H.stop()}},i)})),P.apply(this,arguments)}},70804:function(Tt,qe,u){var Xe=u(67294);var m=function(ee,d){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,i){P.__proto__=i}||function(P,i){for(var y in i)i.hasOwnProperty(y)&&(P[y]=i[y])})(ee,d)},Ke,Ze,_e=(function(ee){(function(){var d={}.hasOwnProperty;function P(){for(var i=[],y=0;y<arguments.length;y++){var I=arguments[y];if(I){var ae=typeof I;if(ae==="string"||ae==="number")i.push(I);else if(Array.isArray(I)&&I.length){var Z=P.apply(null,I);Z&&i.push(Z)}else if(ae==="object")for(var H in I)d.call(I,H)&&I[H]&&i.push(H)}}return i.join(" ")}ee.exports?(P.default=P,ee.exports=P):window.classNames=P})()}(Ze={path:Ke,exports:{},require:function(ee,d){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(d==null&&Ze.path)}},Ze.exports),Ze.exports);function B(ee,d,P){var i,y,I,ae,Z;function H(){var he=Date.now()-ae;he<d&&he>=0?i=setTimeout(H,d-he):(i=null,P||(Z=ee.apply(I,y),I=y=null))}d==null&&(d=100);var be=function(){I=this,y=arguments,ae=Date.now();var he=P&&!i;return i||(i=setTimeout(H,d)),he&&(Z=ee.apply(I,y),I=y=null),Z};return be.clear=function(){i&&(clearTimeout(i),i=null)},be.flush=function(){i&&(Z=ee.apply(I,y),I=y=null,clearTimeout(i),i=null)},be}B.debounce=B;var Oe=B;(function(ee,d){d===void 0&&(d={});var P=d.insertAt;if(ee&&typeof document!="undefined"){var i=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css",P==="top"&&i.firstChild?i.insertBefore(y,i.firstChild):i.appendChild(y),y.styleSheet?y.styleSheet.cssText=ee:y.appendChild(document.createTextNode(ee))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var g,v=(g="indiana-scroll-container",function(ee,d){if(!ee)return g;var P;typeof ee=="string"?P=ee:d=ee;var i=g;return P&&(i+="__"+P),i+(d?Object.keys(d).reduce(function(y,I){var ae=d[I];return ae&&(y+=" "+(typeof ae=="boolean"?i+"--"+I:i+"--"+I+"_"+ae)),y},""):"")}),s=function(ee){function d(P){var i=ee.call(this,P)||this;return i.onEndScroll=function(){i.scrolling=!1,!i.pressed&&i.started&&i.processEnd()},i.onScroll=function(y){var I=i.container.current;I.scrollLeft===i.scrollLeft&&I.scrollTop===i.scrollTop||(i.scrolling=!0,i.processScroll(y),i.onEndScroll())},i.onTouchStart=function(y){var I=i.props.nativeMobileScroll;if(i.isDraggable(y.target))if(i.internal=!0,I&&i.scrolling)i.pressed=!0;else{var ae=y.touches[0];i.processClick(y,ae.clientX,ae.clientY),!I&&i.props.stopPropagation&&y.stopPropagation()}},i.onTouchEnd=function(y){var I=i.props.nativeMobileScroll;i.pressed&&(!i.started||i.scrolling&&I?i.pressed=!1:i.processEnd(),i.forceUpdate())},i.onTouchMove=function(y){var I=i.props.nativeMobileScroll;if(i.pressed&&(!I||!i.isMobile)){var ae=y.touches[0];ae&&i.processMove(y,ae.clientX,ae.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation()}},i.onMouseDown=function(y){i.isDraggable(y.target)&&i.isScrollable()&&(i.internal=!0,i.props.buttons.indexOf(y.button)!==-1&&(i.processClick(y,y.clientX,y.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation()))},i.onMouseMove=function(y){i.pressed&&(i.processMove(y,y.clientX,y.clientY),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation())},i.onMouseUp=function(y){i.pressed&&(i.started?i.processEnd():(i.internal=!1,i.pressed=!1,i.forceUpdate(),i.props.onClick&&i.props.onClick(y)),y.preventDefault(),i.props.stopPropagation&&y.stopPropagation())},i.container=Xe.createRef(),i.onEndScroll=Oe(i.onEndScroll,300),i.scrolling=!1,i.started=!1,i.pressed=!1,i.internal=!1,i.getRef=i.getRef.bind(i),i}return function(P,i){function y(){this.constructor=P}m(P,i),P.prototype=i===null?Object.create(i):(y.prototype=i.prototype,new y)}(d,ee),d.prototype.componentDidMount=function(){var P=this.props.nativeMobileScroll,i=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),i.addEventListener("touchstart",this.onTouchStart,{passive:!1}),i.addEventListener("mousedown",this.onMouseDown,{passive:!1}),P&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},d.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},d.prototype.getElement=function(){return this.container.current},d.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},d.prototype.isDraggable=function(P){var i=this.props.ignoreElements;if(i){var y=P.closest(i);return y===null||y.contains(this.getElement())}return!0},d.prototype.isScrollable=function(){var P=this.container.current;return P&&(P.scrollWidth>P.clientWidth||P.scrollHeight>P.clientHeight)},d.prototype.processClick=function(P,i,y){var I=this.container.current;this.scrollLeft=I.scrollLeft,this.scrollTop=I.scrollTop,this.clientX=i,this.clientY=y,this.pressed=!0},d.prototype.processStart=function(P){P===void 0&&(P=!0);var i=this.props.onStartScroll;this.started=!0,P&&document.body.classList.add("indiana-dragging"),i&&i({external:!this.internal}),this.forceUpdate()},d.prototype.processScroll=function(P){if(this.started){var i=this.props.onScroll;i&&i({external:!this.internal})}else this.processStart(!1)},d.prototype.processMove=function(P,i,y){var I=this.props,ae=I.horizontal,Z=I.vertical,H=I.activationDistance,be=I.onScroll,he=this.container.current;this.started?(ae&&(he.scrollLeft-=i-this.clientX),Z&&(he.scrollTop-=y-this.clientY),be&&be({external:!this.internal}),this.clientX=i,this.clientY=y,this.scrollLeft=he.scrollLeft,this.scrollTop=he.scrollTop):(ae&&Math.abs(i-this.clientX)>H||Z&&Math.abs(y-this.clientY)>H)&&(this.clientX=i,this.clientY=y,this.processStart())},d.prototype.processEnd=function(){var P=this.props.onEndScroll;this.container.current&&P&&P({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},d.prototype.getRef=function(P){[this.container,this.props.innerRef].forEach(function(i){i&&(typeof i=="function"?i(P):i.current=P)})},d.prototype.render=function(){var P=this.props,i=P.children,y=P.draggingClassName,I=P.className,ae=P.style,Z=P.hideScrollbars,H=P.component;return Xe.createElement(H,{className:_e(I,this.pressed&&y,v({dragging:this.pressed,"hide-scrollbars":Z,"native-scroll":this.isMobile})),style:ae,ref:this.getRef,onScroll:this.onScroll},i)},d.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},d}(Xe.PureComponent);qe.Z=s}}]);
