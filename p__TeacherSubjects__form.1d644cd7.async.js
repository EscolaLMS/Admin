(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(ot,De,i){},"5Syx":function(ot,De,i){"use strict";i.d(De,"c",function(){return Se}),i.d(De,"b",function(){return tt}),i.d(De,"a",function(){return qe});var j=i("OaEy"),Me=i("2fM7"),de=i("g9YV"),F=i("wCAj"),oe=i("14J3"),o=i("BMrR"),rt=i("BoS7"),s=i("Sdc0"),Qe=i("jrin"),se=i("k1fw"),le=i("DYRE"),fe=i("zeV3"),ze=i("+BJd"),Te=i("mr32"),Z=i("oBTY"),ge=i("tJVT"),$e=i("q1tI"),ut=i.n($e),jt=i("nhC9"),We=i("LDJE"),S=i("9kvl"),V=i("nz6D"),Pe=i("Vpfc"),nt=i("+L6B"),ct=i("2/Rp"),re=i("qLMh"),W=i("9og8"),R=i("4KAj"),I=i("w/VK"),g=i("nKUr"),xe=function(ye){var _e=ye.course_id,Ee=ye.stat,Ie=Ee===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":Ee,ve=Object($e.useState)(!1),ae=Object(ge.a)(ve,2),q=ae[0],Ve=ae[1],Ne=Object($e.useCallback)(function(G){return Object(W.a)(Object(re.a)().mark(function be(){var ne,me;return Object(re.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return Ve(!0),E.prev=1,E.next=4,Object(I.a)(G,{stat:Ie});case 4:ne=E.sent,ne instanceof Blob&&(me=document.createElement("a"),me.href=window.URL.createObjectURL(ne),me.download="finished_topics_".concat(_e,".xlsx"),document.body.appendChild(me),me.click(),document.body.removeChild(me)),E.next=11;break;case 8:E.prev=8,E.t0=E.catch(1),console.error(E.t0);case 11:return E.prev=11,Ve(!1),E.finish(11);case 14:case"end":return E.stop()}},be,null,[[1,8,11,14]])}))},[Ie]);return Object(g.jsxs)(ct.a,{type:"primary",loading:q,onClick:Ne(_e),children:[Object(g.jsx)(R.a,{})," ",Object(g.jsx)(S.a,{id:"export"})]})},J=function(ye){return ye.topicable.content.contents?Object.values(ye.topicable.content.contents)[0].library:"H5P"},Se=function(ye){var _e=ye.course_id,Ee=ye.topics,Ie=ye.stats,ve=Object($e.useState)(!1),ae=Object(ge.a)(ve,2),q=ae[0],Ve=ae[1],Ne=Object($e.useMemo)(function(){return[{title:Object(g.jsx)(S.a,{id:"user"}),dataIndex:"id",render:function(ne){return Object(g.jsx)(Pe.a,{type:"App\\Models\\User",type_id:ne})}},{title:Object(g.jsx)(S.a,{id:"email"}),dataIndex:"email"}].concat(Object(Z.a)(Ee.map(function(be){var ne,me=(ne=be.topicable_type)===null||ne===void 0?void 0:ne.split("\\").pop();return me==="H5P"&&(me=J(be)),{render:function(E){var Ae=0,Je=0;switch(E&&(E.started_at&&E.finished_at?Ae=1:E.started_at&&(Ae=2),Je=E.seconds/60),Ae){case 1:return Object(g.jsxs)(fe.b,{children:[Object(g.jsx)(Te.a,{color:"success",children:"F"}),q&&Object(g.jsxs)("small",{children:[Je.toFixed(2),"m"]})]});case 2:return Object(g.jsxs)(fe.b,{children:[Object(g.jsx)(Te.a,{color:"blue",children:"S"}),q&&Object(g.jsxs)("small",{children:[Je.toFixed(2),"m"]})]});case 0:default:return Object(g.jsx)(ut.a.Fragment,{children:Object(g.jsx)(Te.a,{color:"error",children:"N"})})}},title:Object(g.jsxs)("small",{children:[Object(g.jsx)(Te.a,{children:me})," ",be.title]}),dataIndex:be.id}})))},[Ee,q]),G=Object($e.useMemo)(function(){return Ie.map(function(be){return Ee.reduce(function(ne,me){var N=be.topics.find(function(E){return E.id===me.id});return Object(se.a)(Object(se.a)({},ne),{},Object(Qe.a)({},Number(me.id),N!=null?N:0))},{email:be.email,id:be.id})})},[Ie,Ee]);return Object(g.jsx)(F.a,{title:function(){return Object(g.jsxs)(o.a,{justify:"space-between",align:"middle",children:[Object(g.jsxs)(fe.b,{children:[Object(g.jsx)(S.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(g.jsx)(Te.a,{color:"success",children:"F"}),Object(g.jsx)(S.a,{id:"Started",defaultMessage:"Started:"})," ",Object(g.jsx)(Te.a,{color:"blue",children:"S"}),Object(g.jsx)(S.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(g.jsx)(Te.a,{color:"error",children:"N"}),Object(g.jsx)(S.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(g.jsx)(s.a,{checked:q,onChange:function(me){return Ve(me)}})]}),Object(g.jsx)(xe,{course_id:_e})]})},columns:Ne,dataSource:G,size:"small",scroll:{x:1500},components:{table:function(ne){return Object(g.jsx)(V.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(g.jsx)("table",Object(se.a)({},ne))})}}})},tt=function(ye){var _e=ye.stats,Ee=ye.attempts,Ie=Object($e.useMemo)(function(){return[{title:Object(g.jsx)(S.a,{id:"user"}),dataIndex:"id",render:function(q){return Object(g.jsx)(Pe.a,{type:"App\\Models\\User",type_id:q})}},{title:Object(g.jsx)(S.a,{id:"email"}),dataIndex:"email"},{title:Object(g.jsx)(S.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(g.jsx)(S.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at"}]},[]),ve=Object($e.useMemo)(function(){return _e.map(function(ae){var q=ae.id,Ve=ae.email,Ne=ae.finished_at,G=Ee==null?void 0:Ee.find(function(ne){return ne.id===q}),be=Array.isArray(G==null?void 0:G.attempts)?G==null?void 0:G.attempts.length:0;return{id:q,email:Ve,finished_at:Ne,attempt:be}})},[_e]);return Object(g.jsx)(F.a,{title:function(){return Object(g.jsx)(fe.b,{children:Object(g.jsx)(S.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ie,dataSource:ve,size:"small",scroll:{x:500}})},qe=function(ye){var _e=ye.stats,Ee=Object($e.useState)(null),Ie=Object(ge.a)(Ee,2),ve=Ie[0],ae=Ie[1],q=Object($e.useState)(null),Ve=Object(ge.a)(q,2),Ne=Ve[0],G=Ve[1],be=Object(S.l)(),ne=Object($e.useMemo)(function(){return _e.flatMap(function(N){return Object.values(N.attempts).flatMap(function(E){var Ae=E.dates,Je=E.attempt,ue=Object.values(Ae).flatMap(function(P){var L=P.date,M=P.seconds_total;return{date:L,attempt:Je,seconds_total:M,email:N.email}});return ue})})},[_e]),me={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(g.jsx)(jt.a,{title:Object(g.jsxs)(fe.b,{children:[Object(g.jsx)(S.a,{id:"course.interactions_time_in_days"}),Object(g.jsx)(Me.a,{showSearch:!0,value:ve,onChange:function(E){ae(E),G(null)},placeholder:Object(g.jsx)(S.a,{id:"select_person",defaultMessage:"Select a person"}),children:_e.map(function(N){var E=N.id,Ae=N.email;return Object(g.jsx)(Me.a.Option,{value:Ae,children:Ae},E)})}),Object(g.jsx)(Me.a,{value:Ne,onChange:function(E){return G(E)},disabled:ve===null,placeholder:Object(g.jsx)(S.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(Z.a)(new Set(ne.filter(function(N){var E=N.email;return E===ve}).map(function(N){var E=N.attempt;return E}))).map(function(N){return Object(g.jsxs)(Me.a.Option,{value:N,children:[Object(g.jsx)(S.a,{id:"attempt",defaultMessage:"Attempt"})," ",N]},N)})})]}),colSpan:12,layout:"center",children:Object(g.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(g.jsx)(We.a,Object(se.a)(Object(se.a)({},me),{},{tooltip:{title:"".concat(be.formatMessage({id:"attempt"})),formatter:function(E){var Ae=Math.floor(+E.seconds_total/60),Je=+E.seconds_total>60?+E.seconds_total-Ae*60:0;return{name:E.attempt,value:"".concat(Ae,"m ").concat(Je,"s")}}},data:ne.filter(function(N){var E=N.email;return E===ve}).filter(function(N){var E=N.attempt;return Number.isInteger(Ne)?E===Ne:!0})}))})})}},olry:function(ot,De,i){"use strict";i.r(De);var j=i("k1fw"),Me=i("+L6B"),de=i("2/Rp"),F=i("T2oS"),oe=i("W9HT"),o=i("q1tI"),rt=i.n(o),s=i("9kvl"),Qe=i("55Ip"),se=i("Ty5D"),le=i("nhC9"),fe=i("tMyG"),ze=i("my69"),Te=i("huej"),Z=i("mJ0o"),ge=i("EhlZ"),$e=i("P2fV"),ut=i("NJEC"),jt=i("5Dmo"),We=i("3S7+"),S=i("qLMh"),V=i("9og8"),Pe=i("sWYD"),nt=i("G3dp"),ct=i("lbgm"),re=i("/MfK"),W=i("Qiat"),R=i("mGZj");function I(c,r){return g.apply(this,arguments)}function g(){return g=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(j.a)({method:"GET",useCache:!1,params:r},a||{})));case 1:case"end":return t.stop()}},c)})),g.apply(this,arguments)}function xe(c,r){return J.apply(this,arguments)}function J(){return J=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(j.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},c)})),J.apply(this,arguments)}function Se(c,r,a){return tt.apply(this,arguments)}function tt(){return tt=Object(V.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(j.a)({method:"PUT",data:a,useCache:!1},n||{})));case 1:case"end":return u.stop()}},c)})),tt.apply(this,arguments)}function qe(c,r){return Ce.apply(this,arguments)}function Ce(){return Ce=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(j.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Ce.apply(this,arguments)}function ye(c,r){return _e.apply(this,arguments)}function _e(){return _e=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r),Object(j.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},c)})),_e.apply(this,arguments)}function Ee(c,r,a,n){return Ie.apply(this,arguments)}function Ie(){return Ie=Object(V.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(j.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},t||{})));case 1:case"end":return d.stop()}},c)})),Ie.apply(this,arguments)}function ve(c,r,a){return ae.apply(this,arguments)}function ae(){return ae=Object(V.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/exams/".concat(r,"/users/").concat(a),Object(j.a)({method:"DELETE"},n||{})));case 1:case"end":return u.stop()}},c)})),ae.apply(this,arguments)}var q=i("Vpfc"),Ve=i("giR+"),Ne=i("fyUT"),G=i("tJVT"),be=i("14J3"),ne=i("BMrR"),me=i("jCWc"),N=i("kPKH"),E=i("VMEa"),Ae=i("Qurx"),Je=i("lR9U"),ue=i("/y+f"),P=i("2qtc"),L=i("kLXV"),M=i("oBTY"),U=i("OaEy"),B=i("2fM7"),k=i("DBJ/"),e=i("nKUr"),Ue=function(r){var a=r.type,n=r.onDataConverted,t=r.groupSelectDisabled,u=Object(Z.b)(),d=u.semester_subject_id,b=u.teacherSubjectData,m=Object(o.useState)(null),y=Object(G.a)(m,2),x=y[0],O=y[1],h=Object(o.useMemo)(function(){var v;return((v=b==null?void 0:b.groups)!==null&&v!==void 0?v:[]).map(function(p){var C=p.id,T=p.name;return{label:T,value:C}})},[]),l={type:a,group_id:x,semester_subject_id:d},f=Object(o.useCallback)(function(v){if(v.success){var p=v.data.results.filter(function(C){var T=C.user_id;return T!==null});if(!p.length)return;n({exam_results:p,group_id:v.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(B.a,{disabled:t,value:x,onChange:function(p){return O(p)},options:h,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(k.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(p){return!p.fileList.length&&n(void 0)},maxFiles:1,data:l,disabled:!x})]})},Jt=function(r){var a=r.onDataConverted,n=Object(Z.b)(),t=n.teacherSubjectData,u=n.groupUsers,d=Object(o.useState)(null),b=Object(G.a)(d,2),m=b[0],y=b[1],x=Object(o.useMemo)(function(){var h;return((h=t==null?void 0:t.groups)!==null&&h!==void 0?h:[]).map(function(l){var f=l.id,v=l.name;return{label:v,value:f}})},[]),O=Object(o.useCallback)(function(h){var l;y(h);var f=(l=u.byId)===null||l===void 0?void 0:l[h];if(!!f){var v=f.users.reduce(function(p,C){var T=C.id,_=C.email,H=C.first_name,K=C.last_name,ce=C.academic_teacher_id;return ce!==null?p:[].concat(Object(M.a)(p),[{email:_,first_name:H,last_name:K,user_id:T,result:0}])},[]);a({group_id:h,exam_results:v})}},[u.byId]);return Object(e.jsx)(B.a,{value:m,onChange:O,options:x,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},Yt=[ue.c.TeamsLecture,ue.c.TestPortal,ue.c.TeamsForms],Xt=function(r){var a=r.open,n=r.closeModal,t=r.onSuccess,u=r.type,d=Object(Z.b)(),b=d.teacherSubjectData,m=d.fetchGroupUsers,y=Object(o.useState)(),x=Object(G.a)(y,2),O=x[0],h=x[1];return Object(o.useEffect)(function(){if(u===ue.c.Manual&&a){var l;b==null||(l=b.groups)===null||l===void 0||l.forEach(function(f){var v=f.id;return m(v)})}},[u,a]),Object(e.jsxs)(L.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(u,"Convert")}),width:"40vw",open:a,onCancel:n,onOk:function(){O&&t(O)},okButtonProps:{disabled:!O},children:[Yt.includes(u)&&Object(e.jsx)(Ue,{type:u,onDataConverted:h,groupSelectDisabled:!!O}),u===ue.c.Manual&&Object(e.jsx)(Jt,{onDataConverted:h})]})},Zt=function(r){var a=r.onSelect;return Object(e.jsxs)(ne.a,{gutter:[16,16],children:[Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(de.a,{type:"primary",onClick:function(){return a(ue.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(de.a,{type:"primary",onClick:function(){return a(ue.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(de.a,{type:"primary",onClick:function(){return a(ue.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(de.a,{type:"primary",onClick:function(){return a(ue.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},Qt=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],qt=function(r){var a,n=r.exam_id,t=E.a.useForm(),u=Object(G.a)(t,1),d=u[0],b=Object(o.useState)(),m=Object(G.a)(b,2),y=m[0],x=m[1],O=Object(o.useState)(),h=Object(G.a)(O,2),l=h[0],f=h[1],v=Object(o.useState)(!1),p=Object(G.a)(v,2),C=p[0],T=p[1],_=Object(Z.b)(),H=_.semester_subject_id,K=_.getGroupById,ce=Object(o.useMemo)(function(){var A;return((A=l==null?void 0:l.exam_results)!==null&&A!==void 0?A:[]).map(function(D){var $=D.user_id;return $})},[l==null?void 0:l.exam_results]);Object(o.useEffect)(function(){var A=Number(n);n==="new"&&(x(void 0),f(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(A)&&(T(!0),qe(A).then(function(D){if(D.success){var $=D.data,Y=$.type,Fe=$.results,Be=$.title,Q=$.weight,ee=$.passed_at,z=$.group_id;x(Y),f({group_id:z,exam_results:Fe}),d.setFieldsValue({title:Be,weight:Q,passed_at:ee})}}).finally(function(){return T(!1)}))},[n]);var Oe=Object(o.useCallback)(function(){x(void 0),f(void 0)},[]);return C?Object(e.jsx)(oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[y&&Object(e.jsx)(Xt,{open:Boolean(y&&!l),type:y,closeModal:Oe,onSuccess:f}),Object(e.jsxs)(E.a,{form:d,submitter:y===void 0||!l?!1:void 0,onFinish:function(){var A=Object(V.a)(Object(S.a)().mark(function D($){var Y,Fe,Be,Q,ee,z,pe,Le,he,Ke;return Object(S.a)().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(Fe=l==null||(Y=l.exam_results)===null||Y===void 0?void 0:Y.every(function(te){var ie=te.result;return typeof ie=="number"&&ie>=0&&ie<=100}),!(l&&Fe&&typeof H=="number")){w.next=17;break}if(Be=$.title,Q=$.passed_at,ee=$.weight,z=Number(n),pe=l.exam_results,Le=l.group_id,he={type:y,semester_subject_id:H,title:Be,passed_at:Q,weight:ee,group_id:Le,results:pe},!Number.isNaN(z)){w.next=12;break}return w.next=9,xe(he);case 9:w.t0=w.sent,w.next=15;break;case 12:return w.next=14,Se(z,he);case 14:w.t0=w.sent;case 15:Ke=w.t0,Ke.success&&s.f.push("/teacher/subjects/".concat(H,"/exams"));case 17:return w.abrupt("return",!0);case 18:case"end":return w.stop()}},D)}));return function(D){return A.apply(this,arguments)}}(),onReset:Oe,children:[Object(e.jsxs)(E.a.Group,{children:[Object(e.jsx)(Ae.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(Je.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(E.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(Ne.a,{})})]}),y&&l&&Object(e.jsx)(W.a,{rowKey:"user_id",headerTitle:(a=K(l.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:ce,onValuesChange:function(D,$){return f({group_id:l.group_id,exam_results:$})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:l.exam_results,columns:Qt}),!l&&Object(e.jsx)(Zt,{onSelect:x})]})]})},ea=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],ta=function(r){var a=r.exam_id,n=Object(o.useState)(""),t=Object(G.a)(n,2),u=t[0],d=t[1];return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:u,request:Object(V.a)(Object(S.a)().mark(function b(){var m;return Object(S.a)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,qe(a);case 2:if(m=x.sent,!m.success){x.next=6;break}return d(m.data.title),x.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return x.abrupt("return",[]);case 7:case"end":return x.stop()}},b)})),columns:ea})},aa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(r,a){return a.passed_at&&Object(Pe.a)(new Date(a.passed_at),R.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(r,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(r,a){return a.created_at&&Object(Pe.a)(new Date(a.created_at),R.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(r,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(r,a){return Object(e.jsx)(q.a,{type:"Students",type_id:a.group_id},a.group_id)}}],ra=function(){var r,a,n=Object(o.useRef)(),t=Object(Z.b)(),u=t.semester_subject_id,d=Object(se.k)(),b=Object(o.useMemo)(function(){var x,O,h;return{exam_id:(x=(O=d.query)===null||O===void 0?void 0:O.exam_id)!==null&&x!==void 0?x:null,results:(h=d.query)===null||h===void 0?void 0:h.results}},[(r=d.query)===null||r===void 0?void 0:r.exam_id,(a=d.query)===null||a===void 0?void 0:a.results]),m=b.exam_id,y=b.results;return y!==null&&!Number.isNaN(Number(y))?Object(e.jsx)(ta,{exam_id:Number(y)}):m!==null?Object(e.jsx)(qt,{exam_id:m}):Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:n,search:!1,rowKey:"id",request:function(){var x=Object(V.a)(Object(S.a)().mark(function O(h,l){var f,v,p,C;return Object(S.a)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(f=h.current,v=h.pageSize,u!==null){_.next=3;break}return _.abrupt("return",{data:[],total:0,success:!1});case 3:return p=l&&Object.entries(l)[0],_.next=6,I({per_page:v,page:f,semester_subject_id:Number.isNaN(u)?void 0:u,order_by:p&&p[0],order:p&&(p[1]==="ascend"?"ASC":"DESC")});case 6:if(C=_.sent,!C.success){_.next=9;break}return _.abrupt("return",{data:C.data,total:C.meta.total,success:!0});case 9:return _.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return _.stop()}},O)}));return function(O,h){return x.apply(this,arguments)}}(),columns:[].concat(aa,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(O,h){return[Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(h.semester_subject_id,"/exams?exam_id=").concat(h.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(de.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit"),Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(h.semester_subject_id,"/exams?results=").concat(h.id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(de.a,{icon:Object(e.jsx)(ct.a,{})})})},"results"),Object(e.jsx)(ut.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(V.a)(Object(S.a)().mark(function l(){var f;return Object(S.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,ye(h.id);case 2:f=p.sent,f.success&&n.current&&n.current.reload();case 4:case"end":return p.stop()}},l)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(de.a,{type:"primary",icon:Object(e.jsx)(re.a,{}),danger:!0})})},"delete")]}}])})},vt=i("o0Ox"),gr=i("miYZ"),st=i("tsqr"),na=i("4KAj");function sa(c,r){return Ot.apply(this,arguments)}function Ot(){return Ot=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(j.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},a||{})));case 1:case"end":return t.stop()}},c)})),Ot.apply(this,arguments)}var ua=function(r){var a=r.student_id,n=Object(o.useState)(!1),t=Object(G.a)(n,2),u=t[0],d=t[1],b=Object(o.useCallback)(Object(V.a)(Object(S.a)().mark(function m(){var y;return Object(S.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return d(!0),O.next=3,sa({user_id:a});case 3:if(y=O.sent,y.success){O.next=8;break}return st.b.error(y.message),d(!1),O.abrupt("return");case 8:window.open(y.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return O.stop()}},m)})),[]);return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(de.a,{loading:u,type:"primary",icon:Object(e.jsx)(na.a,{}),onClick:b})})},ca=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],ia=function(r){return r.map(function(a){var n=a.id,t=a.name;return{label:t,value:n}})},da=function(r){return r.reduce(function(a,n){var t,u=n==null||(t=n.users)===null||t===void 0?void 0:t.reduce(function(d,b){return b.academic_teacher_id!==null?d:[].concat(Object(M.a)(d),[{group_id:n.id,group_name:n.name,user_id:b.id,first_name:b.first_name,last_name:b.last_name,email:b.email}])},[]);return[].concat(Object(M.a)(a),Object(M.a)(u))},[])},la=function(){var r=Object(Z.b)(),a=r.teacherSubjectData,n=Object(o.useMemo)(function(){var t;return ia((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:function(u){return"".concat(u.group_id,"-").concat(u.user_id)},search:{layout:"vertical"},request:function(){var t=Object(V.a)(Object(S.a)().mark(function u(d){var b,m,y,x,O,h,l,f,v;return Object(S.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return b=d.groups,m=d.first_name,y=m===void 0?"":m,x=d.last_name,O=x===void 0?"":x,h=d.email,l=h===void 0?"":h,C.next=3,Object(vt.a)({parent_id:a==null?void 0:a.group_id,"id[]":b});case 3:if(f=C.sent,f.success){C.next=6;break}return C.abrupt("return",{data:[],total:0,success:!1});case 6:return v=da(f.data).filter(function(T){return T.first_name.toLowerCase().includes(y.toLowerCase())&&T.last_name.toLowerCase().includes(O.toLowerCase())&&T.email.toLowerCase().includes(l.toLowerCase())}),C.abrupt("return",{data:v,total:v.length,success:!0});case 8:case"end":return C.stop()}},u)}));return function(u){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(ca,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(u,d){return[Object(e.jsx)(ua,{student_id:d.user_id},"teamsChat")]}}])})},et=i("jrin");function pt(c,r){return ht.apply(this,arguments)}function ht(){return ht=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(r),Object(j.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),ht.apply(this,arguments)}function oa(c,r,a,n){return gt.apply(this,arguments)}function gt(){return gt=Object(V.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(r,"/attendances"),Object(j.a)({data:{attendances:[{user_id:a,value:n}]},method:"POST"},t||{})));case 1:case"end":return d.stop()}},c)})),gt.apply(this,arguments)}var xr=i("DYRE"),ja=i("zeV3"),Sr=i("sRBo"),Pt=i("kaz8");function ba(c){var r,a,n=c===null?ue.a.ABSENT:c,t=(r={},Object(et.a)(r,ue.a.PRESENT,{ch1:!0,ch2:!1}),Object(et.a)(r,ue.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(et.a)(r,ue.a.ABSENT,{ch1:!1,ch2:!1}),Object(et.a)(r,ue.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),r);return(a=t[n])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function ma(c){var r,a=c.ch1,n=c.ch2,t="".concat(a,"_").concat(n),u={true_false:ue.a.PRESENT,true_true:ue.a.PRESENT_NOT_EXERCISING,false_false:ue.a.ABSENT,false_true:ue.a.EXCUSED_ABSENCE};return(r=u[t])!==null&&r!==void 0?r:ue.a.ABSENT}var fa=function(r){var a=r.groupAttendanceScheduleId,n=r.studentId,t=r.attendance,u=r.onSuccess,d=Object(o.useState)(ba(t)),b=Object(G.a)(d,2),m=b[0],y=b[1],x=Object(o.useState)(!1),O=Object(G.a)(x,2),h=O[0],l=O[1],f=Object(o.useRef)(!0),v=Object(o.useCallback)(function(T){l(!0),oa(a,n,ma(T)).then(function(_){_.success&&(u==null||u())}).finally(function(){return l(!1)})},[]),p=Object(o.useCallback)(function(T){return y(T.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),C=Object(o.useCallback)(function(T){return y(function(_){return Object(j.a)(Object(j.a)({},_),{},{ch2:T.target.checked})})},[]);return Object(o.useEffect)(function(){if(f.current){f.current=!1;return}v(m)},[m,v]),Object(e.jsxs)(ja.b,{children:[Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Pt.a,{disabled:h,checked:m.ch1,onChange:p})}),Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Pt.a,{disabled:h,checked:m.ch2,onChange:C})})]})},xt=fa,va=function(){var r=Object(Z.b)(),a=r.teacherSubjectData,n=Object(o.useState)([]),t=Object(G.a)(n,2),u=t[0],d=t[1],b=Object(o.useState)(""),m=Object(G.a)(b,2),y=m[0],x=m[1],O=Object(s.l)(),h=Object(o.useRef)(),l=Object(o.useMemo)(function(){var v;return((v=a==null?void 0:a.groups)!==null&&v!==void 0?v:[]).map(function(p){var C=p.id,T=p.name;return{value:C,label:T}})},[a==null?void 0:a.groups]),f=Object(o.useMemo)(function(){var v;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:l,defaultValue:l==null||(v=l[0])===null||v===void 0?void 0:v.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(M.a)(u))},[l,u]);return Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:"".concat(O.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(y,")"),request:function(){var v=Object(V.a)(Object(S.a)().mark(function p(C){var T,_,H,K,ce,Oe,A,D,$,Y,Fe;return Object(S.a)().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return _=C.group_id,H=_===void 0?l==null||(T=l[0])===null||T===void 0?void 0:T.value:_,K=C.full_name,ce=K===void 0?"":K,Q.next=3,Promise.all([Object(vt.b)(H),pt(H)]);case 3:if(Oe=Q.sent,A=Object(G.a)(Oe,2),D=A[0],$=A[1],Y=l.find(function(ee){var z=ee.value;return z===H}),!(!D.success||!$.success||!Y)){Q.next=10;break}return Q.abrupt("return",{data:[],total:0,success:!1});case 10:if($.data.length){Q.next=13;break}return st.b.error(O.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),Q.abrupt("return",{data:[],total:0,success:!1});case 13:return x(Y.label),d($.data.reduce(function(ee,z){return[].concat(Object(M.a)(ee),[{title:String(Object(Pe.a)(new Date(z.date_from),R.c)),dataIndex:String(z.date_from),hideInSearch:!0,width:100,align:"center",render:function(Le,he){return Object(e.jsx)(xt,{groupAttendanceScheduleId:z.id,attendance:he["".concat(z==null?void 0:z.date_from)],studentId:he.id})}}])},[])),Fe=D.data.users.reduce(function(ee,z){var pe=z.id,Le=z.academic_teacher_id,he=z.first_name,Ke=z.last_name,X="".concat(Ke," ").concat(he);if(Le!==null||!X.toLowerCase().includes(ce.toLowerCase()))return ee;var w=$.data.reduce(function(te,ie){var we=ie.attendances.find(function(ke){return ke.user_id===pe});return we?Object(j.a)(Object(j.a)({},te),{},Object(et.a)({},"".concat(ie.date_from),we.value)):te},{});return[].concat(Object(M.a)(ee),[Object(j.a)({id:pe,full_name:X},w)])},[]).sort(function(ee,z){return ee.full_name.localeCompare(z.full_name)}),Q.abrupt("return",{data:Fe,total:Fe.length,success:!0});case 17:case"end":return Q.stop()}},p)}));return function(p){return v.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{onChange:function(){var p;return(p=h.current)===null||p===void 0?void 0:p.reload()}},scroll:{x:1500},actionRef:h,rowKey:"id"})},yr=i("tU7J"),He=i("wFql"),_r=i("/zsF"),St=i("PArb"),Oa=i("Hn4i"),pa=i("bRQS");function yt(c,r,a){return _t.apply(this,arguments)}function _t(){return _t=Object(V.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(j.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return u.stop()}},c)})),_t.apply(this,arguments)}function ha(c,r,a,n){return Tt.apply(this,arguments)}function Tt(){return Tt=Object(V.a)(Object(S.a)().mark(function c(r,a,n,t){return Object(S.a)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(r,"/tutors/").concat(a,"/grades"),Object(j.a)({method:"POST",data:n},t||{})));case 1:case"end":return d.stop()}},c)})),Tt.apply(this,arguments)}function At(c,r){return Ct.apply(this,arguments)}function Ct(){return Ct=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(j.a)({method:"GET",params:{"groups[]":r},useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Ct.apply(this,arguments)}function ga(c,r,a){return Et.apply(this,arguments)}function Et(){return Et=Object(V.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(r,"/users/").concat(a),Object(j.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return u.stop()}},c)})),Et.apply(this,arguments)}function wt(c){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(V.a)(Object(S.a)().mark(function c(r){return Object(S.a)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(j.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return n.stop()}},c)})),Gt.apply(this,arguments)}function Rt(c,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(r),Object(j.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Mt.apply(this,arguments)}function Nt(c,r){return It.apply(this,arguments)}function It(){return It=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(j.a)({method:"POST",data:r},a||{})));case 1:case"end":return t.stop()}},c)})),It.apply(this,arguments)}function Lt(c,r,a){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(V.a)(Object(S.a)().mark(function c(r,a,n){return Object(S.a)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(r),Object(j.a)({method:"PATCH",data:a},n||{})));case 1:case"end":return u.stop()}},c)})),Ft.apply(this,arguments)}var xa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Sa=function(r){var a=r.subjectTutorGradeScale,n=r.onFormSubmit,t=Object(o.useState)([]),u=Object(G.a)(t,2),d=u[0],b=u[1],m=Object(o.useRef)(),y=E.a.useForm(),x=Object(G.a)(y,1),O=x[0];return Object(o.useEffect)(function(){var h,l=((h=a.scale)!==null&&h!==void 0?h:[]).map(function(f,v){return Object(j.a)(Object(j.a)({},f),{},{id:String((v+1)*100)})});O.setFieldValue("table",l)},[]),Object(e.jsx)(E.a,{form:O,onFinish:n,submitter:{render:function(l,f){var v=Object(G.a)(f,2),p=v[1];return[p]}},children:Object(e.jsx)(Oa.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(xa,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(l,f){return Object(e.jsx)(de.a,{type:"primary",onClick:function(){var p;return(p=m.current)===null||p===void 0?void 0:p.startEditable(f.id)},icon:Object(e.jsx)(nt.a,{})})}}]),editable:{form:O,type:"multiple",editableKeys:d,saveText:Object(e.jsx)(de.a,{type:"primary",icon:Object(e.jsx)(pa.a,{})}),onChange:b,actionRender:function(l,f,v){return[v.save]}}})})},ya=function(){var r,a,n=Object(s.m)("@@initialState"),t=n.initialState,u=Object(Z.b)(),d=u.semester_subject_id,b=u.tutors,m=Object(o.useState)(),y=Object(G.a)(m,2),x=y[0],O=y[1],h=Object(o.useState)(!1),l=Object(G.a)(h,2),f=l[0],v=l[1],p=Object(o.useState)(null),C=Object(G.a)(p,2),T=C[0],_=C[1],H=Object(o.useMemo)(function(){return!!b.data.find(function(A){var D,$=A.id;return $===(t==null||(D=t.currentUser)===null||D===void 0?void 0:D.id)})},[b.data,t==null||(r=t.currentUser)===null||r===void 0?void 0:r.id]),K=Object(o.useMemo)(function(){return b.data.map(function(A){var D=A.id,$=A.first_name,Y=A.last_name;return{label:"".concat($," ").concat(Y),value:D}})},[b.data]),ce=Object(o.useCallback)(function(){d===null||T===null||(v(!0),O(void 0),yt(d,T).then(function(A){A.success&&O(A.data)}).finally(function(){v(!1)}))},[d,T]),Oe=Object(o.useCallback)(function(A,D){return function(){var $=Object(V.a)(Object(S.a)().mark(function Y(Fe){var Be,Q;return Object(S.a)().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!(d===null||T===null)){z.next=2;break}return z.abrupt("return");case 2:return Be=A.reduce(function(pe,Le){return Le.s_subject_scale_form_id===D?[].concat(Object(M.a)(pe),[{s_subject_scale_form_id:D,scale:Fe.table.map(function(he){var Ke=he.name,X=he.grade,w=he.grade_value;return{name:Ke,grade:X,grade_value:w}})}]):[].concat(Object(M.a)(pe),[Le])},[]),z.next=5,ha(d,T,{grade_scale:Be});case 5:Q=z.sent,Q.success&&ce();case 7:case"end":return z.stop()}},Y)}));return function(Y){return $.apply(this,arguments)}}()},[T,d]);return Object(o.useEffect)(function(){var A,D;if(!H||!(t!=null&&(A=t.currentUser)!==null&&A!==void 0&&A.id)){var $;if(($=b.data)!==null&&$!==void 0&&$[0]){var Y;_((Y=b.data)===null||Y===void 0?void 0:Y[0].id)}return}_(t==null||(D=t.currentUser)===null||D===void 0?void 0:D.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,H]),Object(o.useEffect)(function(){ce()},[ce]),b.loading?Object(e.jsx)(oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(E.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(B.a,{disabled:H,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:K,value:T,onChange:function(D){return _(D)}})}),Object(e.jsx)(St.a,{}),f&&!x&&Object(e.jsx)(oe.a,{}),x!=null&&x.grade_scale?x.grade_scale.map(function(A,D){var $;return Object(e.jsxs)(rt.a.Fragment,{children:[D>0&&Object(e.jsx)(St.a,{}),Object(e.jsx)(Sa,{subjectTutorGradeScale:A,onFormSubmit:Oe(($=x.grade_scale)!==null&&$!==void 0?$:[],A.s_subject_scale_form_id)})]},A.s_subject_scale_form_id)}):Object(e.jsx)(He.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Tr=i("qbNl"),_a=i("JBPa"),Cr=i("Awhp"),Ta=i("KrTs"),Ca=i("wd/R"),Ye=i.n(Ca);function Ea(c,r){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(V.a)(Object(S.a)().mark(function c(r,a){return Object(S.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(j.a)({params:r,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},c)})),Dt.apply(this,arguments)}var Er=i("5R/X"),Ga=function(){var r=Object(o.useState)(null),a=Object(G.a)(r,2),n=a[0],t=a[1],u=Object(o.useState)([]),d=Object(G.a)(u,2),b=d[0],m=d[1],y=Object(Z.b)(),x=y.semester_subject_id,O=Ye()(),h=Object(o.useMemo)(function(){return b.map(function(_){return{id:_.id,title:"".concat(_.group.name," (").concat(_.term_status.name,")"),start:Ye()(_.date_from).toDate(),end:Ye()(_.date_to).toDate(),tutor_name:"".concat(_.tutor.first_name," ").concat(_.tutor.last_name),tutor_email:_.tutor.email,semester:_.semester.name,group:_.group.name,subject:_.subject.name,ms_teams_join_url:_.ms_teams_join_url}})},[b]),l=Object(o.useCallback)(function(_,H){Ea({semester_subject_id:x,date_form:_.toDate(),date_to:H.toDate()}).then(function(K){K.success&&m(K.data)})},[x]),f=Object(o.useCallback)(function(_){t(_)},[]),v=Object(o.useCallback)(function(){t(null)},[]),p=Object(o.useCallback)(function(_){return _.isSame(O,"day")?"warning":_.isAfter(O,"day")?"success":"error"},[]),C=Object(o.useCallback)(function(_){var H=h.filter(function(K){return Ye()(K.start).isSame(_,"day")});return Object(e.jsx)("ul",{className:"events",children:H.map(function(K){return Object(e.jsx)("li",{onClick:function(){return f(K)},children:Object(e.jsx)(Ta.a,{status:p(Ye()(K.start)),text:K.title})},K.id)})})},[b]),T=Object(o.useCallback)(function(_,H){var K=Ye()(_).startOf(H).subtract(1,"month"),ce=Ye()(_).endOf(H).add(1,"month");l(K,ce)},[]);return Object(o.useEffect)(function(){var _=Ye()().startOf("month"),H=Ye()().endOf("month");l(_,H)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(He.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(_a.a,{dateCellRender:C,onPanelChange:T}),Object(e.jsxs)(L.a,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:v,footer:null,children:[Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",n&&Ye()(n.start).format(R.b)]}),Object(e.jsxs)(He.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",n&&Ye()(n.end).format(R.b)]}),(n==null?void 0:n.ms_teams_join_url)&&Object(e.jsx)(He.a.Paragraph,{children:Object(e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(de.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Ut=i("yj/a"),Bt=i("5Syx"),bt=i("PpiC"),$t=i("H6aw"),Ma=i("p3I6"),Ia=["results"],Kt=function(r,a){return r.reduce(function(n,t){var u=t.results,d=Object(bt.a)(t,Ia),b=u.find(function(m){return m.user_id===a});return b?[].concat(Object(M.a)(n),[Object(j.a)(Object(j.a)({},d),{},{result:b})]):n},[])},Wt=function(r,a){var n,t=r.reduce(function(l,f){var v=f.result,p=f.weight;return[l[0]+v.result*p,l[1]+p]},[0,0]),u=Object(G.a)(t,2),d=u[0],b=u[1],m=Number.isNaN(d/b)?0:d/b,y=a.sort(function(l,f){return l.grade_value-f.grade_value}).reduce(function(l,f){return[].concat(Object(M.a)(l),[Object(j.a)(Object(j.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(y.every(function(l){var f=l.isWeightedAverageGreater;return f})){var x,O;return(x=(O=y.at(-1))===null||O===void 0?void 0:O.name)!==null&&x!==void 0?x:""}var h=y.findIndex(function(l){var f=l.isWeightedAverageGreater;return!f});return h<0?"":(n=y[h-1])===null||n===void 0?void 0:n.name},Vt=function(r,a){var n;return(n=a.find(function(t){return t.s_subject_scale_form_id===r}))===null||n===void 0?void 0:n.scale},Fa=["attendances"];function Da(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],u=n[1];return Object(o.useEffect)(function(){u(function(d){return Object(j.a)(Object(j.a)({},d),{},{loading:!0})}),ga(c,r).then(function(d){d.success&&u(function(b){return Object(j.a)(Object(j.a)({},b),{},{data:d.data})})}).finally(function(){u(function(d){return Object(j.a)(Object(j.a)({},d),{},{loading:!1})})})},[r,c]),{finalGrades:t}}function $a(){var c=Object(o.useState)({loading:!1}),r=Object(G.a)(c,2),a=r[0],n=r[1];return Object(o.useEffect)(function(){n(function(t){return Object(j.a)(Object(j.a)({},t),{},{loading:!0})}),wt().then(function(t){t.success&&n(function(u){return Object(j.a)(Object(j.a)({},u),{},{data:t.data})})}).finally(function(){n(function(t){return Object(j.a)(Object(j.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function Pa(c){var r=Object(o.useState)({loading:!1}),a=Object(G.a)(r,2),n=a[0],t=a[1];return Object(o.useEffect)(function(){c!==void 0&&(t(function(u){return Object(j.a)(Object(j.a)({},u),{},{loading:!0})}),Rt(c).then(function(u){u.success&&t(function(d){return Object(j.a)(Object(j.a)({},d),{},{data:u.data})})}).finally(function(){t(function(u){return Object(j.a)(Object(j.a)({},u),{},{loading:!1})})}))},[c]),{subjectGradeScales:n}}function Aa(c,r,a){var n=Object(o.useState)({loading:!1}),t=Object(G.a)(n,2),u=t[0],d=t[1];return Object(o.useEffect)(function(){typeof c!="number"||typeof r!="number"||typeof a!="number"||(d(function(b){return Object(j.a)(Object(j.a)({},b),{},{loading:!0})}),yt(c,r).then(function(b){b.success&&d(function(m){var y,x;return Object(j.a)(Object(j.a)({},m),{},{data:(y=Vt(a,(x=b.data.grade_scale)!==null&&x!==void 0?x:[]))===null||y===void 0?void 0:y.map(function(O,h){return Object(j.a)(Object(j.a)({},O),{},{id:h})})})})}).finally(function(){d(function(b){return Object(j.a)(Object(j.a)({},b),{},{loading:!1})})}))},[c,r]),{tutorGradeScales:u}}function wa(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],u=n[1],d=Object(o.useCallback)(function(){u(function(b){return Object(j.a)(Object(j.a)({},b),{},{loading:!0})}),pt(c).then(function(b){if(b.success){var m=b.data.reduce(function(y,x){var O=x.attendances,h=Object(bt.a)(x,Fa),l=O.find(function(f){return f.user_id===r});return l?[].concat(Object(M.a)(y),[Object(j.a)(Object(j.a)({},h),{},{attendance:l})]):y},[]);u(function(y){return Object(j.a)(Object(j.a)({},y),{},{data:m})})}}).finally(function(){u(function(b){return Object(j.a)(Object(j.a)({},b),{},{loading:!1})})})},[c,r]);return Object(o.useEffect)(function(){d()},[d]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:d}}function Ra(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],u=n[1];return Object(o.useEffect)(function(){!r||(u(function(d){return Object(j.a)(Object(j.a)({},d),{},{loading:!0})}),I({student_id:c,semester_subject_id:r}).then(function(d){if(d.success){var b=Kt(d.data,c);u(function(m){return Object(j.a)(Object(j.a)({},m),{},{data:b})})}}).finally(function(){u(function(d){return Object(j.a)(Object(j.a)({},d),{},{loading:!1})})}))},[c,r]),{studentExams:t}}function Na(c,r){var a=Object(o.useState)({loading:!1}),n=Object(G.a)(a,2),t=n[0],u=n[1],d=Object(o.useState)({loading:!1}),b=Object(G.a)(d,2),m=b[0],y=b[1],x=Object(o.useState)({loading:!1}),O=Object(G.a)(x,2),h=O[0],l=O[1];return Object(o.useEffect)(function(){u(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!0})}),Object($t.e)({group_id:c}).then(function(f){f.success&&u(function(v){return Object(j.a)(Object(j.a)({},v),{},{data:f.data})})}).finally(function(){u(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!1})})})},[c]),Object(o.useEffect)(function(){!t.data||(l(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var v=f.id;return Object($t.n)(Number(v))})).then(function(f){f.forEach(function(v){v.success&&l(function(p){return Object(j.a)(Object(j.a)({},p),{},{data:Object(j.a)(Object(j.a)({},p.data),{},Object(et.a)({},Number(v.data.id),Object(Ma.c)(v.data.lessons)))})})})}).finally(function(){l(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!1})})}),y(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var v=f.id;return Object($t.l)(Number(v),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(p){if(p.success){var C,T,_=((C=p.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&C!==void 0?C:[]).filter(function(K){return K.id===r}),H=(T=p.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&T!==void 0?T:[];y(function(K){return Object(j.a)(Object(j.a)({},K),{},{data:Object(j.a)(Object(j.a)({},K.data),{},Object(et.a)({},Number(v),{finishedTopics:_,attendanceList:H}))})})}})})).finally(function(){return y(function(f){return Object(j.a)(Object(j.a)({},f),{},{loading:!1})})}))},[t.data,r]),{userCourses:t,userCoursesStats:m,userCoursesTopics:h}}var La=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],Ua=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(r,a){return Object(Pe.a)(new Date(a.date_from),R.c)}}],Ba=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(r,a){return Object(Pe.a)(new Date(a.created_at),R.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(r,a){return"".concat(a.result.result,"%")}}],Ka=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=a.grade)!==null&&n!==void 0&&n.grade_date?Object(Pe.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),R.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(r,a){var n,t;return(n=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&n!==void 0?n:"-"}}],mt=6,Wa=function(r){var a,n,t,u,d=r.user_id,b=r.group_id,m=Object(Z.b)(),y=m.semester_subject_id,x=Ra(d,y),O=x.studentExams,h=Da(b,d),l=h.finalGrades,f=$a(),v=f.gradeTerms,p=Pa((a=l.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),C=p.subjectGradeScales,T=Aa(y,(n=l.data)===null||n===void 0?void 0:n.tutor_id,(t=l.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),_=T.tutorGradeScales,H=wa(b,d),K=H.userAttendanceSchedules,ce=H.fetchUserAttendanceSchedules,Oe=Na(b,d),A=Oe.userCourses,D=Oe.userCoursesStats,$=Oe.userCoursesTopics,Y=E.a.useForm(),Fe=Object(G.a)(Y,1),Be=Fe[0],Q=Object(o.useMemo)(function(){var X;return((X=v.data)!==null&&X!==void 0?X:[]).map(function(w){var te=w.id,ie=w.name;return{label:ie,value:te}})},[v.data]),ee=Object(o.useMemo)(function(){var X;return((X=C.data)!==null&&X!==void 0?X:[]).map(function(w){var te=w.name,ie=w.id;return{label:te,value:ie}})},[C.data]),z=Object(o.useMemo)(function(){var X,w;return Wt((X=O.data)!==null&&X!==void 0?X:[],(w=_.data)!==null&&w!==void 0?w:[])},[O.data,_.data]),pe=Object(o.useCallback)(function(){var X=Object(V.a)(Object(S.a)().mark(function w(te){var ie,we,ke,Xe,at,je,Ge;return Object(S.a)().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(ke=te.grade_scale_id,Xe=te.grade_term_id,((ie=l.data)===null||ie===void 0?void 0:ie.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(at=(we=l.data)===null||we===void 0?void 0:we.grades.find(function(it){var dt=it.grade_term;return dt.id===Xe}),!at){Re.next=11;break}return Re.next=7,Lt(at.id,{grade_scale_id:ke});case 7:return je=Re.sent,st.b[je.success?"success":"error"](je.message),je.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,Nt({grade_scale_id:ke,grade_term_id:Xe,lesson_group_user_id:l.data.id});case 13:Ge=Re.sent,st.b[Ge.success?"success":"error"](Ge.message),Ge.success&&s.f.push("/teacher/subjects/".concat(y,"/final-grades"));case 16:case"end":return Re.stop()}},w)}));return function(w){return X.apply(this,arguments)}}(),[l.data,y]),Le=Object(o.useMemo)(function(){var X;return((X=v.data)!==null&&X!==void 0?X:[]).map(function(w){var te;return Object(j.a)(Object(j.a)({},w),{},{grade:(te=l.data)===null||te===void 0?void 0:te.grades.find(function(ie){var we=ie.grade_term;return we.id===w.id})})})},[l.data,v.data]),he=A.loading&&!A.data||D.loading&&!D.data||$.loading&&!$.data,Ke=Boolean(A.data&&D.data&&$.data);return l.loading?Object(e.jsx)(oe.a,{}):Object(e.jsxs)(e.Fragment,{children:[l.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(He.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:l.data.user})}),Object(e.jsx)(St.a,{})]}),Object(e.jsxs)(ne.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:mt},dataSource:O.data,loading:O.loading,columns:Ba,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:mt},dataSource:Le,loading:l.loading||v.loading,columns:Ka,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:K.data,loading:K.loading,columns:[].concat(Ua,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(w,te){return Object(e.jsx)(xt,{groupAttendanceScheduleId:te.id,studentId:d,attendance:te.attendance.value,onSuccess:ce})}}])})}),Object(e.jsx)(N.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:mt},cardProps:{bodyStyle:{padding:0}},dataSource:_.data,loading:_.loading,columns:La})}),he&&Object(e.jsx)(oe.a,{}),Ke&&((u=A.data)===null||u===void 0?void 0:u.map(function(X){var w,te,ie,we,ke,Xe,at,je,Ge=X.id,Ze=X.title;return Object(e.jsxs)(N.a,{span:24,children:[Object(e.jsx)(He.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Ze}),Object(e.jsx)(Bt.c,{course_id:Number(Ge),topics:(w=(te=$.data)===null||te===void 0?void 0:te[Number(Ge)])!==null&&w!==void 0?w:[],stats:(ie=(we=D.data)===null||we===void 0||(ke=we[Number(Ge)])===null||ke===void 0?void 0:ke.finishedTopics)!==null&&ie!==void 0?ie:[]}),Object(e.jsx)(Bt.a,{stats:(Xe=(at=D.data)===null||at===void 0||(je=at[Number(Ge)])===null||je===void 0?void 0:je.attendanceList)!==null&&Xe!==void 0?Xe:[]})]},Ge)}))]}),Object(e.jsx)(E.a,{form:Be,onFinish:pe,children:Object(e.jsxs)(E.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Ut.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:Q,width:"sm",fieldProps:{loading:v.loading}}),Object(e.jsx)(Ut.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ee,fieldProps:{loading:l.loading||C.loading}}),Object(e.jsx)(E.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:z}})})]})})]})},Va=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(r,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(r,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(r,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(n){var t=n.grade_name,u=n.grade_term,d=n.id;return Object(e.jsxs)(He.a.Text,{children:[u.name,": ",t]},d)}):"-"})}}],Ha=function(){var r,a,n=Object(se.k)(),t=Object(o.useMemo)(function(){var O,h,l,f;return{user_id:Number.isNaN(Number((O=n.query)===null||O===void 0?void 0:O.user_id))?null:Number((h=n.query)===null||h===void 0?void 0:h.user_id),group_id:Number.isNaN(Number((l=n.query)===null||l===void 0?void 0:l.group_id))?null:Number((f=n.query)===null||f===void 0?void 0:f.group_id)}},[(r=n.query)===null||r===void 0?void 0:r.user_id,(a=n.query)===null||a===void 0?void 0:a.group_id]),u=t.user_id,d=t.group_id,b=Object(Z.b)(),m=b.teacherSubjectData,y=b.semester_subject_id,x=Object(o.useMemo)(function(){var O;return((O=m==null?void 0:m.groups)!==null&&O!==void 0?O:[]).map(function(h){var l=h.id,f=h.name;return{label:f,value:l}})},[m==null?void 0:m.groups]);return u!==null&&d!==null?Object(e.jsx)(Wa,{user_id:u,group_id:d}):Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},request:function(){var O=Object(V.a)(Object(S.a)().mark(function h(l){var f,v,p,C,T,_,H,K,ce,Oe;return Object(S.a)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return v=l.group_id,p=v===void 0?[]:v,C=l.first_name,T=C===void 0?"":C,_=l.last_name,H=_===void 0?"":_,K=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function($){var Y=$.id;return Y}),D.next=4,At(p.length===0?K:p);case 4:if(ce=D.sent,ce.success){D.next=7;break}return D.abrupt("return",{success:!1,total:0,data:[]});case 7:return Oe=ce.data.filter(function($){var Y=$.user;return Y.first_name.toLowerCase().includes(T.toLowerCase())&&Y.last_name.toLowerCase().includes(H.toLowerCase())}),D.abrupt("return",{success:!0,total:Oe.length,data:Oe});case 9:case"end":return D.stop()}},h)}));return function(h){return O.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:x,mode:"multiple"},render:function(h,l){return Object(e.jsx)(q.a,{type:"Students",type_id:l.group_id},l.group_id)}}].concat(Va,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(h,l){return[Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(y,"/final-grades?user_id=").concat(l.user.id,"&group_id=").concat(l.group_id),children:Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(de.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit")]}}])})},ka=i("dF/Y"),za=i("o+0V"),Ht=i("0WSk"),Ja=["type","defaultRender"],Ya=["type","defaultRender"],Xa=function(r){var a=r.url;return Object(e.jsx)(We.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(de.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(ka.a,{})})})},Za=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(r,a){return Object(Pe.a)(new Date(a.created_at),R.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(r,a,n){var t=a.type,u=a.defaultRender,d=Object(bt.a)(a,Ja);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(Ht.a,Object(j.a)(Object(j.a)({},d),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(q.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(r,a){return Object(Pe.a)(new Date(a.exported_at),R.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(r,a,n){var t=a.type,u=a.defaultRender,d=Object(bt.a)(a,Ya);if(t==="form")return null;var b=n.getFieldValue("state");return Object(e.jsx)(Ht.a,Object(j.a)(Object(j.a)({},d),{},{state:{type:b}}))},render:function(r,a){return Object(e.jsx)(q.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(r,a){return[Object(e.jsx)(Xa,{url:a.url},"download")]}}],Qa=function(){var r,a,n=Object(Z.b)(),t=n.teacherSubjectData,u=Object(o.useMemo)(function(){var b;return((b=t==null?void 0:t.groups)!==null&&b!==void 0?b:[]).map(function(m){var y=m.id,x=m.name;return{value:y,label:x}})},[t==null?void 0:t.groups]),d=Object(o.useMemo)(function(){var b,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:u,defaultValue:t==null||(b=t.groups)===null||b===void 0||(m=b[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(Za)},[t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.id,u]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var b=Object(V.a)(Object(S.a)().mark(function m(y){var x,O,h,l,f,v,p;return Object(S.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return h=y.group_id,l=h===void 0?t==null||(x=t.groups)===null||x===void 0||(O=x[0])===null||O===void 0?void 0:O.id:h,f=y.created_by,v=y.exported_by,T.next=3,Object(za.a)({group_id:l,created_by:f,exported_by:v});case 3:if(p=T.sent,p.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:p.data,total:p.data.length});case 7:case"end":return T.stop()}},m)}));return function(m){return b.apply(this,arguments)}}(),columns:d,search:{layout:"vertical"},scroll:{x:1500}})},qa=function(r,a){var n;return(n=r.find(function(t){return t.name===a}))===null||n===void 0?void 0:n.id},er=function(r){var a=r.term,n=r.gradeScales,t=r.defaultFinalGrade,u=r.finalGrades,d=Object(o.useState)(t),b=Object(G.a)(d,2),m=b[0],y=b[1],x=Object(o.useState)(!1),O=Object(G.a)(x,2),h=O[0],l=O[1],f=Object(o.useMemo)(function(){return n.map(function(p){var C=p.name,T=p.id;return{value:T,label:C}})},[n]),v=Object(o.useCallback)(function(p){if(!!(u!=null&&u.id)){if(m){l(!0),Lt(m.id,{grade_scale_id:p}).finally(function(){return l(!1)});return}l(!0),Nt({grade_term_id:a.id,grade_scale_id:p,lesson_group_user_id:u.id}).then(function(C){if(C.success){var T=C.data.grades.find(function(_){return _.grade_term.id===a.id});y(T)}}).finally(function(){return l(!1)})}},[m,a.id,u==null?void 0:u.id]);return u?Object(e.jsx)(B.a,{loading:h,disabled:h,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:v,options:f,defaultValue:qa(n,t==null?void 0:t.grade_name)}):null},tr=i("LvDl"),ar=function(r){var a=r.exam_id,n=r.result,t=r.student_id,u=r.onSuccess,d=Object(o.useCallback)(Object(tr.debounce)(function(b){Ee(a,t,{result:b!=null?b:0}).then(function(m){m.success&&(u==null||u(m.data))})},300),[a,n,t]);return Object(e.jsx)(Ne.a,{type:"number",min:0,max:100,onChange:d,defaultValue:n})},rr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(M.a)(n),[{title:Object(Pe.a)(new Date(t.date_from),R.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(d,b){return Object(e.jsx)(xt,{groupAttendanceScheduleId:t.id,attendance:b["attendance-".concat(t==null?void 0:t.date_from)],studentId:b.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},nr=function(r,a){return r.reduce(function(n,t){var u=t.attendances.find(function(d){return d.user_id===a});return u?Object(j.a)(Object(j.a)({},n),{},Object(et.a)({},"attendance-".concat(t.date_from),u.value)):n},{})},sr=function(r){var a=r.reduce(function(n,t){return[].concat(Object(M.a)(n),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(d,b){var m;return(b==null||(m=b["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(ar,{result:b==null?void 0:b["exam-".concat(t.id)].result,exam_id:t.id,student_id:b.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},ur=function(r){return r.reduce(function(a,n){var t=n.result,u=n.id;return Object(j.a)(Object(j.a)({},a),{},Object(et.a)({},"exam-".concat(u),t))},{})},cr=function(r,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:r.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(u,d){return Object(e.jsx)(er,{defaultFinalGrade:d["final-grade-".concat(n.id)],finalGrades:d.final_grades,term:n,gradeScales:a})}}})}},ir=function(r,a){return r.find(function(n){return n.user.id===a})},dr=function(r){var a;return((a=r==null?void 0:r.grades)!==null&&a!==void 0?a:[]).reduce(function(n,t){return Object(j.a)(Object(j.a)({},n),{},Object(et.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},lr=function(){var r,a,n=Object(Z.b)(),t=n.teacherSubjectData,u=n.semester_subject_id,d=Object(o.useState)([]),b=Object(G.a)(d,2),m=b[0],y=b[1],x=Object(o.useState)(t==null||(r=t.groups)===null||r===void 0||(a=r[0])===null||a===void 0?void 0:a.name),O=Object(G.a)(x,2),h=O[0],l=O[1],f=Object(s.l)(),v=Object(o.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(_){var H=_.id,K=_.name;return{value:H,label:K}})},[t==null?void 0:t.groups]),p=Object(o.useRef)(),C=Object(o.useMemo)(function(){var T;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:v,defaultValue:v==null||(T=v[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"nameAndSurname",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object(M.a)(m))},[v,m]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var T=Object(V.a)(Object(S.a)().mark(function _(H){var K,ce,Oe,A,D,$,Y,Fe,Be,Q,ee,z,pe,Le,he,Ke,X,w,te,ie,we,ke,Xe;return Object(S.a)().wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return $=H.group_id,Y=$===void 0?(K=v[0])===null||K===void 0?void 0:K.value:$,Fe=H.full_name,Be=Fe===void 0?"":Fe,je.next=3,At(Y);case 3:if(Q=je.sent,ee=v.find(function(Ge){var Ze=Ge.value;return Ze===Y}),!(!Q.success||Q.data[0]===void 0||u===null)){je.next=8;break}return st.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ee==null?void 0:ee.label})),je.abrupt("return",{data:[],total:0,success:!1});case 8:return je.next=10,Promise.all([Object(vt.b)(Y),pt(Y),I({group_id:Y,per_page:-1}),yt(u,(ce=Q.data)===null||ce===void 0||(Oe=ce[0])===null||Oe===void 0?void 0:Oe.tutor_id),wt(),Rt((A=Q.data)===null||A===void 0||(D=A[0])===null||D===void 0?void 0:D.s_subject_scale_form_id)]);case 10:if(z=je.sent,pe=Object(G.a)(z,6),Le=pe[0],he=pe[1],Ke=pe[2],X=pe[3],w=pe[4],te=pe[5],!(!Le.success||!he.success||!Ke.success||!X.success||!w.success||!te.success||!ee)){je.next=21;break}return st.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ee==null?void 0:ee.label})),je.abrupt("return",{data:[],total:0,success:!1});case 21:return l(ee.label),ie=rr(he.data),we=sr(Ke.data),ke=cr(w.data,te.data),y([ie,we,ke,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Xe=Le.data.users.reduce(function(Ge,Ze){var Re,it,dt,ft=Ze.id,jr=Ze.academic_teacher_id,br=Ze.first_name,mr=Ze.last_name,kt="".concat(mr," ").concat(br);if(jr!==null||!kt.toLowerCase().includes(Be.toLowerCase()))return Ge;var fr=nr(he.data,ft),zt=Kt(Ke.data,ft),lt=ir(Q.data,ft),vr=(Re=Vt((it=lt==null?void 0:lt.s_subject_scale_form_id)!==null&&it!==void 0?it:0,(dt=X.data.grade_scale)!==null&&dt!==void 0?dt:[]))!==null&&Re!==void 0?Re:[],Or=Wt(zt,vr),pr=ur(zt),hr=dr(lt);return[].concat(Object(M.a)(Ge),[Object(j.a)(Object(j.a)(Object(j.a)(Object(j.a)({id:ft,full_name:kt},fr),pr),hr),{},{proposed_grade:Or,final_grades:lt})])},[]).sort(function(Ge,Ze){return Ge.full_name.localeCompare(Ze.full_name)}),je.abrupt("return",{data:Xe,total:Xe.length,success:!0});case 28:case"end":return je.stop()}},_)}));return function(_){return T.apply(this,arguments)}}(),columns:C,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:h}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:p,pagination:{onChange:function(){var _;return(_=p.current)===null||_===void 0?void 0:_.reload()}},rowKey:"id"})},or=function(r){var a,n,t=r.tab,u=Object(s.l)(),d=Object(s.m)("@@initialState"),b=d.setInitialState,m=d.initialState,y=Object(Z.b)(),x=y.teacherSubjectData,O=y.semester_subject_id,h=y.tutors,l=Object(o.useCallback)(Object(Te.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(o.useMemo)(function(){return!!h.data.find(function(v){var p,C=v.id;return C===(m==null||(p=m.currentUser)===null||p===void 0?void 0:p.id)})||l(ze.a.TeacherListGradeScale)},[]);return x?Object(e.jsx)(fe.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:x==null||(a=x.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(O,"/exams?exam_id=new"),children:Object(e.jsx)(de.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:u.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:u.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(O),breadcrumbName:String((n=x.subject)===null||n===void 0?void 0:n.name)},{path:String(t),breadcrumbName:u.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(le.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(p){b(Object(j.a)({},m)),s.f.push("/teacher/subjects/".concat(O,"/").concat(p))}},children:[Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(ge.a,{})},"groups"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(la,{})},"students"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(ra,{})},"exams"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ga,{})},"schedule"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(lr,{})},"class-register"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(va,{})},"attendance"),f&&Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(ya,{})},"grades-scale"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(Ha,{})},"final-grades"),Object(e.jsx)(le.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(Qa,{})},"file-exports-history")]})}):Object(e.jsx)(oe.a,{})},Gr=De.default=function(){var c=Object(se.l)(),r=c.subjectId,a=c.tab,n=a===void 0?"groups":a;return Object(e.jsx)(Z.a,{semester_subject_id:Number(r),children:Object(e.jsx)(or,{tab:n})})}},p3I6:function(ot,De,i){"use strict";i.d(De,"b",function(){return Te}),i.d(De,"c",function(){return $e}),i.d(De,"a",function(){return ct});var j=i("miYZ"),Me=i("tsqr"),de=i("tJVT"),F=i("k1fw"),oe=i("oBTY"),o=i("q1tI"),rt=i.n(o),s=i("9kvl"),Qe=i("Ty5D"),se=i("H6aw"),le=i("/y+f"),fe=i("nKUr"),ze=i.n(fe),Te=rt.a.createContext({}),Z=function(){return Math.round(Math.random()*99999)},ge=function re(W){return W.reduce(function(R,I){return[].concat(Object(oe.a)(R),Object(oe.a)(I.lessons?re(I.lessons):[]),[I])},[])},$e=function re(W){return W.reduce(function(R,I){var g;return[].concat(Object(oe.a)(R),Object(oe.a)(I.lessons?re(I.lessons):[]),Object(oe.a)((g=I.topics)!==null&&g!==void 0?g:[]))},[])},ut=function re(W,R,I){return W.map(function(g){var xe,J;return Object(F.a)(Object(F.a)({},g),{},{lessons:g.lessons?re(g.lessons,R,I):[],topics:g.id===R?[].concat(Object(oe.a)((xe=g.topics)!==null&&xe!==void 0?xe:[]),[I]):(J=g.topics)!==null&&J!==void 0?J:[]})})},jt=function re(W,R,I){return I?W.map(function(g){return Object(F.a)(Object(F.a)({},g),{},{lessons:[].concat(Object(oe.a)(g.lessons?re(g.lessons,R,I):[]),Object(oe.a)(g.id===I?[R]:[]))})}):[].concat(Object(oe.a)(W),[R])},We=function re(W,R,I){return W.map(function(g){return Object(F.a)(Object(F.a)({},g.id===R?I:g),{},{lessons:g.lessons?re(g.lessons,R,I):[]})})},S=function re(W,R){return W.map(function(I){return Object(F.a)(Object(F.a)({},I),{},{parent_id:R,lessons:I.lessons?re(I.lessons,I.id):[]})})},V=function re(W,R){return W.filter(function(I){return I.id!==R}).map(function(I){return Object(F.a)(Object(F.a)({},I),{},{lessons:I.lessons?re(I.lessons,R):[]})})},Pe=function re(W,R){return W.map(function(I){return Object(F.a)(Object(F.a)({},I),{},{lessons:I.lessons?re(I.lessons,R):[],topics:I.topics?I.topics.filter(function(g){return g.id!==R}):[]})})},nt=function re(W,R,I,g){return g==null?void 0:g.map(function(xe){if(xe.id===I){var J;return Object(F.a)(Object(F.a)({},xe),{},{topics:(J=xe.topics)===null||J===void 0?void 0:J.map(function(Se){return Se.id===W?R.file.response.data:Se})})}else if(xe.lessons)return Object(F.a)(Object(F.a)({},xe),{},{lessons:re(W,R,I,xe.lessons||[])});return xe})},ct=function(W){var R=W.children,I=W.id,g=Object(o.useState)(),xe=Object(de.a)(g,2),J=xe[0],Se=xe[1],tt=Object(s.l)(),qe=Object(o.useMemo)(function(){return J&&J.lessons?$e(J.lessons):[]},[J]),Ce=Object(o.useMemo)(function(){return J&&J.lessons?ge(J.lessons):[]},[J]),ye=Object(o.useState)([]),_e=Object(de.a)(ye,2),Ee=_e[0],Ie=_e[1],ve=Object(Qe.k)();Object(o.useEffect)(function(){Ie([])},[]);var ae=Object(o.useCallback)(function(){Object(se.n)(I).then(function(P){return P.success&&Se(Object(F.a)(Object(F.a)({},P.data),{},{lessons:S(P.data.lessons)}))})},[I]);Object(o.useEffect)(function(){ae()},[ae]);var q=Object(o.useCallback)(function(P){var L=Ce.find(function(M){var U;return M==null||(U=M.topics)===null||U===void 0?void 0:U.find(function(B){return B.id===P})});return L?L.id:null},[Ce]),Ve=Object(o.useMemo)(function(){var P,L;return(P=ve.query)!==null&&P!==void 0&&P.lesson?{mode:"lesson",id:Number(ve.query.lesson),value:Ce.find(function(M){return M.id===Number(ve.query.lesson)})}:(L=ve.query)!==null&&L!==void 0&&L.topic?{mode:"topic",id:Number(ve.query.topic),value:qe.find(function(M){return M.id===Number(ve.query.topic)})}:{mode:"init"}},[ve.query,J,Ce,qe]),Ne=Object(o.useCallback)(function(P){var L={course_id:I,topics:[],isNew:!0,id:J?J.lessons.length+1:Z(),order:0,title:tt.formatMessage({id:"add_title_here"}),active:!0,parent_id:P};return Se(function(M){var U;return Object(F.a)(Object(F.a)({},M),{},{lessons:jt((U=M==null?void 0:M.lessons)!==null&&U!==void 0?U:[],L,P)})}),L},[I,J]),G=Object(o.useCallback)(function(P,L){var M=Ce.find(function(B){return B.id===P}),U=M&&M.isNew;return(U?Object(se.g)(L):Object(se.v)(P,L)).then(function(B){return Me.b.success(B.message),ae(),B.success&&Se(function(k){var e;return Object(F.a)(Object(F.a)({},k),{},{lessons:We((e=k==null?void 0:k.lessons)!==null&&e!==void 0?e:[],P,Object(F.a)(Object(F.a)({},B.data),{},{isNew:!1}))})})})},[J]),be=Object(o.useCallback)(function(P){var L=Ce.find(function(U){return U.id===P});if(!!L){var M=L.isNew;M?Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:V((B=U==null?void 0:U.lessons)!==null&&B!==void 0?B:[],P)})}):Object(se.p)(P).then(function(U){U.success&&(Me.b.success(U.message),Se(function(B){var k;return Object(F.a)(Object(F.a)({},B),{},{lessons:V((k=B==null?void 0:B.lessons)!==null&&k!==void 0?k:[],P)})}))})}},[J]),ne=Object(o.useCallback)(function(P,L){var M,U=q(P),B=Ce.find(function(Ue){return Ue.id===U}),k=B&&((M=B.topics)===null||M===void 0?void 0:M.find(function(Ue){return Ue.id===P})),e=k==null?void 0:k.isNew;return(e?Object(se.h)(L):Object(se.w)(P,L)).then(function(Ue){Ue.success&&(Me.b.success(Ue.message),ae(),s.f.push("/courses/list/".concat(I,"/program/?topic=").concat(Ue.data.id)),(k==null?void 0:k.topicable_type)===le.j.Video&&setTimeout(function(){ae()},5e3))})},[q,J,ae]),me=Object(o.useCallback)(function(P){var L=q(P),M=Ce.find(function(k){return k.id===L});if(!!M){var U=qe==null?void 0:qe.find(function(k){return k.id===P}),B=U==null?void 0:U.isNew;B&&!U.topicable?Se(function(k){var e;return Object(F.a)(Object(F.a)({},k),{},{lessons:Pe((e=k==null?void 0:k.lessons)!==null&&e!==void 0?e:[],P)})}):Object(se.q)(P).then(function(k){k.success&&(Me.b.success(k.message),Se(function(e){var Ue;return Object(F.a)(Object(F.a)({},e),{},{lessons:Pe((Ue=e==null?void 0:e.lessons)!==null&&Ue!==void 0?Ue:[],P)})}))})}},[J,q]),N=Object(o.useCallback)(function(P,L){var M={lesson_id:P,isNew:!0,id:Z(),title:tt.formatMessage({id:"add_title_here"}),active:!0,topicable_type:L};return Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:ut((B=U==null?void 0:U.lessons)!==null&&B!==void 0?B:[],P,M)})}),M},[]),E=function(L,M){var U=q(L);Se(function(B){return Object(F.a)(Object(F.a)({},B),{},{lessons:B?nt(L,M,U,B.lessons||[]):[]})}),s.f.push("/courses/list/".concat(I,"/program/?topic=").concat(M.file.response.data.id))},Ae=Object(o.useCallback)(function(P){return Object(se.d)(P).then(function(L){if(L.success){Me.b.success(L.message);var M=q(P);Se(function(U){var B;return Object(F.a)(Object(F.a)({},U),{},{lessons:U?(B=U.lessons)===null||B===void 0?void 0:B.map(function(k){if(k.id===M){var e=k.topics||[];return Object(F.a)(Object(F.a)({},k),{},{topics:[].concat(Object(oe.a)(e),[L.data])})}return k}):[]})})}})},[J,q]),Je=Object(o.useCallback)(function(P){return Object(se.c)(P).then(function(L){L.success&&(Me.b.success(L.message),Se(function(M){return Object(F.a)(Object(F.a)({},M),{},{lessons:M?[].concat(Object(oe.a)(M.lessons),[L.data]):[]})}))})},[]),ue={state:J,h5ps:Ee,id:I,addNewLesson:Ne,updateLesson:G,updateTopic:ne,deleteLesson:be,addNewTopic:N,deleteTopic:me,onTopicUploaded:E,cloneTopic:Ae,cloneLesson:Je,currentEditMode:Ve,getLessons:ae};return Object(fe.jsx)(Te.Provider,{value:ue,children:R})}},"w/VK":function(ot,De,i){"use strict";i.d(De,"c",function(){return oe}),i.d(De,"a",function(){return rt}),i.d(De,"b",function(){return Qe});var j=i("qLMh"),Me=i("k1fw"),de=i("9og8"),F=i("9kvl");function oe(le,fe){return o.apply(this,arguments)}function o(){return o=Object(de.a)(Object(j.a)().mark(function le(fe,ze){return Object(j.a)().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",Object(F.i)("/api/admin/reports/report",Object(Me.a)({params:fe,method:"GET",useCache:!1},ze||{})));case 1:case"end":return Z.stop()}},le)})),o.apply(this,arguments)}function rt(le,fe,ze){return s.apply(this,arguments)}function s(){return s=Object(de.a)(Object(j.a)().mark(function le(fe,ze,Te){return Object(j.a)().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.abrupt("return",Object(F.i)("/api/admin/stats/course/".concat(fe,"/export"),Object(Me.a)({params:ze,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Te||{})));case 1:case"end":return ge.stop()}},le)})),s.apply(this,arguments)}function Qe(le,fe,ze){return se.apply(this,arguments)}function se(){return se=Object(de.a)(Object(j.a)().mark(function le(fe,ze,Te){return Object(j.a)().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:return ge.abrupt("return",Object(F.i)("/api/admin/stats/topic/".concat(fe,"/export"),Object(Me.a)({method:"GET",useCache:!1,params:{stat:ze},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Te||{})));case 1:case"end":return ge.stop()}},le)})),se.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.1d644cd7.async.js.map