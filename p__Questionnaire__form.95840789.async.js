"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7480,2803,8047],{78677:function(ye,te,t){var ae=t(67294),z=t(2759),k=function(){return k=Object.assign||function(X){for(var c,$=1,T=arguments.length;$<T;$++){c=arguments[$];for(var G in c)Object.prototype.hasOwnProperty.call(c,G)&&(X[G]=c[G])}return X},k.apply(this,arguments)},J=(0,ae.forwardRef)(function(X,c){return ae.createElement(z.P,k({},X,{chartType:"Column",ref:c}))});te.Z=J},58664:function(ye,te,t){t.d(te,{T:function(){return R}});var ae=t(19632),z=t.n(ae),k=t(5574),J=t.n(k),X=t(74656),c=t(74330),$=t(67294),T=t(51490),G=t(99100),K=t(32283),be=t(80854),E=t(85893),he=function(V){return V.map(function(N){return"name"in N?{id:Number(N.id),name:N.name}:{id:Number(N.id),name:N.title?N.title:""}})},R=function(V){var N=V.value,re=V.onChange,ie=V.multiple,oe=ie===void 0?!1:ie,xe=V.defaultValue,le=V.modelType,Y=le===void 0?"COURSE":le,W=(0,$.useState)([]),ue=J()(W,2),ee=ue[0],m=ue[1],a=(0,$.useState)(!1),ge=J()(a,2),Ce=ge[0],de=ge[1],b=(0,$.useRef)(),pe=(0,$.useCallback)(function(j){var _,w,Q,H;switch(Y){case"COURSE":return(0,G.N7)(j,{signal:b==null||(_=b.current)===null||_===void 0?void 0:_.signal});case"WEBINAR":return(0,K.i5)(j,{signal:b==null||(w=b.current)===null||w===void 0?void 0:w.signal});case"CONSULTATIONS":return(0,T.sL)(j,{signal:b==null||(Q=b.current)===null||Q===void 0?void 0:Q.signal});default:return(0,G.N7)(j,{signal:b==null||(H=b.current)===null||H===void 0?void 0:H.signal})}},[Y,b]),Me=(0,$.useCallback)(function(j){var _,w,Q,H;switch(Y){case"COURSE":return(0,G.XR)(Number(j),{signal:(_=b.current)===null||_===void 0?void 0:_.signal});case"WEBINAR":return(0,K.tz)(Number(j),{signal:(w=b.current)===null||w===void 0?void 0:w.signal});case"CONSULTATIONS":return(0,T.hW)(Number(j),{signal:(Q=b.current)===null||Q===void 0?void 0:Q.signal});default:return(0,G.XR)(Number(j),{signal:(H=b.current)===null||H===void 0?void 0:H.signal})}},[Y,b]),se=(0,$.useCallback)(function(j){de(!0),b.current&&b.current.abort(),b.current=new AbortController,pe(j?{title:j}:{}).then(function(_){_.success&&m(he(_.data)),de(!1)}).catch(function(){return de(!1)})},[Y]),e=(0,$.useCallback)(function(j){se(j)},[se]);return(0,$.useEffect)(function(){return b.current=new AbortController,N&&Me(Number(N)).then(function(j){j&&j.success&&m(function(_){return[].concat(z()(_),z()(he([j.data])))})}),function(){b.current&&b.current.abort()}},[N,Y]),(0,E.jsx)(X.default,{defaultValue:xe,onFocus:function(){return se()},allowClear:!0,style:{width:"100%"},value:N,onChange:re,mode:oe?"multiple":void 0,showSearch:!0,onSearch:e,placeholder:(0,E.jsx)(be.FormattedMessage,{id:"select_content",defaultMessage:"select_content"}),optionFilterProp:"children",filterOption:function(_,w){if(w&&w.children){var Q;return(w==null||(Q=w.children)===null||Q===void 0?void 0:Q.toString().toLowerCase().indexOf(_.toLowerCase()))>=0}return!0},notFoundContent:Ce?(0,E.jsx)(c.Z,{size:"small"}):null,optionLabelProp:"label",children:ee.map(function(j){return(0,E.jsx)(X.default.Option,{value:j.id,label:j.name,children:j.name},j.id)})})}},92008:function(ye,te,t){t.r(te),t.d(te,{QuestionareForm:function(){return Te},default:function(){return ke}});var ae=t(19632),z=t.n(ae),k=t(9783),J=t.n(k),X=t(97857),c=t.n(X),$=t(15009),T=t.n($),G=t(99289),K=t.n(G),be=t(5574),E=t.n(be),he=t(58664),R=t(95020),q=t(78715),V=t(952),N=t(5966),re=t(52688),ie=t(64317),oe=t(31199),xe=t(74453),le=t(71471),Y=t(75842),W=t(2453),ue=t(74330),ee=t(14726),m=t(67294),a=t(80854),ge=t(13769),Ce=t.n(ge),de=t(62235),b=t(44167),pe=t(45919),Me=t(16894),se=t(60943),e=t(85893),j=["type"],_=function(I){var n=I.record,Z=Y.Z.useForm(),y=E()(Z,1),S=y[0],x=(0,a.useIntl)(),B=(0,m.useMemo)(function(){return{onValuesChange:function(h,i){var C=i,P=C.visible_on_front;(0,R.lt)(n.id,{visible_on_front:P}).then(function(L){W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"question_answer_visibility_changed",defaultMessage:L.message}))}).catch(function(){return W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}))})},submitter:{render:function(){return null}}}},[]);return(0,e.jsx)(V.ZP,c()(c()({form:S},B),{},{children:(0,e.jsx)(re.Z,{name:"visible_on_front",initialValue:n.visible_on_front,checkedChildren:x.formatMessage({id:"visible",defaultMessage:"visible"}),unCheckedChildren:x.formatMessage({id:"hidden",defaultMessage:"hidden"})})}))},w=function(I){var n=I.questionnaireId,Z=I.questions,y=(0,m.useMemo)(function(){return Z&&Z.reduce(function(O,h){return c()(c()({},O),{},J()({},h.id,h.title))},{})},[Z]),S=[{title:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),dataIndex:"question_id",hideInSearch:!1,valueEnum:y,valueType:"select"}],x=(0,a.useIntl)(),B=[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"updated_at",defaultMessage:"updated_at"}),dataIndex:"updated_at",hideInSearch:!0,render:function(h,i){return i.updated_at?new Date(i.updated_at).toLocaleString():"-"},sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"from",defaultMessage:"from"}),dataIndex:"date",hideInSearch:!1,hideInForm:!0,hideInTable:!0,valueType:"date"},{title:(0,e.jsx)(a.FormattedMessage,{id:"to",defaultMessage:"to"}),dataIndex:"dateto",hideInSearch:!1,hideInForm:!0,hideInTable:!0,valueType:"date"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"question_title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"note",defaultMessage:"note"}),dataIndex:"note",hideInSearch:!0,sorter:!0,render:function(h,i){var C,P;return i.note&&((C=i.note)===null||C===void 0?void 0:C.length)>64?((P=i.note)===null||P===void 0?void 0:P.slice(0,64))+"...":i.note}},{title:(0,e.jsx)(a.FormattedMessage,{id:"user",defaultMessage:"user"}),dataIndex:"user_id",hideInSearch:!1,render:function(h,i){var C,P;return(0,e.jsxs)("div",{children:[(0,e.jsx)(de.Z,{type:"App\\Models\\User",type_id:i.user_id}),(0,e.jsx)("p",{className:"list-paragraph",children:(C=i.user)===null||C===void 0?void 0:C.name}),(0,e.jsx)("p",{className:"list-paragraph",children:(P=i.user)===null||P===void 0?void 0:P.email})]})},renderFormItem:function(h,i,C){var P=i.type,L=Ce()(i,j);if(P==="form")return null;var g=C.getFieldValue("state");return(0,e.jsx)(b.Z,c()(c()({},L),{},{state:{type:g}}))}},{title:(0,e.jsx)(a.FormattedMessage,{id:"sum_rate",defaultMessage:"sum_rate"}),dataIndex:"rate",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"}),dataIndex:"visible_on_front",hideInSearch:!0,sorter:!1,render:function(h,i){return(0,e.jsx)(_,{record:i})}}];return(0,e.jsx)(Me.ZP,{headerTitle:x.formatMessage({id:"answers",defaultMessage:"answers"}),search:{layout:"vertical"},rowKey:"id",request:function(h,i){var C=h.pageSize,P=h.current,L=h.question_id,g=h.user_id,r=h.date,d=h.dateto,s=i&&Object.entries(i)[0];return(0,R.l)(n,{per_page:C,page:P,question_id:L,user_id:g,updated_at_from:r?(0,se.WU)(new Date(r),pe.Cu):void 0,updated_at_to:d?(0,se.WU)(new Date(d),pe.Cu):void 0,order_by:s&&s[0],order:s?s[1]==="ascend"?"ASC":"DESC":void 0}).then(function(F){return F.success?{data:F.data,success:!0}:[]})},columns:[].concat(B,S)})},Q=w,H=t(66419),we=t(51042),$e=t(47389),Le=t(82061),Se=t(83062),Ue=t(86738),ce=t(31472),Ve=t(37476),Qe=function(I){var n=(0,a.useIntl)(),Z=m.useState(!1),y=E()(Z,2),S=y[0],x=y[1],B=I.visible,O=I.onVisibleChange,h=I.onFinish,i=I.id,C=I.questionsList,P=Y.Z.useForm(),L=E()(P,1),g=L[0];(0,m.useEffect)(function(){typeof i=="number"&&i>0?(0,R.a5)(i).then(function(d){d.success&&g.setFieldsValue(d.data)}):g.resetFields()},[i,g]);var r=Object.values(ce.Yo).map(function(d){return{name:d,label:n.formatMessage({id:"QuestionType.".concat(d)}),value:d,disabled:d===ce.Yo.Review&&C.findIndex(function(s){var F=s.type;return F===ce.Yo.Review})!==-1}});return(0,e.jsxs)(Ve.Y,{form:g,title:n.formatMessage({id:typeof i=="number"&&i>0?"question_edit":"question_add",defaultMessage:typeof i=="number"&&i>0?"question_edit":"question_add"}),width:"400px",visible:B,onVisibleChange:O,onFinish:h,children:[(0,e.jsx)(ie.Z,{name:"type",options:r,label:(0,e.jsx)(a.FormattedMessage,{id:"type"}),initialValue:ce.Yo.Text,onChange:function(s){s===ce.Yo.Review?x(!0):x(!1)}}),(0,e.jsx)(N.Z,{width:"lg",name:"title",label:(0,e.jsx)(a.FormattedMessage,{id:"title"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"title"}),placeholder:n.formatMessage({id:"title"})}),(0,e.jsx)(N.Z,{width:"lg",name:"description",label:(0,e.jsx)(a.FormattedMessage,{id:"description"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"description"}),placeholder:n.formatMessage({id:"description"})}),S&&(0,e.jsx)(oe.Z,{width:"lg",name:"max_score",label:(0,e.jsx)(a.FormattedMessage,{id:"max_score"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"max_score"}),placeholder:n.formatMessage({id:"max_score",defaultMessage:"max_score"}),min:0,max:9999,fieldProps:{step:1}}),(0,e.jsx)(oe.Z,{width:"lg",name:"position",label:(0,e.jsx)(a.FormattedMessage,{id:"position"}),tooltip:(0,e.jsx)(a.FormattedMessage,{id:"position"}),placeholder:n.formatMessage({id:"position",defaultMessage:"position"}),min:0,max:9999,fieldProps:{step:1}}),(0,e.jsx)(re.Z,{initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})}),(0,e.jsx)(re.Z,{initialValue:!0,name:"public_answers",label:(0,e.jsx)(a.FormattedMessage,{id:"show_hide_on_front",defaultMessage:"show_hide_on_front"})})]})},We=Qe,Be=function(I){var n=I.questionnaireId,Z=I.questions,y=I.fetchData,S=(0,a.useIntl)(),x=(0,m.useState)(!1),B=E()(x,2),O=B[0],h=B[1],i=(0,m.useMemo)(function(){return[{title:(0,e.jsx)(a.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",hideInSearch:!0,sorter:!0,width:"80px"},{title:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!1,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",hideInSearch:!0,sorter:!0,renderText:function(r,d){return S.formatMessage({id:"QuestionType.".concat(d.type)})}},{title:(0,e.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"description"}),dataIndex:"description",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(a.FormattedMessage,{id:"position",defaultMessage:"position"}),dataIndex:"position",hideInSearch:!0,sorter:!0}]},[]),C=(0,m.useRef)(),P=function(){var g=K()(T()().mark(function r(d,s){var F;return T()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return F=W.ZP.loading(S.formatMessage({id:"loading"})),v.prev=1,v.next=4,s&&s!==-1?(0,R.WW)(s,c()(c()({},d),{},{questionnaire_id:n})):(0,R.xL)(c()(c()({},d),{},{questionnaire_id:n}));case 4:return F(),y(),W.ZP.success(S.formatMessage({id:"success"})),v.abrupt("return",!0);case 10:return v.prev=10,v.t0=v.catch(1),F(),W.ZP.error(S.formatMessage({id:"error"})),v.abrupt("return",!1);case 15:case"end":return v.stop()}},r,null,[[1,10]])}));return function(d,s){return g.apply(this,arguments)}}(),L=(0,m.useCallback)(function(){var g=K()(T()().mark(function r(d){var s;return T()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return s=W.ZP.loading(S.formatMessage({id:"loading"})),p.prev=1,p.next=4,(0,R.Km)(d);case 4:return s(),y(),p.abrupt("return",!0);case 9:return p.prev=9,p.t0=p.catch(1),s(),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"})),p.abrupt("return",!1);case 14:case"end":return p.stop()}},r,null,[[1,9]])}));return function(r){return g.apply(this,arguments)}}(),[C,S]);return(0,m.useEffect)(function(){var g;(g=C.current)===null||g===void 0||g.reload()},[Z,y]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Me.ZP,{headerTitle:S.formatMessage({id:"question_list",defaultMessage:"question_list"}),actionRef:C,rowKey:"id",search:{layout:"vertical"},toolBarRender:function(){return[(0,e.jsxs)(ee.ZP,{type:"primary",onClick:function(){h(-1)},children:[(0,e.jsx)(we.Z,{})," ",(0,e.jsx)(a.FormattedMessage,{id:"pages.searchTable.new",defaultMessage:"\u65B0\u5EFA"})]},"primary")]},columns:[].concat(z()(i),[{title:(0,e.jsx)(a.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(r,d){return[(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)($e.Z,{}),onClick:function(){return d.id&&h(d.id)}})},"edit"),(0,e.jsx)(Ue.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return d.id&&L(d.id)},okText:(0,e.jsx)(a.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(a.FormattedMessage,{id:"no"}),children:(0,e.jsx)(Se.Z,{title:(0,e.jsx)(a.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(ee.ZP,{type:"primary",icon:(0,e.jsx)(Le.Z,{}),danger:!0})})},"delete")]}}]),request:function(r,d){var s=r.title,F=d&&Object.entries(d)[0];return new Promise(function(p){var v=Z?z()(Z):[];s&&(v=v.filter(function(me){return me.title.toLowerCase().includes(s.toLowerCase())})),F&&(v=(0,H.Pf)(v,F[0],F[1]!=="ascend")),p({data:v,success:!0,total:v.length})})}}),(0,e.jsx)(We,{id:O,visible:Number.isInteger(O),onVisibleChange:function(r){return r===!1&&h(!1)},questionsList:Z!=null?Z:[],onFinish:function(){var g=K()(T()().mark(function r(d){var s;return T()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,P(d,Number(O));case 2:s=p.sent,s&&h(!1);case 4:case"end":return p.stop()}},r)}));return function(r){return g.apply(this,arguments)}}()})]})},Ke=Be,Pe=t(74656),qe=t(78677),Ye=t(38925),ze={isGroup:!0,xField:"label",yField:"value",seriesField:"type",marginRatio:0},Ge=function(I){var n=I.state,Z=(0,a.useIntl)();return(0,e.jsxs)(q.ZP,{headerBordered:!0,style:{height:"500px"},children:[n.mode==="loading"&&(0,e.jsx)(ue.Z,{}),n.mode==="loaded"&&n.value.length>0?(0,e.jsx)(qe.Z,c()(c()({},ze),{},{data:[].concat(z()(n.value),z()(n.value)).map(function(y,S){return{label:y.title,value:S>n.value.length-1?y.count_answers:Number(y.avg_rate),type:S>n.value.length-1?Z.formatMessage({id:"answers"}):"Rating"}})})):n.mode!=="loading"&&(0,e.jsx)("p",{children:(0,e.jsx)(a.FormattedMessage,{id:"no_data",defaultMessage:"no_data"})}),n.mode==="error"&&(0,e.jsx)(Ye.Z,{message:n.error.data.message,type:"error"})]})},Xe=Ge,He=function(I){var n=I.questionnaireId,Z=I.models,y=(0,m.useState)(""),S=E()(y,2),x=S[0],B=S[1],O=(0,m.useState)({mode:"init"}),h=E()(O,2),i=h[0],C=h[1],P=(0,m.useState)(!1),L=E()(P,2),g=L[0],r=L[1],d=(0,m.useCallback)(K()(T()().mark(function s(){var F,p,v;return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return F=x.split("/"),r(!0),u.prev=2,u.next=5,(0,R.Hp)(F[2],Number(F[1]),Number(n));case 5:p=u.sent,p instanceof Blob&&(v=document.createElement("a"),v.href=window.URL.createObjectURL(p),v.download="raport_questionaire_".concat(F[2],"_").concat(n,".xlsx"),document.body.appendChild(v),v.click(),document.body.removeChild(v)),u.next=12;break;case 9:u.prev=9,u.t0=u.catch(2),C({mode:"error",error:u.t0});case 12:return u.prev=12,r(!1),u.finish(12);case 15:case"end":return u.stop()}},s,null,[[2,9,12,15]])})),[x,n]);return(0,m.useEffect)(function(){C({mode:"loading"});var s=function(){var F=K()(T()().mark(function p(){var v;return T()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,!x){u.next=7;break}return u.next=4,(0,R.Cq)(n,Number(x.split("/")[0]),Number(x.split("/")[1]));case 4:u.t0=u.sent,u.next=10;break;case 7:return u.next=9,(0,R.Cq)(n);case 9:u.t0=u.sent;case 10:v=u.t0,v.success&&C({mode:"loaded",value:v.data}),u.next=17;break;case 14:u.prev=14,u.t1=u.catch(0),C({mode:"error",error:u.t1});case 17:case"end":return u.stop()}},p,null,[[0,14]])}));return function(){return F.apply(this,arguments)}}();s()},[n,Z,x]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(le.Z.Title,{level:5,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.raports.filter",defaultMessage:"questionnaire.raports.filter"})}),(0,e.jsx)(Pe.default,{allowClear:!0,style:{minWidth:"400px"},onChange:function(F){return B(F)},children:Z.map(function(s){return(0,e.jsxs)(Pe.default.Option,{value:"".concat(s.model_type_id,"/").concat(s.model_id,"/").concat(s.model_type_title),children:[(0,e.jsx)(a.FormattedMessage,{id:s.model_type_title,defaultMessage:s.model_type_title})," ","- ",s.model_title]},s.id)})}),x&&(0,e.jsxs)("div",{children:[(0,e.jsx)("br",{}),(0,e.jsx)(ee.ZP,{onClick:d,loading:g,children:(0,e.jsx)(a.FormattedMessage,{id:"download"})})]}),(0,e.jsx)("hr",{}),(0,e.jsx)(q.ZP,{split:"vertical",children:(0,e.jsx)(q.ZP,{colSpan:24,layout:"center",children:(0,e.jsx)(Xe,{state:i})})})]})},Je=He,Ie=le.Z.Title,Te=function(){var I,n,Z=(0,a.useParams)(),y=Z.questionnaireId,S=(0,a.useIntl)(),x=y==="new",B=Y.Z.useForm(),O=E()(B,1),h=O[0],i=Y.Z.useForm(),C=E()(i,1),P=C[0],L=(0,m.useState)(),g=E()(L,2),r=g[0],d=g[1],s=(0,m.useState)("questionnaire"),F=E()(s,2),p=F[0],v=F[1],me=(0,m.useState)(),u=E()(me,2),Ze=u[0],et=u[1],tt=(0,m.useState)({}),Ee=E()(tt,2),fe=Ee[0],Oe=Ee[1],at=(0,m.useState)({}),_e=E()(at,2),Ae=_e[0],rt=_e[1],De=(0,m.useCallback)(K()(T()().mark(function o(){var l;return T()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.xR)();case 2:l=f.sent,l.success&&et(l.data);case 4:case"end":return f.stop()}},o)})),[]),Re=(0,m.useCallback)(function(o,l){return o.reduce(function(M,f){return(M[f[l]]=M[f[l]]||[]).push(f.model_id),M},{})},[]),ve=(0,m.useCallback)(K()(T()().mark(function o(){var l;return T()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,(0,R.Iu)(Number(y));case 2:l=f.sent,l.success&&(d(c()({},l.data)),l.data.models&&Oe(Re(l.data.models,"model_type_id")));case 4:case"end":return f.stop()}},o)})),[y,Re]);(0,m.useEffect)(function(){if(De(),x){d({title:"new"});return}ve()},[y,ve,De,x]);var st=(0,m.useCallback)(function(o,l){Oe(function(M){return c()(c()({},M),{},J()({},l,o))})},[]),Fe=(0,m.useCallback)(function(o){var l=[];return Object.keys(o).map(function(M){l.push.apply(l,z()(o[M].map(function(f){return{model_id:Number(f),model_type_id:Number(M),target_group:P.getFieldValue("models.".concat(Number(M),".").concat(Number(f),".target_group")),display_frequency_minutes:P.getFieldValue("models.".concat(Number(M),".").concat(Number(f),".display_frequency_minutes"))}})))}),l},[P]),nt=(0,m.useMemo)(function(){return{onFinish:function(){var o=K()(T()().mark(function M(f){var U,A;return T()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(D.prev=0,!x){D.next=9;break}return D.next=4,(0,R.wW)(c()(c()({},f),{},{models:Fe(fe)}));case 4:U=D.sent,U.success&&a.history.push("/other/questionnaire/".concat(U.data.id)),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"})),D.next=14;break;case 9:return D.next=11,(0,R.xN)(Number(r==null?void 0:r.id),c()(c()({},f),{},{models:Fe(fe)}));case 11:A=D.sent,A.success&&ve(),W.ZP.success((0,e.jsx)(a.FormattedMessage,{id:"success",defaultMessage:"success"}));case 14:D.next=19;break;case 16:D.prev=16,D.t0=D.catch(0),W.ZP.error((0,e.jsx)(a.FormattedMessage,{id:"error",defaultMessage:"error"}));case 19:case"end":return D.stop()}},M,null,[[0,16]])}));function l(M){return o.apply(this,arguments)}return l}(),initialValues:r}},[r,fe,ve,Fe,x]),Ne=(0,m.useCallback)(function(o){var l;return r&&((l=r.models)===null||l===void 0?void 0:l.filter(function(M){return M.model_type_title===o}))},[r]),it=(0,m.useCallback)(function(o,l,M,f){var U;return((U=Ne(l))===null||U===void 0||(U=U.find(function(A){return A.model_id===Number(o)}))===null||U===void 0?void 0:U.model_title)||Ae[f][M]},[Ne,Ae]),ot=(0,m.useMemo)(function(){var o;return r==null||(o=r.models)===null||o===void 0?void 0:o.reduce(function(l,M){var f="models.".concat(M.model_type_id,".").concat(M.model_id);return l["".concat(f,".target_group")]=M.target_group,l["".concat(f,".display_frequency_minutes")]=M.display_frequency_minutes,l},{})},[r==null?void 0:r.models]);if(!r)return(0,e.jsx)(ue.Z,{});var lt=[{label:(0,e.jsx)(a.FormattedMessage,{id:"author"}),value:"author"},{label:(0,e.jsx)(a.FormattedMessage,{id:"users"}),value:"user"}];return(0,e.jsx)(xe._z,{title:(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(a.FormattedMessage,{id:r!=null&&r.title?"questionnaire":"new_questionnaire"})}),header:{breadcrumb:{routes:[{path:"other/questionnaire",breadcrumbName:S.formatMessage({id:"menu.Other activities.Questionnaire"})},{path:String(y),breadcrumbName:S.formatMessage({id:"form"})},{path:"/",breadcrumbName:String(r==null?void 0:r.title)}]}},children:(0,e.jsxs)(q.ZP,{tabs:{type:"card",defaultActiveKey:"questionnaire",activeKey:p,onChange:function(l){return v(l)}},children:[(0,e.jsxs)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"}),children:[(0,e.jsx)(Ie,{level:3,children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire",defaultMessage:"questionnaire"})}),(0,e.jsx)(V.ZP,c()(c()({},nt),{},{form:h,children:(0,e.jsxs)(V.ZP.Group,{children:[(0,e.jsx)(N.Z,{label:(0,e.jsx)(a.FormattedMessage,{id:"title",defaultMessage:"title"}),rules:[{required:!0}],width:"md",name:"title"}),(0,e.jsx)(re.Z,{width:"md",initialValue:!0,name:"active",label:(0,e.jsx)(a.FormattedMessage,{id:"is_active",defaultMessage:"is_active"})})]})}))]},"questionnaire"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"questions",defaultMessage:"questions"}),disabled:x,children:(0,e.jsx)(Ke,{questionnaireId:Number(y),questions:r.questions||[],fetchData:ve})},"questions"),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"answers",defaultMessage:"answers"}),disabled:x,children:(0,e.jsx)(Q,{questionnaireId:Number(y),questions:r.questions||[]})},"answers"),Ze&&Ze.map(function(o){var l,M,f,U;return(0,e.jsxs)(q.ZP.TabPane,{tab:"".concat(S.formatMessage({id:"assign"})," ").concat(S.formatMessage({id:"to"})," ").concat(S.formatMessage({id:(l=o.title)===null||l===void 0?void 0:l.replace(o.title.charAt(0),o.title.charAt(0).toUpperCase())})),disabled:x,children:[(0,e.jsx)(he.T,{defaultValue:((M=r.models)===null||M===void 0?void 0:M.filter(function(A){return A.model_type_title===o.title}).map(function(A){return{value:A.model_id,label:A.model_title}}))||[],multiple:!0,onChange:function(je,D){return[st(je,o.id),rt(function(ut){return c()(c()({},ut),{},J()({},o.id,D.map(function(dt){return dt.label})))})]},modelType:(f=o.title)===null||f===void 0?void 0:f.toUpperCase()}),(0,e.jsx)(V.ZP,{form:P,submitter:!1,initialValues:ot,style:{marginTop:"20px"},children:fe[o.id]&&((U=fe[o.id])===null||U===void 0?void 0:U.map(function(A,je){return(0,e.jsxs)("div",{children:[(0,e.jsx)(Ie,{level:5,children:it(Number(A),o.title,je,o.id)}),(0,e.jsxs)(V.ZP.Group,{children:[(0,e.jsx)(ie.Z,{width:"md",name:"models.".concat(o.id,".").concat(A,".target_group"),label:(0,e.jsx)(a.FormattedMessage,{id:"target_group",defaultMessage:"target_group"}),initialValue:"user",options:lt}),(0,e.jsx)(oe.Z,{width:"md",name:"models.".concat(o.id,".").concat(A,".display_frequency_minutes"),label:(0,e.jsx)(a.FormattedMessage,{id:"display_frequency_minutes",defaultMessage:"display_frequency_minutes"})})]})]},String(A))}))}),(0,e.jsx)(ee.ZP,{className:"submit-btn",type:"primary",onClick:function(){return h.submit()},children:(0,e.jsx)(a.FormattedMessage,{id:"questionnaire.submit",defaultMessage:"questionnaire.submit"})})]},String(o.id))}),(0,e.jsx)(q.ZP.TabPane,{tab:(0,e.jsx)(a.FormattedMessage,{id:"menu.reports",defaultMessage:"menu.reports"}),disabled:x||((I=r.models)===null||I===void 0?void 0:I.length)===0,children:(r==null?void 0:r.models)&&(r==null||(n=r.models)===null||n===void 0?void 0:n.length)>0&&(0,e.jsx)(Je,{questionnaireId:Number(y),models:r.models})},"raport")]})})},ke=Te}}]);
