"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2238],{20568:function(ee,w,e){e.d(w,{Z:function(){return I}});var Z=e(19632),g=e.n(Z),F=e(97857),d=e.n(F),$=e(5574),T=e.n($),m=e(67294),D=e(17578),L=e(78957),P=e(71471),K=e(55102),t=e(14726),b=e(2487),S=e(72252),z=e(82061),M=e(55725),c=e(69753),_=e(80854),l=e(29477),n=e(85893),a=function(O){var R=O.directory,x=O.onUploaded;return(0,n.jsxs)(L.Z,{align:"start",children:[(0,n.jsxs)(P.Z.Text,{children:[(0,n.jsx)(_.FormattedMessage,{id:"pages.files.filesBrowser"}),(0,n.jsx)(P.Z.Text,{code:!0,children:R})]}),(0,n.jsx)(l.Z,{url:"/api/admin/file/upload",name:"file[]",data:{target:R},onUpload:function(f){f.success&&x(R,f.data)}})]})},N=function(O){var R=O.defaultDirectory,x=R===void 0?"/":R,y=O.onFile,f=O.hideDeleteBtn,u=f===void 0?!1:f,o=O.forceLoading,C=o===void 0?!1:o,p=O.hideAddBtn,G=p===void 0?!1:p,v=(0,_.useIntl)(),X=(0,m.useState)({loading:!1,name:"",directory:x,current_page:1,data:void 0,per_page:1,last_page:1,total:0}),H=T()(X,2),h=H[0],Q=H[1],W=(0,m.useRef)(),j=(0,m.useCallback)(function(s){Q(function(r){return d()(d()({},r),{},{loading:s})})},[]),Y=(0,m.useCallback)(function(s,r){s.success&&Q(function(i){return d()(d()(d()({},i),s.data),{},{data:[{url:r.split("/").slice(0,-1).join("/"),name:"..",created_at:"",mime:"directory"}].concat(g()(s.data.data.map(function(E){return d()(d()({},E),{},{url:E.mime==="directory"?"".concat(r,"/").concat(E.name):E.url})}))).filter(function(E){return r==="/"||r===x?E.name!=="..":!0}),directory:r,loading:!1})})},[j]),U=(0,m.useCallback)(function(s){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,E=function(){return W.current&&W.current.abort()};return E(),W.current=new AbortController,j(!0),(0,D.QZ)({directory:s,page:i},{signal:(r=W.current)===null||r===void 0?void 0:r.signal}).then(function(B){B.success&&Y(B,s)}).catch(function(){return j(!1)}),function(){E()}},[j]);(0,m.useEffect)(function(){return U(x)},[x,U]);var q=(0,m.useCallback)(function(s){j(!0),(0,D.Od)(s).then(function(){U(h.directory)}).catch(function(){j(!1)})},[U,j,h.directory]),ne=(0,m.useCallback)(function(s,r){var i,E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,B=function(){return W.current&&W.current.abort()};return B(),W.current=new AbortController,j(!0),(0,D.ht)({directory:s,name:r,page:E},{signal:(i=W.current)===null||i===void 0?void 0:i.signal}).then(function(V){V.success&&Y(V,s)}).catch(function(){return j(!1)}),function(){B()}},[j]);return(0,n.jsxs)("div",{className:"file-browser",children:[(0,n.jsxs)("div",{className:"file-browser__header",children:[(0,n.jsx)(K.Z,{placeholder:v.formatMessage({id:"search_file"}),className:"file-browser__input",onChange:function(r){return Q(function(i){return d()(d()({},i),{},{name:r.target.value})})},value:h.name}),(0,n.jsxs)("div",{children:[(0,n.jsx)(t.ZP,{className:"file-browser__button",onClick:function(){return U(h.directory)},children:(0,n.jsx)(_.FormattedMessage,{id:"reset"})}),(0,n.jsx)(t.ZP,{className:"file-browser__button",type:"primary",onClick:function(){return ne(h.directory,h.name)},children:(0,n.jsx)(_.FormattedMessage,{id:"query"})})]})]}),(0,n.jsx)(b.Z,{loading:h.loading||C,size:"small",itemLayout:"horizontal",dataSource:h.data,header:G?null:(0,n.jsx)(a,{directory:h.directory,onUploaded:function(r,i){i&&(U(r),y&&y(i,r))}}),footer:G?null:(0,n.jsx)(a,{directory:h.directory,onUploaded:function(r,i){U(r),i&&y&&y(i,r)}}),renderItem:function(r){return(0,n.jsx)(b.Z.Item,{actions:r.mime!=="directory"&&!u?[(0,n.jsx)(t.ZP,{type:"default",danger:!0,icon:(0,n.jsx)(z.Z,{}),size:"small",onClick:function(){return q(r.url)}},"dir")]:[],children:(0,n.jsx)(b.Z.Item.Meta,{avatar:r.mime==="directory"?(0,n.jsx)(t.ZP,{type:"primary",icon:(0,n.jsx)(M.Z,{}),size:"small",onClick:function(){return U(r.url)}}):(0,n.jsx)("a",{href:r.url,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(t.ZP,{type:"default",icon:(0,n.jsx)(c.Z,{}),size:"small"})}),description:(0,n.jsx)(m.Fragment,{children:(0,n.jsx)(t.ZP,{type:"text",size:"small",onClick:function(){return r.mime==="directory"?U(r.url):y&&y(r,h.directory)},children:r.name})})})})}}),(0,n.jsx)(S.Z,{pageSizeOptions:[],current:h.current_page,total:h.total,pageSize:h.per_page,onChange:function(r){return U(h.directory,r)}})]})},I=N},82238:function(ee,w,e){var Z=e(9783),g=e.n(Z),F=e(5574),d=e.n(F),$=e(13769),T=e.n($),m=e(15009),D=e.n(m),L=e(97857),P=e.n(L),K=e(99289),t=e.n(K),b=e(20568),S=e(29477),z=e(54734),M=e(2453),c=e(14726),_=e(28248),l=e(67294),n=e(80854),a=e(85893),N=["folder","onResponse","onUpload"],I=function(){var f=t()(D()().mark(function u(o,C,p){return D()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,n.request)(o,P()({method:"POST",data:C},p||{})));case 1:case"end":return v.stop()}},u)}));return function(o,C,p){return f.apply(this,arguments)}}(),k=function(u){var o=u.split("//").join("/");return o=o[o.length-1]==="/"?o:"".concat(o,"/"),o=o[0]==="/"?o.slice(1):o,o},O=function(u){return Array.isArray(u)&&u[0]?u[0].name:u.name},R=function(u,o){var C=k(u),p=O(o);return p.includes(C)?p:"".concat(C).concat(p)},x=function(u){return{file:{status:"done",uid:"fileFromBrowser",name:"fileFromBrowser",response:u},fileList:[]}};function y(f){var u=f.folder,o=f.onResponse,C=f.onUpload,p=T()(f,N),G=(0,l.useState)(!1),v=d()(G,2),X=v[0],H=v[1],h=(0,l.useState)(!1),Q=d()(h,2),W=Q[0],j=Q[1],Y=p.url,U=p.name,q=p.onChange,ne=p.data,s=(0,l.useCallback)(function(){H(!1)},[]),r=(0,l.useCallback)(function(){var i=t()(D()().mark(function E(B,V){var J;return D()().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(V){A.next=2;break}return A.abrupt("return");case 2:return j(!0),A.prev=3,A.next=6,I(Y,P()(P()({},ne),{},g()({},U,R(V,B))));case 6:J=A.sent,o&&o(J),J.success?(s(),q&&q(x(J))):M.ZP.error(J.message),A.next=15;break;case 11:A.prev=11,A.t0=A.catch(3),j(!1),M.ZP.error("data"in A.t0?A.t0.data.message:"Unknown Error");case 15:return A.prev=15,j(!1),A.finish(15);case 18:case"end":return A.stop()}},E,null,[[3,11,15,18]])}));return function(E,B){return i.apply(this,arguments)}}(),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.ZP,{onClick:function(){return H(!0)},icon:(0,a.jsx)(z.Z,{}),children:[" ",(0,a.jsx)(n.FormattedMessage,{id:"browse"})]}),X&&(0,a.jsx)(_.Z,{open:X,onCancel:s,onOk:s,width:"60vw",closeIcon:!1,children:(0,a.jsx)(b.Z,{forceLoading:W,hideDeleteBtn:!0,defaultDirectory:u,onFile:function(E,B){return r(E,B)}})}),(0,a.jsx)("div",{style:{marginTop:"10px"},children:(0,a.jsx)(S.Z,P()({onUpload:C},p))})]})}w.Z=y},29477:function(ee,w,e){var Z=e(97857),g=e.n(Z),F=e(5574),d=e.n(F),$=e(55523),T=e(75842),m=e(21974),D=e(67294),L=e(80854),P=e(85893);function K(t){var b=t.onChange,S=t.onUpload,z=t.url,M=t.name,c=t.extra,_=t.accept,l=t.data,n=t.wrapInForm,a=n===void 0?!0:n,N=t.title,I=t.formProps,k=t.maxFiles,O=t.clearListAfterUpload,R=t.hideLabel,x=t.disabled,y=t.showUploadList,f=(0,D.useState)(),u=d()(f,2),o=u[0],C=u[1],p=(0,L.useIntl)();return l&&l[M]&&delete l[M],(0,P.jsx)(m.Z,{condition:a,wrap:function(v){return(0,P.jsx)(T.Z,g()(g()({},I),{},{children:v}))},children:(0,P.jsx)($.Z,{title:N||" ".concat(p.formatMessage({id:"upload_click_here"})),placeholder:p.formatMessage({id:"upload_click_here"}),label:!R&&(0,P.jsx)(L.FormattedMessage,{id:"upload"}),max:k!=null?k:2,fieldProps:{data:l,accept:_,name:M,showUploadList:y,headers:{Authorization:"Bearer ".concat(localStorage.getItem("TOKEN"))},onChange:function(v){C(v),b&&b(v),v.file.status==="done"&&(S&&S(v.file.response),O&&C(void 0))}},action:"".concat(window.REACT_APP_API_URL||"https://api-stage.escolalms.com").concat(z),extra:c,fileList:o==null?void 0:o.fileList,disabled:x})})}w.Z=K},17578:function(ee,w,e){e.d(w,{Od:function(){return z},QZ:function(){return D},ht:function(){return P},pV:function(){return S},ws:function(){return t}});var Z=e(15009),g=e.n(Z),F=e(97857),d=e.n(F),$=e(99289),T=e.n($),m=e(80854);function D(c,_){return L.apply(this,arguments)}function L(){return L=T()(g()().mark(function c(_,l){return g()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,m.request)("/api/admin/file/list",d()({method:"GET",params:_},l||{})));case 1:case"end":return a.stop()}},c)})),L.apply(this,arguments)}function P(c,_){return K.apply(this,arguments)}function K(){return K=T()(g()().mark(function c(_,l){return g()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,m.request)("/api/admin/file/find",d()({method:"GET",params:_},l||{})));case 1:case"end":return a.stop()}},c)})),K.apply(this,arguments)}function t(c,_,l){return b.apply(this,arguments)}function b(){return b=T()(g()().mark(function c(_,l,n){var a;return g()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return a=new FormData,a.append("file[]",_),a.append("target",l),I.abrupt("return",(0,m.request)("/api/admin/file/upload",d()({method:"POST",data:a},n||{})));case 4:case"end":return I.stop()}},c)})),b.apply(this,arguments)}var S=function(_){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;return"".concat(window.REACT_APP_API_URL||"https://api-stage.escolalms.com","/api/images/img?path=").concat(_,"&w=").concat(l)};function z(c,_){return M.apply(this,arguments)}function M(){return M=T()(g()().mark(function c(_,l){return g()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,m.request)("/api/admin/file/delete",d()({method:"DELETE",data:{url:_}},l||{})));case 1:case"end":return a.stop()}},c)})),M.apply(this,arguments)}}}]);
