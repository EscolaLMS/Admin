(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{"5R/X":function(mt,Ae,i){},"5Syx":function(mt,Ae,i){"use strict";i.d(Ae,"c",function(){return Ue}),i.d(Ae,"b",function(){return jt}),i.d(Ae,"a",function(){return tt});var b=i("OaEy"),De=i("2fM7"),ae=i("g9YV"),F=i("wCAj"),be=i("14J3"),j=i("BMrR"),st=i("BoS7"),s=i("Sdc0"),Qe=i("jrin"),ie=i("k1fw"),oe=i("DYRE"),ge=i("zeV3"),Ye=i("+BJd"),Ge=i("mr32"),q=i("oBTY"),_e=i("tJVT"),we=i("q1tI"),ut=i.n(we),ft=i("nhC9"),Le=i("LDJE"),h=i("9kvl"),L=i("nz6D"),Ne=i("sWYD"),nt=i("mGZj"),ct=i("Vpfc"),de=i("+L6B"),W=i("2/Rp"),A=i("qLMh"),M=i("9og8"),z=i("4KAj"),Ce=i("w/VK"),y=i("nKUr"),Te=function(ve){var Oe=ve.course_id,se=ve.stat,le=se===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":se,me=Object(we.useState)(!1),Me=Object(_e.a)(me,2),fe=Me[0],I=Me[1],He=Object(we.useCallback)(function(Ee){return Object(M.a)(Object(A.a)().mark(function pe(){var Y,J;return Object(A.a)().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return I(!0),G.prev=1,G.next=4,Object(Ce.a)(Ee,{stat:le});case 4:Y=G.sent,Y instanceof Blob&&(J=document.createElement("a"),J.href=window.URL.createObjectURL(Y),J.download="finished_topics_".concat(Oe,".xlsx"),document.body.appendChild(J),J.click(),document.body.removeChild(J)),G.next=11;break;case 8:G.prev=8,G.t0=G.catch(1),console.error(G.t0);case 11:return G.prev=11,I(!1),G.finish(11);case 14:case"end":return G.stop()}},pe,null,[[1,8,11,14]])}))},[le]);return Object(y.jsxs)(W.a,{type:"primary",loading:fe,onClick:He(Oe),children:[Object(y.jsx)(z.a,{})," ",Object(y.jsx)(h.a,{id:"export"})]})},et=i("c+yx"),qe=function(ve){return ve.topicable.content.contents?Object.values(ve.topicable.content.contents)[0].library:"H5P"},Ue=function(ve){var Oe=ve.course_id,se=ve.topics,le=ve.stats,me=Object(we.useState)(!1),Me=Object(_e.a)(me,2),fe=Me[0],I=Me[1],He=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(Y){return Object(y.jsx)(ct.a,{type:"App\\Models\\User",type_id:Y})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"}].concat(Object(q.a)(se.map(function(pe){var Y,J=(Y=pe.topicable_type)===null||Y===void 0?void 0:Y.split("\\").pop();return J==="H5P"&&(J=qe(pe)),{render:function(G){var _=0;switch(G&&(G.started_at&&G.finished_at?_=1:G.started_at&&(_=2)),_){case 1:return Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(Ge.a,{color:"success",children:"F"}),fe&&(G==null?void 0:G.seconds)&&Object(y.jsx)("small",{children:Object(et.m)(G.seconds)})]});case 2:return Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(Ge.a,{color:"blue",children:"S"}),fe&&(G==null?void 0:G.seconds)&&Object(y.jsx)("small",{children:Object(et.m)(G.seconds)})]});case 0:default:return Object(y.jsx)(ut.a.Fragment,{children:Object(y.jsx)(Ge.a,{color:"error",children:"N"})})}},title:Object(y.jsxs)("small",{children:[Object(y.jsx)(Ge.a,{children:J})," ",pe.title]}),dataIndex:pe.id}})))},[se,fe]),Ee=Object(we.useMemo)(function(){return le.map(function(pe){return se.reduce(function(Y,J){var Q=pe.topics.find(function(G){return G.id===J.id});return Object(ie.a)(Object(ie.a)({},Y),{},Object(Qe.a)({},Number(J.id),Q!=null?Q:0))},{email:pe.email,id:pe.id})})},[le,se]);return Object(y.jsx)(F.a,{title:function(){return Object(y.jsxs)(j.a,{justify:"space-between",align:"middle",children:[Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(h.a,{id:"Finished",defaultMessage:"Finished:"})," ",Object(y.jsx)(Ge.a,{color:"success",children:"F"}),Object(y.jsx)(h.a,{id:"Started",defaultMessage:"Started:"})," ",Object(y.jsx)(Ge.a,{color:"blue",children:"S"}),Object(y.jsx)(h.a,{id:"NotStarted",defaultMessage:"Not Started:"})," ",Object(y.jsx)(Ge.a,{color:"error",children:"N"}),Object(y.jsx)(h.a,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",Object(y.jsx)(s.a,{checked:fe,onChange:function(J){return I(J)}})]}),Object(y.jsx)(Te,{course_id:Oe})]})},columns:He,dataSource:Ee,size:"small",scroll:{x:1500},components:{table:function(Y){return Object(y.jsx)(L.a,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:Object(y.jsx)("table",Object(ie.a)({},Y))})}}})},jt=function(ve){var Oe=ve.stats,se=ve.attempts,le=Object(we.useMemo)(function(){return[{title:Object(y.jsx)(h.a,{id:"user"}),dataIndex:"id",render:function(fe){return Object(y.jsx)(ct.a,{type:"App\\Models\\User",type_id:fe})}},{title:Object(y.jsx)(h.a,{id:"email"}),dataIndex:"email"},{title:Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:Object(y.jsx)(h.a,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(fe){return fe?Object(Ne.a)(new Date(fe),nt.a):""}}]},[]),me=Object(we.useMemo)(function(){return Oe.map(function(Me){var fe=Me.id,I=Me.email,He=Me.finished_at,Ee=se==null?void 0:se.find(function(Y){return Y.id===fe}),pe=Array.isArray(Ee==null?void 0:Ee.attempts)?Ee==null?void 0:Ee.attempts.length:0;return{id:fe,email:I,finished_at:He,attempt:pe}})},[Oe]);return Object(y.jsx)(F.a,{title:function(){return Object(y.jsx)(ge.b,{children:Object(y.jsx)(h.a,{id:"course.finished",defaultMessage:"Finished"})})},columns:le,dataSource:me,size:"small",scroll:{x:500}})},tt=function(ve){var Oe=ve.stats,se=Object(we.useState)(null),le=Object(_e.a)(se,2),me=le[0],Me=le[1],fe=Object(we.useState)(null),I=Object(_e.a)(fe,2),He=I[0],Ee=I[1],pe=Object(h.l)(),Y=Object(we.useMemo)(function(){return Oe.flatMap(function(Q){return Object.values(Q.attempts).flatMap(function(G){var _=G.dates,U=G.attempt,R=Object.values(_).flatMap(function(w){var N=w.date,V=w.seconds_total;return{date:N,attempt:U,seconds_total:V,email:Q.email}});return R})})},[Oe]),J={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return Object(y.jsx)(ft.a,{title:Object(y.jsxs)(ge.b,{children:[Object(y.jsx)(h.a,{id:"course.interactions_time_in_days"}),Object(y.jsx)(De.a,{showSearch:!0,value:me,onChange:function(G){Me(G),Ee(null)},placeholder:Object(y.jsx)(h.a,{id:"select_person",defaultMessage:"Select a person"}),children:Oe.map(function(Q){var G=Q.id,_=Q.email;return Object(y.jsx)(De.a.Option,{value:_,children:_},G)})}),Object(y.jsx)(De.a,{value:He,onChange:function(G){return Ee(G)},disabled:me===null,placeholder:Object(y.jsx)(h.a,{id:"select_attempt",defaultMessage:"Select attempt"}),children:Object(q.a)(new Set(Y.filter(function(Q){var G=Q.email;return G===me}).map(function(Q){var G=Q.attempt;return G}))).map(function(Q){return Object(y.jsxs)(De.a.Option,{value:Q,children:[Object(y.jsx)(h.a,{id:"attempt",defaultMessage:"Attempt"})," ",Q]},Q)})})]}),colSpan:12,layout:"center",children:Object(y.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:Object(y.jsx)(Le.a,Object(ie.a)(Object(ie.a)({},J),{},{tooltip:{title:"".concat(pe.formatMessage({id:"attempt"})),formatter:function(G){var _=Math.floor(+G.seconds_total/60),U=+G.seconds_total>60?+G.seconds_total-_*60:0;return{name:G.attempt,value:"".concat(_,"m ").concat(U,"s")}}},data:Y.filter(function(Q){var G=Q.email;return G===me}).filter(function(Q){var G=Q.attempt;return Number.isInteger(He)?G===He:!0})}))})})}},olry:function(mt,Ae,i){"use strict";i.r(Ae);var b=i("k1fw"),De=i("+L6B"),ae=i("2/Rp"),F=i("T2oS"),be=i("W9HT"),j=i("q1tI"),st=i.n(j),s=i("9kvl"),Qe=i("55Ip"),ie=i("Ty5D"),oe=i("nhC9"),ge=i("tMyG"),Ye=i("my69"),Ge=i("huej"),q=i("mJ0o"),_e=i("EhlZ"),we=i("P2fV"),ut=i("NJEC"),ft=i("5Dmo"),Le=i("3S7+"),h=i("qLMh"),L=i("9og8"),Ne=i("sWYD"),nt=i("G3dp"),ct=i("lbgm"),de=i("/MfK"),W=i("Qiat"),A=i("mGZj");function M(u,n){return z.apply(this,arguments)}function z(){return z=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"GET",useCache:!1,params:n},a||{})));case 1:case"end":return t.stop()}},u)})),z.apply(this,arguments)}function Ce(u,n){return y.apply(this,arguments)}function y(){return y=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),y.apply(this,arguments)}function Te(u,n,a){return et.apply(this,arguments)}function et(){return et=Object(L.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"PUT",data:a,useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),et.apply(this,arguments)}function qe(u,n){return Ue.apply(this,arguments)}function Ue(){return Ue=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Ue.apply(this,arguments)}function jt(u,n){return tt.apply(this,arguments)}function tt(){return tt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),tt.apply(this,arguments)}function at(u,n,a,r){return ve.apply(this,arguments)}function ve(){return ve=Object(L.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:r},t||{})));case 1:case"end":return l.stop()}},u)})),ve.apply(this,arguments)}function Oe(u,n,a){return se.apply(this,arguments)}function se(){return se=Object(L.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/exams/".concat(n,"/users/").concat(a),Object(b.a)({method:"DELETE"},r||{})));case 1:case"end":return c.stop()}},u)})),se.apply(this,arguments)}var le=i("Vpfc"),me=i("lanV"),Me=i("giR+"),fe=i("fyUT"),I=i("tJVT"),He=i("14J3"),Ee=i("BMrR"),pe=i("jCWc"),Y=i("kPKH"),J=i("VMEa"),Q=i("Qurx"),G=i("lR9U"),_=i("/y+f"),U=i("2qtc"),R=i("kLXV"),w=i("DYRE"),N=i("zeV3"),V=i("XCrF"),xe=i("1GRj"),re=i("jrin"),$e=i("oBTY"),$r=i("OaEy"),vt=i("2fM7"),ra=i("+YFz"),na=i("DBJ/"),e=i("nKUr"),it,sa=function(n){var a=n.type,r=n.onDataConverted,t=n.groupSelectDisabled,c=Object(q.b)(),l=c.semester_subject_id,d=c.teacherSubjectData,m=Object(j.useState)(null),S=Object(I.a)(m,2),p=S[0],g=S[1],v=Object(j.useMemo)(function(){var x;return((x=d==null?void 0:d.groups)!==null&&x!==void 0?x:[]).map(function(O){var E=O.id,T=O.name;return{label:T,value:E}})},[]),o={type:a,group_id:p,semester_subject_id:l},f=Object(j.useCallback)(function(x){if(x.success){var O=x.data.results.filter(function(E){var T=E.user_id;return T!==null});if(!O.length)return;r({exam_results:O,group_id:x.data.group_id})}},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(J.a.Item,{label:Object(e.jsx)(s.a,{id:"group"}),children:Object(e.jsx)(vt.a,{disabled:t,value:p,onChange:function(O){return g(O)},options:v,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})}),Object(e.jsx)(na.a,{name:"file",url:"/api/admin/exams/parse",onUpload:f,onChange:function(O){return!O.fileList.length&&r(void 0)},maxFiles:1,data:o,disabled:!p})]})},ua=function(n){var a=n.onDataConverted,r=Object(q.b)(),t=r.teacherSubjectData,c=r.groupUsers,l=Object(j.useState)(null),d=Object(I.a)(l,2),m=d[0],S=d[1],p=Object(j.useMemo)(function(){var v;return((v=t==null?void 0:t.groups)!==null&&v!==void 0?v:[]).map(function(o){var f=o.id,x=o.name;return{label:x,value:f}})},[]),g=Object(j.useCallback)(function(v){var o;S(v);var f=(o=c.byId)===null||o===void 0?void 0:o[v];if(!!f){var x=f.users.reduce(function(O,E){var T=E.id,C=E.email,B=E.first_name,K=E.last_name,ue=E.academic_teacher_id;return ue!==null?O:[].concat(Object($e.a)(O),[{email:C,first_name:B,last_name:K,user_id:T,result:0}])},[]);a({group_id:v,exam_results:x})}},[c.byId]);return Object(e.jsx)(vt.a,{value:m,onChange:g,options:p,placeholder:Object(e.jsx)(s.a,{id:"select_group"}),style:{width:"100%"}})},Ot=(it={},Object(re.a)(it,_.c.TestPortal,["/teacher-examples/testPortal.png"]),Object(re.a)(it,_.c.TeamsForms,["/teacher-examples/teamsForms.png"]),Object(re.a)(it,_.c.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),Object(re.a)(it,_.c.Manual,[]),it),ca=function(n){var a=n.images,r=Object(j.useState)(!1),t=Object(I.a)(r,2),c=t[0],l=t[1],d=Object(j.useCallback)(function(){return l(!0)},[]);return Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"see_file_example_image"}),children:Object(e.jsx)(ae.a,{onClick:d,icon:Object(e.jsx)(ra.a,{})})}),Object(e.jsx)(xe.a.PreviewGroup,{preview:{visible:c,onVisibleChange:l},children:a.map(function(m){return Object(e.jsx)(xe.a,{style:{display:"none"},src:m},m)})})]})},ia=function(n){var a,r=n.type,t=n.onOk,c=n.onCancel,l=n.okDisabled,d=(a=Ot==null?void 0:Ot[r])!==null&&a!==void 0?a:Ot[_.c.Manual];return Object(e.jsxs)(N.b,{style:{width:"100%",justifyContent:d.length?"space-between":"flex-end"},children:[!!d.length&&Object(e.jsx)(ca,{images:d}),Object(e.jsxs)(N.b,{children:[Object(e.jsx)(ae.a,{onClick:c,children:Object(e.jsx)(s.a,{id:"cancel"})}),Object(e.jsx)(ae.a,{type:"primary",disabled:l,onClick:t,children:Object(e.jsx)(s.a,{id:"ok"})})]})]})},da=[_.c.TeamsLecture,_.c.TestPortal,_.c.TeamsForms],la=function(n){var a=n.open,r=n.closeModal,t=n.onSuccess,c=n.type,l=Object(q.b)(),d=l.teacherSubjectData,m=l.fetchGroupUsers,S=Object(j.useState)(),p=Object(I.a)(S,2),g=p[0],v=p[1];return Object(j.useEffect)(function(){if(c===_.c.Manual&&a){var o;d==null||(o=d.groups)===null||o===void 0||o.forEach(function(f){var x=f.id;return m(x)})}},[c,a]),Object(e.jsxs)(R.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.".concat(c,"Convert")}),width:"40vw",open:a,onCancel:r,footer:Object(e.jsx)(ia,{type:c,onOk:function(){g&&t(g)},onCancel:r,okDisabled:!g}),children:[da.includes(c)&&Object(e.jsx)(sa,{type:c,onDataConverted:v,groupSelectDisabled:!!g}),c===_.c.Manual&&Object(e.jsx)(ua,{onDataConverted:v})]})},oa=function(n){var a=n.onSelect;return Object(e.jsxs)(Ee.a,{gutter:[16,16],children:[Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(ae.a,{type:"primary",onClick:function(){return a(_.c.TeamsForms)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(ae.a,{type:"primary",onClick:function(){return a(_.c.TestPortal)},children:Object(e.jsx)(s.a,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(ae.a,{type:"primary",onClick:function(){return a(_.c.TeamsLecture)},children:Object(e.jsx)(s.a,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(ae.a,{type:"primary",onClick:function(){return a(_.c.Manual)},children:Object(e.jsx)(s.a,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})})]})},ja=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",editable:!1},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],ba=function(n){var a,r=n.exam_id,t=J.a.useForm(),c=Object(I.a)(t,1),l=c[0],d=Object(j.useState)(),m=Object(I.a)(d,2),S=m[0],p=m[1],g=Object(j.useState)(),v=Object(I.a)(g,2),o=v[0],f=v[1],x=Object(j.useState)(!1),O=Object(I.a)(x,2),E=O[0],T=O[1],C=Object(q.b)(),B=C.semester_subject_id,K=C.getGroupById,ue=Object(j.useMemo)(function(){var P;return((P=o==null?void 0:o.exam_results)!==null&&P!==void 0?P:[]).map(function($){var D=$.user_id;return D})},[o==null?void 0:o.exam_results]);Object(j.useEffect)(function(){var P=Number(r);r==="new"&&(p(void 0),f(void 0),l.resetFields()),r!=="new"&&!Number.isNaN(P)&&(T(!0),qe(P).then(function($){if($.success){var D=$.data,k=D.type,Pe=D.results,ke=D.title,te=D.weight,ne=D.passed_at,H=D.group_id;p(k),f({group_id:H,exam_results:Pe}),l.setFieldsValue({title:ke,weight:te,passed_at:ne})}}).finally(function(){return T(!1)}))},[r]);var Ie=Object(j.useCallback)(function(){p(void 0),f(void 0)},[]);return E?Object(e.jsx)(be.a,{}):Object(e.jsxs)(e.Fragment,{children:[S&&Object(e.jsx)(la,{open:Boolean(S&&!o),type:S,closeModal:Ie,onSuccess:f}),Object(e.jsxs)(J.a,{form:l,submitter:S===void 0||!o?!1:void 0,onFinish:function(){var P=Object(L.a)(Object(h.a)().mark(function $(D){var k,Pe,ke,te,ne,H,Se,Be,ye,ze;return Object(h.a)().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(Pe=o==null||(k=o.exam_results)===null||k===void 0?void 0:k.every(function(X){var Z=X.result;return typeof Z=="number"&&Z>=0&&Z<=100}),!(o&&Pe&&typeof B=="number")){ce.next=17;break}if(ke=D.title,te=D.passed_at,ne=D.weight,H=Number(r),Se=o.exam_results,Be=o.group_id,ye={type:S,semester_subject_id:B,title:ke,passed_at:te,weight:ne,group_id:Be,results:Se},!Number.isNaN(H)){ce.next=12;break}return ce.next=9,Ce(ye);case 9:ce.t0=ce.sent,ce.next=15;break;case 12:return ce.next=14,Te(H,ye);case 14:ce.t0=ce.sent;case 15:ze=ce.t0,ze.success&&s.f.push("/teacher/subjects/".concat(B,"/exams"));case 17:return ce.abrupt("return",!0);case 18:case"end":return ce.stop()}},$)}));return function($){return P.apply(this,arguments)}}(),onReset:Ie,children:[Object(e.jsxs)(J.a.Group,{children:[Object(e.jsx)(Q.a,{label:Object(e.jsx)(s.a,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"title"}),Object(e.jsx)(G.a,{label:Object(e.jsx)(s.a,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],width:"lg",name:"passed_at"}),Object(e.jsx)(J.a.Item,{name:"weight",label:Object(e.jsx)(s.a,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:1,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:1,max:100}})}],children:Object(e.jsx)(fe.a,{})})]}),S&&o&&Object(e.jsx)(W.a,{rowKey:"user_id",headerTitle:(a=K(o.group_id))===null||a===void 0?void 0:a.name,editable:{type:"single",editableKeys:ue,onValuesChange:function($,D){return f({group_id:o.group_id,exam_results:D})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:o.exam_results,pagination:{defaultPageSize:me.a},columns:ja}),!o&&Object(e.jsx)(oa,{onSelect:p})]})]})},ma=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],fa=function(n){var a=n.exam_id,r=Object(j.useState)(""),t=Object(I.a)(r,2),c=t[0],l=t[1];return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:c,pagination:{defaultPageSize:me.a},request:Object(L.a)(Object(h.a)().mark(function d(){var m;return Object(h.a)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,qe(a);case 2:if(m=p.sent,!m.success){p.next=6;break}return l(m.data.title),p.abrupt("return",{total:m.data.results.length,success:!0,data:m.data.results});case 6:return p.abrupt("return",[]);case 7:case"end":return p.stop()}},d)})),columns:ma})},va=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:Object(e.jsx)(s.a,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"ExamGradeType.".concat(a.type)})}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(n,a){return a.passed_at&&Object(Ne.a)(new Date(a.passed_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(n,a){return a.weight+"%"}},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(n,a){return a.created_at&&Object(Ne.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(n,a){return Object(e.jsx)(s.a,{id:"SemesterType.".concat(a.semester.type),values:{year:a.semester.year}})}},{title:Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(n,a){return Object(e.jsx)(le.a,{type:"Students",type_id:a.group_id},a.group_id)}}],Oa=function(){var n,a,r=Object(j.useRef)(),t=Object(q.b)(),c=t.semester_subject_id,l=Object(ie.k)(),d=Object(j.useMemo)(function(){var p,g,v;return{exam_id:(p=(g=l.query)===null||g===void 0?void 0:g.exam_id)!==null&&p!==void 0?p:null,results:(v=l.query)===null||v===void 0?void 0:v.results}},[(n=l.query)===null||n===void 0?void 0:n.exam_id,(a=l.query)===null||a===void 0?void 0:a.results]),m=d.exam_id,S=d.results;return S!==null&&!Number.isNaN(Number(S))?Object(e.jsx)(fa,{exam_id:Number(S)}):m!==null?Object(e.jsx)(ba,{exam_id:m}):Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:Object(e.jsx)(s.a,{id:"exams"}),actionRef:r,search:!1,rowKey:"id",pagination:{defaultPageSize:me.a},request:function(){var p=Object(L.a)(Object(h.a)().mark(function g(v,o){var f,x,O,E;return Object(h.a)().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(f=v.current,x=v.pageSize,c!==null){C.next=3;break}return C.abrupt("return",{data:[],total:0,success:!1});case 3:return O=o&&Object.entries(o)[0],C.next=6,M({per_page:x,page:f,semester_subject_id:Number.isNaN(c)?void 0:c,order_by:O&&O[0],order:O&&(O[1]==="ascend"?"ASC":"DESC")});case 6:if(E=C.sent,!E.success){C.next=9;break}return C.abrupt("return",{data:E.data,total:E.meta.total,success:!0});case 9:return C.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return C.stop()}},g)}));return function(g,v){return p.apply(this,arguments)}}(),columns:[].concat(va,[{title:Object(e.jsx)(s.a,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(g,v){return[Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?exam_id=").concat(v.id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"edit",defaultMessage:"edit"}),children:Object(e.jsx)(ae.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit"),Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(v.semester_subject_id,"/exams?results=").concat(v.id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:Object(e.jsx)(ae.a,{icon:Object(e.jsx)(ct.a,{})})})},"results"),Object(e.jsx)(ut.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:Object(L.a)(Object(h.a)().mark(function o(){var f;return Object(h.a)().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,jt(v.id);case 2:f=O.sent,f.success&&r.current&&r.current.reload();case 4:case"end":return O.stop()}},o)})),okText:Object(e.jsx)(s.a,{id:"yes"}),cancelText:Object(e.jsx)(s.a,{id:"no"}),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ae.a,{type:"primary",icon:Object(e.jsx)(de.a,{}),danger:!0})})},"delete")]}}])})},gt=i("o0Ox"),Pr=i("miYZ"),dt=i("tsqr"),pa=i("4KAj");function ha(u,n){return xt.apply(this,arguments)}function xt(){return xt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/chats/ms-teams",Object(b.a)({method:"POST",headers:{"Content-Type":"application/json"},data:n},a||{})));case 1:case"end":return t.stop()}},u)})),xt.apply(this,arguments)}var ga=function(n){var a=n.student_id,r=Object(j.useState)(!1),t=Object(I.a)(r,2),c=t[0],l=t[1],d=Object(j.useCallback)(Object(L.a)(Object(h.a)().mark(function m(){var S;return Object(h.a)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return l(!0),g.next=3,ha({user_id:a});case 3:if(S=g.sent,S.success){g.next=8;break}return dt.b.error(S.message),l(!1),g.abrupt("return");case 8:window.open(S.data.web_url,"_blank","noopener noreferrer"),l(!1);case 10:case"end":return g.stop()}},m)})),[]);return Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"msTeams",defaultMessage:"teams"}),children:Object(e.jsx)(ae.a,{loading:c,type:"primary",icon:Object(e.jsx)(pa.a,{}),onClick:d})})},xa=[{title:Object(e.jsx)(s.a,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:Object(e.jsx)(s.a,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:Object(e.jsx)(s.a,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:Object(e.jsx)(s.a,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:Object(e.jsx)(s.a,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Sa=function(n){return n.map(function(a){var r=a.id,t=a.name;return{label:t,value:r}})},ya=function(n){return n.reduce(function(a,r){var t,c=r==null||(t=r.users)===null||t===void 0?void 0:t.reduce(function(l,d){return d.academic_teacher_id!==null?l:[].concat(Object($e.a)(l),[{group_id:r.id,group_name:r.name,user_id:d.id,first_name:d.first_name,last_name:d.last_name,email:d.email}])},[]);return[].concat(Object($e.a)(a),Object($e.a)(c))},[])},_a=function(){var n=Object(q.b)(),a=n.teacherSubjectData,r=Object(j.useMemo)(function(){var t;return Sa((t=a==null?void 0:a.groups)!==null&&t!==void 0?t:[])},[a==null?void 0:a.groups]);return Object(e.jsx)(W.a,{className:"table-standalone",rowKey:function(c){return"".concat(c.group_id,"-").concat(c.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:me.a},request:function(){var t=Object(L.a)(Object(h.a)().mark(function c(l){var d,m,S,p,g,v,o,f,x;return Object(h.a)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return d=l.groups,m=l.first_name,S=m===void 0?"":m,p=l.last_name,g=p===void 0?"":p,v=l.email,o=v===void 0?"":v,E.next=3,Object(gt.a)({parent_id:a==null?void 0:a.group_id,"id[]":d});case 3:if(f=E.sent,f.success){E.next=6;break}return E.abrupt("return",{data:[],total:0,success:!1});case 6:return x=ya(f.data).filter(function(T){return T.first_name.toLowerCase().includes(S.toLowerCase())&&T.last_name.toLowerCase().includes(g.toLowerCase())&&T.email.toLowerCase().includes(o.toLowerCase())}),E.abrupt("return",{data:x,total:x.length,success:!0});case 8:case"end":return E.stop()}},c)}));return function(c){return t.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:r,mode:"multiple"}}].concat(xa,[{hideInSearch:!0,title:Object(e.jsx)(s.a,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(c,l){return[Object(e.jsx)(ga,{student_id:l.user_id},"teamsChat")]}}])})};function St(u,n){return yt.apply(this,arguments)}function yt(){return yt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules/groups/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),yt.apply(this,arguments)}function Ca(u,n,a,r){return _t.apply(this,arguments)}function _t(){return _t=Object(L.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/schedules/".concat(n,"/attendances"),Object(b.a)({data:{attendances:[{user_id:a,value:r}]},method:"POST"},t||{})));case 1:case"end":return l.stop()}},u)})),_t.apply(this,arguments)}var Ar=i("sRBo"),Bt=i("kaz8");function Ta(u){var n,a,r=u===null?_.a.ABSENT:u,t=(n={},Object(re.a)(n,_.a.PRESENT,{ch1:!0,ch2:!1}),Object(re.a)(n,_.a.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),Object(re.a)(n,_.a.ABSENT,{ch1:!1,ch2:!1}),Object(re.a)(n,_.a.EXCUSED_ABSENCE,{ch1:!1,ch2:!0}),n);return(a=t[r])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function Ea(u){var n,a=u.ch1,r=u.ch2,t="".concat(a,"_").concat(r),c={true_false:_.a.PRESENT,true_true:_.a.PRESENT_NOT_EXERCISING,false_false:_.a.ABSENT,false_true:_.a.EXCUSED_ABSENCE};return(n=c[t])!==null&&n!==void 0?n:_.a.ABSENT}var Ga=function(n){var a=n.groupAttendanceScheduleId,r=n.studentId,t=n.attendance,c=n.onSuccess,l=Object(j.useState)(Ta(t)),d=Object(I.a)(l,2),m=d[0],S=d[1],p=Object(j.useState)(!1),g=Object(I.a)(p,2),v=g[0],o=g[1],f=Object(j.useRef)(!0),x=Object(j.useCallback)(function(T){o(!0),Ca(a,r,Ea(T)).then(function(C){C.success&&(c==null||c())}).finally(function(){return o(!1)})},[]),O=Object(j.useCallback)(function(T){return S(T.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),E=Object(j.useCallback)(function(T){return S(function(C){return Object(b.a)(Object(b.a)({},C),{},{ch2:T.target.checked})})},[]);return Object(j.useEffect)(function(){if(f.current){f.current=!1;return}x(m)},[m,x]),Object(e.jsxs)(N.b,{children:[Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"present"}),children:Object(e.jsx)(Bt.a,{disabled:v,checked:m.ch1,onChange:O})}),Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:m.ch1?"not_exercising":"excused_absence"}),children:Object(e.jsx)(Bt.a,{disabled:v,checked:m.ch2,onChange:E})})]})},Ct=Ga,Ma=function(){var n=Object(q.b)(),a=n.teacherSubjectData,r=Object(j.useState)([]),t=Object(I.a)(r,2),c=t[0],l=t[1],d=Object(j.useState)(""),m=Object(I.a)(d,2),S=m[0],p=m[1],g=Object(s.l)(),v=Object(j.useRef)(),o=Object(j.useMemo)(function(){var x;return((x=a==null?void 0:a.groups)!==null&&x!==void 0?x:[]).map(function(O){var E=O.id,T=O.name;return{value:E,label:T}})},[a==null?void 0:a.groups]),f=Object(j.useMemo)(function(){var x;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:o,defaultValue:o==null||(x=o[0])===null||x===void 0?void 0:x.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object($e.a)(c))},[o,c]);return Object(e.jsx)(W.a,{className:"table-standalone",headerTitle:"".concat(g.formatMessage({id:"attendances",defaultMessage:"Attendances"})," (").concat(S,")"),request:function(){var x=Object(L.a)(Object(h.a)().mark(function O(E){var T,C,B,K,ue,Ie,P,$,D,k,Pe;return Object(h.a)().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return C=E.group_id,B=C===void 0?o==null||(T=o[0])===null||T===void 0?void 0:T.value:C,K=E.full_name,ue=K===void 0?"":K,te.next=3,Promise.all([Object(gt.b)(B),St(B)]);case 3:if(Ie=te.sent,P=Object(I.a)(Ie,2),$=P[0],D=P[1],k=o.find(function(ne){var H=ne.value;return H===B}),!(!$.success||!D.success||!k)){te.next=10;break}return te.abrupt("return",{data:[],total:0,success:!1});case 10:if(D.data.length){te.next=13;break}return dt.b.error(g.formatMessage({id:"noAttendanceSchedule",defaultMessage:"No attendance schedule for this group..."})),te.abrupt("return",{data:[],total:0,success:!1});case 13:return p(k.label),l(D.data.reduce(function(ne,H){return[].concat(Object($e.a)(ne),[{title:String(Object(Ne.a)(new Date(H.date_from),A.c)),dataIndex:String(H.date_from),hideInSearch:!0,width:100,align:"center",render:function(Be,ye){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:H.id,attendance:ye["".concat(H==null?void 0:H.date_from)],studentId:ye.id})}}])},[])),Pe=$.data.users.reduce(function(ne,H){var Se=H.id,Be=H.academic_teacher_id,ye=H.first_name,ze=H.last_name,Ze="".concat(ze," ").concat(ye);if(Be!==null||!Ze.toLowerCase().includes(ue.toLowerCase()))return ne;var ce=D.data.reduce(function(X,Z){var ee=Z.attendances.find(function(je){return je.user_id===Se});return ee?Object(b.a)(Object(b.a)({},X),{},Object(re.a)({},"".concat(Z.date_from),ee.value)):X},{});return[].concat(Object($e.a)(ne),[Object(b.a)({id:Se,full_name:Ze},ce)])},[]).sort(function(ne,H){return ne.full_name.localeCompare(H.full_name)}),te.abrupt("return",{data:Pe,total:Pe.length,success:!0});case 17:case"end":return te.stop()}},O)}));return function(O){return x.apply(this,arguments)}}(),columns:f,search:{layout:"vertical"},pagination:{defaultPageSize:me.a,onChange:function(){var O;return(O=v.current)===null||O===void 0?void 0:O.reload()}},scroll:{x:1500},actionRef:v,rowKey:"id"})},wr=i("tU7J"),Je=i("wFql"),Rr=i("/zsF"),Tt=i("PArb"),Ia=i("Hn4i"),Fa=i("bRQS");function Et(u,n,a){return Gt.apply(this,arguments)}function Gt(){return Gt=Object(L.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),Gt.apply(this,arguments)}function Da(u,n,a,r){return Mt.apply(this,arguments)}function Mt(){return Mt=Object(L.a)(Object(h.a)().mark(function u(n,a,r,t){return Object(h.a)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Object(s.i)("/api/admin/semester-subjects/".concat(n,"/tutors/").concat(a,"/grades"),Object(b.a)({method:"POST",data:r},t||{})));case 1:case"end":return l.stop()}},u)})),Mt.apply(this,arguments)}function Kt(u,n){return It.apply(this,arguments)}function It(){return It=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/lesson-group-users",Object(b.a)({method:"GET",params:{"groups[]":n},useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),It.apply(this,arguments)}function $a(u,n,a){return Ft.apply(this,arguments)}function Ft(){return Ft=Object(L.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/lesson-group-users/groups/".concat(n,"/users/").concat(a),Object(b.a)({method:"GET",useCache:!1},r||{})));case 1:case"end":return c.stop()}},u)})),Ft.apply(this,arguments)}function Wt(u){return Dt.apply(this,arguments)}function Dt(){return Dt=Object(L.a)(Object(h.a)().mark(function u(n){return Object(h.a)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Object(s.i)("/api/admin/grade-terms",Object(b.a)({method:"GET",useCache:!1},n||{})));case 1:case"end":return r.stop()}},u)})),Dt.apply(this,arguments)}function Vt(u,n){return $t.apply(this,arguments)}function $t(){return $t=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/grade-scales/".concat(n),Object(b.a)({method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),$t.apply(this,arguments)}function kt(u,n){return Pt.apply(this,arguments)}function Pt(){return Pt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades",Object(b.a)({method:"POST",data:n},a||{})));case 1:case"end":return t.stop()}},u)})),Pt.apply(this,arguments)}function zt(u,n,a){return At.apply(this,arguments)}function At(){return At=Object(L.a)(Object(h.a)().mark(function u(n,a,r){return Object(h.a)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"PATCH",data:a},r||{})));case 1:case"end":return c.stop()}},u)})),At.apply(this,arguments)}function Ht(u,n){return wt.apply(this,arguments)}function wt(){return wt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/final-grades/".concat(n),Object(b.a)({method:"DELETE"},a||{})));case 1:case"end":return t.stop()}},u)})),wt.apply(this,arguments)}var Pa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",editable:!1},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name",editable:!1},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})},{type:"number",min:0,max:100,message:Object(e.jsx)(s.a,{id:"number_between",values:{min:0,max:100}})}]}}],Aa=function(n){var a=n.subjectTutorGradeScale,r=n.onFormSubmit,t=Object(j.useState)([]),c=Object(I.a)(t,2),l=c[0],d=c[1],m=Object(j.useRef)(),S=J.a.useForm(),p=Object(I.a)(S,1),g=p[0];return Object(j.useEffect)(function(){var v,o=((v=a.scale)!==null&&v!==void 0?v:[]).map(function(f,x){return Object(b.a)(Object(b.a)({},f),{},{id:String((x+1)*100)})});g.setFieldValue("table",o)},[]),Object(e.jsx)(J.a,{form:g,onFinish:r,submitter:{render:function(o,f){var x=Object(I.a)(f,2),O=x[1];return[O]}},children:Object(e.jsx)(Ia.a,{name:"table",rowKey:"id",actionRef:m,formItemProps:{label:Object(e.jsx)(s.a,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(Pa,[{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(o,f){return Object(e.jsx)(ae.a,{type:"primary",onClick:function(){var O;return(O=m.current)===null||O===void 0?void 0:O.startEditable(f.id)},icon:Object(e.jsx)(nt.a,{})})}}]),editable:{form:g,type:"multiple",editableKeys:l,saveText:Object(e.jsx)(ae.a,{type:"primary",icon:Object(e.jsx)(Fa.a,{})}),onChange:d,actionRender:function(o,f,x){return[x.save]}}})})},wa=function(){var n,a,r=Object(s.m)("@@initialState"),t=r.initialState,c=Object(q.b)(),l=c.semester_subject_id,d=c.tutors,m=Object(j.useState)(),S=Object(I.a)(m,2),p=S[0],g=S[1],v=Object(j.useState)(!1),o=Object(I.a)(v,2),f=o[0],x=o[1],O=Object(j.useState)(null),E=Object(I.a)(O,2),T=E[0],C=E[1],B=Object(j.useMemo)(function(){return!!d.data.find(function(P){var $,D=P.id;return D===(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)})},[d.data,t==null||(n=t.currentUser)===null||n===void 0?void 0:n.id]),K=Object(j.useMemo)(function(){return d.data.map(function(P){var $=P.id,D=P.first_name,k=P.last_name;return{label:"".concat(D," ").concat(k),value:$}})},[d.data]),ue=Object(j.useCallback)(function(){l===null||T===null||(x(!0),g(void 0),Et(l,T).then(function(P){P.success&&g(P.data)}).finally(function(){x(!1)}))},[l,T]),Ie=Object(j.useCallback)(function(P,$){return function(){var D=Object(L.a)(Object(h.a)().mark(function k(Pe){var ke,te;return Object(h.a)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(l===null||T===null)){H.next=2;break}return H.abrupt("return");case 2:return ke=P.reduce(function(Se,Be){return Be.s_subject_scale_form_id===$?[].concat(Object($e.a)(Se),[{s_subject_scale_form_id:$,scale:Pe.table.map(function(ye){var ze=ye.name,Ze=ye.grade,ce=ye.grade_value;return{name:ze,grade:Ze,grade_value:ce}})}]):[].concat(Object($e.a)(Se),[Be])},[]),H.next=5,Da(l,T,{grade_scale:ke});case 5:te=H.sent,te.success&&ue();case 7:case"end":return H.stop()}},k)}));return function(k){return D.apply(this,arguments)}}()},[T,l]);return Object(j.useEffect)(function(){var P,$;if(!B||!(t!=null&&(P=t.currentUser)!==null&&P!==void 0&&P.id)){var D;if((D=d.data)!==null&&D!==void 0&&D[0]){var k;C((k=d.data)===null||k===void 0?void 0:k[0].id)}return}C(t==null||($=t.currentUser)===null||$===void 0?void 0:$.id)},[t==null||(a=t.currentUser)===null||a===void 0?void 0:a.id,B]),Object(j.useEffect)(function(){ue()},[ue]),d.loading?Object(e.jsx)(be.a,{}):Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(J.a.Item,{label:Object(e.jsx)(s.a,{id:"menu.Teacher"}),children:Object(e.jsx)(vt.a,{disabled:B,placeholder:Object(e.jsx)(s.a,{id:"select"}),options:K,value:T,onChange:function($){return C($)}})}),Object(e.jsx)(Tt.a,{}),f&&!p&&Object(e.jsx)(be.a,{}),p!=null&&p.grade_scale?p.grade_scale.map(function(P,$){var D;return Object(e.jsxs)(st.a.Fragment,{children:[$>0&&Object(e.jsx)(Tt.a,{}),Object(e.jsx)(Aa,{subjectTutorGradeScale:P,onFormSubmit:Ie((D=p.grade_scale)!==null&&D!==void 0?D:[],P.s_subject_scale_form_id)})]},P.s_subject_scale_form_id)}):Object(e.jsx)(Je.a.Paragraph,{style:{textAlign:"center"},children:Object(e.jsx)(s.a,{id:"gradesScalesMissing"})})]})},Lr=i("qbNl"),Ra=i("JBPa"),Nr=i("Awhp"),La=i("KrTs"),Na=i("wd/R"),Xe=i.n(Na);function Ua(u,n){return Rt.apply(this,arguments)}function Rt(){return Rt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(s.i)("/api/admin/schedules",Object(b.a)({params:n,method:"GET",useCache:!1},a||{})));case 1:case"end":return t.stop()}},u)})),Rt.apply(this,arguments)}var Ur=i("5R/X"),Ba=function(){var n=Object(j.useState)(null),a=Object(I.a)(n,2),r=a[0],t=a[1],c=Object(j.useState)([]),l=Object(I.a)(c,2),d=l[0],m=l[1],S=Object(q.b)(),p=S.semester_subject_id,g=Xe()(),v=Object(j.useMemo)(function(){return d.map(function(C){return{id:C.id,title:"".concat(C.group.name," (").concat(C.term_status.name,")"),start:Xe()(C.date_from).toDate(),end:Xe()(C.date_to).toDate(),tutor_name:"".concat(C.tutor.first_name," ").concat(C.tutor.last_name),tutor_email:C.tutor.email,semester:C.semester.name,group:C.group.name,subject:C.subject.name,ms_teams_join_url:C.ms_teams_join_url}})},[d]),o=Object(j.useCallback)(function(C,B){Ua({semester_subject_id:p,date_form:C.toDate(),date_to:B.toDate()}).then(function(K){K.success&&m(K.data)})},[p]),f=Object(j.useCallback)(function(C){t(C)},[]),x=Object(j.useCallback)(function(){t(null)},[]),O=Object(j.useCallback)(function(C){return C.isSame(g,"day")?"warning":C.isAfter(g,"day")?"success":"error"},[]),E=Object(j.useCallback)(function(C){var B=v.filter(function(K){return Xe()(K.start).isSame(C,"day")});return Object(e.jsx)("ul",{className:"events",children:B.map(function(K){return Object(e.jsx)("li",{onClick:function(){return f(K)},children:Object(e.jsx)(La.a,{status:O(Xe()(K.start)),text:K.title})},K.id)})})},[d]),T=Object(j.useCallback)(function(C,B){var K=Xe()(C).startOf(B).subtract(1,"month"),ue=Xe()(C).endOf(B).add(1,"month");o(K,ue)},[]);return Object(j.useEffect)(function(){var C=Xe()().startOf("month"),B=Xe()().endOf("month");o(C,B)},[]),Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Title,{level:4,children:Object(e.jsx)(s.a,{id:"schedule",defaultMessage:"Schedule"})}),Object(e.jsx)(Ra.a,{dateCellRender:E,onPanelChange:T}),Object(e.jsxs)(R.a,{open:r!==null,title:"".concat(r==null?void 0:r.subject,": ").concat(r==null?void 0:r.title),onCancel:x,footer:null,children:[Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"tutorName",defaultMessage:"Tutor"}),": ",r==null?void 0:r.tutor_name]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"email",defaultMessage:"Email"}),": ",r==null?void 0:r.tutor_email]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"group",defaultMessage:"Group"}),": ",r==null?void 0:r.group]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"semester",defaultMessage:"Semester"}),": ",r==null?void 0:r.semester]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"started_at",defaultMessage:"Start date"}),":",r&&Xe()(r.start).format(A.b)]}),Object(e.jsxs)(Je.a.Paragraph,{children:[Object(e.jsx)(s.a,{id:"end_at",defaultMessage:"End date"}),":",r&&Xe()(r.end).format(A.b)]}),(r==null?void 0:r.ms_teams_join_url)&&Object(e.jsx)(Je.a.Paragraph,{children:Object(e.jsx)("a",{href:r.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:Object(e.jsx)(ae.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"msTeams"})})},"teamsLink")})]})]})},Jt=i("yj/a"),Yt=i("5Syx"),pt=i("PpiC"),Lt=i("H6aw"),Ka=i("p3I6"),Wa=["results"],Xt=function(n,a){return n.reduce(function(r,t){var c=t.results,l=Object(pt.a)(t,Wa),d=c.find(function(m){return m.user_id===a});return d?[].concat(Object($e.a)(r),[Object(b.a)(Object(b.a)({},l),{},{result:d})]):r},[])},Zt=function(n,a){var r,t=n.reduce(function(o,f){var x=f.result,O=f.weight;return[o[0]+x.result*O,o[1]+O]},[0,0]),c=Object(I.a)(t,2),l=c[0],d=c[1],m=Number.isNaN(l/d)?0:l/d,S=a.sort(function(o,f){return o.grade_value-f.grade_value}).reduce(function(o,f){return[].concat(Object($e.a)(o),[Object(b.a)(Object(b.a)({},f),{},{isWeightedAverageGreater:m>=f.grade_value})])},[]);if(S.every(function(o){var f=o.isWeightedAverageGreater;return f})){var p,g;return(p=(g=S.at(-1))===null||g===void 0?void 0:g.name)!==null&&p!==void 0?p:""}var v=S.findIndex(function(o){var f=o.isWeightedAverageGreater;return!f});return v<0?"":(r=S[v-1])===null||r===void 0?void 0:r.name},Qt=function(n,a){var r;return(r=a.find(function(t){return t.s_subject_scale_form_id===n}))===null||r===void 0?void 0:r.scale},Va=["attendances"];function ka(u){return function(a){u(function(r){return Object(b.a)(Object(b.a)({},r),{},{loading:a})})}}function qt(u,n){return Nt.apply(this,arguments)}function Nt(){return Nt=Object(L.a)(Object(h.a)().mark(function u(n,a){return Object(h.a)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n(!0),t.prev=1,t.abrupt("return",a());case 3:return t.prev=3,n(!1),t.finish(3);case 6:case"end":return t.stop()}},u,null,[[1,,3,6]])})),Nt.apply(this,arguments)}function za(u,n){var a=Object(j.useState)({loading:!1}),r=Object(I.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(ka(c),[]),d=Object(j.useCallback)(Object(L.a)(Object(h.a)().mark(function S(){var p;return Object(h.a)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,$a(u,n);case 2:if(p=v.sent,p.success){v.next=5;break}return v.abrupt("return",p);case 5:return c(function(o){return Object(b.a)(Object(b.a)({},o),{},{data:p.data})}),v.abrupt("return",p);case 7:case"end":return v.stop()}},S)})),[n,u]),m=Object(j.useCallback)(function(S){return qt(l,function(){return Ht(S).then(d)})},[d]);return Object(j.useEffect)(function(){qt(l,d)},[d]),{finalGrades:t,deleteFinalGrade:m}}function Ha(){var u=Object(j.useState)({loading:!1}),n=Object(I.a)(u,2),a=n[0],r=n[1];return Object(j.useEffect)(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!0})}),Wt().then(function(t){t.success&&r(function(c){return Object(b.a)(Object(b.a)({},c),{},{data:t.data})})}).finally(function(){r(function(t){return Object(b.a)(Object(b.a)({},t),{},{loading:!1})})})},[]),{gradeTerms:a}}function Ja(u){var n=Object(j.useState)({loading:!1}),a=Object(I.a)(n,2),r=a[0],t=a[1];return Object(j.useEffect)(function(){u!==void 0&&(t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!0})}),Vt(u).then(function(c){c.success&&t(function(l){return Object(b.a)(Object(b.a)({},l),{},{data:c.data})})}).finally(function(){t(function(c){return Object(b.a)(Object(b.a)({},c),{},{loading:!1})})}))},[u]),{subjectGradeScales:r}}function Ya(u,n,a){var r=Object(j.useState)({loading:!1}),t=Object(I.a)(r,2),c=t[0],l=t[1];return Object(j.useEffect)(function(){typeof u!="number"||typeof n!="number"||typeof a!="number"||(l(function(d){return Object(b.a)(Object(b.a)({},d),{},{loading:!0})}),Et(u,n).then(function(d){d.success&&l(function(m){var S,p;return Object(b.a)(Object(b.a)({},m),{},{data:(S=Qt(a,(p=d.data.grade_scale)!==null&&p!==void 0?p:[]))===null||S===void 0?void 0:S.map(function(g,v){return Object(b.a)(Object(b.a)({},g),{},{id:v})})})})}).finally(function(){l(function(d){return Object(b.a)(Object(b.a)({},d),{},{loading:!1})})}))},[u,n]),{tutorGradeScales:c}}function Xa(u,n){var a=Object(j.useState)({loading:!1}),r=Object(I.a)(a,2),t=r[0],c=r[1],l=Object(j.useCallback)(function(){c(function(d){return Object(b.a)(Object(b.a)({},d),{},{loading:!0})}),St(u).then(function(d){if(d.success){var m=d.data.reduce(function(S,p){var g=p.attendances,v=Object(pt.a)(p,Va),o=g.find(function(f){return f.user_id===n});return o?[].concat(Object($e.a)(S),[Object(b.a)(Object(b.a)({},v),{},{attendance:o})]):S},[]);c(function(S){return Object(b.a)(Object(b.a)({},S),{},{data:m})})}}).finally(function(){c(function(d){return Object(b.a)(Object(b.a)({},d),{},{loading:!1})})})},[u,n]);return Object(j.useEffect)(function(){l()},[l]),{userAttendanceSchedules:t,fetchUserAttendanceSchedules:l}}function Za(u,n){var a=Object(j.useState)({loading:!1}),r=Object(I.a)(a,2),t=r[0],c=r[1];return Object(j.useEffect)(function(){!n||(c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!0})}),M({student_id:u,semester_subject_id:n}).then(function(l){if(l.success){var d=Xt(l.data,u);c(function(m){return Object(b.a)(Object(b.a)({},m),{},{data:d})})}}).finally(function(){c(function(l){return Object(b.a)(Object(b.a)({},l),{},{loading:!1})})}))},[u,n]),{studentExams:t}}function Qa(u,n){var a=Object(j.useState)({loading:!1}),r=Object(I.a)(a,2),t=r[0],c=r[1],l=Object(j.useState)({loading:!1}),d=Object(I.a)(l,2),m=d[0],S=d[1],p=Object(j.useState)({loading:!1}),g=Object(I.a)(p,2),v=g[0],o=g[1];return Object(j.useEffect)(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Object(Lt.e)({group_id:u}).then(function(f){f.success&&c(function(x){return Object(b.a)(Object(b.a)({},x),{},{data:f.data})})}).finally(function(){c(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})})},[u]),Object(j.useEffect)(function(){!t.data||(o(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Lt.n)(Number(x))})).then(function(f){f.forEach(function(x){x.success&&o(function(O){return Object(b.a)(Object(b.a)({},O),{},{data:Object(b.a)(Object(b.a)({},O.data),{},Object(re.a)({},Number(x.data.id),Object(Ka.c)(x.data.lessons)))})})})}).finally(function(){o(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}),S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!0})}),Promise.all(t.data.map(function(f){var x=f.id;return Object(Lt.l)(Number(x),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(O){if(O.success){var E,T,C=((E=O.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&E!==void 0?E:[]).filter(function(K){return K.id===n}),B=(T=O.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&T!==void 0?T:[];S(function(K){return Object(b.a)(Object(b.a)({},K),{},{data:Object(b.a)(Object(b.a)({},K.data),{},Object(re.a)({},Number(x),{finishedTopics:C,attendanceList:B}))})})}})})).finally(function(){return S(function(f){return Object(b.a)(Object(b.a)({},f),{},{loading:!1})})}))},[t.data,n]),{userCourses:t,userCoursesStats:m,userCoursesTopics:v}}var qa=[{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade"},{title:Object(e.jsx)(s.a,{id:"degree"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],er=[{title:Object(e.jsx)(s.a,{id:"date"}),dataIndex:"date_from",render:function(n,a){return Object(Ne.a)(new Date(a.date_from),A.c)}}],tr=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"title"},{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:Object(e.jsx)(s.a,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(n,a){return Object(Ne.a)(new Date(a.created_at),A.c)}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"result",render:function(n,a){return"".concat(a.result.result,"%")}}],ar=[{title:Object(e.jsx)(s.a,{id:"name"}),dataIndex:"name"},{title:Object(e.jsx)(s.a,{id:"issued_at"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=a.grade)!==null&&r!==void 0&&r.grade_date?Object(Ne.a)(new Date((t=a.grade)===null||t===void 0?void 0:t.grade_date),A.c):"-"}},{title:Object(e.jsx)(s.a,{id:"grade"}),dataIndex:"grade",render:function(n,a){var r,t;return(r=(t=a.grade)===null||t===void 0?void 0:t.grade_name)!==null&&r!==void 0?r:"-"}}],ht=6,rr=function(n){var a,r,t,c,l=n.user_id,d=n.group_id,m=Object(q.b)(),S=m.semester_subject_id,p=Za(l,S),g=p.studentExams,v=za(d,l),o=v.finalGrades,f=v.deleteFinalGrade,x=Ha(),O=x.gradeTerms,E=Ja((a=o.data)===null||a===void 0?void 0:a.s_subject_scale_form_id),T=E.subjectGradeScales,C=Ya(S,(r=o.data)===null||r===void 0?void 0:r.tutor_id,(t=o.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),B=C.tutorGradeScales,K=Xa(d,l),ue=K.userAttendanceSchedules,Ie=K.fetchUserAttendanceSchedules,P=Qa(d,l),$=P.userCourses,D=P.userCoursesStats,k=P.userCoursesTopics,Pe=J.a.useForm(),ke=Object(I.a)(Pe,1),te=ke[0],ne=Object(j.useMemo)(function(){var X;return((X=O.data)!==null&&X!==void 0?X:[]).map(function(Z){var ee=Z.id,je=Z.name;return{label:je,value:ee}})},[O.data]),H=Object(j.useMemo)(function(){var X;return((X=T.data)!==null&&X!==void 0?X:[]).map(function(Z){var ee=Z.name,je=Z.id;return{label:ee,value:je}})},[T.data]),Se=Object(j.useMemo)(function(){var X,Z;return Zt((X=g.data)!==null&&X!==void 0?X:[],(Z=B.data)!==null&&Z!==void 0?Z:[])},[g.data,B.data]),Be=Object(j.useCallback)(function(){var X=Object(L.a)(Object(h.a)().mark(function Z(ee){var je,Ke,rt,he,We,Fe,Ve;return Object(h.a)().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:if(rt=ee.grade_scale_id,he=ee.grade_term_id,((je=o.data)===null||je===void 0?void 0:je.id)!==void 0){Re.next=3;break}return Re.abrupt("return");case 3:if(We=(Ke=o.data)===null||Ke===void 0?void 0:Ke.grades.find(function(ot){var Ut=ot.grade_term;return Ut.id===he}),!We){Re.next=11;break}return Re.next=7,zt(We.id,{grade_scale_id:rt});case 7:return Fe=Re.sent,dt.b[Fe.success?"success":"error"](Fe.message),Fe.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades")),Re.abrupt("return");case 11:return Re.next=13,kt({grade_scale_id:rt,grade_term_id:he,lesson_group_user_id:o.data.id});case 13:Ve=Re.sent,dt.b[Ve.success?"success":"error"](Ve.message),Ve.success&&s.f.push("/teacher/subjects/".concat(S,"/final-grades"));case 16:case"end":return Re.stop()}},Z)}));return function(Z){return X.apply(this,arguments)}}(),[o.data,S]),ye=Object(j.useMemo)(function(){return[].concat(ar,[{title:Object(e.jsx)(s.a,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Z,ee){var je;return typeof(ee==null||(je=ee.grade)===null||je===void 0?void 0:je.id)=="number"?[Object(e.jsx)(ut.a,{title:Object(e.jsx)(s.a,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return f(ee.grade.id)},okText:Object(e.jsx)(s.a,{id:"yes",defaultMessage:"Yes"}),cancelText:Object(e.jsx)(s.a,{id:"no",defaultMessage:"No"}),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"delete",defaultMessage:"delete"}),children:Object(e.jsx)(ae.a,{type:"primary",icon:Object(e.jsx)(de.a,{}),danger:!0})})},"delete")]:[]}}])},[]),ze=Object(j.useMemo)(function(){var X;return((X=O.data)!==null&&X!==void 0?X:[]).map(function(Z){var ee;return Object(b.a)(Object(b.a)({},Z),{},{grade:(ee=o.data)===null||ee===void 0?void 0:ee.grades.find(function(je){var Ke=je.grade_term;return Ke.id===Z.id})})})},[o.data,O.data]),Ze=$.loading&&!$.data||D.loading&&!D.data||k.loading&&!k.data,ce=Boolean($.data&&D.data&&k.data);return o.loading?Object(e.jsx)(be.a,{}):Object(e.jsxs)(e.Fragment,{children:[o.data&&Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Student",values:o.data.user})}),Object(e.jsx)(Tt.a,{})]}),Object(e.jsxs)(Ee.a,{gutter:[48,48],justify:"space-between",children:[Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:ht},dataSource:g.data,loading:g.loading,columns:tr,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:ht},dataSource:ze,loading:o.loading||O.loading,columns:ye,options:!1,cardProps:{bodyStyle:{padding:0}}})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:ht},cardProps:{bodyStyle:{padding:0}},dataSource:ue.data,loading:ue.loading,columns:[].concat(er,[{title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Z,ee){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:ee.id,studentId:l,attendance:ee.attendance.value,onSuccess:Ie})}}])})}),Object(e.jsx)(Y.a,{span:12,children:Object(e.jsx)(W.a,{rowKey:"id",headerTitle:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:ht},cardProps:{bodyStyle:{padding:0}},dataSource:B.data,loading:B.loading,columns:qa})}),Ze&&Object(e.jsx)(be.a,{}),ce&&((c=$.data)===null||c===void 0?void 0:c.map(function(X){var Z,ee,je,Ke,rt,he,We,Fe,Ve=X.id,lt=X.title;return Object(e.jsxs)(Y.a,{span:24,children:[Object(e.jsx)(Je.a.Text,{style:{fontSize:"16px",fontWeight:500},children:lt}),Object(e.jsx)(Yt.c,{course_id:Number(Ve),topics:(Z=(ee=k.data)===null||ee===void 0?void 0:ee[Number(Ve)])!==null&&Z!==void 0?Z:[],stats:(je=(Ke=D.data)===null||Ke===void 0||(rt=Ke[Number(Ve)])===null||rt===void 0?void 0:rt.finishedTopics)!==null&&je!==void 0?je:[]}),Object(e.jsx)(Yt.a,{stats:(he=(We=D.data)===null||We===void 0||(Fe=We[Number(Ve)])===null||Fe===void 0?void 0:Fe.attendanceList)!==null&&he!==void 0?he:[]})]},Ve)}))]}),Object(e.jsx)(J.a,{form:te,onFinish:Be,children:Object(e.jsxs)(J.a.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[Object(e.jsx)(Jt.a,{name:"grade_term_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:ne,width:"sm",fieldProps:{loading:O.loading}}),Object(e.jsx)(Jt.a,{name:"grade_scale_id",rules:[{required:!0,message:Object(e.jsx)(s.a,{id:"field_required"})}],label:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:H,fieldProps:{loading:o.loading||T.loading}}),Object(e.jsx)(J.a.Item,{children:Object(e.jsx)(s.a,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Se}})})]})})]})},nr=[{title:Object(e.jsx)(s.a,{id:"first_name"}),dataIndex:"first_name",render:function(n,a){return a.user.first_name}},{title:Object(e.jsx)(s.a,{id:"last_name"}),dataIndex:"last_name",render:function(n,a){return a.user.last_name}},{title:Object(e.jsx)(s.a,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(n,a){return Object(e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:a.grades.length?a.grades.map(function(r){var t=r.grade_name,c=r.grade_term,l=r.id;return Object(e.jsxs)(Je.a.Text,{children:[c.name,": ",t]},l)}):"-"})}}],sr=function(){var n,a,r=Object(ie.k)(),t=Object(j.useMemo)(function(){var g,v,o,f;return{user_id:Number.isNaN(Number((g=r.query)===null||g===void 0?void 0:g.user_id))?null:Number((v=r.query)===null||v===void 0?void 0:v.user_id),group_id:Number.isNaN(Number((o=r.query)===null||o===void 0?void 0:o.group_id))?null:Number((f=r.query)===null||f===void 0?void 0:f.group_id)}},[(n=r.query)===null||n===void 0?void 0:n.user_id,(a=r.query)===null||a===void 0?void 0:a.group_id]),c=t.user_id,l=t.group_id,d=Object(q.b)(),m=d.teacherSubjectData,S=d.semester_subject_id,p=Object(j.useMemo)(function(){var g;return((g=m==null?void 0:m.groups)!==null&&g!==void 0?g:[]).map(function(v){var o=v.id,f=v.name;return{label:f,value:o}})},[m==null?void 0:m.groups]);return c!==null&&l!==null?Object(e.jsx)(rr,{user_id:c,group_id:l}):Object(e.jsx)(W.a,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:me.a},request:function(){var g=Object(L.a)(Object(h.a)().mark(function v(o){var f,x,O,E,T,C,B,K,ue,Ie;return Object(h.a)().wrap(function($){for(;;)switch($.prev=$.next){case 0:return x=o.group_id,O=x===void 0?[]:x,E=o.first_name,T=E===void 0?"":E,C=o.last_name,B=C===void 0?"":C,K=((f=m==null?void 0:m.groups)!==null&&f!==void 0?f:[]).map(function(D){var k=D.id;return k}),$.next=4,Kt(O.length===0?K:O);case 4:if(ue=$.sent,ue.success){$.next=7;break}return $.abrupt("return",{success:!1,total:0,data:[]});case 7:return Ie=ue.data.filter(function(D){var k=D.user;return k.first_name.toLowerCase().includes(T.toLowerCase())&&k.last_name.toLowerCase().includes(B.toLowerCase())}),$.abrupt("return",{success:!0,total:Ie.length,data:Ie});case 9:case"end":return $.stop()}},v)}));return function(v){return g.apply(this,arguments)}}(),columns:[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:p,mode:"multiple"},render:function(v,o){return Object(e.jsx)(le.a,{type:"Students",type_id:o.group_id},o.group_id)}}].concat(nr,[{title:Object(e.jsx)(s.a,{id:"options"}),hideInSearch:!0,render:function(v,o){return[Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(S,"/final-grades?user_id=").concat(o.user.id,"&group_id=").concat(o.group_id),children:Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"edit"}),children:Object(e.jsx)(ae.a,{type:"primary",icon:Object(e.jsx)(nt.a,{})})})},"edit")]}}])})},ur=i("dF/Y"),cr=i("o+0V"),ea=i("0WSk"),ir=["type","defaultRender"],dr=["type","defaultRender"],lr=function(n){var a=n.url;return Object(e.jsx)(Le.a,{title:Object(e.jsx)(s.a,{id:"download"}),children:Object(e.jsx)(ae.a,{type:"primary",onClick:function(){window.open(a,"_blank","noopener noreferrer")},icon:Object(e.jsx)(ur.a,{})})})},or=[{title:Object(e.jsx)(s.a,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(n,a){return Object(Ne.a)(new Date(a.created_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(pt.a)(a,ir);if(t==="form")return null;var d=r.getFieldValue("state");return Object(e.jsx)(ea.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:d}}))},render:function(n,a){var r,t;return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.created_by.id,text:a!=null&&(r=a.created_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.created_by)!==null&&t!==void 0&&t.last_name?"".concat(a.created_by.first_name," ").concat(a.created_by.last_name):void 0},a.created_by.id)}},{title:Object(e.jsx)(s.a,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(n,a){return Object(Ne.a)(new Date(a.exported_at),A.a)}},{title:Object(e.jsx)(s.a,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(n,a,r){var t=a.type,c=a.defaultRender,l=Object(pt.a)(a,dr);if(t==="form")return null;var d=r.getFieldValue("state");return Object(e.jsx)(ea.a,Object(b.a)(Object(b.a)({},l),{},{state:{type:d}}))},render:function(n,a){var r,t;return Object(e.jsx)(le.a,{type:"EscolaLms\\Core\\Models\\User",type_id:a.exported_by.id,text:a!=null&&(r=a.exported_by)!==null&&r!==void 0&&r.first_name&&a!==null&&a!==void 0&&(t=a.exported_by)!==null&&t!==void 0&&t.last_name?"".concat(a.exported_by.first_name," ").concat(a.exported_by.last_name):void 0},a.exported_by.id)}},{title:Object(e.jsx)(s.a,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:Object(e.jsx)(s.a,{id:"options"}),valueType:"option",render:function(n,a){return[Object(e.jsx)(lr,{url:a.url},"download")]}}],jr=function(){var n,a,r=Object(q.b)(),t=r.teacherSubjectData,c=Object(j.useMemo)(function(){var d;return((d=t==null?void 0:t.groups)!==null&&d!==void 0?d:[]).map(function(m){var S=m.id,p=m.name;return{value:S,label:p}})},[t==null?void 0:t.groups]),l=Object(j.useMemo)(function(){var d,m;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:c,defaultValue:t==null||(d=t.groups)===null||d===void 0||(m=d[0])===null||m===void 0?void 0:m.id,allowClear:!1}}].concat(or)},[t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.id,c]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var d=Object(L.a)(Object(h.a)().mark(function m(S){var p,g,v,o,f,x,O;return Object(h.a)().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return v=S.group_id,o=v===void 0?t==null||(p=t.groups)===null||p===void 0||(g=p[0])===null||g===void 0?void 0:g.id:v,f=S.created_by,x=S.exported_by,T.next=3,Object(cr.a)({group_id:o,created_by:f,exported_by:x});case 3:if(O=T.sent,O.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:O.data,total:O.data.length});case 7:case"end":return T.stop()}},m)}));return function(m){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:me.a}})},br=function(n,a){var r;return(r=n.find(function(t){return t.name===a}))===null||r===void 0?void 0:r.id},mr=function(n){var a=n.term,r=n.gradeScales,t=n.defaultFinalGrade,c=n.finalGrades,l=Object(j.useState)(t),d=Object(I.a)(l,2),m=d[0],S=d[1],p=Object(j.useState)(!1),g=Object(I.a)(p,2),v=g[0],o=g[1],f=Object(j.useMemo)(function(){return r.map(function(O){var E=O.name,T=O.id;return{value:T,label:E}})},[r]),x=Object(j.useCallback)(function(O){if(!!(c!=null&&c.id)){if(O===void 0){if(!m)return;o(!0),Ht(m.id).then(function(E){!E.success||S(void 0)}).finally(function(){return o(!1)});return}if(m){o(!0),zt(m.id,{grade_scale_id:O}).finally(function(){return o(!1)});return}o(!0),kt({grade_term_id:a.id,grade_scale_id:O,lesson_group_user_id:c.id}).then(function(E){if(E.success){var T=E.data.grades.find(function(C){return C.grade_term.id===a.id});S(T)}}).finally(function(){return o(!1)})}},[m,a.id,c==null?void 0:c.id]);return c?Object(e.jsx)(vt.a,{allowClear:!0,loading:v,disabled:v,placeholder:Object(e.jsx)(s.a,{id:"select_final_grade"}),style:{width:"100%"},onChange:x,options:f,defaultValue:br(r,t==null?void 0:t.grade_name)}):null},fr=i("LvDl"),vr=function(n){var a=n.exam_id,r=n.result,t=n.student_id,c=n.onSuccess,l=Object(j.useCallback)(Object(fr.debounce)(function(d){at(a,t,{result:d!=null?d:0}).then(function(m){m.success&&(c==null||c(m.data))})},300),[a,r,t]);return Object(e.jsx)(fe.a,{type:"number",min:0,max:100,onChange:l,defaultValue:r})},Or=function(n){var a=n.reduce(function(r,t){return[].concat(Object($e.a)(r),[{title:Object(Ne.a)(new Date(t.date_from),A.c),dataIndex:"attendance-".concat(t.date_from),hideInSearch:!0,width:100,align:"center",render:function(l,d){return Object(e.jsx)(Ct,{groupAttendanceScheduleId:t.id,attendance:d["attendance-".concat(t==null?void 0:t.date_from)],studentId:d.id})}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},pr=function(n,a){return n.reduce(function(r,t){var c=t.attendances.find(function(l){return l.user_id===a});return c?Object(b.a)(Object(b.a)({},r),{},Object(re.a)({},"attendance-".concat(t.date_from),c.value)):r},{})},hr=function(n){var a=n.reduce(function(r,t){return[].concat(Object($e.a)(r),[{dataIndex:"exam-".concat(t.id),title:Object(e.jsx)(s.a,{id:"examTitleWithWeight",values:t}),hideInSearch:!0,width:100,render:function(l,d){var m;return(d==null||(m=d["exam-".concat(t.id)])===null||m===void 0?void 0:m.result)!==void 0?Object(e.jsx)(vr,{result:d==null?void 0:d["exam-".concat(t.id)].result,exam_id:t.id,student_id:d.id}):"-"}}])},[]);return a.length?{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,children:a}:{title:Object(e.jsx)(s.a,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},gr=function(n){return n.reduce(function(a,r){var t=r.result,c=r.id;return Object(b.a)(Object(b.a)({},a),{},Object(re.a)({},"exam-".concat(c),t))},{})},xr=function(n,a){return{title:Object(e.jsx)(s.a,{id:"final-grades"}),hideInSearch:!0,children:n.map(function(r){return{title:r.name,hideInSearch:!0,width:100,align:"center",render:function(c,l){var d;return Object(e.jsx)(mr,{defaultFinalGrade:l["final-grade-".concat(r.id)],finalGrades:l.final_grades,term:r,gradeScales:a},"".concat(l==null||(d=l.final_grades)===null||d===void 0?void 0:d.group_id,"-").concat(r.id))}}})}},Sr=function(n,a){return n.find(function(r){return r.user.id===a})},yr=function(n){var a;return((a=n==null?void 0:n.grades)!==null&&a!==void 0?a:[]).reduce(function(r,t){return Object(b.a)(Object(b.a)({},r),{},Object(re.a)({},"final-grade-".concat(t.grade_term.id),t))},{})},_r=function(){var n,a,r=Object(q.b)(),t=r.teacherSubjectData,c=r.semester_subject_id,l=Object(j.useState)([]),d=Object(I.a)(l,2),m=d[0],S=d[1],p=Object(j.useState)(t==null||(n=t.groups)===null||n===void 0||(a=n[0])===null||a===void 0?void 0:a.name),g=Object(I.a)(p,2),v=g[0],o=g[1],f=Object(s.l)(),x=Object(j.useMemo)(function(){var T;return((T=t==null?void 0:t.groups)!==null&&T!==void 0?T:[]).map(function(C){var B=C.id,K=C.name;return{value:B,label:K}})},[t==null?void 0:t.groups]),O=Object(j.useRef)(),E=Object(j.useMemo)(function(){var T;return[{title:Object(e.jsx)(s.a,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:x,defaultValue:x==null||(T=x[0])===null||T===void 0?void 0:T.value,allowClear:!1}},{title:Object(e.jsx)(s.a,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Object($e.a)(m))},[x,m]);return Object(e.jsx)(W.a,{className:"table-standalone",request:function(){var T=Object(L.a)(Object(h.a)().mark(function C(B){var K,ue,Ie,P,$,D,k,Pe,ke,te,ne,H,Se,Be,ye,ze,Ze,ce,X,Z,ee,je,Ke;return Object(h.a)().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return D=B.group_id,k=D===void 0?(K=x[0])===null||K===void 0?void 0:K.value:D,Pe=B.full_name,ke=Pe===void 0?"":Pe,he.next=3,Kt(k);case 3:if(te=he.sent,ne=x.find(function(We){var Fe=We.value;return Fe===k}),!(!te.success||te.data[0]===void 0||c===null)){he.next=8;break}return dt.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ne==null?void 0:ne.label})),he.abrupt("return",{data:[],total:0,success:!1});case 8:return he.next=10,Promise.all([Object(gt.b)(k),St(k),M({group_id:k,per_page:-1}),Et(c,(ue=te.data)===null||ue===void 0||(Ie=ue[0])===null||Ie===void 0?void 0:Ie.tutor_id),Wt(),Vt((P=te.data)===null||P===void 0||($=P[0])===null||$===void 0?void 0:$.s_subject_scale_form_id)]);case 10:if(H=he.sent,Se=Object(I.a)(H,6),Be=Se[0],ye=Se[1],ze=Se[2],Ze=Se[3],ce=Se[4],X=Se[5],!(!Be.success||!ye.success||!ze.success||!Ze.success||!ce.success||!X.success||!ne)){he.next=21;break}return dt.b.error(f.formatMessage({id:"groupDataMissing"},{group_name:ne==null?void 0:ne.label})),he.abrupt("return",{data:[],total:0,success:!1});case 21:return o(ne.label),Z=Or(ye.data),ee=hr(ze.data),je=xr(ce.data,X.data),S([Z,ee,je,{title:Object(e.jsx)(s.a,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Ke=Be.data.users.reduce(function(We,Fe){var Ve,lt,Re,ot=Fe.id,Ut=Fe.academic_teacher_id,Tr=Fe.first_name,Er=Fe.last_name,ta="".concat(Er," ").concat(Tr);if(Ut!==null||!ta.toLowerCase().includes(ke.toLowerCase()))return We;var Gr=pr(ye.data,ot),aa=Xt(ze.data,ot),bt=Sr(te.data,ot),Mr=(Ve=Qt((lt=bt==null?void 0:bt.s_subject_scale_form_id)!==null&&lt!==void 0?lt:0,(Re=Ze.data.grade_scale)!==null&&Re!==void 0?Re:[]))!==null&&Ve!==void 0?Ve:[],Ir=Zt(aa,Mr),Fr=gr(aa),Dr=yr(bt);return[].concat(Object($e.a)(We),[Object(b.a)(Object(b.a)(Object(b.a)(Object(b.a)({id:ot,full_name:ta},Gr),Fr),Dr),{},{proposed_grade:Ir,final_grades:bt})])},[]).sort(function(We,Fe){return We.full_name.localeCompare(Fe.full_name)}),he.abrupt("return",{data:Ke,total:Ke.length,success:!0});case 28:case"end":return he.stop()}},C)}));return function(C){return T.apply(this,arguments)}}(),columns:E,headerTitle:Object(e.jsx)(s.a,{id:"classRegisterTitleWithGroupName",values:{groupName:v}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:O,pagination:{defaultPageSize:me.a,onChange:function(){var C;return(C=O.current)===null||C===void 0?void 0:C.reload()}},rowKey:"id"})},Cr=function(n){var a,r,t=n.tab,c=Object(s.l)(),l=Object(s.m)("@@initialState"),d=l.setInitialState,m=l.initialState,S=Object(q.b)(),p=S.teacherSubjectData,g=S.semester_subject_id,v=S.tutors,o=Object(j.useCallback)(Object(Ge.a)(m==null?void 0:m.currentUser),[m==null?void 0:m.currentUser]),f=Object(j.useMemo)(function(){return!!v.data.find(function(x){var O,E=x.id;return E===(m==null||(O=m.currentUser)===null||O===void 0?void 0:O.id)})||o(Ye.a.TeacherListGradeScale)},[]);return p?Object(e.jsx)(ge.a,{title:Object(e.jsxs)(e.Fragment,{children:[Object(e.jsx)(s.a,{id:p==null||(a=p.subject)===null||a===void 0?void 0:a.name}),", ",Object(e.jsx)(s.a,{id:t})]}),tabBarExtraContent:Object(e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:Object(e.jsx)(Qe.a,{to:"/teacher/subjects/".concat(g,"/exams?exam_id=new"),children:Object(e.jsx)(ae.a,{type:"primary",children:Object(e.jsx)(s.a,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:c.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:c.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(g),breadcrumbName:String((r=p.subject)===null||r===void 0?void 0:r.name)},{path:String(t),breadcrumbName:c.formatMessage({id:t,defaultMessage:String(t)})}]}},children:Object(e.jsxs)(oe.a,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:t,onChange:function(O){d(Object(b.a)({},m)),s.f.push("/teacher/subjects/".concat(g,"/").concat(O))}},children:[Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"groups"}),children:Object(e.jsx)(_e.a,{})},"groups"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"students"}),children:Object(e.jsx)(_a,{})},"students"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"exams"}),children:Object(e.jsx)(Oa,{})},"exams"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"schedule"}),children:Object(e.jsx)(Ba,{})},"schedule"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"class-register"}),children:Object(e.jsx)(_r,{})},"class-register"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"attendance"}),children:Object(e.jsx)(Ma,{})},"attendance"),f&&Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"grades-scale"}),children:Object(e.jsx)(wa,{})},"grades-scale"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"final-grades"}),children:Object(e.jsx)(sr,{})},"final-grades"),Object(e.jsx)(oe.a.TabPane,{tab:Object(e.jsx)(s.a,{id:"file-exports-history"}),children:Object(e.jsx)(jr,{})},"file-exports-history")]})}):Object(e.jsx)(be.a,{})},Br=Ae.default=function(){var u=Object(ie.l)(),n=u.subjectId,a=u.tab,r=a===void 0?"groups":a;return Object(e.jsx)(q.a,{semester_subject_id:Number(n),children:Object(e.jsx)(Cr,{tab:r})})}},p3I6:function(mt,Ae,i){"use strict";i.d(Ae,"b",function(){return Ge}),i.d(Ae,"c",function(){return we}),i.d(Ae,"a",function(){return ct});var b=i("miYZ"),De=i("tsqr"),ae=i("tJVT"),F=i("k1fw"),be=i("oBTY"),j=i("q1tI"),st=i.n(j),s=i("9kvl"),Qe=i("Ty5D"),ie=i("H6aw"),oe=i("/y+f"),ge=i("nKUr"),Ye=i.n(ge),Ge=st.a.createContext({}),q=function(){return Math.round(Math.random()*99999)},_e=function de(W){return W.reduce(function(A,M){return[].concat(Object(be.a)(A),Object(be.a)(M.lessons?de(M.lessons):[]),[M])},[])},we=function de(W){return W.reduce(function(A,M){var z;return[].concat(Object(be.a)(A),Object(be.a)(M.lessons?de(M.lessons):[]),Object(be.a)((z=M.topics)!==null&&z!==void 0?z:[]))},[])},ut=function de(W,A,M){return W.map(function(z){var Ce,y;return Object(F.a)(Object(F.a)({},z),{},{lessons:z.lessons?de(z.lessons,A,M):[],topics:z.id===A?[].concat(Object(be.a)((Ce=z.topics)!==null&&Ce!==void 0?Ce:[]),[M]):(y=z.topics)!==null&&y!==void 0?y:[]})})},ft=function de(W,A,M){return M?W.map(function(z){return Object(F.a)(Object(F.a)({},z),{},{lessons:[].concat(Object(be.a)(z.lessons?de(z.lessons,A,M):[]),Object(be.a)(z.id===M?[A]:[]))})}):[].concat(Object(be.a)(W),[A])},Le=function de(W,A,M){return W.map(function(z){return Object(F.a)(Object(F.a)({},z.id===A?M:z),{},{lessons:z.lessons?de(z.lessons,A,M):[]})})},h=function de(W,A){return W.map(function(M){return Object(F.a)(Object(F.a)({},M),{},{parent_id:A,lessons:M.lessons?de(M.lessons,M.id):[]})})},L=function de(W,A){return W.filter(function(M){return M.id!==A}).map(function(M){return Object(F.a)(Object(F.a)({},M),{},{lessons:M.lessons?de(M.lessons,A):[]})})},Ne=function de(W,A){return W.map(function(M){return Object(F.a)(Object(F.a)({},M),{},{lessons:M.lessons?de(M.lessons,A):[],topics:M.topics?M.topics.filter(function(z){return z.id!==A}):[]})})},nt=function de(W,A,M,z){return z==null?void 0:z.map(function(Ce){if(Ce.id===M){var y;return Object(F.a)(Object(F.a)({},Ce),{},{topics:(y=Ce.topics)===null||y===void 0?void 0:y.map(function(Te){return Te.id===W?A.file.response.data:Te})})}else if(Ce.lessons)return Object(F.a)(Object(F.a)({},Ce),{},{lessons:de(W,A,M,Ce.lessons||[])});return Ce})},ct=function(W){var A=W.children,M=W.id,z=Object(j.useState)(),Ce=Object(ae.a)(z,2),y=Ce[0],Te=Ce[1],et=Object(s.l)(),qe=Object(j.useMemo)(function(){return y&&y.lessons?we(y.lessons):[]},[y]),Ue=Object(j.useMemo)(function(){return y&&y.lessons?_e(y.lessons):[]},[y]),jt=Object(j.useState)([]),tt=Object(ae.a)(jt,2),at=tt[0],ve=tt[1],Oe=Object(Qe.k)();Object(j.useEffect)(function(){ve([])},[]);var se=Object(j.useCallback)(function(){Object(ie.n)(M).then(function(_){return _.success&&Te(Object(F.a)(Object(F.a)({},_.data),{},{lessons:h(_.data.lessons)}))})},[M]);Object(j.useEffect)(function(){se()},[se]);var le=Object(j.useCallback)(function(_){var U=Ue.find(function(R){var w;return R==null||(w=R.topics)===null||w===void 0?void 0:w.find(function(N){return N.id===_})});return U?U.id:null},[Ue]),me=Object(j.useMemo)(function(){var _,U;return(_=Oe.query)!==null&&_!==void 0&&_.lesson?{mode:"lesson",id:Number(Oe.query.lesson),value:Ue.find(function(R){return R.id===Number(Oe.query.lesson)})}:(U=Oe.query)!==null&&U!==void 0&&U.topic?{mode:"topic",id:Number(Oe.query.topic),value:qe.find(function(R){return R.id===Number(Oe.query.topic)})}:{mode:"init"}},[Oe.query,y,Ue,qe]),Me=Object(j.useCallback)(function(_){var U={course_id:M,topics:[],isNew:!0,id:y?y.lessons.length+1:q(),order:0,title:et.formatMessage({id:"add_title_here"}),active:!0,parent_id:_};return Te(function(R){var w;return Object(F.a)(Object(F.a)({},R),{},{lessons:ft((w=R==null?void 0:R.lessons)!==null&&w!==void 0?w:[],U,_)})}),U},[M,y]),fe=Object(j.useCallback)(function(_,U){var R=Ue.find(function(N){return N.id===_}),w=R&&R.isNew;return(w?Object(ie.g)(U):Object(ie.v)(_,U)).then(function(N){return De.b.success(N.message),se(),N.success&&Te(function(V){var xe;return Object(F.a)(Object(F.a)({},V),{},{lessons:Le((xe=V==null?void 0:V.lessons)!==null&&xe!==void 0?xe:[],_,Object(F.a)(Object(F.a)({},N.data),{},{isNew:!1}))})})})},[y]),I=Object(j.useCallback)(function(_){var U=Ue.find(function(w){return w.id===_});if(!!U){var R=U.isNew;R?Te(function(w){var N;return Object(F.a)(Object(F.a)({},w),{},{lessons:L((N=w==null?void 0:w.lessons)!==null&&N!==void 0?N:[],_)})}):Object(ie.p)(_).then(function(w){w.success&&(De.b.success(w.message),Te(function(N){var V;return Object(F.a)(Object(F.a)({},N),{},{lessons:L((V=N==null?void 0:N.lessons)!==null&&V!==void 0?V:[],_)})}))})}},[y]),He=Object(j.useCallback)(function(_,U){var R,w=le(_),N=Ue.find(function(re){return re.id===w}),V=N&&((R=N.topics)===null||R===void 0?void 0:R.find(function(re){return re.id===_})),xe=V==null?void 0:V.isNew;return(xe?Object(ie.h)(U):Object(ie.w)(_,U)).then(function(re){re.success&&(De.b.success(re.message),se(),s.f.push("/courses/list/".concat(M,"/program/?topic=").concat(re.data.id)),(V==null?void 0:V.topicable_type)===oe.k.Video&&setTimeout(function(){se()},5e3))})},[le,y,se]),Ee=Object(j.useCallback)(function(_){var U=le(_),R=Ue.find(function(V){return V.id===U});if(!!R){var w=qe==null?void 0:qe.find(function(V){return V.id===_}),N=w==null?void 0:w.isNew;N&&!w.topicable?Te(function(V){var xe;return Object(F.a)(Object(F.a)({},V),{},{lessons:Ne((xe=V==null?void 0:V.lessons)!==null&&xe!==void 0?xe:[],_)})}):Object(ie.q)(_).then(function(V){V.success&&(De.b.success(V.message),Te(function(xe){var re;return Object(F.a)(Object(F.a)({},xe),{},{lessons:Ne((re=xe==null?void 0:xe.lessons)!==null&&re!==void 0?re:[],_)})}))})}},[y,le]),pe=Object(j.useCallback)(function(_,U){var R={lesson_id:_,isNew:!0,id:q(),title:et.formatMessage({id:"add_title_here"}),active:!0,topicable_type:U};return Te(function(w){var N;return Object(F.a)(Object(F.a)({},w),{},{lessons:ut((N=w==null?void 0:w.lessons)!==null&&N!==void 0?N:[],_,R)})}),R},[]),Y=function(U,R){var w=le(U);Te(function(N){return Object(F.a)(Object(F.a)({},N),{},{lessons:N?nt(U,R,w,N.lessons||[]):[]})}),s.f.push("/courses/list/".concat(M,"/program/?topic=").concat(R.file.response.data.id))},J=Object(j.useCallback)(function(_){return Object(ie.d)(_).then(function(U){if(U.success){De.b.success(U.message);var R=le(_);Te(function(w){var N;return Object(F.a)(Object(F.a)({},w),{},{lessons:w?(N=w.lessons)===null||N===void 0?void 0:N.map(function(V){if(V.id===R){var xe=V.topics||[];return Object(F.a)(Object(F.a)({},V),{},{topics:[].concat(Object(be.a)(xe),[U.data])})}return V}):[]})})}})},[y,le]),Q=Object(j.useCallback)(function(_){return Object(ie.c)(_).then(function(U){U.success&&(De.b.success(U.message),Te(function(R){return Object(F.a)(Object(F.a)({},R),{},{lessons:R?[].concat(Object(be.a)(R.lessons),[U.data]):[]})}))})},[]),G={state:y,h5ps:at,id:M,addNewLesson:Me,updateLesson:fe,updateTopic:He,deleteLesson:I,addNewTopic:pe,deleteTopic:Ee,onTopicUploaded:Y,cloneTopic:J,cloneLesson:Q,currentEditMode:me,getLessons:se};return Object(ge.jsx)(Ge.Provider,{value:G,children:A})}},"w/VK":function(mt,Ae,i){"use strict";i.d(Ae,"c",function(){return be}),i.d(Ae,"a",function(){return st}),i.d(Ae,"b",function(){return Qe});var b=i("qLMh"),De=i("k1fw"),ae=i("9og8"),F=i("9kvl");function be(oe,ge){return j.apply(this,arguments)}function j(){return j=Object(ae.a)(Object(b.a)().mark(function oe(ge,Ye){return Object(b.a)().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.abrupt("return",Object(F.i)("/api/admin/reports/report",Object(De.a)({params:ge,method:"GET",useCache:!1},Ye||{})));case 1:case"end":return q.stop()}},oe)})),j.apply(this,arguments)}function st(oe,ge,Ye){return s.apply(this,arguments)}function s(){return s=Object(ae.a)(Object(b.a)().mark(function oe(ge,Ye,Ge){return Object(b.a)().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.abrupt("return",Object(F.i)("/api/admin/stats/course/".concat(ge,"/export"),Object(De.a)({params:Ye,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ge||{})));case 1:case"end":return _e.stop()}},oe)})),s.apply(this,arguments)}function Qe(oe,ge,Ye){return ie.apply(this,arguments)}function ie(){return ie=Object(ae.a)(Object(b.a)().mark(function oe(ge,Ye,Ge){return Object(b.a)().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return _e.abrupt("return",Object(F.i)("/api/admin/stats/topic/".concat(ge,"/export"),Object(De.a)({method:"GET",useCache:!1,params:{stat:Ye},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},Ge||{})));case 1:case"end":return _e.stop()}},oe)})),ie.apply(this,arguments)}}}]);

//# sourceMappingURL=p__TeacherSubjects__form.4eae87b3.async.js.map