"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7937,2803,8047],{56717:function(Tt,qe,o){var Ve=o(1413),m=o(67294),Ke=o(93696),Ze=o(84089),_e=function(x,v){return m.createElement(Ze.Z,(0,Ve.Z)((0,Ve.Z)({},x),{},{ref:v,icon:Ke.Z}))},U=m.forwardRef(_e);qe.Z=U},78677:function(Tt,qe,o){var Ve=o(67294),m=o(2759),Ke=function(){return Ke=Object.assign||function(_e){for(var U,Oe=1,x=arguments.length;Oe<x;Oe++){U=arguments[Oe];for(var v in U)Object.prototype.hasOwnProperty.call(U,v)&&(_e[v]=U[v])}return _e},Ke.apply(this,arguments)},Ze=(0,Ve.forwardRef)(function(_e,U){return Ve.createElement(m.P,Ke({},_e,{chartType:"Column",ref:U}))});qe.Z=Ze},88280:function(Tt,qe,o){o.d(qe,{Z:function(){return se}});var Ve=o(4942),m=o(97685),Ke=o(45987),Ze=o(74165),_e=o(15861),U=o(1413),Oe=o(87462),x=o(67294),v=o(42110),s=o(32867),te=function(X,e){return x.createElement(s.Z,(0,Oe.Z)({},X,{ref:e,icon:v.Z}))},c=x.forwardRef(te),E=c,i=o(97462),M=o(952),Z=o(10915),ne=o(48171),P=o(53914),Y=o(22270),Se=o(60249),ge=o(14726),je=o(75842),yt=o(21770),lt=o(88306),gt=o(8880),vt=o(7807),Le=o(85893),ht=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],Ft=["record","position","creatorButtonText","newRecordType","parentKey","style"],be=x.createContext(void 0);function g(_){var X=_.children,e=_.record,we=_.position,De=_.newRecordType,de=_.parentKey,Ue=(0,x.useContext)(be);return x.cloneElement(X,(0,U.Z)((0,U.Z)({},X.props),{},{onClick:function(){var Ne=(0,_e.Z)((0,Ze.Z)().mark(function Ce(He){var Be,Re,ve,me;return(0,Ze.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,(Be=(Re=X.props).onClick)===null||Be===void 0?void 0:Be.call(Re,He);case 2:if(me=B.sent,me!==!1){B.next=5;break}return B.abrupt("return");case 5:Ue==null||(ve=Ue.current)===null||ve===void 0||ve.addEditRecord(e,{position:we,newRecordType:De,parentKey:de});case 6:case"end":return B.stop()}},Ce)}));function Me(Ce){return Ne.apply(this,arguments)}return Me}()}))}function K(_){var X,e,we=(0,Z.YB)(),De=_.onTableChange,de=_.maxLength,Ue=_.formItemProps,Ne=_.recordCreatorProps,Me=_.rowKey,Ce=_.controlled,He=_.defaultValue,Be=_.onChange,Re=_.editableFormRef,ve=(0,Ke.Z)(_,ht),me=(0,x.useRef)(void 0),ie=(0,x.useRef)(),B=(0,x.useRef)();(0,x.useImperativeHandle)(ve.actionRef,function(){return ie.current},[ie.current]);var D=(0,yt.Z)(function(){return _.value||He||[]},{value:_.value,onChange:_.onChange}),Ie=(0,m.Z)(D,2),oe=Ie[0],Et=Ie[1],et=x.useMemo(function(){return typeof Me=="function"?Me:function(N,ae){return N[Me]||ae}},[Me]),xt=(0,ne.J)(function(N){if(typeof N=="number"&&!_.name){if(N>=oe.length)return N;var ae=oe&&oe[N];return et==null?void 0:et(ae,N)}if((typeof N=="string"||N>=oe.length)&&_.name){var ce=oe.findIndex(function(fe,he){var Te;return(et==null||(Te=et(fe,he))===null||Te===void 0?void 0:Te.toString())===(N==null?void 0:N.toString())});if(ce!==-1)return ce}return N});(0,x.useImperativeHandle)(Re,function(){var N=function(fe){var he,Te;if(fe==null)throw new Error("rowIndex is required");var Ye=xt(fe),rt=[_.name,(he=Ye==null?void 0:Ye.toString())!==null&&he!==void 0?he:""].flat(1).filter(Boolean);return(Te=B.current)===null||Te===void 0?void 0:Te.getFieldValue(rt)},ae=function(){var fe,he=[_.name].flat(1).filter(Boolean);if(Array.isArray(he)&&he.length===0){var Te,Ye=(Te=B.current)===null||Te===void 0?void 0:Te.getFieldsValue();return Array.isArray(Ye)?Ye:Object.keys(Ye).map(function(rt){return Ye[rt]})}return(fe=B.current)===null||fe===void 0?void 0:fe.getFieldValue(he)};return(0,U.Z)((0,U.Z)({},B.current),{},{getRowData:N,getRowsData:ae,setRowData:function(fe,he){var Te,Ye;if(fe==null)throw new Error("rowIndex is required");var rt=xt(fe),_t=[_.name,(Te=rt==null?void 0:rt.toString())!==null&&Te!==void 0?Te:""].flat(1).filter(Boolean),Dt=Object.assign({},(0,U.Z)((0,U.Z)({},N(fe)),he||{})),tt=(0,gt.Z)({},_t,Dt);return(Ye=B.current)===null||Ye===void 0||Ye.setFieldsValue(tt),!0}})},[xt,_.name,B.current]),(0,x.useEffect)(function(){_.controlled&&(oe||[]).forEach(function(N,ae){var ce;(ce=B.current)===null||ce===void 0||ce.setFieldsValue((0,Ve.Z)({},"".concat(et(N,ae)),N))},{})},[(0,P.ZP)(oe),_.controlled]),(0,x.useEffect)(function(){if(_.name){var N;B.current=_==null||(N=_.editable)===null||N===void 0?void 0:N.form}},[(X=_.editable)===null||X===void 0?void 0:X.form,_.name]);var at=Ne||{},Rt=at.record,jt=at.position,Pt=at.creatorButtonText,Zt=at.newRecordType,Gt=at.parentKey,wt=at.style,O=(0,Ke.Z)(at,Ft),Q=jt==="top",V=(0,x.useMemo)(function(){return typeof de=="number"&&de<=(oe==null?void 0:oe.length)?!1:Ne!==!1&&(0,Le.jsx)(g,{record:(0,Y.h)(Rt,oe==null?void 0:oe.length,oe)||{},position:jt,parentKey:(0,Y.h)(Gt,oe==null?void 0:oe.length,oe),newRecordType:Zt,children:(0,Le.jsx)(ge.ZP,(0,U.Z)((0,U.Z)({type:"dashed",style:(0,U.Z)({display:"block",margin:"10px 0",width:"100%"},wt),icon:(0,Le.jsx)(E,{})},O),{},{children:Pt||we.getMessage("editableTable.action.add","\u6DFB\u52A0\u4E00\u884C\u6570\u636E")}))})},[Ne,de,oe==null?void 0:oe.length]),z=(0,x.useMemo)(function(){return V?Q?{components:{header:{wrapper:function(ae){var ce,fe=ae.className,he=ae.children;return(0,Le.jsxs)("thead",{className:fe,children:[he,(0,Le.jsxs)("tr",{style:{position:"relative"},children:[(0,Le.jsx)("td",{colSpan:0,style:{visibility:"hidden"},children:V}),(0,Le.jsx)("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(ce=ve.columns)===null||ce===void 0?void 0:ce.length,children:V})]})]})}}}}:{tableViewRender:function(ae,ce){var fe,he;return(0,Le.jsxs)(Le.Fragment,{children:[(fe=(he=_.tableViewRender)===null||he===void 0?void 0:he.call(_,ae,ce))!==null&&fe!==void 0?fe:ce,V]})}}:{}},[Q,V]),W=(0,U.Z)({},_.editable),q=(0,ne.J)(function(N,ae){var ce,fe,he;if((ce=_.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,N,ae),(he=_.onValuesChange)===null||he===void 0||he.call(_,ae,N),_.controlled){var Te;_==null||(Te=_.onChange)===null||Te===void 0||Te.call(_,ae)}});return(_!=null&&_.onValuesChange||(e=_.editable)!==null&&e!==void 0&&e.onValuesChange||_.controlled&&_!==null&&_!==void 0&&_.onChange)&&(W.onValuesChange=q),(0,Le.jsxs)(Le.Fragment,{children:[(0,Le.jsx)(be.Provider,{value:ie,children:(0,Le.jsx)(vt.Z,(0,U.Z)((0,U.Z)((0,U.Z)({search:!1,options:!1,pagination:!1,rowKey:Me,revalidateOnFocus:!1},ve),z),{},{tableLayout:"fixed",actionRef:ie,onChange:De,editable:(0,U.Z)((0,U.Z)({},W),{},{formProps:(0,U.Z)({formRef:B},W.formProps)}),dataSource:oe,onDataSourceChange:function(ae){if(Et(ae),_.name&&jt==="top"){var ce,fe=(0,gt.Z)({},[_.name].flat(1).filter(Boolean),ae);(ce=B.current)===null||ce===void 0||ce.setFieldsValue(fe)}}}))}),_.name?(0,Le.jsx)(i.Z,{name:[_.name],children:function(ae){var ce,fe;if(!me.current)return me.current=oe,null;var he=(0,lt.Z)(ae,[_.name].flat(1)),Te=he==null?void 0:he.find(function(Ye,rt){var _t;return!(0,Se.A)(Ye,(_t=me.current)===null||_t===void 0?void 0:_t[rt])});return me.current=oe,Te&&(_==null||(ce=_.editable)===null||ce===void 0||(fe=ce.onValuesChange)===null||fe===void 0||fe.call(ce,Te,he)),null}}):null]})}function G(_){var X=M.ZP.useFormInstance();return _.name?(0,Le.jsx)(je.Z.Item,(0,U.Z)((0,U.Z)({style:{maxWidth:"100%"}},_==null?void 0:_.formItemProps),{},{name:_.name,shouldUpdate:function(we,De){var de=[_.name].flat(1);try{return JSON.stringify((0,lt.Z)(we,de))!==JSON.stringify((0,lt.Z)(De,de))}catch(Ue){return!0}},children:(0,Le.jsx)(K,(0,U.Z)((0,U.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},_),{},{editable:(0,U.Z)((0,U.Z)({},_.editable),{},{form:X})}))})):(0,Le.jsx)(K,(0,U.Z)({tableLayout:"fixed",scroll:{x:"max-content"}},_))}G.RecordCreator=g;var se=G},11312:function(Tt,qe,o){o.d(qe,{nu:function(){return X},rL:function(){return _},Du:function(){return se}});var Ve=o(9783),m=o.n(Ve),Ke=o(97857),Ze=o.n(Ke),_e=o(19632),U=o.n(_e),Oe=o(5574),x=o.n(Oe),v=o(45919),s=o(66419),te=o(78677),c=o(78715),E=o(78957),i=o(66309),M=o(72051),Z=o(71230),ne=o(72269),P=o(74656),Y=o(60943),Se=o(67294),ge=o(70804),je=o(80854),yt=o(62235),lt=o(15009),gt=o.n(lt),vt=o(99289),Le=o.n(vt),ht=o(58638),Ft=o(14726),be=o(76841),g=o(85893),K=function(we){var De=we.course_id,de=we.stat,Ue=de===void 0?"EscolaLms\\Reports\\Stats\\Course\\FinishedTopics":de,Ne=(0,Se.useState)(!1),Me=x()(Ne,2),Ce=Me[0],He=Me[1],Be=(0,Se.useCallback)(function(Re){return Le()(gt()().mark(function ve(){var me,ie;return gt()().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return He(!0),D.prev=1,D.next=4,(0,be._g)(Re,{stat:Ue});case 4:me=D.sent,me instanceof Blob&&(ie=document.createElement("a"),ie.href=window.URL.createObjectURL(me),ie.download="finished_topics_".concat(De,".xlsx"),document.body.appendChild(ie),ie.click(),document.body.removeChild(ie)),D.next=11;break;case 8:D.prev=8,D.t0=D.catch(1),console.error(D.t0);case 11:return D.prev=11,He(!1),D.finish(11);case 14:case"end":return D.stop()}},ve,null,[[1,8,11,14]])}))},[Ue]);return(0,g.jsxs)(Ft.ZP,{type:"primary",loading:Ce,onClick:Be(De),children:[(0,g.jsx)(ht.Z,{})," ",(0,g.jsx)(je.FormattedMessage,{id:"export"})]})},G=function(we){return we.topicable.content.contents?Object.values(we.topicable.content.contents)[0].library:"H5P"},se=function(we){var De=we.course_id,de=we.topics,Ue=we.stats,Ne=(0,Se.useState)(!1),Me=x()(Ne,2),Ce=Me[0],He=Me[1],Be=(0,Se.useMemo)(function(){return[{title:(0,g.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(me){return(0,g.jsx)(yt.Z,{type:"App\\Models\\User",type_id:me})}},{title:(0,g.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"}].concat(U()(de.map(function(ve){var me,ie=(me=ve.topicable_type)===null||me===void 0?void 0:me.split("\\").pop();return ie==="H5P"&&(ie=G(ve)),{render:function(D){var Ie=0;switch(D&&(D.started_at&&D.finished_at?Ie=1:D.started_at&&(Ie=2)),Ie){case 1:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(i.Z,{color:"success",children:"F"}),Ce&&(D==null?void 0:D.seconds)&&(0,g.jsx)("small",{children:(0,s.Im)(D.seconds)})]});case 2:return(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(i.Z,{color:"blue",children:"S"}),Ce&&(D==null?void 0:D.seconds)&&(0,g.jsx)("small",{children:(0,s.Im)(D.seconds)})]});case 0:default:return(0,g.jsx)(Se.Fragment,{children:(0,g.jsx)(i.Z,{color:"error",children:"N"})})}},title:(0,g.jsxs)("small",{children:[(0,g.jsx)(i.Z,{children:ie})," ",ve.title]}),dataIndex:ve.id}})))},[de,Ce]),Re=(0,Se.useMemo)(function(){return Ue.map(function(ve){return de.reduce(function(me,ie){var B=ve.topics.find(function(D){return D.id===ie.id});return Ze()(Ze()({},me),{},m()({},Number(ie.id),B!=null?B:0))},{email:ve.email,id:ve.id})})},[Ue,de]);return(0,g.jsx)(M.Z,{title:function(){return(0,g.jsxs)(Z.Z,{justify:"space-between",align:"middle",children:[(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(je.FormattedMessage,{id:"Finished",defaultMessage:"Finished:"})," ",(0,g.jsx)(i.Z,{color:"success",children:"F"}),(0,g.jsx)(je.FormattedMessage,{id:"Started",defaultMessage:"Started:"})," ",(0,g.jsx)(i.Z,{color:"blue",children:"S"}),(0,g.jsx)(je.FormattedMessage,{id:"NotStarted",defaultMessage:"Not Started:"})," ",(0,g.jsx)(i.Z,{color:"error",children:"N"}),(0,g.jsx)(je.FormattedMessage,{id:"ShowMinutes",defaultMessage:"Show minutes spent on topic:"})," ",(0,g.jsx)(ne.Z,{checked:Ce,onChange:function(ie){return He(ie)}})]}),(0,g.jsx)(K,{course_id:De})]})},columns:Be,dataSource:Re,size:"small",scroll:{x:1500},components:{table:function(me){return(0,g.jsx)(ge.Z,{horizontal:!0,style:{maxWidth:"auto"},hideScrollbars:!1,children:(0,g.jsx)("table",Ze()({},me))})}}})},_=function(we){var De=we.stats,de=we.attempts,Ue=(0,Se.useMemo)(function(){return[{title:(0,g.jsx)(je.FormattedMessage,{id:"user"}),dataIndex:"id",render:function(Ce){return(0,g.jsx)(yt.Z,{type:"App\\Models\\User",type_id:Ce})}},{title:(0,g.jsx)(je.FormattedMessage,{id:"email"}),dataIndex:"email"},{title:(0,g.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"}),dataIndex:"attempt"},{title:(0,g.jsx)(je.FormattedMessage,{id:"finished_at",defaultMessage:"Finished at"}),dataIndex:"finished_at",render:function(Ce){return Ce?(0,Y.WU)(new Date(Ce),v.Cu):""}}]},[]),Ne=(0,Se.useMemo)(function(){return De.map(function(Me){var Ce=Me.id,He=Me.email,Be=Me.finished_at,Re=de==null?void 0:de.find(function(me){return me.id===Ce}),ve=Array.isArray(Re==null?void 0:Re.attempts)?Re==null?void 0:Re.attempts.length:0;return{id:Ce,email:He,finished_at:Be,attempt:ve}})},[De]);return(0,g.jsx)(M.Z,{title:function(){return(0,g.jsx)(E.Z,{children:(0,g.jsx)(je.FormattedMessage,{id:"course.finished",defaultMessage:"Finished"})})},columns:Ue,dataSource:Ne,size:"small",scroll:{x:500}})},X=function(we){var De=we.stats,de=(0,Se.useState)(null),Ue=x()(de,2),Ne=Ue[0],Me=Ue[1],Ce=(0,Se.useState)(null),He=x()(Ce,2),Be=He[0],Re=He[1],ve=(0,je.useIntl)(),me=(0,Se.useMemo)(function(){return De.flatMap(function(B){return Object.values(B.attempts).flatMap(function(D){var Ie=D.dates,oe=D.attempt,Et=Object.values(Ie).flatMap(function(et){var xt=et.date,at=et.seconds_total;return{date:xt,attempt:oe,seconds_total:at,email:B.email}});return Et})})},[De]),ie={xField:"date",yField:"seconds_total",seriesField:"attempt",isStack:!0,xAxis:{label:{autoHide:!0,autoRotate:!1}},slider:{start:0,end:1},label:{position:"middle",layout:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"}]}};return(0,g.jsx)(c.ZP,{title:(0,g.jsxs)(E.Z,{children:[(0,g.jsx)(je.FormattedMessage,{id:"course.interactions_time_in_days"}),(0,g.jsx)(P.default,{showSearch:!0,value:Ne,onChange:function(D){Me(D),Re(null)},placeholder:(0,g.jsx)(je.FormattedMessage,{id:"select_person",defaultMessage:"Select a person"}),children:De.map(function(B){var D=B.id,Ie=B.email;return(0,g.jsx)(P.default.Option,{value:Ie,children:Ie},D)})}),(0,g.jsx)(P.default,{value:Be,onChange:function(D){return Re(D)},disabled:Ne===null,placeholder:(0,g.jsx)(je.FormattedMessage,{id:"select_attempt",defaultMessage:"Select attempt"}),children:U()(new Set(me.filter(function(B){var D=B.email;return D===Ne}).map(function(B){var D=B.attempt;return D}))).map(function(B){return(0,g.jsxs)(P.default.Option,{value:B,children:[(0,g.jsx)(je.FormattedMessage,{id:"attempt",defaultMessage:"Attempt"})," ",B]},B)})})]}),colSpan:12,layout:"center",children:(0,g.jsx)("div",{style:{overflow:"auto",minHeight:"400px",width:"100%"},children:(0,g.jsx)(te.Z,Ze()(Ze()({},ie),{},{tooltip:{title:"".concat(ve.formatMessage({id:"attempt"})),formatter:function(D){var Ie=Math.floor(+D.seconds_total/60),oe=+D.seconds_total>60?+D.seconds_total-Ie*60:0;return{name:D.attempt,value:"".concat(Ie,"m ").concat(oe,"s")}}},data:me.filter(function(B){var D=B.email;return D===Ne}).filter(function(B){var D=B.attempt;return Number.isInteger(Be)?D===Be:!0})}))})})}},87366:function(Tt,qe,o){o.d(qe,{Il:function(){return Ft},_y:function(){return P},uS:function(){return ge}});var Ve=o(15009),m=o.n(Ve),Ke=o(99289),Ze=o.n(Ke),_e=o(5574),U=o.n(_e),Oe=o(97857),x=o.n(Oe),v=o(19632),s=o.n(v),te=o(2453),c=o(67294),E=o(80854),i=o(99100),M=o(31472),Z=o(36309),ne=o(85893),P=c.createContext({}),Y=function(){return Math.round(Math.random()*99999)},Se=function be(g){return g.reduce(function(K,G){return[].concat(s()(K),s()(G.lessons?be(G.lessons):[]),[G])},[])},ge=function be(g){return g.reduce(function(K,G){var se;return[].concat(s()(K),s()(G.lessons?be(G.lessons):[]),s()((se=G.topics)!==null&&se!==void 0?se:[]))},[])},je=function be(g,K,G){return g.map(function(se){var _,X;return x()(x()({},se),{},{lessons:se.lessons?be(se.lessons,K,G):[],topics:se.id===K?[].concat(s()((_=se.topics)!==null&&_!==void 0?_:[]),[G]):(X=se.topics)!==null&&X!==void 0?X:[]})})},yt=function be(g,K,G){return G?g.map(function(se){return x()(x()({},se),{},{lessons:[].concat(s()(se.lessons?be(se.lessons,K,G):[]),s()(se.id===G?[K]:[]))})}):[].concat(s()(g),[K])},lt=function be(g,K,G){return g.map(function(se){return x()(x()({},se.id===K?G:se),{},{lessons:se.lessons?be(se.lessons,K,G):[]})})},gt=function be(g,K){return g.map(function(G){return x()(x()({},G),{},{parent_id:K,lessons:G.lessons?be(G.lessons,G.id):[]})})},vt=function be(g,K){return g.filter(function(G){return G.id!==K}).map(function(G){return x()(x()({},G),{},{lessons:G.lessons?be(G.lessons,K):[]})})},Le=function be(g,K){return g.map(function(G){return x()(x()({},G),{},{lessons:G.lessons?be(G.lessons,K):[],topics:G.topics?G.topics.filter(function(se){return se.id!==K}):[]})})},ht=function be(g,K,G,se){return se==null?void 0:se.map(function(_){if(_.id===G){var X;return x()(x()({},_),{},{topics:(X=_.topics)===null||X===void 0?void 0:X.map(function(e){return e.id===g?K.file.response.data:e})})}else if(_.lessons)return x()(x()({},_),{},{lessons:be(g,K,G,_.lessons||[])});return _})},Ft=function(g){var K=g.children,G=g.id,se=(0,c.useState)(),_=U()(se,2),X=_[0],e=_[1],we=(0,E.useIntl)(),De=(0,c.useMemo)(function(){return X&&X.lessons?ge(X.lessons):[]},[X]),de=(0,c.useMemo)(function(){return X&&X.lessons?Se(X.lessons):[]},[X]),Ue=(0,c.useState)([]),Ne=U()(Ue,2),Me=Ne[0],Ce=Ne[1],He=(0,c.useState)(!1),Be=U()(He,2),Re=Be[0],ve=Be[1],me=(0,E.useLocation)(),ie=(0,c.useMemo)(function(){var O=new URLSearchParams(me.search);return{lesson:O.get("lesson"),topic:O.get("topic")}},[me]),B=(0,c.useCallback)(Ze()(m()().mark(function O(){var Q,V;return m()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,(0,Z.XU)({class_type:"EscolaLms\\Courses\\Models\\Lesson"});case 2:Q=W.sent,Q.success&&(V=Q.data.find(function(q){var N=q.name;return N==="assistant_id"}),ve(!!(V!=null&&V.id)));case 4:case"end":return W.stop()}},O)})),[]);(0,c.useEffect)(function(){B(),Ce([])},[]);var D=(0,c.useCallback)(function(){(0,i.Nx)(G).then(function(O){return O.success&&e(x()(x()({},O.data),{},{lessons:gt(O.data.lessons)}))})},[G]);(0,c.useEffect)(function(){D()},[D]);var Ie=(0,c.useCallback)(function(O){var Q=de.find(function(V){var z;return V==null||(z=V.topics)===null||z===void 0?void 0:z.find(function(W){return W.id===O})});return Q?Q.id:null},[de]),oe=(0,c.useMemo)(function(){return ie.lesson?{mode:"lesson",id:Number(ie.lesson),value:de.find(function(O){return O.id===Number(ie.lesson)})}:ie.topic?{mode:"topic",id:Number(ie.topic),value:De.find(function(O){return O.id===Number(ie.topic)})}:{mode:"init"}},[ie,X,de,De]),Et=(0,c.useCallback)(function(O){var Q={course_id:G,topics:[],isNew:!0,id:X?X.lessons.length+1:Y(),order:0,title:we.formatMessage({id:"add_title_here"}),active:!0,parent_id:O};return e(function(V){var z;return x()(x()({},V),{},{lessons:yt((z=V==null?void 0:V.lessons)!==null&&z!==void 0?z:[],Q,O)})}),Q},[G,X]),et=(0,c.useCallback)(function(O,Q){var V=de.find(function(W){return W.id===O}),z=V&&V.isNew;return(z?(0,i.aA)(Q):(0,i.sI)(O,Q)).then(function(W){return te.ZP.success(W.message),D(),W.success&&e(function(q){var N;return x()(x()({},q),{},{lessons:lt((N=q==null?void 0:q.lessons)!==null&&N!==void 0?N:[],O,x()(x()({},W.data),{},{isNew:!1}))})})})},[X]),xt=(0,c.useCallback)(function(O){var Q=de.find(function(z){return z.id===O});if(Q){var V=Q.isNew;V?e(function(z){var W;return x()(x()({},z),{},{lessons:vt((W=z==null?void 0:z.lessons)!==null&&W!==void 0?W:[],O)})}):(0,i.iI)(O).then(function(z){z.success&&(te.ZP.success(z.message),e(function(W){var q;return x()(x()({},W),{},{lessons:vt((q=W==null?void 0:W.lessons)!==null&&q!==void 0?q:[],O)})}))})}},[X]),at=(0,c.useCallback)(function(O,Q){var V,z=Ie(O),W=de.find(function(ae){return ae.id===z}),q=W&&((V=W.topics)===null||V===void 0?void 0:V.find(function(ae){return ae.id===O})),N=q==null?void 0:q.isNew;return(N?(0,i.HV)(Q):(0,i.Cn)(O,Q)).then(function(ae){ae.success&&(te.ZP.success(ae.message),D(),E.history.push("/courses/list/".concat(G,"/program/?topic=").concat(ae.data.id)),(q==null?void 0:q.topicable_type)===M.oz.Video&&setTimeout(function(){D()},5e3))})},[Ie,X,D]),Rt=(0,c.useCallback)(function(O){var Q=Ie(O),V=de.find(function(q){return q.id===Q});if(V){var z=De==null?void 0:De.find(function(q){return q.id===O}),W=z==null?void 0:z.isNew;W&&!z.topicable?e(function(q){var N;return x()(x()({},q),{},{lessons:Le((N=q==null?void 0:q.lessons)!==null&&N!==void 0?N:[],O)})}):(0,i.vJ)(O).then(function(q){q.success&&(te.ZP.success(q.message),e(function(N){var ae;return x()(x()({},N),{},{lessons:Le((ae=N==null?void 0:N.lessons)!==null&&ae!==void 0?ae:[],O)})}))})}},[X,Ie]),jt=(0,c.useCallback)(function(O,Q){var V={lesson_id:O,isNew:!0,id:Y(),title:we.formatMessage({id:"add_title_here"}),active:!0,topicable_type:Q};return e(function(z){var W;return x()(x()({},z),{},{lessons:je((W=z==null?void 0:z.lessons)!==null&&W!==void 0?W:[],O,V)})}),V},[]),Pt=function(Q,V){var z=Ie(Q);e(function(W){return x()(x()({},W),{},{lessons:W?ht(Q,V,z,W.lessons||[]):[]})}),E.history.push("/courses/list/".concat(G,"/program/?topic=").concat(V.file.response.data.id))},Zt=(0,c.useCallback)(function(O){return(0,i.Cx)(O).then(function(Q){if(Q.success){te.ZP.success(Q.message);var V=Ie(O);e(function(z){var W;return x()(x()({},z),{},{lessons:z?(W=z.lessons)===null||W===void 0?void 0:W.map(function(q){if(q.id===V){var N=q.topics||[];return x()(x()({},q),{},{topics:[].concat(s()(N),[Q.data])})}return q}):[]})})}})},[X,Ie]),Gt=(0,c.useCallback)(function(O){return(0,i.if)(O).then(function(Q){Q.success&&(te.ZP.success(Q.message),e(function(V){return x()(x()({},V),{},{lessons:V?[].concat(s()(V.lessons),[Q.data]):[]})}))})},[]),wt={state:X,h5ps:Me,id:G,addNewLesson:Et,updateLesson:et,updateTopic:at,deleteLesson:xt,addNewTopic:jt,deleteTopic:Rt,onTopicUploaded:Pt,cloneTopic:Zt,cloneLesson:Gt,currentEditMode:oe,getLessons:D,isAssistant:Re};return(0,ne.jsx)(P.Provider,{value:wt,children:K})}},93321:function(Tt,qe,o){o.r(qe),o.d(qe,{default:function(){return Hn}});var Ve=o(97857),m=o.n(Ve),Ke=o(91115),Ze=o(26114),_e=o(78715),U=o(74453),Oe=o(74330),x=o(14726),v=o(67294),s=o(80854),te=o(15009),c=o.n(te),E=o(99289),i=o.n(E),M=o(19632),Z=o.n(M),ne=o(5574),P=o.n(ne),Y=o(16894),Se=o(28248),ge=o(83062),je=o(2453);function yt(u,a){return lt.apply(this,arguments)}function lt(){return lt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"GET",params:a},t||{})));case 1:case"end":return r.stop()}},u)})),lt.apply(this,arguments)}function gt(u,a){return vt.apply(this,arguments)}function vt(){return vt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/bookmarks",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),vt.apply(this,arguments)}function Le(u,a,t){return ht.apply(this,arguments)}function ht(){return ht=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(a),m()({method:"PATCH",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},u)})),ht.apply(this,arguments)}function Ft(u,a,t){return be.apply(this,arguments)}function be(){return be=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/bookmarks/".concat(a),m()({method:"DELETE",headers:{"Content-Type":"application/json"},data:t},n||{})));case 1:case"end":return l.stop()}},u)})),be.apply(this,arguments)}var g=o(31472),K=o(71471),G=o(78957),se=o(2487),_=o(55102),X=o(75842),e=o(85893),we=function(a){var t=a.visible,n=a.onClose,r=a.user,l=K.Z.Text,d=r.name,f=r.groupId,p=r.userId,j=(0,v.useState)(""),S=P()(j,2),y=S[0],F=S[1],h=(0,v.useState)(!1),b=P()(h,2),C=b[0],T=b[1],J=(0,v.useState)([]),w=P()(J,2),A=w[0],k=w[1],ue=(0,v.useState)(null),le=P()(ue,2),$=le[0],R=le[1],I=(0,v.useState)({current_page:1,per_page:5,last_page:1,total:0}),L=P()(I,2),ee=L[0],Fe=L[1],Ge=function(){var Ae=i()(c()().mark(function re(pe){var H;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,yt({bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:p,page:pe,per_page:ee.per_page});case 2:H=xe.sent,H.success&&(k(H.data),Fe(H.meta));case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}(),ze=function(){var Ae=i()(c()().mark(function re(){var pe;return c()().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:return Je.next=2,gt({value:y,bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:p});case 2:pe=Je.sent,pe.success&&(Ge(),T(!1),F(""));case 4:case"end":return Je.stop()}},re)}));return function(){return Ae.apply(this,arguments)}}(),st=function(){var Ae=i()(c()().mark(function re(pe){var H;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,Ft(pe);case 2:H=xe.sent,H.success&&Ge();case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}(),ke=function(){var Ae=i()(c()().mark(function re(pe){var H;return c()().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,Le(pe,{value:($==null?void 0:$.currentText)||"",bookmarkable_id:f,bookmarkable_type:g.h5.Group,user_id:p});case 2:H=xe.sent,H.success&&(Ge(),R(null));case 4:case"end":return xe.stop()}},re)}));return function(pe){return Ae.apply(this,arguments)}}();return(0,v.useEffect)(function(){Ge()},[]),(0,e.jsxs)(Se.Z,{title:(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(s.FormattedMessage,{id:"notes"}),(0,e.jsx)(l,{children:"(".concat(d,")")})]}),open:t,onCancel:n,footer:[(0,e.jsx)(x.ZP,{onClick:n,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})},"cancel")],children:[(0,e.jsx)(se.Z,{dataSource:A,pagination:{onChange:function(re){return Ge(re)},pageSize:ee.per_page,total:ee.total,current:ee.current_page},renderItem:function(re){return(0,e.jsx)(se.Z.Item,{actions:[(0,e.jsx)(x.ZP,{danger:!0,onClick:function(){return st(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"delete"})},re.id),($==null?void 0:$.currentNoteId)===re.id?(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(x.ZP,{onClick:function(){return ke(re.id)},children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(x.ZP,{onClick:function(){return R(null)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]}):(0,e.jsx)(x.ZP,{onClick:function(){return R({currentNoteId:re.id,currentText:re.value||""})},children:(0,e.jsx)(s.FormattedMessage,{id:"edit"})},re.id)],children:($==null?void 0:$.currentNoteId)===re.id&&($==null?void 0:$.currentText)!==null?(0,e.jsx)(_.Z.TextArea,{value:$==null?void 0:$.currentText,onChange:function(H){return R(function(Je){return m()(m()({},Je),{},{currentText:H.target.value})})}}):re.value})}}),C?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(X.Z,{layout:"vertical",children:(0,e.jsx)(X.Z.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"new_note"}),children:(0,e.jsx)(_.Z.TextArea,{value:y,onChange:function(re){return F(re.target.value)},autoSize:{minRows:3,maxRows:6}})})}),(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(x.ZP,{type:"primary",onClick:ze,children:(0,e.jsx)(s.FormattedMessage,{id:"save"})}),(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return T(!1)},children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})})]})]}):(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return T(!0)},children:(0,e.jsx)(s.FormattedMessage,{id:"add_note"})},"new")]})},De=we,de=o(54464);function Ue(u,a){return Ne.apply(this,arguments)}function Ne(){return Ne=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules/groups/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),Ne.apply(this,arguments)}function Me(u,a,t,n){return Ce.apply(this,arguments)}function Ce(){return Ce=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(a,"/attendances"),m()({data:{attendances:[{user_id:t,value:n}]},method:"POST"},r||{})));case 1:case"end":return d.stop()}},u)})),Ce.apply(this,arguments)}function He(u,a){return Be.apply(this,arguments)}function Be(){return Be=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),Be.apply(this,arguments)}function Re(u,a){return ve.apply(this,arguments)}function ve(){return ve=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"GET",useCache:!1,params:a},t||{})));case 1:case"end":return r.stop()}},u)})),ve.apply(this,arguments)}function me(u,a){return ie.apply(this,arguments)}function ie(){return ie=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),ie.apply(this,arguments)}function B(u,a,t){return D.apply(this,arguments)}function D(){return D=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"PUT",data:t,useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),D.apply(this,arguments)}function Ie(u,a){return oe.apply(this,arguments)}function oe(){return oe=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),oe.apply(this,arguments)}function Et(u,a){return et.apply(this,arguments)}function et(){return et=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),et.apply(this,arguments)}function xt(u,a,t,n){return at.apply(this,arguments)}function at(){return at=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/exams/".concat(a,"/users/").concat(t),m()({method:"POST",headers:{"Content-Type":"application/json"},data:n},r||{})));case 1:case"end":return d.stop()}},u)})),at.apply(this,arguments)}function Rt(u,a,t){return jt.apply(this,arguments)}function jt(){return jt=_asyncToGenerator(_regeneratorRuntime().mark(function u(a,t,n){return _regeneratorRuntime().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",request("/api/admin/exams/".concat(a,"/users/").concat(t),_objectSpread({method:"DELETE"},n||{})));case 1:case"end":return l.stop()}},u)})),jt.apply(this,arguments)}function Pt(u,a,t){return Zt.apply(this,arguments)}function Zt(){return Zt=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(a,"/tutors/").concat(t,"/grades"),m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),Zt.apply(this,arguments)}function Gt(u,a,t,n){return wt.apply(this,arguments)}function wt(){return wt=i()(c()().mark(function u(a,t,n,r){return c()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,s.request)("/api/admin/semester-subjects/".concat(a,"/tutors/").concat(t,"/grades"),m()({method:"POST",data:n},r||{})));case 1:case"end":return d.stop()}},u)})),wt.apply(this,arguments)}function O(u,a){return Q.apply(this,arguments)}function Q(){return Q=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/lesson-group-users",m()({method:"GET",params:{groups:a},useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),Q.apply(this,arguments)}function V(u,a,t){return z.apply(this,arguments)}function z(){return z=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/lesson-group-users/groups/".concat(a,"/users/").concat(t),m()({method:"GET",useCache:!1},n||{})));case 1:case"end":return l.stop()}},u)})),z.apply(this,arguments)}function W(u){return q.apply(this,arguments)}function q(){return q=i()(c()().mark(function u(a){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,s.request)("/api/admin/grade-terms",m()({method:"GET",useCache:!1},a||{})));case 1:case"end":return n.stop()}},u)})),q.apply(this,arguments)}function N(u,a){return ae.apply(this,arguments)}function ae(){return ae=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/grade-scales/".concat(a),m()({method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),ae.apply(this,arguments)}function ce(u,a){return fe.apply(this,arguments)}function fe(){return fe=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/final-grades",m()({method:"POST",data:a},t||{})));case 1:case"end":return r.stop()}},u)})),fe.apply(this,arguments)}function he(u,a,t){return Te.apply(this,arguments)}function Te(){return Te=i()(c()().mark(function u(a,t,n){return c()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(a),m()({method:"PATCH",data:t},n||{})));case 1:case"end":return l.stop()}},u)})),Te.apply(this,arguments)}function Ye(u,a){return rt.apply(this,arguments)}function rt(){return rt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/final-grades/".concat(a),m()({method:"DELETE"},t||{})));case 1:case"end":return r.stop()}},u)})),rt.apply(this,arguments)}var _t=o(95213),Dt=o(47389),tt=o(7092),va=o(13769),$t=o.n(va),pa=["results"],Jt=function(a,t){return a.reduce(function(n,r){var l=r.results,d=$t()(r,pa),f=l.find(function(p){return p.user_id===t});return f?[].concat(Z()(n),[m()(m()({},d),{},{result:f})]):n},[])},Qt=function(a,t){var n,r=a.reduce(function(h,b){var C=b.result,T=b.weight;return T&&typeof C.result=="number"?[h[0]+C.result*T,h[1]+T]:h},[0,0]),l=P()(r,2),d=l[0],f=l[1],p=Number.isNaN(d/f)?0:d/f,j=t.sort(function(h,b){return h.grade_value-b.grade_value}).reduce(function(h,b){return[].concat(Z()(h),[m()(m()({},b),{},{isWeightedAverageGreater:p>=b.grade_value})])},[]);if(j.every(function(h){var b=h.isWeightedAverageGreater;return b})){var S,y;return(S=(y=j.at(-1))===null||y===void 0?void 0:y.name)!==null&&S!==void 0?S:""}var F=j.findIndex(function(h){var b=h.isWeightedAverageGreater;return!b});return F<0?"":(n=j[F-1])===null||n===void 0?void 0:n.name},qt=function(a,t){var n;return(n=t.find(function(r){return r.s_subject_scale_form_id===a}))===null||n===void 0?void 0:n.scale},dt=o(73199),ga=o(9783),nt=o.n(ga),ea=o(84567);function ha(u){var a,t=u===null?g.cX.ABSENT:u,n=nt()(nt()(nt()(nt()({},g.cX.PRESENT,{ch1:!0,ch2:!1}),g.cX.PRESENT_NOT_EXERCISING,{ch1:!0,ch2:!0}),g.cX.ABSENT,{ch1:!1,ch2:!1}),g.cX.EXCUSED_ABSENCE,{ch1:!1,ch2:!0});return(a=n[t])!==null&&a!==void 0?a:{ch1:!1,ch2:!1}}function xa(u){var a,t=u.ch1,n=u.ch2,r="".concat(t,"_").concat(n),l={true_false:g.cX.PRESENT,true_true:g.cX.PRESENT_NOT_EXERCISING,false_false:g.cX.ABSENT,false_true:g.cX.EXCUSED_ABSENCE};return(a=l[r])!==null&&a!==void 0?a:g.cX.ABSENT}var ja=function(a){var t=a.groupAttendanceScheduleId,n=a.studentId,r=a.attendance,l=a.onSuccess,d=(0,v.useState)(ha(r)),f=P()(d,2),p=f[0],j=f[1],S=(0,v.useState)(!1),y=P()(S,2),F=y[0],h=y[1],b=(0,v.useRef)(!0),C=(0,v.useCallback)(function(w){h(!0),Me(t,n,xa(w)).then(function(A){A.success&&(l==null||l())}).finally(function(){return h(!1)})},[]),T=(0,v.useCallback)(function(w){return j(w.target.checked?{ch1:!0,ch2:!1}:{ch1:!1,ch2:!1})},[]),J=(0,v.useCallback)(function(w){return j(function(A){return m()(m()({},A),{},{ch2:w.target.checked})})},[]);return(0,v.useEffect)(function(){if(b.current){b.current=!1;return}C(p)},[p,C]),(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"present"}),children:(0,e.jsx)(ea.Z,{disabled:F,checked:p.ch1,onChange:T})}),(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:p.ch1?"not_exercising":"excused_absence"}),children:(0,e.jsx)(ea.Z,{disabled:F,checked:p.ch2,onChange:J})})]})},ta=ja,ct=o(45919),Ut=o(82061),bt=o(60943),It=o(74656),aa=o(37804),ba=o(96486),Sa=function(a){var t=a.exam_id,n=a.result,r=a.student_id,l=a.type,d=a.onSuccess,f=(0,s.useIntl)(),p=(0,v.useCallback)((0,ba.debounce)(function(S){xt(t,r,{result:S}).then(function(y){y.success&&(d==null||d(y.data))})},300),[t,n,r]),j=function(){switch(l){case g.UL.ManualPass:return(0,e.jsx)(It.default,{allowClear:!0,style:{width:"100%"},onChange:p,options:dt.FW,defaultValue:n!=null?n:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});case g.UL.ManualGrades:return(0,e.jsx)(It.default,{allowClear:!0,style:{width:"100%"},onChange:p,options:dt.BP,defaultValue:n!=null?n:void 0,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_grade"})});default:return(0,e.jsx)(aa.Z,{type:"number",min:0,max:100,onChange:p,defaultValue:n!=null?n:void 0,placeholder:f.formatMessage({id:"select_grade"})})}};return j()},ya=function(a,t){var n;return(n=a.find(function(r){return r.name===t}))===null||n===void 0?void 0:n.id},_a=function(a){var t=a.term,n=a.gradeScales,r=a.defaultFinalGrade,l=a.finalGrades,d=(0,v.useState)(r),f=P()(d,2),p=f[0],j=f[1],S=(0,v.useState)(!1),y=P()(S,2),F=y[0],h=y[1],b=(0,v.useState)(!1),C=P()(b,2),T=C[0],J=C[1],w=(0,s.useIntl)(),A=(0,v.useMemo)(function(){return n.map(function(le){var $=le.name,R=le.id;return{value:R,label:$}})},[n]),k=function($){J(!0),je.ZP.error(w.formatMessage({id:$.data.message}))},ue=(0,v.useCallback)(function(le){if(l!=null&&l.id){if(le===void 0){if(!p)return;h(!0),Ye(p.id).then(function($){$.success&&j(void 0)}).finally(function(){return h(!1)});return}if(p){h(!0),he(p.id,{grade_scale_id:le}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&k($)}).finally(function(){return h(!1)});return}h(!0),ce({grade_term_id:t.id,grade_scale_id:le,lesson_group_user_id:l.id}).then(function($){if($.success){var R=$.data.grades.find(function(I){return I.grade_term.id===t.id});j(R),T&&J(!1)}}).catch(function($){var R;$!=null&&(R=$.data)!==null&&R!==void 0&&R.message&&k($)}).finally(function(){return h(!1)})}},[p,t.id,l==null?void 0:l.id]);return l?(0,e.jsx)(It.default,{allowClear:!0,status:T?"error":"",loading:F,disabled:F||l.semester_closed,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_final_grade"}),style:{width:"100%"},onChange:ue,options:A,defaultValue:ya(n,r==null?void 0:r.grade_name)}):null},Ma=function(a){var t=a.groupAttendanceSchedule,n=a.handleDeleteColumn,r=a.scheduleDeletePermission,l=r===void 0?!1:r,d=t.reduce(function(f,p){return[].concat(Z()(f),[{title:(0,e.jsxs)(G.Z,{children:[(0,bt.WU)(new Date(p.date_from),ct.GC),l&&p.is_outdated&&(0,e.jsx)(Ut.Z,{onClick:function(S){S.stopPropagation(),n(p.id,(0,bt.WU)(new Date(p.date_from),ct.GC))}})]}),dataIndex:"attendance-".concat(p.id),hideInSearch:!0,width:100,align:"center",render:function(S,y){return(0,e.jsx)(ta,{groupAttendanceScheduleId:p.id,attendance:y["attendance-".concat(p==null?void 0:p.id)],studentId:y.id})}}])},[]);return d.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,children:d}:{title:(0,e.jsx)(s.FormattedMessage,{id:"attendance"}),hideInSearch:!0,hideInTable:!0}},Ca=function(a,t){return a.reduce(function(n,r){var l=r.attendances.find(function(d){return d.user_id===t});return l?m()(m()({},n),{},nt()({},"attendance-".concat(r.id),l.value)):n},{})},Ta=function(a){var t=a.reduce(function(n,r){return[].concat(Z()(n),[{dataIndex:"exam-".concat(r.id),title:r.type===g.UL.Manual?(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithWeight",values:r}):(0,e.jsx)(s.FormattedMessage,{id:"examTitleWithoutWeight",values:r}),hideInSearch:!0,width:100,render:function(d,f){var p;return(0,e.jsx)(Sa,{type:r.type,result:f==null||(p=f["exam-".concat(r.id)])===null||p===void 0?void 0:p.result,exam_id:r.id,student_id:f.id})}}])},[]);return t.length?{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,children:t}:{title:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),hideInSearch:!0,hideInTable:!0}},Fa=function(a){return a.reduce(function(t,n){var r=n.result,l=n.id;return m()(m()({},t),{},nt()({},"exam-".concat(l),r))},{})},Ea=function(a,t){return{title:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),hideInSearch:!0,children:a.map(function(n){return{title:n.name,hideInSearch:!0,width:100,align:"center",render:function(l,d){var f;return(0,e.jsx)(_a,{defaultFinalGrade:d["final-grade-".concat(n.id)],finalGrades:d.final_grades,term:n,gradeScales:t},"".concat(d==null||(f=d.final_grades)===null||f===void 0?void 0:f.group_id,"-").concat(n.id))}}})}},Pa=function(a,t){return a.find(function(n){return n.user.id===t})},Za=function(a){var t;return((t=a==null?void 0:a.grades)!==null&&t!==void 0?t:[]).reduce(function(n,r){return m()(m()({},n),{},nt()({},"final-grade-".concat(r.grade_term.id),r))},{})},wa=function(){var a,t=(0,tt.Z)(),n=t.teacherSubjectData,r=t.semester_subject_id,l=(0,v.useState)([]),d=P()(l,2),f=d[0],p=d[1],j=(0,v.useState)(n==null||(a=n.groups)===null||a===void 0||(a=a[0])===null||a===void 0?void 0:a.name),S=P()(j,2),y=S[0],F=S[1],h=(0,v.useState)(null),b=P()(h,2),C=b[0],T=b[1],J=(0,s.useIntl)(),w=(0,v.useRef)(),A=(0,de.T)(),k=A.checkPermission,ue=function(L,ee){Se.Z.confirm({title:J.formatMessage({id:"scheduleDeleteConfirm"},{columnId:L}),okText:J.formatMessage({id:"delete"}),cancelText:J.formatMessage({id:"cancel"}),onOk:ee})},le=function(L,ee){ue(ee,function(){var Fe;He(L),(Fe=w.current)===null||Fe===void 0||Fe.reload()})},$=(0,v.useMemo)(function(){var I;return((I=n==null?void 0:n.groups)!==null&&I!==void 0?I:[]).map(function(L){var ee=L.id,Fe=L.name;return{value:ee,label:Fe}})},[n==null?void 0:n.groups]),R=(0,v.useMemo)(function(){var I;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:$,defaultValue:$==null||(I=$[0])===null||I===void 0?void 0:I.value,allowClear:!1}},{title:(0,e.jsx)(s.FormattedMessage,{id:"surnameAndName",defaultMessage:"Name and surname"}),dataIndex:"full_name",fixed:"left"}].concat(Z()(f),[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",fixed:"right",width:60,render:function(ee,Fe){return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"notes",defaultMessage:"notes"}),children:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{}),onClick:function(){return T({userName:Fe.full_name,userId:Fe.id,groupId:Fe.final_grades.group_id})}})})})}}])},[$,f]);return(0,e.jsxs)(e.Fragment,{children:[(C==null?void 0:C.userId)&&(0,e.jsx)(De,{visible:!!C.userId,onClose:function(){return T(null)},user:{name:C.userName,userId:C.userId,groupId:C.groupId}}),(0,e.jsx)(Y.ZP,{sticky:!0,className:"table-standalone",request:function(){var I=i()(c()().mark(function L(ee){var Fe,Ge,ze,st,ke,Ae,re,pe,H,Je,xe,Ee,Pe,ye,We,Qe,ft,it,ot,St,Mt;return c()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return st=ee.group_id,ke=st===void 0?(Fe=$[0])===null||Fe===void 0?void 0:Fe.value:st,Ae=ee.full_name,re=Ae===void 0?"":Ae,$e.next=3,O([ke]);case 3:if(pe=$e.sent,H=$.find(function(Ct){var pt=Ct.value;return pt===ke}),!(!pe.success||pe.data[0]===void 0||r===null)){$e.next=8;break}return je.ZP.error(J.formatMessage({id:"groupDataMissing"},{group_name:H==null?void 0:H.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 8:return $e.next=10,Promise.all([(0,_t.X)(ke),Ue(ke),Re({group_id:ke,per_page:-1}),Pt(r,(Ge=pe.data)===null||Ge===void 0||(Ge=Ge[0])===null||Ge===void 0?void 0:Ge.tutor_id),W(),N((ze=pe.data)===null||ze===void 0||(ze=ze[0])===null||ze===void 0?void 0:ze.s_subject_scale_form_id)]);case 10:if(Je=$e.sent,xe=P()(Je,6),Ee=xe[0],Pe=xe[1],ye=xe[2],We=xe[3],Qe=xe[4],ft=xe[5],!(!Ee.success||!Pe.success||!ye.success||!We.success||!Qe.success||!ft.success||!H)){$e.next=21;break}return je.ZP.error(J.formatMessage({id:"groupDataMissing"},{group_name:H==null?void 0:H.label})),$e.abrupt("return",{data:[],total:0,success:!1});case 21:return F(H.label),it=Ma({groupAttendanceSchedule:Pe.data,handleDeleteColumn:le,scheduleDeletePermission:k(Ke.Z.PCGSchedulesDelete)||k(Ke.Z.PCGSchedulesDeleteOwn)}),ot=Ta(ye.data),St=Ea(Qe.data,ft.data),p([it,ot,St,{title:(0,e.jsx)(s.FormattedMessage,{id:"proposed_grade"}),hideInSearch:!0,dataIndex:"proposed_grade",align:"center",width:100}]),Mt=Ee.data.users.reduce(function(Ct,pt){var Xt,Ht,Yt,At=pt.id,Jn=pt.academic_teacher_id,Qn=pt.first_name,qn=pt.last_name,ma="".concat(qn," ").concat(Qn),er=pe.data.some(function(ir){return ir.user.id===At});if(Jn!==null&&!er||!ma.toLowerCase().includes(re.toLowerCase()))return Ct;var tr=Ca(Pe.data,At),fa=Jt(ye.data,At),Lt=Pa(pe.data,At),ar=(Xt=qt((Ht=Lt==null?void 0:Lt.s_subject_scale_form_id)!==null&&Ht!==void 0?Ht:0,(Yt=We.data.grade_scale)!==null&&Yt!==void 0?Yt:[]))!==null&&Xt!==void 0?Xt:[],nr=Qt(fa,ar),rr=Fa(fa),sr=Za(Lt);return[].concat(Z()(Ct),[m()(m()(m()(m()({id:At,full_name:ma},tr),rr),sr),{},{proposed_grade:nr,final_grades:Lt})])},[]).sort(function(Ct,pt){return Ct.full_name.localeCompare(pt.full_name)}),$e.abrupt("return",{data:Mt,total:Mt.length,success:!0});case 28:case"end":return $e.stop()}},L)}));return function(L){return I.apply(this,arguments)}}(),columns:R,headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"classRegisterTitleWithGroupName",values:{groupName:y}}),search:{layout:"vertical"},scroll:{x:1500},actionRef:w,pagination:{defaultPageSize:dt.Sl,onChange:function(){var L;return(L=w.current)===null||L===void 0?void 0:L.reload()}},rowKey:"id"})]})},na=o(1413),Da={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"},Ia=Da,Ga=o(84089),Aa=function(a,t){return v.createElement(Ga.Z,(0,na.Z)((0,na.Z)({},a),{},{ref:t,icon:Ia}))},La=v.forwardRef(Aa),Ra=La,ra=o(86738),Ot=o(62235),ut=o(952),$a=o(5966),Oa=o(50335),sa=o(71230),mt=o(15746),Na=o(29477),ka=o(56717),ia=o(95830),ua=function(a){return a===g.UL.Manual||a===g.UL.ManualPass||a===g.UL.ManualGrades},Ua=function(a){var t=a.type,n=a.onDataConverted,r=a.groupSelectDisabled,l=(0,tt.Z)(),d=l.semester_subject_id,f=l.teacherSubjectData,p=(0,v.useState)(null),j=P()(p,2),S=j[0],y=j[1],F=(0,v.useMemo)(function(){var C;return((C=f==null?void 0:f.groups)!==null&&C!==void 0?C:[]).map(function(T){var J=T.id,w=T.name;return{label:w,value:J}})},[]),h={type:t,group_id:S,semester_subject_id:d},b=(0,v.useCallback)(function(C){if(C.success){var T=C.data.results.filter(function(J){var w=J.user_id;return w!==null});if(!T.length)return;n({exam_results:T,group_id:C.data.group_id})}},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ut.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"group"}),children:(0,e.jsx)(It.default,{disabled:r,value:S,onChange:function(T){return y(T)},options:F,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})}),(0,e.jsx)(Na.Z,{name:"file",url:"/api/admin/exams/parse",onUpload:b,onChange:function(T){return!T.fileList.length&&n(void 0)},maxFiles:1,data:h,disabled:!S})]})},Ba=function(a){var t=a.onDataConverted,n=(0,tt.Z)(),r=n.teacherSubjectData,l=n.groupUsers,d=(0,v.useState)(null),f=P()(d,2),p=f[0],j=f[1],S=(0,v.useMemo)(function(){var F;return((F=r==null?void 0:r.groups)!==null&&F!==void 0?F:[]).map(function(h){var b=h.id,C=h.name;return{label:C,value:b}})},[]),y=(0,v.useCallback)(function(){var F=i()(c()().mark(function h(b){var C,T,J,w;return c()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(j(b),T=(C=l.byId)===null||C===void 0?void 0:C[b],T){k.next=4;break}return k.abrupt("return");case 4:return k.prev=4,k.next=7,O([b]);case 7:if(J=k.sent,J.success){k.next=10;break}return k.abrupt("return");case 10:w=T.users.reduce(function(ue,le){var $=le.id,R=le.email,I=le.first_name,L=le.last_name,ee=le.academic_teacher_id,Fe=J.data.some(function(Ge){return Ge.user.id===$});return ee!==null&&!Fe?ue:[].concat(Z()(ue),[{email:R,first_name:I,last_name:L,user_id:$,result:null}])},[]),t({group_id:b,exam_results:w}),k.next=17;break;case 14:k.prev=14,k.t0=k.catch(4),console.error("Error fetching final grades:",k.t0);case 17:case"end":return k.stop()}},h,null,[[4,14]])}));return function(h){return F.apply(this,arguments)}}(),[l.byId]);return(0,e.jsx)(It.default,{value:p,onChange:y,options:S,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select_group"}),style:{width:"100%"}})},Nt=nt()(nt()(nt()(nt()(nt()(nt()({},g.UL.TestPortal,["/teacher-examples/testPortal.png"]),g.UL.TeamsForms,["/teacher-examples/teamsForms.png"]),g.UL.TeamsLecture,["/teacher-examples/teamsLecture.png","/teacher-examples/teamsLectureWithoutMail.png"]),g.UL.Manual,[]),g.UL.ManualPass,[]),g.UL.ManualGrades,[]),Wa=function(a){var t=a.images,n=(0,v.useState)(!1),r=P()(n,2),l=r[0],d=r[1],f=(0,v.useCallback)(function(){return d(!0)},[]);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"see_file_example_image"}),children:(0,e.jsx)(x.ZP,{onClick:f,icon:(0,e.jsx)(ka.Z,{})})}),(0,e.jsx)(ia.Z.PreviewGroup,{preview:{visible:l,onVisibleChange:d},children:t.map(function(p){return(0,e.jsx)(ia.Z,{style:{display:"none"},src:p},p)})})]})},Ka=function(a){var t,n=a.type,r=a.onOk,l=a.onCancel,d=a.okDisabled,f=(t=Nt==null?void 0:Nt[n])!==null&&t!==void 0?t:Nt[g.UL.Manual];return(0,e.jsxs)(G.Z,{style:{width:"100%",justifyContent:f.length?"space-between":"flex-end"},children:[!!f.length&&(0,e.jsx)(Wa,{images:f}),(0,e.jsxs)(G.Z,{children:[(0,e.jsx)(x.ZP,{onClick:l,children:(0,e.jsx)(s.FormattedMessage,{id:"cancel"})}),(0,e.jsx)(x.ZP,{type:"primary",disabled:d,onClick:r,children:(0,e.jsx)(s.FormattedMessage,{id:"ok"})})]})]})},Va=[g.UL.TeamsLecture,g.UL.TestPortal,g.UL.TeamsForms],za=function(a){var t=a.open,n=a.closeModal,r=a.onSuccess,l=a.type,d=(0,tt.Z)(),f=d.teacherSubjectData,p=d.fetchGroupUsers,j=(0,v.useState)(),S=P()(j,2),y=S[0],F=S[1];return(0,v.useEffect)(function(){if(ua(l)&&t){var h;f==null||(h=f.groups)===null||h===void 0||h.forEach(function(b){var C=b.id;return p(C)})}},[l,t]),(0,e.jsxs)(Se.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.".concat(l,"Convert")}),width:"40vw",open:t,onCancel:n,footer:(0,e.jsx)(Ka,{type:l,onOk:function(){y&&r(y)},onCancel:n,okDisabled:!y}),children:[Va.includes(l)&&(0,e.jsx)(Ua,{type:l,onDataConverted:F,groupSelectDisabled:!!y}),ua(l)&&(0,e.jsx)(Ba,{onDataConverted:F,examType:l})]})},Xa=function(a){var t=a.onSelect;return(0,e.jsxs)(sa.Z,{gutter:[16,16],children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsForms)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeamsForms",defaultMessage:"uploadFile.MsTeamsForms"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.TestPortal)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.TestPortal",defaultMessage:"uploadFile.TestPortal"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.TeamsLecture)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadFile.MsTeams",defaultMessage:"uploadFile.MsTeams"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.Manual)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManually",defaultMessage:"uploadGradesManually"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.ManualPass)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyPass",defaultMessage:"uploadGradesManuallyPass"})})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){return t(g.UL.ManualGrades)},children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGradesManuallyGrades",defaultMessage:"uploadGradesManuallyGrades"})})})]})},Ha=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",editable:!1}],Ya=function(a){var t,n=a.exam_id,r=ut.ZP.useForm(),l=P()(r,1),d=l[0],f=(0,v.useState)(),p=P()(f,2),j=p[0],S=p[1],y=(0,v.useState)(),F=P()(y,2),h=F[0],b=F[1],C=(0,v.useState)(!1),T=P()(C,2),J=T[0],w=T[1],A=(0,tt.Z)(),k=A.semester_subject_id,ue=A.getGroupById,le=(0,v.useMemo)(function(){var R;return((R=h==null?void 0:h.exam_results)!==null&&R!==void 0?R:[]).map(function(I){var L=I.user_id;return L})},[h==null?void 0:h.exam_results]);(0,v.useEffect)(function(){var R=Number(n);n==="new"&&(S(void 0),b(void 0),d.resetFields()),n!=="new"&&!Number.isNaN(R)&&(w(!0),Ie(R).then(function(I){if(I.success){var L=I.data,ee=L.type,Fe=L.results,Ge=L.title,ze=L.weight,st=L.passed_at,ke=L.group_id;S(ee),b({group_id:ke,exam_results:Fe}),d.setFieldsValue({title:Ge,weight:ze,passed_at:st})}}).finally(function(){return w(!1)}))},[n]);var $=(0,v.useCallback)(function(){S(void 0),b(void 0)},[]);return J?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[j&&(0,e.jsx)(za,{open:!!(j&&!h),type:j,closeModal:$,onSuccess:b}),(0,e.jsxs)(ut.ZP,{form:d,submitter:j===void 0||!h?!1:void 0,onFinish:function(){var R=i()(c()().mark(function I(L){var ee,Fe,Ge,ze,st,ke,Ae,re;return c()().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(h&&typeof k=="number")){H.next=16;break}if(ee=L.title,Fe=L.passed_at,Ge=L.weight,ze=Number(n),st=h.exam_results,ke=h.group_id,Ae={type:j,semester_subject_id:k,title:ee,passed_at:Fe,weight:Ge,group_id:ke,results:st},!Number.isNaN(ze)){H.next=11;break}return H.next=8,me(Ae);case 8:H.t0=H.sent,H.next=14;break;case 11:return H.next=13,B(ze,Ae);case 13:H.t0=H.sent;case 14:re=H.t0,re.success&&s.history.push("/teacher/subjects/".concat(k,"/exams"));case 16:return H.abrupt("return",!0);case 17:case"end":return H.stop()}},I)}));return function(I){return R.apply(this,arguments)}}(),onReset:$,children:[(0,e.jsxs)(ut.ZP.Group,{children:[(0,e.jsx)($a.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"examTitle",defaultMessage:"examTitle"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"title"}),(0,e.jsx)(Oa.Z,{label:(0,e.jsx)(s.FormattedMessage,{id:"datePassingExam",defaultMessage:"datePassingExam"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],width:"lg",name:"passed_at"}),j!==g.UL.ManualGrades&&j!==g.UL.ManualPass&&(0,e.jsx)(ut.ZP.Item,{name:"weight",label:(0,e.jsx)(s.FormattedMessage,{id:"examImportance",defaultMessage:"examImportance"}),rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:1,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:1,max:100}})}],children:(0,e.jsx)(aa.Z,{})})]}),j&&h&&(0,e.jsx)(Y.ZP,{rowKey:"user_id",headerTitle:(t=ue(h.group_id))===null||t===void 0?void 0:t.name,editable:{type:"single",editableKeys:le,onValuesChange:function(I,L){return b({group_id:h.group_id,exam_results:L})}},cardProps:{bodyStyle:{paddingInline:0}},search:!1,dataSource:h.exam_results.sort(function(R,I){return R.last_name.localeCompare(I.last_name)}),pagination:{defaultPageSize:dt.Sl},columns:[].concat(Ha,[function(){switch(j){case g.UL.ManualPass:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.FW}};case g.UL.ManualGrades:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"select",fieldProps:{options:dt.BP}};default:return{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}}}()])}),!h&&(0,e.jsx)(Xa,{onSelect:S})]})]})},Ja=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"examResult"}),dataIndex:"result",hideInSearch:!0}],Qa=function(a){var t=a.exam_id,n=(0,v.useState)(""),r=P()(n,2),l=r[0],d=r[1];return(0,e.jsx)(Y.ZP,{className:"table-standalone",rowKey:"user_id",search:!1,headerTitle:l,pagination:{defaultPageSize:dt.Sl},request:i()(c()().mark(function f(){var p;return c()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.next=2,Ie(t);case 2:if(p=S.sent,!p.success){S.next=6;break}return d(p.data.title),S.abrupt("return",{total:p.data.results.length,success:!0,data:p.data.results});case 6:return S.abrupt("return",[]);case 7:case"end":return S.stop()}},f)})),columns:Ja})},qa=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"id",sorter:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"title",defaultMessage:"title"}),dataIndex:"title",hideInSearch:!0,sorter:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"type",defaultMessage:"type"}),dataIndex:"type",sorter:!0,render:function(a,t){return(0,e.jsx)(s.FormattedMessage,{id:"ExamGradeType.".concat(t.type)})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.exam_date",defaultMessage:"Exam date"}),dataIndex:"passed_at",sorter:!0,render:function(a,t){return t.passed_at&&(0,bt.WU)(new Date(t.passed_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",sorter:!0,render:function(a,t){return t.weight?t.weight+"%":""}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",sorter:!0,render:function(a,t){return t.created_at&&(0,bt.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),dataIndex:"semester",sorter:!0,render:function(a,t){return(0,e.jsx)(s.FormattedMessage,{id:"SemesterType.".concat(t.semester.type),values:{year:t.semester.year}})}},{title:(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),dataIndex:"group_id",sorter:!0,render:function(a,t){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:t.group_id},t.group_id)}}],en=function(){var a,t=(0,v.useRef)(),n=(0,tt.Z)(),r=n.semester_subject_id,l=(0,s.useLocation)(),d=new URLSearchParams(l.search),f=(a=d.get("exam_id"))!==null&&a!==void 0?a:null,p=d.get("results");return p!==null&&!Number.isNaN(Number(p))?(0,e.jsx)(Qa,{exam_id:Number(p)}):f!==null?(0,e.jsx)(Ya,{exam_id:f}):(0,e.jsx)(Y.ZP,{className:"table-standalone",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),actionRef:t,search:!1,rowKey:"id",pagination:{defaultPageSize:dt.Sl},request:function(){var j=i()(c()().mark(function S(y,F){var h,b,C,T;return c()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(h=y.current,b=y.pageSize,r!==null){w.next=3;break}return w.abrupt("return",{data:[],total:0,success:!1});case 3:return C=F&&Object.entries(F)[0],w.next=6,Re({per_page:b,page:h,semester_subject_id:Number.isNaN(r)?void 0:r,order_by:C&&C[0],order:C&&(C[1]==="ascend"?"ASC":"DESC")});case 6:if(T=w.sent,!T.success){w.next=9;break}return w.abrupt("return",{data:T.data,total:T.meta.total,success:!0});case 9:return w.abrupt("return",{data:[],total:0,success:!1});case 10:case"end":return w.stop()}},S)}));return function(S,y){return j.apply(this,arguments)}}(),columns:[].concat(qa,[{title:(0,e.jsx)(s.FormattedMessage,{id:"pages.searchTable.titleOption"}),dataIndex:"option",valueType:"option",render:function(S,y){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(y.semester_subject_id,"/exams?exam_id=").concat(y.id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit",defaultMessage:"edit"}),children:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{})})})},"edit"),(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(y.semester_subject_id,"/exams?results=").concat(y.id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.results",defaultMessage:"results"}),children:(0,e.jsx)(x.ZP,{icon:(0,e.jsx)(Ra,{})})})},"results"),(0,e.jsx)(ra.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:i()(c()().mark(function F(){var h;return c()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,Et(y.id);case 2:h=C.sent,h.success&&t.current&&t.current.reload();case 4:case"end":return C.stop()}},F)})),okText:(0,e.jsx)(s.FormattedMessage,{id:"yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no"}),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Ut.Z,{}),danger:!0})})},"delete")]}}])})},tn=o(69753),oa=o(44167),an=o(84665),nn=["type","defaultRender"],rn=["type","defaultRender"],sn=function(a){var t=a.url;return(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"download"}),children:(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){window.open(t,"_blank","noopener noreferrer")},icon:(0,e.jsx)(tn.Z,{})})})},un=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID"}),dataIndex:"id",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at"}),dataIndex:"created_at",hideInSearch:!0,render:function(a,t){return(0,bt.WU)(new Date(t.created_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_by"}),dataIndex:"created_by",renderFormItem:function(a,t,n){var r=t.type,l=t.defaultRender,d=$t()(t,nn);if(r==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},d),{},{state:{type:f}}))},render:function(a,t){var n,r;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.created_by.id,text:t!=null&&(n=t.created_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(r=t.created_by)!==null&&r!==void 0&&r.last_name?"".concat(t.created_by.first_name," ").concat(t.created_by.last_name):void 0},t.created_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_at"}),dataIndex:"exported_at",hideInSearch:!0,render:function(a,t){return(0,bt.WU)(new Date(t.exported_at),ct.Cu)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"exported_by"}),dataIndex:"exported_by",renderFormItem:function(a,t,n){var r=t.type,l=t.defaultRender,d=$t()(t,rn);if(r==="form")return null;var f=n.getFieldValue("state");return(0,e.jsx)(oa.Z,m()(m()({},d),{},{state:{type:f}}))},render:function(a,t){var n,r;return(0,e.jsx)(Ot.Z,{type:"EscolaLms\\Core\\Models\\User",type_id:t.exported_by.id,text:t!=null&&(n=t.exported_by)!==null&&n!==void 0&&n.first_name&&t!==null&&t!==void 0&&(r=t.exported_by)!==null&&r!==void 0&&r.last_name?"".concat(t.exported_by.first_name," ").concat(t.exported_by.last_name):void 0},t.exported_by.id)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"version"}),dataIndex:"version",hideInSearch:!0},{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(a,t){return[(0,e.jsx)(sn,{url:t.url},"download")]}}],on=function(){var a,t=(0,tt.Z)(),n=t.teacherSubjectData,r=(0,v.useMemo)(function(){var d;return((d=n==null?void 0:n.groups)!==null&&d!==void 0?d:[]).map(function(f){var p=f.id,j=f.name;return{value:p,label:j}})},[n==null?void 0:n.groups]),l=(0,v.useMemo)(function(){var d;return[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",hideInTable:!0,valueType:"select",fieldProps:{options:r,defaultValue:n==null||(d=n.groups)===null||d===void 0||(d=d[0])===null||d===void 0?void 0:d.id,allowClear:!1}}].concat(un)},[n==null||(a=n.groups)===null||a===void 0||(a=a[0])===null||a===void 0?void 0:a.id,r]);return(0,e.jsx)(Y.ZP,{className:"table-standalone",request:function(){var d=i()(c()().mark(function f(p){var j,S,y,F,h,b;return c()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return S=p.group_id,y=S===void 0?n==null||(j=n.groups)===null||j===void 0||(j=j[0])===null||j===void 0?void 0:j.id:S,F=p.created_by,h=p.exported_by,T.next=3,(0,an.v)({group_id:y,created_by:F,exported_by:h});case 3:if(b=T.sent,b.success){T.next=6;break}return T.abrupt("return",{success:!1,data:[],total:0});case 6:return T.abrupt("return",{success:!0,data:b.data,total:b.data.length});case 7:case"end":return T.stop()}},f)}));return function(f){return d.apply(this,arguments)}}(),columns:l,search:{layout:"vertical"},scroll:{x:1500},pagination:{defaultPageSize:dt.Sl}})},la=o(64317),Bt=o(96074),da=o(11312),ln=o(87366),Wt=o(99100),dn=["attendances"];function cn(u){return function(t){u(function(n){return m()(m()({},n),{},{loading:t})})}}function ca(u,a){return Kt.apply(this,arguments)}function Kt(){return Kt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a(!0),r.prev=1,r.abrupt("return",t());case 3:return r.prev=3,a(!1),r.finish(3);case 6:case"end":return r.stop()}},u,null,[[1,,3,6]])})),Kt.apply(this,arguments)}function mn(u,a){var t=(0,v.useState)({loading:!1}),n=P()(t,2),r=n[0],l=n[1],d=(0,v.useCallback)(cn(l),[]),f=(0,v.useCallback)(i()(c()().mark(function j(){var S;return c()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,V(u,a);case 2:if(S=F.sent,S.success){F.next=5;break}return F.abrupt("return",S);case 5:return l(function(h){return m()(m()({},h),{},{data:S.data})}),F.abrupt("return",S);case 7:case"end":return F.stop()}},j)})),[a,u]),p=(0,v.useCallback)(function(j){return ca(d,function(){return Ye(j).then(f)})},[f]);return(0,v.useEffect)(function(){ca(d,f)},[f]),{finalGrades:r,deleteFinalGrade:p}}function fn(){var u=(0,v.useState)({loading:!1}),a=P()(u,2),t=a[0],n=a[1];return(0,v.useEffect)(function(){n(function(r){return m()(m()({},r),{},{loading:!0})}),W().then(function(r){r.success&&n(function(l){return m()(m()({},l),{},{data:r.data})})}).finally(function(){n(function(r){return m()(m()({},r),{},{loading:!1})})})},[]),{gradeTerms:t}}function vn(u){var a=(0,v.useState)({loading:!1}),t=P()(a,2),n=t[0],r=t[1];return(0,v.useEffect)(function(){u!==void 0&&(r(function(l){return m()(m()({},l),{},{loading:!0})}),N(u).then(function(l){l.success&&r(function(d){return m()(m()({},d),{},{data:l.data})})}).finally(function(){r(function(l){return m()(m()({},l),{},{loading:!1})})}))},[u]),{subjectGradeScales:n}}function pn(u,a,t){var n=(0,v.useState)({loading:!1}),r=P()(n,2),l=r[0],d=r[1];return(0,v.useEffect)(function(){typeof u!="number"||typeof a!="number"||typeof t!="number"||(d(function(f){return m()(m()({},f),{},{loading:!0})}),Pt(u,a).then(function(f){f.success&&d(function(p){var j,S;return m()(m()({},p),{},{data:(j=qt(t,(S=f.data.grade_scale)!==null&&S!==void 0?S:[]))===null||j===void 0?void 0:j.map(function(y,F){return m()(m()({},y),{},{id:F})})})})}).finally(function(){d(function(f){return m()(m()({},f),{},{loading:!1})})}))},[u,a]),{tutorGradeScales:l}}function gn(u,a){var t=(0,v.useState)({loading:!1}),n=P()(t,2),r=n[0],l=n[1],d=(0,v.useCallback)(function(){l(function(f){return m()(m()({},f),{},{loading:!0})}),Ue(u).then(function(f){if(f.success){var p=f.data.reduce(function(j,S){var y=S.attendances,F=$t()(S,dn),h=y.find(function(b){return b.user_id===a});return h?[].concat(Z()(j),[m()(m()({},F),{},{attendance:h})]):j},[]);l(function(j){return m()(m()({},j),{},{data:p})})}}).finally(function(){l(function(f){return m()(m()({},f),{},{loading:!1})})})},[u,a]);return(0,v.useEffect)(function(){d()},[d]),{userAttendanceSchedules:r,fetchUserAttendanceSchedules:d}}function hn(u,a){var t=(0,v.useState)({loading:!1}),n=P()(t,2),r=n[0],l=n[1];return(0,v.useEffect)(function(){a&&(l(function(d){return m()(m()({},d),{},{loading:!0})}),Re({student_id:u,semester_subject_id:a}).then(function(d){if(d.success){var f=Jt(d.data,u);l(function(p){return m()(m()({},p),{},{data:f})})}}).finally(function(){l(function(d){return m()(m()({},d),{},{loading:!1})})}))},[u,a]),{studentExams:r}}function xn(u,a){var t=(0,v.useState)({loading:!1}),n=P()(t,2),r=n[0],l=n[1],d=(0,v.useState)({loading:!1}),f=P()(d,2),p=f[0],j=f[1],S=(0,v.useState)({loading:!1}),y=P()(S,2),F=y[0],h=y[1];return(0,v.useEffect)(function(){l(function(b){return m()(m()({},b),{},{loading:!0})}),(0,Wt.N7)({group_id:u}).then(function(b){b.success&&l(function(C){return m()(m()({},C),{},{data:b.data})})}).finally(function(){l(function(b){return m()(m()({},b),{},{loading:!1})})})},[u]),(0,v.useEffect)(function(){r.data&&(h(function(b){return m()(m()({},b),{},{loading:!0})}),Promise.all(r.data.map(function(b){var C=b.id;return(0,Wt.Nx)(Number(C))})).then(function(b){b.forEach(function(C){C.success&&h(function(T){return m()(m()({},T),{},{data:m()(m()({},T.data),{},nt()({},Number(C.data.id),(0,ln.uS)(C.data.lessons)))})})})}).finally(function(){h(function(b){return m()(m()({},b),{},{loading:!1})})}),j(function(b){return m()(m()({},b),{},{loading:!0})}),Promise.all(r.data.map(function(b){var C=b.id;return(0,Wt.ue)(Number(C),["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics","EscolaLms\\Reports\\Stats\\Course\\AttendanceList"]).then(function(T){if(T.success){var J,w,A=((J=T.data["EscolaLms\\Reports\\Stats\\Course\\FinishedTopics"])!==null&&J!==void 0?J:[]).filter(function(ue){return ue.id===a}),k=(w=T.data["EscolaLms\\Reports\\Stats\\Course\\AttendanceList"])!==null&&w!==void 0?w:[];j(function(ue){return m()(m()({},ue),{},{data:m()(m()({},ue.data),{},nt()({},Number(C),{finishedTopics:A,attendanceList:k}))})})}})})).finally(function(){return j(function(b){return m()(m()({},b),{},{loading:!1})})}))},[r.data,a]),{userCourses:r,userCoursesStats:p,userCoursesTopics:F}}var jn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade"},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent"}],bn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"date"}),dataIndex:"date_from",render:function(a,t){return(0,bt.WU)(new Date(t.date_from),ct.GC)}}],Sn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"title"},{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.Exams.grade_weight",defaultMessage:"Weight"}),dataIndex:"weight",valueType:"percent"},{title:(0,e.jsx)(s.FormattedMessage,{id:"created_at",defaultMessage:"Created at"}),dataIndex:"created_at",render:function(a,t){return(0,bt.WU)(new Date(t.created_at),ct.GC)}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"result",render:function(a,t){return"".concat(t.result.result," ").concat(t.weight?"%":"")}}],yn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"name"}),dataIndex:"name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"issued_at"}),dataIndex:"grade",render:function(a,t){var n,r;return(n=t.grade)!==null&&n!==void 0&&n.grade_date?(0,bt.WU)(new Date((r=t.grade)===null||r===void 0?void 0:r.grade_date),ct.GC):"-"}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",render:function(a,t){var n,r;return(n=(r=t.grade)===null||r===void 0?void 0:r.grade_name)!==null&&n!==void 0?n:"-"}}],kt=6,_n=function(a){var t,n,r,l,d=a.user_id,f=a.group_id,p=(0,tt.Z)(),j=p.semester_subject_id,S=hn(d,j),y=S.studentExams,F=mn(f,d),h=F.finalGrades,b=F.deleteFinalGrade,C=fn(),T=C.gradeTerms,J=vn((t=h.data)===null||t===void 0?void 0:t.s_subject_scale_form_id),w=J.subjectGradeScales,A=pn(j,(n=h.data)===null||n===void 0?void 0:n.tutor_id,(r=h.data)===null||r===void 0?void 0:r.s_subject_scale_form_id),k=A.tutorGradeScales,ue=gn(f,d),le=ue.userAttendanceSchedules,$=ue.fetchUserAttendanceSchedules,R=xn(f,d),I=R.userCourses,L=R.userCoursesStats,ee=R.userCoursesTopics,Fe=ut.ZP.useForm(),Ge=P()(Fe,1),ze=Ge[0],st=(0,v.useMemo)(function(){var Ee;return((Ee=T.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var ye=Pe.id,We=Pe.name;return{label:We,value:ye}})},[T.data]),ke=(0,v.useMemo)(function(){var Ee;return((Ee=w.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var ye=Pe.name,We=Pe.id;return{label:ye,value:We}})},[w.data]),Ae=(0,v.useMemo)(function(){var Ee,Pe;return Qt((Ee=y.data)!==null&&Ee!==void 0?Ee:[],(Pe=k.data)!==null&&Pe!==void 0?Pe:[])},[y.data,k.data]),re=(0,v.useCallback)(function(){var Ee=i()(c()().mark(function Pe(ye){var We,Qe,ft,it,ot,St,Mt;return c()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(ft=ye.grade_scale_id,it=ye.grade_term_id,((We=h.data)===null||We===void 0?void 0:We.id)!==void 0){$e.next=3;break}return $e.abrupt("return");case 3:if(ot=(Qe=h.data)===null||Qe===void 0?void 0:Qe.grades.find(function(Ct){var pt=Ct.grade_term;return pt.id===it}),!ot){$e.next=11;break}return $e.next=7,he(ot.id,{grade_scale_id:ft});case 7:return St=$e.sent,je.ZP[St.success?"success":"error"](St.message),St.success&&s.history.push("/teacher/subjects/".concat(j,"/final-grades")),$e.abrupt("return");case 11:return $e.next=13,ce({grade_scale_id:ft,grade_term_id:it,lesson_group_user_id:h.data.id});case 13:Mt=$e.sent,je.ZP[Mt.success?"success":"error"](Mt.message),Mt.success&&s.history.push("/teacher/subjects/".concat(j,"/final-grades"));case 16:case"end":return $e.stop()}},Pe)}));return function(Pe){return Ee.apply(this,arguments)}}(),[h.data,j]),pe=(0,v.useMemo)(function(){return[].concat(yn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options",defaultMessage:"options"}),dataIndex:"option",valueType:"option",render:function(Pe,ye){var We;return typeof(ye==null||(We=ye.grade)===null||We===void 0?void 0:We.id)=="number"?[(0,e.jsx)(ra.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"deleteQuestion",defaultMessage:"Are you sure to delete this record?"}),onConfirm:function(){return b(ye.grade.id)},okText:(0,e.jsx)(s.FormattedMessage,{id:"yes",defaultMessage:"Yes"}),cancelText:(0,e.jsx)(s.FormattedMessage,{id:"no",defaultMessage:"No"}),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"delete",defaultMessage:"delete"}),children:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Ut.Z,{}),danger:!0})})},"delete")]:[]}}])},[]),H=(0,v.useMemo)(function(){var Ee;return((Ee=T.data)!==null&&Ee!==void 0?Ee:[]).map(function(Pe){var ye;return m()(m()({},Pe),{},{grade:(ye=h.data)===null||ye===void 0?void 0:ye.grades.find(function(We){var Qe=We.grade_term;return Qe.id===Pe.id})})})},[h.data,T.data]),Je=I.loading&&!I.data||L.loading&&!L.data||ee.loading&&!ee.data,xe=!!(I.data&&L.data&&ee.data);return h.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[h.data&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Student",values:h.data.user})}),(0,e.jsx)(Bt.Z,{})]}),(0,e.jsxs)(sa.Z,{gutter:[48,48],justify:"space-between",children:[(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Y.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.StudentPartialGrades"}),search:!1,pagination:{pageSize:kt},dataSource:y.data,loading:y.loading,columns:Sn,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Y.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrades"}),search:!1,pagination:{pageSize:kt},dataSource:H,loading:h.loading||T.loading,columns:pe,options:!1,cardProps:{bodyStyle:{padding:0}}})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Y.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendances"}),search:!1,options:!1,pagination:{pageSize:kt},cardProps:{bodyStyle:{padding:0}},dataSource:le.data,loading:le.loading,columns:[].concat(bn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.Attendance"}),dataIndex:"attendance",render:function(Pe,ye){return(0,e.jsx)(ta,{groupAttendanceScheduleId:ye.id,studentId:d,attendance:ye.attendance.value,onSuccess:$})}}])})}),(0,e.jsx)(mt.Z,{span:12,children:(0,e.jsx)(Y.ZP,{rowKey:"id",headerTitle:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradesScale"}),search:!1,options:!1,pagination:{pageSize:kt},cardProps:{bodyStyle:{padding:0}},dataSource:k.data,loading:k.loading,columns:jn})}),Je&&(0,e.jsx)(Oe.Z,{}),xe&&((l=I.data)===null||l===void 0?void 0:l.map(function(Ee){var Pe,ye,We,Qe,ft,it,ot=Ee.id,St=Ee.title;return(0,e.jsxs)(mt.Z,{span:24,children:[(0,e.jsx)(K.Z.Text,{style:{fontSize:"16px",fontWeight:500},children:St}),(0,e.jsx)(da.Du,{course_id:Number(ot),topics:(Pe=(ye=ee.data)===null||ye===void 0?void 0:ye[Number(ot)])!==null&&Pe!==void 0?Pe:[],stats:(We=(Qe=L.data)===null||Qe===void 0||(Qe=Qe[Number(ot)])===null||Qe===void 0?void 0:Qe.finishedTopics)!==null&&We!==void 0?We:[]}),(0,e.jsx)(da.nu,{stats:(ft=(it=L.data)===null||it===void 0||(it=it[Number(ot)])===null||it===void 0?void 0:it.attendanceList)!==null&&ft!==void 0?ft:[]})]},ot)}))]}),(0,e.jsx)(ut.ZP,{form:ze,onFinish:re,children:(0,e.jsxs)(ut.ZP.Group,{style:{display:"flex",flexDirection:"column",paddingTop:"48px"},title:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.IssueAssessment"}),titleStyle:{flex:"unset"},align:"center",children:[(0,e.jsx)(la.Z,{name:"grade_term_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.GradeTerm"}),options:st,width:"sm",fieldProps:{loading:T.loading}}),(0,e.jsx)(la.Z,{name:"grade_scale_id",rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})}],label:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.FinalGrade"}),options:ke,fieldProps:{loading:h.loading||w.loading}}),(0,e.jsx)(ut.ZP.Item,{children:(0,e.jsx)(s.FormattedMessage,{id:"TeacherSubjects.FinalGrades.ProposedGrade",values:{grade:Ae}})})]})})]})},Mn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name"}),dataIndex:"first_name",render:function(a,t){return t.user.first_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name"}),dataIndex:"last_name",render:function(a,t){return t.user.last_name}},{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),hideInSearch:!0,dataIndex:"grades",render:function(a,t){return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:t.grades.length?t.grades.map(function(n){var r=n.grade_name,l=n.grade_term,d=n.id;return(0,e.jsxs)(K.Z.Text,{children:[l.name,": ",r]},d)}):"-"})}}],Cn=function(){var a,t,n=(0,s.useLocation)(),r=new URLSearchParams(n.search),l=(a=r.get("user_id"))!==null&&a!==void 0?a:null,d=(t=r.get("group_id"))!==null&&t!==void 0?t:null,f=(0,tt.Z)(),p=f.teacherSubjectData,j=f.semester_subject_id,S=(0,v.useMemo)(function(){var y;return((y=p==null?void 0:p.groups)!==null&&y!==void 0?y:[]).map(function(F){var h=F.id,b=F.name;return{label:b,value:h}})},[p==null?void 0:p.groups]);return l!==null&&d!==null?(0,e.jsx)(_n,{user_id:Number(l),group_id:Number(d)}):(0,e.jsx)(Y.ZP,{className:"table-standalone",rowKey:"id",search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var y=i()(c()().mark(function F(h){var b,C,T,J,w,A,k,ue,le,$;return c()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return C=h.group_id,T=C===void 0?[]:C,J=h.first_name,w=J===void 0?"":J,A=h.last_name,k=A===void 0?"":A,ue=((b=p==null?void 0:p.groups)!==null&&b!==void 0?b:[]).map(function(L){var ee=L.id;return ee}),I.next=4,O(T.length===0?ue:T);case 4:if(le=I.sent,le.success){I.next=7;break}return I.abrupt("return",{success:!1,total:0,data:[]});case 7:return $=le.data.filter(function(L){var ee=L.user;return ee.first_name.toLowerCase().includes(w.toLowerCase())&&ee.last_name.toLowerCase().includes(k.toLowerCase())}),I.abrupt("return",{success:!0,total:$.length,data:$});case 9:case"end":return I.stop()}},F)}));return function(F){return y.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"group"}),dataIndex:"group_id",valueType:"select",fieldProps:{options:S,mode:"multiple"},render:function(F,h){return(0,e.jsx)(Ot.Z,{type:"Students",type_id:h.group_id},h.group_id)}}].concat(Mn,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),hideInSearch:!0,render:function(F,h){return[(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(j,"/final-grades?user_id=").concat(h.user.id,"&group_id=").concat(h.group_id),children:(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"edit"}),children:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Dt.Z,{})})})},"edit")]}}])})},Tn=o(88284),Fn=o(88280),En=[{title:(0,e.jsx)(s.FormattedMessage,{id:"grade"}),dataIndex:"grade",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"degree"}),dataIndex:"name",editable:!1},{title:(0,e.jsx)(s.FormattedMessage,{id:"min_percent"}),dataIndex:"grade_value",valueType:"percent",formItemProps:{rules:[{required:!0,message:(0,e.jsx)(s.FormattedMessage,{id:"field_required"})},{type:"number",min:0,max:100,message:(0,e.jsx)(s.FormattedMessage,{id:"number_between",values:{min:0,max:100}})}]}}],Pn=function(a){var t=a.subjectTutorGradeScale,n=a.onFormSubmit,r=(0,v.useState)([]),l=P()(r,2),d=l[0],f=l[1],p=(0,v.useRef)(),j=ut.ZP.useForm(),S=P()(j,1),y=S[0];return(0,v.useEffect)(function(){var F,h=((F=t.scale)!==null&&F!==void 0?F:[]).map(function(b,C){return m()(m()({},b),{},{id:String((C+1)*100)})});y.setFieldValue("table",h)},[]),(0,e.jsx)(ut.ZP,{form:y,onFinish:n,submitter:{render:function(h,b){var C=P()(b,2),T=C[1];return[T]}},children:(0,e.jsx)(Fn.Z,{name:"table",rowKey:"id",actionRef:p,formItemProps:{label:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"})},cardProps:{bodyStyle:{padding:0}},recordCreatorProps:!1,columns:[].concat(En,[{title:(0,e.jsx)(s.FormattedMessage,{id:"options"}),valueType:"option",render:function(h,b){return(0,e.jsx)(x.ZP,{type:"primary",onClick:function(){var T;return(T=p.current)===null||T===void 0?void 0:T.startEditable(b.id)},icon:(0,e.jsx)(Dt.Z,{})})}}]),editable:{form:y,type:"multiple",editableKeys:d,saveText:(0,e.jsx)(x.ZP,{type:"primary",icon:(0,e.jsx)(Tn.Z,{})}),onChange:f,actionRender:function(h,b,C){return[C.save]}}})})},Zn=function(){var a,t,n=(0,s.useModel)("@@initialState"),r=n.initialState,l=(0,tt.Z)(),d=l.semester_subject_id,f=l.tutors,p=(0,v.useState)(),j=P()(p,2),S=j[0],y=j[1],F=(0,v.useState)(!1),h=P()(F,2),b=h[0],C=h[1],T=(0,v.useState)(null),J=P()(T,2),w=J[0],A=J[1],k=(0,v.useMemo)(function(){return!!f.data.find(function(R){var I,L=R.id;return L===(r==null||(I=r.currentUser)===null||I===void 0?void 0:I.id)})},[f.data,r==null||(a=r.currentUser)===null||a===void 0?void 0:a.id]),ue=(0,v.useMemo)(function(){return f.data.map(function(R){var I=R.id,L=R.first_name,ee=R.last_name;return{label:"".concat(L," ").concat(ee),value:I}})},[f.data]),le=(0,v.useCallback)(function(){d===null||w===null||(C(!0),y(void 0),Pt(d,w).then(function(R){R.success&&y(R.data)}).finally(function(){C(!1)}))},[d,w]),$=(0,v.useCallback)(function(R,I){return function(){var L=i()(c()().mark(function ee(Fe){var Ge,ze;return c()().wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:if(!(d===null||w===null)){ke.next=2;break}return ke.abrupt("return");case 2:return Ge=R.reduce(function(Ae,re){return re.s_subject_scale_form_id===I?[].concat(Z()(Ae),[{s_subject_scale_form_id:I,scale:Fe.table.map(function(pe){var H=pe.name,Je=pe.grade,xe=pe.grade_value;return{name:H,grade:Je,grade_value:xe}})}]):[].concat(Z()(Ae),[re])},[]),ke.next=5,Gt(d,w,{grade_scale:Ge});case 5:ze=ke.sent,ze.success&&le();case 7:case"end":return ke.stop()}},ee)}));return function(ee){return L.apply(this,arguments)}}()},[w,d]);return(0,v.useEffect)(function(){var R,I;if(!k||!(r!=null&&(R=r.currentUser)!==null&&R!==void 0&&R.id)){var L;if((L=f.data)!==null&&L!==void 0&&L[0]){var ee;A((ee=f.data)===null||ee===void 0?void 0:ee[0].id)}return}A(r==null||(I=r.currentUser)===null||I===void 0?void 0:I.id)},[r==null||(t=r.currentUser)===null||t===void 0?void 0:t.id,k]),(0,v.useEffect)(function(){le()},[le]),f.loading?(0,e.jsx)(Oe.Z,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ut.ZP.Item,{label:(0,e.jsx)(s.FormattedMessage,{id:"menu.Teacher"}),children:(0,e.jsx)(It.default,{disabled:k,placeholder:(0,e.jsx)(s.FormattedMessage,{id:"select"}),options:ue,value:w,onChange:function(I){return A(I)}})}),(0,e.jsx)(Bt.Z,{}),b&&!S&&(0,e.jsx)(Oe.Z,{}),S!=null&&S.grade_scale?S.grade_scale.map(function(R,I){var L;return(0,e.jsxs)(v.Fragment,{children:[I>0&&(0,e.jsx)(Bt.Z,{}),(0,e.jsx)(Pn,{subjectTutorGradeScale:R,onFormSubmit:$((L=S.grade_scale)!==null&&L!==void 0?L:[],R.s_subject_scale_form_id)})]},R.s_subject_scale_form_id)}):(0,e.jsx)(K.Z.Paragraph,{style:{textAlign:"center"},children:(0,e.jsx)(s.FormattedMessage,{id:"gradesScalesMissing"})})]})},wn=o(30814),Dn=o(40411),In=o(98101),Gn=o(27484),Xe=o.n(Gn),An=o(80334),Ln={getNow:function(){return Xe()()},getFixedDate:function(a){return Xe()(a,"YYYY-MM-DD")},getEndDate:function(a){var t=a.clone();return t.endOf("month")},getWeekDay:function(a){var t=a.clone().locale("en_US");return t.weekday()+t.localeData().firstDayOfWeek()},getYear:function(a){return a.year()},getMonth:function(a){return a.month()},getDate:function(a){return a.date()},getHour:function(a){return a.hour()},getMinute:function(a){return a.minute()},getSecond:function(a){return a.second()},getMillisecond:function(a){return a.millisecond()},addYear:function(a,t){var n=a.clone();return n.add(t,"year")},addMonth:function(a,t){var n=a.clone();return n.add(t,"month")},addDate:function(a,t){var n=a.clone();return n.add(t,"day")},setYear:function(a,t){var n=a.clone();return n.year(t)},setMonth:function(a,t){var n=a.clone();return n.month(t)},setDate:function(a,t){var n=a.clone();return n.date(t)},setHour:function(a,t){var n=a.clone();return n.hour(t)},setMinute:function(a,t){var n=a.clone();return n.minute(t)},setSecond:function(a,t){var n=a.clone();return n.second(t)},setMillisecond:function(a,t){var n=a.clone();return n.millisecond(t)},isAfter:function(a,t){return a.isAfter(t)},isValidate:function(a){return a.isValid()},locale:{getWeekFirstDay:function(a){var t=Xe()().locale(a);return t.localeData().firstDayOfWeek()},getWeekFirstDate:function(a,t){var n=t.clone(),r=n.locale(a);return r.weekday(0)},getWeek:function(a,t){var n=t.clone(),r=n.locale(a);return r.week()},getShortWeekDays:function(a){var t=Xe()().locale(a);return t.localeData().weekdaysMin()},getShortMonths:function(a){var t=Xe()().locale(a);return t.localeData().monthsShort()},format:function(a,t,n){var r=t.clone(),l=r.locale(a);return l.format(n)},parse:function(a,t,n){for(var r=[],l=0;l<n.length;l+=1){var d=n[l],f=t;if(d.includes("wo")||d.includes("Wo")){d=d.replace(/wo/g,"w").replace(/Wo/g,"W");var p=d.match(/[-YyMmDdHhSsWwGg]+/g),j=f.match(/[-\d]+/g);p&&j?(d=p.join(""),f=j.join("")):r.push(d.replace(/o/g,""))}var S=Xe()(f,d,a,!0);if(S.isValid())return S}for(var y=0;y<r.length;y+=1){var F=Xe()(t,r[y],a,!1);if(F.isValid())return(0,An.ET)(!1,"Not match any format strictly and fallback to fuzzy match. Please help to fire a issue about this."),F}return null}}},Rn=Ln;function $n(u,a){return Vt.apply(this,arguments)}function Vt(){return Vt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/schedules",m()({params:a,method:"GET",useCache:!1},t||{})));case 1:case"end":return r.stop()}},u)})),Vt.apply(this,arguments)}var On=(0,In.Z)(Rn),Nn=function(){var a=(0,v.useState)(null),t=P()(a,2),n=t[0],r=t[1],l=(0,v.useState)([]),d=P()(l,2),f=d[0],p=d[1],j=(0,tt.Z)(),S=j.semester_subject_id,y=Xe()(),F=(0,v.useMemo)(function(){return f.map(function(A){return{id:A.id,title:"".concat(A.group.name," (").concat(A.term_status.name,")"),start:Xe()(A.date_from).toDate(),end:Xe()(A.date_to).toDate(),tutor_name:"".concat(A.tutor.first_name," ").concat(A.tutor.last_name),tutor_email:A.tutor.email,semester:A.semester.name,group:A.group.name,subject:A.subject.name,ms_teams_join_url:A.ms_teams_join_url}})},[f]),h=(0,v.useCallback)(function(A,k){$n({semester_subject_id:S,date_form:A.toDate(),date_to:k.toDate()}).then(function(ue){ue.success&&p(ue.data)})},[S]),b=(0,v.useCallback)(function(A){r(A)},[]),C=(0,v.useCallback)(function(){r(null)},[]),T=(0,v.useCallback)(function(A){return A.isSame(y,"day")?"warning":A.isAfter(y,"day")?"success":"error"},[]),J=(0,v.useCallback)(function(A){var k=F.filter(function(ue){return Xe()(ue.start).isSame(A,"day")});return(0,e.jsx)("ul",{className:"events",children:k.map(function(ue){return(0,e.jsx)("li",{onClick:function(){return b(ue)},children:(0,e.jsx)(Dn.Z,{status:T(Xe()(ue.start)),text:ue.title})},ue.id)})})},[f]),w=(0,v.useCallback)(function(A,k){var ue=Xe()(A).startOf(k).subtract(1,"month"),le=Xe()(A).endOf(k).add(1,"month");h(ue,le)},[]);return(0,v.useEffect)(function(){var A=Xe()().startOf("month"),k=Xe()().endOf("month");h(A,k)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.Z.Title,{level:4,children:(0,e.jsx)(s.FormattedMessage,{id:"schedule",defaultMessage:"Schedule"})}),(0,e.jsx)(On,{cellRender:J,onPanelChange:w}),(0,e.jsxs)(Se.Z,{open:n!==null,title:"".concat(n==null?void 0:n.subject,": ").concat(n==null?void 0:n.title),onCancel:C,footer:null,children:[(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"tutorName",defaultMessage:"Tutor"}),": ",n==null?void 0:n.tutor_name]}),(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"Email"}),": ",n==null?void 0:n.tutor_email]}),(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"group",defaultMessage:"Group"}),": ",n==null?void 0:n.group]}),(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"semester",defaultMessage:"Semester"}),": ",n==null?void 0:n.semester]}),(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"started_at",defaultMessage:"Start date"}),":",n&&Xe()(n.start).format(ct.E)]}),(0,e.jsxs)(K.Z.Paragraph,{children:[(0,e.jsx)(s.FormattedMessage,{id:"end_at",defaultMessage:"End date"}),":",n&&Xe()(n.end).format(ct.E)]}),(n==null?void 0:n.ms_teams_join_url)&&(0,e.jsx)(K.Z.Paragraph,{children:(0,e.jsx)("a",{href:n.ms_teams_join_url,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(x.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"})})},"teamsLink")})]})]})},kn=o(58638);function Un(u,a){return zt.apply(this,arguments)}function zt(){return zt=i()(c()().mark(function u(a,t){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,s.request)("/api/admin/chats/ms-teams",m()({method:"POST",headers:{"Content-Type":"application/json"},data:a},t||{})));case 1:case"end":return r.stop()}},u)})),zt.apply(this,arguments)}var Bn=function(a){var t=a.student_id,n=(0,v.useState)(!1),r=P()(n,2),l=r[0],d=r[1],f=(0,v.useCallback)(i()(c()().mark(function p(){var j;return c()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return d(!0),y.next=3,Un({user_id:t});case 3:if(j=y.sent,j.success){y.next=8;break}return je.ZP.error(j.message),d(!1),y.abrupt("return");case 8:window.open(j.data.web_url,"_blank","noopener noreferrer"),d(!1);case 10:case"end":return y.stop()}},p)})),[]);return(0,e.jsx)(ge.Z,{title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams",defaultMessage:"teams"}),children:(0,e.jsx)(x.ZP,{loading:l,type:"primary",icon:(0,e.jsx)(kn.Z,{}),onClick:f})})},Wn=[{title:(0,e.jsx)(s.FormattedMessage,{id:"ID",defaultMessage:"ID"}),dataIndex:"user_id",hideInSearch:!0,width:"80px"},{title:(0,e.jsx)(s.FormattedMessage,{id:"first_name",defaultMessage:"First name"}),dataIndex:"first_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"last_name",defaultMessage:"Last name"}),dataIndex:"last_name"},{title:(0,e.jsx)(s.FormattedMessage,{id:"email",defaultMessage:"email"}),dataIndex:"email"},{title:(0,e.jsx)(s.FormattedMessage,{id:"groupName",defaultMessage:"Group name"}),dataIndex:"group_name",hideInSearch:!0}],Kn=function(a){return a.map(function(t){var n=t.id,r=t.name;return{label:r,value:n}})},Vn=function(a,t){return a.reduce(function(n,r){if(!(r!=null&&r.users))return n;var l=r.users.reduce(function(d,f){var p=t.some(function(j){return j.user.id===f.id});return f.academic_teacher_id!==null&&!p?d:[].concat(Z()(d),[{group_id:r.id,group_name:r.name,user_id:f.id,first_name:f.first_name,last_name:f.last_name,email:f.email}])},[]);return[].concat(Z()(n),Z()(l))},[])},zn=function(){var a=(0,tt.Z)(),t=a.teacherSubjectData,n=(0,v.useMemo)(function(){var r;return Kn((r=t==null?void 0:t.groups)!==null&&r!==void 0?r:[])},[t==null?void 0:t.groups]);return(0,e.jsx)(Y.ZP,{className:"table-standalone",rowKey:function(l){return"".concat(l.group_id,"-").concat(l.user_id)},search:{layout:"vertical"},pagination:{defaultPageSize:dt.Sl},request:function(){var r=i()(c()().mark(function l(d){var f,p,j,S,y,F,h,b,C,T;return c()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return f=d.groups,p=d.first_name,j=p===void 0?"":p,S=d.last_name,y=S===void 0?"":S,F=d.email,h=F===void 0?"":F,w.next=3,(0,_t.Z)({parent_id:t==null?void 0:t.group_id,id:f});case 3:if(b=w.sent,b.success){w.next=6;break}return w.abrupt("return",{data:[],total:0,success:!1});case 6:return w.next=8,O(b.data.map(function(A){return A.id}));case 8:if(C=w.sent,C.success){w.next=11;break}return w.abrupt("return",{data:[],success:!1});case 11:return T=Vn(b.data,C.data).filter(function(A){return A.first_name.toLowerCase().includes(j.toLowerCase())&&A.last_name.toLowerCase().includes(y.toLowerCase())&&A.email.toLowerCase().includes(h.toLowerCase())}),w.abrupt("return",{data:T,total:T.length,success:!0});case 13:case"end":return w.stop()}},l)}));return function(l){return r.apply(this,arguments)}}(),columns:[{title:(0,e.jsx)(s.FormattedMessage,{id:"groups",defaultMessage:"Groups"}),dataIndex:"groups",hideInTable:!0,filterMultiple:!0,valueType:"select",fieldProps:{options:n,mode:"multiple"}}].concat(Wn,[{hideInSearch:!0,title:(0,e.jsx)(s.FormattedMessage,{id:"msTeams"}),dataIndex:"teamsLink",valueType:"option",render:function(l,d){return[(0,e.jsx)(Bn,{student_id:d.user_id},"teamsChat")]}}])})},Xn=function(a){var t,n,r=a.tab,l=(0,s.useIntl)(),d=(0,s.useModel)("@@initialState"),f=d.setInitialState,p=d.initialState,j=(0,tt.Z)(),S=j.teacherSubjectData,y=j.semester_subject_id,F=j.tutors,h=(0,v.useCallback)((0,Ze.X)(p==null?void 0:p.currentUser),[p==null?void 0:p.currentUser]),b=(0,v.useMemo)(function(){return!!F.data.find(function(C){var T,J=C.id;return J===(p==null||(T=p.currentUser)===null||T===void 0?void 0:T.id)})||h(Ke.Z.TeacherListGradeScale)},[]);return S?(0,e.jsx)(U._z,{title:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.FormattedMessage,{id:S==null||(t=S.subject)===null||t===void 0?void 0:t.name}),", ",(0,e.jsx)(s.FormattedMessage,{id:r})]}),tabBarExtraContent:(0,e.jsx)("div",{style:{display:"flex",padding:"12px",gap:"12px"},children:(0,e.jsx)(s.Link,{to:"/teacher/subjects/".concat(y,"/exams?exam_id=new"),children:(0,e.jsx)(x.ZP,{type:"primary",children:(0,e.jsx)(s.FormattedMessage,{id:"uploadGrades",defaultMessage:"uploadGrades"})})})}),header:{breadcrumb:{routes:[{path:"teacher",breadcrumbName:l.formatMessage({id:"menu.Teacher"})},{path:"subjects",breadcrumbName:l.formatMessage({id:"menu.Teacher.Subjects"})},{path:String(y),breadcrumbName:String((n=S.subject)===null||n===void 0?void 0:n.name)},{path:String(r),breadcrumbName:l.formatMessage({id:r,defaultMessage:String(r)})}]}},children:(0,e.jsxs)(_e.ZP,{bodyStyle:{padding:"24px"},tabs:{type:"card",activeKey:r,onChange:function(T){f(m()({},p)),s.history.push("/teacher/subjects/".concat(y,"/").concat(T))}},children:[(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"groups"}),children:(0,e.jsx)(wn.F,{})},"groups"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"students"}),children:(0,e.jsx)(zn,{})},"students"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"exams"}),children:(0,e.jsx)(en,{})},"exams"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"schedule"}),children:(0,e.jsx)(Nn,{})},"schedule"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"class-register"}),children:(0,e.jsx)(wa,{})},"class-register"),b&&(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"grades-scale"}),children:(0,e.jsx)(Zn,{})},"grades-scale"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"final-grades"}),children:(0,e.jsx)(Cn,{})},"final-grades"),(0,e.jsx)(_e.ZP.TabPane,{tab:(0,e.jsx)(s.FormattedMessage,{id:"file-exports-history"}),children:(0,e.jsx)(on,{})},"file-exports-history")]})}):(0,e.jsx)(Oe.Z,{})},Hn=function(){var u=(0,s.useParams)(),a=u.subjectId,t=u.tab,n=t===void 0?"groups":t;return(0,e.jsx)(tt.p,{semester_subject_id:Number(a),children:(0,e.jsx)(Xn,{tab:n})})}},76841:function(Tt,qe,o){o.d(qe,{Gm:function(){return x},Sx:function(){return c},_g:function(){return s}});var Ve=o(15009),m=o.n(Ve),Ke=o(97857),Ze=o.n(Ke),_e=o(99289),U=o.n(_e),Oe=o(80854);function x(i,M){return v.apply(this,arguments)}function v(){return v=U()(m()().mark(function i(M,Z){return m()().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.abrupt("return",(0,Oe.request)("/api/admin/reports/report",Ze()({params:M,method:"GET",useCache:!1},Z||{})));case 1:case"end":return P.stop()}},i)})),v.apply(this,arguments)}function s(i,M,Z){return te.apply(this,arguments)}function te(){return te=U()(m()().mark(function i(M,Z,ne){return m()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,Oe.request)("/api/admin/stats/course/".concat(M,"/export"),Ze()({params:Z,method:"GET",useCache:!1,responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ne||{})));case 1:case"end":return Y.stop()}},i)})),te.apply(this,arguments)}function c(i,M,Z){return E.apply(this,arguments)}function E(){return E=U()(m()().mark(function i(M,Z,ne){return m()().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",(0,Oe.request)("/api/admin/stats/topic/".concat(M,"/export"),Ze()({method:"GET",useCache:!1,params:{stat:Z},responseType:"blob",headers:{accept:"application/vnd.ms-excel"}},ne||{})));case 1:case"end":return Y.stop()}},i)})),E.apply(this,arguments)}},70804:function(Tt,qe,o){var Ve=o(67294);var m=function(te,c){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,i){E.__proto__=i}||function(E,i){for(var M in i)i.hasOwnProperty(M)&&(E[M]=i[M])})(te,c)},Ke,Ze,_e=(function(te){(function(){var c={}.hasOwnProperty;function E(){for(var i=[],M=0;M<arguments.length;M++){var Z=arguments[M];if(Z){var ne=typeof Z;if(ne==="string"||ne==="number")i.push(Z);else if(Array.isArray(Z)&&Z.length){var P=E.apply(null,Z);P&&i.push(P)}else if(ne==="object")for(var Y in Z)c.call(Z,Y)&&Z[Y]&&i.push(Y)}}return i.join(" ")}te.exports?(E.default=E,te.exports=E):window.classNames=E})()}(Ze={path:Ke,exports:{},require:function(te,c){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(c==null&&Ze.path)}},Ze.exports),Ze.exports);function U(te,c,E){var i,M,Z,ne,P;function Y(){var ge=Date.now()-ne;ge<c&&ge>=0?i=setTimeout(Y,c-ge):(i=null,E||(P=te.apply(Z,M),Z=M=null))}c==null&&(c=100);var Se=function(){Z=this,M=arguments,ne=Date.now();var ge=E&&!i;return i||(i=setTimeout(Y,c)),ge&&(P=te.apply(Z,M),Z=M=null),P};return Se.clear=function(){i&&(clearTimeout(i),i=null)},Se.flush=function(){i&&(P=te.apply(Z,M),Z=M=null,clearTimeout(i),i=null)},Se}U.debounce=U;var Oe=U;(function(te,c){c===void 0&&(c={});var E=c.insertAt;if(te&&typeof document!="undefined"){var i=document.head||document.getElementsByTagName("head")[0],M=document.createElement("style");M.type="text/css",E==="top"&&i.firstChild?i.insertBefore(M,i.firstChild):i.appendChild(M),M.styleSheet?M.styleSheet.cssText=te:M.appendChild(document.createTextNode(te))}})(`.indiana-scroll-container {
  overflow: auto; }
  .indiana-scroll-container--dragging {
    scroll-behavior: auto !important; }
    .indiana-scroll-container--dragging > * {
      pointer-events: none;
      cursor: -webkit-grab;
      cursor: grab; }
  .indiana-scroll-container--hide-scrollbars {
    overflow: hidden;
    overflow: -moz-scrollbars-none;
    -ms-overflow-style: none;
    scrollbar-width: none; }
    .indiana-scroll-container--hide-scrollbars::-webkit-scrollbar {
      display: none !important;
      height: 0 !important;
      width: 0 !important;
      background: transparent !important;
      -webkit-appearance: none !important; }
  .indiana-scroll-container--native-scroll {
    overflow: auto; }

.indiana-dragging {
  cursor: -webkit-grab;
  cursor: grab; }
`);var x,v=(x="indiana-scroll-container",function(te,c){if(!te)return x;var E;typeof te=="string"?E=te:c=te;var i=x;return E&&(i+="__"+E),i+(c?Object.keys(c).reduce(function(M,Z){var ne=c[Z];return ne&&(M+=" "+(typeof ne=="boolean"?i+"--"+Z:i+"--"+Z+"_"+ne)),M},""):"")}),s=function(te){function c(E){var i=te.call(this,E)||this;return i.onEndScroll=function(){i.scrolling=!1,!i.pressed&&i.started&&i.processEnd()},i.onScroll=function(M){var Z=i.container.current;Z.scrollLeft===i.scrollLeft&&Z.scrollTop===i.scrollTop||(i.scrolling=!0,i.processScroll(M),i.onEndScroll())},i.onTouchStart=function(M){var Z=i.props.nativeMobileScroll;if(i.isDraggable(M.target))if(i.internal=!0,Z&&i.scrolling)i.pressed=!0;else{var ne=M.touches[0];i.processClick(M,ne.clientX,ne.clientY),!Z&&i.props.stopPropagation&&M.stopPropagation()}},i.onTouchEnd=function(M){var Z=i.props.nativeMobileScroll;i.pressed&&(!i.started||i.scrolling&&Z?i.pressed=!1:i.processEnd(),i.forceUpdate())},i.onTouchMove=function(M){var Z=i.props.nativeMobileScroll;if(i.pressed&&(!Z||!i.isMobile)){var ne=M.touches[0];ne&&i.processMove(M,ne.clientX,ne.clientY),M.preventDefault(),i.props.stopPropagation&&M.stopPropagation()}},i.onMouseDown=function(M){i.isDraggable(M.target)&&i.isScrollable()&&(i.internal=!0,i.props.buttons.indexOf(M.button)!==-1&&(i.processClick(M,M.clientX,M.clientY),M.preventDefault(),i.props.stopPropagation&&M.stopPropagation()))},i.onMouseMove=function(M){i.pressed&&(i.processMove(M,M.clientX,M.clientY),M.preventDefault(),i.props.stopPropagation&&M.stopPropagation())},i.onMouseUp=function(M){i.pressed&&(i.started?i.processEnd():(i.internal=!1,i.pressed=!1,i.forceUpdate(),i.props.onClick&&i.props.onClick(M)),M.preventDefault(),i.props.stopPropagation&&M.stopPropagation())},i.container=Ve.createRef(),i.onEndScroll=Oe(i.onEndScroll,300),i.scrolling=!1,i.started=!1,i.pressed=!1,i.internal=!1,i.getRef=i.getRef.bind(i),i}return function(E,i){function M(){this.constructor=E}m(E,i),E.prototype=i===null?Object.create(i):(M.prototype=i.prototype,new M)}(c,te),c.prototype.componentDidMount=function(){var E=this.props.nativeMobileScroll,i=this.container.current;window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!1}),window.addEventListener("touchend",this.onTouchEnd),i.addEventListener("touchstart",this.onTouchStart,{passive:!1}),i.addEventListener("mousedown",this.onMouseDown,{passive:!1}),E&&(this.isMobile=this.isMobileDevice(),this.isMobile&&this.forceUpdate())},c.prototype.componentWillUnmount=function(){window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)},c.prototype.getElement=function(){return this.container.current},c.prototype.isMobileDevice=function(){return window.orientation!==void 0||navigator.userAgent.indexOf("IEMobile")!==-1},c.prototype.isDraggable=function(E){var i=this.props.ignoreElements;if(i){var M=E.closest(i);return M===null||M.contains(this.getElement())}return!0},c.prototype.isScrollable=function(){var E=this.container.current;return E&&(E.scrollWidth>E.clientWidth||E.scrollHeight>E.clientHeight)},c.prototype.processClick=function(E,i,M){var Z=this.container.current;this.scrollLeft=Z.scrollLeft,this.scrollTop=Z.scrollTop,this.clientX=i,this.clientY=M,this.pressed=!0},c.prototype.processStart=function(E){E===void 0&&(E=!0);var i=this.props.onStartScroll;this.started=!0,E&&document.body.classList.add("indiana-dragging"),i&&i({external:!this.internal}),this.forceUpdate()},c.prototype.processScroll=function(E){if(this.started){var i=this.props.onScroll;i&&i({external:!this.internal})}else this.processStart(!1)},c.prototype.processMove=function(E,i,M){var Z=this.props,ne=Z.horizontal,P=Z.vertical,Y=Z.activationDistance,Se=Z.onScroll,ge=this.container.current;this.started?(ne&&(ge.scrollLeft-=i-this.clientX),P&&(ge.scrollTop-=M-this.clientY),Se&&Se({external:!this.internal}),this.clientX=i,this.clientY=M,this.scrollLeft=ge.scrollLeft,this.scrollTop=ge.scrollTop):(ne&&Math.abs(i-this.clientX)>Y||P&&Math.abs(M-this.clientY)>Y)&&(this.clientX=i,this.clientY=M,this.processStart())},c.prototype.processEnd=function(){var E=this.props.onEndScroll;this.container.current&&E&&E({external:!this.internal}),this.pressed=!1,this.started=!1,this.scrolling=!1,this.internal=!1,document.body.classList.remove("indiana-dragging"),this.forceUpdate()},c.prototype.getRef=function(E){[this.container,this.props.innerRef].forEach(function(i){i&&(typeof i=="function"?i(E):i.current=E)})},c.prototype.render=function(){var E=this.props,i=E.children,M=E.draggingClassName,Z=E.className,ne=E.style,P=E.hideScrollbars,Y=E.component;return Ve.createElement(Y,{className:_e(Z,this.pressed&&M,v({dragging:this.pressed,"hide-scrollbars":P,"native-scroll":this.isMobile})),style:ne,ref:this.getRef,onScroll:this.onScroll},i)},c.defaultProps={nativeMobileScroll:!0,hideScrollbars:!0,activationDistance:10,vertical:!0,horizontal:!0,stopPropagation:!1,style:{},component:"div",buttons:[0]},c}(Ve.PureComponent);qe.Z=s}}]);

//# sourceMappingURL=p__TeacherSubjects__form.3e988165.async.js.map